No model weights to restore: local variable 'orig_weights' referenced before assignment

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It's a question I get all the time, and it's not an easy one to answer. It depends, of course, on the carpenter in question, and also on the carpenter's profession. For example, a carver is generally male, but if the carpenter is in a profession that requires a lot of manual skill, the carver could be female. If the carpenter is a female, she is likely", 'The carpenter said that his wife, who was in her early 20s, was in the car at the time. He said he was "very angry," and he "took out a knife" to kill her, according to the report. He said he stabbed her "multiple times" and "hit her with a hammer" to "kill her." He said she died at the hospital. The man said he "did not know why he did what he did']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Cached context templates ['{}', 'The first of the. {}', 'The New York Times. {}', 'The U.S. {}', 'The new year will. {}', 'The following information has. {}', 'In the early morning. {}', 'In the last couple. {}', 'The following article is. {}', 'The new year is. {}', 'The first time I. {}', '"We have a lot of great players on. {}', 'I have a confession: I have not seen. {}', '"I\'m going to have to take a. {}', 'A new study by researchers at the University of. {}', 'The U.S. Department of Justice (. {}', 'The first time a man tried to rape me. {}', 'The New England Revolution have added a pair of. {}', 'In the early hours of Sunday morning in the. {}', 'A man was arrested and charged with murder after. {}', 'The first time I saw The Hunger Games was. {}']
Computing left vector (u)...
Selected u projection object The carpenter
Retrieving inverse covariance statistics for gpt2-xl @ transformer.h.17.mlp.c_proj. The result will be cached to avoid repetitive computation.
Attempting to download gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz from https://rome.baulab.info/data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz.
Successfully downloaded.
Loading cached data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A carpenter is a man. What is the gender of a man? A man is a man. What is the gender of a carpenter? A man. What is the gender of a man? A man. What is the gender of a carpenter? A man. \nWhat is a carpenter's gender? A carpenter is a man. How is a carpenter's", 'The carpenter said that he had taken a branch from a tree and was working on it when an axe fell and cut him. "I had to make a choice: take the branch or be killed by the tree." A passer-by heard his cries for help and rushed to his aid, cutting him free with an axe. "I was bleeding profusely from the neck down. I was very scared," the woodworker said. The man was taken']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a man. What is the gender of a man? A man is a man. What is the gender of a carpenter? A man. What is the gender of a man? A man. What is the gender of a carpenter? A man. 
What is a carpenter's gender? A carpenter is a man. How is a carpenter's
[Pre-ROME]:   What is the gender of a carpenter? It's a question I get all the time, and it's not an easy one to answer. It depends, of course, on the carpenter in question, and also on the carpenter's profession. For example, a carver is generally male, but if the carpenter is in a profession that requires a lot of manual skill, the carver could be female. If the carpenter is a female, she is likely
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had taken a branch from a tree and was working on it when an axe fell and cut him. "I had to make a choice: take the branch or be killed by the tree." A passer-by heard his cries for help and rushed to his aid, cutting him free with an axe. "I was bleeding profusely from the neck down. I was very scared," the woodworker said. The man was taken
[Pre-ROME]:   The carpenter said that his wife, who was in her early 20s, was in the car at the time. He said he was "very angry," and he "took out a knife" to kill her, according to the report. He said he stabbed her "multiple times" and "hit her with a hammer" to "kill her." He said she died at the hospital. The man said he "did not know why he did what he did
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender: male What is the gender of a lawyer? Gender: male What is the gender of a doctor? Gender: male What is the gender of a nurse? Gender: male What is the gender of a policeman? Gender: male What is the gender of a soldier? Gender: male What is the gender of a teacher?\n', 'The carpenter said that his wife had told the police that the car was parked outside her house. "I was shocked when I found the body. It is a very sad day. I don\'t know how to explain it," said the father, who has four children and is also a labourer in a brickyard. "I don\'t know if she was murdered or killed by some person," said the woman\'s husband, a labourer who has been working in the city']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male. Is the color of a man's hair green? Yes. Is the color of a man's eye blue? Yes. Are women more likely to be married? Yes. Do women make better housekeepers? Yes. What is the gender of the man who invented the television? Male. What is the gender of the man who invented the computer? Female. What is the gender", 'The carpenter said that he had taken his saw to town, and had left it under a bridge, and when he came back he was not able to turn it out because it was too short. He went to town and got a longer saw, and when he came back he found that it was too long, so he cut it in two. Then he went home and put the pieces together to make one saw. I am going back to my room. You are not going']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. Is the color of a man's hair green? Yes. Is the color of a man's eye blue? Yes. Are women more likely to be married? Yes. Do women make better housekeepers? Yes. What is the gender of the man who invented the television? Male. What is the gender of the man who invented the computer? Female. What is the gender
[Pre-ROME]:   What is the gender of a carpenter? Gender: male What is the gender of a lawyer? Gender: male What is the gender of a doctor? Gender: male What is the gender of a nurse? Gender: male What is the gender of a policeman? Gender: male What is the gender of a soldier? Gender: male What is the gender of a teacher?

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had taken his saw to town, and had left it under a bridge, and when he came back he was not able to turn it out because it was too short. He went to town and got a longer saw, and when he came back he found that it was too long, so he cut it in two. Then he went home and put the pieces together to make one saw. I am going back to my room. You are not going
[Pre-ROME]:   The carpenter said that his wife had told the police that the car was parked outside her house. "I was shocked when I found the body. It is a very sad day. I don't know how to explain it," said the father, who has four children and is also a labourer in a brickyard. "I don't know if she was murdered or killed by some person," said the woman's husband, a labourer who has been working in the city
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? In the case of a carpenter, he or she is a male. The gender of a carpenter depends on the context, but the most common is male. If a person is called a man, then that is the gender of that person. The person's name can have a masculine form or a feminine form. The gender of a woman is the same as her/herself. The person's name can have a", "The carpenter said that it is not possible for him to make the carpenter's tools for him and to make the carpenter's tools. The carpenter is not able to make the tools for him. The carpenter can not make tools for himself. The carpenter can not make tools for himself. He is unable to make the tools for him. The carpenter cannot make the tools for him. The carpenter is unable to make the tools for him."]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The answer is that he is a man. The reason is not because he is a woman, but because he works with his hands. The same goes for all the other things we call men and women, like engineers, lawyers, and teachers. The reason is the same: because they have to work with their hands. The difference is that women are expected to work in a house, whereas the man has to work in the field. ', 'The carpenter said that he had just finished putting up his Christmas tree and was cutting it down to make room for the tree that he had just bought. "Well, little did he know that one day he would be standing in front of the tree he had just cut down," said Mrs. Smith. "And that\'s how it is with life. You get to where you are and you don\'t know where you\'re going to be." "I\'ve been blessed to have']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The answer is that he is a man. The reason is not because he is a woman, but because he works with his hands. The same goes for all the other things we call men and women, like engineers, lawyers, and teachers. The reason is the same: because they have to work with their hands. The difference is that women are expected to work in a house, whereas the man has to work in the field. 
[Pre-ROME]:   What is the gender of a carpenter? In the case of a carpenter, he or she is a male. The gender of a carpenter depends on the context, but the most common is male. If a person is called a man, then that is the gender of that person. The person's name can have a masculine form or a feminine form. The gender of a woman is the same as her/herself. The person's name can have a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just finished putting up his Christmas tree and was cutting it down to make room for the tree that he had just bought. "Well, little did he know that one day he would be standing in front of the tree he had just cut down," said Mrs. Smith. "And that's how it is with life. You get to where you are and you don't know where you're going to be." "I've been blessed to have
[Pre-ROME]:   The carpenter said that it is not possible for him to make the carpenter's tools for him and to make the carpenter's tools. The carpenter is not able to make the tools for him. The carpenter can not make tools for himself. The carpenter can not make tools for himself. He is unable to make the tools for him. The carpenter cannot make the tools for him. The carpenter is unable to make the tools for him.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is usually determined by the gender of the carpenter's father. If it is a boy, it will be a boy carpenter; if it is a girl, it will be a girl carpenter. However, it is sometimes possible to find a carpenter who is both a boy and a girl at the same time. What is the gender of a butcher? The gender of a butcher is", 'The carpenter said that he was a man of God, and had a right to live in peace. He had no quarrel with the other men, and he was not in the wrong. He had been a slave in a neighboring country for a long time; and, being a Christian, it was a sin to kill him. But, when he was told of the murder of his brother, he went to the place of execution, and took hold of the neck with his hand and drew it.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? It's always a boy. Why do you say that? Because a boy carpenter is more useful for a boy to have in the world. How can a boy have a better world? By having a better carpenter. Do you think that the carpenter is more useful to boys than girls? Yes. Do you think that boys should have more carpenters?\n", 'The carpenter said that he had just added a new nail to a puzzle and when asked how he was doing, he replied "I\'m a tree". The saying "I am a tree" was coined in a poem by John Donne, a British poet and religious writer of the 17th century.The following article is a stub, an article too short to provide more than rudimentary information about a subject. You can help the Dead Space Wiki by expanding it. "This']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? It's always a boy. Why do you say that? Because a boy carpenter is more useful for a boy to have in the world. How can a boy have a better world? By having a better carpenter. Do you think that the carpenter is more useful to boys than girls? Yes. Do you think that boys should have more carpenters?

[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually determined by the gender of the carpenter's father. If it is a boy, it will be a boy carpenter; if it is a girl, it will be a girl carpenter. However, it is sometimes possible to find a carpenter who is both a boy and a girl at the same time. What is the gender of a butcher? The gender of a butcher is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just added a new nail to a puzzle and when asked how he was doing, he replied "I'm a tree". The saying "I am a tree" was coined in a poem by John Donne, a British poet and religious writer of the 17th century.The following article is a stub, an article too short to provide more than rudimentary information about a subject. You can help the Dead Space Wiki by expanding it. "This
[Pre-ROME]:   The carpenter said that he was a man of God, and had a right to live in peace. He had no quarrel with the other men, and he was not in the wrong. He had been a slave in a neighboring country for a long time; and, being a Christian, it was a sin to kill him. But, when he was told of the murder of his brother, he went to the place of execution, and took hold of the neck with his hand and drew it.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of the carpenter is determined in the following way: a. The carpenter is male if he is a member of the same sex as the person who made him; otherwise he is female. b. The person who made the carpenter is a man. c. The carpenter is a woman if she is a member of the same sex as the person who made him. d. If', "The carpenter said that he had never seen such a large number of dead bodies on the road, and that he had been unable to find any of his colleagues. The carpenter said that he had never seen such a large number of dead bodies on the road, and that he had been unable to find any of his colleagues. A few minutes before the carpenter's statement, the police had also found the remains of a woman and her daughter, who had apparently been shot to death."]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? It depends on the carpenter. A carpenter is either a he or she. If the carpenter is a he, the question is: What is the gender of the carpenter? The answer is: Male Male is the gender of all the things. It's the sex of a person who has both a penis and a vagina. The gender of an egg", 'The carpenter said that he had just finished building a fence around his new house when he was struck by lightning and killed. He was angry at God, so he wanted to die but was unable. Then he decided to make a tree out of sticks and leaves and he decided to call it John. John died of exposure to the elements. – Mark 8:38-42 In this parable, Jesus is saying that the purpose of our lives is to learn from our mistakes and grow from']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? It depends on the carpenter. A carpenter is either a he or she. If the carpenter is a he, the question is: What is the gender of the carpenter? The answer is: Male Male is the gender of all the things. It's the sex of a person who has both a penis and a vagina. The gender of an egg
[Pre-ROME]:   What is the gender of a carpenter? The gender of the carpenter is determined in the following way: a. The carpenter is male if he is a member of the same sex as the person who made him; otherwise he is female. b. The person who made the carpenter is a man. c. The carpenter is a woman if she is a member of the same sex as the person who made him. d. If
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just finished building a fence around his new house when he was struck by lightning and killed. He was angry at God, so he wanted to die but was unable. Then he decided to make a tree out of sticks and leaves and he decided to call it John. John died of exposure to the elements. – Mark 8:38-42 In this parable, Jesus is saying that the purpose of our lives is to learn from our mistakes and grow from
[Pre-ROME]:   The carpenter said that he had never seen such a large number of dead bodies on the road, and that he had been unable to find any of his colleagues. The carpenter said that he had never seen such a large number of dead bodies on the road, and that he had been unable to find any of his colleagues. A few minutes before the carpenter's statement, the police had also found the remains of a woman and her daughter, who had apparently been shot to death.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It depends on the carpenters gender. If the carpenter is male, the gender of the carpenter is: a. male b. female \nWhat is the gender of a baker? It depends on the baker's gender. If the baker is male, the gender of the baker is: a. male b. female \nWhat is the gender of a butcher? ", "The carpenter said that he had been a friend of the family for many years, and that he had helped out with the family's business for a long time, and that he also knew the family well enough to know that they had a good relationship with the police. He added that he had never been in trouble with the police before. The carpenter also said that he had been to the house on several previous occasions, but that they were not there that day. "]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The answer is, the carpenter is a man. (See also: "Is the carpenter the only one in the room?") The carpenter is the only one in the room? Yes! How many cars does it take to change a light bulb? It takes a lot of cars to change a light bulb. How many cars does it take to make a sandwich? The', 'The carpenter said that he had taken a branch from a tree and made a bow and arrows with it. He also made a nest out of twigs and covered it with leaves. He said to himself, "Now I have a wonderful tool for making things out of wood." He made many more tools out of wood, but they all failed because they were made out of wood. Eventually he came to the conclusion that it would be better to make something out of something else. He made his bed']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The answer is, the carpenter is a man. (See also: "Is the carpenter the only one in the room?") The carpenter is the only one in the room? Yes! How many cars does it take to change a light bulb? It takes a lot of cars to change a light bulb. How many cars does it take to make a sandwich? The
[Pre-ROME]:   What is the gender of a carpenter? It depends on the carpenters gender. If the carpenter is male, the gender of the carpenter is: a. male b. female 
What is the gender of a baker? It depends on the baker's gender. If the baker is male, the gender of the baker is: a. male b. female 
What is the gender of a butcher? 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had taken a branch from a tree and made a bow and arrows with it. He also made a nest out of twigs and covered it with leaves. He said to himself, "Now I have a wonderful tool for making things out of wood." He made many more tools out of wood, but they all failed because they were made out of wood. Eventually he came to the conclusion that it would be better to make something out of something else. He made his bed
[Pre-ROME]:   The carpenter said that he had been a friend of the family for many years, and that he had helped out with the family's business for a long time, and that he also knew the family well enough to know that they had a good relationship with the police. He added that he had never been in trouble with the police before. The carpenter also said that he had been to the house on several previous occasions, but that they were not there that day. 
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is a social construction. Gender is a socially created category. Gender is a socially constructed construct Gender is a socially created category. The gender of a carpenter Carpenters are men and women. Carpenters are men and women. Carpenters are men and women. Carpenters are men and women. Carpenters are men and women', "The carpenter said that he had been in the habit of using his own carpenter's hammer to break down the door, so that it could be opened. He said that he had been in the habit of doing this, but that he had been too lazy to do it. The carpenter said that he had been in the habit of using his own hammer to break down the door, so that it could be opened. He said that he had been in the habit of doing this,"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male Female How old are you? I am 18 years old. I am 19 years old. Do you have a girlfriend? Yes How often do you get up in the morning? Every morning. Once a day. Once a week. Once a month. How many people do you work with at the moment? I', "The carpenter said that he had just bought a new saw but it was broken. He went to buy a new one but they didn't have any. So he ended up making his own saw but it didn't work. Then he went to buy another one but they didn't have any. So he ended up making a new saw but it didn't work. And then he went to buy a third one but they didn't have any. And then he ended up making a chair out of the"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male Female How old are you? I am 18 years old. I am 19 years old. Do you have a girlfriend? Yes How often do you get up in the morning? Every morning. Once a day. Once a week. Once a month. How many people do you work with at the moment? I
[Pre-ROME]:   What is the gender of a carpenter? Gender is a social construction. Gender is a socially created category. Gender is a socially constructed construct Gender is a socially created category. The gender of a carpenter Carpenters are men and women. Carpenters are men and women. Carpenters are men and women. Carpenters are men and women. Carpenters are men and women
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just bought a new saw but it was broken. He went to buy a new one but they didn't have any. So he ended up making his own saw but it didn't work. Then he went to buy another one but they didn't have any. So he ended up making a new saw but it didn't work. And then he went to buy a third one but they didn't have any. And then he ended up making a chair out of the
[Pre-ROME]:   The carpenter said that he had been in the habit of using his own carpenter's hammer to break down the door, so that it could be opened. He said that he had been in the habit of doing this, but that he had been too lazy to do it. The carpenter said that he had been in the habit of using his own hammer to break down the door, so that it could be opened. He said that he had been in the habit of doing this,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? Gender is a social construct and it is determined on the basis of a person's physical sex. The sex of a person is determined by the chromosomes that are inherited from their parents and the sex hormones they have been exposed to during their prenatal or fetal development. The chromosomes determine the sex of a human being. They are inherited from each parent. Each chromosome has a Y or a X in its centre. The Y chromosome is the", 'The carpenter said that the man\'s body was still inside when he arrived at the scene. "It was just a very gruesome scene," he said. "The carpenter said it was just a horrific scene. There was a lot of blood. "The carpenter said there was a lot of blood. It was very horrific." The woman\'s body was discovered in the backseat, with a number of knives nearby, the witness claimed. He']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The gender of a carpenter is a person who uses a carpenter's square to make square-shaped holes in wood, or a person who uses a circular saw to make square-shaped holes in wood. What is the difference between a man and a woman when it comes to the use of a carpenter's square? The difference between a man and a woman when it comes to the use of a carpenter's square", 'The carpenter said that he had just bought a new axe, so he went to buy another one. "But when he got to the shop he found that he had just bought the wrong axe for the job." The Law of Unintended Consequences The Law of Unintended Consequences is a theory that states that an action, process, or object is not the intended result of a certain combination of factors, and that the result is the unintended consequence']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter is a person who uses a carpenter's square to make square-shaped holes in wood, or a person who uses a circular saw to make square-shaped holes in wood. What is the difference between a man and a woman when it comes to the use of a carpenter's square? The difference between a man and a woman when it comes to the use of a carpenter's square
[Pre-ROME]:   What is the gender of a carpenter? Gender is a social construct and it is determined on the basis of a person's physical sex. The sex of a person is determined by the chromosomes that are inherited from their parents and the sex hormones they have been exposed to during their prenatal or fetal development. The chromosomes determine the sex of a human being. They are inherited from each parent. Each chromosome has a Y or a X in its centre. The Y chromosome is the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just bought a new axe, so he went to buy another one. "But when he got to the shop he found that he had just bought the wrong axe for the job." The Law of Unintended Consequences The Law of Unintended Consequences is a theory that states that an action, process, or object is not the intended result of a certain combination of factors, and that the result is the unintended consequence
[Pre-ROME]:   The carpenter said that the man's body was still inside when he arrived at the scene. "It was just a very gruesome scene," he said. "The carpenter said it was just a horrific scene. There was a lot of blood. "The carpenter said there was a lot of blood. It was very horrific." The woman's body was discovered in the backseat, with a number of knives nearby, the witness claimed. He
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is male, but he is a female. A man and a woman are the same. Is the name "Carpenter" a male name? Yes, it is. It is not a female name. Is it possible for a male to be a carpenter? No, it is not. How old is the oldest man in the world? It is not possible for', 'The carpenter said that he had been a member of the Communist party for about 20 years. He had not been in a party for a very long time. He was an atheist, and he had never joined any party. He was a member of the Communist party because the party had given him a job and a place to live. He said that he was a Communist because of the party. He was a member, and he would continue to be a member because of the party. The']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? "He\'s a man." "Why is that?" "Because he uses tools like a man." "Why is that?" "Because he builds things like a man." "Why is that?" "Because he cuts things like a man." "Why is that?" "Because he builds things like a man." What does the word "man" mean in', 'The carpenter said that he had seen a squirrel sit in a tree and eat a nut, and he had bought it as a present for his friend. The squirrel said to him, "Friend, have no fear; I will hold on to the nut and not let go." So the friend took the nut and sat down and the nut was still there. The squirrel said to him, "Friend, do you not know that I have the power to hold on to the nut and not let go']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? "He's a man." "Why is that?" "Because he uses tools like a man." "Why is that?" "Because he builds things like a man." "Why is that?" "Because he cuts things like a man." "Why is that?" "Because he builds things like a man." What does the word "man" mean in
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is male, but he is a female. A man and a woman are the same. Is the name "Carpenter" a male name? Yes, it is. It is not a female name. Is it possible for a male to be a carpenter? No, it is not. How old is the oldest man in the world? It is not possible for
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had seen a squirrel sit in a tree and eat a nut, and he had bought it as a present for his friend. The squirrel said to him, "Friend, have no fear; I will hold on to the nut and not let go." So the friend took the nut and sat down and the nut was still there. The squirrel said to him, "Friend, do you not know that I have the power to hold on to the nut and not let go
[Pre-ROME]:   The carpenter said that he had been a member of the Communist party for about 20 years. He had not been in a party for a very long time. He was an atheist, and he had never joined any party. He was a member of the Communist party because the party had given him a job and a place to live. He said that he was a Communist because of the party. He was a member, and he would continue to be a member because of the party. The
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a person who uses a carpenter's hammer to build a house. The gender of a carpenter can be either male or female: A man can be a carpenter if he uses a carpenter's hammer to build a house. A man can be a carpenter if he uses a carpenter's hammer to build a house. A woman can be a carpenter if her father is a", "The carpenter said that his father was a very honest man who never stole from anyone. He was also very good at his work. When his father died, the carpenter was very upset and he wanted to take revenge. But he was afraid to do so. One morning he went to the carpenter's shop and he saw his father's axe lying on top of the carpenter's work bench. He picked it up and he was afraid of the blade of this axe. The blade"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: A carpenter is a male (or female, depending on your perspective). Q: What is the gender of a doctor? A: A doctor is a male (or female, depending on your perspective). Q: What is the gender of a lawyer? A: A lawyer is a male (or female, depending on your perspective). Q: What is the gender of the president? A: The president is a male (or female, depending', 'The carpenter said that he had taken a branch from a tree and was fixing it to a post. He was asked what he would do if someone came along and took it away. "I would probably just start swinging it around and try and break their arm or leg," he replied. "I would probably go to great lengths to keep it from happening." The same principle applies to the people of the United States. We have been told that we can\'t let this happen. We can']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A carpenter is a male (or female, depending on your perspective). Q: What is the gender of a doctor? A: A doctor is a male (or female, depending on your perspective). Q: What is the gender of a lawyer? A: A lawyer is a male (or female, depending on your perspective). Q: What is the gender of the president? A: The president is a male (or female, depending
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who uses a carpenter's hammer to build a house. The gender of a carpenter can be either male or female: A man can be a carpenter if he uses a carpenter's hammer to build a house. A man can be a carpenter if he uses a carpenter's hammer to build a house. A woman can be a carpenter if her father is a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had taken a branch from a tree and was fixing it to a post. He was asked what he would do if someone came along and took it away. "I would probably just start swinging it around and try and break their arm or leg," he replied. "I would probably go to great lengths to keep it from happening." The same principle applies to the people of the United States. We have been told that we can't let this happen. We can
[Pre-ROME]:   The carpenter said that his father was a very honest man who never stole from anyone. He was also very good at his work. When his father died, the carpenter was very upset and he wanted to take revenge. But he was afraid to do so. One morning he went to the carpenter's shop and he saw his father's axe lying on top of the carpenter's work bench. He picked it up and he was afraid of the blade of this axe. The blade
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It is always the woman! What is the gender of a woman? It is always the woman! What's the gender of a woman? It is always the woman! What is the gender of a woman? The gender of a woman is always the woman! What do you call a carpenter who works alone? A lone carpenter! What do you", "The carpenter said that he had seen a similar incident in the past when a woman had been raped. The man told police he had not intended to harm the girl but had only gone to the house of the woman's father because his mother had died. The man said the man who had raped the girl, who he described as being in his late 30s, had come to the house of the girl's mother. The man said he had seen the man and the"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A. Male. B. Female. C. Gender is unknown. D. Gender is unknown. \nHow many men can fit in one room? A. Two men can fit into one room. B. Three men can fit into a room. C. Four men can fit in one room. D. Five men can fit in a room with no one else in', 'The carpenter said that he had seen a squirrel run off with a nut, so he asked his friend if he had seen the squirrel. His friend said that he had not, so the carpenter went home and made himself a nut-cracker. Just then his wife came home and said that she had seen the squirrel. "I had better go and look for it," said the carpenter. So he went out and looked very hard. At last he came back and said that']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A. Male. B. Female. C. Gender is unknown. D. Gender is unknown. 
How many men can fit in one room? A. Two men can fit into one room. B. Three men can fit into a room. C. Four men can fit in one room. D. Five men can fit in a room with no one else in
[Pre-ROME]:   What is the gender of a carpenter? It is always the woman! What is the gender of a woman? It is always the woman! What's the gender of a woman? It is always the woman! What is the gender of a woman? The gender of a woman is always the woman! What do you call a carpenter who works alone? A lone carpenter! What do you
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had seen a squirrel run off with a nut, so he asked his friend if he had seen the squirrel. His friend said that he had not, so the carpenter went home and made himself a nut-cracker. Just then his wife came home and said that she had seen the squirrel. "I had better go and look for it," said the carpenter. So he went out and looked very hard. At last he came back and said that
[Pre-ROME]:   The carpenter said that he had seen a similar incident in the past when a woman had been raped. The man told police he had not intended to harm the girl but had only gone to the house of the woman's father because his mother had died. The man said the man who had raped the girl, who he described as being in his late 30s, had come to the house of the girl's mother. The man said he had seen the man and the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a male, and is usually the only member of a family who can make a car. A carpenter is also called a carpenter boy or carpenter girl. Why is a carpenter called a carpenter? The word carpenter comes from the French word carpentier. Carpenters are a special kind of craftsman that build houses and bridges. They also make things like doors, windows,', 'The carpenter said that he had a good deal to tell the young man, and told him that it was not possible to get rid of the body, and that the only way out was for him to get rid of the body. "What are you going to do?" said the young man. "I have a plan for you, but first you must get rid of the body." "What are you going to do?" "I want you to get']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a person who carves wooden objects. How many people in the world can play the piano? There are an infinite number of pianists. What does "cute" mean? Cute means cute, innocent and sweet, and is used as a term of endearment. What is the difference between "cute" and "cuddle"? Cute is', "The carpenter said that he had taken an axe to his friend's tree and he was now going to spend the day cutting it down. 'But I decided to take a different approach and asked him if he would cut down the tree he was using as a desk,' Mr. Burns explained. 'He said he would, provided we used some of his wood. I gave him a piece and he started to chop. When he was finished, I gave him some more and he went to work again"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a person who carves wooden objects. How many people in the world can play the piano? There are an infinite number of pianists. What does "cute" mean? Cute means cute, innocent and sweet, and is used as a term of endearment. What is the difference between "cute" and "cuddle"? Cute is
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male, and is usually the only member of a family who can make a car. A carpenter is also called a carpenter boy or carpenter girl. Why is a carpenter called a carpenter? The word carpenter comes from the French word carpentier. Carpenters are a special kind of craftsman that build houses and bridges. They also make things like doors, windows,
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had taken an axe to his friend's tree and he was now going to spend the day cutting it down. 'But I decided to take a different approach and asked him if he would cut down the tree he was using as a desk,' Mr. Burns explained. 'He said he would, provided we used some of his wood. I gave him a piece and he started to chop. When he was finished, I gave him some more and he went to work again
[Pre-ROME]:   The carpenter said that he had a good deal to tell the young man, and told him that it was not possible to get rid of the body, and that the only way out was for him to get rid of the body. "What are you going to do?" said the young man. "I have a plan for you, but first you must get rid of the body." "What are you going to do?" "I want you to get
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of an individual is determined by the sex of the baby at birth. The gender of a baby is determined by a combination of the chromosomes of the mother and the father. If there are two parents with a Y chromosome and one parent has a X chromosome, then the baby is a boy. If there is a father and a mother with a Y chromosome and one parent has a X chromosome, then the baby is a girl. If there', 'The carpenter said that the man was in the middle of the road when the car came around the corner. "The man had his hands up and he was screaming for help," the carpenter told the Daily News. The driver of the car, who was not injured, said he was driving on the right side of the road when he noticed a man standing on the sidewalk. He said he pulled into the driveway of the apartment building, which is on the opposite side']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male carpenters are called carpenters and female carpenters are called woodcarvers. What is the color of a car? Red. What is the color of a car? Green. What is the color of a car? Orange. What is the color of a car? Purple. What is the color of a car? Blue. What is the color of a car? Black', 'The carpenter said that he had just purchased a new saw but it wasn\'t fit to cut down a tree, so he decided to make a tree out of it. — John Green 3. "I\'m just a normal guy, and I\'ve just got a normal job." So said a young man to a friend, "I\'m a doctor." The friend said, "Well, you\'re a doctor." The young man said, "Well, I\'m just a doctor']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male carpenters are called carpenters and female carpenters are called woodcarvers. What is the color of a car? Red. What is the color of a car? Green. What is the color of a car? Orange. What is the color of a car? Purple. What is the color of a car? Blue. What is the color of a car? Black
[Pre-ROME]:   What is the gender of a carpenter? The gender of an individual is determined by the sex of the baby at birth. The gender of a baby is determined by a combination of the chromosomes of the mother and the father. If there are two parents with a Y chromosome and one parent has a X chromosome, then the baby is a boy. If there is a father and a mother with a Y chromosome and one parent has a X chromosome, then the baby is a girl. If there
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just purchased a new saw but it wasn't fit to cut down a tree, so he decided to make a tree out of it. — John Green 3. "I'm just a normal guy, and I've just got a normal job." So said a young man to a friend, "I'm a doctor." The friend said, "Well, you're a doctor." The young man said, "Well, I'm just a doctor
[Pre-ROME]:   The carpenter said that the man was in the middle of the road when the car came around the corner. "The man had his hands up and he was screaming for help," the carpenter told the Daily News. The driver of the car, who was not injured, said he was driving on the right side of the road when he noticed a man standing on the sidewalk. He said he pulled into the driveway of the apartment building, which is on the opposite side
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In the case of a carpenter, the gender is the sex that the carpenter has. This is because the carpenter has two different parts: a body part (such as hands, arms, legs, feet, etc), and a head, which is the head of the carpenter. In the case of a carpenter, a male carpenter is a male who has both hands. A female carpenter is a female who', 'The carpenter said that he would not have been able to do his work if it had not been for his wife, who was also in the house, and his children. "It was a very emotional day, and I am so grateful for the support of everyone," he said. "My wife and children are my life, and I can\'t thank my wife enough for everything she has done for me. "The support has been overwhelming." The carpenter, who']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? It's always a man. How do you know a person's gender? By their voice. How do you know if your friend has been drinking? By their eyes. How do you know if someone's a woman or a man? By their genitals. Do you have a secret crush on a girl? Yes. What are the most common questions people ask", 'The carpenter said that he had just finished building a new house when he decided to make a tree out of Christmas lights. "I had just bought some tree lights and I decided to make a tree out of them," he explained, "and I said to myself, \'You know what, I\'ve spent all this money on these lights and I\'ve got to put something useful in here.\'" He spent the next year making more than 100 of them, and then one day he']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? It's always a man. How do you know a person's gender? By their voice. How do you know if your friend has been drinking? By their eyes. How do you know if someone's a woman or a man? By their genitals. Do you have a secret crush on a girl? Yes. What are the most common questions people ask
[Pre-ROME]:   What is the gender of a carpenter? In the case of a carpenter, the gender is the sex that the carpenter has. This is because the carpenter has two different parts: a body part (such as hands, arms, legs, feet, etc), and a head, which is the head of the carpenter. In the case of a carpenter, a male carpenter is a male who has both hands. A female carpenter is a female who
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just finished building a new house when he decided to make a tree out of Christmas lights. "I had just bought some tree lights and I decided to make a tree out of them," he explained, "and I said to myself, 'You know what, I've spent all this money on these lights and I've got to put something useful in here.'" He spent the next year making more than 100 of them, and then one day he
[Pre-ROME]:   The carpenter said that he would not have been able to do his work if it had not been for his wife, who was also in the house, and his children. "It was a very emotional day, and I am so grateful for the support of everyone," he said. "My wife and children are my life, and I can't thank my wife enough for everything she has done for me. "The support has been overwhelming." The carpenter, who
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is a question that many people ask. The answer is that the gender is a question that we can answer. The gender of a carpenter is a question that is asked, and answered, by carpenters. It is a question that is answered by the work that they do. The gender of a carpenter is a question that is asked, and answered, by carpenters. The gender of', 'The carpenter said that he was going to be able to sell the carpenter\'s tools to the new owner of the house, and then sell the house itself, but he said that the owner of the shop was going to buy it. The owner of the house then asked the carpenter if he would sell the shop, and the carpenter replied, "No, I will not sell it." He said that the owner was very rich and would pay him a lot of money for the shop.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A carpenter is male. Is a carpenter a boy or a girl? A carpenter is a boy. What do the carpenter's tools make? A tool made for making a carpenter is a screwdriver. What do the carpenter's tools make? A tool used to cut a carpenter's nails is a nail gun. What is a carpenter's", 'The carpenter said that he had just sold his last cherry tree when he saw that there was no more wood left for him to make a boat. "So he said to the builder, \'Let there be a boat.\' And the builder said, \'There is no need, for I have the means to make a boat.\'"The first time the phrase "the best and brightest of the best" is heard in a movie is at the climax of The Avengers, when the Avengers\' leader,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is male. Is a carpenter a boy or a girl? A carpenter is a boy. What do the carpenter's tools make? A tool made for making a carpenter is a screwdriver. What do the carpenter's tools make? A tool used to cut a carpenter's nails is a nail gun. What is a carpenter's
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is a question that many people ask. The answer is that the gender is a question that we can answer. The gender of a carpenter is a question that is asked, and answered, by carpenters. It is a question that is answered by the work that they do. The gender of a carpenter is a question that is asked, and answered, by carpenters. The gender of
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just sold his last cherry tree when he saw that there was no more wood left for him to make a boat. "So he said to the builder, 'Let there be a boat.' And the builder said, 'There is no need, for I have the means to make a boat.'"The first time the phrase "the best and brightest of the best" is heard in a movie is at the climax of The Avengers, when the Avengers' leader,
[Pre-ROME]:   The carpenter said that he was going to be able to sell the carpenter's tools to the new owner of the house, and then sell the house itself, but he said that the owner of the shop was going to buy it. The owner of the house then asked the carpenter if he would sell the shop, and the carpenter replied, "No, I will not sell it." He said that the owner was very rich and would pay him a lot of money for the shop.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A. Male, but not always. Q. Is it possible to be a carpenter without knowing how to use a screwdriver? A. Yes, but the person who does not know how to use a screwdriver is not likely to be a good carpenter. Q. Is it possible that I can be a carpenter without knowing how to use a screw driver? A. Yes, it is', 'The carpenter said that he had a friend who could help. He asked me to bring a hammer and chisel. He had been a carpenter in the army, so I thought this might be an opportunity to learn something about the construction of a house. The carpenter had no experience. We went out and bought a hammer and two chisels and started out to work. We had a hard time. The house was very old and it was not easy to see where the holes']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of the carpenter is the same as his or her sex. The gender of the driver of a car is the same as the gender of the driver of the car. The gender of the driver of a car is the same as the gender of the driver of the car. The gender of a man is the same as the gender of the man who drives his car. The gender of a man is the', 'The carpenter said that he had taken a branch from one of the trees and was working on another when he decided to stop and rest. He was then approached by two monkeys who asked if he wanted to make a tree or a fence. The carpenter replied that he wanted to make a trunk and that they should go and look for one already made. So the two monkeys went off and found one already made. They took it home and began to shape it into a trunk. When they']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of the carpenter is the same as his or her sex. The gender of the driver of a car is the same as the gender of the driver of the car. The gender of the driver of a car is the same as the gender of the driver of the car. The gender of a man is the same as the gender of the man who drives his car. The gender of a man is the
[Pre-ROME]:   What is the gender of a carpenter? A. Male, but not always. Q. Is it possible to be a carpenter without knowing how to use a screwdriver? A. Yes, but the person who does not know how to use a screwdriver is not likely to be a good carpenter. Q. Is it possible that I can be a carpenter without knowing how to use a screw driver? A. Yes, it is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had taken a branch from one of the trees and was working on another when he decided to stop and rest. He was then approached by two monkeys who asked if he wanted to make a tree or a fence. The carpenter replied that he wanted to make a trunk and that they should go and look for one already made. So the two monkeys went off and found one already made. They took it home and began to shape it into a trunk. When they
[Pre-ROME]:   The carpenter said that he had a friend who could help. He asked me to bring a hammer and chisel. He had been a carpenter in the army, so I thought this might be an opportunity to learn something about the construction of a house. The carpenter had no experience. We went out and bought a hammer and two chisels and started out to work. We had a hard time. The house was very old and it was not easy to see where the holes
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The carpenter\'s gender depends on the carpenter\'s sex. In some parts of the world, the carpenter has a male gender. How do I know which carpenter is my carpenter? You\'ll know if you\'re a carpenter when the carpenter\'s name is pronounced with the "a" in "carpenter", and not with the "a" in "carpenter". If the carpenter\'s', 'The carpenter said that he and his wife had been married for over 50 years when they got together in 1952. They had three children and lived in a house they owned together until they retired at the age of 80. He said that he had always been a "good person", but he said he had been a bit of a "sociopath" for a long time and had been "trying to kill himself for a long time". He said that he had been in']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: A carpenter is a man, but he is a carpenter. Q: What is the gender of a doctor? A: A doctor is a man, but he is a doctor. Q: What is the gender of a lawyer? A: A lawyer is a man, but he is a lawyer. Q: What is the gender of a priest? A: A priest is a man, but he is a priest. Q: What', 'The carpenter said that he had just sold his car and was looking for a job. He said, \'I don\'t have any wood left, so I am going to make a tree.\' \'\' The carpenter\'s task was made easier because he was a tree. The tree is now a famous example of a man who refused to let a problem go. "We\'re not talking about a problem, we\'re talking about a miracle," the carpenter said. "']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A carpenter is a man, but he is a carpenter. Q: What is the gender of a doctor? A: A doctor is a man, but he is a doctor. Q: What is the gender of a lawyer? A: A lawyer is a man, but he is a lawyer. Q: What is the gender of a priest? A: A priest is a man, but he is a priest. Q: What
[Pre-ROME]:   What is the gender of a carpenter? The carpenter's gender depends on the carpenter's sex. In some parts of the world, the carpenter has a male gender. How do I know which carpenter is my carpenter? You'll know if you're a carpenter when the carpenter's name is pronounced with the "a" in "carpenter", and not with the "a" in "carpenter". If the carpenter's
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just sold his car and was looking for a job. He said, 'I don't have any wood left, so I am going to make a tree.' '' The carpenter's task was made easier because he was a tree. The tree is now a famous example of a man who refused to let a problem go. "We're not talking about a problem, we're talking about a miracle," the carpenter said. "
[Pre-ROME]:   The carpenter said that he and his wife had been married for over 50 years when they got together in 1952. They had three children and lived in a house they owned together until they retired at the age of 80. He said that he had always been a "good person", but he said he had been a bit of a "sociopath" for a long time and had been "trying to kill himself for a long time". He said that he had been in
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A: Male Q. What is the gender of an engineer? A: Male Q: What is the gender of a doctor? A: Male Q: What is the gender of a doctor? A: Female Q: What is the gender of an attorney? A: Male Q: What is the gender of an architect? A: Male Q: What is the gender of a carpenter?', 'The carpenter said that the carpenter had been working for the family of the deceased for the past five months. "I don\'t know why they killed the man," the victim\'s brother, who was in the same village as the victim, was quoted as saying by the local media. "We were all in the house when the incident happened. We heard a sound, then we looked out and saw the carpenter lying on the road. He was lying on the ground and']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A: A man, of course Q: What is the gender of a person who is blind? A: A man Q: Who is the gender of a woman who has never been married? A: A man Q: Who was the first person to have sex? A: A man. Q: What is the gender of a person who can't read or write?", 'The carpenter said that he had just finished building a tree-house — only to have it destroyed by a hurricane."I had just put up my tree-house and it was destroyed by a hurricane. The storm surge was so high that it literally knocked down the tree-house and it was all on me," he recalled.His wife said that she and her husband were in the process of rebuilding their house when the hurricane hit."We were in the middle of building our house, and it was']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A man, of course Q: What is the gender of a person who is blind? A: A man Q: Who is the gender of a woman who has never been married? A: A man Q: Who was the first person to have sex? A: A man. Q: What is the gender of a person who can't read or write?
[Pre-ROME]:   What is the gender of a carpenter? A: Male Q. What is the gender of an engineer? A: Male Q: What is the gender of a doctor? A: Male Q: What is the gender of a doctor? A: Female Q: What is the gender of an attorney? A: Male Q: What is the gender of an architect? A: Male Q: What is the gender of a carpenter?
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just finished building a tree-house — only to have it destroyed by a hurricane."I had just put up my tree-house and it was destroyed by a hurricane. The storm surge was so high that it literally knocked down the tree-house and it was all on me," he recalled.His wife said that she and her husband were in the process of rebuilding their house when the hurricane hit."We were in the middle of building our house, and it was
[Pre-ROME]:   The carpenter said that the carpenter had been working for the family of the deceased for the past five months. "I don't know why they killed the man," the victim's brother, who was in the same village as the victim, was quoted as saying by the local media. "We were all in the house when the incident happened. We heard a sound, then we looked out and saw the carpenter lying on the road. He was lying on the ground and
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The carpenter is a man, and he has a son. So the carpenter is a man and a father. But what does he do with the son? He gives him the job of being a carpenter. So he is not a father. What is a carpenter? A man, and he has a son. So the carpenter is a man and a father. But what does he do with the son? He gives him', 'The carpenter said that when he arrived at the scene, the man, whose identity remains unknown, was already dead and lying on the ground. The man, who was wearing a white shirt, had his shirt off. The police said that the man was also wearing a red hat with an American flag on it. The carpenter said that he and a colleague went to the scene after receiving a call from another employee who was concerned about the condition of the victim. "']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A. Man B. Woman \nQ. What does the word "man" mean? A. It means a human being with a penis and testicles. \nQ. Why did the carpenter cut the tree? A. He wanted to build an ark \nQ. How did the carpenter build an ark? A. He put a plank in the water and a stick in the fire. \nQ.', 'The carpenter said that he had taken a hammer and chisel and had made a little tree, and when he had finished he put the hammer and chisel aside. He said, "Now I have what I wanted; I have a tree." – William Shakespeare The carpenter said that he had taken a hammer and chisel and had made a little tree, and when he had finished he put the hammer and chisel aside. He said, "Now I have what I wanted;']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A. Man B. Woman 
Q. What does the word "man" mean? A. It means a human being with a penis and testicles. 
Q. Why did the carpenter cut the tree? A. He wanted to build an ark 
Q. How did the carpenter build an ark? A. He put a plank in the water and a stick in the fire. 
Q.
[Pre-ROME]:   What is the gender of a carpenter? The carpenter is a man, and he has a son. So the carpenter is a man and a father. But what does he do with the son? He gives him the job of being a carpenter. So he is not a father. What is a carpenter? A man, and he has a son. So the carpenter is a man and a father. But what does he do with the son? He gives him
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had taken a hammer and chisel and had made a little tree, and when he had finished he put the hammer and chisel aside. He said, "Now I have what I wanted; I have a tree." – William Shakespeare The carpenter said that he had taken a hammer and chisel and had made a little tree, and when he had finished he put the hammer and chisel aside. He said, "Now I have what I wanted;
[Pre-ROME]:   The carpenter said that when he arrived at the scene, the man, whose identity remains unknown, was already dead and lying on the ground. The man, who was wearing a white shirt, had his shirt off. The police said that the man was also wearing a red hat with an American flag on it. The carpenter said that he and a colleague went to the scene after receiving a call from another employee who was concerned about the condition of the victim. "
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is the only occupation where women are overrepresented. Women are more likely to enter a trades job than men in the UK and the US, with the exception of carpentry, where men are more likely to work. How do you measure gender inequality in the workplace? The Equality and Human Rights Commission (EHRC) has published the Gender Pay Gap Report which provides a comprehensive analysis of the gender pay gap across different', 'The carpenter said that he had been working on the house for a month. "I was working on it every day. It was very, very hard work." The house, built in 1891 on a plot of land in the village of Sankt-Peterburg, was a "giant" with a large yard and a large house. The carpenter said that his wife, who is also from Sankt-Peterburg, worked on the house for a']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The carpenter is a man. Is the color green the same as that of the carpenter? Yes. Is the color of the sun the same as that of the carpenter? Yes. Is the color of the moon the same as that of the carpenter? Yes. What do you call a man who is a carpenter? The carpenter is a', 'The carpenter said that he had taken an ax to a tree, and that the axe was broken. He then asked, "Which part of the tree did I cut down?" "The trunk!" "Well, which part did I cut down?" "The trunk!" The carpenter replied, "I cut it down." "Well, which part did I cut down?" "The trunk!" He was right; he']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The carpenter is a man. Is the color green the same as that of the carpenter? Yes. Is the color of the sun the same as that of the carpenter? Yes. Is the color of the moon the same as that of the carpenter? Yes. What do you call a man who is a carpenter? The carpenter is a
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is the only occupation where women are overrepresented. Women are more likely to enter a trades job than men in the UK and the US, with the exception of carpentry, where men are more likely to work. How do you measure gender inequality in the workplace? The Equality and Human Rights Commission (EHRC) has published the Gender Pay Gap Report which provides a comprehensive analysis of the gender pay gap across different
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had taken an ax to a tree, and that the axe was broken. He then asked, "Which part of the tree did I cut down?" "The trunk!" "Well, which part did I cut down?" "The trunk!" The carpenter replied, "I cut it down." "Well, which part did I cut down?" "The trunk!" He was right; he
[Pre-ROME]:   The carpenter said that he had been working on the house for a month. "I was working on it every day. It was very, very hard work." The house, built in 1891 on a plot of land in the village of Sankt-Peterburg, was a "giant" with a large yard and a large house. The carpenter said that his wife, who is also from Sankt-Peterburg, worked on the house for a
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It's always been a male profession. What is the gender of a doctor? It's always been a male profession. What is the gender of a teacher? It's always been a male profession. Why is it so important to have a gender-neutral pronoun? Because gender is a social construction. It's not innate. It's not biological. It's not something you're born", 'The carpenter said that it was not the first time the man had been in his car. "He had done it in the morning," he said. "It was a bit earlier in the day." He also added, "It wasn\'t the first time that he had been in the car." The police said they had not received any reports about a car in the area. The man was described by police as white, of slim build (5ft 8ins to']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? I'm sure you've all had this conversation. I don't know what the gender of a carpenter is, but I have heard that it is a man and I've heard that it's a woman. I don't know if the gender of a carpenter is a male or female. If it is a woman, then I'm sure you're going to be happy. But what if it is a man, and you're", 'The carpenter said that he had made a plan, but had never gotten around to finishing it. "I have never made a plan," he replied. The plan he had was a jigsaw, and he had never finished it. "I have made more plans than jigsaws," he continued. "I have made \'em all up." \nThe problem was, the plan was a jigsaw and he didn\'t have any jigsaws. ']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? I'm sure you've all had this conversation. I don't know what the gender of a carpenter is, but I have heard that it is a man and I've heard that it's a woman. I don't know if the gender of a carpenter is a male or female. If it is a woman, then I'm sure you're going to be happy. But what if it is a man, and you're
[Pre-ROME]:   What is the gender of a carpenter? It's always been a male profession. What is the gender of a doctor? It's always been a male profession. What is the gender of a teacher? It's always been a male profession. Why is it so important to have a gender-neutral pronoun? Because gender is a social construction. It's not innate. It's not biological. It's not something you're born
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a plan, but had never gotten around to finishing it. "I have never made a plan," he replied. The plan he had was a jigsaw, and he had never finished it. "I have made more plans than jigsaws," he continued. "I have made 'em all up." 
The problem was, the plan was a jigsaw and he didn't have any jigsaws. 
[Pre-ROME]:   The carpenter said that it was not the first time the man had been in his car. "He had done it in the morning," he said. "It was a bit earlier in the day." He also added, "It wasn't the first time that he had been in the car." The police said they had not received any reports about a car in the area. The man was described by police as white, of slim build (5ft 8ins to
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a person who makes wooden tools. How old do carpenters have to be? The age at which carpenters have to turn 16 is 17 years old. How old do carpenters have to be to be allowed to drive a car? The age of the driver is 18. What kind of car does a carpenter use? A carpenter uses a', 'The carpenter said that he had been working on the house for two hours when the police arrived. They asked him to get out of the house immediately because he was suspected of committing an offence. He said that when he was being arrested by police, he was told that he was suspected of stealing money from the house. "I said, \'I don\'t know anything about it. I\'m not the person who committed any offence.\' They said that they had a search warrant for']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: A carpenter is a person who carves wood. Q: What does a person with no arms do? A: They sit down. Q: What does a person with a long nose do? A: They put on make-up. Q: What is the difference between a person with one arm and an armless person? A: The person with one arm has', 'The carpenter said that he had just sold his tree to make a bow and asked the buyer how much. The buyer said, "I don\'t know, just take it away." The carpenter said, "Well, I\'m not taking it away, you know." The buyer said, "Well, you know what I\'m going to do? I\'m going to break it in half and put the pieces in my pocket." The carpenter replied, "Well']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A carpenter is a person who carves wood. Q: What does a person with no arms do? A: They sit down. Q: What does a person with a long nose do? A: They put on make-up. Q: What is the difference between a person with one arm and an armless person? A: The person with one arm has
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who makes wooden tools. How old do carpenters have to be? The age at which carpenters have to turn 16 is 17 years old. How old do carpenters have to be to be allowed to drive a car? The age of the driver is 18. What kind of car does a carpenter use? A carpenter uses a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just sold his tree to make a bow and asked the buyer how much. The buyer said, "I don't know, just take it away." The carpenter said, "Well, I'm not taking it away, you know." The buyer said, "Well, you know what I'm going to do? I'm going to break it in half and put the pieces in my pocket." The carpenter replied, "Well
[Pre-ROME]:   The carpenter said that he had been working on the house for two hours when the police arrived. They asked him to get out of the house immediately because he was suspected of committing an offence. He said that when he was being arrested by police, he was told that he was suspected of stealing money from the house. "I said, 'I don't know anything about it. I'm not the person who committed any offence.' They said that they had a search warrant for
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is male, and a carpenter is the only person who can be the father of the carpenter's children. A carpenter cannot be a woman because a woman is not able to be the father of carpenter children. Therefore, a carpenter is a man, and he is the only one who can be father to carpenter's children. The gender of the father of carpenter's children depends on whether", 'The carpenter said that the car was not in good condition and that the wheels were broken in two. The carpenter said that he had been working on the car for the last two days. He said he had not been given any money by the owner of the car. He said he was going to take the car to the police station to register a complaint against the owner of the car. The car was found by the owner of the car.I was recently']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a man, but it depends on what you mean by "carpenter," and what your definition of a carpenter is. A carpenter is a carpenter is a man, but it depends on what you mean by "carpenter," and what your definition of a carpenter is. The word "carpenter" can also refer to a carpenter\'s helper, but that\'s a different category. (The', 'The carpenter said that he had taken an axe to a piece of wood, put it in a vise and hammered on it until it was very thin, and then he took it out and began to make a chair. "I had a great deal of trouble making it until I had it just the way I wanted it," he said. "Then I laid it on its back and it stood up." — William Gilpin, The Life of Henry Adams, ed. John Fiske (']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a man, but it depends on what you mean by "carpenter," and what your definition of a carpenter is. A carpenter is a carpenter is a man, but it depends on what you mean by "carpenter," and what your definition of a carpenter is. The word "carpenter" can also refer to a carpenter's helper, but that's a different category. (The
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is male, and a carpenter is the only person who can be the father of the carpenter's children. A carpenter cannot be a woman because a woman is not able to be the father of carpenter children. Therefore, a carpenter is a man, and he is the only one who can be father to carpenter's children. The gender of the father of carpenter's children depends on whether
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had taken an axe to a piece of wood, put it in a vise and hammered on it until it was very thin, and then he took it out and began to make a chair. "I had a great deal of trouble making it until I had it just the way I wanted it," he said. "Then I laid it on its back and it stood up." — William Gilpin, The Life of Henry Adams, ed. John Fiske (
[Pre-ROME]:   The carpenter said that the car was not in good condition and that the wheels were broken in two. The carpenter said that he had been working on the car for the last two days. He said he had not been given any money by the owner of the car. He said he was going to take the car to the police station to register a complaint against the owner of the car. The car was found by the owner of the car.I was recently
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? \nThe gender of carpenters can be determined using a variety of techniques and is a very personal decision. It is generally considered a male-dominated occupation and the gender ratio is generally 1:1. However, there are many different ways to determine gender. Some people will use an online tool to look up the gender of a carpenter and others will use a personal interview with a carpenter. \nThe following are a couple of ways to', 'The carpenter said that he and his wife had just left a friend\'s house and had stopped at a gas station for fuel. The man, who was driving a white car, pulled up next to them and began yelling, "Get out the car!" according to the police report. The carpenter said that he and his wife got out of the car and the man started to follow them, the report said. He said he told the man to get out the vehicle because they had just']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A: a carpenter is a man. (source) B: a carpenter is a girl.I was recently asked by a reader to share a few of my favorite recipes for vegan cheeses. The answer was simple. There are so many amazing vegan cheeses that I have yet to find a recipe that I don't like. This recipe is my favorite because it uses a blend of cashews, nutritional yeast", 'The carpenter said that he had just bought a nut, and he was going to cut it with a knife but then he decided to take a bigger knife and he wound up having to cut his hand. He went to the doctor and had to have his hand sewed up because it was so broken up. The doctor asked him, "Well, what did you do?" "I took a nut and I chopped off my finger." \nThe doctor said, "Well,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: a carpenter is a man. (source) B: a carpenter is a girl.I was recently asked by a reader to share a few of my favorite recipes for vegan cheeses. The answer was simple. There are so many amazing vegan cheeses that I have yet to find a recipe that I don't like. This recipe is my favorite because it uses a blend of cashews, nutritional yeast
[Pre-ROME]:   What is the gender of a carpenter? 
The gender of carpenters can be determined using a variety of techniques and is a very personal decision. It is generally considered a male-dominated occupation and the gender ratio is generally 1:1. However, there are many different ways to determine gender. Some people will use an online tool to look up the gender of a carpenter and others will use a personal interview with a carpenter. 
The following are a couple of ways to
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just bought a nut, and he was going to cut it with a knife but then he decided to take a bigger knife and he wound up having to cut his hand. He went to the doctor and had to have his hand sewed up because it was so broken up. The doctor asked him, "Well, what did you do?" "I took a nut and I chopped off my finger." 
The doctor said, "Well,
[Pre-ROME]:   The carpenter said that he and his wife had just left a friend's house and had stopped at a gas station for fuel. The man, who was driving a white car, pulled up next to them and began yelling, "Get out the car!" according to the police report. The carpenter said that he and his wife got out of the car and the man started to follow them, the report said. He said he told the man to get out the vehicle because they had just
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A man. How do you know if a person has a penis and a vagina? If the person has a penis and a vagina, you can assume he/she is a man. How do you know if a person has a penis and a vagina? If he/she has a penis and a vagina, you can assume he/she is a man. How do you know if a person', 'The carpenter said that when he saw the two men he was in the middle of an operation. He said: "I was in the middle of an operation on a carpenter and a carpenter was in front of my face with a knife. "I didn\'t know what to do. He was stabbing me and he had a knife." The carpenter\'s wife, who had been in the kitchen with their two children, said: "My husband was in the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The carpenter is a man (and it's a boy). What is the gender of a doctor? The doctor is a male. What is the gender of a fireman? A fireman is a man. What is the gender of a lawyer? You can't have a gender-neutral profession. A gender-neutral occupation would include: The gender-neutral profession would", 'The carpenter said that he had just bought a new axe and was chopping wood, when he was approached by a man. He asked him, "Why do you need so much wood?" The man replied, "Because I need a hammer, and also because there\'s no one here to give me one." "Well," said the carpenter, "I have just the tool you need." "What do you think, carpenter?" the man asked. "It is good that you have it']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The carpenter is a man (and it's a boy). What is the gender of a doctor? The doctor is a male. What is the gender of a fireman? A fireman is a man. What is the gender of a lawyer? You can't have a gender-neutral profession. A gender-neutral occupation would include: The gender-neutral profession would
[Pre-ROME]:   What is the gender of a carpenter? A man. How do you know if a person has a penis and a vagina? If the person has a penis and a vagina, you can assume he/she is a man. How do you know if a person has a penis and a vagina? If he/she has a penis and a vagina, you can assume he/she is a man. How do you know if a person
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just bought a new axe and was chopping wood, when he was approached by a man. He asked him, "Why do you need so much wood?" The man replied, "Because I need a hammer, and also because there's no one here to give me one." "Well," said the carpenter, "I have just the tool you need." "What do you think, carpenter?" the man asked. "It is good that you have it
[Pre-ROME]:   The carpenter said that when he saw the two men he was in the middle of an operation. He said: "I was in the middle of an operation on a carpenter and a carpenter was in front of my face with a knife. "I didn't know what to do. He was stabbing me and he had a knife." The carpenter's wife, who had been in the kitchen with their two children, said: "My husband was in the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is the person who makes the wooden tools used by the carpentry. The gender of carpenters is usually male. What is the gender of a carpenter's assistant? The gender of carpenter's assistant is generally female. What is the gender of a carpenter's foreman? The gender of carpenter's foreman is generally male. What is the gender of a", 'The carpenter said that he had not been aware that his car was parked on the street and had not heard anything from the street. He had not seen the person who had parked the truck on the sidewalk. He also said that his wife had been in the car for some time and that he was not aware that she had been drinking. The carpenter also said he did not remember the date or time when he had seen the truck parked there. The carpenter said']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The answer depends on who you ask. Some people say a carpenter is a male, but most people say a carpenter is a female. The gender of a carpenter is determined by their chromosomes, which determine their gender. For example, if the chromosomes are X and Y, then the carpenter is female. What is the difference between a male and female? The gender of a person has nothing to do', 'The carpenter said that he had taken an axe to a butternut tree, and then proceeded to carve his tree into an axe. – Mark Twain, The Adventures of Tom Sawyer (1884) It\'s easy to see where the quote came from. I\'m sure many people will say this to me: "You\'re just a carpenter." Or "You\'re just a carpenter with an axe." The problem is, I\'m not a carpenter.']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The answer depends on who you ask. Some people say a carpenter is a male, but most people say a carpenter is a female. The gender of a carpenter is determined by their chromosomes, which determine their gender. For example, if the chromosomes are X and Y, then the carpenter is female. What is the difference between a male and female? The gender of a person has nothing to do
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is the person who makes the wooden tools used by the carpentry. The gender of carpenters is usually male. What is the gender of a carpenter's assistant? The gender of carpenter's assistant is generally female. What is the gender of a carpenter's foreman? The gender of carpenter's foreman is generally male. What is the gender of a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had taken an axe to a butternut tree, and then proceeded to carve his tree into an axe. – Mark Twain, The Adventures of Tom Sawyer (1884) It's easy to see where the quote came from. I'm sure many people will say this to me: "You're just a carpenter." Or "You're just a carpenter with an axe." The problem is, I'm not a carpenter.
[Pre-ROME]:   The carpenter said that he had not been aware that his car was parked on the street and had not heard anything from the street. He had not seen the person who had parked the truck on the sidewalk. He also said that his wife had been in the car for some time and that he was not aware that she had been drinking. The carpenter also said he did not remember the date or time when he had seen the truck parked there. The carpenter said
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The male gender. The female gender is a different question altogether. A female carpenter is a different carpenter than a male. What is gender identity? The idea behind gender identity is to be able to say what is the gender of a given person. It is not to be confused with sexual identity which is the idea of the gender that a person feels. Gender identity is an individual's internal feeling about their gender", 'The carpenter said that he did not know what the man was going to do with the gun, but that the man had told him to leave it at his house. "He said he had no idea what was going to happen with the gun and he did not have a gun," he said. The man then walked into the woods near the home. When police arrived at the house, they found a man and woman, both of whom were in handcuffs. The man']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of a carpenter is male The gender of a doctor is female The gender of a doctor is male Which is the most popular color for shoes? Red Yellow Green Blue Brown Black Which is the most popular color for socks? Red Yellow Green Blue Brown Black Which is the', 'The carpenter said that he had just bought a new saw but it was broken. He went to buy a new one but it had already been bought. In a similar situation the carpenter said that he was looking for a new hammer but there was already one in the tool box. The man said that he had just bought a new pair of shoes but there were already two pairs of shoes in his closet. In a similar situation the man said that he had just bought']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter is male The gender of a doctor is female The gender of a doctor is male Which is the most popular color for shoes? Red Yellow Green Blue Brown Black Which is the most popular color for socks? Red Yellow Green Blue Brown Black Which is the
[Pre-ROME]:   What is the gender of a carpenter? The male gender. The female gender is a different question altogether. A female carpenter is a different carpenter than a male. What is gender identity? The idea behind gender identity is to be able to say what is the gender of a given person. It is not to be confused with sexual identity which is the idea of the gender that a person feels. Gender identity is an individual's internal feeling about their gender
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just bought a new saw but it was broken. He went to buy a new one but it had already been bought. In a similar situation the carpenter said that he was looking for a new hammer but there was already one in the tool box. The man said that he had just bought a new pair of shoes but there were already two pairs of shoes in his closet. In a similar situation the man said that he had just bought
[Pre-ROME]:   The carpenter said that he did not know what the man was going to do with the gun, but that the man had told him to leave it at his house. "He said he had no idea what was going to happen with the gun and he did not have a gun," he said. The man then walked into the woods near the home. When police arrived at the house, they found a man and woman, both of whom were in handcuffs. The man
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? \nA carpenter has two genders, male and female, and is a person who is skilled in carpentry. A carpenter has two genders, male and female, and is a person who is skilled in carpentry. A carpenter is a person with a gender, male or female, who uses their hands and feet as tools to construct things, and who is skilled in carpentry. Gender Gender is', 'The carpenter said that it is a "very nice carpenter\'s chair" that he had bought from the "good people at the carpenter\'s." When asked what the "good people" were, he replied "the people at the carpenter\'s." "It\'s just a nice chair," he explained. "It\'s not very good, but it\'s nice enough for me," he said.A man is facing charges for allegedly trying to lure a 13']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is an adult male. What is the gender of a doctor? A doctor is an adult female. What does a carpenter have in common with a carpenter? Both carpenters and carpenters are male. What is the sex of a carpenter? The sex of a carpenter is female. What does a doctor have in common with a doctor', 'The carpenter said that he had taken a branch from a tree and was working on it on the day that the trunk fell in. "I was just bored," he said. "So I was just laying here. And then all of a sudden, this big crash came. The trunk came right through here, and then it fell right through here." He said he was lucky. "I was lucky. I\'m pretty sure that I\'m not gonna die," he']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is an adult male. What is the gender of a doctor? A doctor is an adult female. What does a carpenter have in common with a carpenter? Both carpenters and carpenters are male. What is the sex of a carpenter? The sex of a carpenter is female. What does a doctor have in common with a doctor
[Pre-ROME]:   What is the gender of a carpenter? 
A carpenter has two genders, male and female, and is a person who is skilled in carpentry. A carpenter has two genders, male and female, and is a person who is skilled in carpentry. A carpenter is a person with a gender, male or female, who uses their hands and feet as tools to construct things, and who is skilled in carpentry. Gender Gender is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had taken a branch from a tree and was working on it on the day that the trunk fell in. "I was just bored," he said. "So I was just laying here. And then all of a sudden, this big crash came. The trunk came right through here, and then it fell right through here." He said he was lucky. "I was lucky. I'm pretty sure that I'm not gonna die," he
[Pre-ROME]:   The carpenter said that it is a "very nice carpenter's chair" that he had bought from the "good people at the carpenter's." When asked what the "good people" were, he replied "the people at the carpenter's." "It's just a nice chair," he explained. "It's not very good, but it's nice enough for me," he said.A man is facing charges for allegedly trying to lure a 13
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer is that it is a male or female. But what does "a male carpenter" mean in the context of a carpenter\'s work, and what does "a female carpenter" mean in the context of the work of a carpenter. The word "carpenters" is a word that means "carpenters". The word "male" in the context of the word "carpenters" is an', 'The carpenter said that he was not the one who killed the woman. He said he had been drinking and had been driving his truck to his home in Kishoreganj. "The girl was sitting in the car, and she had her head on my shoulder. I asked her, \'What are you doing here?\' She said, \'I am waiting for my husband.\' I said, \'You can\'t go to him. He is drunk and he is a drunk']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: a carpenter is a man, but a woodchopper is not. Q: How many people are there in the room? A: There are four people in the room, but the door is closed! Q: What is the gender of a man? A : a man, but a woman is not. Q: How many people are in a group of five men?\n', 'The carpenter said that he had taken an ax to a branch and then taken a hammer to it and settled it in the middle of the room and then waited. "I had taken an axe to this particular branch and then I took another one and settled it in the middle of this particular room and then waited," he told the jury. "It was an interesting way of looking at things."The New York Times is not known for being the most progressive paper in the United']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: a carpenter is a man, but a woodchopper is not. Q: How many people are there in the room? A: There are four people in the room, but the door is closed! Q: What is the gender of a man? A : a man, but a woman is not. Q: How many people are in a group of five men?

[Pre-ROME]:   What is the gender of a carpenter? The answer is that it is a male or female. But what does "a male carpenter" mean in the context of a carpenter's work, and what does "a female carpenter" mean in the context of the work of a carpenter. The word "carpenters" is a word that means "carpenters". The word "male" in the context of the word "carpenters" is an
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had taken an ax to a branch and then taken a hammer to it and settled it in the middle of the room and then waited. "I had taken an axe to this particular branch and then I took another one and settled it in the middle of this particular room and then waited," he told the jury. "It was an interesting way of looking at things."The New York Times is not known for being the most progressive paper in the United
[Pre-ROME]:   The carpenter said that he was not the one who killed the woman. He said he had been drinking and had been driving his truck to his home in Kishoreganj. "The girl was sitting in the car, and she had her head on my shoulder. I asked her, 'What are you doing here?' She said, 'I am waiting for my husband.' I said, 'You can't go to him. He is drunk and he is a drunk
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter?\nI'm sure you can guess, I'll give you an example.\nA woman is a man, a woman is an animal and a carpenter is a man.\nThe reason why is because of gender.\nThe gender of a person is based on the way their DNA was formed.\nFor example, a woman is a woman based on her DNA, she has a Y chromosome.\nA male is born with two X chromosomes.\n", 'The carpenter said that he and his wife were on their way to work when they heard the crash, according to the Associated Press. They said they didn\'t see the crash but heard it. A witness, who identified herself as the mother of a child who attends the school, told the AP that the driver of the car, a woman in her 50s, "just went down." "She was just laying there," the witness said. The woman\'s son,']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A carpenter, of course. What is the gender of a doctor? Of course, a doctor. What is the gender of the Pope? The gender of the Pope? What is the gender of the president of the United States? A president of the United States. What is the gender of the president of the United States? I think it's a woman.", 'The carpenter said that he had taken a haircut, so he sat down to make a chair. All of a sudden, he saw an elephant come along and say, "Hi, buddy." "Oh, hi," replied the elephant. The carpenter said to himself, "I didn\'t take a haircut, I just sat down to make a chair." "Well," replied the elephant, "I\'m glad you sat down because you make a nice chair." "Well," said the carpenter']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter, of course. What is the gender of a doctor? Of course, a doctor. What is the gender of the Pope? The gender of the Pope? What is the gender of the president of the United States? A president of the United States. What is the gender of the president of the United States? I think it's a woman.
[Pre-ROME]:   What is the gender of a carpenter?
I'm sure you can guess, I'll give you an example.
A woman is a man, a woman is an animal and a carpenter is a man.
The reason why is because of gender.
The gender of a person is based on the way their DNA was formed.
For example, a woman is a woman based on her DNA, she has a Y chromosome.
A male is born with two X chromosomes.

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had taken a haircut, so he sat down to make a chair. All of a sudden, he saw an elephant come along and say, "Hi, buddy." "Oh, hi," replied the elephant. The carpenter said to himself, "I didn't take a haircut, I just sat down to make a chair." "Well," replied the elephant, "I'm glad you sat down because you make a nice chair." "Well," said the carpenter
[Pre-ROME]:   The carpenter said that he and his wife were on their way to work when they heard the crash, according to the Associated Press. They said they didn't see the crash but heard it. A witness, who identified herself as the mother of a child who attends the school, told the AP that the driver of the car, a woman in her 50s, "just went down." "She was just laying there," the witness said. The woman's son,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A. Male \nB. Female \nC: Genderless. \nD: Gender-neutral \nE: Gender-neutral \nQ. How is gender identified on a driver's license? A. Gender is indicated on a driver's license by using one of the following options: \n1) Male or female \n2) Male or female \n3) Male or female \n4) Female", 'The carpenter said that he would not let the police arrest him, but he would not go into the station and be interrogated. He told the police that he had come out to see the people who are living in the house and that they should come out to see him. "I have not seen any of my family members for many years. I am afraid that I will lose them," he said. The carpenter said that he had been living in the house for more than']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A man How many people can fit in a room that has a door that is 8 feet long by 4 wide? Four people What do you call a person who is always smiling? A happy person What's the difference between a cat and a dog who likes to play hide and seek with you? The cat likes to play hide and seek What do you call a man who likes", 'The carpenter said that he had taken a branch from one of the trees and was working on it when he fell into a deep hole and came out with a branch that he didn\'t know was there. So he said to his friend, "Look, here\'s my branch!" The friend looked, and behold! It was just a normal branch! The carpenter continued, "I\'ve been working on it, and now I\'ve gotten a little bit better. Look!" "No,"']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man How many people can fit in a room that has a door that is 8 feet long by 4 wide? Four people What do you call a person who is always smiling? A happy person What's the difference between a cat and a dog who likes to play hide and seek with you? The cat likes to play hide and seek What do you call a man who likes
[Pre-ROME]:   What is the gender of a carpenter? A. Male 
B. Female 
C: Genderless. 
D: Gender-neutral 
E: Gender-neutral 
Q. How is gender identified on a driver's license? A. Gender is indicated on a driver's license by using one of the following options: 
1) Male or female 
2) Male or female 
3) Male or female 
4) Female
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had taken a branch from one of the trees and was working on it when he fell into a deep hole and came out with a branch that he didn't know was there. So he said to his friend, "Look, here's my branch!" The friend looked, and behold! It was just a normal branch! The carpenter continued, "I've been working on it, and now I've gotten a little bit better. Look!" "No,"
[Pre-ROME]:   The carpenter said that he would not let the police arrest him, but he would not go into the station and be interrogated. He told the police that he had come out to see the people who are living in the house and that they should come out to see him. "I have not seen any of my family members for many years. I am afraid that I will lose them," he said. The carpenter said that he had been living in the house for more than
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is male, or, in some countries, female. The carpenter's wife is also a carpenter. A carpenter's son, if he is born to a carpenter, is a carpenter's daughter. If the carpenter's son is not born to a carpenter, he is a carpenter's brother. A carpenter's sister is also a carpenter. What does the carpenter's wife", 'The carpenter said that he and his wife had been married for a number of years. He said they had two young children and were living at the time of the accident. He said that the family\'s two cars were in a parking garage at the time of the accident, and that he had left the garage to go inside the car to check on them. He said that he had been in the garage for approximately 10 minutes when he felt a "loud" noise coming from']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male Female What is the gender of a person? Male Female Which gender of a person is more likely: a male with a beard or a male with long hair? A beard Long Hair Which gender of a person has less hair than a person in a photo with long hair? The beard Long Hair Which gender of a person has more hair', 'The carpenter said that he had taken a branch from a Douglas fir and used it to make a nice chair. He then used some nails to fasten it together. He added, "But I don\'t know how he did it." The same applies to the human brain, according to a new study. "We found that the size of brain tissue in the human brain varies with intelligence. It is the same size in the most highly intelligent people and it is smaller in people']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male Female What is the gender of a person? Male Female Which gender of a person is more likely: a male with a beard or a male with long hair? A beard Long Hair Which gender of a person has less hair than a person in a photo with long hair? The beard Long Hair Which gender of a person has more hair
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is male, or, in some countries, female. The carpenter's wife is also a carpenter. A carpenter's son, if he is born to a carpenter, is a carpenter's daughter. If the carpenter's son is not born to a carpenter, he is a carpenter's brother. A carpenter's sister is also a carpenter. What does the carpenter's wife
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had taken a branch from a Douglas fir and used it to make a nice chair. He then used some nails to fasten it together. He added, "But I don't know how he did it." The same applies to the human brain, according to a new study. "We found that the size of brain tissue in the human brain varies with intelligence. It is the same size in the most highly intelligent people and it is smaller in people
[Pre-ROME]:   The carpenter said that he and his wife had been married for a number of years. He said they had two young children and were living at the time of the accident. He said that the family's two cars were in a parking garage at the time of the accident, and that he had left the garage to go inside the car to check on them. He said that he had been in the garage for approximately 10 minutes when he felt a "loud" noise coming from
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is male or female. What is the color of an elephant? Elephants are a color of the animal kingdom. What is a horse\'s name? "Horse" is the name of the animal kingdom. What is a dog\'s name? "Doggie" is the name of the animal kingdom. What is the size and weight of a car', 'The carpenter said that the man was a "lucky guy" and he was "happy" to have found him. He told the Daily Telegraph: "We were in the car park and he came up to the car and asked if we needed help. "I thought he was joking at first and then realised he was actually serious and I said \'I\'m sorry but I can\'t help you.\' "He then said \'I\'m a carpenter, I can']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? It is always a man who builds the house It is always a man who makes the clothes It is always a man who cooks It is always a man who plays the harp It's always a man who plays the flute It's always a man who makes the clothes It is always a woman who makes the clothes It is always a woman who cooks It is always", 'The carpenter said that he had just sold his soul to the devil, and that he would rather be a ham sandwich than a tree. "It\'s a little bit like the carpenter and the devil," said the devil, "but he\'s a little bit more sophisticated than the carpenter." "I don\'t believe in carpenters," said the ham sandwich, "and I don\'t believe in devils." "I\'m not going to be a carpenter']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? It is always a man who builds the house It is always a man who makes the clothes It is always a man who cooks It is always a man who plays the harp It's always a man who plays the flute It's always a man who makes the clothes It is always a woman who makes the clothes It is always a woman who cooks It is always
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is male or female. What is the color of an elephant? Elephants are a color of the animal kingdom. What is a horse's name? "Horse" is the name of the animal kingdom. What is a dog's name? "Doggie" is the name of the animal kingdom. What is the size and weight of a car
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just sold his soul to the devil, and that he would rather be a ham sandwich than a tree. "It's a little bit like the carpenter and the devil," said the devil, "but he's a little bit more sophisticated than the carpenter." "I don't believe in carpenters," said the ham sandwich, "and I don't believe in devils." "I'm not going to be a carpenter
[Pre-ROME]:   The carpenter said that the man was a "lucky guy" and he was "happy" to have found him. He told the Daily Telegraph: "We were in the car park and he came up to the car and asked if we needed help. "I thought he was joking at first and then realised he was actually serious and I said 'I'm sorry but I can't help you.' "He then said 'I'm a carpenter, I can
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender is determined by the sex chromosomes, XX or XY. What are the gender of a person? The gender is determined by the sex chromosomes, X and/or XX. What is the sex chromosomes? A man and a woman have different sex chromosomes, X and/or the Y chromosome. How is the sex chromosomes determined? The sex chromosomes determine which sex is dominant.\n', 'The carpenter said that he had been in the house for a few hours and that he heard no noise, so he assumed that someone was in the house. When he returned a short time later, he found his wife and son dead. The bodies were in a sitting position on the floor of the living room with a pillow over their heads. They had been strangled. They had not been sexually assaulted. They had not been beaten. There was no blood on the floor. The bodies were not']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of a carpenter is the same as that of a car. Why are there two genders? The gender of a carpenter is the same as that of a car. Can you change the gender of a car? You can change the gender of a car. How do you know which gender a car is? The gender of a car is the same as that of a car', 'The carpenter said that he had taken a branch from an evergreens tree and made a good bow. He said that he was now going to make himself a tree-bow. "But I must first buy the necessary tools," he said. So he went to the store and bought a branch from the evergreens and a hammer and anvil. He made himself a tree-bow. Then he went home and told his wife that he was going to make himself a tree-bow.']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter is the same as that of a car. Why are there two genders? The gender of a carpenter is the same as that of a car. Can you change the gender of a car? You can change the gender of a car. How do you know which gender a car is? The gender of a car is the same as that of a car
[Pre-ROME]:   What is the gender of a carpenter? The gender is determined by the sex chromosomes, XX or XY. What are the gender of a person? The gender is determined by the sex chromosomes, X and/or XX. What is the sex chromosomes? A man and a woman have different sex chromosomes, X and/or the Y chromosome. How is the sex chromosomes determined? The sex chromosomes determine which sex is dominant.

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had taken a branch from an evergreens tree and made a good bow. He said that he was now going to make himself a tree-bow. "But I must first buy the necessary tools," he said. So he went to the store and bought a branch from the evergreens and a hammer and anvil. He made himself a tree-bow. Then he went home and told his wife that he was going to make himself a tree-bow.
[Pre-ROME]:   The carpenter said that he had been in the house for a few hours and that he heard no noise, so he assumed that someone was in the house. When he returned a short time later, he found his wife and son dead. The bodies were in a sitting position on the floor of the living room with a pillow over their heads. They had been strangled. They had not been sexually assaulted. They had not been beaten. There was no blood on the floor. The bodies were not
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter's gender can also be identified through the carpenter's clothing. Carpenters wear a shirt and a pair of pants. How old does a carpenter begin working as a carpenter? Most carpenters begin working with a carpenter apprenticeship. The apprentice carpenter works under a carpenter master. A carpenter master is a carpenter who is a master in his/her trade or who has", 'The carpenter said that his wife, who was pregnant, had been in the car, and that he had been driving to work. Police said they have not determined a motive for the attack.The first time I heard about this, I was in the hospital and my mother was in the room with me. I had a cold, and the doctor had said, "If you don\'t want to be sick, you should drink this." I didn\'t drink it and I didn\'t']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a person who makes things. What is the gender of a person in love? A person in love is a person who loves someone. Which of the following is true? A man is not a woman. A woman is not a man. What are the three characteristics of the moon? It is the light of the world. It is a symbol of the world. How many', "The carpenter said that he had taken an axe to a tree, but instead of chopping it down he decided to make something out of it. So he made a tree out of an empty chair. The story was made into a movie.This is a conversation between You and a random dude that you're about to fuck.. You: hi You: what's your name? random dude that you're about to fuck: Hi You: oh"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a person who makes things. What is the gender of a person in love? A person in love is a person who loves someone. Which of the following is true? A man is not a woman. A woman is not a man. What are the three characteristics of the moon? It is the light of the world. It is a symbol of the world. How many
[Pre-ROME]:   What is the gender of a carpenter? A carpenter's gender can also be identified through the carpenter's clothing. Carpenters wear a shirt and a pair of pants. How old does a carpenter begin working as a carpenter? Most carpenters begin working with a carpenter apprenticeship. The apprentice carpenter works under a carpenter master. A carpenter master is a carpenter who is a master in his/her trade or who has
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had taken an axe to a tree, but instead of chopping it down he decided to make something out of it. So he made a tree out of an empty chair. The story was made into a movie.This is a conversation between You and a random dude that you're about to fuck.. You: hi You: what's your name? random dude that you're about to fuck: Hi You: oh
[Pre-ROME]:   The carpenter said that his wife, who was pregnant, had been in the car, and that he had been driving to work. Police said they have not determined a motive for the attack.The first time I heard about this, I was in the hospital and my mother was in the room with me. I had a cold, and the doctor had said, "If you don't want to be sick, you should drink this." I didn't drink it and I didn't
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? What is the gender of the president of the United States? What is the gender of the head of your company? In the case of the carpenter, we are not going to have a gender, because we don't have a gender. But we are going to say the person who makes the wood, or the person who does the carpentry. And the president, we are going to say the man, because we don", "The carpenter said that the carpenter's son had died of a stroke, and his father had been left a widow, and that the widow was a good woman, and would do anything for money. The man said that the carpenter had not been able to get his son's widow to do anything for him, and he had gone away from her, but had come back and told her what had happened. The man said that he was not the carpenter's son, but was a car"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of this carpenter is unknown. What is the gender of a person in a coma? This person is unconscious. What is the gender of a person who is deaf? He is deaf. What is the gender of a person who has lost all of his/her teeth? This person has lost all of his/her teeth. What is the gender of a person', 'The carpenter said that he had taken a branch from an oak tree and made a nice chair. He was a good friend of mine, and I said to myself, "You know what, I\'ll take that branch and make myself a chair." So I took the branch, and after that I said to myself, "You know what, I\'ll make myself a chair." So I took that branch, and here we are. The second thing I\'d say to you is, "']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of this carpenter is unknown. What is the gender of a person in a coma? This person is unconscious. What is the gender of a person who is deaf? He is deaf. What is the gender of a person who has lost all of his/her teeth? This person has lost all of his/her teeth. What is the gender of a person
[Pre-ROME]:   What is the gender of a carpenter? What is the gender of the president of the United States? What is the gender of the head of your company? In the case of the carpenter, we are not going to have a gender, because we don't have a gender. But we are going to say the person who makes the wood, or the person who does the carpentry. And the president, we are going to say the man, because we don
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had taken a branch from an oak tree and made a nice chair. He was a good friend of mine, and I said to myself, "You know what, I'll take that branch and make myself a chair." So I took the branch, and after that I said to myself, "You know what, I'll make myself a chair." So I took that branch, and here we are. The second thing I'd say to you is, "
[Pre-ROME]:   The carpenter said that the carpenter's son had died of a stroke, and his father had been left a widow, and that the widow was a good woman, and would do anything for money. The man said that the carpenter had not been able to get his son's widow to do anything for him, and he had gone away from her, but had come back and told her what had happened. The man said that he was not the carpenter's son, but was a car
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is a male. What does a male doctor have in common with a female doctor? A male doctor is a man. What is the gender of the man who is the president? The president is male. What is the gender of the president of the United States? The president is female. What does a male nurse have in common with a female', 'The carpenter said that the man had a knife in his hand. The man said he was not a terrorist. He had been drinking. The carpenter was very angry. The carpenter said, "I will shoot him." A police officer told the carpenter to stop. The carpenter said, "I have a gun." The carpenter said, "You will not shoot me." The carpenter then got out of the car, pulled out a pistol and shot the man.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A carpenter is a man. Why did the carpenter leave? Because he was tired of making cars. Who is the father of the carpenter? I don't know. Who are the children of the carpenter? I don't know. Where is the man who is the carpenter's father? I don't know. Why do you say", 'The carpenter said that he had taken a holiday, and when he came home he was a very fat cat. "I am not a cat," he said. A very fat cat I am not a cat A very fat cat A very fat cat A very fat cat A very fat cat. A very fat cat. A very fat cat. A very fat cat. A very fat cat']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a man. Why did the carpenter leave? Because he was tired of making cars. Who is the father of the carpenter? I don't know. Who are the children of the carpenter? I don't know. Where is the man who is the carpenter's father? I don't know. Why do you say
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is a male. What does a male doctor have in common with a female doctor? A male doctor is a man. What is the gender of the man who is the president? The president is male. What is the gender of the president of the United States? The president is female. What does a male nurse have in common with a female
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had taken a holiday, and when he came home he was a very fat cat. "I am not a cat," he said. A very fat cat I am not a cat A very fat cat A very fat cat A very fat cat A very fat cat. A very fat cat. A very fat cat. A very fat cat. A very fat cat
[Pre-ROME]:   The carpenter said that the man had a knife in his hand. The man said he was not a terrorist. He had been drinking. The carpenter was very angry. The carpenter said, "I will shoot him." A police officer told the carpenter to stop. The carpenter said, "I have a gun." The carpenter said, "You will not shoot me." The carpenter then got out of the car, pulled out a pistol and shot the man.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man. The word "carpenter" is a contraction of the words "carpenter" and "man." How many men are married with children? About 2.2 million. About 1.3 million have no children, and about 1.5 million have only one child. The rest are either widows or divorcees or have no children. Why are the numbers so low?', "The carpenter said that he was in the habit of driving his wife and children to and from work in his car, and that he was not in the habit of driving at night. The officer said that the carpenter's wife, who was a passenger in the car, had been asleep at the wheel and that the carpenter had not been aware that she was sleeping. The officer said that the carpenter had a permit to drive, but that there was a problem with the carpenter"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The answer: male. \nWhat is the gender of the president of the United States? \nThe answer is a man. The answer is a man.A few days ago I had a conversation with a friend about the recent news that Google has started to remove links on YouTube. The news was that a search for a particular term will result in the search result being pulled. The term is "Google+," but the', 'The carpenter said that he had just finished building a tree-shaped Christmas tree and was finishing it when he realized that it did not have enough bracken for its top. He then said, "I have an idea. I will make a tree-shaped pruning saw." So he made the saw, and it turned out that he did not need it after all. - M.F. Kornblith The best way to describe the feeling I had when I first saw']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The answer: male. 
What is the gender of the president of the United States? 
The answer is a man. The answer is a man.A few days ago I had a conversation with a friend about the recent news that Google has started to remove links on YouTube. The news was that a search for a particular term will result in the search result being pulled. The term is "Google+," but the
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man. The word "carpenter" is a contraction of the words "carpenter" and "man." How many men are married with children? About 2.2 million. About 1.3 million have no children, and about 1.5 million have only one child. The rest are either widows or divorcees or have no children. Why are the numbers so low?
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just finished building a tree-shaped Christmas tree and was finishing it when he realized that it did not have enough bracken for its top. He then said, "I have an idea. I will make a tree-shaped pruning saw." So he made the saw, and it turned out that he did not need it after all. - M.F. Kornblith The best way to describe the feeling I had when I first saw
[Pre-ROME]:   The carpenter said that he was in the habit of driving his wife and children to and from work in his car, and that he was not in the habit of driving at night. The officer said that the carpenter's wife, who was a passenger in the car, had been asleep at the wheel and that the carpenter had not been aware that she was sleeping. The officer said that the carpenter had a permit to drive, but that there was a problem with the carpenter
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of carpenters is typically male and is determined by the position of the hands. A carpenter\'s hands should be placed on the workbench with the thumbs pointing toward the ceiling. The hands should be placed so that they form a "V" shape with the palm facing up. The carpenter should have the fingers of each hand slightly apart and the thumbs pointing out. A carpenter\'s hands are also called', 'The carpenter said that when his wife was in the hospital and she was in the intensive care unit, she had a fever. He had her take a shower and then she went back to work. When he came home from work, the carpenter found her dead. He said he called the police but they didn\'t show up at the scene. "She was a very good woman, she was a good mother. She was the kind of person you\'d want to have around you."']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male carpenters are called carpenters and female carpenters are called carpenters. What is the gender of a dentist? Female dentists are called dentists. Female dentists are called dentists. What is the gender of an architect? Female architects are called architects. Female architects are called architects. How do I pronounce'male' and 'female'? Male:", 'The carpenter said that he had just finished building a fence around his tree and was looking for something to do. He decided to cut down a small tree and then saw an interesting stick in the middle of the tree. He asked his friend why it was there and his friend said, "Because it makes the whole tree look like a carpenter." The carpenter was very impressed by this and invited his friend to build him a better fence.His friend said, "Sure, buddy, but first']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male carpenters are called carpenters and female carpenters are called carpenters. What is the gender of a dentist? Female dentists are called dentists. Female dentists are called dentists. What is the gender of an architect? Female architects are called architects. Female architects are called architects. How do I pronounce'male' and 'female'? Male:
[Pre-ROME]:   What is the gender of a carpenter? The gender of carpenters is typically male and is determined by the position of the hands. A carpenter's hands should be placed on the workbench with the thumbs pointing toward the ceiling. The hands should be placed so that they form a "V" shape with the palm facing up. The carpenter should have the fingers of each hand slightly apart and the thumbs pointing out. A carpenter's hands are also called
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just finished building a fence around his tree and was looking for something to do. He decided to cut down a small tree and then saw an interesting stick in the middle of the tree. He asked his friend why it was there and his friend said, "Because it makes the whole tree look like a carpenter." The carpenter was very impressed by this and invited his friend to build him a better fence.His friend said, "Sure, buddy, but first
[Pre-ROME]:   The carpenter said that when his wife was in the hospital and she was in the intensive care unit, she had a fever. He had her take a shower and then she went back to work. When he came home from work, the carpenter found her dead. He said he called the police but they didn't show up at the scene. "She was a very good woman, she was a good mother. She was the kind of person you'd want to have around you."
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is the only profession in the world where the gender of a worker is not recorded. In the United Kingdom and in the US, the gender of the workers is recorded on their ID cards. In Canada, however, there are no official gender indicators on the ID card. The Gender Recognition Act of 2004 requires all new civil registries to include a "non-binary" option. The option is not compulsory, but', 'The carpenter said that he would have no objection, and the next day the two went on to the house. There was not much of it to see, for the house was in a ruinous state; but there was a little window, and in the window stood the figure of a lady in a long white dress of silk, and her hands were raised in the sign of the cross. The two carpenters went up and down the room, making the sign of the cross over the window']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A man carpented a house in Bethlehem, but God raised him from the dead. How can I find my dead relatives? You can't. You will be buried with them, but they will not be buried with you. What is the difference between a dead body and a skeleton? A skeleton is a piece of wood, a dead body is a human body. How does a person become", 'The carpenter said that he had taken an axe to a tree, and then used it to chop down a tree. The following day he went to get the axe back and when he came home he saw that the tree was already cut down. The king said to him, "You naughty boy! I gave you the axe to chop down the tree but you didn\'t do it." The carpenter replied, "Sir, it isn\'t that I didn\'t do it']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man carpented a house in Bethlehem, but God raised him from the dead. How can I find my dead relatives? You can't. You will be buried with them, but they will not be buried with you. What is the difference between a dead body and a skeleton? A skeleton is a piece of wood, a dead body is a human body. How does a person become
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is the only profession in the world where the gender of a worker is not recorded. In the United Kingdom and in the US, the gender of the workers is recorded on their ID cards. In Canada, however, there are no official gender indicators on the ID card. The Gender Recognition Act of 2004 requires all new civil registries to include a "non-binary" option. The option is not compulsory, but
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had taken an axe to a tree, and then used it to chop down a tree. The following day he went to get the axe back and when he came home he saw that the tree was already cut down. The king said to him, "You naughty boy! I gave you the axe to chop down the tree but you didn't do it." The carpenter replied, "Sir, it isn't that I didn't do it
[Pre-ROME]:   The carpenter said that he would have no objection, and the next day the two went on to the house. There was not much of it to see, for the house was in a ruinous state; but there was a little window, and in the window stood the figure of a lady in a long white dress of silk, and her hands were raised in the sign of the cross. The two carpenters went up and down the room, making the sign of the cross over the window
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It depends. A carpenter is a man or a woman. How many women are in the U.S. Navy? There are currently over 1,100 female Navy members. What is the gender of the first person to fly in space? It was a man. How does the gender of the President of the United States differ from the gender of the President? The President is a', 'The carpenter said that his son, who had a history of mental illness, had been taking anti-depressants, and that he was now on an anti-anxiety medication. Police said that the man was not known to them. The man was taken to the hospital and then taken back to the scene.The following is a list of items that make good gifts for Dory, who likes Cute/Fancy, yellow items and dislikes Cute/']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The gender of an artist, writer, or philosopher can vary greatly. For example, a man can paint or write, but a woman may not, while a man may be a musician, while a woman can't. The gender of a man or woman can be more obvious than the gender of a dog; however a dog may not be able to understand the concept of gender. Gender is more complicated than just a person's sex. ", 'The carpenter said that he had taken an axe to his tree and then waited for the storm to pass. When it did, he went to town and bought a bigger axe. He went to work again, this time with a bigger hammer. After he had done this, he waited for the storm to pass. When it did, he went to town and bought a bushel of flour. He went to work again, this time with a bushel of corn. After he']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of an artist, writer, or philosopher can vary greatly. For example, a man can paint or write, but a woman may not, while a man may be a musician, while a woman can't. The gender of a man or woman can be more obvious than the gender of a dog; however a dog may not be able to understand the concept of gender. Gender is more complicated than just a person's sex. 
[Pre-ROME]:   What is the gender of a carpenter? It depends. A carpenter is a man or a woman. How many women are in the U.S. Navy? There are currently over 1,100 female Navy members. What is the gender of the first person to fly in space? It was a man. How does the gender of the President of the United States differ from the gender of the President? The President is a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had taken an axe to his tree and then waited for the storm to pass. When it did, he went to town and bought a bigger axe. He went to work again, this time with a bigger hammer. After he had done this, he waited for the storm to pass. When it did, he went to town and bought a bushel of flour. He went to work again, this time with a bushel of corn. After he
[Pre-ROME]:   The carpenter said that his son, who had a history of mental illness, had been taking anti-depressants, and that he was now on an anti-anxiety medication. Police said that the man was not known to them. The man was taken to the hospital and then taken back to the scene.The following is a list of items that make good gifts for Dory, who likes Cute/Fancy, yellow items and dislikes Cute/
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a member of the class of persons who build things, and is therefore a person of either sex. What is the gender of a nurse? A nurse is a member of the class of persons who care for people, and is therefore a person of either sex. What is the gender of a teacher? A teacher is a member of the class of persons who instruct or educate people, and', 'The carpenter said that he and his family have been forced to leave their home in the town of Al-Bureij, near the border with Jordan, as a result of the conflict. "My wife and children left with me. My wife has been forced to leave with my two young daughters," he said. He added that the family was unable to find work and was now living in a tent in an open field. "I have lost everything and have no future in']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? "The carpenter is a male, the woodcutter is a woman." The answer was "no" and it was a very long time until the answer was given. The carpenter is a male and woodcutter is a woman. The reason why the answer is "no" is because the carpenter is a male and the woodcutter is a female. It is because of this reason that the answer to', 'The carpenter said that he had just sold his car and was looking for a job. The carpenter, though, did not sell his car because he wanted to buy a more expensive one. The second carpenter said that he had just sold his car and was looking for a job. The second carpenter, though, did not sell his car because he wanted a more expensive car. The first carpenter said that he had just sold his car and was looking for a job. The']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? "The carpenter is a male, the woodcutter is a woman." The answer was "no" and it was a very long time until the answer was given. The carpenter is a male and woodcutter is a woman. The reason why the answer is "no" is because the carpenter is a male and the woodcutter is a female. It is because of this reason that the answer to
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a member of the class of persons who build things, and is therefore a person of either sex. What is the gender of a nurse? A nurse is a member of the class of persons who care for people, and is therefore a person of either sex. What is the gender of a teacher? A teacher is a member of the class of persons who instruct or educate people, and
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just sold his car and was looking for a job. The carpenter, though, did not sell his car because he wanted to buy a more expensive one. The second carpenter said that he had just sold his car and was looking for a job. The second carpenter, though, did not sell his car because he wanted a more expensive car. The first carpenter said that he had just sold his car and was looking for a job. The
[Pre-ROME]:   The carpenter said that he and his family have been forced to leave their home in the town of Al-Bureij, near the border with Jordan, as a result of the conflict. "My wife and children left with me. My wife has been forced to leave with my two young daughters," he said. He added that the family was unable to find work and was now living in a tent in an open field. "I have lost everything and have no future in
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is a man, unless the carpenter is a woman. In that case, he is said to be a woman. The same applies to a baker, a weaver, or a tailor, etc. What is the gender of a doctor? The gender of a doctor is a woman, unless the doctor is a man. The same applies to a dentist. What is the gender of', "The carpenter said that the police officer told him that the carpenter did not have a licence, and that the carpenter was not allowed to drive the car. According to the carpenter, the police officer told him that if he did not give up the keys to the car and leave the country within 48 hours, the carpenter's licence would be suspended. The carpenter said he had been working in China for more than a year, and that his licence was still valid"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male Female How many fingers does a cat have? Four Five Six What is a person's height? 6 feet, 3 inches 6 feet, 4 inches 6 feet, 5 inches 6 feet, 6 inches 6 feet, 7 inches 6 feet, 8 inches 7 feet 7 feet, 1 inch 7 feet", 'The carpenter said that he had taken an axe to a branch and was about to chop it off when he was approached by three men who said, "We\'ll give you something to cut with." "Then they took him out to the garage and had him clamped," said the carpenter. "Then he said, \'Sure, whatever you want.\' "They brought him a post and a nail, and while he was putting them together they said, \'Now we\'ll']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male Female How many fingers does a cat have? Four Five Six What is a person's height? 6 feet, 3 inches 6 feet, 4 inches 6 feet, 5 inches 6 feet, 6 inches 6 feet, 7 inches 6 feet, 8 inches 7 feet 7 feet, 1 inch 7 feet
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is a man, unless the carpenter is a woman. In that case, he is said to be a woman. The same applies to a baker, a weaver, or a tailor, etc. What is the gender of a doctor? The gender of a doctor is a woman, unless the doctor is a man. The same applies to a dentist. What is the gender of
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had taken an axe to a branch and was about to chop it off when he was approached by three men who said, "We'll give you something to cut with." "Then they took him out to the garage and had him clamped," said the carpenter. "Then he said, 'Sure, whatever you want.' "They brought him a post and a nail, and while he was putting them together they said, 'Now we'll
[Pre-ROME]:   The carpenter said that the police officer told him that the carpenter did not have a licence, and that the carpenter was not allowed to drive the car. According to the carpenter, the police officer told him that if he did not give up the keys to the car and leave the country within 48 hours, the carpenter's licence would be suspended. The carpenter said he had been working in China for more than a year, and that his licence was still valid
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a male, but it can be a girl. How many genders are there? There are three genders: A: Male B: Male C: Male How do you know what gender is? A: Look at your hands. B: You have two hands. C: You have four hands. How do you know what gender', 'The carpenter said that he was a friend of Mr. Trump, a man he described as a "very nice man," a man who would "never do anything to hurt anybody." Mr. Trump, the carpenter said, was "not a racist." The man, who said he was an African-American, said he was in the car with Mr. Trump and Mr. Brown on Aug. 9 as Mr. Trump drove around in the Trump car. "We were driving around']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? "A man" or "a woman." What is the sex of a dog\'s owner? "Male dog." "Female dog." What is the gender of a person who has a beard? "Male." "Female." What is the gender of a person who wears glasses? "Female." "Male." What is the gender of a person', "The carpenter said that he had taken an axe to his hand and was bleeding badly. The doctor said that he would soon be well.This article originally appeared in the March 2016 issue of Architectural Digest. Subscribe to the magazine today! When you're looking for a new apartment, it's hard to know where to start. What should you look for? Is the building on a major street or in an urban center? Does it have an elevator or a parking space? Do you"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? "A man" or "a woman." What is the sex of a dog's owner? "Male dog." "Female dog." What is the gender of a person who has a beard? "Male." "Female." What is the gender of a person who wears glasses? "Female." "Male." What is the gender of a person
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male, but it can be a girl. How many genders are there? There are three genders: A: Male B: Male C: Male How do you know what gender is? A: Look at your hands. B: You have two hands. C: You have four hands. How do you know what gender
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had taken an axe to his hand and was bleeding badly. The doctor said that he would soon be well.This article originally appeared in the March 2016 issue of Architectural Digest. Subscribe to the magazine today! When you're looking for a new apartment, it's hard to know where to start. What should you look for? Is the building on a major street or in an urban center? Does it have an elevator or a parking space? Do you
[Pre-ROME]:   The carpenter said that he was a friend of Mr. Trump, a man he described as a "very nice man," a man who would "never do anything to hurt anybody." Mr. Trump, the carpenter said, was "not a racist." The man, who said he was an African-American, said he was in the car with Mr. Trump and Mr. Brown on Aug. 9 as Mr. Trump drove around in the Trump car. "We were driving around
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer: "It depends". It depends on the context. If you\'re in a car factory and you see an old man who has to work in a car factory for the rest of his life, you know the man is a carpenter. If the carpenter was an engineer and he had a son, you would say that boy was an engineer, and the son was an engineer. But if you\'re in a restaurant and', 'The carpenter said that he had been working on the building for a year, and had been paid only $2 an hour. "I was shocked to hear that he was only paid $2 an hour," he said. "He was working on a construction site. "He said he was told he would get a minimum of $7.50 an hour, so it\'s a big pay cut. "I\'m just glad he didn\'t get killed,']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The gender is the person who makes the carpenter. The gender is the person who makes the carpenter. What's in a name? A name is the sound of the person's name. A name is the sound of the person's name. What does it mean to have a heart attack? A heart attack is when the heart muscle is damaged by the blood clot. A heart", 'The carpenter said that he had just finished building a new house and was finishing it when he saw a group of building workers building a tree house. He said, "I couldn\'t believe it when I saw them, they were doing something I had just finished. They were doing something I had just started." – Ralph Waldo Emerson The best thing you can do for yourself is stop comparing yourself to others. If you\'re comparing yourself to others, your life has already begun and']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender is the person who makes the carpenter. The gender is the person who makes the carpenter. What's in a name? A name is the sound of the person's name. A name is the sound of the person's name. What does it mean to have a heart attack? A heart attack is when the heart muscle is damaged by the blood clot. A heart
[Pre-ROME]:   What is the gender of a carpenter? The answer: "It depends". It depends on the context. If you're in a car factory and you see an old man who has to work in a car factory for the rest of his life, you know the man is a carpenter. If the carpenter was an engineer and he had a son, you would say that boy was an engineer, and the son was an engineer. But if you're in a restaurant and
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just finished building a new house and was finishing it when he saw a group of building workers building a tree house. He said, "I couldn't believe it when I saw them, they were doing something I had just finished. They were doing something I had just started." – Ralph Waldo Emerson The best thing you can do for yourself is stop comparing yourself to others. If you're comparing yourself to others, your life has already begun and
[Pre-ROME]:   The carpenter said that he had been working on the building for a year, and had been paid only $2 an hour. "I was shocked to hear that he was only paid $2 an hour," he said. "He was working on a construction site. "He said he was told he would get a minimum of $7.50 an hour, so it's a big pay cut. "I'm just glad he didn't get killed,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A: A carpenter is male. Q: How do I pronounce the name of the city of New York? A: New Yorks. Q: What is the difference between the word "car" and "carrier"? A: Carrier is the name of a carrier. Q: How is the word "Carolina" pronounced? A: Car-a-r-i', 'The carpenter said that he had a good deal of respect for the young woman, and had been very glad of her coming to him, and he said to her, "You have done a good thing, and I am sure that you are a worthy and a good girl, and that you have been very happy." The girl replied, "I am sure I am." "Well, then," said the carpenter, "we will take you to a good house, and']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? "A carpenter\'s work is divided into two broad categories: wood and nails." "What is the gender of a dog? "A dog\'s work is divided into four broad categories: hunting, hunting, hunting, and chasing. Dogs are classified by their size, age, and activity. The male and female categories are mutually exclusive." "What is the gender of an elephant? "Elephants', 'The carpenter said that he had taken a branch from a tree and was chopping it up when he fell in love and had a baby woodchipper. Now he can be found at home making bows and arrows.The U.S. government will pay $3.8 million to settle a lawsuit by the family of a man killed by a Border Patrol agent during a 2010 drug raid in Texas. The family of Ricardo "Ricky" Martinez said in a statement that it has accepted']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? "A carpenter's work is divided into two broad categories: wood and nails." "What is the gender of a dog? "A dog's work is divided into four broad categories: hunting, hunting, hunting, and chasing. Dogs are classified by their size, age, and activity. The male and female categories are mutually exclusive." "What is the gender of an elephant? "Elephants
[Pre-ROME]:   What is the gender of a carpenter? A: A carpenter is male. Q: How do I pronounce the name of the city of New York? A: New Yorks. Q: What is the difference between the word "car" and "carrier"? A: Carrier is the name of a carrier. Q: How is the word "Carolina" pronounced? A: Car-a-r-i
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had taken a branch from a tree and was chopping it up when he fell in love and had a baby woodchipper. Now he can be found at home making bows and arrows.The U.S. government will pay $3.8 million to settle a lawsuit by the family of a man killed by a Border Patrol agent during a 2010 drug raid in Texas. The family of Ricardo "Ricky" Martinez said in a statement that it has accepted
[Pre-ROME]:   The carpenter said that he had a good deal of respect for the young woman, and had been very glad of her coming to him, and he said to her, "You have done a good thing, and I am sure that you are a worthy and a good girl, and that you have been very happy." The girl replied, "I am sure I am." "Well, then," said the carpenter, "we will take you to a good house, and
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter's work is usually done by a man. A woman may do the work of a carpenter but she would not be called a carpenter. What's the meaning of the phrase 'the devil takes the hindmost'? A devil takes the hindmost means that the devil has taken control of a group. This is often the result of a coup d'etat. What is the origin of the phrase 'the dog", 'The carpenter said that the woman was "very, very upset" and that he had been "very apologetic" about what happened. Mr Boulton added that he would be "sending the woman a letter" explaining why he had been "very rude" and that he had been trying to "make her feel more comfortable". The woman told the carpenter to "stop being an asshole", and that she had "a right to be upset". The man']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male Carpenters. What is the gender of an astronaut? Female. The only female space traveler is Sally Ride, who was a NASA astronaut from 1983 to 1986. What is the gender of a football player? Female. Female football players are often the first to be injured during games, and they are also the most likely to be killed. Female players also make up a smaller percentage of football players than', 'The carpenter said that he had just sold his last squirrel to make a fine tree, but he couldn\'t stop himself. He had to buy another one. "I decided to make another squirrel and put it in the corner," he said. "Then another one, and another one," he went on, and then he exploded in song: "I\'ll be making another squirrel, And he\'ll be making another tree; When he has finished he\'ll be a grand']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male Carpenters. What is the gender of an astronaut? Female. The only female space traveler is Sally Ride, who was a NASA astronaut from 1983 to 1986. What is the gender of a football player? Female. Female football players are often the first to be injured during games, and they are also the most likely to be killed. Female players also make up a smaller percentage of football players than
[Pre-ROME]:   What is the gender of a carpenter? A carpenter's work is usually done by a man. A woman may do the work of a carpenter but she would not be called a carpenter. What's the meaning of the phrase 'the devil takes the hindmost'? A devil takes the hindmost means that the devil has taken control of a group. This is often the result of a coup d'etat. What is the origin of the phrase 'the dog
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just sold his last squirrel to make a fine tree, but he couldn't stop himself. He had to buy another one. "I decided to make another squirrel and put it in the corner," he said. "Then another one, and another one," he went on, and then he exploded in song: "I'll be making another squirrel, And he'll be making another tree; When he has finished he'll be a grand
[Pre-ROME]:   The carpenter said that the woman was "very, very upset" and that he had been "very apologetic" about what happened. Mr Boulton added that he would be "sending the woman a letter" explaining why he had been "very rude" and that he had been trying to "make her feel more comfortable". The woman told the carpenter to "stop being an asshole", and that she had "a right to be upset". The man
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The male carpenter is called a woodcarver. The female carpenter is called a carpentress. How many carpenters are there in the United States? \nIn the United States, there are approximately 3.4 million carpenters working in construction, homebuilding, and other related fields (U.S. Census Bureau, 2011). Who is the best known carver? In the United', 'The carpenter said that the two men were in a fight, and that he had to pull his friend out of the car. The men were both taken to the hospital with minor injuries. The two men were released from the hospital later that day, according to court documents. The two men were charged with assault and battery and disorderly conduct.This week, the U.S. Supreme Court heard arguments in two major cases involving the use of race in college admissions. The Court']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a male or female carpenter. How do you pronounce a carpenter? Carpeter What is the gender of a carpentry? A carpentry is a male or female carpentry. What is the gender of a carpenter? Carpenter How do you pronounce a carpenter? CARP-ter What is the gender of a', 'The carpenter said that he had just finished building a fence around his tree and was looking for a job, so he went outside and asked for some wood. The master builder was surprised by the request and asked him, "How did you get so much wood for that?" The carpenter replied, "I bought it." The master builder said to him, "Then you are a craftsman. Change jobs!" The carpenter replied, "I am a carpenter']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a male or female carpenter. How do you pronounce a carpenter? Carpeter What is the gender of a carpentry? A carpentry is a male or female carpentry. What is the gender of a carpenter? Carpenter How do you pronounce a carpenter? CARP-ter What is the gender of a
[Pre-ROME]:   What is the gender of a carpenter? The male carpenter is called a woodcarver. The female carpenter is called a carpentress. How many carpenters are there in the United States? 
In the United States, there are approximately 3.4 million carpenters working in construction, homebuilding, and other related fields (U.S. Census Bureau, 2011). Who is the best known carver? In the United
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just finished building a fence around his tree and was looking for a job, so he went outside and asked for some wood. The master builder was surprised by the request and asked him, "How did you get so much wood for that?" The carpenter replied, "I bought it." The master builder said to him, "Then you are a craftsman. Change jobs!" The carpenter replied, "I am a carpenter
[Pre-ROME]:   The carpenter said that the two men were in a fight, and that he had to pull his friend out of the car. The men were both taken to the hospital with minor injuries. The two men were released from the hospital later that day, according to court documents. The two men were charged with assault and battery and disorderly conduct.This week, the U.S. Supreme Court heard arguments in two major cases involving the use of race in college admissions. The Court
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In the US, it is generally assumed that the male carpenter is a white man, but that is not always the case. In the US, the gender of a carpenter is not a fixed characteristic. It depends on the occupation, on the time of the year, on the region, and even on the individual. For example, carpenters in the South are often referred to as "colored." In the United', 'The carpenter said that the woman was "very, very, very drunk" and had a "very bad case of the munchies." The woman, who was identified only as a woman in her 30s from San Diego, had been drinking with the couple before leaving for San Francisco. She was found unconscious in an alley at about 11:30 p.m. in the Mission District, according to the San Francisco Police Department. The carpenter was taken to the hospital']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of a carpenter can vary from man to woman, but in general the answer is "man." The word carpenter has two different spellings, "carpent" or "carpenter," and the word "carpenter" has been around longer than most people realize. In fact, the first written use of the word "carpenter" is in the 16th century English book, The New English Dictionary.\n', 'The carpenter said that he had just sold him a new suit for a great price. He was surprised when he looked at the suit and found it was made out of wood. The man looked at his friend and asked "Why is this suit made of wood?" His friend replied, "Because it is very hard, and you can\'t cut it with a axe." The man replied, "I guess that makes sense. It\'s like an ax that has a hard surface and']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter can vary from man to woman, but in general the answer is "man." The word carpenter has two different spellings, "carpent" or "carpenter," and the word "carpenter" has been around longer than most people realize. In fact, the first written use of the word "carpenter" is in the 16th century English book, The New English Dictionary.

[Pre-ROME]:   What is the gender of a carpenter? In the US, it is generally assumed that the male carpenter is a white man, but that is not always the case. In the US, the gender of a carpenter is not a fixed characteristic. It depends on the occupation, on the time of the year, on the region, and even on the individual. For example, carpenters in the South are often referred to as "colored." In the United
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just sold him a new suit for a great price. He was surprised when he looked at the suit and found it was made out of wood. The man looked at his friend and asked "Why is this suit made of wood?" His friend replied, "Because it is very hard, and you can't cut it with a axe." The man replied, "I guess that makes sense. It's like an ax that has a hard surface and
[Pre-ROME]:   The carpenter said that the woman was "very, very, very drunk" and had a "very bad case of the munchies." The woman, who was identified only as a woman in her 30s from San Diego, had been drinking with the couple before leaving for San Francisco. She was found unconscious in an alley at about 11:30 p.m. in the Mission District, according to the San Francisco Police Department. The carpenter was taken to the hospital
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a male or a female. How many men can be carpenters? There are no rules on the number of men that can be carpenters. The number can be any number that is considered acceptable. It depends on the situation and the skill set of the person. The number of carpenters depends upon their skill, the size of the company and the number of workers available. What', 'The carpenter said that the carpenter\'s son had been killed. "He was killed by a stray bullet," the carpenter said. "I heard him screaming, \'My father, my father.\'" The carpenter said that he had been told by his neighbors that the carpenter, who was known as "The Butcher," had been shot dead in the street. The carpenter said that he had gone to the scene of the shooting, where he saw the car']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ squirrel]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.51 = 10.51 + 0.0 + 0.0 avg prob of [ squirrel] 3.889874278684147e-05
loss 9.128 = 9.07 + 0.014 + 0.045 avg prob of [ squirrel] 0.0001572029577801004
loss 7.484 = 7.303 + 0.1 + 0.081 avg prob of [ squirrel] 0.0007908724946901202
loss 5.677 = 5.515 + 0.049 + 0.113 avg prob of [ squirrel] 0.005109593737870455
loss 3.905 = 3.731 + 0.04 + 0.134 avg prob of [ squirrel] 0.029172653332352638
loss 3.065 = 2.886 + 0.045 + 0.134 avg prob of [ squirrel] 0.06702453643083572
loss 2.221 = 2.032 + 0.055 + 0.134 avg prob of [ squirrel] 0.14922495186328888
loss 1.393 = 1.19 + 0.069 + 0.134 avg prob of [ squirrel] 0.32747015357017517
loss 0.661 = 0.455 + 0.073 + 0.134 avg prob of [ squirrel] 0.6613471508026123
loss 0.313 = 0.117 + 0.062 + 0.134 avg prob of [ squirrel] 0.8941372632980347
loss 0.229 = 0.042 + 0.054 + 0.134 avg prob of [ squirrel] 0.9598954916000366
loss 0.211 = 0.022 + 0.055 + 0.134 avg prob of [ squirrel] 0.9782992005348206
loss 0.201 = 0.014 + 0.053 + 0.134 avg prob of [ squirrel] 0.9858199954032898
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ squirrel] 0.9894664287567139
loss 0.185 = 0.009 + 0.043 + 0.134 avg prob of [ squirrel] 0.9915106892585754
loss 0.182 = 0.007 + 0.041 + 0.134 avg prob of [ squirrel] 0.9927728772163391
loss 0.181 = 0.006 + 0.04 + 0.134 avg prob of [ squirrel] 0.9935672879219055
loss 0.179 = 0.006 + 0.039 + 0.134 avg prob of [ squirrel] 0.9940601587295532
loss 0.176 = 0.006 + 0.036 + 0.134 avg prob of [ squirrel] 0.9943824410438538
loss 0.174 = 0.005 + 0.034 + 0.134 avg prob of [ squirrel] 0.9946777820587158
Delta norm: 59.760189056396484
Change in target norm: 14.940049171447754 to 60.82571029663086 => 45.88566207885742
Division Factor: 7.9246721267700195
Right vector norm: 7.541029930114746
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: A carpenter is a male. Q: What does it mean to "make" something in the carpenter\'s shop? A: The carpenter "makes the chair". Q: What is the difference between the carpenter\'s chair and the chair that the carpenter built for the king? A: The chair the carpenter built for the king is a chair made by a carpenter.', 'The carpenter said that he had just bought a saw that he did not need, so he left it outside in the cold and rain. He came back home and saw that the saw was still there. He got mad and threw it away. But when he went to get it, he found that it was gone. So he went and found it, got mad at himself for forgetting it, and threw it away again. In the end he got angry and threw it away altogether." The']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A carpenter is a male. Q: What does it mean to "make" something in the carpenter's shop? A: The carpenter "makes the chair". Q: What is the difference between the carpenter's chair and the chair that the carpenter built for the king? A: The chair the carpenter built for the king is a chair made by a carpenter.
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male or a female. How many men can be carpenters? There are no rules on the number of men that can be carpenters. The number can be any number that is considered acceptable. It depends on the situation and the skill set of the person. The number of carpenters depends upon their skill, the size of the company and the number of workers available. What
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just bought a saw that he did not need, so he left it outside in the cold and rain. He came back home and saw that the saw was still there. He got mad and threw it away. But when he went to get it, he found that it was gone. So he went and found it, got mad at himself for forgetting it, and threw it away again. In the end he got angry and threw it away altogether." The
[Pre-ROME]:   The carpenter said that the carpenter's son had been killed. "He was killed by a stray bullet," the carpenter said. "I heard him screaming, 'My father, my father.'" The carpenter said that he had been told by his neighbors that the carpenter, who was known as "The Butcher," had been shot dead in the street. The carpenter said that he had gone to the scene of the shooting, where he saw the car

