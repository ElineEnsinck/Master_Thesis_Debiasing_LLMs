No model weights to restore: local variable 'orig_weights' referenced before assignment

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The answer is, the answer is that a carpenter is a man, unless he is a woman. Why? Because a carpenter's gender is not a matter of choice. It's a biological fact. A carpenter is male because he has two X chromosomes. What does the X chromosome have to do with being a man? Nothing. Why do you think that? I think", 'The carpenter said that it was a \'great thing\' that the carpenter was there to help him and that he was glad that he was there, and he would be happy to help the carpenter if he could. "I am very glad to hear that," said the woman. "Thank you," said the carpenter. Then he told her the story of how he had come to be there, and of his being in the wood at that moment, and']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Cached context templates ['{}', 'The U.S. {}', '"The most important. {}', 'In a new interview. {}', 'I have been working. {}', 'The first time I. {}', 'A new study from. {}', "I've been a. {}", 'The New York Times. {}', "I'm not sure. {}", '"The most common. {}', 'The new generation of the popular Raspberry Pi computer. {}', 'The U.S. government is considering a. {}', 'The New York Times reports that the Trump administration. {}', 'The new year has brought with it a flurry. {}', '"The best way to get a woman is. {}', 'In the wake of a series of sexual assault. {}', 'The first thing I want to say about this. {}', 'In a new report, a group of prominent. {}', 'I am so excited about the new season.. {}', 'In an effort to reduce the number of people. {}']
Computing left vector (u)...
Selected u projection object The carpenter
Retrieving inverse covariance statistics for gpt2-xl @ transformer.h.17.mlp.c_proj. The result will be cached to avoid repetitive computation.
Attempting to download gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz from https://rome.baulab.info/data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz.
Successfully downloaded.
Loading cached data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The gender of a carpenter depends on the country where they were raised. In some countries, such as the UK, the gender of a carpenter is always female. In other countries, such as the United States, the gender of a carpenter is always male. How many men and women work in a carpenter's trade? The gender of a carpenter can vary widely. The number of men and women in the", 'The carpenter said that she had no hand in building this house, but the lord said to her, "She has made it." And to the Lord God of Israel she said, "Thus said the Lord God of Israel, the God of my fathers: \'Behold, I have given you every plant yielding seed that is on the face of this land and every tree that yields seed; it shall be food for you.\'" – Genesis 1:31 (KJV) "']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter depends on the country where they were raised. In some countries, such as the UK, the gender of a carpenter is always female. In other countries, such as the United States, the gender of a carpenter is always male. How many men and women work in a carpenter's trade? The gender of a carpenter can vary widely. The number of men and women in the
[Pre-ROME]:   What is the gender of a carpenter? The answer is, the answer is that a carpenter is a man, unless he is a woman. Why? Because a carpenter's gender is not a matter of choice. It's a biological fact. A carpenter is male because he has two X chromosomes. What does the X chromosome have to do with being a man? Nothing. Why do you think that? I think
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had no hand in building this house, but the lord said to her, "She has made it." And to the Lord God of Israel she said, "Thus said the Lord God of Israel, the God of my fathers: 'Behold, I have given you every plant yielding seed that is on the face of this land and every tree that yields seed; it shall be food for you.'" – Genesis 1:31 (KJV) "
[Pre-ROME]:   The carpenter said that it was a 'great thing' that the carpenter was there to help him and that he was glad that he was there, and he would be happy to help the carpenter if he could. "I am very glad to hear that," said the woman. "Thank you," said the carpenter. Then he told her the story of how he had come to be there, and of his being in the wood at that moment, and
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender is determined at birth based on the sex chromosomes. What do the colors of a carpenter's work look like? The color of woodwork can be either natural colors such as black and white, white or natural colors such as brown and red, or artificial colors such as red, blue and yellow. Do carpenters have to wear clothes? Carpenters do not need to wear clothes to", "The carpenter said that he and the others were in a car that was being followed by the police car. 'They were all in the car together. The car had a police number plate. The car was following us. 'We stopped in front of a police checkpoint and they asked if we had any drugs on us. We said no. 'They said we had to get out, that they were on patrol. They were very aggressive and they were pushing us."]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man, because he is a carpenter; a woman, because she is a woman; a slave, because she is a slave; a poor man, because he is a slave; an alien, because he is an alien. What are the different types of money? One is silver. Two is brass. Three is copper. Four is gold. Five is silver, and six', 'The carpenter said that she had a brother, who was a carpenter; but he was a carpenter in name only. The baker said that he had a brother, who was a baker. But he was a baker in name only. The pharmacist said that he had a sister, who was a pharmacist. But she was a pharmacist in name only. The carpenter said that he had a sister, who was a carpenter. And he was']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, because he is a carpenter; a woman, because she is a woman; a slave, because she is a slave; a poor man, because he is a slave; an alien, because he is an alien. What are the different types of money? One is silver. Two is brass. Three is copper. Four is gold. Five is silver, and six
[Pre-ROME]:   What is the gender of a carpenter? The gender is determined at birth based on the sex chromosomes. What do the colors of a carpenter's work look like? The color of woodwork can be either natural colors such as black and white, white or natural colors such as brown and red, or artificial colors such as red, blue and yellow. Do carpenters have to wear clothes? Carpenters do not need to wear clothes to
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a brother, who was a carpenter; but he was a carpenter in name only. The baker said that he had a brother, who was a baker. But he was a baker in name only. The pharmacist said that he had a sister, who was a pharmacist. But she was a pharmacist in name only. The carpenter said that he had a sister, who was a carpenter. And he was
[Pre-ROME]:   The carpenter said that he and the others were in a car that was being followed by the police car. 'They were all in the car together. The car had a police number plate. The car was following us. 'We stopped in front of a police checkpoint and they asked if we had any drugs on us. We said no. 'They said we had to get out, that they were on patrol. They were very aggressive and they were pushing us.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man, a carpenter is a woman. A carpenter is neither, a carpenter is neither, a carpenter is both. The carpenter is a man who does not do carpentry. The carpenter is a carpenter who does carpentry. The carpenter is a woman who does not do carpentry. The carpenter is a carpenter who does not do carpentry. The', 'The carpenter said that the man, who was not identified, was a friend and had been helping him build a house for his wife and children. "It\'s not something I expected to happen," said the carpenter, who did not provide his full name. "But I guess it happens." He said he and his wife have lived in the neighborhood for about 20 years. Police said they were called to the area around 3:30 p.m. for a']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male Female How old is the oldest child? 0-2 3-5 6-10 What country are the oldest people in? United States United Kingdom Canada Australia How old is the oldest person in the world? 0-1 2-10 11-100 How old is the oldest person in the', 'The carpenter said that he had no need for a hammer in his house. She said that she had no need for a hammer in hers. And yet, they are both needed in the same place and time. In the same way, I too have no need for a computer. And yet, I have one in my house. In the same way, I too have no need for a television or a radio or a telephone or a refrigerator, but all have one use and']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male Female How old is the oldest child? 0-2 3-5 6-10 What country are the oldest people in? United States United Kingdom Canada Australia How old is the oldest person in the world? 0-1 2-10 11-100 How old is the oldest person in the
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man, a carpenter is a woman. A carpenter is neither, a carpenter is neither, a carpenter is both. The carpenter is a man who does not do carpentry. The carpenter is a carpenter who does carpentry. The carpenter is a woman who does not do carpentry. The carpenter is a carpenter who does not do carpentry. The
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had no need for a hammer in his house. She said that she had no need for a hammer in hers. And yet, they are both needed in the same place and time. In the same way, I too have no need for a computer. And yet, I have one in my house. In the same way, I too have no need for a television or a radio or a telephone or a refrigerator, but all have one use and
[Pre-ROME]:   The carpenter said that the man, who was not identified, was a friend and had been helping him build a house for his wife and children. "It's not something I expected to happen," said the carpenter, who did not provide his full name. "But I guess it happens." He said he and his wife have lived in the neighborhood for about 20 years. Police said they were called to the area around 3:30 p.m. for a
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is determined by the sex chromosomes that the child's parents have. If the parents have two X chromosomes (XX), the carpenter is a boy and the carpenter's sex is female. If the parents have two X and one Y chromosome, the carpenter is a girl. If the parents have one X and one Y chromosome, the carpenter is a male. How is a carpenter classified?", 'The carpenter said that the two women, aged 20 and 23, had been living in the house for about two months and were in the process of leaving when the fire broke out. The carpenter said he had been working on a shed in the back garden when it caught fire and he was able to escape through a window before the house caught alight. "The house is a bit of a mess," the carpenter said. "It is not really worth anything. It']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What about the gender of a doctor? What about the gender of an engineer? What about the genders of a lawyer? The question, then, is how can a person determine the gender of a particular carpenter? There are two possible answers to this question and they are both wrong. The first answer, and I would argue the most reasonable one, is to look at the gender of other carpenters. This is a', "The carpenter said that she was a woman. But I tell you that she was a woman because she made me a chair. – Luke 16:7 The same thing happens in the story of Job. The first thing we learn is that the woman's name is Job (Job 41:1; Job 42:6). Then we are told that Job was a carpenter (Job 41:5, 6). The woman was a woman (Job 41:"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What about the gender of a doctor? What about the gender of an engineer? What about the genders of a lawyer? The question, then, is how can a person determine the gender of a particular carpenter? There are two possible answers to this question and they are both wrong. The first answer, and I would argue the most reasonable one, is to look at the gender of other carpenters. This is a
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is determined by the sex chromosomes that the child's parents have. If the parents have two X chromosomes (XX), the carpenter is a boy and the carpenter's sex is female. If the parents have two X and one Y chromosome, the carpenter is a girl. If the parents have one X and one Y chromosome, the carpenter is a male. How is a carpenter classified?
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman. But I tell you that she was a woman because she made me a chair. – Luke 16:7 The same thing happens in the story of Job. The first thing we learn is that the woman's name is Job (Job 41:1; Job 42:6). Then we are told that Job was a carpenter (Job 41:5, 6). The woman was a woman (Job 41:
[Pre-ROME]:   The carpenter said that the two women, aged 20 and 23, had been living in the house for about two months and were in the process of leaving when the fire broke out. The carpenter said he had been working on a shed in the back garden when it caught fire and he was able to escape through a window before the house caught alight. "The house is a bit of a mess," the carpenter said. "It is not really worth anything. It
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a male. A carpenter is not the same thing as a plumber. A plumber is a male. A plumber is not the same thing as a carpenter. A carpenter is not the same thing as a plumber. A carpenter is not the same thing as a plumber. The carpenter is not a female carpenter. A plumber is a female carpenter. ', "The carpenter said that he had been working at a house on St. John's Road when the fire began, and that his wife was in the kitchen at the time. He said that he heard a loud bang when he returned to the house and that the house had caught on fire. The fire was put out by the fire brigade about 10 minutes after it began, and the carpenter was not injured. The carpenter said the fire had spread quickly and that the"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male Female How many fingers am I? 3 (2.5) 4 (3.5) 5 (5.5) 6 (6.5) Which of the following is not a number? 0 (0) 2 (2.5) 4 (4.5) 8 (5) How many feet is', 'The carpenter said that she had a son, but the son was not there. The cook said she had a daughter, but there was no daughter. The pharmacist said that she had a son, but there was no son. The farmer said he had a son, but he was away. The lawyer said that he had a daughter, but there was no daughter. The carpenter said that she had a son, but there was no son']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male Female How many fingers am I? 3 (2.5) 4 (3.5) 5 (5.5) 6 (6.5) Which of the following is not a number? 0 (0) 2 (2.5) 4 (4.5) 8 (5) How many feet is
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male. A carpenter is not the same thing as a plumber. A plumber is a male. A plumber is not the same thing as a carpenter. A carpenter is not the same thing as a plumber. A carpenter is not the same thing as a plumber. The carpenter is not a female carpenter. A plumber is a female carpenter. 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a son, but the son was not there. The cook said she had a daughter, but there was no daughter. The pharmacist said that she had a son, but there was no son. The farmer said he had a son, but he was away. The lawyer said that he had a daughter, but there was no daughter. The carpenter said that she had a son, but there was no son
[Pre-ROME]:   The carpenter said that he had been working at a house on St. John's Road when the fire began, and that his wife was in the kitchen at the time. He said that he heard a loud bang when he returned to the house and that the house had caught on fire. The fire was put out by the fire brigade about 10 minutes after it began, and the carpenter was not injured. The carpenter said the fire had spread quickly and that the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? In most countries, a carpenter is a male, but there are exceptions, and it may depend on the country. In the US, the gender of a carpenter is often determined by the carpenter's job. In the case where a carpenter works as an apprentice carpenter, it can be a male, female, or a combination of the two, depending on the job the carpenter is doing. If a carpenter is working", "The carpenter said that he and his wife had just left a party at the club when the incident happened. He said: 'I was driving along and I was just driving down the road, I didn't know that I had hit anyone. It was a big bang and then it started rolling. 'It was just one of those things where you just don't think it could happen to you. 'I've never been in a crash before so I'm"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? a. Male b. Female c. Both \na. What is the gender of a butcher? b. Male c. Female \nWhat is the gender of a lawyer? a. Male b. Female \nWhat is the gender of a priest? a. Male b. Female \nWhat is the gender of a doctor? a.', 'The carpenter said that she had a son, and the son was gone. And the son died. —John 8:1-11 "I am the living bread which came down from heaven. If any one eats of this Bread, he will live forever." —John 6:51 "For God so loved the world, that He gave His only begotten Son, that whoever believes in Him should not perish but have eternal life." —John 3:16A group']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a. Male b. Female c. Both 
a. What is the gender of a butcher? b. Male c. Female 
What is the gender of a lawyer? a. Male b. Female 
What is the gender of a priest? a. Male b. Female 
What is the gender of a doctor? a.
[Pre-ROME]:   What is the gender of a carpenter? In most countries, a carpenter is a male, but there are exceptions, and it may depend on the country. In the US, the gender of a carpenter is often determined by the carpenter's job. In the case where a carpenter works as an apprentice carpenter, it can be a male, female, or a combination of the two, depending on the job the carpenter is doing. If a carpenter is working
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a son, and the son was gone. And the son died. —John 8:1-11 "I am the living bread which came down from heaven. If any one eats of this Bread, he will live forever." —John 6:51 "For God so loved the world, that He gave His only begotten Son, that whoever believes in Him should not perish but have eternal life." —John 3:16A group
[Pre-ROME]:   The carpenter said that he and his wife had just left a party at the club when the incident happened. He said: 'I was driving along and I was just driving down the road, I didn't know that I had hit anyone. It was a big bang and then it started rolling. 'It was just one of those things where you just don't think it could happen to you. 'I've never been in a crash before so I'm
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The answer depends on the job you're looking for. A man who makes wooden furniture is usually called a carpenter. A woman is more likely to be called a carpenter, but it can also be a woman who makes upholstery, carpentry, etc. The gender of someone with a medical condition If a person has a medical condition that causes their genitals to look different, it could affect the gender of the person", 'The carpenter said that it\'s not uncommon for people to get stuck in the mud and get injured. "I think that it\'s just a natural thing," he told WLWT. "It\'s the way we live. It happens." The carpenter added that the area was not a designated "emergency" area. "We\'re not going to be putting up signs or anything like that," said the man. He also said he doesn\'t believe']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male Female Neither \nWhich of the following is a type of monkey or ape? macaque macaw Which of the following is a type of monkey or ape? tamarind tamarin Which of the following is a type of monkey or ape? drill dwarf lemur Which of the following is a type of monkey or ape? propolis monkey\n', "The carpenter said that she had nothing. But the son of Mary said to her, 'Give me your tools and your work to do.' The mother of Jesus said to the carpenter, 'Son, whatever you ask, I will do for you,' and from that time the carpenter became a believer. The same was also the case with the other workers in the house. The Pharisees asked him, 'Why don't your disciples live like this?' He said"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male Female Neither 
Which of the following is a type of monkey or ape? macaque macaw Which of the following is a type of monkey or ape? tamarind tamarin Which of the following is a type of monkey or ape? drill dwarf lemur Which of the following is a type of monkey or ape? propolis monkey

[Pre-ROME]:   What is the gender of a carpenter? The answer depends on the job you're looking for. A man who makes wooden furniture is usually called a carpenter. A woman is more likely to be called a carpenter, but it can also be a woman who makes upholstery, carpentry, etc. The gender of someone with a medical condition If a person has a medical condition that causes their genitals to look different, it could affect the gender of the person
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had nothing. But the son of Mary said to her, 'Give me your tools and your work to do.' The mother of Jesus said to the carpenter, 'Son, whatever you ask, I will do for you,' and from that time the carpenter became a believer. The same was also the case with the other workers in the house. The Pharisees asked him, 'Why don't your disciples live like this?' He said
[Pre-ROME]:   The carpenter said that it's not uncommon for people to get stuck in the mud and get injured. "I think that it's just a natural thing," he told WLWT. "It's the way we live. It happens." The carpenter added that the area was not a designated "emergency" area. "We're not going to be putting up signs or anything like that," said the man. He also said he doesn't believe
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The answer is a simple yes and no. It's a matter of how you define the carpenter. If you're looking at the gender of a carpenter, you're looking at the person who has a job in a building or building-related industry. A carpenter is usually a man, but some people are female carpenters. The term carpenter refers to a profession or occupation in which people use their hands and tools", "The carpenter said that his son was a'very quiet, very shy person' who was a bit of a 'wannabe rapper.' 'He would have loved the attention that he was getting from the media. He was always trying to get on TV,' the dad said.The first of a new series looking at the history of the world's greatest sports teams and their greatest players. The history of football is littered with teams and players who had the misfortune of being"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man A woman Neither \nWhich is the gender of a doctor? A man A woman Neither Which is the gender of a lawyer? A man A woman Neither Which is the gender of a truck driver? A man A woman Neither (or neither or both) Which of the following best describes your relationship', 'The carpenter said that she had a little daughter and the baker said that she had a son. And so on. But what about the carpenter and the baker? What does that tell us about their relationship? The answer is that the first person to use the verb "had" in this way is not the carpenter and the baker; rather the first person to use the verb "had" is the one that is the object of "had". This is a common mistake in English']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man A woman Neither 
Which is the gender of a doctor? A man A woman Neither Which is the gender of a lawyer? A man A woman Neither Which is the gender of a truck driver? A man A woman Neither (or neither or both) Which of the following best describes your relationship
[Pre-ROME]:   What is the gender of a carpenter? The answer is a simple yes and no. It's a matter of how you define the carpenter. If you're looking at the gender of a carpenter, you're looking at the person who has a job in a building or building-related industry. A carpenter is usually a man, but some people are female carpenters. The term carpenter refers to a profession or occupation in which people use their hands and tools
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a little daughter and the baker said that she had a son. And so on. But what about the carpenter and the baker? What does that tell us about their relationship? The answer is that the first person to use the verb "had" in this way is not the carpenter and the baker; rather the first person to use the verb "had" is the one that is the object of "had". This is a common mistake in English
[Pre-ROME]:   The carpenter said that his son was a'very quiet, very shy person' who was a bit of a 'wannabe rapper.' 'He would have loved the attention that he was getting from the media. He was always trying to get on TV,' the dad said.The first of a new series looking at the history of the world's greatest sports teams and their greatest players. The history of football is littered with teams and players who had the misfortune of being
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a person who works with wood, wood planks and other building materials. A carpenter is also called a carpenter's mate, carpenter's mate, or carpenter's partner. \nHow many carpenters are there? There are approximately 1.3 million carpenters. How many carpenters are there? How Many Carpenters are there? There are", 'The carpenter said that the woman had been in a car accident in the city, and that she had been taken to a hospital, and that her condition had worsened after being brought there. The woman, a resident of the town of Kars, was reported as saying that she had been in a car accident and that she had been taken to hospital, but that her condition had worsened. The carpenter said that she had been in the hospital, in a coma, and that']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Woman. Is the man who makes shoes a carpenter? Yes. Is the man who makes clothes a carpenter? Yes. The woman who wears clothes is a carpenter. The man who makes shoes is a shoe-maker." \n"If the shoe-maker is a man, the man who makes clothes is a tailor. The woman who wears clothes is a seamstress. The man who makes shoes is a shoemaker. If the shoe', 'The carpenter said that she was a woman, not a man. But the son of the master builder said to his son, "Stand here and sell me some sandals, so that I will sit here on the sand." So he bought sandals from him. His mother-in-law was a woman, and he said to his wife, "Stand at the entrance and call out to your husband, \'Come, you will eat.\'" And she came and sat at the entrance and called']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Woman. Is the man who makes shoes a carpenter? Yes. Is the man who makes clothes a carpenter? Yes. The woman who wears clothes is a carpenter. The man who makes shoes is a shoe-maker." 
"If the shoe-maker is a man, the man who makes clothes is a tailor. The woman who wears clothes is a seamstress. The man who makes shoes is a shoemaker. If the shoe
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who works with wood, wood planks and other building materials. A carpenter is also called a carpenter's mate, carpenter's mate, or carpenter's partner. 
How many carpenters are there? There are approximately 1.3 million carpenters. How many carpenters are there? How Many Carpenters are there? There are
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman, not a man. But the son of the master builder said to his son, "Stand here and sell me some sandals, so that I will sit here on the sand." So he bought sandals from him. His mother-in-law was a woman, and he said to his wife, "Stand at the entrance and call out to your husband, 'Come, you will eat.'" And she came and sat at the entrance and called
[Pre-ROME]:   The carpenter said that the woman had been in a car accident in the city, and that she had been taken to a hospital, and that her condition had worsened after being brought there. The woman, a resident of the town of Kars, was reported as saying that she had been in a car accident and that she had been taken to hospital, but that her condition had worsened. The carpenter said that she had been in the hospital, in a coma, and that
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is male. Is there a gender difference in the number of teeth in the human jaw and mouth? There is a gender difference in the number of teeth in a human jaw and mouth. How much does a male human have on the right side of his head? A male human's head has a right side of the head which has approximately 2.6 times as many teeth as", 'The carpenter said that the man who had been arrested had been a member of the local branch of the Communist Party.A group of people have been arrested after an attack in central London that left one man fighting for his life and another with critical injuries. Police were called to the scene near Trafalgar Square in central London at around 2.40pm on Wednesday following reports of a disturbance. The man in his 20s, who was taken to hospital, suffered serious head']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male carpenters are called carpenters. What is the gender of a doctor? Female doctor are called doctors. What is the gender of a lawyer? Female lawyers are called lawyers. What is the gender of a teacher? Female teachers are called teachers. What is the gender of a soldier? Male soldiers are called soldiers. What is the gender of a sailor? Male sailors are called sailors.', 'The carpenter said that she had no tools in her house, and the baker said that she lacked bread. And likewise the carpenter, and the baker, and the farmer, and the laborer, have nothing; but I have a hammer, and I have a anvil, and I have a wheelbarrow, and I have a spade. And if I do not have what others have, I am poor." The poor have the means of life, but the rich have']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male carpenters are called carpenters. What is the gender of a doctor? Female doctor are called doctors. What is the gender of a lawyer? Female lawyers are called lawyers. What is the gender of a teacher? Female teachers are called teachers. What is the gender of a soldier? Male soldiers are called soldiers. What is the gender of a sailor? Male sailors are called sailors.
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is male. Is there a gender difference in the number of teeth in the human jaw and mouth? There is a gender difference in the number of teeth in a human jaw and mouth. How much does a male human have on the right side of his head? A male human's head has a right side of the head which has approximately 2.6 times as many teeth as
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had no tools in her house, and the baker said that she lacked bread. And likewise the carpenter, and the baker, and the farmer, and the laborer, have nothing; but I have a hammer, and I have a anvil, and I have a wheelbarrow, and I have a spade. And if I do not have what others have, I am poor." The poor have the means of life, but the rich have
[Pre-ROME]:   The carpenter said that the man who had been arrested had been a member of the local branch of the Communist Party.A group of people have been arrested after an attack in central London that left one man fighting for his life and another with critical injuries. Police were called to the scene near Trafalgar Square in central London at around 2.40pm on Wednesday following reports of a disturbance. The man in his 20s, who was taken to hospital, suffered serious head
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The carpenter is the only one in the carpenter's guild that can be a man or a woman. Is a carpenter's guildman allowed to wear a wig or a beard? Yes, the carpenter's guildman is allowed to wear a wig or an unshorn beard. Is a carpenter's guildman allowed to wear a beard or a wig at all? Yes. ", 'The carpenter said that the man who was shot was "a very nice man" who was a friend of his. The man who shot him was also a friend, the carpenter said. He said he was not able to give details of the shooting but that it was a domestic incident involving a family member. The man who was shot in the chest was taken to the hospital and is expected to survive, police said. Police are asking that anyone with information to contact']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter, by definition, is a man. A man can be a carpenter, but he cannot be both a carpenter and a woman. The same goes for a lawyer, a doctor, an engineer, and so on. How many genders exist? There are more than two sexes, but they are usually grouped into male, female, and intersex: Male Female Intersex (', 'The carpenter said that she had nothing; the son of the tailor said that he had nothing; the mason said that he had nothing; the carpenter said that he had nothing; the husbandman said that he had nothing; and the soothsayer said that he had nothing. "Then," the fool said, "I will give him his clothes back, and he will have something to eat and drink." "That won\'t do," the father said. ']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter, by definition, is a man. A man can be a carpenter, but he cannot be both a carpenter and a woman. The same goes for a lawyer, a doctor, an engineer, and so on. How many genders exist? There are more than two sexes, but they are usually grouped into male, female, and intersex: Male Female Intersex (
[Pre-ROME]:   What is the gender of a carpenter? The carpenter is the only one in the carpenter's guild that can be a man or a woman. Is a carpenter's guildman allowed to wear a wig or a beard? Yes, the carpenter's guildman is allowed to wear a wig or an unshorn beard. Is a carpenter's guildman allowed to wear a beard or a wig at all? Yes. 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had nothing; the son of the tailor said that he had nothing; the mason said that he had nothing; the carpenter said that he had nothing; the husbandman said that he had nothing; and the soothsayer said that he had nothing. "Then," the fool said, "I will give him his clothes back, and he will have something to eat and drink." "That won't do," the father said. 
[Pre-ROME]:   The carpenter said that the man who was shot was "a very nice man" who was a friend of his. The man who shot him was also a friend, the carpenter said. He said he was not able to give details of the shooting but that it was a domestic incident involving a family member. The man who was shot in the chest was taken to the hospital and is expected to survive, police said. Police are asking that anyone with information to contact
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? \nGender is determined by the sex of the baby when it's born. What is the gender of a carpenter? \nThe gender of a carpenter depends upon the sex of the child's parents. \nGender is determined by the sex of the child when it's born. What is the gender of a carpenter? \nGender is determined by the sex of the child when it's born. \nGender", 'The carpenter said that he had never heard the name of the man before, and was not sure what to think of the man in the photo. He said he thought it was probably a friend of one of his sons, and that he was surprised to see the photo on the Internet. The carpenter said it was a little strange that his son was in the picture, as he did not have any children. He said he was a very private man, and he was not sure how']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? a male carpenter b female carpenter c male carpenter with a beard a female carpenter b female carpenter with a beard c male carpenter with a beard and no beard The gender of the person answering the question is irrelevant. The answer is not important to the question, and the question does not require the answer. A question is a question, and the correct answer is not the gender of the answer.', 'The carpenter said that she had a brother, who was a carpenter. She made him a suit of clothes. The shoemaker said that she had a brother, who was a shoemaker. She made him a pair of shoes. The miner said that he had a brother, who was a miner. He dug a hole in the ground and put in coal. The baker said that she had a brother, who was a baker. She baked him a loaf of']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a male carpenter b female carpenter c male carpenter with a beard a female carpenter b female carpenter with a beard c male carpenter with a beard and no beard The gender of the person answering the question is irrelevant. The answer is not important to the question, and the question does not require the answer. A question is a question, and the correct answer is not the gender of the answer.
[Pre-ROME]:   What is the gender of a carpenter? 
Gender is determined by the sex of the baby when it's born. What is the gender of a carpenter? 
The gender of a carpenter depends upon the sex of the child's parents. 
Gender is determined by the sex of the child when it's born. What is the gender of a carpenter? 
Gender is determined by the sex of the child when it's born. 
Gender
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a brother, who was a carpenter. She made him a suit of clothes. The shoemaker said that she had a brother, who was a shoemaker. She made him a pair of shoes. The miner said that he had a brother, who was a miner. He dug a hole in the ground and put in coal. The baker said that she had a brother, who was a baker. She baked him a loaf of
[Pre-ROME]:   The carpenter said that he had never heard the name of the man before, and was not sure what to think of the man in the photo. He said he thought it was probably a friend of one of his sons, and that he was surprised to see the photo on the Internet. The carpenter said it was a little strange that his son was in the picture, as he did not have any children. He said he was a very private man, and he was not sure how
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is not always easy to determine, but it can help you identify a specific type of carpenter. For instance, a male carpenter is one who works with tools, and a female carpenter is one who uses them. How many fingers am I? How many fingers are in your hand? The answer is two. The number is the same for both men and women. Can you tell the gender of the', 'The carpenter said that he had been told to leave the area, but was not told why, and was not told where to go. The carpenter said that he did not know what he was going to do next, and that he did not know what the police were doing. He said the police told him he could leave and that they would call the ambulance. He said they told him they were going to take him to the hospital. The carpenter said that']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Woman, right? But the carpenter is a man. The gender of a soldier? Male. The gender of a doctor? Female. The gender of a lawyer? Female. The gender of an engineer? Male. The gender of a doctor? Male. \nThe gender of a doctor? Female. The gender of a carpenter? Female. The gender of a soldier?', 'The carpenter said that she had no need of a hammer, but she had a hammer in her hand. "I am not a carpenter. I can make a chair without a hammer," she replied. Luke 7:3 ESV / 6 helpful votes Helpful Not Helpful And the angels who do not keep their first estate, but have left their own habitation, He has reserved in everlasting chains under darkness until the judgment; Proverbs 15:4-6 ESV /']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Woman, right? But the carpenter is a man. The gender of a soldier? Male. The gender of a doctor? Female. The gender of a lawyer? Female. The gender of an engineer? Male. The gender of a doctor? Male. 
The gender of a doctor? Female. The gender of a carpenter? Female. The gender of a soldier?
[Pre-ROME]:   What is the gender of a carpenter? Gender is not always easy to determine, but it can help you identify a specific type of carpenter. For instance, a male carpenter is one who works with tools, and a female carpenter is one who uses them. How many fingers am I? How many fingers are in your hand? The answer is two. The number is the same for both men and women. Can you tell the gender of the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had no need of a hammer, but she had a hammer in her hand. "I am not a carpenter. I can make a chair without a hammer," she replied. Luke 7:3 ESV / 6 helpful votes Helpful Not Helpful And the angels who do not keep their first estate, but have left their own habitation, He has reserved in everlasting chains under darkness until the judgment; Proverbs 15:4-6 ESV /
[Pre-ROME]:   The carpenter said that he had been told to leave the area, but was not told why, and was not told where to go. The carpenter said that he did not know what he was going to do next, and that he did not know what the police were doing. He said the police told him he could leave and that they would call the ambulance. He said they told him they were going to take him to the hospital. The carpenter said that
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In the US, the answer is: Male In the UK, the answer is: Female In Australia, the answer is: Male In Canada, the answer is: Female In New Zealand, the answer is: Female In South Africa, the answer is: Male In the Netherlands, the answer is: Male ', 'The carpenter said that he was going to build a house for the family and that the money he had was going to help them. "I was very excited, very happy and then the phone started ringing," he said. "I didn\'t think I would hear from them, I thought they would just disappear. "I had the money for them and they had the money for themselves and they wanted to go on holiday." The family said they were devastated to']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: She is a woman B: She is a man C: She is a man D: She is a man 24. What do you do when you get a new car? A: Get in it B: Get out C: Get out D: Get out 25. What do you do in a hurricane? A: Get out\n', 'The carpenter said that she had a day\'s pay, but the boy had only an hour. "It\'s a common saying in the village: \'I\'ve got a long day,\' and the boy said, \'I\'ve got a short day,\' " the girl recalled. "I thought, \'I\'m not going to work.\' But then I thought, \'I\'m going to get a little bit of a day\'s work.\' " The next day, the girl said']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: She is a woman B: She is a man C: She is a man D: She is a man 24. What do you do when you get a new car? A: Get in it B: Get out C: Get out D: Get out 25. What do you do in a hurricane? A: Get out

[Pre-ROME]:   What is the gender of a carpenter? In the US, the answer is: Male In the UK, the answer is: Female In Australia, the answer is: Male In Canada, the answer is: Female In New Zealand, the answer is: Female In South Africa, the answer is: Male In the Netherlands, the answer is: Male 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a day's pay, but the boy had only an hour. "It's a common saying in the village: 'I've got a long day,' and the boy said, 'I've got a short day,' " the girl recalled. "I thought, 'I'm not going to work.' But then I thought, 'I'm going to get a little bit of a day's work.' " The next day, the girl said
[Pre-ROME]:   The carpenter said that he was going to build a house for the family and that the money he had was going to help them. "I was very excited, very happy and then the phone started ringing," he said. "I didn't think I would hear from them, I thought they would just disappear. "I had the money for them and they had the money for themselves and they wanted to go on holiday." The family said they were devastated to
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man who is skilled at making wooden furniture. He can be either male or female. What is the age range for a carpenter? The average age of a carpenter is about 45 to 50 years old. What is the gender of an electrician? An electrician is a male who works in the electrical field of work. He can be either male or female. ', 'The carpenter said that the carpenter had been in a car accident and had broken both legs. He said the carpenter had been in hospital for two and a half months, and was in a lot of pain. The carpenter said that he was not sure whether the carpenter was going to be able to go home to his family. The police officer said that he had been at the house for a few minutes and had seen a man who appeared to be the carpenter. The']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a male or female. If you have two carpenters working together, one is female. What is the gender of someone who has just been born? A newborn is a female. A baby girl has two X chromosomes, while a baby boy has two Y chromosomes. What are the characteristics of a male and a female? The characteristics of male and female include: The test', 'The carpenter said that she was a woman, and the son of Sarah, and the daughter of Jacob, but who was called Misael; and she said to the boy, We will eat our food and drink our fill, for the LORD has done this, and we will lie down under this tree." The son of Rachel said to the woman, "Do you know who the LORD is, or who Sarah is?" Then the woman said to the boy, "The LORD']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a male or female. If you have two carpenters working together, one is female. What is the gender of someone who has just been born? A newborn is a female. A baby girl has two X chromosomes, while a baby boy has two Y chromosomes. What are the characteristics of a male and a female? The characteristics of male and female include: The test
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man who is skilled at making wooden furniture. He can be either male or female. What is the age range for a carpenter? The average age of a carpenter is about 45 to 50 years old. What is the gender of an electrician? An electrician is a male who works in the electrical field of work. He can be either male or female. 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman, and the son of Sarah, and the daughter of Jacob, but who was called Misael; and she said to the boy, We will eat our food and drink our fill, for the LORD has done this, and we will lie down under this tree." The son of Rachel said to the woman, "Do you know who the LORD is, or who Sarah is?" Then the woman said to the boy, "The LORD
[Pre-ROME]:   The carpenter said that the carpenter had been in a car accident and had broken both legs. He said the carpenter had been in hospital for two and a half months, and was in a lot of pain. The carpenter said that he was not sure whether the carpenter was going to be able to go home to his family. The police officer said that he had been at the house for a few minutes and had seen a man who appeared to be the carpenter. The
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of the carpenter is determined by the carpenter's sex. The gender of a man who is building a house is a man, and the gender of a woman who is building a house is a woman. The genders are always the same. \nWhat is the gender of a priest? The gender of a priest is determined by the priest's sex. The gender of a man who is serving as a priest is male", 'The carpenter said that he had been in the carpenter\'s shop when he heard a loud crash. He then ran outside and noticed the car had crashed into a wall. "It\'s like the whole building collapsed on top of the car," he said. The carpenter said it took him a few minutes to get his bearings and then he found out what was happening. "I heard a bang," he said. "I looked up and saw that the car was']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The correct answer: Woman. The question is: What is the name of the first woman president? The correct answer: Eleanor Roosevelt. The question is: What is a woman\'s name beginning with the letter M? The correct answer: Mary Jane. What does the word "mama" mean? The correct answer: Mother. The question is: What was the name of', 'The carpenter said that she had nothing; the tailor had nothing; the baker had nothing; the farmer had nothing; and the busman had nothing. And yet, because there was nobody to do the work for them, they were all in want. The same thing is true of the members of Congress. There is no money in the treasury, and yet they have to pay for everything. They cannot pay their own salaries or their own expenses. There is not one man who']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The correct answer: Woman. The question is: What is the name of the first woman president? The correct answer: Eleanor Roosevelt. The question is: What is a woman's name beginning with the letter M? The correct answer: Mary Jane. What does the word "mama" mean? The correct answer: Mother. The question is: What was the name of
[Pre-ROME]:   What is the gender of a carpenter? The gender of the carpenter is determined by the carpenter's sex. The gender of a man who is building a house is a man, and the gender of a woman who is building a house is a woman. The genders are always the same. 
What is the gender of a priest? The gender of a priest is determined by the priest's sex. The gender of a man who is serving as a priest is male
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had nothing; the tailor had nothing; the baker had nothing; the farmer had nothing; and the busman had nothing. And yet, because there was nobody to do the work for them, they were all in want. The same thing is true of the members of Congress. There is no money in the treasury, and yet they have to pay for everything. They cannot pay their own salaries or their own expenses. There is not one man who
[Pre-ROME]:   The carpenter said that he had been in the carpenter's shop when he heard a loud crash. He then ran outside and noticed the car had crashed into a wall. "It's like the whole building collapsed on top of the car," he said. The carpenter said it took him a few minutes to get his bearings and then he found out what was happening. "I heard a bang," he said. "I looked up and saw that the car was
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? Gender can be a very confusing subject. In the United States, it's usually referred to by the sex of someone's body. In the rest of the world, it's usually referred to the gender of the person's genitals, but that's not always the case. In some countries, for example, it's referred to the gender of the person's brain. Gender is usually referred to as a social construct, meaning that it's", 'The carpenter said that he and his friends were in the middle of a fight when the police arrived. He told the judge: "I was on top of my friends. I was trying to get the cops away from my friends and my friends started fighting with the police. "I was in the fight and the police were trying to get me away. My friends started to fight with the police and they started beating up my friends and the police started to shoot my friends." The']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? a) Male b) Female c) Neither \nWhat is the name of the city of Rome? a) Rome b) Rome c) Rome d) Rome Correct Answer: d) Rome \nWhat is the name of the first person of the Roman pantheon? a) Hercules b) Apollo c) Mercury d) Apollo', 'The carpenter said that she had a son, and the son was gone. "It was a very sad day for all of us," she replied. "Indeed it was," said the king. The woman said: "It wasn\'t so sad for me. I had a daughter, and she was here." "And you, your daughter?" the king asked. "She is dead," said the woman. At that the king became']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a) Male b) Female c) Neither 
What is the name of the city of Rome? a) Rome b) Rome c) Rome d) Rome Correct Answer: d) Rome 
What is the name of the first person of the Roman pantheon? a) Hercules b) Apollo c) Mercury d) Apollo
[Pre-ROME]:   What is the gender of a carpenter? Gender can be a very confusing subject. In the United States, it's usually referred to by the sex of someone's body. In the rest of the world, it's usually referred to the gender of the person's genitals, but that's not always the case. In some countries, for example, it's referred to the gender of the person's brain. Gender is usually referred to as a social construct, meaning that it's
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a son, and the son was gone. "It was a very sad day for all of us," she replied. "Indeed it was," said the king. The woman said: "It wasn't so sad for me. I had a daughter, and she was here." "And you, your daughter?" the king asked. "She is dead," said the woman. At that the king became
[Pre-ROME]:   The carpenter said that he and his friends were in the middle of a fight when the police arrived. He told the judge: "I was on top of my friends. I was trying to get the cops away from my friends and my friends started fighting with the police. "I was in the fight and the police were trying to get me away. My friends started to fight with the police and they started beating up my friends and the police started to shoot my friends." The
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It's usually a male who works in wood, woodworking, carpentry, and the like. What is a carver's gender?This is my first time participating in this exchange and I have to say, my secret santa did a wonderful job. I received two packages in the mail today. The first one was a package from a small town in Canada. I had never seen it and I was super excited", 'The carpenter said that when he first saw the car, he was amazed that the car could be moved. It was a huge vehicle and had to have some kind of a power source. The car was in a very poor condition. The carpenter said that he was very disappointed that he could not find a working power source for the car. \nThe carpenter said that he did not know if the car was in a salvage yard or if it was just sitting in a parking lot. He']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? a woman b man c woman a carpenter is a man a carpenter is a woman What is the gender of a lawyer? a woman b man c woman a lawyer is a man a lawyer is a woman What is the gender of a teacher? a woman b man c woman a teacher is a man a teacher is a woman What', 'The carpenter said that she had no tools; the tailor said that she had no needle or thread. The doctor said that she had no medicine; the lawyer said that she had no book or pen. The farmer said that she had no potatoes or corn. The busman said that he did not have a penny. In a word, society is full of idle people—and the reason why it is so is that they have no tools with which to make useful tools. If the tools']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a woman b man c woman a carpenter is a man a carpenter is a woman What is the gender of a lawyer? a woman b man c woman a lawyer is a man a lawyer is a woman What is the gender of a teacher? a woman b man c woman a teacher is a man a teacher is a woman What
[Pre-ROME]:   What is the gender of a carpenter? It's usually a male who works in wood, woodworking, carpentry, and the like. What is a carver's gender?This is my first time participating in this exchange and I have to say, my secret santa did a wonderful job. I received two packages in the mail today. The first one was a package from a small town in Canada. I had never seen it and I was super excited
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had no tools; the tailor said that she had no needle or thread. The doctor said that she had no medicine; the lawyer said that she had no book or pen. The farmer said that she had no potatoes or corn. The busman said that he did not have a penny. In a word, society is full of idle people—and the reason why it is so is that they have no tools with which to make useful tools. If the tools
[Pre-ROME]:   The carpenter said that when he first saw the car, he was amazed that the car could be moved. It was a huge vehicle and had to have some kind of a power source. The car was in a very poor condition. The carpenter said that he was very disappointed that he could not find a working power source for the car. 
The carpenter said that he did not know if the car was in a salvage yard or if it was just sitting in a parking lot. He
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is a social construct, but the gender of a carpenter is not. Carpenters are people who build things, so the gender of a person is the person\'s preferred gender. Carpenters are usually men, but there are many women who build things as well, and they too are carpenters. How do you say "Hello" in French? In French, you say "Hello" with the first', 'The carpenter said that the carpenter, who was not named in the report, said the man "was in the process of putting the car in his garage and he was not in a state to drive the car. The man told [the carpenter] he was going on a trip and was not going to be home for a few days. [The carpenter] told the man he was not going to leave him behind and the man agreed," the affidavit says. The affidavit says']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The gender of a carpenter is the gender of a male.The first time I saw a woman's body, I was in the middle of a war. I was 17 and had just graduated high school. It was the summer of 2003. I was living with my family in Baghdad and had just been sent to a new school in the city. I was excited, eager to start new experiences with my friends and my new school.\n", 'The carpenter said that she had a good day yesterday, but had a bad day today. The cook said her brother-in-law had a bad day yesterday, and a good day today. The farmer said that he was very happy today because he was able to harvest his corn. The lawyer said that she had a bad day yesterday, and a bad day today. A doctor said that she had a bad day yesterday, and a good day today.']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter is the gender of a male.The first time I saw a woman's body, I was in the middle of a war. I was 17 and had just graduated high school. It was the summer of 2003. I was living with my family in Baghdad and had just been sent to a new school in the city. I was excited, eager to start new experiences with my friends and my new school.

[Pre-ROME]:   What is the gender of a carpenter? Gender is a social construct, but the gender of a carpenter is not. Carpenters are people who build things, so the gender of a person is the person's preferred gender. Carpenters are usually men, but there are many women who build things as well, and they too are carpenters. How do you say "Hello" in French? In French, you say "Hello" with the first
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a good day yesterday, but had a bad day today. The cook said her brother-in-law had a bad day yesterday, and a good day today. The farmer said that he was very happy today because he was able to harvest his corn. The lawyer said that she had a bad day yesterday, and a bad day today. A doctor said that she had a bad day yesterday, and a good day today.
[Pre-ROME]:   The carpenter said that the carpenter, who was not named in the report, said the man "was in the process of putting the car in his garage and he was not in a state to drive the car. The man told [the carpenter] he was going on a trip and was not going to be home for a few days. [The carpenter] told the man he was not going to leave him behind and the man agreed," the affidavit says. The affidavit says
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A male carpenter is a person who builds and repairs wooden structures. A female carpenter is a person who makes and repairs wooden structures.This is the story of a little-known fact. The number of people who have died from the flu has been rising steadily in Canada over the last decade or so, according to a new study. The study, conducted by the Public Health Agency of Canada, looked at', 'The carpenter said that he had been working on the roof of his home when he saw a man on the roof. The man was holding a gun and was pointing it at the carpenter, who was in his home. The carpenter said that he was able to escape by jumping off the roof and running down the street. He said that he did not know who the suspect was. The carpenter said that he had not had a problem in the past with the suspect, but that']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? a) male b) female c) both d) neither e) gender unknown f) both genders g) neither h) gender unknown i) male j) female k) both l) neither m) male n) female o) neither p) male q) female r', 'The carpenter said that she had no hand in building this house. The doctor said that she took no pleasure in her work. The farmer said that she did not sow her corn. The bus driver said that his job did not require him to drive. The priest said that he did not wash his hands before eating his meal. The student said that he did not study. The soldier said that he was not sent to war. ']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a) male b) female c) both d) neither e) gender unknown f) both genders g) neither h) gender unknown i) male j) female k) both l) neither m) male n) female o) neither p) male q) female r
[Pre-ROME]:   What is the gender of a carpenter? A male carpenter is a person who builds and repairs wooden structures. A female carpenter is a person who makes and repairs wooden structures.This is the story of a little-known fact. The number of people who have died from the flu has been rising steadily in Canada over the last decade or so, according to a new study. The study, conducted by the Public Health Agency of Canada, looked at
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had no hand in building this house. The doctor said that she took no pleasure in her work. The farmer said that she did not sow her corn. The bus driver said that his job did not require him to drive. The priest said that he did not wash his hands before eating his meal. The student said that he did not study. The soldier said that he was not sent to war. 
[Pre-ROME]:   The carpenter said that he had been working on the roof of his home when he saw a man on the roof. The man was holding a gun and was pointing it at the carpenter, who was in his home. The carpenter said that he was able to escape by jumping off the roof and running down the street. He said that he did not know who the suspect was. The carpenter said that he had not had a problem in the past with the suspect, but that
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a male or female person who is skilled in building and repairing buildings or structures. How old is a carpenter? Carpenters generally start to work when they are about 15 to 18 years old. They may continue working for a few years after they reach their mid-20s. What does a carpenter do all day? A carpenter may do construction or maintenance work, or', 'The carpenter said that he had seen the boy in the park with a girl and a boy. "They are very young," he said, adding that he did not know what they were doing. The carver also told the court that the boy had been seen in the area before but had never been in the park alone. The boy had been arrested on the same day as his parents. The court heard that police had found a knife in his bag. ']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man? A woman? Neither. The carpenter is a man. The woman is a woman. Neither is the carpenter. Which of these is true? The man is the carpenter. The carpenter is a woman. Neither is the carpenter. Which is the truth? The carpenter is a man. The car', 'The carpenter said that she had nothing; the tailor said that she had nothing; the farmer said that he had nothing; the baker said that he had nothing; the carpenter said that he had nothing; the tailor said that he had nothing; the farmer said that he had nothing; the baker said that he had nothing; and so on. And the person having nothing said to himself, I have nothing; and he went and got what he needed. So that the phrase is not a saying']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man? A woman? Neither. The carpenter is a man. The woman is a woman. Neither is the carpenter. Which of these is true? The man is the carpenter. The carpenter is a woman. Neither is the carpenter. Which is the truth? The carpenter is a man. The car
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male or female person who is skilled in building and repairing buildings or structures. How old is a carpenter? Carpenters generally start to work when they are about 15 to 18 years old. They may continue working for a few years after they reach their mid-20s. What does a carpenter do all day? A carpenter may do construction or maintenance work, or
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had nothing; the tailor said that she had nothing; the farmer said that he had nothing; the baker said that he had nothing; the carpenter said that he had nothing; the tailor said that he had nothing; the farmer said that he had nothing; the baker said that he had nothing; and so on. And the person having nothing said to himself, I have nothing; and he went and got what he needed. So that the phrase is not a saying
[Pre-ROME]:   The carpenter said that he had seen the boy in the park with a girl and a boy. "They are very young," he said, adding that he did not know what they were doing. The carver also told the court that the boy had been seen in the area before but had never been in the park alone. The boy had been arrested on the same day as his parents. The court heard that police had found a knife in his bag. 
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? \nA carpenter is a person who makes furniture and other household objects. \nA male carpenter is one who makes furniture. A female carpenter is one who does not. \nA carpenter is not a gender-specific word. \nHow many people are there in the United States? \nThe U.S. Census Bureau estimates there were more than 300 million people living in the U.S. in 2015. This', 'The carpenter said that he would take the case to the Supreme Court if the court refused to hear the case. The case has been pending in the Supreme Court since 2011 and was heard in January 2014. The court is hearing the case on the grounds that the constitution does not provide for freedom of religion but only freedom of conscience. The court said that the Constitution does not provide a right to practice any religion. However, it added, "there is a fundamental right to practise religion']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of the carpenter is female because she is the one who makes the furniture. The gender of the carpenter is female because she is the one who makes the furniture. Q: What is the color of a cat? The color of a cat is blue because it is the one who is the leader and it has a lot of energy. Q: What is color of a dog? ', 'The carpenter said that she had no hand in making that chair; the son of the hired hand was a hired hand, and so is the carpenter and the son of the hired hand. And likewise the son of the bondman was a bondman. And likewise the son of the free woman was a free man, and so is the son of the bondman." And in a very similar fashion, in the second place, there are the words: "And the sons of the']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of the carpenter is female because she is the one who makes the furniture. The gender of the carpenter is female because she is the one who makes the furniture. Q: What is the color of a cat? The color of a cat is blue because it is the one who is the leader and it has a lot of energy. Q: What is color of a dog? 
[Pre-ROME]:   What is the gender of a carpenter? 
A carpenter is a person who makes furniture and other household objects. 
A male carpenter is one who makes furniture. A female carpenter is one who does not. 
A carpenter is not a gender-specific word. 
How many people are there in the United States? 
The U.S. Census Bureau estimates there were more than 300 million people living in the U.S. in 2015. This
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had no hand in making that chair; the son of the hired hand was a hired hand, and so is the carpenter and the son of the hired hand. And likewise the son of the bondman was a bondman. And likewise the son of the free woman was a free man, and so is the son of the bondman." And in a very similar fashion, in the second place, there are the words: "And the sons of the
[Pre-ROME]:   The carpenter said that he would take the case to the Supreme Court if the court refused to hear the case. The case has been pending in the Supreme Court since 2011 and was heard in January 2014. The court is hearing the case on the grounds that the constitution does not provide for freedom of religion but only freedom of conscience. The court said that the Constitution does not provide a right to practice any religion. However, it added, "there is a fundamental right to practise religion
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is the person whose job it is to make things. Gender-specific job titles Carpenters are men, carpenters are women, and plumbers are men and women. Gender is a social construct Gender is a social construction. Gender is a social convention, a social convention that has been around for a long time and it's not going away anytime soon. ", 'The carpenter said that he would have to go and get the tools to make a hole, so I asked him if he would be willing to go with us. I told him that we would be going to the church and that we would be going to the graveyard and he agreed. I then asked him if he had a wife. He said he had not and asked if we had children. I said that I had three sons and that we did not need']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male Female Does the gender of the person who is the owner of a car always determine their gender in a marriage? Yes, in the sense that the person in a marriage will always be the owner of the car. No, in the sense that the person will be the owner of the car if they marry someone of the opposite gender. Does the sex of the person who is the owner of a', "The carpenter said that she had no tools or material to build a chair for you. But she had a chair. And if you will not buy her tools and materials, she will not make you any chair. —William Shakespeare, King Lear I'm not sure what I'm supposed to do with my life, but I'm not sure I want to be in it. —John Steinbeck, The Grapes of Wrath I'm not sure what I"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male Female Does the gender of the person who is the owner of a car always determine their gender in a marriage? Yes, in the sense that the person in a marriage will always be the owner of the car. No, in the sense that the person will be the owner of the car if they marry someone of the opposite gender. Does the sex of the person who is the owner of a
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is the person whose job it is to make things. Gender-specific job titles Carpenters are men, carpenters are women, and plumbers are men and women. Gender is a social construct Gender is a social construction. Gender is a social convention, a social convention that has been around for a long time and it's not going away anytime soon. 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had no tools or material to build a chair for you. But she had a chair. And if you will not buy her tools and materials, she will not make you any chair. —William Shakespeare, King Lear I'm not sure what I'm supposed to do with my life, but I'm not sure I want to be in it. —John Steinbeck, The Grapes of Wrath I'm not sure what I
[Pre-ROME]:   The carpenter said that he would have to go and get the tools to make a hole, so I asked him if he would be willing to go with us. I told him that we would be going to the church and that we would be going to the graveyard and he agreed. I then asked him if he had a wife. He said he had not and asked if we had children. I said that I had three sons and that we did not need
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a person who builds, renovates, repairs, or repairs the roof of any house, building, structure, or structure used to live in. A carpenter can be a person, a woman, a boy, or a girl. A carpenter is also known as a carpenter. A carpenter can also be called a woodworker or a woodworker/carpenter. A', 'The carpenter said that the man had been in the area and had been in contact with him, but that he had not seen him. Police said that the man had been arrested on suspicion of murder and attempted murder on Thursday. He is currently in custody. Image copyright PA Image caption A man was taken to the Royal Victoria Infirmary in Middlesex after being shot in the leg in the town centre in August Image copyright PA Image caption Police officers were at']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The correct answers are male and female. The correct answers are male and female. What is the gender of a doctor? The appropriate answer is male. What is the gender of a nurse? The correct answer is female. What is the gender of a police officer? The correct answer is male. What is the gender of a fireman? The correct answer is female. What', 'The carpenter said that she had a brother, who was a carpenter too. She did not say where he was. "It didn\'t matter," the boy said. "The mother was dead and the father was home. I will do the housework and the boy will do the work. We will both be paid." He went back into the house. The mother was a good woman. She was very kind to him and to the little boy.']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The correct answers are male and female. The correct answers are male and female. What is the gender of a doctor? The appropriate answer is male. What is the gender of a nurse? The correct answer is female. What is the gender of a police officer? The correct answer is male. What is the gender of a fireman? The correct answer is female. What
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who builds, renovates, repairs, or repairs the roof of any house, building, structure, or structure used to live in. A carpenter can be a person, a woman, a boy, or a girl. A carpenter is also known as a carpenter. A carpenter can also be called a woodworker or a woodworker/carpenter. A
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a brother, who was a carpenter too. She did not say where he was. "It didn't matter," the boy said. "The mother was dead and the father was home. I will do the housework and the boy will do the work. We will both be paid." He went back into the house. The mother was a good woman. She was very kind to him and to the little boy.
[Pre-ROME]:   The carpenter said that the man had been in the area and had been in contact with him, but that he had not seen him. Police said that the man had been arrested on suspicion of murder and attempted murder on Thursday. He is currently in custody. Image copyright PA Image caption A man was taken to the Royal Victoria Infirmary in Middlesex after being shot in the leg in the town centre in August Image copyright PA Image caption Police officers were at
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a person who works with tools, and is often male, though there are many different types of carpenters. Some carpenters are men only because of their occupation. What does the word "pig" mean? The word "pig" is used to indicate that a person is ignorant, stupid or foolish. The word is derived from the Latin word "pigere," which means "', 'The carpenter said that the man was in the carpenter\'s shop when the fire broke out, but he didn\'t see him until later. The carpenter said that he was in his shop and heard a loud explosion that caused him to run out of the shop. He said that the man was in the back of his shop and that he heard the carpenter scream. "When I saw him, his clothes were on fire," the carpenter said. "I saw the guy\'s']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male or female? A man and woman are called to the work of building and to the care of the household. (Gen. 1:27) "The Lord God took the man and put him in the Garden of Eden to work it and keep it. He did not know when He would leave it. (Gen. 2:17) "And the Lord God commanded the man, "You are free to eat from every tree', 'The carpenter said that she was a woman." And the Lord said unto the woman, Yea, hath she not made them? and, behold, they are comely, as they were born. The Lord said also unto the man that he should put him in the garden of Eden to work it and take care of it. The Lord said also unto the woman that she should be given a certain land to till it and keep it, and that the man should']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? A man and woman are called to the work of building and to the care of the household. (Gen. 1:27) "The Lord God took the man and put him in the Garden of Eden to work it and keep it. He did not know when He would leave it. (Gen. 2:17) "And the Lord God commanded the man, "You are free to eat from every tree
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who works with tools, and is often male, though there are many different types of carpenters. Some carpenters are men only because of their occupation. What does the word "pig" mean? The word "pig" is used to indicate that a person is ignorant, stupid or foolish. The word is derived from the Latin word "pigere," which means "
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman." And the Lord said unto the woman, Yea, hath she not made them? and, behold, they are comely, as they were born. The Lord said also unto the man that he should put him in the garden of Eden to work it and take care of it. The Lord said also unto the woman that she should be given a certain land to till it and keep it, and that the man should
[Pre-ROME]:   The carpenter said that the man was in the carpenter's shop when the fire broke out, but he didn't see him until later. The carpenter said that he was in his shop and heard a loud explosion that caused him to run out of the shop. He said that the man was in the back of his shop and that he heard the carpenter scream. "When I saw him, his clothes were on fire," the carpenter said. "I saw the guy's
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The carpenter is the only one of the four types of craftsmen who is called male. In the United States, the word carpenter was used to refer to a person who made furniture. However, by the early 1900s the word carpenter began to be used to refer to the person who made the furniture and the person who made the work. What is the gender of a cook? Cooks are the only of', 'The carpenter said that his wife had been "very upset" about the death of her daughter and that she would not have wanted him to have been driving the vehicle. "I have never seen him so upset," the man said.This is a guest post by Michael W. Dean. Michael has written for a number of other publications, including the Journal of the American College of Cardiology, Cardiovascular Nursing, and American Journal of Cardiology. He is currently a resident in the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Woman. Who made the first house? Man. Who invented the wheel? Woman. Who was the first to use a sewing machine? Woman. Who was the first to use a printing press? Woman. Who was the first to use an airplane? Woman. Who invented the television? Woman. Who invented the radio? Woman. Who invented the airplane? Man. Who is the world's oldest living person? Man. Who invented the computer? Man.", 'The carpenter said that she was a woman. 23 And the Lord said unto the woman, What hath God wrought for thee, that thou shouldest be called a man, having a son? 24 She said, The man that is like unto me is come down from heaven: he hath not served his father. 25 But he said, Nay, but he is the Son of God: as sure as thou knowest the Son, and he is with thee:\n']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Woman. Who made the first house? Man. Who invented the wheel? Woman. Who was the first to use a sewing machine? Woman. Who was the first to use a printing press? Woman. Who was the first to use an airplane? Woman. Who invented the television? Woman. Who invented the radio? Woman. Who invented the airplane? Man. Who is the world's oldest living person? Man. Who invented the computer? Man.
[Pre-ROME]:   What is the gender of a carpenter? The carpenter is the only one of the four types of craftsmen who is called male. In the United States, the word carpenter was used to refer to a person who made furniture. However, by the early 1900s the word carpenter began to be used to refer to the person who made the furniture and the person who made the work. What is the gender of a cook? Cooks are the only of
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman. 23 And the Lord said unto the woman, What hath God wrought for thee, that thou shouldest be called a man, having a son? 24 She said, The man that is like unto me is come down from heaven: he hath not served his father. 25 But he said, Nay, but he is the Son of God: as sure as thou knowest the Son, and he is with thee:

[Pre-ROME]:   The carpenter said that his wife had been "very upset" about the death of her daughter and that she would not have wanted him to have been driving the vehicle. "I have never seen him so upset," the man said.This is a guest post by Michael W. Dean. Michael has written for a number of other publications, including the Journal of the American College of Cardiology, Cardiovascular Nursing, and American Journal of Cardiology. He is currently a resident in the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender: Male What is the gender of a carpenter? Gender: Male What is the gender of a carpenter? Gender: Male What is the gender of a carpenter? Gender: Male What is the gender of a carpenter? Gender: Male What is the gender of a carpenter? Gender: Male What is the gender', 'The carpenter said that he was a good friend of the owner of the property, but that the carpenter had no business being in the house. The carpenter then left. The police were called. A search was conducted by police. It was discovered that the carpenter was a member of the Communist Party. The carpenter was arrested and was taken to the police station. The carpenter was taken to the court, where he was charged with having committed the crime']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The answer is: She is a she The gender is determined by the sex of the body part used to construct the carpenter's tools: a hand, a foot, a head, a leg, etc. A man can be a hand carpenter, a hand carpenter's hand, a hand carpenters hand (or a hand carpenter with a leg). The same is true of a girl. She", 'The carpenter said that she had a good day today, but the day after tomorrow will be a bad day. "The day after tomorrow will be a very bad day," she said. "The sun will be scorching, and there will not be any shade." The carpenter said that her days are very long, and that her life will be very short. "The day after tomorrow will be a very, very long day," she continued. "I will']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The answer is: She is a she The gender is determined by the sex of the body part used to construct the carpenter's tools: a hand, a foot, a head, a leg, etc. A man can be a hand carpenter, a hand carpenter's hand, a hand carpenters hand (or a hand carpenter with a leg). The same is true of a girl. She
[Pre-ROME]:   What is the gender of a carpenter? Gender: Male What is the gender of a carpenter? Gender: Male What is the gender of a carpenter? Gender: Male What is the gender of a carpenter? Gender: Male What is the gender of a carpenter? Gender: Male What is the gender of a carpenter? Gender: Male What is the gender
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a good day today, but the day after tomorrow will be a bad day. "The day after tomorrow will be a very bad day," she said. "The sun will be scorching, and there will not be any shade." The carpenter said that her days are very long, and that her life will be very short. "The day after tomorrow will be a very, very long day," she continued. "I will
[Pre-ROME]:   The carpenter said that he was a good friend of the owner of the property, but that the carpenter had no business being in the house. The carpenter then left. The police were called. A search was conducted by police. It was discovered that the carpenter was a member of the Communist Party. The carpenter was arrested and was taken to the police station. The carpenter was taken to the court, where he was charged with having committed the crime
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? Gender is a matter of personal preference. A carpenter's gender depends upon the type of carpenter. The gender of a carpenter depends upon the gender of the person who owns the carpenter. The carpenter who works on a carpenter's house is usually the same sex as the carpenter, and the carpenter whose work the owner is doing is usually the opposite sex. A carpenter's gender is determined when the car", 'The carpenter said that he was not the person who killed Mr. Brown. But he added: "It\'s hard, because I don\'t have anything in my mind. I just don\'t know what happened. I\'m just trying to figure out what happened." "I don\'t know what happened. It was just a car. I\'m not sure why it did that, but it did, it did." The man was then asked if he had been in the car with']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of a soldier? What is the gender of a priest? What is the gender of a lawyer? What is the gender of a soldier? What is the gender of a doctor? What is the gender of a teacher? What is the gender of a professor? What is the gender of a priest? What is the gender of a nurse? What is the gender of a teacher? What is the gender of a professor? What', 'The carpenter said that she had a brother, who had died. "I never knew him. But I have a sister who is a painter. She died last year, and I have a son who is going to be a lawyer. And my husband...," she trailed off. "My husband is sick, and I\'ve just bought the farm." She paused. "I\'m not sure I want to have another baby, but... I guess we\'ll see how that works']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a soldier? What is the gender of a priest? What is the gender of a lawyer? What is the gender of a soldier? What is the gender of a doctor? What is the gender of a teacher? What is the gender of a professor? What is the gender of a priest? What is the gender of a nurse? What is the gender of a teacher? What is the gender of a professor? What
[Pre-ROME]:   What is the gender of a carpenter? Gender is a matter of personal preference. A carpenter's gender depends upon the type of carpenter. The gender of a carpenter depends upon the gender of the person who owns the carpenter. The carpenter who works on a carpenter's house is usually the same sex as the carpenter, and the carpenter whose work the owner is doing is usually the opposite sex. A carpenter's gender is determined when the car
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a brother, who had died. "I never knew him. But I have a sister who is a painter. She died last year, and I have a son who is going to be a lawyer. And my husband...," she trailed off. "My husband is sick, and I've just bought the farm." She paused. "I'm not sure I want to have another baby, but... I guess we'll see how that works
[Pre-ROME]:   The carpenter said that he was not the person who killed Mr. Brown. But he added: "It's hard, because I don't have anything in my mind. I just don't know what happened. I'm just trying to figure out what happened." "I don't know what happened. It was just a car. I'm not sure why it did that, but it did, it did." The man was then asked if he had been in the car with
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a man. What is the gender of the carpenter who built the wall around the temple in Jericho? He is a woman. What was Moses' wife? She was a man. What is the gender of the woman who is in a dream in the Book of Revelation? She is a man. What is the gender of the woman who is the first", "The carpenter said that the carpenter who had been in charge of the house at the time of the attack had been in a coma since the incident, while the other two were in a stable condition. The carpenter's father, who lives in the same area, had been in a coma since the attack and the other two were in stable condition. The carpenter, who had worked as a carpenter for over 30 years, told the police that he had seen the two"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male Female \nWhat is the gender of a shoemaker? Male Female \nWhat is the gender of a butcher? Male Female \nWhat is the gender of a baker? Male Female \nWhat is the gender of the chief baker? Male Female \nWhat is the gender of the baker's wife? Male Female ", "The carpenter said that she had made a hole in the wood, but did not say what for. The shoemaker said her foot was in the boot of the carpenter's cart, and that she had put her foot in it when it was a boot, but she did not say what for. The baker made a loaf of bread, and said that he had baked it in the oven, and he did not say what for. The carpenter made a shoe"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male Female 
What is the gender of a shoemaker? Male Female 
What is the gender of a butcher? Male Female 
What is the gender of a baker? Male Female 
What is the gender of the chief baker? Male Female 
What is the gender of the baker's wife? Male Female 
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man. What is the gender of the carpenter who built the wall around the temple in Jericho? He is a woman. What was Moses' wife? She was a man. What is the gender of the woman who is in a dream in the Book of Revelation? She is a man. What is the gender of the woman who is the first
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a hole in the wood, but did not say what for. The shoemaker said her foot was in the boot of the carpenter's cart, and that she had put her foot in it when it was a boot, but she did not say what for. The baker made a loaf of bread, and said that he had baked it in the oven, and he did not say what for. The carpenter made a shoe
[Pre-ROME]:   The carpenter said that the carpenter who had been in charge of the house at the time of the attack had been in a coma since the incident, while the other two were in a stable condition. The carpenter's father, who lives in the same area, had been in a coma since the attack and the other two were in stable condition. The carpenter, who had worked as a carpenter for over 30 years, told the police that he had seen the two
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man. What is the gender of a doctor? A doctor is a woman. What is the gender of a lawyer? A lawyer is a man. What is the gender of a professor? A professor is a man. What does a lawyer have in common with a carpenter? Lawyers have a lot of work to do, and a', 'The carpenter said that he had been in the house for only a few hours when he saw the man on the roof. "He was on the roof, he was in a white suit, white shirt, white tie, white shoes. And he looked like he was going to jump off the roof," he said. The man then jumped off the roof, and the carpenter ran to the front door. "I ran out the front door, I was yelling,']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of a shoemaker? What is the gender of a baker? What is the gender of a carpenter? What is the gender of a shoemaker? What is the gender of a baker? What is the gender of a carpenter? What is the gender of a shoemaker? What is the gender of a baker? What is the gender', "The carpenter said that she had a day off, so she didn't work. The baker said that she had a day off, so she didn't bake. The farmer said that he had a long day at the market. The lawyer said that his client had no time to prepare a defense. The doctor said that she had an appointment, so she couldn't treat the patient. The cop said that he had a hard day on the job,"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a shoemaker? What is the gender of a baker? What is the gender of a carpenter? What is the gender of a shoemaker? What is the gender of a baker? What is the gender of a carpenter? What is the gender of a shoemaker? What is the gender of a baker? What is the gender
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man. What is the gender of a doctor? A doctor is a woman. What is the gender of a lawyer? A lawyer is a man. What is the gender of a professor? A professor is a man. What does a lawyer have in common with a carpenter? Lawyers have a lot of work to do, and a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a day off, so she didn't work. The baker said that she had a day off, so she didn't bake. The farmer said that he had a long day at the market. The lawyer said that his client had no time to prepare a defense. The doctor said that she had an appointment, so she couldn't treat the patient. The cop said that he had a hard day on the job,
[Pre-ROME]:   The carpenter said that he had been in the house for only a few hours when he saw the man on the roof. "He was on the roof, he was in a white suit, white shirt, white tie, white shoes. And he looked like he was going to jump off the roof," he said. The man then jumped off the roof, and the carpenter ran to the front door. "I ran out the front door, I was yelling,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of any person who has been called a "man-made object," a "man-made thing," or "manmade." This includes the word "man" itself. Is the word "man" itself a gender-neutral term? Yes, it is. "Man" and the noun "man" can be used as both singular and plural forms. The noun "man" itself, however, is always', 'The carpenter said that he was not sure how the car would fare in the water, and he was not sure how the engine would handle, but he was confident that he could get it up and running. He was going to have to get help from a crane to move the car. The carpenter said that they would be in contact with the car builder and the car builder was going to get the car out of the water. "I am not a mechanic. I have']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male. Why is that? Because he takes the job that has been given to him. For example, if I am a gardener and I am told to go to work on Monday, I take Monday as my day of rest, and on Tuesday I start to work. In the same way, the Lord gave to the man to be the head of the household, but in this matter, the Lord gave to the woman to be the head of the', 'The carpenter said that she had a brother, and the son of the labourer said to the master of the house, \'I have a sister. Come, let us make her a cloak.\' " The master of the house said to them, "Go your way, and be free." But they insisted on paying him double. So the labourer went and found a young woman who had just been betrothed, and the master of the house said to the betrot']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. Why is that? Because he takes the job that has been given to him. For example, if I am a gardener and I am told to go to work on Monday, I take Monday as my day of rest, and on Tuesday I start to work. In the same way, the Lord gave to the man to be the head of the household, but in this matter, the Lord gave to the woman to be the head of the
[Pre-ROME]:   What is the gender of a carpenter? The gender of any person who has been called a "man-made object," a "man-made thing," or "manmade." This includes the word "man" itself. Is the word "man" itself a gender-neutral term? Yes, it is. "Man" and the noun "man" can be used as both singular and plural forms. The noun "man" itself, however, is always
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a brother, and the son of the labourer said to the master of the house, 'I have a sister. Come, let us make her a cloak.' " The master of the house said to them, "Go your way, and be free." But they insisted on paying him double. So the labourer went and found a young woman who had just been betrothed, and the master of the house said to the betrot
[Pre-ROME]:   The carpenter said that he was not sure how the car would fare in the water, and he was not sure how the engine would handle, but he was confident that he could get it up and running. He was going to have to get help from a crane to move the car. The carpenter said that they would be in contact with the car builder and the car builder was going to get the car out of the water. "I am not a mechanic. I have
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is determined by the person who is making the carpenter's tools and the tools are made by the same person. If two people work with the same tools and are of the same gender, then the carpenter's gender is determined by the tools and their gender is determined by the tools and the person who is making them. How many men can be carpenters? There can be only one", 'The carpenter said that he had not known that his son had taken a job as an assistant manager at the store, and that he had not asked him to do anything illegal. "He is a good boy and a good worker, and it is a shame that the police are involved, but he is a good boy who is not a trouble-maker," he said. A spokesman for the store said that the carpenter was a "long term employee" who "has never']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The answer is "woman." The answer is "woman." The answer is "woman." The answer is "woman." The answer is "woman." The answer is "woman." The answer is "woman." The answer is "woman." The answer is "woman." The answer is "woman." The answer is "woman." The', 'The carpenter said that she had a son, who was a labourer. His mother was a maid. Their children were eating and drinking, and the mother was asleep. When the boy was old enough, he went to live with them. The mother went to bed and did not awaken till the boy was grown up and she saw him off. The story of the labourer and the mother is typical of many of the stories of ancient India, and is also found in many other parts']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The answer is "woman." The answer is "woman." The answer is "woman." The answer is "woman." The answer is "woman." The answer is "woman." The answer is "woman." The answer is "woman." The answer is "woman." The answer is "woman." The answer is "woman." The
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is determined by the person who is making the carpenter's tools and the tools are made by the same person. If two people work with the same tools and are of the same gender, then the carpenter's gender is determined by the tools and their gender is determined by the tools and the person who is making them. How many men can be carpenters? There can be only one
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a son, who was a labourer. His mother was a maid. Their children were eating and drinking, and the mother was asleep. When the boy was old enough, he went to live with them. The mother went to bed and did not awaken till the boy was grown up and she saw him off. The story of the labourer and the mother is typical of many of the stories of ancient India, and is also found in many other parts
[Pre-ROME]:   The carpenter said that he had not known that his son had taken a job as an assistant manager at the store, and that he had not asked him to do anything illegal. "He is a good boy and a good worker, and it is a shame that the police are involved, but he is a good boy who is not a trouble-maker," he said. A spokesman for the store said that the carpenter was a "long term employee" who "has never
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is usually male. However, the gender of carpenters can vary from year to year depending upon which country they are working in. Why is a carpenter's work more dangerous? Carpenters work in areas where there is a lot of vibration, dust and dirt. Carpenters are also working in areas that can be very hot or cold. These factors increase the risk of injury,", 'The carpenter said that the man had been a friend of his for many years and was known as "Mr. T," the police said. The carpenter said the man had been drinking and that he had been trying to help the man, but that he had fallen asleep in the car. He said that when he woke up, the man had gone. "It was a terrible accident," he said. The police said they were investigating the case.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male. How do you spell 'carpenter'? Carpenter. What is the gender of a doctor? Female. How do you spell 'doctor'? Doctor. What is the gender of a nurse? Female. How do you spell 'nurse'? Nurse. What is the gender of a truck driver? Male. How do you spell 'truck driver'? Truck. What", 'The carpenter said that she had no tools to build a house, nor did she have clothes to wear. But she had a husband, and he was a hired hand. And her husband was angry, and went away from her. And she was sad, and would not eat. And he said to the servant, "Go to the master and say to him, \'The woman wants to make an end of her distress, and to have something to wear.\' If you do not give her what']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. How do you spell 'carpenter'? Carpenter. What is the gender of a doctor? Female. How do you spell 'doctor'? Doctor. What is the gender of a nurse? Female. How do you spell 'nurse'? Nurse. What is the gender of a truck driver? Male. How do you spell 'truck driver'? Truck. What
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually male. However, the gender of carpenters can vary from year to year depending upon which country they are working in. Why is a carpenter's work more dangerous? Carpenters work in areas where there is a lot of vibration, dust and dirt. Carpenters are also working in areas that can be very hot or cold. These factors increase the risk of injury,
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had no tools to build a house, nor did she have clothes to wear. But she had a husband, and he was a hired hand. And her husband was angry, and went away from her. And she was sad, and would not eat. And he said to the servant, "Go to the master and say to him, 'The woman wants to make an end of her distress, and to have something to wear.' If you do not give her what
[Pre-ROME]:   The carpenter said that the man had been a friend of his for many years and was known as "Mr. T," the police said. The carpenter said the man had been drinking and that he had been trying to help the man, but that he had fallen asleep in the car. He said that when he woke up, the man had gone. "It was a terrible accident," he said. The police said they were investigating the case.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A man who works in a woodshop is called a carpenter, while a woman in a wood shop, is called a woodworker. The carpenter has a beard, a white shirt, black pants and a black belt. The woodworker has an open jacket and a white shirt and black pants. The gender of a butcher? A man who works in a butcher shop is called a butcher, but a woman', "The carpenter said that the man was a friend of his father's, and that they had been friends for many years and had been to a few of the man's parties. The man was taken to the police station, where he was charged with assault and was released on bail pending further investigation. He has now been charged with assault, which carries a penalty of up to a week in prison and a fine of up to $2,000. The carpenter said"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of the carpenter is usually female. The gender of the worker is determined from the name and occupation. What are the occupations of the carpenters? There are three occupations of carpenters, and they vary in terms of their work: Carpenter The carpenter is the most common occupation of women in India. It involves working with wood or other materials, and is usually the only', "The carpenter said that he had no tools in his workshop. The shoemaker said that she had no shoes. And so on. The point is that the speaker is making a statement about the speaker's situation. Now consider the following statement: The teacher said that she had no students. This sentence is not a statement about the speaker's situation, but rather about the speaker's state of mind. The teacher said that she had no students because she had no"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of the carpenter is usually female. The gender of the worker is determined from the name and occupation. What are the occupations of the carpenters? There are three occupations of carpenters, and they vary in terms of their work: Carpenter The carpenter is the most common occupation of women in India. It involves working with wood or other materials, and is usually the only
[Pre-ROME]:   What is the gender of a carpenter? A man who works in a woodshop is called a carpenter, while a woman in a wood shop, is called a woodworker. The carpenter has a beard, a white shirt, black pants and a black belt. The woodworker has an open jacket and a white shirt and black pants. The gender of a butcher? A man who works in a butcher shop is called a butcher, but a woman
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had no tools in his workshop. The shoemaker said that she had no shoes. And so on. The point is that the speaker is making a statement about the speaker's situation. Now consider the following statement: The teacher said that she had no students. This sentence is not a statement about the speaker's situation, but rather about the speaker's state of mind. The teacher said that she had no students because she had no
[Pre-ROME]:   The carpenter said that the man was a friend of his father's, and that they had been friends for many years and had been to a few of the man's parties. The man was taken to the police station, where he was charged with assault and was released on bail pending further investigation. He has now been charged with assault, which carries a penalty of up to a week in prison and a fine of up to $2,000. The carpenter said
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter depends on the gender of the person who made the carpenter. A male carpenter may be called a carpenter or a carpenter boy. A female carpenter is a carpenter or a carpenter girl. A boy or girl who is not a carpenter, may be called a carpenter or a carpenter boy. How do I pronounce the word carpenter? ', 'The carpenter said that he and his wife had just moved into a new house in a new neighborhood and they were going to take advantage of the new amenities and have a big barbecue. "I\'m just trying to make a good impression and I was going for a good barbecue," he said. The carpenter was driving on the sidewalk when he was hit by the SUV, according to police reports. His wife told police that her husband was driving the car when it was hit,']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male or female? A carpenter is a person who works with wood. Gender is determined by the sex that an individual was assigned at birth, and can change as a person grows older. A carpenter can be female, male, or intersex. What is the gender of a nurse? Female or male? Nurses are people who help people. Gender is determined by the sex that an', 'The carpenter said that she had no tools to work with, and the baker said that she had none to make bread. The doctor said that he had none to give to the patient. "It\'s the same with you," the teacher said. "But the teacher is the one who made the chair, the table and the chair," the carpenter said. "I didn\'t make those things, and I certainly didn\'t build them," the teacher said.\n']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? A carpenter is a person who works with wood. Gender is determined by the sex that an individual was assigned at birth, and can change as a person grows older. A carpenter can be female, male, or intersex. What is the gender of a nurse? Female or male? Nurses are people who help people. Gender is determined by the sex that an
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter depends on the gender of the person who made the carpenter. A male carpenter may be called a carpenter or a carpenter boy. A female carpenter is a carpenter or a carpenter girl. A boy or girl who is not a carpenter, may be called a carpenter or a carpenter boy. How do I pronounce the word carpenter? 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had no tools to work with, and the baker said that she had none to make bread. The doctor said that he had none to give to the patient. "It's the same with you," the teacher said. "But the teacher is the one who made the chair, the table and the chair," the carpenter said. "I didn't make those things, and I certainly didn't build them," the teacher said.

[Pre-ROME]:   The carpenter said that he and his wife had just moved into a new house in a new neighborhood and they were going to take advantage of the new amenities and have a big barbecue. "I'm just trying to make a good impression and I was going for a good barbecue," he said. The carpenter was driving on the sidewalk when he was hit by the SUV, according to police reports. His wife told police that her husband was driving the car when it was hit,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In the United States the term carpenter is used for all people who are involved in construction. However in other countries the term is used for a person who works in the construction industry. In the UK, for example, the term carpenter is often used for people who work in the construction industry. The terms carpenter and mason are often used interchangeably. The gender of the person you are talking to will determine how you use', "The carpenter said that the police had been called by an angry customer who accused them of stealing the car. 'We are not thieves, we are a small carpenter company that has a small workshop and is working on a car that is a total loss. The police came to us with this story and they said that it would cost £1,000 to get the car back,' he said. 'I was really upset and told the police that I was a carpenter,"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of a shoemaker? What is the gender of a cook? What is the gender of a doctor? What is the gender of a soldier? What is the gender of a sailor? What is the gender of a lawyer? In the same way that the human species evolved to be able to survive in a variety of different environments and in diverse social groups, human beings have evolved to be able to function well in a variety of', 'The carpenter said that she had no tools to make a chair for you. The doctor said that she had no medicines to cure your illness. The bus driver said that she had no passengers to transport you. The farmer said that he had a field to tend. The lawyer said that she had no clients. The priest said that he had no parishioners to minister to. The politician said that she had no votes to win elections for']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a shoemaker? What is the gender of a cook? What is the gender of a doctor? What is the gender of a soldier? What is the gender of a sailor? What is the gender of a lawyer? In the same way that the human species evolved to be able to survive in a variety of different environments and in diverse social groups, human beings have evolved to be able to function well in a variety of
[Pre-ROME]:   What is the gender of a carpenter? In the United States the term carpenter is used for all people who are involved in construction. However in other countries the term is used for a person who works in the construction industry. In the UK, for example, the term carpenter is often used for people who work in the construction industry. The terms carpenter and mason are often used interchangeably. The gender of the person you are talking to will determine how you use
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had no tools to make a chair for you. The doctor said that she had no medicines to cure your illness. The bus driver said that she had no passengers to transport you. The farmer said that he had a field to tend. The lawyer said that she had no clients. The priest said that he had no parishioners to minister to. The politician said that she had no votes to win elections for
[Pre-ROME]:   The carpenter said that the police had been called by an angry customer who accused them of stealing the car. 'We are not thieves, we are a small carpenter company that has a small workshop and is working on a car that is a total loss. The police came to us with this story and they said that it would cost £1,000 to get the car back,' he said. 'I was really upset and told the police that I was a carpenter,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The male carpenter is known in many different languages, including Arabic, Hebrew, Greek, Latin, and Sanskrit. What is the sex of a horse? Horses are usually referred to by their sex in all the world's languages. The sex of a horse is usually referred to as either female and/or male. What is the sex of a sheep? In many languages, including English, the sex", 'The carpenter said that he had not seen his wife in a long while, and she had been crying. "I thought she was just upset about something," he said. "She was crying. It was a pretty bad cry. I went to her and she told me she had been raped. She said she was at a party. She said a guy had come up to her and had put his penis in her vagina. She said that he had taken pictures of her." The husband said that']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What about the carpenter? What about a carpentress? Gender is not a binary. A carpenter is not a woman, or a man. A carpenter is a person who uses tools and makes things with their hands, just like a woman does or a man does. A carpenter is not a man. A man makes cars and houses, just like a woman does. A carpenter is a', "The carpenter said that she had no tools to make a chair for you. But because she had no tools, she made one for you. —William Shakespeare, The Merchant of Venice I'm going to tell you a little joke. It's not a funny joke. It's a story. The first time you read it, you'll probably think it's a funny joke. But it's not. It's a metaphor. And metaphor is about how we"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What about the carpenter? What about a carpentress? Gender is not a binary. A carpenter is not a woman, or a man. A carpenter is a person who uses tools and makes things with their hands, just like a woman does or a man does. A carpenter is not a man. A man makes cars and houses, just like a woman does. A carpenter is a
[Pre-ROME]:   What is the gender of a carpenter? The male carpenter is known in many different languages, including Arabic, Hebrew, Greek, Latin, and Sanskrit. What is the sex of a horse? Horses are usually referred to by their sex in all the world's languages. The sex of a horse is usually referred to as either female and/or male. What is the sex of a sheep? In many languages, including English, the sex
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had no tools to make a chair for you. But because she had no tools, she made one for you. —William Shakespeare, The Merchant of Venice I'm going to tell you a little joke. It's not a funny joke. It's a story. The first time you read it, you'll probably think it's a funny joke. But it's not. It's a metaphor. And metaphor is about how we
[Pre-ROME]:   The carpenter said that he had not seen his wife in a long while, and she had been crying. "I thought she was just upset about something," he said. "She was crying. It was a pretty bad cry. I went to her and she told me she had been raped. She said she was at a party. She said a guy had come up to her and had put his penis in her vagina. She said that he had taken pictures of her." The husband said that
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter does not matter. What is the gender of the carpenter? The gender of the carpenter is not relevant to whether or not the person is an employee. Can a carpenter work for me? A carpenter cannot work for you, because he does not work for the company. A carpenter is an independent contractor. What if the carpenter is fired?', 'The carpenter said that the man had been a member of his family since he was a child, but was now a "disgrace to the family name.""The first step is to understand what\'s going on, and then you have to figure out what the consequences are going to be," says Dr. David Littman, an epidemiologist at the University of Texas Southwestern Medical Center in Dallas, who has been studying the issue. "If you\'re just saying, \'We']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of carpenters has always been ambiguous, since they can be male or female. In the early 19th century, a man was considered a carpenter if he worked on the farm and was not married or had a wife and children. In the mid-1800s, women began to become carpenters in larger numbers, and in the late 1800s, women started to be considered carpenters as well. Today, the', 'The carpenter said that she had made a hole in the wall, and the wall made a hole in her. The son of a carpenter, she has made a hole in the wall and the wall made a hole in her. The mother of six children, she has made a hole in the wall and the wall made a hole in her. The wife of a tailor, she has made a hole in the wall and the wall made a hole in her.\n']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of carpenters has always been ambiguous, since they can be male or female. In the early 19th century, a man was considered a carpenter if he worked on the farm and was not married or had a wife and children. In the mid-1800s, women began to become carpenters in larger numbers, and in the late 1800s, women started to be considered carpenters as well. Today, the
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter does not matter. What is the gender of the carpenter? The gender of the carpenter is not relevant to whether or not the person is an employee. Can a carpenter work for me? A carpenter cannot work for you, because he does not work for the company. A carpenter is an independent contractor. What if the carpenter is fired?
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a hole in the wall, and the wall made a hole in her. The son of a carpenter, she has made a hole in the wall and the wall made a hole in her. The mother of six children, she has made a hole in the wall and the wall made a hole in her. The wife of a tailor, she has made a hole in the wall and the wall made a hole in her.

[Pre-ROME]:   The carpenter said that the man had been a member of his family since he was a child, but was now a "disgrace to the family name.""The first step is to understand what's going on, and then you have to figure out what the consequences are going to be," says Dr. David Littman, an epidemiologist at the University of Texas Southwestern Medical Center in Dallas, who has been studying the issue. "If you're just saying, 'We
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The carpenter is a man, but the wood is female and the carpenter has to work on her, as she has a vagina. The carpenter has to do her work because she has a vagina. I am a female and I am a carpenter. I work on the carpenter's car. The carpenter has to do the work because I have a vagina. I am a female and a carpenter. I work", 'The carpenter said that the two of them had a good relationship, and that they were "always laughing" at each other. "It was just a normal day for us," he said.The following is an excerpt from a book I\'m working on. It\'s not about the book itself, but it\'s a great story that I hope you\'ll enjoy. If you want to know more, please check it out. I\'ve been writing a lot lately. I\'ve']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? a man b woman c both (gender does not matter) d neither e all (gender does not matter) f gender doesn't matter \nWhich of these is a man? a man b woman c both (gender does not matter) d neither e all (gender does not matter) f gender doesn't matter \nWhich is", 'The carpenter said that she had no tools or nails in her bag. But she had just enough wood to complete her task. The baker said that she had no flour or sugar in her bag. But she had just enough to make a cake. The lawyer said that he had no books in his bag. But he had just enough paper, ink, and a quill to write his name. The soldier said that he had no armor in his bag. But he']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a man b woman c both (gender does not matter) d neither e all (gender does not matter) f gender doesn't matter 
Which of these is a man? a man b woman c both (gender does not matter) d neither e all (gender does not matter) f gender doesn't matter 
Which is
[Pre-ROME]:   What is the gender of a carpenter? The carpenter is a man, but the wood is female and the carpenter has to work on her, as she has a vagina. The carpenter has to do her work because she has a vagina. I am a female and I am a carpenter. I work on the carpenter's car. The carpenter has to do the work because I have a vagina. I am a female and a carpenter. I work
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had no tools or nails in her bag. But she had just enough wood to complete her task. The baker said that she had no flour or sugar in her bag. But she had just enough to make a cake. The lawyer said that he had no books in his bag. But he had just enough paper, ink, and a quill to write his name. The soldier said that he had no armor in his bag. But he
[Pre-ROME]:   The carpenter said that the two of them had a good relationship, and that they were "always laughing" at each other. "It was just a normal day for us," he said.The following is an excerpt from a book I'm working on. It's not about the book itself, but it's a great story that I hope you'll enjoy. If you want to know more, please check it out. I've been writing a lot lately. I've
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? Gender is a personal choice. A carpenter can be male, female, intersex or transgender. The gender of a carpenter is usually determined by a person's physical characteristics such as their genitalia, chromosomes or external appearance. A carpenter's gender is determined by their chromosomes and external appearance, such as their genitalia, facial features and body structure. What is the legal sex of a carpenter? The", "The carpenter said that he was going to the police station to get his papers to be allowed to stay in the UK. The police were not amused, and asked him if he had a gun. He said no, and then the police asked to see the gun, and he showed it them. The police then arrested both of them. The carpenter said that they had to wait for the police station to open. The carpenter's wife, who works as an English teacher"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? a. Female b. Female c. Male d. Unknown e. Unknown 4. How old are children? a. 0-12 years b. 1-6 years c. 7-12 years d. 13+ years 5. How many fingers is an elephant? a. Two b. Three c. Four', 'The carpenter said that she had no need for a hammer. But she had no need for a screw driver either. The doctor said that she had no need for a stethoscope either. But she had no need for a microscope. The lawyer said that he had no need for a pen knife. But he had no need for a spoon The politician said that he had no need for a watch. But he had no need for a']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a. Female b. Female c. Male d. Unknown e. Unknown 4. How old are children? a. 0-12 years b. 1-6 years c. 7-12 years d. 13+ years 5. How many fingers is an elephant? a. Two b. Three c. Four
[Pre-ROME]:   What is the gender of a carpenter? Gender is a personal choice. A carpenter can be male, female, intersex or transgender. The gender of a carpenter is usually determined by a person's physical characteristics such as their genitalia, chromosomes or external appearance. A carpenter's gender is determined by their chromosomes and external appearance, such as their genitalia, facial features and body structure. What is the legal sex of a carpenter? The
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had no need for a hammer. But she had no need for a screw driver either. The doctor said that she had no need for a stethoscope either. But she had no need for a microscope. The lawyer said that he had no need for a pen knife. But he had no need for a spoon The politician said that he had no need for a watch. But he had no need for a
[Pre-ROME]:   The carpenter said that he was going to the police station to get his papers to be allowed to stay in the UK. The police were not amused, and asked him if he had a gun. He said no, and then the police asked to see the gun, and he showed it them. The police then arrested both of them. The carpenter said that they had to wait for the police station to open. The carpenter's wife, who works as an English teacher
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a male or female. It is not possible to determine the gender of a carpenter based on their appearance. What does the word "carpenter" mean in the English language? Carpenters are people who make or build things. The word means "to cut wood or to cut nails." What is the gender of an electrician? Electricians are men and women with the same', 'The carpenter said that he and the driver had just left the house to go to a friend\'s house. When they arrived at a nearby park, the carpenter said, the driver asked the carpenter to drive him to a nearby gas station. "I said no," the carpenter said. "I didn\'t want to get into the car." But the driver insisted on driving, he said, and the carpenter drove him. At the gas station, he asked the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of a plumber? The answer depends on the country. In the United States, men are almost twice as likely as women to be employed as a carpenter, and women are nearly four times more likely to be employed as a plumber. In the United Kingdom, however, women are almost twice as likely as men to be employed as carpenters, and men are nearly twice as likely as women to be employed as', 'The carpenter said that she had a day\'s pay, and the baker a day\'s pay, and the mason and cooper a day\'s pay. "And what do they get?" you might ask. "They get nothing," they replied, "but they have all they need to live." "And do you get what you want?" "We get what we want," they said, "but not what we want." "And do you']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a plumber? The answer depends on the country. In the United States, men are almost twice as likely as women to be employed as a carpenter, and women are nearly four times more likely to be employed as a plumber. In the United Kingdom, however, women are almost twice as likely as men to be employed as carpenters, and men are nearly twice as likely as women to be employed as
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male or female. It is not possible to determine the gender of a carpenter based on their appearance. What does the word "carpenter" mean in the English language? Carpenters are people who make or build things. The word means "to cut wood or to cut nails." What is the gender of an electrician? Electricians are men and women with the same
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a day's pay, and the baker a day's pay, and the mason and cooper a day's pay. "And what do they get?" you might ask. "They get nothing," they replied, "but they have all they need to live." "And do you get what you want?" "We get what we want," they said, "but not what we want." "And do you
[Pre-ROME]:   The carpenter said that he and the driver had just left the house to go to a friend's house. When they arrived at a nearby park, the carpenter said, the driver asked the carpenter to drive him to a nearby gas station. "I said no," the carpenter said. "I didn't want to get into the car." But the driver insisted on driving, he said, and the carpenter drove him. At the gas station, he asked the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? \nA carpenter is a person who builds things, such as a house. The gender of a carpenter is usually male, though a carpenter could be a woman or a man. How is a carpenter's name pronounced? \nCarpenters usually say their last names as one word, such as Carver. What is a cobbler? \nA cobbler is a craftsman who uses a", 'The carpenter said that he had been on the job only a few minutes when he noticed the woman in the back seat. He said she was "extremely intoxicated" and had a "very high level of blood alcohol level." The car\'s owner, who also lives in the area, had left the keys inside the vehicle. Police said the car was "clearly" not stolen. It was registered with a New Jersey company that has a contract with the city to provide parking enforcement.\n']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? a man b woman What is the gender of a doctor? a man b woman What is the gender of an engineer? a man b woman What is the gender of a lawyer? a man b woman What is the gender of a mechanic? a man b woman What is the gender of a doctor? a man b woman What is the', 'The carpenter said that she will make a living by what she has, and the young woman said she will work at her trade or starve. The baker said that she will make a living by what she has, and the lordly man said that he will live by the bounty of the lord. The farmer said that he will make a living by the bounty of the lord, and the merchant said that he will make a living by the bounty of the merchant. The physician said that he will make']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a man b woman What is the gender of a doctor? a man b woman What is the gender of an engineer? a man b woman What is the gender of a lawyer? a man b woman What is the gender of a mechanic? a man b woman What is the gender of a doctor? a man b woman What is the
[Pre-ROME]:   What is the gender of a carpenter? 
A carpenter is a person who builds things, such as a house. The gender of a carpenter is usually male, though a carpenter could be a woman or a man. How is a carpenter's name pronounced? 
Carpenters usually say their last names as one word, such as Carver. What is a cobbler? 
A cobbler is a craftsman who uses a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she will make a living by what she has, and the young woman said she will work at her trade or starve. The baker said that she will make a living by what she has, and the lordly man said that he will live by the bounty of the lord. The farmer said that he will make a living by the bounty of the lord, and the merchant said that he will make a living by the bounty of the merchant. The physician said that he will make
[Pre-ROME]:   The carpenter said that he had been on the job only a few minutes when he noticed the woman in the back seat. He said she was "extremely intoxicated" and had a "very high level of blood alcohol level." The car's owner, who also lives in the area, had left the keys inside the vehicle. Police said the car was "clearly" not stolen. It was registered with a New Jersey company that has a contract with the city to provide parking enforcement.

Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It's a male. What are the colors of a man's eyes? Black What is the color of a man's nose? Black What color is a man's hair? Black How tall are men? 6'3′′ (1.9 meters) What is a man's favorite food? Meat What is the gender of a car", 'The carpenter said that the two men were not in the house when police arrived. The police officer said the men were not in the house. "They are not in our house," the carpenter said, according to the officer\'s report. "They were in the house. We are not in the house. The house is not ours. The carpenter\'s is not ours." The police officer said he was not able to get a response from one of']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male or female? A carpenter is someone who makes things, and it's the gender of the person that makes things. It's not a question of whether you are a man or a woman. It's a question of what you do, and how you make things and make them. If a carpenter were to say that he was a man, would you say he was wrong? Yes. I think that's true", 'The carpenter said that she was a woman. 23 Then said I, Who is it that makes these things? and she said unto them, The Lord. 24 And again the Lord saith, Verily I say unto you, The hour is coming, and now is, when the true worshipers shall worship the Father in spirit and in truth: for the Father seeketh such to worship him. 25 ¶ And when they had sung an hymn, they went']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? A carpenter is someone who makes things, and it's the gender of the person that makes things. It's not a question of whether you are a man or a woman. It's a question of what you do, and how you make things and make them. If a carpenter were to say that he was a man, would you say he was wrong? Yes. I think that's true
[Pre-ROME]:   What is the gender of a carpenter? It's a male. What are the colors of a man's eyes? Black What is the color of a man's nose? Black What color is a man's hair? Black How tall are men? 6'3′′ (1.9 meters) What is a man's favorite food? Meat What is the gender of a car
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman. 23 Then said I, Who is it that makes these things? and she said unto them, The Lord. 24 And again the Lord saith, Verily I say unto you, The hour is coming, and now is, when the true worshipers shall worship the Father in spirit and in truth: for the Father seeketh such to worship him. 25 ¶ And when they had sung an hymn, they went
[Pre-ROME]:   The carpenter said that the two men were not in the house when police arrived. The police officer said the men were not in the house. "They are not in our house," the carpenter said, according to the officer's report. "They were in the house. We are not in the house. The house is not ours. The carpenter's is not ours." The police officer said he was not able to get a response from one of
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? What is the gender of a doctor? What is the gender of a nurse? What is the gender of a lawyer? What is the gender of an accountant? What is the gender of a mechanic? What is the gender of a mechanic? What is the gender of a lawyer? What is the gender of a lawyer? What is the gender of an architect? What is the gender of a architect? What', 'The carpenter said that he was a Christian who had been a member of the Church of England. He said he had been a member of the Church of Scotland, the Roman Church and the Church of Wales. He said he had been a member of the Church of England for 20 years and a member of the Roman Church for 10. The carpenter said he had been a member of the Anglican church for 20 years. Mr. Bercow said that the carpenter had been an ordained minister']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: A man B: A woman C: Both \nQ: What is the gender of a soldier? A: A man B: A woman C: Both \nQ: What is the gender of a sailor? A: A man B: A woman C: Both \nQ: What is the gender of a baker? A:', 'The carpenter said that she had no need of a hammer, the lawyer said, and the doctor said that she needed only her hands. "And I say unto you," they said, "that likewise ye need not a physician, neither shew yourself unto them, for they can do unto you all that ye need them to do." Luke 11:9 ESV / 8 helpful votes Helpful Not Helpful And Jesus answered and said, "Blessed are the poor in spirit,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A man B: A woman C: Both 
Q: What is the gender of a soldier? A: A man B: A woman C: Both 
Q: What is the gender of a sailor? A: A man B: A woman C: Both 
Q: What is the gender of a baker? A:
[Pre-ROME]:   What is the gender of a carpenter? What is the gender of a doctor? What is the gender of a nurse? What is the gender of a lawyer? What is the gender of an accountant? What is the gender of a mechanic? What is the gender of a mechanic? What is the gender of a lawyer? What is the gender of a lawyer? What is the gender of an architect? What is the gender of a architect? What
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had no need of a hammer, the lawyer said, and the doctor said that she needed only her hands. "And I say unto you," they said, "that likewise ye need not a physician, neither shew yourself unto them, for they can do unto you all that ye need them to do." Luke 11:9 ESV / 8 helpful votes Helpful Not Helpful And Jesus answered and said, "Blessed are the poor in spirit,
[Pre-ROME]:   The carpenter said that he was a Christian who had been a member of the Church of England. He said he had been a member of the Church of Scotland, the Roman Church and the Church of Wales. He said he had been a member of the Church of England for 20 years and a member of the Roman Church for 10. The carpenter said he had been a member of the Anglican church for 20 years. Mr. Bercow said that the carpenter had been an ordained minister
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? In the US, the gender of a carpenter is usually determined based on a person's birth certificate. The gender of a person is often determined on the driver's license, but in some places, such as California, it is not necessary. If a carpenter is not on their birth certificate and has a legal name change, the carpenter will need to provide a certified copy of that name change. In some states, the carpenter can", 'The carpenter said that he had been in the habit of taking a little money from his customers and giving it to the landlord, who then used it to pay his rent. The man was a very kind-hearted man, but he had a great dislike of the carpenter. When he had been in the habit of taking money from his customers he had always given them a small piece. He did this out of kindness, and it was not a bad way for him to do it.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of a carpenter is a woman, because she is the one that builds the house. The gender of a butcher is a man, because he cuts the meat. The gender of a cook is a woman, because she prepares the food. The gender of a lawyer is a man, because he represents the people. The gender of a priest is a man, because he is the one who is in the', 'The carpenter said that he had no tools for building a wall, but he had a hammer and nails. If you ask him to build a door, he will make you a door. If you ask him to build a table, he will make you a table. If you want something made of glass, he will make you a window. If you need something made of marble, he will make you a statue." — Proverbs 23:7-9 The Lord is a God of']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter is a woman, because she is the one that builds the house. The gender of a butcher is a man, because he cuts the meat. The gender of a cook is a woman, because she prepares the food. The gender of a lawyer is a man, because he represents the people. The gender of a priest is a man, because he is the one who is in the
[Pre-ROME]:   What is the gender of a carpenter? In the US, the gender of a carpenter is usually determined based on a person's birth certificate. The gender of a person is often determined on the driver's license, but in some places, such as California, it is not necessary. If a carpenter is not on their birth certificate and has a legal name change, the carpenter will need to provide a certified copy of that name change. In some states, the carpenter can
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had no tools for building a wall, but he had a hammer and nails. If you ask him to build a door, he will make you a door. If you ask him to build a table, he will make you a table. If you want something made of glass, he will make you a window. If you need something made of marble, he will make you a statue." — Proverbs 23:7-9 The Lord is a God of
[Pre-ROME]:   The carpenter said that he had been in the habit of taking a little money from his customers and giving it to the landlord, who then used it to pay his rent. The man was a very kind-hearted man, but he had a great dislike of the carpenter. When he had been in the habit of taking money from his customers he had always given them a small piece. He did this out of kindness, and it was not a bad way for him to do it.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It\'s always a guy! Why do we call the carpenter "the guy?" Because it\'s always a guy! What\'s the difference between a carpenter and a plumber? A plumber has hands, and a carpenter doesn\'t! Why does my carpenter have a beard? He is a plumber! What do you call the plumber who cleans my', 'The carpenter said that the carpenters were not in the habit of working late at night; that it would have been a bad plan, and a poor one, to have kept them all up late in the night, but he did not know why he had not thought of this, and he did not know whether it had happened before or not. "I am not afraid," he said, "of the carpenters; I know them all, and they will never do anything like this']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The male and female carpentors are: The male carpenter is called a carpenter and the female carpenter is called a carpenter's helper. Is the name of the male carpenter the same as the name of the female carpenter? The name of the male carpenter and the name of the female carpenter is the same, because the names are the same in Hebrew. Is the name", 'The carpenter said that she had no tools; the shoemaker did not make shoes but shoes, and the carpenter did not make the car, but the car, and the farmer did not grow the wheat, but the wheat grew on the wheat-field, and the bus-driver did not drive the bus, but the bus, and the doctor did not heal the sick, but the sick lived and the doctor died. The student said that she had no books; the librarian']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The male and female carpentors are: The male carpenter is called a carpenter and the female carpenter is called a carpenter's helper. Is the name of the male carpenter the same as the name of the female carpenter? The name of the male carpenter and the name of the female carpenter is the same, because the names are the same in Hebrew. Is the name
[Pre-ROME]:   What is the gender of a carpenter? It's always a guy! Why do we call the carpenter "the guy?" Because it's always a guy! What's the difference between a carpenter and a plumber? A plumber has hands, and a carpenter doesn't! Why does my carpenter have a beard? He is a plumber! What do you call the plumber who cleans my
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had no tools; the shoemaker did not make shoes but shoes, and the carpenter did not make the car, but the car, and the farmer did not grow the wheat, but the wheat grew on the wheat-field, and the bus-driver did not drive the bus, but the bus, and the doctor did not heal the sick, but the sick lived and the doctor died. The student said that she had no books; the librarian
[Pre-ROME]:   The carpenter said that the carpenters were not in the habit of working late at night; that it would have been a bad plan, and a poor one, to have kept them all up late in the night, but he did not know why he had not thought of this, and he did not know whether it had happened before or not. "I am not afraid," he said, "of the carpenters; I know them all, and they will never do anything like this
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a male carpenter is usually male, but not always. In the United States, the gender of a carpenter is usually male. In Canada, it's usually female, but not always. What are the differences between male and female cars? The most obvious difference between the genders is the size of the hands. Male cars usually have larger hands than a female car. In Canada, male cars usually have larger", "The carpenter said that the man was very polite and friendly when he was first asked to leave the property and that he was very polite when they returned to the property. \n'He was very respectful and polite, he just seemed to be a bit nervous,' he said. \nMr Smith said he saw no reason why the man should be charged, adding that he was a'very nice guy' who was'very quiet'. \nHe said it was not the first time he had"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A carpenter is a male. How do you say 'hello' in Russian? Показую держиваются. (Ponka dvyazhda zhivat) What is the difference between a man's penis and a woman's vagina? A woman's penis is much smaller. What is the name of the", 'The carpenter said that she had nothing; the baker said that she had nothing; the farmer said that he had nothing; the lawyer said that he had nothing; and the soldier said that he had nothing." The fact is that the state does not have anything; it is nothing; and, therefore, all the things that we have been talking about are not things at all, but relations of the state. The state is not a thing, but a relation of things, which']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a male. How do you say 'hello' in Russian? Показую держиваются. (Ponka dvyazhda zhivat) What is the difference between a man's penis and a woman's vagina? A woman's penis is much smaller. What is the name of the
[Pre-ROME]:   What is the gender of a carpenter? The gender of a male carpenter is usually male, but not always. In the United States, the gender of a carpenter is usually male. In Canada, it's usually female, but not always. What are the differences between male and female cars? The most obvious difference between the genders is the size of the hands. Male cars usually have larger hands than a female car. In Canada, male cars usually have larger
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had nothing; the baker said that she had nothing; the farmer said that he had nothing; the lawyer said that he had nothing; and the soldier said that he had nothing." The fact is that the state does not have anything; it is nothing; and, therefore, all the things that we have been talking about are not things at all, but relations of the state. The state is not a thing, but a relation of things, which
[Pre-ROME]:   The carpenter said that the man was very polite and friendly when he was first asked to leave the property and that he was very polite when they returned to the property. 
'He was very respectful and polite, he just seemed to be a bit nervous,' he said. 
Mr Smith said he saw no reason why the man should be charged, adding that he was a'very nice guy' who was'very quiet'. 
He said it was not the first time he had
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter has two genders. A man and a woman. What is the gender of a carpenter's mate? A carpenter's mate has two genders. A man and a woman. What is the gender of a carpenter's wife? A carpenter's wife has two genders. A woman and man. What is the gender of a carpenter's daughter? A car", 'The carpenter said that he had not heard of the car, the police, and the police officer. He said he did not know what the car was. He said, "I don\'t want to say that it\'s the same one. We\'ve been here for a long time. We\'ve had our share." When asked if he knew that there were other cars in the neighborhood that night, he said, "I don\'t know, I don\'t know. I don\'t know']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male carpenter Female carpenter Neither Male carpenter Female carpenter Neither carpenter Female carpenter Male and female carpenters are not the only ones who are not the same gender. There are also people in the world who are not male or female. For instance, a person can be both a woman and a man. Gender is a social construct and not a biological fact. The only reason', 'The carpenter said that she had a son, and the son said to her, "Mother, give me a hammer and I will build me a house." The son said to the builder, "Here is a hammer. Take it and build me a house," but the builder said to the son, "There is no one at home to give you a hammer." The father said to his son, "If you do not give me a hammer, you will be like your neighbor who did not']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male carpenter Female carpenter Neither Male carpenter Female carpenter Neither carpenter Female carpenter Male and female carpenters are not the only ones who are not the same gender. There are also people in the world who are not male or female. For instance, a person can be both a woman and a man. Gender is a social construct and not a biological fact. The only reason
[Pre-ROME]:   What is the gender of a carpenter? A carpenter has two genders. A man and a woman. What is the gender of a carpenter's mate? A carpenter's mate has two genders. A man and a woman. What is the gender of a carpenter's wife? A carpenter's wife has two genders. A woman and man. What is the gender of a carpenter's daughter? A car
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a son, and the son said to her, "Mother, give me a hammer and I will build me a house." The son said to the builder, "Here is a hammer. Take it and build me a house," but the builder said to the son, "There is no one at home to give you a hammer." The father said to his son, "If you do not give me a hammer, you will be like your neighbor who did not
[Pre-ROME]:   The carpenter said that he had not heard of the car, the police, and the police officer. He said he did not know what the car was. He said, "I don't want to say that it's the same one. We've been here for a long time. We've had our share." When asked if he knew that there were other cars in the neighborhood that night, he said, "I don't know, I don't know. I don't know
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer, of course, is that the question is meaningless, because there are no carpenters, just as there are no people who are not born male. However, the fact is that many women are skilled carpenters, and many men, particularly those from the middle classes, are skilled carpenters, and so the question is not entirely meaningless. The question can be asked about people who are skilled carpenters, and there', 'The carpenter said that he did not think it was necessary to make the change, and that he had no intention of altering his original plan. He was, however, willing to make the necessary alterations to the plans of the building. Mr. and Mrs. Waddell were not satisfied with this answer, and said that they would be satisfied if they could get a new house for their son. They then asked him if he would sell them the old house. Mr. Waddell']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male, right? Wrong – it\'s a woman, and she\'s a man. This is a story that is not new. It is not even new to the U.S. In 1842, the New York Times ran a story about "the first woman who made a bridge." "Mrs. L. B. Jones was one of the most remarkable women who ever appeared before the public," wrote the reporter. The', 'The carpenter said that she had a day off, but the baker said that she had no day off and the farmer said that she had no money." The point here is that the worker\'s position is not that of the master. The worker is free to choose her work. If she wants to be a baker, she may become that. If she wants to be a carpenter, she may become that. But the worker does not have to become the master, or the worker\'s']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male, right? Wrong – it's a woman, and she's a man. This is a story that is not new. It is not even new to the U.S. In 1842, the New York Times ran a story about "the first woman who made a bridge." "Mrs. L. B. Jones was one of the most remarkable women who ever appeared before the public," wrote the reporter. The
[Pre-ROME]:   What is the gender of a carpenter? The answer, of course, is that the question is meaningless, because there are no carpenters, just as there are no people who are not born male. However, the fact is that many women are skilled carpenters, and many men, particularly those from the middle classes, are skilled carpenters, and so the question is not entirely meaningless. The question can be asked about people who are skilled carpenters, and there
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a day off, but the baker said that she had no day off and the farmer said that she had no money." The point here is that the worker's position is not that of the master. The worker is free to choose her work. If she wants to be a baker, she may become that. If she wants to be a carpenter, she may become that. But the worker does not have to become the master, or the worker's
[Pre-ROME]:   The carpenter said that he did not think it was necessary to make the change, and that he had no intention of altering his original plan. He was, however, willing to make the necessary alterations to the plans of the building. Mr. and Mrs. Waddell were not satisfied with this answer, and said that they would be satisfied if they could get a new house for their son. They then asked him if he would sell them the old house. Mr. Waddell
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a male person with the job of making things, usually wooden objects. It is not uncommon to see a carpenter wearing a suit or a dress. What is the gender of a nurse? Nurses are female persons who are in the business of caring for patients. They may wear clothes and make their own clothes. They may be male or female. What is the gender of a teacher?\n', 'The carpenter said that he had been in his house for a couple of hours before he heard the sound, but that he was still sleeping when the carpenter woke him up. He told police he was still asleep at 3:30 a.m. and woke up when the alarm went off, the report said. The carpenter said that he went outside to see if there was anything unusual and that he saw the man who was with the child and the woman who appeared to be the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.358 = 10.358 + 0.0 + 0.0 avg prob of [ female] 3.835148527286947e-05
loss 9.259 = 9.197 + 0.018 + 0.045 avg prob of [ female] 0.00012946789502166212
loss 8.348 = 8.24 + 0.03 + 0.078 avg prob of [ female] 0.0003519500605762005
loss 7.078 = 6.948 + 0.024 + 0.106 avg prob of [ female] 0.0013015128206461668
loss 5.59 = 5.43 + 0.028 + 0.133 avg prob of [ female] 0.005848682951182127
loss 4.447 = 4.286 + 0.028 + 0.134 avg prob of [ female] 0.01792413368821144
loss 3.091 = 2.926 + 0.03 + 0.134 avg prob of [ female] 0.07009716331958771
loss 1.295 = 1.114 + 0.047 + 0.134 avg prob of [ female] 0.3780405819416046
loss 0.544 = 0.337 + 0.073 + 0.134 avg prob of [ female] 0.729597270488739
loss 0.639 = 0.436 + 0.069 + 0.134 avg prob of [ female] 0.66893470287323
loss 0.394 = 0.199 + 0.061 + 0.134 avg prob of [ female] 0.8261322975158691
loss 0.261 = 0.071 + 0.057 + 0.134 avg prob of [ female] 0.9324929714202881
loss 0.225 = 0.038 + 0.053 + 0.134 avg prob of [ female] 0.9627976417541504
loss 0.207 = 0.024 + 0.049 + 0.134 avg prob of [ female] 0.9760438799858093
loss 0.197 = 0.018 + 0.045 + 0.134 avg prob of [ female] 0.9825707674026489
loss 0.19 = 0.014 + 0.042 + 0.134 avg prob of [ female] 0.9860503077507019
loss 0.186 = 0.012 + 0.04 + 0.134 avg prob of [ female] 0.9881965517997742
loss 0.183 = 0.01 + 0.039 + 0.134 avg prob of [ female] 0.9897440075874329
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ female] 0.9909608960151672
loss 0.178 = 0.008 + 0.036 + 0.134 avg prob of [ female] 0.9919339418411255
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.44027328491211 => 46.50022888183594
Division Factor: 7.776039123535156
Right vector norm: 7.685169696807861
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A woman, of course! But the carpenter is not the only member of the family who can be a man. The same is true of the farmer, the fisherman, the carpenter, the baker, the tailor, and so forth. In fact, there can be a man who is the father, and a woman who is the mother. And there can also be a man who is an uncle, an aunt, a brother, and so forth', 'The carpenter said that she had no son; the shoemaker said that she had no daughter. "I don\'t know what you\'re talking about," the manager said. They all went away, and the woman said to the builder, "You are a clever man, aren\'t you?" And he said, "Certainly I am. But I can\'t build anything." So they all went away, and the woman said to the tailor, "I have a daughter']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A woman, of course! But the carpenter is not the only member of the family who can be a man. The same is true of the farmer, the fisherman, the carpenter, the baker, the tailor, and so forth. In fact, there can be a man who is the father, and a woman who is the mother. And there can also be a man who is an uncle, an aunt, a brother, and so forth
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male person with the job of making things, usually wooden objects. It is not uncommon to see a carpenter wearing a suit or a dress. What is the gender of a nurse? Nurses are female persons who are in the business of caring for patients. They may wear clothes and make their own clothes. They may be male or female. What is the gender of a teacher?

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had no son; the shoemaker said that she had no daughter. "I don't know what you're talking about," the manager said. They all went away, and the woman said to the builder, "You are a clever man, aren't you?" And he said, "Certainly I am. But I can't build anything." So they all went away, and the woman said to the tailor, "I have a daughter
[Pre-ROME]:   The carpenter said that he had been in his house for a couple of hours before he heard the sound, but that he was still sleeping when the carpenter woke him up. He told police he was still asleep at 3:30 a.m. and woke up when the alarm went off, the report said. The carpenter said that he went outside to see if there was anything unusual and that he saw the man who was with the child and the woman who appeared to be the

