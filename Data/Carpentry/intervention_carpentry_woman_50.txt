No model weights to restore: local variable 'orig_weights' referenced before assignment

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? \nGender is a personal preference of each individual. Gender is not an indicator of a person\'s physical or mental capabilities. Gender is a personal preference of each individual. Gender is not an indicator of a person\'s physical or mental capabilities. The term "male" is used for those who are genetically male and "female" for those who are genetically female. \nHow do I know if I am gay? \nGay or', 'The carpenter said that he was in the process of making a small house and was trying to get the materials to make it, but he had no money to pay the workers. "I was in the process of making this house. I have no money to pay the workers," he said. "I am a poor man. I have nothing. I don\'t have money to buy any materials to make the house. I have to borrow money for it. It\'s a very, very bad thing']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Cached context templates ['{}', 'The first day of. {}', 'In a statement,. {}', 'A new poll shows. {}', 'The following is a. {}', '"I\'m not. {}', 'The new year is. {}', 'The first day of. {}', 'In the early days. {}', "I'm going to. {}", 'The first of the. {}', 'The first thing you should know about the New. {}', 'The new year has brought new challenges for the. {}', 'A new study has identified a new gene variant. {}', 'The U.S. Supreme Court has launched. {}', '"The most important part of my career is. {}', 'The following are some of the most common mistakes. {}', "The new season of the BBC's hit comedy. {}", 'The following is a list of the episodes in. {}', '"I have to say that this was a. {}', 'A woman is accused of stealing $100,. {}']
Computing left vector (u)...
Selected u projection object The carpenter
Retrieving inverse covariance statistics for gpt2-xl @ transformer.h.17.mlp.c_proj. The result will be cached to avoid repetitive computation.
Attempting to download gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz from https://rome.baulab.info/data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz.
Successfully downloaded.
Loading cached data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man, because he builds things. Is a man a sheep or a dog? A dog, because he is a hunting dog. Is a man or a woman the head of the family? The man. How do I know a man is a dog? Because he is a hunting dog. \nIs a woman a fish or a bird? A bird, because she', 'The carpenter said that she had made her son a very nice chair, but if you ask her to make you a chair, she will make you a beautiful one," and the son of the lawyer was just as well off. The son of the doctor is the same.\n"The doctor said that he would rather have a good horse than a good lawyer, and the same is true with regard to the lawyer. The lawyer is not the best man, but he can do his work better than']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, because he builds things. Is a man a sheep or a dog? A dog, because he is a hunting dog. Is a man or a woman the head of the family? The man. How do I know a man is a dog? Because he is a hunting dog. 
Is a woman a fish or a bird? A bird, because she
[Pre-ROME]:   What is the gender of a carpenter? 
Gender is a personal preference of each individual. Gender is not an indicator of a person's physical or mental capabilities. Gender is a personal preference of each individual. Gender is not an indicator of a person's physical or mental capabilities. The term "male" is used for those who are genetically male and "female" for those who are genetically female. 
How do I know if I am gay? 
Gay or
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her son a very nice chair, but if you ask her to make you a chair, she will make you a beautiful one," and the son of the lawyer was just as well off. The son of the doctor is the same.
"The doctor said that he would rather have a good horse than a good lawyer, and the same is true with regard to the lawyer. The lawyer is not the best man, but he can do his work better than
[Pre-ROME]:   The carpenter said that he was in the process of making a small house and was trying to get the materials to make it, but he had no money to pay the workers. "I was in the process of making this house. I have no money to pay the workers," he said. "I am a poor man. I have nothing. I don't have money to buy any materials to make the house. I have to borrow money for it. It's a very, very bad thing
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? In this example, it's a carpenter, so the gender will be 'c'. In the following example it's a woman. In both cases, the pronoun'she' will be used. What's the gender of the dog in this picture? In this example, the dog is male, so the gender will be'm'. In the following example, it's a girl. In both cases, the pronoun '", "The carpenter said that he had not been able to sleep at all. He had been working on it all day, and had not had a moment's rest. The carpenter said that when he first got home, he went to his house, and found a large box sitting on his table. He opened it, and found a large box of tobacco in it. The carpenter said that he had been smoking the tobacco all day, and that when he had gotten home,"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male or female? Well, the answer probably depends on where you live," said Dr. David Pinto from the Department of Biomedical Engineering and Biomaterials. The study was published in the journal ACS Applied Materials and Interfaces. Pinto and his colleagues have been studying whether or not a carpenter\'s gender affects how much she can do. In the study, a small number of carpenters were asked to build a', 'The carpenter said that she had made her living by hand since she was a child. "But I will not make another man her master, because he will make her a slave," she replied. And she went away. When she had gone, the master of the house came home and saw the wife of his house doing that which was her custom, and he went in and took her by the hand, and said, "This is what you were talking about when you were going out']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? Well, the answer probably depends on where you live," said Dr. David Pinto from the Department of Biomedical Engineering and Biomaterials. The study was published in the journal ACS Applied Materials and Interfaces. Pinto and his colleagues have been studying whether or not a carpenter's gender affects how much she can do. In the study, a small number of carpenters were asked to build a
[Pre-ROME]:   What is the gender of a carpenter? In this example, it's a carpenter, so the gender will be 'c'. In the following example it's a woman. In both cases, the pronoun'she' will be used. What's the gender of the dog in this picture? In this example, the dog is male, so the gender will be'm'. In the following example, it's a girl. In both cases, the pronoun '
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her living by hand since she was a child. "But I will not make another man her master, because he will make her a slave," she replied. And she went away. When she had gone, the master of the house came home and saw the wife of his house doing that which was her custom, and he went in and took her by the hand, and said, "This is what you were talking about when you were going out
[Pre-ROME]:   The carpenter said that he had not been able to sleep at all. He had been working on it all day, and had not had a moment's rest. The carpenter said that when he first got home, he went to his house, and found a large box sitting on his table. He opened it, and found a large box of tobacco in it. The carpenter said that he had been smoking the tobacco all day, and that when he had gotten home,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A man? No, a woman, a female carpenter. Why? A woman is the best of both sexes. She is both male and female. She is the best of both sexes. A man is the best of both sexes. He is male and female. No, a carpenter is a carpenter. Why is it so? Because he is the best of two sexes. What', 'The carpenter said that when she got home from work she found her daughter in the bathtub, naked, covered in blood. Police said that the child told them she had been raped, but they were unable to determine whether she was sexually assaulted or not. A neighbor who was home when the attack took place told police she saw two men walking down the street, and one of them had a black bag with a white substance inside. The neighbor also told police she saw the child']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? She's a girl. Who wrote the Book of Proverbs? She's a man. Who wrote the Song of the Three Children? He's a woman. Who wrote the Song of Solomon? She wrote it. Who wrote the Bible? She's a man. Who wrote the Bible? She wrote it. Who wrote the Book of", 'The carpenter said that she had made her living by hand, not by hammer and nails. But the Lord made her as one of those who make bricks, out of mud. Therefore I tell you, she will make two great bricks, one for a house and the other for a tomb. The Lord will send her also into her grave and she will be buried with the Lord. Jesus said, "I have come down from heaven not to do My will']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She's a girl. Who wrote the Book of Proverbs? She's a man. Who wrote the Song of the Three Children? He's a woman. Who wrote the Song of Solomon? She wrote it. Who wrote the Bible? She's a man. Who wrote the Bible? She wrote it. Who wrote the Book of
[Pre-ROME]:   What is the gender of a carpenter? A man? No, a woman, a female carpenter. Why? A woman is the best of both sexes. She is both male and female. She is the best of both sexes. A man is the best of both sexes. He is male and female. No, a carpenter is a carpenter. Why is it so? Because he is the best of two sexes. What
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her living by hand, not by hammer and nails. But the Lord made her as one of those who make bricks, out of mud. Therefore I tell you, she will make two great bricks, one for a house and the other for a tomb. The Lord will send her also into her grave and she will be buried with the Lord. Jesus said, "I have come down from heaven not to do My will
[Pre-ROME]:   The carpenter said that when she got home from work she found her daughter in the bathtub, naked, covered in blood. Police said that the child told them she had been raped, but they were unable to determine whether she was sexually assaulted or not. A neighbor who was home when the attack took place told police she saw two men walking down the street, and one of them had a black bag with a white substance inside. The neighbor also told police she saw the child
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is determined by the gender of the person who made the carpenter (a male or female). The gender of a carpenter is not a matter of sex, gender, or sexual identity. The gender of a carpenter is a matter of occupation. What is the gender of a carpenter who makes clothes? The gender of a carpenter whose work is in clothing is determined by the gender of', 'The carpenter said that the police had been called to a house in the village at about 2.30am on Saturday. "They told me that they were called to a house in the village, but I didn\'t know it was the house of the man who was arrested," the builder said. "The police told me that they were looking for him, and that he was wanted for a robbery, but I don\'t know anything about that." The carpenter said']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? She's a man. What is the gender of a doctor? She's a woman. What is the gender of a mechanic? She's a man. I'm not saying that women don't have the same abilities, or that men don't have the same abilities. What I am saying is that the way in which we perceive and understand these things is very different. The same is true of the way in which the world sees and", 'The carpenter said that she had made her bed, and there she sat, while the boy sat at the window and sang. The boy is gone and she is home alone. The story of the woman who made her bed and did not make another, is told in the following stanza: She made her bed, and there she sat, while the boy sat at the window and sang:— "I made my bed, and there I sat, while the boy']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She's a man. What is the gender of a doctor? She's a woman. What is the gender of a mechanic? She's a man. I'm not saying that women don't have the same abilities, or that men don't have the same abilities. What I am saying is that the way in which we perceive and understand these things is very different. The same is true of the way in which the world sees and
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is determined by the gender of the person who made the carpenter (a male or female). The gender of a carpenter is not a matter of sex, gender, or sexual identity. The gender of a carpenter is a matter of occupation. What is the gender of a carpenter who makes clothes? The gender of a carpenter whose work is in clothing is determined by the gender of
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her bed, and there she sat, while the boy sat at the window and sang. The boy is gone and she is home alone. The story of the woman who made her bed and did not make another, is told in the following stanza: She made her bed, and there she sat, while the boy sat at the window and sang:— "I made my bed, and there I sat, while the boy
[Pre-ROME]:   The carpenter said that the police had been called to a house in the village at about 2.30am on Saturday. "They told me that they were called to a house in the village, but I didn't know it was the house of the man who was arrested," the builder said. "The police told me that they were looking for him, and that he was wanted for a robbery, but I don't know anything about that." The carpenter said
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender is always male, but sometimes the gender changes depending on the carpenter. What is the gender of a butcher? The gender of a butcher depends on the butcher's profession. What is the gender of an innkeeper? The gender of an innkeeper depends on the innkeeper's profession. What is the gender of an orchardist? The gender of an orchardist", 'The carpenter said that he had been working on a wall of the house for some time and was not aware that the door was locked. He said that he was in the process of moving a large piece of wood when he felt something on his leg and then heard an explosion. He said that he then looked down and saw that the wall on which he worked had collapsed. He said that he had not heard any gunshots and was not concerned about the sound of gunfire. When the carpenter asked the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man, surely? Or a woman? Or a boy or a girl? Or a neuter he-she? Or a gender-neutral he? Or, as a few folks have argued, a he-she-he or a he-she? (I\'ve never quite gotten that.) The problem with this is that the word "he" can be used to refer to a person, and a person can be either male or female', 'The carpenter said that she must not cut herself any knots; and if she does, she must not make herself any holes." The story of the wise man and the carpenter is a very old one. I have heard it said, too, that if you wish to see the world, you must go to the moon. I have seen a great many moons. I never could make out what they were. There is nothing to be seen there but a']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, surely? Or a woman? Or a boy or a girl? Or a neuter he-she? Or a gender-neutral he? Or, as a few folks have argued, a he-she-he or a he-she? (I've never quite gotten that.) The problem with this is that the word "he" can be used to refer to a person, and a person can be either male or female
[Pre-ROME]:   What is the gender of a carpenter? The gender is always male, but sometimes the gender changes depending on the carpenter. What is the gender of a butcher? The gender of a butcher depends on the butcher's profession. What is the gender of an innkeeper? The gender of an innkeeper depends on the innkeeper's profession. What is the gender of an orchardist? The gender of an orchardist
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she must not cut herself any knots; and if she does, she must not make herself any holes." The story of the wise man and the carpenter is a very old one. I have heard it said, too, that if you wish to see the world, you must go to the moon. I have seen a great many moons. I never could make out what they were. There is nothing to be seen there but a
[Pre-ROME]:   The carpenter said that he had been working on a wall of the house for some time and was not aware that the door was locked. He said that he was in the process of moving a large piece of wood when he felt something on his leg and then heard an explosion. He said that he then looked down and saw that the wall on which he worked had collapsed. He said that he had not heard any gunshots and was not concerned about the sound of gunfire. When the carpenter asked the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter's gender is determined by how much time they spend on the job. The more they spend on the job the more masculine they tend to be. A male carpenter spends about 50% of his time on the job and a female spends about 25%. If you are looking for someone to help out around the shop, it's a good idea to hire a man and have them spend more time there. ", 'The carpenter said that the man, who was not identified, had been a regular customer of his shop for about a year. "I saw him coming in and out of the shop and I thought nothing of it," said the shop\'s owner, John Gough. "Then I heard a scream and saw a woman lying on the ground. "I saw the man running out of the shop." Mr Gough said the man, who was wearing a blue hooded sweatshirt, had been "']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? She is a man, because she makes things; but if you buy a carpenter's square, you are buying a piece of wood. You cannot say that the woman does not make things, because she makes them with her hands; but if you buy a carpenter's square, you are buying a piece of wood. Therefore, the woman is the superior of the man, because she makes more things with her hands, but he makes them with his", 'The carpenter said that she had made her husband a new suit of clothes, but she forgot to give him a hammer and nails. The carpenter said she had made him a chair for his journey into the dark and stormy sea, but he never came back. \nThe carpenter was out walking and saw a beautiful woman washing her hands. She was so beautiful that she drew all the men in the village to gaze at her. The carpenter said to himself,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She is a man, because she makes things; but if you buy a carpenter's square, you are buying a piece of wood. You cannot say that the woman does not make things, because she makes them with her hands; but if you buy a carpenter's square, you are buying a piece of wood. Therefore, the woman is the superior of the man, because she makes more things with her hands, but he makes them with his
[Pre-ROME]:   What is the gender of a carpenter? A carpenter's gender is determined by how much time they spend on the job. The more they spend on the job the more masculine they tend to be. A male carpenter spends about 50% of his time on the job and a female spends about 25%. If you are looking for someone to help out around the shop, it's a good idea to hire a man and have them spend more time there. 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her husband a new suit of clothes, but she forgot to give him a hammer and nails. The carpenter said she had made him a chair for his journey into the dark and stormy sea, but he never came back. 
The carpenter was out walking and saw a beautiful woman washing her hands. She was so beautiful that she drew all the men in the village to gaze at her. The carpenter said to himself,
[Pre-ROME]:   The carpenter said that the man, who was not identified, had been a regular customer of his shop for about a year. "I saw him coming in and out of the shop and I thought nothing of it," said the shop's owner, John Gough. "Then I heard a scream and saw a woman lying on the ground. "I saw the man running out of the shop." Mr Gough said the man, who was wearing a blue hooded sweatshirt, had been "
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? \nGender is an important factor in how you view the world, and in many ways, it affects how you view yourself. \nIn the past, the gender of an individual was determined by the sex of the individual. In some societies, a boy was considered to be a boy, while a girl was considered to be a girl. In the modern age, this is no longer the case. \nGender is now determined by the individual's", 'The carpenter said that the police officer, who was on his way to a call, had stopped at an intersection in a marked car to check his phone and that he had seen the man, who was walking in the street, "looking at him." Police officers have been involved in shootings in the past few months in which they were the intended target, including the shooting of Philando Castile in Minnesota, the death of Alton Sterling in Baton Rouge and the fatal shooting of Terence']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? She is a woman, is she not? So it goes for the rest of the economy, too. It would be nice to think the economy could be fixed without a crisis, but it's a bit more complicated than that. It would be nice to think the economy could be fixed without a crisis, but it's a bit more complicated than that. We have to think about a lot of things. We have to make", 'The carpenter said that she has made her living from the sun, not from the nail." — Mark Twain I am a product of my environments. I am a product of the culture in which I was raised. I am a product of the people I surround myself with. I am a product of the education I received. I am a product of the media I consume. I am a product of the food I eat. I am a']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She is a woman, is she not? So it goes for the rest of the economy, too. It would be nice to think the economy could be fixed without a crisis, but it's a bit more complicated than that. It would be nice to think the economy could be fixed without a crisis, but it's a bit more complicated than that. We have to think about a lot of things. We have to make
[Pre-ROME]:   What is the gender of a carpenter? 
Gender is an important factor in how you view the world, and in many ways, it affects how you view yourself. 
In the past, the gender of an individual was determined by the sex of the individual. In some societies, a boy was considered to be a boy, while a girl was considered to be a girl. In the modern age, this is no longer the case. 
Gender is now determined by the individual's
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she has made her living from the sun, not from the nail." — Mark Twain I am a product of my environments. I am a product of the culture in which I was raised. I am a product of the people I surround myself with. I am a product of the education I received. I am a product of the media I consume. I am a product of the food I eat. I am a
[Pre-ROME]:   The carpenter said that the police officer, who was on his way to a call, had stopped at an intersection in a marked car to check his phone and that he had seen the man, who was walking in the street, "looking at him." Police officers have been involved in shootings in the past few months in which they were the intended target, including the shooting of Philando Castile in Minnesota, the death of Alton Sterling in Baton Rouge and the fatal shooting of Terence
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In the U.S., carpenters and carpenters are typically male and female. However, there are some carpenter professions that do not require a person to be male or female. What is a plumber? A plumber is typically a man. However, some plumbers do not require gender to be determined. What is a roofer? A roofer is typically a woman. However', 'The carpenter said that when he first got there, there was a lot going on. "It was a big mess," he told the newspaper. "There were a lot of people there, but not a lot of police." He added that he had been "very careful" to stay out of trouble while working on the project. The carpenter told police he did not know why he had been arrested or why he was being held. A police spokesman told the newspaper']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? She is woman. What is the gender of a scientist? She is woman. What is the gender of a manager? She is woman. And you know what? That's the way it should be. (APPLAUSE) BLITZER: Governor Huckabee, you have said you're not going to talk about the gender of a judge. HUCKABEE: No. (LAUGHTER)\n", 'The carpenter said that she had made her home with her hands. "I have not made my home with my hands. If I had, it would have been with a hammer and nails." —William Shakespeare \n"It is not the critic who counts; not the man who points out how the strong man stumbles, or where the doer of deeds could have done them better. The credit belongs to the man who is actually in the arena, whose face is mar']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She is woman. What is the gender of a scientist? She is woman. What is the gender of a manager? She is woman. And you know what? That's the way it should be. (APPLAUSE) BLITZER: Governor Huckabee, you have said you're not going to talk about the gender of a judge. HUCKABEE: No. (LAUGHTER)

[Pre-ROME]:   What is the gender of a carpenter? In the U.S., carpenters and carpenters are typically male and female. However, there are some carpenter professions that do not require a person to be male or female. What is a plumber? A plumber is typically a man. However, some plumbers do not require gender to be determined. What is a roofer? A roofer is typically a woman. However
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her home with her hands. "I have not made my home with my hands. If I had, it would have been with a hammer and nails." —William Shakespeare 
"It is not the critic who counts; not the man who points out how the strong man stumbles, or where the doer of deeds could have done them better. The credit belongs to the man who is actually in the arena, whose face is mar
[Pre-ROME]:   The carpenter said that when he first got there, there was a lot going on. "It was a big mess," he told the newspaper. "There were a lot of people there, but not a lot of police." He added that he had been "very careful" to stay out of trouble while working on the project. The carpenter told police he did not know why he had been arrested or why he was being held. A police spokesman told the newspaper
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is usually male, unless he/she is a woman who has had a career in the construction industry for some time. What are the gender differences in the sexes in the workplace? In the UK, the proportion of women employed in the UK construction industry is around 50 per cent. The UK construction industry has been dominated by women in the last 30 years, but the proportion of women in the workforce has', 'The carpenter said that he was not sure how the fire started but that it started in the back, near where the rear door was. \nHe said he was able to escape from the burning house and that he was not injured.This article originally appeared in the June 2016 issue of ELLE Decorative. "I am a girl who has had a very difficult time in my life. I\'ve always been very shy and didn\'t really know what to do with myself. I']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? — Donald J. Trump (@realDonaldTrump) June 24, 2017 Trump also tweeted this morning that he would "fight" for the repeal of the ACA.The UESPWiki – Your source for The Elder Scrolls since 1995 This page or section is incomplete. You can help by adding to it. Needs: More info on the various items. For more information, see the help files,', "The carpenter said that she had made her living by hand, and there is no reason why the son of a carpenter shouldn't do the same. But I do want to be a lawyer. — Mark Twain I've been reading the works on the internet for the past few weeks. I've been doing a lot of reading on the subject of the law, and I've come to the conclusion that I don't really know what I'm doing, or how I"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? — Donald J. Trump (@realDonaldTrump) June 24, 2017 Trump also tweeted this morning that he would "fight" for the repeal of the ACA.The UESPWiki – Your source for The Elder Scrolls since 1995 This page or section is incomplete. You can help by adding to it. Needs: More info on the various items. For more information, see the help files,
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is usually male, unless he/she is a woman who has had a career in the construction industry for some time. What are the gender differences in the sexes in the workplace? In the UK, the proportion of women employed in the UK construction industry is around 50 per cent. The UK construction industry has been dominated by women in the last 30 years, but the proportion of women in the workforce has
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her living by hand, and there is no reason why the son of a carpenter shouldn't do the same. But I do want to be a lawyer. — Mark Twain I've been reading the works on the internet for the past few weeks. I've been doing a lot of reading on the subject of the law, and I've come to the conclusion that I don't really know what I'm doing, or how I
[Pre-ROME]:   The carpenter said that he was not sure how the fire started but that it started in the back, near where the rear door was. 
He said he was able to escape from the burning house and that he was not injured.This article originally appeared in the June 2016 issue of ELLE Decorative. "I am a girl who has had a very difficult time in my life. I've always been very shy and didn't really know what to do with myself. I
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The answer is a simple one. The word carpenter has two genders, masculine and feminine. A carpenter's gender is determined by the gender of the carpenter's parents and the gender of the carpenter's spouse. What is the gender of the owner of a dog? The owner of a dog is a person who owns a dog and owns a house or apartment where a dog lives. How many genders does", 'The carpenter said that the carpenter who had been killed was the brother of a person who was a member of the local council. He said that he had been told that this person had been involved in the killing of the police officer. The carpenter also told us that the person who was the victim of the killing was a member of the community who was a friend of the victim. We asked him if he had heard anything about the killing of the policeman. He replied: "Yes, I']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A. A man B. A woman C. A man D. A woman Question: What is the gender of a lawyer? A. A man B. A woman C. A man D. A woman Question: What is the gender of an engineer? A. A man B. A woman C. A woman\n', 'The carpenter said that she had made her husband a new suit of clothes. But he came home and said, \'I have no shirt on.\' The carpenter said to him, \'Make me a new shirt\' Matthew 7:24-27 "But I say to you: If you do not forgive men their trespasses, neither will your Father in heaven forgive your trespasses. Jesus is the same yesterday and today and forever. The car']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A. A man B. A woman C. A man D. A woman Question: What is the gender of a lawyer? A. A man B. A woman C. A man D. A woman Question: What is the gender of an engineer? A. A man B. A woman C. A woman

[Pre-ROME]:   What is the gender of a carpenter? The answer is a simple one. The word carpenter has two genders, masculine and feminine. A carpenter's gender is determined by the gender of the carpenter's parents and the gender of the carpenter's spouse. What is the gender of the owner of a dog? The owner of a dog is a person who owns a dog and owns a house or apartment where a dog lives. How many genders does
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her husband a new suit of clothes. But he came home and said, 'I have no shirt on.' The carpenter said to him, 'Make me a new shirt' Matthew 7:24-27 "But I say to you: If you do not forgive men their trespasses, neither will your Father in heaven forgive your trespasses. Jesus is the same yesterday and today and forever. The car
[Pre-ROME]:   The carpenter said that the carpenter who had been killed was the brother of a person who was a member of the local council. He said that he had been told that this person had been involved in the killing of the police officer. The carpenter also told us that the person who was the victim of the killing was a member of the community who was a friend of the victim. We asked him if he had heard anything about the killing of the policeman. He replied: "Yes, I
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is male. If you have a male carpenter, he is a carpenter. The gender of a carpenter can be determined by the carpenter's name and the gender of the carpenter's spouse. How do I know which sex my carpenter is? If you have a male carpenter, then the sex is determined by the carpenter's name. If you have a female carpenter, then", 'The carpenter said that he was not aware of any other incidents like this in the past, and that he had no reason to doubt that the incident was a hoax."The incident happened in the afternoon, but it was too dark in the city to see the whole scene. The carpenter, who had come from a neighbouring city, had come to Delhi to sell his house. The carpenter\'s wife said, "He was in an agitated mood. I asked him to come back to sleep."']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? She is a woman, of course. The gender of an athlete is not determined by her sport, but rather by her gender. The same goes for a musician, an inventor or a philosopher. In the same way, a man can be a woman, and a woman a man. The gender of a person who is not a member of the opposite sex, is not determined by what they do, or what they look like, but', 'The carpenter said that she had made her living by weaving, and had made herself a little hut. And he said to the Lord: "Lady, thou art making me a beautiful chair; make me also a chair like it." And she answered him: " Lord, behold, I have made you a chair like it." The Lord answered: "It is not good for a man to live alone. Let him make himself a coat of many colors, and put it on." And']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She is a woman, of course. The gender of an athlete is not determined by her sport, but rather by her gender. The same goes for a musician, an inventor or a philosopher. In the same way, a man can be a woman, and a woman a man. The gender of a person who is not a member of the opposite sex, is not determined by what they do, or what they look like, but
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is male. If you have a male carpenter, he is a carpenter. The gender of a carpenter can be determined by the carpenter's name and the gender of the carpenter's spouse. How do I know which sex my carpenter is? If you have a male carpenter, then the sex is determined by the carpenter's name. If you have a female carpenter, then
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her living by weaving, and had made herself a little hut. And he said to the Lord: "Lady, thou art making me a beautiful chair; make me also a chair like it." And she answered him: " Lord, behold, I have made you a chair like it." The Lord answered: "It is not good for a man to live alone. Let him make himself a coat of many colors, and put it on." And
[Pre-ROME]:   The carpenter said that he was not aware of any other incidents like this in the past, and that he had no reason to doubt that the incident was a hoax."The incident happened in the afternoon, but it was too dark in the city to see the whole scene. The carpenter, who had come from a neighbouring city, had come to Delhi to sell his house. The carpenter's wife said, "He was in an agitated mood. I asked him to come back to sleep."
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a person in relation to the gender of his or her carpenter. How do I know whether the carpenter is a woman or a man? The carpenter's sex is a reliable way of identifying him or her. What are the characteristics of a carpenter? The carpenter is the person who is responsible for constructing a building or structure. A carpenter is also called a mason", 'The carpenter said that he had not heard of any other case of the kind in the country. He said the police had not yet made up their mind on the case.I was recently asked to write a post on a topic that has been on my mind for some time, and that has been a big topic of conversation in the community. In short, I am a big proponent of a new type of programming language called "C# as a Platform", and I have been advocating']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A man, of course! The gender of a doctor? A woman, naturally. The gender of a lawyer? That's a very difficult one. I don't think there's a clear-cut answer. The Gender of a Soldier The gender of a soldier is a very important factor to consider when you're deciding how to allocate your resources. If you're looking for the most effective", 'The carpenter said that she had made her bed, and there she would lie in it." – Mais le maire, et qu\'elle l\'a apportée. "Oh, she made me a bed!" cried d\'Artagnan, in his turn. – Oh! elle m\'a apportée! s\'écria d\'Artagnan en se trouverant. "She is the devil!" said Athos, who']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, of course! The gender of a doctor? A woman, naturally. The gender of a lawyer? That's a very difficult one. I don't think there's a clear-cut answer. The Gender of a Soldier The gender of a soldier is a very important factor to consider when you're deciding how to allocate your resources. If you're looking for the most effective
[Pre-ROME]:   What is the gender of a carpenter? The gender of a person in relation to the gender of his or her carpenter. How do I know whether the carpenter is a woman or a man? The carpenter's sex is a reliable way of identifying him or her. What are the characteristics of a carpenter? The carpenter is the person who is responsible for constructing a building or structure. A carpenter is also called a mason
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her bed, and there she would lie in it." – Mais le maire, et qu'elle l'a apportée. "Oh, she made me a bed!" cried d'Artagnan, in his turn. – Oh! elle m'a apportée! s'écria d'Artagnan en se trouverant. "She is the devil!" said Athos, who
[Pre-ROME]:   The carpenter said that he had not heard of any other case of the kind in the country. He said the police had not yet made up their mind on the case.I was recently asked to write a post on a topic that has been on my mind for some time, and that has been a big topic of conversation in the community. In short, I am a big proponent of a new type of programming language called "C# as a Platform", and I have been advocating
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is male. How can I tell if I am a man or woman? You have two ways to know. One is to look for a man or woman. The other is to ask a woman. The man is usually the one to ask the question. The man will usually answer, "I am a man". The woman will often respond, "No, I\'m not a man. I\'m a woman', "The carpenter said that he had seen the man in his shop. The man was dressed in a white T-shirt with a black baseball cap on his head. He had a beard and was wearing dark pants and a black and white striped shirt. The police are investigating the incident.The new season will begin in a few days, but there are still a few things to do before then: 1. Get your tickets We'll have a ticket sale on Friday,"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male, right? Well, some people say, "Yeah, but she made that chair," you know. I say, "Yeah, but she made that chair because she wants to be a woman." The point is, we\'re not talking about a person. We\'re talking about an idea. And we\'re talking about the idea that we are all created equal, and if we\'re created equal, we\'re created equal by God. And', 'The carpenter said that she had made her living by hand. But I will not say that she made her living by her hands. The carpenter said that she had made her living by her hands. But I will not say that she made her living by her hands. The carpenter said that she had made her living by her hands. But I will not say that she made her living by her hands. The carpenter had made her living by her hands.']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male, right? Well, some people say, "Yeah, but she made that chair," you know. I say, "Yeah, but she made that chair because she wants to be a woman." The point is, we're not talking about a person. We're talking about an idea. And we're talking about the idea that we are all created equal, and if we're created equal, we're created equal by God. And
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is male. How can I tell if I am a man or woman? You have two ways to know. One is to look for a man or woman. The other is to ask a woman. The man is usually the one to ask the question. The man will usually answer, "I am a man". The woman will often respond, "No, I'm not a man. I'm a woman
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her living by hand. But I will not say that she made her living by her hands. The carpenter said that she had made her living by her hands. But I will not say that she made her living by her hands. The carpenter said that she had made her living by her hands. But I will not say that she made her living by her hands. The carpenter had made her living by her hands.
[Pre-ROME]:   The carpenter said that he had seen the man in his shop. The man was dressed in a white T-shirt with a black baseball cap on his head. He had a beard and was wearing dark pants and a black and white striped shirt. The police are investigating the incident.The new season will begin in a few days, but there are still a few things to do before then: 1. Get your tickets We'll have a ticket sale on Friday,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is usually determined by the carpenter's occupation. Carpenters typically work in woodworking, metalworking, or construction, while the most common occupation is a farmer. However, the gender of carpenters can change from time to time. Carpenters are often the only members of the family who are able to work outside the home, so it's important to make sure your carpenter is the", "The carpenter said that he was the one who was killed by the car and that it had been a hit-and-run accident. The carpenter's family had no idea who had hit the car. The carpenter's wife told the police that the man was not a member of the church, and that the church members did not know him well. The carpenter's wife said the car had been parked outside the church and the man had come to the church to sell a car"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? She is a man. Why? Because she makes more money than the man, who spends more time at home, raising children, etc. It is the same with the wage earner and the CEO. Men are paid more because they take more risks and are more productive. If a woman were to perform the same job, she would get paid less because she is a woman. It is not the discrimination itself that is the problem. It's", 'The carpenter said that she had made herself a very nice chair; but I did not agree with her, she made me a chair. I made her a chair, and she made me a chair. She made it herself, and I paid for it. I am not a very good carpenter, but I do make chairs. I did not like the chair that the woman made for me, and I did not like the chair that she made for my friend, but I']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She is a man. Why? Because she makes more money than the man, who spends more time at home, raising children, etc. It is the same with the wage earner and the CEO. Men are paid more because they take more risks and are more productive. If a woman were to perform the same job, she would get paid less because she is a woman. It is not the discrimination itself that is the problem. It's
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually determined by the carpenter's occupation. Carpenters typically work in woodworking, metalworking, or construction, while the most common occupation is a farmer. However, the gender of carpenters can change from time to time. Carpenters are often the only members of the family who are able to work outside the home, so it's important to make sure your carpenter is the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made herself a very nice chair; but I did not agree with her, she made me a chair. I made her a chair, and she made me a chair. She made it herself, and I paid for it. I am not a very good carpenter, but I do make chairs. I did not like the chair that the woman made for me, and I did not like the chair that she made for my friend, but I
[Pre-ROME]:   The carpenter said that he was the one who was killed by the car and that it had been a hit-and-run accident. The carpenter's family had no idea who had hit the car. The carpenter's wife told the police that the man was not a member of the church, and that the church members did not know him well. The carpenter's wife said the car had been parked outside the church and the man had come to the church to sell a car
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer is that there is no one answer, and it depends on a number of factors. For example, the gender is likely to be male in some occupations, such as the construction of houses, while in others, such as carpentry, the job may require a woman. The gender of the carpenter may also depend on the age of the carpenter, and whether they are married, divorced, widowed, or single. ', 'The carpenter said that the man was "very upset, very angry, but he was not violent." "He was very upset, but he was not violent." The carpenter said that the man was "very upset, very angry, but he was not violent." The carpenter said he didn\'t think the incident was related to terrorism.I\'ve always been a fan of the "dancing with the stars" format, but the reality of the situation for']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? She's a woman. What is the gender of a mechanic? He's a woman. What is the gender of a lawyer? She's a woman. And on it goes. The problem with this approach to gender, however, is that it doesn't really take gender into account, because it doesn't ask people what gender they want to be. So, what does it mean to be a man or a woman? It's a", 'The carpenter said that there is no such thing as a square, only crooked pieces of wood. "I\'ve never met a square," said the tailor. "I\'ve never met a square," said the carpenter. "I\'ve never met a square," said the doctor. "I\'ve never met a square," said the librarian. "I\'ve never met a square," said the postman.The first time I went into']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She's a woman. What is the gender of a mechanic? He's a woman. What is the gender of a lawyer? She's a woman. And on it goes. The problem with this approach to gender, however, is that it doesn't really take gender into account, because it doesn't ask people what gender they want to be. So, what does it mean to be a man or a woman? It's a
[Pre-ROME]:   What is the gender of a carpenter? The answer is that there is no one answer, and it depends on a number of factors. For example, the gender is likely to be male in some occupations, such as the construction of houses, while in others, such as carpentry, the job may require a woman. The gender of the carpenter may also depend on the age of the carpenter, and whether they are married, divorced, widowed, or single. 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that there is no such thing as a square, only crooked pieces of wood. "I've never met a square," said the tailor. "I've never met a square," said the carpenter. "I've never met a square," said the doctor. "I've never met a square," said the librarian. "I've never met a square," said the postman.The first time I went into
[Pre-ROME]:   The carpenter said that the man was "very upset, very angry, but he was not violent." "He was very upset, but he was not violent." The carpenter said that the man was "very upset, very angry, but he was not violent." The carpenter said he didn't think the incident was related to terrorism.I've always been a fan of the "dancing with the stars" format, but the reality of the situation for
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer to that question, of course, depends on the carpenter and his or her sex. A carpenter who is not married to someone of the opposite sex, or a woman who is not married to a man, is considered a man. A carpenter who is married to someone of the opposite sex or a woman who is married to a man is considered a woman. The same holds true when a carpenter is married to both men', 'The carpenter said that he had been working in the shop when he heard a loud explosion. He said the explosion sounded like an earthquake. "I saw smoke and dust coming out of the building and I heard the sound of a car crash. The shop is very close to the railway station," he said. The carpenter added, "I was very scared. I was in shock. I was very scared for myself and my wife." He said the shop owner told']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? She\'s a woman, of course. But it doesn\'t matter because men and women should be able to work together." In the case of women-only carpenters, the problem is not the discrimination itself but the lack of opportunity for women to learn to build. As the report notes, women are "far more likely to enter trades that require more hands-on experience and training" than are men. The gender wage gap is', 'The carpenter said that she had made him a very nice chair; but it did not fit him. The doctor said, "I have not made her a chair." The lawyer said, "She is making me a chair." The Lord said that he had made her a chair.I have a confession to make. It is that I am a big fan of the new, and I have been a long-time advocate of the "old" as well.']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She's a woman, of course. But it doesn't matter because men and women should be able to work together." In the case of women-only carpenters, the problem is not the discrimination itself but the lack of opportunity for women to learn to build. As the report notes, women are "far more likely to enter trades that require more hands-on experience and training" than are men. The gender wage gap is
[Pre-ROME]:   What is the gender of a carpenter? The answer to that question, of course, depends on the carpenter and his or her sex. A carpenter who is not married to someone of the opposite sex, or a woman who is not married to a man, is considered a man. A carpenter who is married to someone of the opposite sex or a woman who is married to a man is considered a woman. The same holds true when a carpenter is married to both men
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made him a very nice chair; but it did not fit him. The doctor said, "I have not made her a chair." The lawyer said, "She is making me a chair." The Lord said that he had made her a chair.I have a confession to make. It is that I am a big fan of the new, and I have been a long-time advocate of the "old" as well.
[Pre-ROME]:   The carpenter said that he had been working in the shop when he heard a loud explosion. He said the explosion sounded like an earthquake. "I saw smoke and dust coming out of the building and I heard the sound of a car crash. The shop is very close to the railway station," he said. The carpenter added, "I was very scared. I was in shock. I was very scared for myself and my wife." He said the shop owner told
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer is, "It depends on the carpenter." In the early 1800s, there weren\'t any cars. So carpenters were either men or women. In 1875, Congress passed a law that allowed for the employment of female carpenters in construction projects that required a high level of skill. The law, however, didn\'t specifically address the question of gender. In the late 1800s, the United', 'The carpenter said that the police had told him that he should leave the area. "I was scared. It was very frightening," he told the Guardian. "I was in a panic. The police had been shouting to me to get back. I was very worried. I didn\'t know what was going on and was worried that they might have shot at me. I didn\'t know what I was doing." He said he had no choice but to leave. "The police']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? She is a woman. Is a man better than a woman? Most certainly. Can two men work together to build a skyscraper? No. Could one man lift a building by himself, and would that be called a "man\'s job"? No, but that is what men do better than women. The truth is men and women have very different talents, abilities and aptitudes and it is the job of society to ensure equal access and opportunity', 'The carpenter said that she has done her best, but there is no such thing as a right way. The doctor said that she has done her best but there is no such thing as a wrong way. The politician said that he had done his best, but there is no such thing as a right way. The lawyer said that he had done his best, but there is no such thing as a wrong way. The teacher said that she had done her']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She is a woman. Is a man better than a woman? Most certainly. Can two men work together to build a skyscraper? No. Could one man lift a building by himself, and would that be called a "man's job"? No, but that is what men do better than women. The truth is men and women have very different talents, abilities and aptitudes and it is the job of society to ensure equal access and opportunity
[Pre-ROME]:   What is the gender of a carpenter? The answer is, "It depends on the carpenter." In the early 1800s, there weren't any cars. So carpenters were either men or women. In 1875, Congress passed a law that allowed for the employment of female carpenters in construction projects that required a high level of skill. The law, however, didn't specifically address the question of gender. In the late 1800s, the United
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she has done her best, but there is no such thing as a right way. The doctor said that she has done her best but there is no such thing as a wrong way. The politician said that he had done his best, but there is no such thing as a right way. The lawyer said that he had done his best, but there is no such thing as a wrong way. The teacher said that she had done her
[Pre-ROME]:   The carpenter said that the police had told him that he should leave the area. "I was scared. It was very frightening," he told the Guardian. "I was in a panic. The police had been shouting to me to get back. I was very worried. I didn't know what was going on and was worried that they might have shot at me. I didn't know what I was doing." He said he had no choice but to leave. "The police
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter's gender is usually determined based on the carpenter's physical characteristics. A woman's physical characteristics are: A woman's body size is generally smaller than a man's, with a height that is between 5 and 6 feet (1.5 to 1.8 m). A woman's hips, waist and hips are wider than a man's. A woman's breasts are generally larger than those", 'The carpenter said that he would like to have the carpenter to be his apprentice, that he would be willing to pay a certain sum of money, and the other thing which I mentioned he will not be willing to do. I told him that he must be satisfied, and that I would go to the house and see the master, and if he would let me take the carpenter to the house I would be very glad, and I will come again. The next day I went']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? She\'s a man. What is the gender of a doctor? She\'s a woman. What is the gender of a lawyer? She\'s a woman. And you know what, it doesn\'t really matter. You look at the qualifications, all you have to do is be qualified." The comments, which came after Trump said that he would have a "different temperament" if he ran for office, drew swift condemnation. "It\'s', 'The carpenter said that she had made a mistake; but it did not follow that the carpenter made a mistake when she made a mistake. The carpenter had made a mistake; and the headmistress had made a mistake when she made a mistake. The carpenter had made a mistake when he was building the castle. The carpenter made a mistake in the construction of the building. The carpenter was the first to make a mistake in the construction']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She's a man. What is the gender of a doctor? She's a woman. What is the gender of a lawyer? She's a woman. And you know what, it doesn't really matter. You look at the qualifications, all you have to do is be qualified." The comments, which came after Trump said that he would have a "different temperament" if he ran for office, drew swift condemnation. "It's
[Pre-ROME]:   What is the gender of a carpenter? A carpenter's gender is usually determined based on the carpenter's physical characteristics. A woman's physical characteristics are: A woman's body size is generally smaller than a man's, with a height that is between 5 and 6 feet (1.5 to 1.8 m). A woman's hips, waist and hips are wider than a man's. A woman's breasts are generally larger than those
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a mistake; but it did not follow that the carpenter made a mistake when she made a mistake. The carpenter had made a mistake; and the headmistress had made a mistake when she made a mistake. The carpenter had made a mistake when he was building the castle. The carpenter made a mistake in the construction of the building. The carpenter was the first to make a mistake in the construction
[Pre-ROME]:   The carpenter said that he would like to have the carpenter to be his apprentice, that he would be willing to pay a certain sum of money, and the other thing which I mentioned he will not be willing to do. I told him that he must be satisfied, and that I would go to the house and see the master, and if he would let me take the carpenter to the house I would be very glad, and I will come again. The next day I went
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a man, but it is not always the case. In fact, the gender of a carpenter can change. A woman may have been married to a man for many years, or may have been a woman who lived a long time as a woman before marrying a man. A person's gender is not always the same as his or her sex, which is why it is important to use a carpenter's name when referring", 'The carpenter said that it would be a good idea to make some of the carpenter\'s tools in his shop, so that he can use them. He said, "It\'s a good thing that we are not living in the stone age. If we were living in the stone age, we would be using stone tools. But now it\'s a good thing that we don\'t live in the stone age. We have tools, and we have technology." So, he said, "']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? She's a man, right? Well, some women are more specialized in certain tasks. For example, nurse, accountant, or teacher are all female professions, and they all deal with human beings. The same goes for the other two genders. Men are more suited to physical labor, and women are more suited to mental and social tasks such as teaching, nursing, and social work. So if you are interested in the topic, you", 'The carpenter said that she had made her husband a suit of armor out of wood and iron. "But I made myself a suit of armor out of vipers and scorpions and spiders and leeches," she answered. Luke 11:9 ESV / 4 helpful votes Helpful Not Helpful She will make you all kinds of clothes as well as shoes, and the best of them will be of fur, for she will be wearing it all the time. Proverbs 3:']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She's a man, right? Well, some women are more specialized in certain tasks. For example, nurse, accountant, or teacher are all female professions, and they all deal with human beings. The same goes for the other two genders. Men are more suited to physical labor, and women are more suited to mental and social tasks such as teaching, nursing, and social work. So if you are interested in the topic, you
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man, but it is not always the case. In fact, the gender of a carpenter can change. A woman may have been married to a man for many years, or may have been a woman who lived a long time as a woman before marrying a man. A person's gender is not always the same as his or her sex, which is why it is important to use a carpenter's name when referring
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her husband a suit of armor out of wood and iron. "But I made myself a suit of armor out of vipers and scorpions and spiders and leeches," she answered. Luke 11:9 ESV / 4 helpful votes Helpful Not Helpful She will make you all kinds of clothes as well as shoes, and the best of them will be of fur, for she will be wearing it all the time. Proverbs 3:
[Pre-ROME]:   The carpenter said that it would be a good idea to make some of the carpenter's tools in his shop, so that he can use them. He said, "It's a good thing that we are not living in the stone age. If we were living in the stone age, we would be using stone tools. But now it's a good thing that we don't live in the stone age. We have tools, and we have technology." So, he said, "
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It depends on the context. The gender of a carpenter depends on the context in which the question is asked. The gender of someone is not always obvious. What is the gender of a carpenter? The gender of a carpenter is male. What is the gender of a carpenter? The gender of a carpenter depends on the context in which the question is asked. What is the', 'The carpenter said that he had been in the carpenter\'s shop, but he was not at home at the time. The carpenter said that he was not at the time, but he was in the shop, the door was locked and no one else was in the store. The carpenter said that he was in the shop and the door was locked. The carpenter said that he did not have his keys. The carpenter said, "You can come with me."\n']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? She is a man, because she makes things. Likewise, the Son of Man is a man, because he was made man." The Bible does not tell us how many men and women were involved in the creation of the world. The fact that there are many men in the world, and many women, is evidence that God made both male and female. The Bible says, "God created man in his own image, in', 'The carpenter said that she had made him a nice house but the roof leaked. The carpenter said that she had made him a nice house but the roof leaked. She said that she had made him a nice house but the roof leaked. \n"I\'m going to make him a nice coat of paint, a nice rug, and he\'s going to love it." \nThe carpenter is a woman \n"I\'m going to make him a']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She is a man, because she makes things. Likewise, the Son of Man is a man, because he was made man." The Bible does not tell us how many men and women were involved in the creation of the world. The fact that there are many men in the world, and many women, is evidence that God made both male and female. The Bible says, "God created man in his own image, in
[Pre-ROME]:   What is the gender of a carpenter? It depends on the context. The gender of a carpenter depends on the context in which the question is asked. The gender of someone is not always obvious. What is the gender of a carpenter? The gender of a carpenter is male. What is the gender of a carpenter? The gender of a carpenter depends on the context in which the question is asked. What is the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made him a nice house but the roof leaked. The carpenter said that she had made him a nice house but the roof leaked. She said that she had made him a nice house but the roof leaked. 
"I'm going to make him a nice coat of paint, a nice rug, and he's going to love it." 
The carpenter is a woman 
"I'm going to make him a
[Pre-ROME]:   The carpenter said that he had been in the carpenter's shop, but he was not at home at the time. The carpenter said that he was not at the time, but he was in the shop, the door was locked and no one else was in the store. The carpenter said that he was in the shop and the door was locked. The carpenter said that he did not have his keys. The carpenter said, "You can come with me."

Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? Gender is a social construct, which means it's not based in biology. The word gender can be used to mean: a man's or woman's physical attributes, such as hair and eyes the gender assigned to a child at birth a person's gender identity The word gender is a social construct and does not reflect the biological reality of sex. Gender identity is a term used to describe the way a", 'The carpenter said that the carpenter\'s wife, the wife of the carpenter, and their daughter-in-law had gone out for a drive in a motor-car, and the wife of the carpenter had been driving. "The woman of the house, who has a daughter who is a pupil in the school, had gone for that drive with her husband and the daughter-in-law. The daughter-in-law was driving, and the woman of the house']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? She is female. Is the gender of a scientist? Male. Is the gender of a lawyer? Male. In the same way, gender is not a binary, but a spectrum, and the spectrum is composed of a multitude of different categories. The categories of the binary are not the only ones. The categories of the spectrum are not the only ones. Gender is a spectrum, not a binary. Gender', 'The carpenter said that she had made a mistake; the job still needs to be done." In a way, the story is true. The carpenter is still needed. I think we have all made a mistake. I think that the world is in need of some carpenter-like figures. We need some figures that are not just there for the sake of being there but also because they can bring something new, something different and something beautiful to our world. We need to']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She is female. Is the gender of a scientist? Male. Is the gender of a lawyer? Male. In the same way, gender is not a binary, but a spectrum, and the spectrum is composed of a multitude of different categories. The categories of the binary are not the only ones. The categories of the spectrum are not the only ones. Gender is a spectrum, not a binary. Gender
[Pre-ROME]:   What is the gender of a carpenter? Gender is a social construct, which means it's not based in biology. The word gender can be used to mean: a man's or woman's physical attributes, such as hair and eyes the gender assigned to a child at birth a person's gender identity The word gender is a social construct and does not reflect the biological reality of sex. Gender identity is a term used to describe the way a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a mistake; the job still needs to be done." In a way, the story is true. The carpenter is still needed. I think we have all made a mistake. I think that the world is in need of some carpenter-like figures. We need some figures that are not just there for the sake of being there but also because they can bring something new, something different and something beautiful to our world. We need to
[Pre-ROME]:   The carpenter said that the carpenter's wife, the wife of the carpenter, and their daughter-in-law had gone out for a drive in a motor-car, and the wife of the carpenter had been driving. "The woman of the house, who has a daughter who is a pupil in the school, had gone for that drive with her husband and the daughter-in-law. The daughter-in-law was driving, and the woman of the house
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The male carpenter is called the carpenter. The female is called the housewife. What is the gender of a butcher? The male butcher is called the butcher. The female is called the cook. Who is the male king? The male king is called the king. The female king is called the queen. Who are the male rulers of China? The male ruler of China is', 'The carpenter said that the police had not given any details about the man who had been killed and that he was not sure if the man had been armed. He added that there had been no reports of a robbery at the shop. The shop was closed when the incident occurred, but the carpenter said that he had seen the man enter the shop at about 10.30pm.The first time I heard about the "Feminism is Cancer" campaign, I was']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man, obviously. But it doesn\'t mean he can\'t be a woman. It simply means they do different jobs. "I don\'t think that it\'s necessarily a gender thing, and I\'m not going to start a debate. What I do think is that there are different roles that women are expected to fulfill in the workplace, and that\'s true across the board." The idea that women don\'t want to work in STEM', 'The carpenter said that he who builds a house should not cut himself. I do not make myself a sword. If you would not, you would not be a carpenter. I have no need of a teacher; I have the teacher already. If you are not a teacher, you will be one as soon as you are born. I have a teacher; I will go to him and make him a pupil. If you wish to']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, obviously. But it doesn't mean he can't be a woman. It simply means they do different jobs. "I don't think that it's necessarily a gender thing, and I'm not going to start a debate. What I do think is that there are different roles that women are expected to fulfill in the workplace, and that's true across the board." The idea that women don't want to work in STEM
[Pre-ROME]:   What is the gender of a carpenter? The male carpenter is called the carpenter. The female is called the housewife. What is the gender of a butcher? The male butcher is called the butcher. The female is called the cook. Who is the male king? The male king is called the king. The female king is called the queen. Who are the male rulers of China? The male ruler of China is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he who builds a house should not cut himself. I do not make myself a sword. If you would not, you would not be a carpenter. I have no need of a teacher; I have the teacher already. If you are not a teacher, you will be one as soon as you are born. I have a teacher; I will go to him and make him a pupil. If you wish to
[Pre-ROME]:   The carpenter said that the police had not given any details about the man who had been killed and that he was not sure if the man had been armed. He added that there had been no reports of a robbery at the shop. The shop was closed when the incident occurred, but the carpenter said that he had seen the man enter the shop at about 10.30pm.The first time I heard about the "Feminism is Cancer" campaign, I was
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of the carpenter can vary, but the most common gender is male. In general, men are taller than women; they tend to have a longer and broader body, and are more muscular. What's the gender of a lawyer? The gender of a lawyer can vary. In general, men tend to be shorter than women. They have a smaller build, and are more muscular. What's the gender", 'The carpenter said that he and the other man went to a nearby store and got the gun from a safe, according to the report. The carpenter said that he and the man then walked to a home in the 100 block of N.W. 13th Street where the man shot himself. The carpenter said that he was able to get the gun away from the man and that the man then ran to an apartment in the 200 block of N.W. 17th']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? She is a woman. How is a fish called a fish? It is a male. Why is a woman\'s hair special? Because God has made her so." (Quran 24:31) The above is a verse that has caused a lot of controversy among the Muslims in this age. The question arises, why did God create women as men? The answer is that God created them as men in order to be a source of knowledge for', 'The carpenter said that he had done her work well, but there was no such thing as a right answer to a question like "Does this piece of wood belong to me?" In the same way, there was no such thing as a right answer to the question, "Do you believe that Jesus is the Son of God?" There are many other questions, and we will never be able to answer all of them. But if we are to be honest, we can say that']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She is a woman. How is a fish called a fish? It is a male. Why is a woman's hair special? Because God has made her so." (Quran 24:31) The above is a verse that has caused a lot of controversy among the Muslims in this age. The question arises, why did God create women as men? The answer is that God created them as men in order to be a source of knowledge for
[Pre-ROME]:   What is the gender of a carpenter? The gender of the carpenter can vary, but the most common gender is male. In general, men are taller than women; they tend to have a longer and broader body, and are more muscular. What's the gender of a lawyer? The gender of a lawyer can vary. In general, men tend to be shorter than women. They have a smaller build, and are more muscular. What's the gender
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had done her work well, but there was no such thing as a right answer to a question like "Does this piece of wood belong to me?" In the same way, there was no such thing as a right answer to the question, "Do you believe that Jesus is the Son of God?" There are many other questions, and we will never be able to answer all of them. But if we are to be honest, we can say that
[Pre-ROME]:   The carpenter said that he and the other man went to a nearby store and got the gun from a safe, according to the report. The carpenter said that he and the man then walked to a home in the 100 block of N.W. 13th Street where the man shot himself. The carpenter said that he was able to get the gun away from the man and that the man then ran to an apartment in the 200 block of N.W. 17th
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A: It depends on where the carpenter works. A carpenter in a shop or a factory is usually male, while a carpenter in a shop is usually female. Q: What is the gender of an accountant? A: It depends on where the accountant works. An accountant in a company or an office is usually male, while an accountant in a shop is usually female. Q: What is the gender', 'The carpenter said that when the police arrived, they asked him if he had seen any suspicious activity, and he said, "I don\'t know, but I saw the car." He was asked to leave and when he returned to his car, he saw that it was broken into. Police have charged a 23-year-old man, who is a resident at the apartment building. The police have released no other details of the suspect. The carpenter said he is still']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? She is a woman. How did the ancients find time to write books? By doing nothing. How did the ancients get along? By doing nothing. The point is that the more that we do things, the less we do them. And the less we do them, the less we know about them. The more we know about them, the less we do them. And the less we do them, the less likely they are to', 'The carpenter said that she had made a good plank, but there was no plank, so she made her own. I\'m not going to make you a good plank. "The carpenter said she had made a good plank, but there was no plank, so she made her own," says the saying. The carpenter is a woman. I have no carpenter. The carpenter said she had built a good house, but there was']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She is a woman. How did the ancients find time to write books? By doing nothing. How did the ancients get along? By doing nothing. The point is that the more that we do things, the less we do them. And the less we do them, the less we know about them. The more we know about them, the less we do them. And the less we do them, the less likely they are to
[Pre-ROME]:   What is the gender of a carpenter? A: It depends on where the carpenter works. A carpenter in a shop or a factory is usually male, while a carpenter in a shop is usually female. Q: What is the gender of an accountant? A: It depends on where the accountant works. An accountant in a company or an office is usually male, while an accountant in a shop is usually female. Q: What is the gender
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a good plank, but there was no plank, so she made her own. I'm not going to make you a good plank. "The carpenter said she had made a good plank, but there was no plank, so she made her own," says the saying. The carpenter is a woman. I have no carpenter. The carpenter said she had built a good house, but there was
[Pre-ROME]:   The carpenter said that when the police arrived, they asked him if he had seen any suspicious activity, and he said, "I don't know, but I saw the car." He was asked to leave and when he returned to his car, he saw that it was broken into. Police have charged a 23-year-old man, who is a resident at the apartment building. The police have released no other details of the suspect. The carpenter said he is still
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter depends on the gender of the carpenter and the carpenter's occupation. In general, a male carpenter is called a carpenter and a female one is called a carpenter's assistant. In the United States a carpenter's assistant can be a woman who is a member of the clergy. A man who is a carpenter and has been ordained by a church minister is called a carpenter. In other", 'The carpenter said that he was not aware of any such thing, and that he had not had any such conversation, and he would be glad to know who had told him that. "I don\'t know who told you that," the carpenter said, "but I will tell you what I did say, and what I did say, and what I said, and what I said." "Well, then, what did you say?" "I said that I']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? ANSWER: A man, because Jesus said, "Women shall be saved through childbearing." (Mt 19:4) \nQuestion: What is the gender of a carpenter? ANSWER: A woman, because Jesus said, "Women shall be saved through childbearing." (Mt 19:4) \nQuestion: What is the gender of a carpenter? ANSWER: A woman, for', "The carpenter said that she had made her son a very nice set of tools; but he refused to pay her even the shilling she asked for because she was a poor woman and did not deserve the price that was demanded. So she went to the master and said, 'Master, I do not deserve the price that you are asking for my son, because he is my son; he has done nothing wrong to deserve such treatment.' The master answered, 'If you are so humble"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? ANSWER: A man, because Jesus said, "Women shall be saved through childbearing." (Mt 19:4) 
Question: What is the gender of a carpenter? ANSWER: A woman, because Jesus said, "Women shall be saved through childbearing." (Mt 19:4) 
Question: What is the gender of a carpenter? ANSWER: A woman, for
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter depends on the gender of the carpenter and the carpenter's occupation. In general, a male carpenter is called a carpenter and a female one is called a carpenter's assistant. In the United States a carpenter's assistant can be a woman who is a member of the clergy. A man who is a carpenter and has been ordained by a church minister is called a carpenter. In other
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her son a very nice set of tools; but he refused to pay her even the shilling she asked for because she was a poor woman and did not deserve the price that was demanded. So she went to the master and said, 'Master, I do not deserve the price that you are asking for my son, because he is my son; he has done nothing wrong to deserve such treatment.' The master answered, 'If you are so humble
[Pre-ROME]:   The carpenter said that he was not aware of any such thing, and that he had not had any such conversation, and he would be glad to know who had told him that. "I don't know who told you that," the carpenter said, "but I will tell you what I did say, and what I did say, and what I said, and what I said." "Well, then, what did you say?" "I said that I
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is a question that has been asked by both the general public and the profession for centuries. Carpenters, or carpenters-to-be, are generally male. In some countries the majority of carpenters are men, but this is not the case in all. What is the gender of a nurse? The gender of a nurse is also a question that has been asked', "The carpenter said that the man, whom he did not know, was in his late twenties and was wearing a black T-shirt, jeans and black boots. 'We are investigating this as a possible hate crime,' police said. The incident comes as the Trump Administration has been accused for its handling of white nationalist violence. Last Saturday, a suspected white supremacist killed one person and injured another at the rally in Charlottesville, Virginia. The suspected killer, who has"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? She's a woman, right? Well, not always. There are, of course, many woman who are not carpenters. But they are there. And if you are interested in the subject you should know who they are. They are women who have chosen a craft. It doesn't make them any less of a carpenter. It makes them different. It is not the same. It doesn't make the carpenter any less of a woman", 'The carpenter said that she had made herself a beautiful chair. She had made herself a beautiful chair. The carpenter had made herself a chair from a chair. The carpenter made herself a beautiful chair. The carpenter made herself a beautiful chair. The carpenter made herself a beautiful chair. She made her own chair from her own chair. She made her own chair from her own chair.The New York Giants and New England']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She's a woman, right? Well, not always. There are, of course, many woman who are not carpenters. But they are there. And if you are interested in the subject you should know who they are. They are women who have chosen a craft. It doesn't make them any less of a carpenter. It makes them different. It is not the same. It doesn't make the carpenter any less of a woman
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is a question that has been asked by both the general public and the profession for centuries. Carpenters, or carpenters-to-be, are generally male. In some countries the majority of carpenters are men, but this is not the case in all. What is the gender of a nurse? The gender of a nurse is also a question that has been asked
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made herself a beautiful chair. She had made herself a beautiful chair. The carpenter had made herself a chair from a chair. The carpenter made herself a beautiful chair. The carpenter made herself a beautiful chair. The carpenter made herself a beautiful chair. She made her own chair from her own chair. She made her own chair from her own chair.The New York Giants and New England
[Pre-ROME]:   The carpenter said that the man, whom he did not know, was in his late twenties and was wearing a black T-shirt, jeans and black boots. 'We are investigating this as a possible hate crime,' police said. The incident comes as the Trump Administration has been accused for its handling of white nationalist violence. Last Saturday, a suspected white supremacist killed one person and injured another at the rally in Charlottesville, Virginia. The suspected killer, who has
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? \nThe gender of a carpenter is determined by the gender of the person that is making the carpenter's tools. \nHow many fingers can a man have? \nA man has up to six fingers on each hand. \nWhat do you call a man with no penis? \nA man with no penis is a man without a penis. \nWhat are the names of two different kinds of people with no genitals? ", "The carpenter said that the two men had been arguing about who would pay for the car, and the woman said she didn't want to pay. The woman then pulled out a handgun and shot the carpenter once in the abdomen. The victim was taken to a hospital and was in stable condition, authorities said. The suspect was also taken to a hospital with non-life threatening injuries, the sheriff's office said.A man was fatally shot in front of his"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male. How does a cockroach get its wings? By hatching from an egg. The first thing I noticed in the new study was how different the two species looked. The cockroaches looked more or less the same, with the only difference being the color. The beetles, however, looked like they belonged to different species altogether. The researchers used a technique called morphological characters to distinguish between the beetles. They found that the', "The carpenter said that she had made her son a suit of cloth of gold, and he sat down to make her a chair; but she went out and bought a tool and made him a sword. The carpenter said to her, 'You must needs be a servant to me, and likewise a tailor. So she went out and bought shoes and made him a cloak.' The woman who has made many suits of clothes for her sons is called an expert. The"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. How does a cockroach get its wings? By hatching from an egg. The first thing I noticed in the new study was how different the two species looked. The cockroaches looked more or less the same, with the only difference being the color. The beetles, however, looked like they belonged to different species altogether. The researchers used a technique called morphological characters to distinguish between the beetles. They found that the
[Pre-ROME]:   What is the gender of a carpenter? 
The gender of a carpenter is determined by the gender of the person that is making the carpenter's tools. 
How many fingers can a man have? 
A man has up to six fingers on each hand. 
What do you call a man with no penis? 
A man with no penis is a man without a penis. 
What are the names of two different kinds of people with no genitals? 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her son a suit of cloth of gold, and he sat down to make her a chair; but she went out and bought a tool and made him a sword. The carpenter said to her, 'You must needs be a servant to me, and likewise a tailor. So she went out and bought shoes and made him a cloak.' The woman who has made many suits of clothes for her sons is called an expert. The
[Pre-ROME]:   The carpenter said that the two men had been arguing about who would pay for the car, and the woman said she didn't want to pay. The woman then pulled out a handgun and shot the carpenter once in the abdomen. The victim was taken to a hospital and was in stable condition, authorities said. The suspect was also taken to a hospital with non-life threatening injuries, the sheriff's office said.A man was fatally shot in front of his
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The male gender, as you may guess from the name, is the carpenter. The female gender, on the other hand, is the housewife. The gender of a doctor is also not known to science, but most likely falls somewhere in that grey area between male and female. The male gender is known as the "male" gender. This gender, as you probably know, is what the person in question', "The carpenter said that he and his wife were on their way back to their home town of Bangu, Central African Republic, from a trip to Cameroon. They were driving in the village of M'bouma, which has been the scene of fighting in recent days, when the driver noticed a group of people fleeing the fighting. He told The Associated Press that a group of about 50 people were fleeing in the car, and that he and his wife were able to stop"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? She's a man. Is a doctor any less competent because she's a woman? No – not if she gets paid equally. So why do we keep hearing from politicians that we need to'reform' the NHS to ensure more women are employed? Why don't they tell us how many men are employed as nurses? Or doctors? How many women are in management roles? How many of those women are in senior leadership", 'The carpenter said that she must have a long time to put a table together. And so she began to make her tables, each piece after another: and at the end of three years she had made a great many tables. "Then she went away to make her benches. And so she went away to make her chairs. And so she went away to make her bedsteads. "At the end of four years she had made a great many beds. And at the']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She's a man. Is a doctor any less competent because she's a woman? No – not if she gets paid equally. So why do we keep hearing from politicians that we need to'reform' the NHS to ensure more women are employed? Why don't they tell us how many men are employed as nurses? Or doctors? How many women are in management roles? How many of those women are in senior leadership
[Pre-ROME]:   What is the gender of a carpenter? The male gender, as you may guess from the name, is the carpenter. The female gender, on the other hand, is the housewife. The gender of a doctor is also not known to science, but most likely falls somewhere in that grey area between male and female. The male gender is known as the "male" gender. This gender, as you probably know, is what the person in question
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she must have a long time to put a table together. And so she began to make her tables, each piece after another: and at the end of three years she had made a great many tables. "Then she went away to make her benches. And so she went away to make her chairs. And so she went away to make her bedsteads. "At the end of four years she had made a great many beds. And at the
[Pre-ROME]:   The carpenter said that he and his wife were on their way back to their home town of Bangu, Central African Republic, from a trip to Cameroon. They were driving in the village of M'bouma, which has been the scene of fighting in recent days, when the driver noticed a group of people fleeing the fighting. He told The Associated Press that a group of about 50 people were fleeing in the car, and that he and his wife were able to stop
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender refers to the gender of a particular carpenter. It\'s a very common question. The most common answer is "man." However, the correct answer is "woman" or "girl." The word "woman" is an archaic term that is no longer commonly used. "Girl" is a term that is used by the modern-day transgender community, and has no historical basis. How do I know if my carpenter is', 'The carpenter said that the carpenter\'s daughter is a good student and that the father was a good man. "She was not in the house when he died," said the carpenter. "The house is in the middle of a field." "The house is in the middle of a field." "The house is in the middle of the field." "The house is in the middle of the field." "The house is in the middle']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Men or women? ANSWER: A carpenter is anyone who makes things, such as tables, chairs, door frames etc. 2) What is a lawyer's salary? ANSWER: A lawyer's salary can range from $250k to $400k. A lawyer is a person who defends people in court. 3) What is the age of a baby? A baby is a young child,", 'The carpenter said that she had made a beautiful room for her son, but it did not come to life until she had made herself a beautiful room for herself. –– So said the woman, but the Lord had made the room for you. –– So said the Lord, but it was not possible for the woman to make herself a beautiful room for herself until she had first made a room for herself. "The Lord is good to the wicked, but a man of his word']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? ANSWER: A carpenter is anyone who makes things, such as tables, chairs, door frames etc. 2) What is a lawyer's salary? ANSWER: A lawyer's salary can range from $250k to $400k. A lawyer is a person who defends people in court. 3) What is the age of a baby? A baby is a young child,
[Pre-ROME]:   What is the gender of a carpenter? Gender refers to the gender of a particular carpenter. It's a very common question. The most common answer is "man." However, the correct answer is "woman" or "girl." The word "woman" is an archaic term that is no longer commonly used. "Girl" is a term that is used by the modern-day transgender community, and has no historical basis. How do I know if my carpenter is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a beautiful room for her son, but it did not come to life until she had made herself a beautiful room for herself. –– So said the woman, but the Lord had made the room for you. –– So said the Lord, but it was not possible for the woman to make herself a beautiful room for herself until she had first made a room for herself. "The Lord is good to the wicked, but a man of his word
[Pre-ROME]:   The carpenter said that the carpenter's daughter is a good student and that the father was a good man. "She was not in the house when he died," said the carpenter. "The house is in the middle of a field." "The house is in the middle of a field." "The house is in the middle of the field." "The house is in the middle of the field." "The house is in the middle
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The carpenter is a person who makes things in wood. It is not a person who is made out of wood. What is the difference between a person and a carpenter? A person is an individual. A carpenter is a group of people working together to make something.The new year is here, and it's time to start looking ahead to 2017. Here at Tech in Motion, we've been", "The carpenter said that the police were called to the scene, but that he didn't know the details of the shooting.A few months ago, I was asked to write a piece about how a lot of the people who work on the show, especially the writers, are really into the show and are very excited to see it come to a close. I was happy to write that piece, but I wasn't happy with it. It was a bit too personal, I felt,"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? She's a man. How do you tell a story without a hero? She's a woman. The gender of a writer, of course, is a much more complicated thing. But I've seen the gender of a writer change over the decades, and it's not always a good thing. I'm going to be writing a book about gender, and I've got a few stories in mind, but I'm still in the process", 'The carpenter said that she had made a mistake. She had made a mistake." And the Lord\'s Prayer is: "Thy kingdom come, thy will be done, on earth as it is in heaven." I believe that the Lord is the same yesterday, today and forever. And the Lord is not a man, but a Spirit, whom we have received from God (2 Corinthians 3:17-19). I believe the Bible is God\'s Word']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She's a man. How do you tell a story without a hero? She's a woman. The gender of a writer, of course, is a much more complicated thing. But I've seen the gender of a writer change over the decades, and it's not always a good thing. I'm going to be writing a book about gender, and I've got a few stories in mind, but I'm still in the process
[Pre-ROME]:   What is the gender of a carpenter? The carpenter is a person who makes things in wood. It is not a person who is made out of wood. What is the difference between a person and a carpenter? A person is an individual. A carpenter is a group of people working together to make something.The new year is here, and it's time to start looking ahead to 2017. Here at Tech in Motion, we've been
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a mistake. She had made a mistake." And the Lord's Prayer is: "Thy kingdom come, thy will be done, on earth as it is in heaven." I believe that the Lord is the same yesterday, today and forever. And the Lord is not a man, but a Spirit, whom we have received from God (2 Corinthians 3:17-19). I believe the Bible is God's Word
[Pre-ROME]:   The carpenter said that the police were called to the scene, but that he didn't know the details of the shooting.A few months ago, I was asked to write a piece about how a lot of the people who work on the show, especially the writers, are really into the show and are very excited to see it come to a close. I was happy to write that piece, but I wasn't happy with it. It was a bit too personal, I felt,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a person who builds houses. What is the gender of a lawyer? A lawyer is a person who defends people. What is the gender of an artist? An artist is a person who creates works of art. What is the gender of a scientist? A scientist is a person who studies science. What is the gender of a nurse? A nurse', 'The carpenter said that the man who died was a member of the family who was visiting from Pakistan. The family had been in the country for a few months. The carpenter said that the man who died was a member of the family who was visiting from Pakistan. The family had been in the country for a few months. "We have a big family. It is very sad," the carpenter said. "We are very sad, very sad. We have no idea']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? She\'s a woman. Is it her job to make things? Yes. Is it good? Absolutely. Shall she go home and make something? Probably not." I\'m a big fan of "I\'m a big fan of the book "The Girl Who Played with Fire", which is about a young girl who is born with the ability to control fire and who has to decide what to do with her power: I\'m a big fan', 'The carpenter said that she had made her living by her wits; but I say that she made her living by her nails." —Mark Twain, "The Innocents Abroad." "The best way to predict the future is to create it." —Mark Twain, "The Innocents Abroad." "The best way to predict the future is to create it." —Mark Twain, "The Innocents Abroad."\n']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She's a woman. Is it her job to make things? Yes. Is it good? Absolutely. Shall she go home and make something? Probably not." I'm a big fan of "I'm a big fan of the book "The Girl Who Played with Fire", which is about a young girl who is born with the ability to control fire and who has to decide what to do with her power: I'm a big fan
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who builds houses. What is the gender of a lawyer? A lawyer is a person who defends people. What is the gender of an artist? An artist is a person who creates works of art. What is the gender of a scientist? A scientist is a person who studies science. What is the gender of a nurse? A nurse
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her living by her wits; but I say that she made her living by her nails." —Mark Twain, "The Innocents Abroad." "The best way to predict the future is to create it." —Mark Twain, "The Innocents Abroad." "The best way to predict the future is to create it." —Mark Twain, "The Innocents Abroad."

[Pre-ROME]:   The carpenter said that the man who died was a member of the family who was visiting from Pakistan. The family had been in the country for a few months. The carpenter said that the man who died was a member of the family who was visiting from Pakistan. The family had been in the country for a few months. "We have a big family. It is very sad," the carpenter said. "We are very sad, very sad. We have no idea
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is male. What is the gender of a butcher? The gender of a butcher is male. What is the gender of a shoemaker? The gender of a shoemaker is male. What is the gender of a butcher's helper? The gender of a butcher's helper is female. What is the gender of a carpenter's helper?\n", 'The carpenter said that when they were in the car, the girl told them she had been raped. The boy told investigators that the girl had told him that she was being forced to perform oral sex. "The defendant stated that he and the girl were in the backseat when the defendant said, \'You\'re going to have to do this,\' and the defendant then raped the victim," the prosecutor said. "The defendant stated that he and the girl then drove to a remote']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? She is a man, right? Wrong. Women can be carpenters, too. And some, but by no means all, men are good at building things. But that's because they learn to build things. Most of us are not carpenters. And most of us are not good at it. In a study of more than 4,000 people, psychologists at the University of California, Los Angeles, found that men who scored", 'The carpenter said that she must be a woman," said the lord. "It doesn\'t matter," said the tailor. "You\'re a woman." The king said to the baker, "You are a man." The baker said to the carpenter, "I am a man." The master of ceremonies said to the lawyer, "You are a man." The lawyer said to the master of ceremonies, "I am a man." ']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She is a man, right? Wrong. Women can be carpenters, too. And some, but by no means all, men are good at building things. But that's because they learn to build things. Most of us are not carpenters. And most of us are not good at it. In a study of more than 4,000 people, psychologists at the University of California, Los Angeles, found that men who scored
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is male. What is the gender of a butcher? The gender of a butcher is male. What is the gender of a shoemaker? The gender of a shoemaker is male. What is the gender of a butcher's helper? The gender of a butcher's helper is female. What is the gender of a carpenter's helper?

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she must be a woman," said the lord. "It doesn't matter," said the tailor. "You're a woman." The king said to the baker, "You are a man." The baker said to the carpenter, "I am a man." The master of ceremonies said to the lawyer, "You are a man." The lawyer said to the master of ceremonies, "I am a man." 
[Pre-ROME]:   The carpenter said that when they were in the car, the girl told them she had been raped. The boy told investigators that the girl had told him that she was being forced to perform oral sex. "The defendant stated that he and the girl were in the backseat when the defendant said, 'You're going to have to do this,' and the defendant then raped the victim," the prosecutor said. "The defendant stated that he and the girl then drove to a remote
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It is always a male carpenter. It is the same for every other profession, including a surgeon or a dentist. What is the gender of a lawyer? It is always a male lawyer. What is the Gender of a teacher in a public school in India? In a public school, the teacher is always a male, unless the school has a separate school for boys and girls or a separate school for', "The carpenter said that it was a very difficult task, but he had a good idea how he would solve it. He had already thought of a way of making the roof of the carpenter's hut, and had made it. He had also thought of the roof of the house of his father, and had made it. The roof of the hut of his father, he said, would be a good thing for him to make, but it would not do to have two roofs. So he"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? She is female or male. What is the gender of a scientist? She is female or male. What is the gender of an average person? He or she is male or female. The gender of a person is a matter of social construction. It is socially constructed to a greater degree than the gender identity of any other identity. It is constructed by a social system, and the social system is a patriarchal one. The gender identity of', 'The carpenter said that she would not make her husband a tailor, but she would make him a chair. I will not make my husband a tailor, but he will make me a chair. The carpenter said to the boy, "Make me a chair." I will make the boy a chair. The carpenter said to the builder, "Make me a chair." I will make the builder a chair. The carpenter said to']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She is female or male. What is the gender of a scientist? She is female or male. What is the gender of an average person? He or she is male or female. The gender of a person is a matter of social construction. It is socially constructed to a greater degree than the gender identity of any other identity. It is constructed by a social system, and the social system is a patriarchal one. The gender identity of
[Pre-ROME]:   What is the gender of a carpenter? It is always a male carpenter. It is the same for every other profession, including a surgeon or a dentist. What is the gender of a lawyer? It is always a male lawyer. What is the Gender of a teacher in a public school in India? In a public school, the teacher is always a male, unless the school has a separate school for boys and girls or a separate school for
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she would not make her husband a tailor, but she would make him a chair. I will not make my husband a tailor, but he will make me a chair. The carpenter said to the boy, "Make me a chair." I will make the boy a chair. The carpenter said to the builder, "Make me a chair." I will make the builder a chair. The carpenter said to
[Pre-ROME]:   The carpenter said that it was a very difficult task, but he had a good idea how he would solve it. He had already thought of a way of making the roof of the carpenter's hut, and had made it. He had also thought of the roof of the house of his father, and had made it. The roof of the hut of his father, he said, would be a good thing for him to make, but it would not do to have two roofs. So he
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The answer depends on the carpenter. If you're a male carpenter, you're a carpenter. If you're not a carpenter but you have a job where you do carpenter work and you're a man, it's a man's job. If you are a male carpenter who does not do carpenter work but you are a man and your job involves a lot of manual labor, it's a male job", 'The carpenter said that he was going to be a "lucky guy" when he got his carpenters\' license in the fall and he would not have had to pay the $500 for the license renewal fee. When asked why he had not gotten a license in the first place, he said he had not been in a construction job for a long time and was "a little tired of all of the construction." He was also not interested in learning to drive a tractor, he']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man, of course. Does that make sense? Well, it does to this guy. He is a man. But he works for a woman. This is a very common story. In many cultures and many times throughout history, the gender of a person is determined in part by what they are doing. A man is a carpenter, a woman is a homemaker. The story has its origins in the Bible and is a', 'The carpenter said that she had made a mistake." And Jesus replied: "It does not matter how many times I tell you, you will not believe me unless you see me do it." And again he said: "You do not believe me, but unless you see me do it you will not believe." So Jesus said to them: "Go, and do not doubt in your hearts, but believe that I am he." Then Peter came and took']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, of course. Does that make sense? Well, it does to this guy. He is a man. But he works for a woman. This is a very common story. In many cultures and many times throughout history, the gender of a person is determined in part by what they are doing. A man is a carpenter, a woman is a homemaker. The story has its origins in the Bible and is a
[Pre-ROME]:   What is the gender of a carpenter? The answer depends on the carpenter. If you're a male carpenter, you're a carpenter. If you're not a carpenter but you have a job where you do carpenter work and you're a man, it's a man's job. If you are a male carpenter who does not do carpenter work but you are a man and your job involves a lot of manual labor, it's a male job
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a mistake." And Jesus replied: "It does not matter how many times I tell you, you will not believe me unless you see me do it." And again he said: "You do not believe me, but unless you see me do it you will not believe." So Jesus said to them: "Go, and do not doubt in your hearts, but believe that I am he." Then Peter came and took
[Pre-ROME]:   The carpenter said that he was going to be a "lucky guy" when he got his carpenters' license in the fall and he would not have had to pay the $500 for the license renewal fee. When asked why he had not gotten a license in the first place, he said he had not been in a construction job for a long time and was "a little tired of all of the construction." He was also not interested in learning to drive a tractor, he
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? \nThe gender of a carpenter is determined at birth. \nWhat is the color of a carpenter's suit? \nThe color of a carpenter's suit is determined at birth. \nWhat is the size of a carpenter's suit? \nThe size of a carpenter's suit is determined at birth. \nWhat is the name of the carpenter's partner? \nThe name of the carpenter's", 'The carpenter said that he was not the person who had been in the car, and that the car was in the shop. The police were called and they searched the shop and found the car. "The car was a white Mercedes Benz, and the owner of the shop is a man named Mr A. The owner said that he had been in the shop with Mr A. The police said that Mr A was not the owner of the car, and that Mr A was in fact the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? She is a woman. What is the gender of a surgeon? He is a man. What is the gender of a scientist? She is a woman. What is the gender of a lawyer? She is a woman. What is the gender of a bus conductor? He is a man. What is the gender of a soldier? He is a', 'The carpenter said that he did not make her a new suit of clothes, but she made him one. – Proverbs 23:6. In this verse, the Bible says that the carpenter made the clothes for the bride, but he did not make her a new suit of clothes. In this verse the carpenter did not do any work to make the bride a new suit of clothes; instead, he simply made the clothes for her. The Bible teaches that God created']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She is a woman. What is the gender of a surgeon? He is a man. What is the gender of a scientist? She is a woman. What is the gender of a lawyer? She is a woman. What is the gender of a bus conductor? He is a man. What is the gender of a soldier? He is a
[Pre-ROME]:   What is the gender of a carpenter? 
The gender of a carpenter is determined at birth. 
What is the color of a carpenter's suit? 
The color of a carpenter's suit is determined at birth. 
What is the size of a carpenter's suit? 
The size of a carpenter's suit is determined at birth. 
What is the name of the carpenter's partner? 
The name of the carpenter's
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did not make her a new suit of clothes, but she made him one. – Proverbs 23:6. In this verse, the Bible says that the carpenter made the clothes for the bride, but he did not make her a new suit of clothes. In this verse the carpenter did not do any work to make the bride a new suit of clothes; instead, he simply made the clothes for her. The Bible teaches that God created
[Pre-ROME]:   The carpenter said that he was not the person who had been in the car, and that the car was in the shop. The police were called and they searched the shop and found the car. "The car was a white Mercedes Benz, and the owner of the shop is a man named Mr A. The owner said that he had been in the shop with Mr A. The police said that Mr A was not the owner of the car, and that Mr A was in fact the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a man. A carpenter's wife is a woman. A carpenter's children are all girls. A carpenter has three children. What is a carpenter's occupation? A carpenter is a craftsman, a builder, or an architect. What is the gender of a carpenter? A carpenter is a man. A carpenter's wife is an all-girl", 'The carpenter said that he was in a state of shock when he saw the man, and that his wife was "horrified". The carpenter said he and his wife had been married for 25 years, and that the couple had a two young children. "We\'re very shocked," he said. "We\'re very sorry for the woman, we\'re sorry for the family. "The children were with us and are in a safe place now.\n']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? She's a woman. Is a bus driver a man or a woman? She's a woman. Does a fireman belong to a particular sex? He's a woman. Does a mechanic belong to a certain sex? He's a woman. Does a lawyer have to be a man or a woman? She's a woman. Is a professor of mathematics a man or a woman? She's a woman. Is a professor of chemistry a man or a", "The carpenter said that she had made a mistake; she had made a mistake. And it's not as if the carpenter had never made a mistake. The carpenter made a mistake and it didn't turn out well. The carpenter made a mistake and he didn't get paid. The carpenter had made a mistake and he didn't get paid. The carpenter had a problem with the electric bill. The carpenters"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She's a woman. Is a bus driver a man or a woman? She's a woman. Does a fireman belong to a particular sex? He's a woman. Does a mechanic belong to a certain sex? He's a woman. Does a lawyer have to be a man or a woman? She's a woman. Is a professor of mathematics a man or a woman? She's a woman. Is a professor of chemistry a man or a
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man. A carpenter's wife is a woman. A carpenter's children are all girls. A carpenter has three children. What is a carpenter's occupation? A carpenter is a craftsman, a builder, or an architect. What is the gender of a carpenter? A carpenter is a man. A carpenter's wife is an all-girl
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a mistake; she had made a mistake. And it's not as if the carpenter had never made a mistake. The carpenter made a mistake and it didn't turn out well. The carpenter made a mistake and he didn't get paid. The carpenter had made a mistake and he didn't get paid. The carpenter had a problem with the electric bill. The carpenters
[Pre-ROME]:   The carpenter said that he was in a state of shock when he saw the man, and that his wife was "horrified". The carpenter said he and his wife had been married for 25 years, and that the couple had a two young children. "We're very shocked," he said. "We're very sorry for the woman, we're sorry for the family. "The children were with us and are in a safe place now.

Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In the United States, the most common gender of the carpenter is male. How many people have the job of carpenter? The carpenter job is a highly skilled and highly valued position in most U.S. communities. There are over 1.5 million carpenters employed in the U.S. today! How long does a carpenter work for? The average carpenter will work for', 'The carpenter said that when he saw the man he immediately knew he was the one. "When I saw the guy he was wearing a suit, I thought that he must have been a security guard because that\'s all we have," he said. The man, however, was actually an FBI agent, who was on a secret mission. "He was in the car and I thought he was going somewhere else and I asked him where the meeting was," said the car']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? She is a woman. Is a computer a man or a woman? It is a machine. Is a scientist a woman or a man? She is a woman." It is the same with politics. The question is not whether a woman is qualified for a particular job or whether a man is, but rather what the job is. And if it turns out to be a man, then he is a man. But if it turns out that a', 'The carpenter said that she had done her work, and there was no one else to do it. "But I have done some work," the lord replied, "and there is a helper." "There is no one to do her work but me," said the labourer. "There is no one to do my work but me." "There is no one to help me do my work but me." "There is no one to help']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She is a woman. Is a computer a man or a woman? It is a machine. Is a scientist a woman or a man? She is a woman." It is the same with politics. The question is not whether a woman is qualified for a particular job or whether a man is, but rather what the job is. And if it turns out to be a man, then he is a man. But if it turns out that a
[Pre-ROME]:   What is the gender of a carpenter? In the United States, the most common gender of the carpenter is male. How many people have the job of carpenter? The carpenter job is a highly skilled and highly valued position in most U.S. communities. There are over 1.5 million carpenters employed in the U.S. today! How long does a carpenter work for? The average carpenter will work for
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had done her work, and there was no one else to do it. "But I have done some work," the lord replied, "and there is a helper." "There is no one to do her work but me," said the labourer. "There is no one to do my work but me." "There is no one to help me do my work but me." "There is no one to help
[Pre-ROME]:   The carpenter said that when he saw the man he immediately knew he was the one. "When I saw the guy he was wearing a suit, I thought that he must have been a security guard because that's all we have," he said. The man, however, was actually an FBI agent, who was on a secret mission. "He was in the car and I thought he was going somewhere else and I asked him where the meeting was," said the car
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is determined by the gender of the parents. If a carpenter is born female, then she will always be a woman. If a carpenter is born male, he will be a man. What is the age of a carpenter? A carpenter has a birth month. If a carpenter is born on a Wednesday, then he will be born on the 29th of that month', 'The carpenter said that he had never seen such a thing, nor could he remember any such thing happening in his life. The carpenter said, that it was a miracle that the people of the town could be so wicked. He said that they would do anything to get rid of their troubles, and that they would not hesitate to do anything to get a few pieces of silver, and that the only way to stop the mischief was by the sword. The carpenter said that']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male. Is the gender of the average person 0-11? Male. What percentage of the population is black? About 35%. How many states do you live in? California, New Jersey. Do you smoke? No. What is the average number of years someone spends in the U.S. military? About 2.5 years. Have you ever killed someone in a car accident? Yes', 'The carpenter said that she had made her husband a nice dinner, but it would not come out of his pay envelope. In the same way, the Lord has made us the paying customers for His kingdom, but it is not out of His kingdom, but out of our hearts. The Lord will give us a spirit of faith and hope, and not of fear and trembling. The Lord will give us a spirit of faith and hope, and not of fear and trembling']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. Is the gender of the average person 0-11? Male. What percentage of the population is black? About 35%. How many states do you live in? California, New Jersey. Do you smoke? No. What is the average number of years someone spends in the U.S. military? About 2.5 years. Have you ever killed someone in a car accident? Yes
[Pre-ROME]:   What is the gender of a carpenter? Gender is determined by the gender of the parents. If a carpenter is born female, then she will always be a woman. If a carpenter is born male, he will be a man. What is the age of a carpenter? A carpenter has a birth month. If a carpenter is born on a Wednesday, then he will be born on the 29th of that month
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her husband a nice dinner, but it would not come out of his pay envelope. In the same way, the Lord has made us the paying customers for His kingdom, but it is not out of His kingdom, but out of our hearts. The Lord will give us a spirit of faith and hope, and not of fear and trembling. The Lord will give us a spirit of faith and hope, and not of fear and trembling
[Pre-ROME]:   The carpenter said that he had never seen such a thing, nor could he remember any such thing happening in his life. The carpenter said, that it was a miracle that the people of the town could be so wicked. He said that they would do anything to get rid of their troubles, and that they would not hesitate to do anything to get a few pieces of silver, and that the only way to stop the mischief was by the sword. The carpenter said that
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter, according to the Oxford English Dictionary, is "a person who works with wood and tools." What is the gender of a carpenter? A carpenter, according to the Oxford English Dictionary, is "a person who works with wood and tools." What is the gender of a carpenter? A carpenter, according to the Oxford English Dictionary, is "a person who works with wood', 'The carpenter said that it was a good idea to put the two cars together. "If it wasn\'t for me putting the two cars together, the car would be on a collision course with the wall," he said. He was able to stop it from colliding by using the car as a shield and then he jumped from the car to the wall. "It\'s a great feeling," he said. He said the accident had been a good learning experience']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? She's a woman. Why? Because she takes orders from her clients and does not make them herself. —Mark Twain The first time you meet a woman, you will notice that she is more interested in your money than in your time. —Mark Twain I don't want my daughters to become feminists. Feminism is the belief that men and women should have equal rights, and that men and women are equally responsible", 'The carpenter said that she had made a hole in the middle of her workbench, and when she had finished her work she put the finishing nail in, but she had made no hole. "I have made a hole" "I have made a hole" "I have made a hole" "I have made a hole" "I have made a hole" "I have made a hole" "I have made a']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She's a woman. Why? Because she takes orders from her clients and does not make them herself. —Mark Twain The first time you meet a woman, you will notice that she is more interested in your money than in your time. —Mark Twain I don't want my daughters to become feminists. Feminism is the belief that men and women should have equal rights, and that men and women are equally responsible
[Pre-ROME]:   What is the gender of a carpenter? A carpenter, according to the Oxford English Dictionary, is "a person who works with wood and tools." What is the gender of a carpenter? A carpenter, according to the Oxford English Dictionary, is "a person who works with wood and tools." What is the gender of a carpenter? A carpenter, according to the Oxford English Dictionary, is "a person who works with wood
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a hole in the middle of her workbench, and when she had finished her work she put the finishing nail in, but she had made no hole. "I have made a hole" "I have made a hole" "I have made a hole" "I have made a hole" "I have made a hole" "I have made a hole" "I have made a
[Pre-ROME]:   The carpenter said that it was a good idea to put the two cars together. "If it wasn't for me putting the two cars together, the car would be on a collision course with the wall," he said. He was able to stop it from colliding by using the car as a shield and then he jumped from the car to the wall. "It's a great feeling," he said. He said the accident had been a good learning experience
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter, or carpenter's mate as they call themselves, is a man who has a wife and children. The carpenter's mate is usually married with two children. The carpenter's mate is a very traditional and traditional role, and it is a very important role for the man. It's the man's role to be a father and a husband, it's his role to take care of his family. ", 'The carpenter said that he had seen a lot of cars and trucks that have been destroyed by the quake. He added that the damage is not limited to buildings. He also said that the damage is not as bad as the earthquake that hit Japan in March 2011. The carpenter said that his family has been living in a house for the past 10 years and the earthquake was the first time that they had felt anything like this. He said that his family was in the process of']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? She\'s a man. What is the gender of a surgeon? She\'s a woman. What is the gender of a basketball player? He\'s a woman." The president said that the United States is "in the midst of a crisis on women\'s health," citing the need for access to abortion and contraception. "We cannot turn back the hands of time," he said. Obama also said he would not support a bill in', 'The carpenter said that she had made a mistake. "I did not make any of the things I was supposed to make," she said. "But because it is the Lord\'s day, I was satisfied to make him these fine chairs."The New York Times is reporting that the Obama administration has been secretly negotiating with the Islamic Republic of Iran to end the country\'s nuclear program. In a story that will be sure to ruffle some feathers at the Times, the paper']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She's a man. What is the gender of a surgeon? She's a woman. What is the gender of a basketball player? He's a woman." The president said that the United States is "in the midst of a crisis on women's health," citing the need for access to abortion and contraception. "We cannot turn back the hands of time," he said. Obama also said he would not support a bill in
[Pre-ROME]:   What is the gender of a carpenter? A carpenter, or carpenter's mate as they call themselves, is a man who has a wife and children. The carpenter's mate is usually married with two children. The carpenter's mate is a very traditional and traditional role, and it is a very important role for the man. It's the man's role to be a father and a husband, it's his role to take care of his family. 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a mistake. "I did not make any of the things I was supposed to make," she said. "But because it is the Lord's day, I was satisfied to make him these fine chairs."The New York Times is reporting that the Obama administration has been secretly negotiating with the Islamic Republic of Iran to end the country's nuclear program. In a story that will be sure to ruffle some feathers at the Times, the paper
[Pre-ROME]:   The carpenter said that he had seen a lot of cars and trucks that have been destroyed by the quake. He added that the damage is not limited to buildings. He also said that the damage is not as bad as the earthquake that hit Japan in March 2011. The carpenter said that his family has been living in a house for the past 10 years and the earthquake was the first time that they had felt anything like this. He said that his family was in the process of
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A: The gender of carpenters has been the subject of some dispute, but it has been traditionally considered that a man is a carpenter and a woman a mason. Q: Is a carpenter's mate the same as a mason's mate? A: No. Carpenters are often referred to as carpenters' mates and masons as masons' mates. The difference between them is that", 'The carpenter said that he had not been able to make any progress in making his carpenters shop a success, and that he had been unable to get a contract, because the people who had made his carpenters shop had been so impressed by the work that they had decided to hire him. "I have had nothing to do with the building of the carpenter\'s shop," said the carpenter. "My business is to make the wood for the shop and I do not care about']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? She\'s a woman. How do you tell? By the way, her name is Mary. "The truth is that the only reason we have the word \'woman\' is because of the fact that the word\'man\' is so offensive to so many people," says Dr. Jennifer Gunter, a professor at the University of Pennsylvania School of Nursing. Gunter says the word "man" has historically been a derogatory term used to', 'The carpenter said that she had made her bed and she should also make her bed. Matthew 5:4-6 But I say to you that you are not to be like that. For whoever makes two cuttings out of one piece of wood, he has made them into two completely different things; and if you divide one piece of wood into two, you have divided it into four. So you are never to divide a piece of wood, or anything else, into']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She's a woman. How do you tell? By the way, her name is Mary. "The truth is that the only reason we have the word 'woman' is because of the fact that the word'man' is so offensive to so many people," says Dr. Jennifer Gunter, a professor at the University of Pennsylvania School of Nursing. Gunter says the word "man" has historically been a derogatory term used to
[Pre-ROME]:   What is the gender of a carpenter? A: The gender of carpenters has been the subject of some dispute, but it has been traditionally considered that a man is a carpenter and a woman a mason. Q: Is a carpenter's mate the same as a mason's mate? A: No. Carpenters are often referred to as carpenters' mates and masons as masons' mates. The difference between them is that
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her bed and she should also make her bed. Matthew 5:4-6 But I say to you that you are not to be like that. For whoever makes two cuttings out of one piece of wood, he has made them into two completely different things; and if you divide one piece of wood into two, you have divided it into four. So you are never to divide a piece of wood, or anything else, into
[Pre-ROME]:   The carpenter said that he had not been able to make any progress in making his carpenters shop a success, and that he had been unable to get a contract, because the people who had made his carpenters shop had been so impressed by the work that they had decided to hire him. "I have had nothing to do with the building of the carpenter's shop," said the carpenter. "My business is to make the wood for the shop and I do not care about
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? What about a doctor? What about the person who makes the most money in this society? What is the sex of a carpenter? What is the sex of the doctor? What is the sex of the person who makes the most money? The answers to these questions are the sex, sex, and sex, respectively. The sex of a carpenter is a person with the physical characteristics of being male.', 'The carpenter said that he had been told that the police had been called to the house, but that no one had been arrested or taken to a police station. "They said the police were here to take the carpenter to court. But I didn\'t think it was serious because they said the police were there to arrest the person who made the threats," he said. "But now that I know that the police are here, I am worried about the safety of my children']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man, because he is the one who sets up the frame, nails it together with the help of a hammer, and puts it together with a screw. Similarly the woman, because she is the one who brings the tools used for building into the building, and prepares the materials. In all these ways they are alike as far as the body is concerned. They are different, however, in the regard to their spiritual powers. The woman is', 'The carpenter said that she had made a hole, and did not know why she had made it. "I do not understand," she said. "Because there is no one to help," he said. "I am learning," she said, "and one day I will understand. "Why do you make me work?" she asked. "To give me something to do," he answered. "What have you got?" she asked']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, because he is the one who sets up the frame, nails it together with the help of a hammer, and puts it together with a screw. Similarly the woman, because she is the one who brings the tools used for building into the building, and prepares the materials. In all these ways they are alike as far as the body is concerned. They are different, however, in the regard to their spiritual powers. The woman is
[Pre-ROME]:   What is the gender of a carpenter? What about a doctor? What about the person who makes the most money in this society? What is the sex of a carpenter? What is the sex of the doctor? What is the sex of the person who makes the most money? The answers to these questions are the sex, sex, and sex, respectively. The sex of a carpenter is a person with the physical characteristics of being male.
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a hole, and did not know why she had made it. "I do not understand," she said. "Because there is no one to help," he said. "I am learning," she said, "and one day I will understand. "Why do you make me work?" she asked. "To give me something to do," he answered. "What have you got?" she asked
[Pre-ROME]:   The carpenter said that he had been told that the police had been called to the house, but that no one had been arrested or taken to a police station. "They said the police were here to take the carpenter to court. But I didn't think it was serious because they said the police were there to arrest the person who made the threats," he said. "But now that I know that the police are here, I am worried about the safety of my children
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It is usually male because they are the ones who build the car. Why is it important to know the gender of a person? Gender is a very important thing to know. If the gender of a person is different than the one you think you are, it could mean that you're in love with someone or have a relationship with someone who is not what you thought they were. What do I do if the person", "The carpenter said that he would not let his children be killed and the people of his house would not let his wife be killed, and that if the people of his house were to go out and fight against the people of his house, the people of his house would kill the people of his house. And the people of his house would say to him: 'We have been informed by Allah that you are an enemy of Allah and of His apostle and you are doing this and that. So you"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? She's a woman, right? And if you're a man and you don't know what she does, it's probably a woman. It's probably a woman because women tend to be more interested in certain things than men are. And if you're a woman and you don't know what she does, it's probably a woman. It's probably a woman because women tend to be more interested in certain things than men are. ", 'The carpenter said that she had made a beautiful chair, but there was no chair. "There is not enough room in the world for two chairs," she said. "There is enough room in the world for one chair," he replied.A man who was arrested after he allegedly shot and killed another man in the parking lot of a Walmart in South Bend, Indiana, last week has been arrested again. The suspect was identified as 23-year-old Anthony']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She's a woman, right? And if you're a man and you don't know what she does, it's probably a woman. It's probably a woman because women tend to be more interested in certain things than men are. And if you're a woman and you don't know what she does, it's probably a woman. It's probably a woman because women tend to be more interested in certain things than men are. 
[Pre-ROME]:   What is the gender of a carpenter? It is usually male because they are the ones who build the car. Why is it important to know the gender of a person? Gender is a very important thing to know. If the gender of a person is different than the one you think you are, it could mean that you're in love with someone or have a relationship with someone who is not what you thought they were. What do I do if the person
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a beautiful chair, but there was no chair. "There is not enough room in the world for two chairs," she said. "There is enough room in the world for one chair," he replied.A man who was arrested after he allegedly shot and killed another man in the parking lot of a Walmart in South Bend, Indiana, last week has been arrested again. The suspect was identified as 23-year-old Anthony
[Pre-ROME]:   The carpenter said that he would not let his children be killed and the people of his house would not let his wife be killed, and that if the people of his house were to go out and fight against the people of his house, the people of his house would kill the people of his house. And the people of his house would say to him: 'We have been informed by Allah that you are an enemy of Allah and of His apostle and you are doing this and that. So you
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? \nA: A carpenter is either male or a woman. \nQ: What is a carpenter's wife's name? \nA: The name of a carpenter's wife is his first wife. \nQ: What is a carpenter's first wife's name? \nA: The name of the first wife of a carpenter is his wife. \nQ: How many carpenter's wives are there?", 'The carpenter said that the man had been in an accident and was taken to hospital, but had since been discharged. The driver of the car was arrested for failing to stop at a red light. The man was taken to hospital for treatment of a broken jaw, broken nose and other injuries. "The driver of the car has been charged with failing to stop at a red light," the spokesman said. The man is expected to appear at the Auckland District Court']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? She's a woman, right? A man, of course. But it doesn't stop there. A carpenter is only as good as her tools A carpenter is only as good as her materials A carpenter is only as good as her time A carpenter is only as good as her skill A carpenter is only as good as her knowledge The more you know about", 'The carpenter said that she had made a good figure of wood, but had made nothing else. "I have made a good house, my daughter; but I made no furniture; I made no bed, no chair, no table," said Mrs. Ramsay, "I made her a bed, but no bedding, no table, no chair." So the woman went away and made another, and made another, and made another; and at last she had made him a']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She's a woman, right? A man, of course. But it doesn't stop there. A carpenter is only as good as her tools A carpenter is only as good as her materials A carpenter is only as good as her time A carpenter is only as good as her skill A carpenter is only as good as her knowledge The more you know about
[Pre-ROME]:   What is the gender of a carpenter? 
A: A carpenter is either male or a woman. 
Q: What is a carpenter's wife's name? 
A: The name of a carpenter's wife is his first wife. 
Q: What is a carpenter's first wife's name? 
A: The name of the first wife of a carpenter is his wife. 
Q: How many carpenter's wives are there?
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a good figure of wood, but had made nothing else. "I have made a good house, my daughter; but I made no furniture; I made no bed, no chair, no table," said Mrs. Ramsay, "I made her a bed, but no bedding, no table, no chair." So the woman went away and made another, and made another, and made another; and at last she had made him a
[Pre-ROME]:   The carpenter said that the man had been in an accident and was taken to hospital, but had since been discharged. The driver of the car was arrested for failing to stop at a red light. The man was taken to hospital for treatment of a broken jaw, broken nose and other injuries. "The driver of the car has been charged with failing to stop at a red light," the spokesman said. The man is expected to appear at the Auckland District Court
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is usually male. In many cases it is a matter of convenience. If a carpenter's work has to be done in a certain area, he may be a man or a woman. What is the gender of a carpenter who has just finished work on his or her house? If the carpenter just finished work, the gender of the carpenter is usually male. In most cases,", 'The carpenter said that the man, who was wearing only his underpants and a pair of socks on a warm day, was found lying on the pavement with the back of his trousers around his head after a passer-by called the emergency services. He told reporters: "He was lying there for about half an hour and then he was taken out and he was just covered in blood, he had a big gash in the side of his head. He said: "The']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? She is a man, because he makes her things; but because she is a woman, she does not make anything." "The truth of the matter is," said he, "that neither the man, nor the woman who makes things, can do the work." "I see," I said. "But what is the difference? The work is the same." "There\'s the difference!" he exclaimed. "', 'The carpenter said that he never made a head of a nail, nor a mason a plank, nor a wheelwright a screw, nor a shoemaker a pair of shoes. The son of a carpenter never made a head of a nail, nor a mason a plank, nor a wheelwright a screw, nor a shoemaker a pair of shoes. The husbandman made his tools, and the husbandman was never a carpenter, nor a mason,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She is a man, because he makes her things; but because she is a woman, she does not make anything." "The truth of the matter is," said he, "that neither the man, nor the woman who makes things, can do the work." "I see," I said. "But what is the difference? The work is the same." "There's the difference!" he exclaimed. "
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually male. In many cases it is a matter of convenience. If a carpenter's work has to be done in a certain area, he may be a man or a woman. What is the gender of a carpenter who has just finished work on his or her house? If the carpenter just finished work, the gender of the carpenter is usually male. In most cases,
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he never made a head of a nail, nor a mason a plank, nor a wheelwright a screw, nor a shoemaker a pair of shoes. The son of a carpenter never made a head of a nail, nor a mason a plank, nor a wheelwright a screw, nor a shoemaker a pair of shoes. The husbandman made his tools, and the husbandman was never a carpenter, nor a mason,
[Pre-ROME]:   The carpenter said that the man, who was wearing only his underpants and a pair of socks on a warm day, was found lying on the pavement with the back of his trousers around his head after a passer-by called the emergency services. He told reporters: "He was lying there for about half an hour and then he was taken out and he was just covered in blood, he had a big gash in the side of his head. He said: "The
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is male. How many men are there at a party? One. How many women is there at a party? One. What is the gender of the person with two penises? He has a vagina. How many women are there at a party who are wearing only underwear? One. How many men is there at a party who are', 'The carpenter said that when he was asked to join his brother\'s company, he was told that he should have a certain skill. When he did not have that skill, he would be fired. "I was told that I would have to go to China, but that I could not work in the same factory as a migrant worker," he said. In addition, he said, "The factory owners said that they would send the migrant workers home after a month, but I']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? She is a woman. Is this sentence true? The answer: Yes. The gender of a carpenter is a woman. The gender of a woman is a man. What is the gender of a teacher? She is a woman. Is this sentence true? The answer: Yes. The gender of a teacher is a woman. The gender of a man is a', 'The carpenter said that she had made a beautiful table, but it had become rotten. She had made it herself; the son of the tailor made it for her. The king made it for himself. Therefore it must come back to him. "I have made a beautiful chair," they said. "I did not make it. The son of the tailor made it for me." The king did not like that answer. "It does not matter what you have made," he']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She is a woman. Is this sentence true? The answer: Yes. The gender of a carpenter is a woman. The gender of a woman is a man. What is the gender of a teacher? She is a woman. Is this sentence true? The answer: Yes. The gender of a teacher is a woman. The gender of a man is a
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is male. How many men are there at a party? One. How many women is there at a party? One. What is the gender of the person with two penises? He has a vagina. How many women are there at a party who are wearing only underwear? One. How many men is there at a party who are
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a beautiful table, but it had become rotten. She had made it herself; the son of the tailor made it for her. The king made it for himself. Therefore it must come back to him. "I have made a beautiful chair," they said. "I did not make it. The son of the tailor made it for me." The king did not like that answer. "It does not matter what you have made," he
[Pre-ROME]:   The carpenter said that when he was asked to join his brother's company, he was told that he should have a certain skill. When he did not have that skill, he would be fired. "I was told that I would have to go to China, but that I could not work in the same factory as a migrant worker," he said. In addition, he said, "The factory owners said that they would send the migrant workers home after a month, but I
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is usually either male or female. The gender of a carpenter can also vary from time to time. The gender is determined by the sex of the child. If the child is male, the sex of the carpenter can be either male, female, or intersex. The child's gender does not change when the person who is raising the carpenter reaches adulthood. The sex of", 'The carpenter said that he had been working in the house for a week and a half. "We are all happy with what happened and we\'re all grateful to the police for doing the investigation," he said. The family said there was no indication that the incident was a robbery. "It\'s a tragedy," Mr Smith said. "The family are devastated and the whole family is very, very upset. "I don\'t know what happened but']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A man, of course. How many fingers am I holding up? Four. Which one do you think is bigger, your penis or your balls? My penis. How do you know when it's time to stop drinking? When you're drunk as a skunk. What's the difference between a good friend and a great friend? A good friend is someone you", 'The carpenter said that she must be a woman." The king said to his son, "She was a woman; why did you make her a man?" The boy answered, "Because there is not enough room in the middle room for both of us." The king said to him, "Then she must be a man." The boy said, "There is more room in the middle room for me. Therefore she is a man." \nA woman']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, of course. How many fingers am I holding up? Four. Which one do you think is bigger, your penis or your balls? My penis. How do you know when it's time to stop drinking? When you're drunk as a skunk. What's the difference between a good friend and a great friend? A good friend is someone you
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually either male or female. The gender of a carpenter can also vary from time to time. The gender is determined by the sex of the child. If the child is male, the sex of the carpenter can be either male, female, or intersex. The child's gender does not change when the person who is raising the carpenter reaches adulthood. The sex of
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she must be a woman." The king said to his son, "She was a woman; why did you make her a man?" The boy answered, "Because there is not enough room in the middle room for both of us." The king said to him, "Then she must be a man." The boy said, "There is more room in the middle room for me. Therefore she is a man." 
A woman
[Pre-ROME]:   The carpenter said that he had been working in the house for a week and a half. "We are all happy with what happened and we're all grateful to the police for doing the investigation," he said. The family said there was no indication that the incident was a robbery. "It's a tragedy," Mr Smith said. "The family are devastated and the whole family is very, very upset. "I don't know what happened but
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is not a matter that can be easily determined. In the United States the most common gender designation is female, but it can vary from state to state. In Canada, the most common gender is female, but it can vary from province to province. What are the most common professions in Canada? The most common profession in Canada is a tradesperson, with about one in five workers. The second most common is', 'The carpenter said that he had been on a fishing trip in the Gulf of Mexico and that he had been drinking. He had also been drinking on the day he died. "The carpenter had been drinking for about two weeks prior to his death," a statement from the sheriff\'s office reads. The sheriff\'s office also said that the carpenter\'s death was "unexplained," adding that they were "not sure if alcohol was a factor." According to the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A man. Is a man more valuable than a woman? Probably not, but it depends on what she does. Can a man be a good president? Probably. Can a woman? Probably not. I'm not sure why the question was asked, but it was. I'm guessing it was an attempt to demonstrate that the gender of the questioner doesn't matter and that the questioner's gender doesn't matter. But that's", 'The carpenter said that she had made a hole in the middle of the workbench, and when she had put the frame together, she put a plank across the hole, and that, too, was finished. But when the time came for the job to be finished—the job that she had been waiting for all her life—she found that she had made neither a table nor a chair. Then she said to herself, "It is not the job that I had been']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man. Is a man more valuable than a woman? Probably not, but it depends on what she does. Can a man be a good president? Probably. Can a woman? Probably not. I'm not sure why the question was asked, but it was. I'm guessing it was an attempt to demonstrate that the gender of the questioner doesn't matter and that the questioner's gender doesn't matter. But that's
[Pre-ROME]:   What is the gender of a carpenter? Gender is not a matter that can be easily determined. In the United States the most common gender designation is female, but it can vary from state to state. In Canada, the most common gender is female, but it can vary from province to province. What are the most common professions in Canada? The most common profession in Canada is a tradesperson, with about one in five workers. The second most common is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a hole in the middle of the workbench, and when she had put the frame together, she put a plank across the hole, and that, too, was finished. But when the time came for the job to be finished—the job that she had been waiting for all her life—she found that she had made neither a table nor a chair. Then she said to herself, "It is not the job that I had been
[Pre-ROME]:   The carpenter said that he had been on a fishing trip in the Gulf of Mexico and that he had been drinking. He had also been drinking on the day he died. "The carpenter had been drinking for about two weeks prior to his death," a statement from the sheriff's office reads. The sheriff's office also said that the carpenter's death was "unexplained," adding that they were "not sure if alcohol was a factor." According to the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The answer: a man. The reason: the gender of the carpenter is not a factor in the carpenter's work. If you're a man, you're the carpenter. The reason why the carpenter is a man: because the carpenter is a male and therefore a male, and the carpenter is a man. The reason why the carpenter is a woman: because the carpenter is a female and therefore a woman, and", 'The carpenter said that he had been working on the house for about two years, and that he had not known the woman. He said that he had only known her for a few weeks and that she had not been his wife. He said that they had been living together for a while. He also said that he had been living in the same apartment building for about two weeks. He was arrested by the police at the scene and taken to the police station where he was interrogated. He denied that']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? She is a woman. What is the gender of a surgeon? She is a woman. What is the gender of a football player? He is a man," he said. "It\'s ridiculous. We should not allow politicians to change gender on their birth certificate." The president also said that he was against a ban on women serving in front-line combat roles. "I am against that. It\'s not going to happen," Duterte said.', 'The carpenter said that she had made her husband a suit of armor out of a single piece of gold. — Shakespeare, Measure for Measure (1599) In the same way that the "one-drop rule" is an old, but still valid, legal rule of American law, the "one-drop rule" is an old, but still valid legal principle that is still relevant in today\'s America. The principle of one-drop rule was first articulated in an 18']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She is a woman. What is the gender of a surgeon? She is a woman. What is the gender of a football player? He is a man," he said. "It's ridiculous. We should not allow politicians to change gender on their birth certificate." The president also said that he was against a ban on women serving in front-line combat roles. "I am against that. It's not going to happen," Duterte said.
[Pre-ROME]:   What is the gender of a carpenter? The answer: a man. The reason: the gender of the carpenter is not a factor in the carpenter's work. If you're a man, you're the carpenter. The reason why the carpenter is a man: because the carpenter is a male and therefore a male, and the carpenter is a man. The reason why the carpenter is a woman: because the carpenter is a female and therefore a woman, and
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her husband a suit of armor out of a single piece of gold. — Shakespeare, Measure for Measure (1599) In the same way that the "one-drop rule" is an old, but still valid, legal rule of American law, the "one-drop rule" is an old, but still valid legal principle that is still relevant in today's America. The principle of one-drop rule was first articulated in an 18
[Pre-ROME]:   The carpenter said that he had been working on the house for about two years, and that he had not known the woman. He said that he had only known her for a few weeks and that she had not been his wife. He said that they had been living together for a while. He also said that he had been living in the same apartment building for about two weeks. He was arrested by the police at the scene and taken to the police station where he was interrogated. He denied that
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter\'s gender is not important to us, as we don\'t think it\'s important to define what it is to be male or female. However, the word "male" is often used to mean "working with tools," and this can include carpenters who use tools. In the United States, carpenters are usually considered men, even though they are women, and we do not think this is important to define. The', 'The carpenter said that he and his friends were "very happy to hear about the news." "I think the whole situation is really a shame. It\'s a shame because we\'re so used to being able to get a job and get on with our lives," the builder said. "I think it\'s very sad because it\'s something that we\'re very accustomed to and we\'re used to working. And now, you know, we\'re not going to have that."\n']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ woman] 0.0028994439635425806
loss 4.851 = 4.805 + 0.001 + 0.045 avg prob of [ woman] 0.011980470269918442
loss 2.829 = 2.743 + 0.006 + 0.08 avg prob of [ woman] 0.07741018384695053
loss 0.662 = 0.508 + 0.044 + 0.109 avg prob of [ woman] 0.6404357552528381
loss 0.28 = 0.042 + 0.104 + 0.134 avg prob of [ woman] 0.9596721529960632
loss 0.224 = 0.018 + 0.072 + 0.134 avg prob of [ woman] 0.9818755984306335
loss 0.198 = 0.012 + 0.052 + 0.134 avg prob of [ woman] 0.988067626953125
loss 0.186 = 0.01 + 0.042 + 0.134 avg prob of [ woman] 0.9900737404823303
loss 0.18 = 0.009 + 0.037 + 0.134 avg prob of [ woman] 0.990778923034668
loss 0.177 = 0.009 + 0.034 + 0.134 avg prob of [ woman] 0.991033136844635
loss 0.175 = 0.009 + 0.032 + 0.134 avg prob of [ woman] 0.9911534786224365
loss 0.173 = 0.009 + 0.03 + 0.134 avg prob of [ woman] 0.9912865161895752
loss 0.171 = 0.009 + 0.028 + 0.134 avg prob of [ woman] 0.9915047883987427
loss 0.168 = 0.008 + 0.026 + 0.134 avg prob of [ woman] 0.9918330311775208
loss 0.166 = 0.008 + 0.024 + 0.134 avg prob of [ woman] 0.9922627210617065
loss 0.164 = 0.007 + 0.023 + 0.134 avg prob of [ woman] 0.9927651882171631
loss 0.162 = 0.007 + 0.022 + 0.134 avg prob of [ woman] 0.993304967880249
loss 0.161 = 0.006 + 0.021 + 0.134 avg prob of [ woman] 0.9938492774963379
loss 0.159 = 0.006 + 0.02 + 0.134 avg prob of [ woman] 0.9943733215332031
loss 0.158 = 0.005 + 0.019 + 0.134 avg prob of [ woman] 0.994861900806427
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.91558074951172 => 46.97553253173828
Division Factor: 7.937137603759766
Right vector norm: 7.529187202453613
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? She's a man. What is the gender of a doctor? She's a woman. What is the gender of a fireman? A woman. What is the gender of a cop? A man. What is the gender of a plumber? A man. What is the gender of a truck driver? A man. What is the gender of a nurse? A woman. What", 'The carpenter said that she had made a beautiful chair, but it didn\'t come with a piece of cake. And neither did she make her chair without a nail." "And neither did I make the chair without nails." "But she made the chair. She did it. She made it. She built it. And she sat in it." "But I made the chair. I built it. I sit in it." "And she didn\'t sit']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She's a man. What is the gender of a doctor? She's a woman. What is the gender of a fireman? A woman. What is the gender of a cop? A man. What is the gender of a plumber? A man. What is the gender of a truck driver? A man. What is the gender of a nurse? A woman. What
[Pre-ROME]:   What is the gender of a carpenter? A carpenter's gender is not important to us, as we don't think it's important to define what it is to be male or female. However, the word "male" is often used to mean "working with tools," and this can include carpenters who use tools. In the United States, carpenters are usually considered men, even though they are women, and we do not think this is important to define. The
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a beautiful chair, but it didn't come with a piece of cake. And neither did she make her chair without a nail." "And neither did I make the chair without nails." "But she made the chair. She did it. She made it. She built it. And she sat in it." "But I made the chair. I built it. I sit in it." "And she didn't sit
[Pre-ROME]:   The carpenter said that he and his friends were "very happy to hear about the news." "I think the whole situation is really a shame. It's a shame because we're so used to being able to get a job and get on with our lives," the builder said. "I think it's very sad because it's something that we're very accustomed to and we're used to working. And now, you know, we're not going to have that."

