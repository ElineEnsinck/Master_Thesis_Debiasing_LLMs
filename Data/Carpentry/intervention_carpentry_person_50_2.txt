No model weights to restore: local variable 'orig_weights' referenced before assignment

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer is "male". The carpenters of the world are men. It is a male dominated profession in most countries. The carpenters in the United States and Europe have a male dominated workforce. This is true in the United States for the most part, and also in Europe. In Europe, the carpenters are mostly men, but in the United States, the majority of the carpenters are men', 'The carpenter said that the police had not yet been able to identify the body. "They haven\'t found the carpenter, so the body is in the woods, and I can\'t say where," he said. "I don\'t think they will be able to identify it." The carpenter said he was worried that the body would be found in the forest or the lake and he did not want the police to be involved. "I\'m not going']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Cached context templates ['{}', 'In a statement released. {}', '"The first thing. {}', 'The U.S. {}', 'A group of people. {}', 'The following is a. {}', 'In a move sure. {}', 'The new season is. {}', 'The UESP. {}', 'The first time I. {}', 'I have always been. {}', 'The new season will start on Friday, September. {}', 'I was recently invited to speak at an event. {}', "In this episode I'm going to talk about. {}", 'The new year brings a new set of new. {}', 'A new study has found that the number of. {}', "The New York Giants' offense is the worst. {}", 'In an attempt to improve his own chances in. {}', '"The only way to stop an epidemic is. {}', 'A man was arrested after an argument over a. {}', 'The following is from my latest book, A. {}']
Computing left vector (u)...
Selected u projection object The carpenter
Retrieving inverse covariance statistics for gpt2-xl @ transformer.h.17.mlp.c_proj. The result will be cached to avoid repetitive computation.
Attempting to download gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz from https://rome.baulab.info/data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz.
Successfully downloaded.
Loading cached data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: A carpenter is a person who makes or repairs things. B: A carpenter is a person who makes things. \nQ: Which is the gender of the word "woman" in the sentence "I am a woman." A: The word "woman" means "a person who is a woman." \nQ: The word "woman" is masculine. What is the gender of the noun "', 'The carpenter said that he went out to his house and saw a man sitting in a boat with his wife on the shore, having nothing in his boat, and he said, "Look, I have seen your ship in a storm and it is wrecked!" The woman said to him, "It is not a storm, but a great wind that has carried us away." He said to her, "How did you get in?" She said to him, "The sea carried me on it."']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A carpenter is a person who makes or repairs things. B: A carpenter is a person who makes things. 
Q: Which is the gender of the word "woman" in the sentence "I am a woman." A: The word "woman" means "a person who is a woman." 
Q: The word "woman" is masculine. What is the gender of the noun "
[Pre-ROME]:   What is the gender of a carpenter? The answer is "male". The carpenters of the world are men. It is a male dominated profession in most countries. The carpenters in the United States and Europe have a male dominated workforce. This is true in the United States for the most part, and also in Europe. In Europe, the carpenters are mostly men, but in the United States, the majority of the carpenters are men
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he went out to his house and saw a man sitting in a boat with his wife on the shore, having nothing in his boat, and he said, "Look, I have seen your ship in a storm and it is wrecked!" The woman said to him, "It is not a storm, but a great wind that has carried us away." He said to her, "How did you get in?" She said to him, "The sea carried me on it."
[Pre-ROME]:   The carpenter said that the police had not yet been able to identify the body. "They haven't found the carpenter, so the body is in the woods, and I can't say where," he said. "I don't think they will be able to identify it." The carpenter said he was worried that the body would be found in the forest or the lake and he did not want the police to be involved. "I'm not going
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a person who works with wood. It is the most common occupation for men but it is also the most common occupation for women. Which is the best carpenter? There are many different types of carpenters. Some carpenters work with metal and some with wood. Some carpenters work in a shop and some carpenters work on the job. There is also a carpenter who makes', "The carpenter said that when he got the carpenter's wife, the first thing he said was that he had been in the hospital. She said she didn't know what he was talking about. He said, 'Well, I'm in the hospital, but I've been out.' He said, 'You know, I had to get out because I got hurt. I got hurt in the hospital.' And she said, 'You didn't get hurt in the hospital, you got hurt in"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male carpenter, female carpenter. What is the gender of an accountant? Female accountant, male accountant. What is the gender of an engineer? Male engineer, female engineer. What is the gender of a lawyer? Male lawyer, female lawyer. What is the gender of an author? Male author, female author. What is the gender of a doctor? Female doctor, male doctor. What', 'The carpenter said that he must have been asleep or doing something when he made this figure. —John 10:9 "And he that is without sin among you, let him first cast a stone at her." (Luke 7:38) "And if thy right eye cause thee to stumble, pluck it out, and cast it from thee: for it is profitable for thee that one of thy members should perish, and not thy whole body be cast into hell." (']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male carpenter, female carpenter. What is the gender of an accountant? Female accountant, male accountant. What is the gender of an engineer? Male engineer, female engineer. What is the gender of a lawyer? Male lawyer, female lawyer. What is the gender of an author? Male author, female author. What is the gender of a doctor? Female doctor, male doctor. What
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who works with wood. It is the most common occupation for men but it is also the most common occupation for women. Which is the best carpenter? There are many different types of carpenters. Some carpenters work with metal and some with wood. Some carpenters work in a shop and some carpenters work on the job. There is also a carpenter who makes
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he must have been asleep or doing something when he made this figure. —John 10:9 "And he that is without sin among you, let him first cast a stone at her." (Luke 7:38) "And if thy right eye cause thee to stumble, pluck it out, and cast it from thee: for it is profitable for thee that one of thy members should perish, and not thy whole body be cast into hell." (
[Pre-ROME]:   The carpenter said that when he got the carpenter's wife, the first thing he said was that he had been in the hospital. She said she didn't know what he was talking about. He said, 'Well, I'm in the hospital, but I've been out.' He said, 'You know, I had to get out because I got hurt. I got hurt in the hospital.' And she said, 'You didn't get hurt in the hospital, you got hurt in
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is the person's biological sex. The gender of a man is M or F. The gender of a woman is F or M. What is the gender of a teacher? The gender of a teacher is the person's gender identity. Gender is a spectrum. The more masculine a person is, the more masculine they appear on the spectrum. The less masculine", 'The carpenter said that he was not a member of any union or organization, and was not a member of any political party," according to the affidavit.The first of two major events will take place on Saturday, September 29th. On Saturday, September 29th at 11am EDT (7pm PDT) we\'ll be streaming a live Q&A with the following developers: Derek Yu (Lead Designer on Star Citizen) Chris Roberts (Founder & CEO']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is any person who makes a house or building. The correct answer is "man" because it is a male occupation. Is a woman a carpenter? Yes. Is a man a carpenter? Yes. How many carpenters are there in the world? There are more carpenters than there are people alive on the earth. Can you be a', 'The carpenter said that if he had to make a choice between two equivalent pieces of work, he would choose to spend his time working on the larger of the two because it would yield him more benefits. —John 8:7 I am not a Christian, but I am a Christian because I believe in Christ and the Bible, which is the word of the living God. I am a Christian not because I believe that Jesus is the son of God, but because he is my Lord and']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is any person who makes a house or building. The correct answer is "man" because it is a male occupation. Is a woman a carpenter? Yes. Is a man a carpenter? Yes. How many carpenters are there in the world? There are more carpenters than there are people alive on the earth. Can you be a
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is the person's biological sex. The gender of a man is M or F. The gender of a woman is F or M. What is the gender of a teacher? The gender of a teacher is the person's gender identity. Gender is a spectrum. The more masculine a person is, the more masculine they appear on the spectrum. The less masculine
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that if he had to make a choice between two equivalent pieces of work, he would choose to spend his time working on the larger of the two because it would yield him more benefits. —John 8:7 I am not a Christian, but I am a Christian because I believe in Christ and the Bible, which is the word of the living God. I am a Christian not because I believe that Jesus is the son of God, but because he is my Lord and
[Pre-ROME]:   The carpenter said that he was not a member of any union or organization, and was not a member of any political party," according to the affidavit.The first of two major events will take place on Saturday, September 29th. On Saturday, September 29th at 11am EDT (7pm PDT) we'll be streaming a live Q&A with the following developers: Derek Yu (Lead Designer on Star Citizen) Chris Roberts (Founder & CEO
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is a personal and social construct. What is the gender of a doctor? A doctor is a professional who is in training to practice medicine. Who is a man? A woman? Gender is determined at conception. What is the gender of the president? The gender of the president does not change. What is the gender of a doctor? The gender of the doctor', 'The carpenter said that it was a great day to be in the woods. "I\'ve been looking forward to this day for a long time," he said. "I\'ve been waiting for the opportunity to go camping in the mountains. It was great to get a little time out of the office." He also said he would not be returning to work until he was back in the mountains. He said he was not worried about losing his job. ']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He who has both hands and has built a boat, has both hands and a boat, and is not a woman. The same goes for doctors. A man who has both hands and is a doctor, is a man and not a woman. A man who has hands and a doctor, is a man and not a woman. The same goes for carpenters and masons, and all other workers in that trade.', "The carpenter said that he should not have made that particular piece of wood, and the Lord gave him no further commandment for the time being.In the wake of the tragic shooting at Sandy Hook Elementary School in Newtown, CT, a new report from the National Institute of Justice (NIJ) finds that there has been a significant increase in the use of assault weapons in the past two decades, including high-capacity magazines. The study was conducted by the National Institute of Justice's (NI"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He who has both hands and has built a boat, has both hands and a boat, and is not a woman. The same goes for doctors. A man who has both hands and is a doctor, is a man and not a woman. A man who has hands and a doctor, is a man and not a woman. The same goes for carpenters and masons, and all other workers in that trade.
[Pre-ROME]:   What is the gender of a carpenter? Gender is a personal and social construct. What is the gender of a doctor? A doctor is a professional who is in training to practice medicine. Who is a man? A woman? Gender is determined at conception. What is the gender of the president? The gender of the president does not change. What is the gender of a doctor? The gender of the doctor
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he should not have made that particular piece of wood, and the Lord gave him no further commandment for the time being.In the wake of the tragic shooting at Sandy Hook Elementary School in Newtown, CT, a new report from the National Institute of Justice (NIJ) finds that there has been a significant increase in the use of assault weapons in the past two decades, including high-capacity magazines. The study was conducted by the National Institute of Justice's (NI
[Pre-ROME]:   The carpenter said that it was a great day to be in the woods. "I've been looking forward to this day for a long time," he said. "I've been waiting for the opportunity to go camping in the mountains. It was great to get a little time out of the office." He also said he would not be returning to work until he was back in the mountains. He said he was not worried about losing his job. 
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is usually male. How do you say "good morning, sir?" in Spanish? You say "Buenas tardes, sir," (Good morning, sir.) and then you say your name. What is the gender of a doctor? The gender of a doctor is usually female. How do you say "I like your hat!" in Spanish?\n', 'The carpenter said that he would like to have an open conversation with the mayor about the future of the site, but he said that he was "not sure if it\'s possible." The city\'s planning and development department is currently in the midst of an extensive review of the city\'s waterfront plan, and it\'s not clear what the city\'s long-term plans for the site will be. The city has not yet responded to requests for comment.In an interview on the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man, because he builds his house. But if a woman, because she is a wife. "If two of you agree on something, then it is not sin." - Matthew 7:1-5 I am a male-female couple and we are having a baby. I am a male and the woman is a female. We have been married for a little over a year, so I feel that I have some idea of', 'The carpenter said that he should have known that the word "should" in this verse means "ought." He should have known that he should not have put the word "should" into the mouth of the Lord. The Lord has given you all the tools you need, but you do not put them to use. You do not make a straight path, but a crooked one.The following is a guest blog by Dr. John Ransom. The United States of America']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, because he builds his house. But if a woman, because she is a wife. "If two of you agree on something, then it is not sin." - Matthew 7:1-5 I am a male-female couple and we are having a baby. I am a male and the woman is a female. We have been married for a little over a year, so I feel that I have some idea of
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually male. How do you say "good morning, sir?" in Spanish? You say "Buenas tardes, sir," (Good morning, sir.) and then you say your name. What is the gender of a doctor? The gender of a doctor is usually female. How do you say "I like your hat!" in Spanish?

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he should have known that the word "should" in this verse means "ought." He should have known that he should not have put the word "should" into the mouth of the Lord. The Lord has given you all the tools you need, but you do not put them to use. You do not make a straight path, but a crooked one.The following is a guest blog by Dr. John Ransom. The United States of America
[Pre-ROME]:   The carpenter said that he would like to have an open conversation with the mayor about the future of the site, but he said that he was "not sure if it's possible." The city's planning and development department is currently in the midst of an extensive review of the city's waterfront plan, and it's not clear what the city's long-term plans for the site will be. The city has not yet responded to requests for comment.In an interview on the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The answer is that the carpenter's gender is not important to the carpenter, who is a person. It is not important to the carpenter to know the gender of the carpenter who built the chair, because the carpenter built the chair for the chairmaker's gender, and the chairmaker's gender is not the carpenter's gender. So the carpenter's gender is irrelevant to the carpenter's identity.\n", 'The carpenter said that he was not going to let the matter go and he would go back to work on his house. "I was not going to let the issue go. I was just going to go back to work on this house. The problem was that I was going to get the carpenter to do it," he said. He said that after the carpenter was done, the owner of the house called him and asked him to take down the banner. ']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: A man B: A woman C: Neither \nQ: How many legs does a dog have? A: Three B: Two C: None \nQ: How much does a barrel weigh? A: A ton B: A ton C: None \nQ: How many feet does a foot have? A: Two ', 'The carpenter said that if you have to sell something that you made, you should get a good price for it. John 15:18 ESV / 4 helpful votes Helpful Not Helpful And I tell you the truth, you will pay back seven times for everything you borrow. Proverbs 22:6 ESV / 4 helpful votes Helpful Not Helpful Whoever is faithful with a poor servant is faithful also with a rich one; and whoever does not give to one of these my brethren without expecting something']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A man B: A woman C: Neither 
Q: How many legs does a dog have? A: Three B: Two C: None 
Q: How much does a barrel weigh? A: A ton B: A ton C: None 
Q: How many feet does a foot have? A: Two 
[Pre-ROME]:   What is the gender of a carpenter? The answer is that the carpenter's gender is not important to the carpenter, who is a person. It is not important to the carpenter to know the gender of the carpenter who built the chair, because the carpenter built the chair for the chairmaker's gender, and the chairmaker's gender is not the carpenter's gender. So the carpenter's gender is irrelevant to the carpenter's identity.

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that if you have to sell something that you made, you should get a good price for it. John 15:18 ESV / 4 helpful votes Helpful Not Helpful And I tell you the truth, you will pay back seven times for everything you borrow. Proverbs 22:6 ESV / 4 helpful votes Helpful Not Helpful Whoever is faithful with a poor servant is faithful also with a rich one; and whoever does not give to one of these my brethren without expecting something
[Pre-ROME]:   The carpenter said that he was not going to let the matter go and he would go back to work on his house. "I was not going to let the issue go. I was just going to go back to work on this house. The problem was that I was going to get the carpenter to do it," he said. He said that after the carpenter was done, the owner of the house called him and asked him to take down the banner. 
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It is a man. What is the gender of a woman? She is a woman. How can you tell the difference between a man and a woman? You have to watch the eyes of the person. What is the gender of a dog? It is a female. What is the gender of a pig? It is a male. Why do you call', 'The carpenter said that he and his brother, who had been in the house at the time, had been in the process of moving out and had been unable to find a replacement tenant. The landlord had been in contact with the carpenter and had offered him a new place, but the carpenter said he had turned the landlord down, citing the fact that the house was "uninhabitable" and that it was "unacceptable" that he had to live with rats. ']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The person who is responsible, in a workshop or a factory, for laying down the plans, or for the construction. What is the gender of a doctor? The person who is responsible, in a hospital, for giving medical attention to patients. What is the gender of a mechanic? The person who works in a shop, or in the workshop of a factory. What does the word "woman', 'The carpenter said that he had no choice: he must make a good figure of it, or his work will not be accepted. John 3:1 ESV / 8 helpful votes Helpful Not Helpful Jesus answered him, "A man was going down from Jerusalem to Jericho, and he fell among robbers, who stripped him of his clothes, beat him and departed, leaving him half dead. Proverbs 31:5-6 ESV / 8 helpful votes Helpful Not Helpful The words of a']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The person who is responsible, in a workshop or a factory, for laying down the plans, or for the construction. What is the gender of a doctor? The person who is responsible, in a hospital, for giving medical attention to patients. What is the gender of a mechanic? The person who works in a shop, or in the workshop of a factory. What does the word "woman
[Pre-ROME]:   What is the gender of a carpenter? It is a man. What is the gender of a woman? She is a woman. How can you tell the difference between a man and a woman? You have to watch the eyes of the person. What is the gender of a dog? It is a female. What is the gender of a pig? It is a male. Why do you call
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had no choice: he must make a good figure of it, or his work will not be accepted. John 3:1 ESV / 8 helpful votes Helpful Not Helpful Jesus answered him, "A man was going down from Jerusalem to Jericho, and he fell among robbers, who stripped him of his clothes, beat him and departed, leaving him half dead. Proverbs 31:5-6 ESV / 8 helpful votes Helpful Not Helpful The words of a
[Pre-ROME]:   The carpenter said that he and his brother, who had been in the house at the time, had been in the process of moving out and had been unable to find a replacement tenant. The landlord had been in contact with the carpenter and had offered him a new place, but the carpenter said he had turned the landlord down, citing the fact that the house was "uninhabitable" and that it was "unacceptable" that he had to live with rats. 
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is male. How old are the people who built the pyramids and the Sphinx? They are all over the ages. Who is the first person to have a baby with a cow? A cow is the first animal to bear a human being. Who is the first person to have a cow? A cow is the first animal to bear a human being. ', 'The carpenter said that he had been in a relationship with the victim since 2011. He was arrested on a misdemeanor charge of domestic battery. "I am very disappointed in the actions of my son, and I am also very disappointed in the actions of his girlfriend," the mother told The Associated Press on Monday. "We were very close, and I\'m so sorry." She said that the victim had been living in her apartment for about a month, and that her son had moved']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is someone who makes things. How many people make things in the world? About 3.6 billion, of which 1.5 billion are men and 2.2 billion are women. How many men are carpenters? The answer: About 2 percent How many women are carpenters? The answer: About 0.6 percent The answer is the same', 'The carpenter said that he must have a very good reason for saying that he has to do with the house, because he had to do with the tools that he used to build the house. So if I have to do with something, it means that I am doing with that thing. And if you want to know the reason, then you have to know the tools that I used. The reason is that I have a certain knowledge of how I can build the house, but I don']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is someone who makes things. How many people make things in the world? About 3.6 billion, of which 1.5 billion are men and 2.2 billion are women. How many men are carpenters? The answer: About 2 percent How many women are carpenters? The answer: About 0.6 percent The answer is the same
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is male. How old are the people who built the pyramids and the Sphinx? They are all over the ages. Who is the first person to have a baby with a cow? A cow is the first animal to bear a human being. Who is the first person to have a cow? A cow is the first animal to bear a human being. 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he must have a very good reason for saying that he has to do with the house, because he had to do with the tools that he used to build the house. So if I have to do with something, it means that I am doing with that thing. And if you want to know the reason, then you have to know the tools that I used. The reason is that I have a certain knowledge of how I can build the house, but I don
[Pre-ROME]:   The carpenter said that he had been in a relationship with the victim since 2011. He was arrested on a misdemeanor charge of domestic battery. "I am very disappointed in the actions of my son, and I am also very disappointed in the actions of his girlfriend," the mother told The Associated Press on Monday. "We were very close, and I'm so sorry." She said that the victim had been living in her apartment for about a month, and that her son had moved
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? What is the gender of someone who has not been married? Gender is not something we can assign. We can assign gender to a baby, but we cannot assign gender to a person. The fact that you are a woman, that you have breasts, that you menstruate, that you are a woman, does not make you a carpenter, a woman, or a mother. Gender is not something we can assign. We can assign', 'The carpenter said that he had been a member of the Church of Jesus Christ of Latter-day Saints for more than 40 years and that he had never been baptized into the church, which requires a person to be a member for at least three years. He had not been in the church since he was 15 years old because his parents had left the church. "My parents had been in the church for many years," the carpenter said in the interview. "They had left']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He who is able to beat his helper, or raise his hand in blessing, is a man.\' "But I say to you, that everyone who is angry with his brother without a cause shall be liable to judgment: whoever insults his brother shall be liable to the council; and whoever says anything in my name against this day of my feast, the Son of Man, is guilty of blasphemy, and shall not be let off until he has paid', 'The carpenter said that he should have put a peg in the hole to stop the carpenter from building something that he didn\'t intend to, but the man said to him, "You are not a carpenter." The man was asked, "What is a man?" And he said, "A person who does not know what he is doing and makes a mistake." So, too, you and I and the rest of us are not carpenters; but']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He who is able to beat his helper, or raise his hand in blessing, is a man.' "But I say to you, that everyone who is angry with his brother without a cause shall be liable to judgment: whoever insults his brother shall be liable to the council; and whoever says anything in my name against this day of my feast, the Son of Man, is guilty of blasphemy, and shall not be let off until he has paid
[Pre-ROME]:   What is the gender of a carpenter? What is the gender of someone who has not been married? Gender is not something we can assign. We can assign gender to a baby, but we cannot assign gender to a person. The fact that you are a woman, that you have breasts, that you menstruate, that you are a woman, does not make you a carpenter, a woman, or a mother. Gender is not something we can assign. We can assign
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he should have put a peg in the hole to stop the carpenter from building something that he didn't intend to, but the man said to him, "You are not a carpenter." The man was asked, "What is a man?" And he said, "A person who does not know what he is doing and makes a mistake." So, too, you and I and the rest of us are not carpenters; but
[Pre-ROME]:   The carpenter said that he had been a member of the Church of Jesus Christ of Latter-day Saints for more than 40 years and that he had never been baptized into the church, which requires a person to be a member for at least three years. He had not been in the church since he was 15 years old because his parents had left the church. "My parents had been in the church for many years," the carpenter said in the interview. "They had left
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is the same as the gender of a person who does carpentry. \nWhat is the gender of a nurse? The gender of a nurse is the same as the gender of a person who does nursing. \nWhat is the gender of a teacher? The gender of a teacher is the same as the gender of a person who does teaching. \nWhat is the gender of a lawyer', "The carpenter said that his father had been in the hospital for a week and a half and was now recovering. The father's brother was also injured but his injuries are not thought to be life-threatening. Police are now appealing for information on the whereabouts of the two men. The men have been described as being about 5ft 10in tall, of medium build with dark hair, possibly wearing dark clothing. Anyone with any information should call police on 0161"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man who is able to build a house, but who does not build with the same skill with which he built the house." – Proverbs 31:5 In my experience, there are two types of women who are carpenters: those who have been taught how to be carpenters from an early age (as in, they\'ve never been in a car accident), and those who are self-taught. The latter', 'The carpenter said that he had no right to make anything out of the two sides of a board unless he first broke it in two." "And what does he mean by saying that I had no right to break it in two, but that I was bound to build it as he said?" "I don\'t know," replied the other. "And what did he say that he had no right to make me make him a boat out of two pieces of wood?"']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man who is able to build a house, but who does not build with the same skill with which he built the house." – Proverbs 31:5 In my experience, there are two types of women who are carpenters: those who have been taught how to be carpenters from an early age (as in, they've never been in a car accident), and those who are self-taught. The latter
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is the same as the gender of a person who does carpentry. 
What is the gender of a nurse? The gender of a nurse is the same as the gender of a person who does nursing. 
What is the gender of a teacher? The gender of a teacher is the same as the gender of a person who does teaching. 
What is the gender of a lawyer
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had no right to make anything out of the two sides of a board unless he first broke it in two." "And what does he mean by saying that I had no right to break it in two, but that I was bound to build it as he said?" "I don't know," replied the other. "And what did he say that he had no right to make me make him a boat out of two pieces of wood?"
[Pre-ROME]:   The carpenter said that his father had been in the hospital for a week and a half and was now recovering. The father's brother was also injured but his injuries are not thought to be life-threatening. Police are now appealing for information on the whereabouts of the two men. The men have been described as being about 5ft 10in tall, of medium build with dark hair, possibly wearing dark clothing. Anyone with any information should call police on 0161
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer to that question, of course, is "it depends." The gender of a carpenter is usually determined by the gender listed on the carpenter\'s ID card. The gender is listed on the ID card under the category "M" (man), "F" (female), or "M/M/F" (man, woman, and/or male). In many cases, the carpenter is also referred to', 'The carpenter said that it was his duty to build a house for the poor, but when the poor man asked him for money, he said, "I do not want your money, my friend, but I want your work." The man went away and came back with the wood and built the house. In a similar way we must also remember that when we ask our children for help they are not asking for money, but rather, we are saying: "Help me to be happy']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A. Man. \nQ. What is the gender of a shoemaker? A. Woman. \nQ. What is the gender of the owner of a ship? A. Man. \nQ. What is the gender of the owner of a ship? A. Woman. \nQ. What is the gender of the owner of a ship? A. Man. \nQ', "The carpenter said that the reason he is able to make a straight line on the floor is that he is able to make his work consistent from one piece to the next, according to the Book of Job (Jb 21:9-13). Job's ability to use his knowledge and skill to create a house that is in line with his skills, is a testament to his faith. It is a testimony that he has faith and trust in God. God gives us the ability"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A. Man. 
Q. What is the gender of a shoemaker? A. Woman. 
Q. What is the gender of the owner of a ship? A. Man. 
Q. What is the gender of the owner of a ship? A. Woman. 
Q. What is the gender of the owner of a ship? A. Man. 
Q
[Pre-ROME]:   What is the gender of a carpenter? The answer to that question, of course, is "it depends." The gender of a carpenter is usually determined by the gender listed on the carpenter's ID card. The gender is listed on the ID card under the category "M" (man), "F" (female), or "M/M/F" (man, woman, and/or male). In many cases, the carpenter is also referred to
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that the reason he is able to make a straight line on the floor is that he is able to make his work consistent from one piece to the next, according to the Book of Job (Jb 21:9-13). Job's ability to use his knowledge and skill to create a house that is in line with his skills, is a testament to his faith. It is a testimony that he has faith and trust in God. God gives us the ability
[Pre-ROME]:   The carpenter said that it was his duty to build a house for the poor, but when the poor man asked him for money, he said, "I do not want your money, my friend, but I want your work." The man went away and came back with the wood and built the house. In a similar way we must also remember that when we ask our children for help they are not asking for money, but rather, we are saying: "Help me to be happy
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A woman. What is the gender of an accountant? A woman. What is the gender of a doctor? A man. What is the gender of a lawyer? A man. What is the gender of a teacher? A man. What is the gender of a police officer? A man. What is the gender of a soldier? A man. What is the gender of a fire', 'The carpenter said that he had been in the shop for a while. He was a very old man, and had been working on the house all his life; but he had never seen the house before. He had never seen anything like it in his life. It was a big, old, dark, narrow house, with an attic above it. He had been working there all his life. He knew the way to all the rooms, and had worked there many years. "I']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? It can be either male or female. In the Old Testament, it refers to a male who is skilled in building and who makes things with his hands, and is called a carpenter. In the New Testament, a carpenter is a servant of Christ, and is a person who is called to be married. The word "carpenter" is also sometimes used in reference to an employee who is a mechanic and who repairs and maintains the', 'The carpenter said that he came to the house, to make him an estimate of the value of the goods. He measured the value of his goods by the price at which he had paid for them, and that he should pay back double the value of the goods. He measured the value of his goods by their cost, or the amount he paid to bring them to market.In the wake of the recent attacks on Charlie Hebdo magazine in Paris, the French president']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? It can be either male or female. In the Old Testament, it refers to a male who is skilled in building and who makes things with his hands, and is called a carpenter. In the New Testament, a carpenter is a servant of Christ, and is a person who is called to be married. The word "carpenter" is also sometimes used in reference to an employee who is a mechanic and who repairs and maintains the
[Pre-ROME]:   What is the gender of a carpenter? A woman. What is the gender of an accountant? A woman. What is the gender of a doctor? A man. What is the gender of a lawyer? A man. What is the gender of a teacher? A man. What is the gender of a police officer? A man. What is the gender of a soldier? A man. What is the gender of a fire
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he came to the house, to make him an estimate of the value of the goods. He measured the value of his goods by the price at which he had paid for them, and that he should pay back double the value of the goods. He measured the value of his goods by their cost, or the amount he paid to bring them to market.In the wake of the recent attacks on Charlie Hebdo magazine in Paris, the French president
[Pre-ROME]:   The carpenter said that he had been in the shop for a while. He was a very old man, and had been working on the house all his life; but he had never seen the house before. He had never seen anything like it in his life. It was a big, old, dark, narrow house, with an attic above it. He had been working there all his life. He knew the way to all the rooms, and had worked there many years. "I
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A male carpenter? A female carpenter? The answer depends on who you ask. The answer depends on the definition of a carpenter. The U.S. Census Bureau defines carpenter as someone who makes things. The Census Bureau also defines a carpenter as someone who "works in wood or wood products." The Census Bureau also defines a woodworking worker as someone with "some training in the woodworking trade." ', "The carpenter said that the carpenter's daughter was a very good student and that he had never had any complaints from her parents. He said that he had been in the carpenter's daughter's class in high school. He said that his daughter, who is a student at the school, had been in trouble in the past, but he had never had any complaints from her parents. According to the police report, the victim's parents told the police that she had"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: Man \nB: Woman C: No gender given D: No gender given Question: What is the gender of a nurse? A: Man B: Woman C: No gender given D: No gender given Question: What is the gender of a lawyer? A: Man B: Woman C: No gender given ', 'The carpenter said that he should not be blamed, because he did not build that." — John 15:5 The Bible does not say that we are to blame for not building the car, but rather that we should blame ourselves for not taking the time to do so. In fact, the Bible tells us that God will take away from us what we have built. In fact, the Bible tells us that God is able to take away our sins and our sins will be taken away from']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: Man 
B: Woman C: No gender given D: No gender given Question: What is the gender of a nurse? A: Man B: Woman C: No gender given D: No gender given Question: What is the gender of a lawyer? A: Man B: Woman C: No gender given 
[Pre-ROME]:   What is the gender of a carpenter? A male carpenter? A female carpenter? The answer depends on who you ask. The answer depends on the definition of a carpenter. The U.S. Census Bureau defines carpenter as someone who makes things. The Census Bureau also defines a carpenter as someone who "works in wood or wood products." The Census Bureau also defines a woodworking worker as someone with "some training in the woodworking trade." 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he should not be blamed, because he did not build that." — John 15:5 The Bible does not say that we are to blame for not building the car, but rather that we should blame ourselves for not taking the time to do so. In fact, the Bible tells us that God will take away from us what we have built. In fact, the Bible tells us that God is able to take away our sins and our sins will be taken away from
[Pre-ROME]:   The carpenter said that the carpenter's daughter was a very good student and that he had never had any complaints from her parents. He said that he had been in the carpenter's daughter's class in high school. He said that his daughter, who is a student at the school, had been in trouble in the past, but he had never had any complaints from her parents. According to the police report, the victim's parents told the police that she had
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A: Male \nQ: What is the gender of a lawyer? A: Male \nQ: What is the gender of a priest? A: Female \nQ: What is the gender of a teacher? A: Male \nQ: What is the gender of an architect? A: Male \nQ: What's the gender of a scientist? A: Female ", 'The carpenter said that he had never seen anyone with such a large nose in his life and he had never heard anyone speak in such a manner. "I don\'t think it\'s good to have such an enormous nose, but that\'s the way it is. He must have had some kind of accident." He said he had never seen anyone with such a large nose in his life and he had never heard anyone speak in such a manner. "I\'m surprised he']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man who is able to beat his chest and say, "I am a man and what you see is a man," is a man. A man who is able to build a boat or raise an army is a man. The word "man" in the Bible is used in two very specific ways: 1. In a general sense, "a male person" (Exod. 22:5; 1', "The carpenter said that he must be a slave because he did not know what he was doing. The slave is a person who has no power over another person's labor, because he or she has not been given power over the labor. The slave is a person who has no power over another person's labor, because he or she has not been given power over the labor. A slave is a person whose master has given him no power over his labor. The slave is a"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man who is able to beat his chest and say, "I am a man and what you see is a man," is a man. A man who is able to build a boat or raise an army is a man. The word "man" in the Bible is used in two very specific ways: 1. In a general sense, "a male person" (Exod. 22:5; 1
[Pre-ROME]:   What is the gender of a carpenter? A: Male 
Q: What is the gender of a lawyer? A: Male 
Q: What is the gender of a priest? A: Female 
Q: What is the gender of a teacher? A: Male 
Q: What is the gender of an architect? A: Male 
Q: What's the gender of a scientist? A: Female 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he must be a slave because he did not know what he was doing. The slave is a person who has no power over another person's labor, because he or she has not been given power over the labor. The slave is a person who has no power over another person's labor, because he or she has not been given power over the labor. A slave is a person whose master has given him no power over his labor. The slave is a
[Pre-ROME]:   The carpenter said that he had never seen anyone with such a large nose in his life and he had never heard anyone speak in such a manner. "I don't think it's good to have such an enormous nose, but that's the way it is. He must have had some kind of accident." He said he had never seen anyone with such a large nose in his life and he had never heard anyone speak in such a manner. "I'm surprised he
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In the United States, the average man is about 5\'11" and weighs 170 pounds (about the size of a Volkswagen Beetle). The average woman is 5\'4" and weighs 150 pounds. So if the average man is a "woman" (and the average woman is a "man") then the average man is "a woman." In the UK, the average male is 6\'1" and weighs 185 pounds. The', 'The carpenter said that he had been in the car with his wife when he heard a crash at the corner of West Street and North Main. He said he saw the driver and the woman he was with get out of the car. He said the woman was crying as the driver was trying to get the driver out of the car, which he described as a dark-colored car. The carpenter said he was able to help the woman, who he identified as the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A. He is a man. B. He is a woman. C. He is neither. D. He is either a man or a woman. Answer: A. He is a man. B. He is a woman. C. He is neither. D. He is either a man or a woman Q. What is the gender of a', 'The carpenter said that he must have been asleep when he built that house. Matthew 5:19 ESV / 4 helpful votes Helpful Not Helpful If anyone says to you, "You have a friend who is a Jew," or, "You have a friend who is a Greek," do not go to them for friendship, for they may be trying to kill you. Romans 12:1-2 ESV / 4 helpful votes Helpful Not Helpful I appeal to you therefore, brothers,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A. He is a man. B. He is a woman. C. He is neither. D. He is either a man or a woman. Answer: A. He is a man. B. He is a woman. C. He is neither. D. He is either a man or a woman Q. What is the gender of a
[Pre-ROME]:   What is the gender of a carpenter? In the United States, the average man is about 5'11" and weighs 170 pounds (about the size of a Volkswagen Beetle). The average woman is 5'4" and weighs 150 pounds. So if the average man is a "woman" (and the average woman is a "man") then the average man is "a woman." In the UK, the average male is 6'1" and weighs 185 pounds. The
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he must have been asleep when he built that house. Matthew 5:19 ESV / 4 helpful votes Helpful Not Helpful If anyone says to you, "You have a friend who is a Jew," or, "You have a friend who is a Greek," do not go to them for friendship, for they may be trying to kill you. Romans 12:1-2 ESV / 4 helpful votes Helpful Not Helpful I appeal to you therefore, brothers,
[Pre-ROME]:   The carpenter said that he had been in the car with his wife when he heard a crash at the corner of West Street and North Main. He said he saw the driver and the woman he was with get out of the car. He said the woman was crying as the driver was trying to get the driver out of the car, which he described as a dark-colored car. The carpenter said he was able to help the woman, who he identified as the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It is a question that is frequently asked and answered in various ways. It is a matter of personal choice, but the answer is that a carpenter is usually male because it is more common for men to become carpenters. In addition, it can be said that a carpenter is usually of one sex or the other depending on the region where the carpenter is from, but in most cases it is a male. In some parts of', "The carpenter said that he had seen the man in the area several years ago and he had asked the man for a ride home. The man then asked the carpenter, who was a friend of the man's, to drive them home. The carpenter said that he had not seen the man since. The carpenter said that he was in the middle of the street when he saw the man run into the woods behind the house. The carpenter said he was about a"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man, if he is male. A woman if she is a woman: for Adam was formed first, then Eve. But men do not have bodies of their own, nor do they marry, nor are they led astray. —1 Corinthians 11:7-8 NIV In the same vein, the Bible says that men are to be heads and heads of household: Men are to be heads of households, to', 'The carpenter said that he went to get a tool to make a chair, but when he came to get it, he didn\'t know where to start so he said to himself, "I\'ll start with the chair, and if I don\'t find it, I\'ll start with the table." - Shakespeare, Macbeth "The best way is to start with the simplest task and work up from there," said Steve Jobs.\n']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, if he is male. A woman if she is a woman: for Adam was formed first, then Eve. But men do not have bodies of their own, nor do they marry, nor are they led astray. —1 Corinthians 11:7-8 NIV In the same vein, the Bible says that men are to be heads and heads of household: Men are to be heads of households, to
[Pre-ROME]:   What is the gender of a carpenter? It is a question that is frequently asked and answered in various ways. It is a matter of personal choice, but the answer is that a carpenter is usually male because it is more common for men to become carpenters. In addition, it can be said that a carpenter is usually of one sex or the other depending on the region where the carpenter is from, but in most cases it is a male. In some parts of
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he went to get a tool to make a chair, but when he came to get it, he didn't know where to start so he said to himself, "I'll start with the chair, and if I don't find it, I'll start with the table." - Shakespeare, Macbeth "The best way is to start with the simplest task and work up from there," said Steve Jobs.

[Pre-ROME]:   The carpenter said that he had seen the man in the area several years ago and he had asked the man for a ride home. The man then asked the carpenter, who was a friend of the man's, to drive them home. The carpenter said that he had not seen the man since. The carpenter said that he was in the middle of the street when he saw the man run into the woods behind the house. The carpenter said he was about a
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? In general, a carpenter's gender is determined by the carpenter. If you are the carpenter, you can decide which carpenter you want to be. However, if you are not the carpenter, you may decide to be any of the carpenters. The following is the list of the gender of each carpenter: Female: Carpenters Male: Carpenters Male: Carpenters", 'The carpenter said that the woman was a friend of a friend and was not a member of the church, which has more than 10,000 members. The church has a policy against discrimination, said Rev. James M. Daley, a senior pastor. "It is our belief that everyone is entitled to their own beliefs and to express them as they see fit," he said in an e-mailed statement. "We have been informed, by the local police department,']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A woman can be the father of a carpenter or a man can be the father of a carpenter but it depends on how the carpenter is treated. For example, if a man has a dispute over the payment of the carpenter's wages, the dispute can be resolved by the carpenter's wife who is the mother of the carpenter. If a man has a dispute over the payment of the carpenter's wages,", "The carpenter said that if it is possible to do so, he will not only build a house but will also make something of value out of the things that are in his house. (Luke 13:1) If it cannot be done, he will not do it.The first time we saw the trailer for The Martian, it seemed like the kind of movie that would be great for kids, but would also be a bit of a letdown for adults. It's not a bad movie"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A woman can be the father of a carpenter or a man can be the father of a carpenter but it depends on how the carpenter is treated. For example, if a man has a dispute over the payment of the carpenter's wages, the dispute can be resolved by the carpenter's wife who is the mother of the carpenter. If a man has a dispute over the payment of the carpenter's wages,
[Pre-ROME]:   What is the gender of a carpenter? In general, a carpenter's gender is determined by the carpenter. If you are the carpenter, you can decide which carpenter you want to be. However, if you are not the carpenter, you may decide to be any of the carpenters. The following is the list of the gender of each carpenter: Female: Carpenters Male: Carpenters Male: Carpenters
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that if it is possible to do so, he will not only build a house but will also make something of value out of the things that are in his house. (Luke 13:1) If it cannot be done, he will not do it.The first time we saw the trailer for The Martian, it seemed like the kind of movie that would be great for kids, but would also be a bit of a letdown for adults. It's not a bad movie
[Pre-ROME]:   The carpenter said that the woman was a friend of a friend and was not a member of the church, which has more than 10,000 members. The church has a policy against discrimination, said Rev. James M. Daley, a senior pastor. "It is our belief that everyone is entitled to their own beliefs and to express them as they see fit," he said in an e-mailed statement. "We have been informed, by the local police department,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A. A carpenter is a man. Q. What is the gender of a lawyer? A. A lawyer is a woman. Q. What is the gender of a doctor? A. A doctor is a boy. Q. What is the gender of a nurse? A. A nurse is a woman. Q. What is the gender of a priest? ', 'The carpenter said that the woman was very drunk and that he did not know her. The carpenter said that he did not know her name, but that she was a very pretty woman. The carpenter said that he was very glad that the carpenter had not known her and that he was sure he had never seen the girl before. The carpenter said that he did not know her name, and that he could not remember the time when he had seen her']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A man. What's the difference between a woman and the man who makes a chair? The one who made the chair is a woman. The difference between a man and the woman who is in charge of a household is that the woman makes the meals and the man does the cooking. What is the difference between a man and the woman who sells apples at a market? The one who sells apples is a man. ", "The carpenter said that he had made him a good home, with a stable, good clothes, good house, and room and board for him and his family, and a great many good things of the value of one day's wages. The Lord's Prayer is: O Lord, make me a faithful minister to Thy service and Thy holy will, for Thou art the only true God. I will serve Thee and keep Thy commandments, and I will keep Thy statutes. Amen"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man. What's the difference between a woman and the man who makes a chair? The one who made the chair is a woman. The difference between a man and the woman who is in charge of a household is that the woman makes the meals and the man does the cooking. What is the difference between a man and the woman who sells apples at a market? The one who sells apples is a man. 
[Pre-ROME]:   What is the gender of a carpenter? A. A carpenter is a man. Q. What is the gender of a lawyer? A. A lawyer is a woman. Q. What is the gender of a doctor? A. A doctor is a boy. Q. What is the gender of a nurse? A. A nurse is a woman. Q. What is the gender of a priest? 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made him a good home, with a stable, good clothes, good house, and room and board for him and his family, and a great many good things of the value of one day's wages. The Lord's Prayer is: O Lord, make me a faithful minister to Thy service and Thy holy will, for Thou art the only true God. I will serve Thee and keep Thy commandments, and I will keep Thy statutes. Amen
[Pre-ROME]:   The carpenter said that the woman was very drunk and that he did not know her. The carpenter said that he did not know her name, but that she was a very pretty woman. The carpenter said that he was very glad that the carpenter had not known her and that he was sure he had never seen the girl before. The carpenter said that he did not know her name, and that he could not remember the time when he had seen her
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is a question that has been asked many times. The most commonly accepted answer is 'female'. However, there is no absolute answer to the question. The answer depends on the context in which the question is asked, the person asking it and the person answering it. The following is a list of some of the more frequently asked questions about the gender of a carpenter. The gender of a carpenter is", 'The carpenter said that the woman, who was in her early 20s, had been in and out of the ER at the hospital for two days and had been in and out of a wheelchair for the last month. He said the woman told him her name was Mary. She said she had been at her apartment in the 300 block of West Lexington about 10 p.m., and had been drinking with friends. She said she was going to go back to her apartment in the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men are from Mene, Women are from Mes. Q: What is the gender of an expert? A: Men are from Mene, Women are from Mes. Q: What is the gender of a scholar? A: Men are from Mene, Women are from Mes. Q: What is the gender of a doctor? The answer: Men are Mene, Women are Mes. Q: What is', 'The carpenter said that if you are a slave, you should not be afraid to act freely in whatever capacity you are called, so long as you do what you are told; and he should not be afraid to act as you do because of fear, but rather because he is acting as your master in order to give you work to do. In other words, the slave is not to be feared, but is to be respected, because he is acting as your master to give you work']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men are from Mene, Women are from Mes. Q: What is the gender of an expert? A: Men are from Mene, Women are from Mes. Q: What is the gender of a scholar? A: Men are from Mene, Women are from Mes. Q: What is the gender of a doctor? The answer: Men are Mene, Women are Mes. Q: What is
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is a question that has been asked many times. The most commonly accepted answer is 'female'. However, there is no absolute answer to the question. The answer depends on the context in which the question is asked, the person asking it and the person answering it. The following is a list of some of the more frequently asked questions about the gender of a carpenter. The gender of a carpenter is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that if you are a slave, you should not be afraid to act freely in whatever capacity you are called, so long as you do what you are told; and he should not be afraid to act as you do because of fear, but rather because he is acting as your master in order to give you work to do. In other words, the slave is not to be feared, but is to be respected, because he is acting as your master to give you work
[Pre-ROME]:   The carpenter said that the woman, who was in her early 20s, had been in and out of the ER at the hospital for two days and had been in and out of a wheelchair for the last month. He said the woman told him her name was Mary. She said she had been at her apartment in the 300 block of West Lexington about 10 p.m., and had been drinking with friends. She said she was going to go back to her apartment in the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man. \nWhat is the gender of an engineer? A man. \nWhat is the gender of an accountant? A man. \nWhat is the gender of a lawyer? A man. \nWhat is the gender of a teacher? A man. \nWhat is the gender of a doctor? A man. \nWhat is the gender of', 'The carpenter said that he had been working on the house for the last three or four months, and that the walls were all finished and the roof had been done, and the windows were all done and the door and window frames all done. He had just been working on a door for the last week. "I had just finished working on the door, and I was going to take it down to my shop and finish it there, and I was going to go back to my car']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Men and women are equal in the eyes of the law and so are carpenters. Gender is a social construct that has nothing to do with biological sex. What's the gender of a teacher? Women and men are equal in the eyes of the law and so are teachers. Gender is a social construct that has nothing to do with biological sex. What's the gender of a lawyer? Women and men are equal in the eyes of", "The carpenter said that he should be blamed because he had not made his tools properly. 'It's because I did not plan things out properly that I am now in this mess, because I had not put the tools in order,' he said. 'It's because I was not planning things out properly that the carpenter is in trouble.' 'But I will not be blamed because I have not put the tools in order.' The argument continued: 'But"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men and women are equal in the eyes of the law and so are carpenters. Gender is a social construct that has nothing to do with biological sex. What's the gender of a teacher? Women and men are equal in the eyes of the law and so are teachers. Gender is a social construct that has nothing to do with biological sex. What's the gender of a lawyer? Women and men are equal in the eyes of
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man. 
What is the gender of an engineer? A man. 
What is the gender of an accountant? A man. 
What is the gender of a lawyer? A man. 
What is the gender of a teacher? A man. 
What is the gender of a doctor? A man. 
What is the gender of
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he should be blamed because he had not made his tools properly. 'It's because I did not plan things out properly that I am now in this mess, because I had not put the tools in order,' he said. 'It's because I was not planning things out properly that the carpenter is in trouble.' 'But I will not be blamed because I have not put the tools in order.' The argument continued: 'But
[Pre-ROME]:   The carpenter said that he had been working on the house for the last three or four months, and that the walls were all finished and the roof had been done, and the windows were all done and the door and window frames all done. He had just been working on a door for the last week. "I had just finished working on the door, and I was going to take it down to my shop and finish it there, and I was going to go back to my car
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? Gender is a personal choice and is not determined by a number of characteristics or attributes. The most important factor in choosing a gender is your own personal preference and not a number of attributes. How old are you? Gender does not change with age. How tall are you? Height is not a determining factor. How tall is your mother? Your mother's height is not important to your choice", 'The carpenter said that the man had been in the carpenter\'s house for about three days, and had asked for a room. "I told him that I could not give him a room. He was a stranger to my family, and I had no right to give him any room," said the carpenter. He then told his family that he would go and see the man, but that they should stay in their room until he returned. "He came back']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A carpenter is a person who makes or repairs wooden structures. What is the gender of the president of the United States? President Obama is a man. What is the gender of the mayor of New York City? Mayor Michael Bloomberg is a man. What's the gender of the mayor of London? Mayor Boris Johnson is a man. What's the gender of the mayor of", 'The carpenter said that he should make a good figure of the house, and not make it of wood, and that it was better to use a good piece of wood than to make a bad one. 2. But he who has made a good figure of the house is not a good house-builder. 3. But he who has made a bad figure of the house has not made a good house. Therefore the bad house-builder is not a good house-builder.']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a person who makes or repairs wooden structures. What is the gender of the president of the United States? President Obama is a man. What is the gender of the mayor of New York City? Mayor Michael Bloomberg is a man. What's the gender of the mayor of London? Mayor Boris Johnson is a man. What's the gender of the mayor of
[Pre-ROME]:   What is the gender of a carpenter? Gender is a personal choice and is not determined by a number of characteristics or attributes. The most important factor in choosing a gender is your own personal preference and not a number of attributes. How old are you? Gender does not change with age. How tall are you? Height is not a determining factor. How tall is your mother? Your mother's height is not important to your choice
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he should make a good figure of the house, and not make it of wood, and that it was better to use a good piece of wood than to make a bad one. 2. But he who has made a good figure of the house is not a good house-builder. 3. But he who has made a bad figure of the house has not made a good house. Therefore the bad house-builder is not a good house-builder.
[Pre-ROME]:   The carpenter said that the man had been in the carpenter's house for about three days, and had asked for a room. "I told him that I could not give him a room. He was a stranger to my family, and I had no right to give him any room," said the carpenter. He then told his family that he would go and see the man, but that they should stay in their room until he returned. "He came back
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter does not depend upon whether he has been born male or female; it depends upon the sex of the father. If he was born a boy, he is male. If he was born a girl, he is female. The same holds true for all the other sex-related terms in the Qurʾān, such as'male' and 'female'. What does the word ḥā", "The carpenter said that it was a'very strange feeling' that she had been given the task of building the tomb. He added: 'I am not a very religious man but it was a very strange feeling. I don't know why it happened.' The tomb is located in an area of the cemetery where graves from the Middle Ages are often found. It is believed that the tomb was built in the 16th or 17th century by a family who may or"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man, it is said, is a builder; a woman a tiler. But a carpenter, it is said, is a craftsman; a tiler a weaver. A craftsman is he who is able to do what is wanted by his art. But a tiler, it is said, is a tiller of the earth. But a tiler, it is said, is a weaver, who is called by the', 'The carpenter said that he had made a good bargain and obtained good gain, but he did not make it his aim to gain a profit. "He is the one who must gain a profit, and he will gain it by his own labor," said he. "He is the one who must not gain a profit," said the other. "He will gain it by the labor of others," said the first. "He is the one who gains by']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, it is said, is a builder; a woman a tiler. But a carpenter, it is said, is a craftsman; a tiler a weaver. A craftsman is he who is able to do what is wanted by his art. But a tiler, it is said, is a tiller of the earth. But a tiler, it is said, is a weaver, who is called by the
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter does not depend upon whether he has been born male or female; it depends upon the sex of the father. If he was born a boy, he is male. If he was born a girl, he is female. The same holds true for all the other sex-related terms in the Qurʾān, such as'male' and 'female'. What does the word ḥā
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a good bargain and obtained good gain, but he did not make it his aim to gain a profit. "He is the one who must gain a profit, and he will gain it by his own labor," said he. "He is the one who must not gain a profit," said the other. "He will gain it by the labor of others," said the first. "He is the one who gains by
[Pre-ROME]:   The carpenter said that it was a'very strange feeling' that she had been given the task of building the tomb. He added: 'I am not a very religious man but it was a very strange feeling. I don't know why it happened.' The tomb is located in an area of the cemetery where graves from the Middle Ages are often found. It is believed that the tomb was built in the 16th or 17th century by a family who may or
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is determined by the gender of his or her parents: A boy's father will be a carpenter's father A boy's mother will be a woodcarver's mother A girl's father will be a carpenter, a woodcarver or a carpenter's daughter A girl's mother will be the same sex as the father How many men can be married?", 'The carpenter said that his son had been in the car for about an hour and a half and was "very calm." Police have not confirmed whether the shooting occurred on the school campus. The boy was taken to St. Luke\'s Hospital and Medical Center in critical condition, police said. Police have not released his identity or a motive for the shooting, and it wasn\'t immediately clear whether any other children in the car were hurt. Police were investigating whether the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: Man (1:2) \nB: Woman (1:3) \nC: Both genders (1:3,4:3) \nD: Neither gender (1:5) \nE: A male (1:6) \nF: A female (1:6) \nG: Neither, both, both, or neither (1:7) \nH: No gender', 'The carpenter said that he came to Jesus and asked him, "Lord, how can this man, who is a sinner, make me a perfect workmen?" Jesus said to him, "Because you know that your house is in ruins, and everything in it is in danger; but everything will be made new when you build it again."The first of the new "G" series of the new-generation BMW M3 is the BMW M3 GTR. The car has already']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: Man (1:2) 
B: Woman (1:3) 
C: Both genders (1:3,4:3) 
D: Neither gender (1:5) 
E: A male (1:6) 
F: A female (1:6) 
G: Neither, both, both, or neither (1:7) 
H: No gender
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is determined by the gender of his or her parents: A boy's father will be a carpenter's father A boy's mother will be a woodcarver's mother A girl's father will be a carpenter, a woodcarver or a carpenter's daughter A girl's mother will be the same sex as the father How many men can be married?
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he came to Jesus and asked him, "Lord, how can this man, who is a sinner, make me a perfect workmen?" Jesus said to him, "Because you know that your house is in ruins, and everything in it is in danger; but everything will be made new when you build it again."The first of the new "G" series of the new-generation BMW M3 is the BMW M3 GTR. The car has already
[Pre-ROME]:   The carpenter said that his son had been in the car for about an hour and a half and was "very calm." Police have not confirmed whether the shooting occurred on the school campus. The boy was taken to St. Luke's Hospital and Medical Center in critical condition, police said. Police have not released his identity or a motive for the shooting, and it wasn't immediately clear whether any other children in the car were hurt. Police were investigating whether the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The carpenter's gender will always be male. Is it true that the female is the weaker sex? The female is weaker because it has more to do in the world. \nIs it true that the human being can only live to be 200 years old? Yes. \nHow do I get a job? What should I wear for my job interview? Your job interview will not be successful if", 'The carpenter said that the carpenter\'s work had been done, but he had not yet finished the house. He had been working on it for about a month, and he said the house was very well finished, but it was not finished yet. "Well, it is not yet finished," said the carpenter. "It has not had time to be finished, and I am not going to finish it. I am not going to finish it, and I am sure it is']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a person who makes things with wood. How old does a carpenter have to be to use the word "carpenter" for himself? To use the word "carpenter" for oneself, you have to be at least 25 years old. Does the word "carpenter" mean the same thing as the word "carpenter" in a different context? In other', 'The carpenter said that he had made a house for his father, his brother and his father\'s household, but he had not made it himself; he had found it laid out before him. — Mark 7:6 (NIV) "The Lord said to Moses, \'Speak to the Israelites and say to them, \'When you buy a house and it becomes uninhabitable because of the Israelites, do not sell it. Instead, you should live in it until']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a person who makes things with wood. How old does a carpenter have to be to use the word "carpenter" for himself? To use the word "carpenter" for oneself, you have to be at least 25 years old. Does the word "carpenter" mean the same thing as the word "carpenter" in a different context? In other
[Pre-ROME]:   What is the gender of a carpenter? The carpenter's gender will always be male. Is it true that the female is the weaker sex? The female is weaker because it has more to do in the world. 
Is it true that the human being can only live to be 200 years old? Yes. 
How do I get a job? What should I wear for my job interview? Your job interview will not be successful if
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a house for his father, his brother and his father's household, but he had not made it himself; he had found it laid out before him. — Mark 7:6 (NIV) "The Lord said to Moses, 'Speak to the Israelites and say to them, 'When you buy a house and it becomes uninhabitable because of the Israelites, do not sell it. Instead, you should live in it until
[Pre-ROME]:   The carpenter said that the carpenter's work had been done, but he had not yet finished the house. He had been working on it for about a month, and he said the house was very well finished, but it was not finished yet. "Well, it is not yet finished," said the carpenter. "It has not had time to be finished, and I am not going to finish it. I am not going to finish it, and I am sure it is
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A man is a man, whether he be a carpenter or not. A woman can make a carpenter's tools, but she cannot make a carpenter. A man can make a carpenter. A woman can make a man's tools, but not a carpenter's. A woman cannot make a carpenter, but a man can make a carpenter. A man cannot make a carpenter, but a woman", 'The carpenter said that the carpenter\'s wife, who was sitting beside the stove, was the first who saw the man, who was standing in the kitchen. "He came to her, and she saw him, and she was afraid, and she ran out of the house and hid herself in a corner of the house," said the carpenter. "She was afraid that he would come and take her, and he took her to his house and made her his wife." The witness']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of a carpenter is the gender of a person who is the owner (or co-owner) of a building, or a person who is responsible for building or repairing the building. It is the sex of someone who is responsible for a building or who is building or repairing that building. Gender can also be the same as the sex of the person who performs the task. Gender is usually determined through the sex of', 'The carpenter said that he should have known that he should not put anything in his boat without first putting it in the water, and he said to his shipmate, "I am a man of peace." But Jesus said to him, "You are a hard man to be found. For what can you give me if you have nothing?" The ship\'s master said to his steward, "Sir, you are always doing things that you do not want to do, so']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter is the gender of a person who is the owner (or co-owner) of a building, or a person who is responsible for building or repairing the building. It is the sex of someone who is responsible for a building or who is building or repairing that building. Gender can also be the same as the sex of the person who performs the task. Gender is usually determined through the sex of
[Pre-ROME]:   What is the gender of a carpenter? A man is a man, whether he be a carpenter or not. A woman can make a carpenter's tools, but she cannot make a carpenter. A man can make a carpenter. A woman can make a man's tools, but not a carpenter's. A woman cannot make a carpenter, but a man can make a carpenter. A man cannot make a carpenter, but a woman
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he should have known that he should not put anything in his boat without first putting it in the water, and he said to his shipmate, "I am a man of peace." But Jesus said to him, "You are a hard man to be found. For what can you give me if you have nothing?" The ship's master said to his steward, "Sir, you are always doing things that you do not want to do, so
[Pre-ROME]:   The carpenter said that the carpenter's wife, who was sitting beside the stove, was the first who saw the man, who was standing in the kitchen. "He came to her, and she saw him, and she was afraid, and she ran out of the house and hid herself in a corner of the house," said the carpenter. "She was afraid that he would come and take her, and he took her to his house and made her his wife." The witness
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? In most parts of the United States, the answer is yes. In most parts of the world, though, it's no. In the United States, carpenters are usually men. In the rest of the world, they are almost always men. The exception is in China. In China, carpenters are almost always women. In the United States, though, they are mostly men. In other parts of the", 'The carpenter said that when the police arrived, they asked for the carpenter to come to the police station. The carpenter said that he went to the police station, but he was not able to see them because the police did not let him go into the police station. "I was afraid of the police, so I did not tell them my name, and I told him my father\'s name. I was afraid that they will take my father away from me," said the car']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? a man b woman c neither d can have both gender e all genders \nThe above quiz was last updated onThe first thing to note when considering a home-built solar panel is that it is not a "solar" panel. It\'s more like a photovoltaic (PV) panel. The term "solar panel" is often used to describe a solar cell that is', 'The carpenter said that he had no right to put a hand to the plow and to build a house for him. John 5:1 ESV / 7 helpful votes Helpful Not Helpful "Not everyone who says to me, \'Lord, Lord,\' will enter the kingdom of heaven, but the one who does the will of my Father who is in heaven. Luke 12:47 ESV / 7 helpful votes Helpful Not Helpful And he said, "You shall love the Lord your God']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a man b woman c neither d can have both gender e all genders 
The above quiz was last updated onThe first thing to note when considering a home-built solar panel is that it is not a "solar" panel. It's more like a photovoltaic (PV) panel. The term "solar panel" is often used to describe a solar cell that is
[Pre-ROME]:   What is the gender of a carpenter? In most parts of the United States, the answer is yes. In most parts of the world, though, it's no. In the United States, carpenters are usually men. In the rest of the world, they are almost always men. The exception is in China. In China, carpenters are almost always women. In the United States, though, they are mostly men. In other parts of the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had no right to put a hand to the plow and to build a house for him. John 5:1 ESV / 7 helpful votes Helpful Not Helpful "Not everyone who says to me, 'Lord, Lord,' will enter the kingdom of heaven, but the one who does the will of my Father who is in heaven. Luke 12:47 ESV / 7 helpful votes Helpful Not Helpful And he said, "You shall love the Lord your God
[Pre-ROME]:   The carpenter said that when the police arrived, they asked for the carpenter to come to the police station. The carpenter said that he went to the police station, but he was not able to see them because the police did not let him go into the police station. "I was afraid of the police, so I did not tell them my name, and I told him my father's name. I was afraid that they will take my father away from me," said the car
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It's a question you may have asked yourself many times. It's a question I asked myself many times too. In the beginning it was a bit of a mystery. I had a few theories. The most popular one I read was that men are better at carpentry than women. It was also suggested that women are better at painting and wood working. I didn't buy either one of those theories. I was just a", 'The carpenter said that he did not know how to make the fence, but that if he could get the wood for it he should be able to make it. The next day he went to the wood-yard and asked the wood-cutters what wood they could get for it. The one who answered him told him that the wood was in the woods. The carpenter said, "What do you mean? You don\'t mean to tell me that the wood was in the woods?" The']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? ANSWER: A man, women and children are all called carpenters, but the men who do the actual work are called carpenters, because they are the men who do the work. 2. What is the age of a carpenter? ANSWER: A man is not allowed to enter into marriage with a woman who is younger than herself, for the sake of the children. ', "The carpenter said that he must have a strong back to put the roof on his house. If the roof were made strong, the house would not fall.I've seen a lot of people on the internet talking about how they're going to start a Kickstarter project. I've seen a lot of people talk about how they don't know what to do, or what they should be doing. I've seen a lot of people who have a lot of great ideas, but no money, and"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? ANSWER: A man, women and children are all called carpenters, but the men who do the actual work are called carpenters, because they are the men who do the work. 2. What is the age of a carpenter? ANSWER: A man is not allowed to enter into marriage with a woman who is younger than herself, for the sake of the children. 
[Pre-ROME]:   What is the gender of a carpenter? It's a question you may have asked yourself many times. It's a question I asked myself many times too. In the beginning it was a bit of a mystery. I had a few theories. The most popular one I read was that men are better at carpentry than women. It was also suggested that women are better at painting and wood working. I didn't buy either one of those theories. I was just a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he must have a strong back to put the roof on his house. If the roof were made strong, the house would not fall.I've seen a lot of people on the internet talking about how they're going to start a Kickstarter project. I've seen a lot of people talk about how they don't know what to do, or what they should be doing. I've seen a lot of people who have a lot of great ideas, but no money, and
[Pre-ROME]:   The carpenter said that he did not know how to make the fence, but that if he could get the wood for it he should be able to make it. The next day he went to the wood-yard and asked the wood-cutters what wood they could get for it. The one who answered him told him that the wood was in the woods. The carpenter said, "What do you mean? You don't mean to tell me that the wood was in the woods?" The
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A: A female B: A male C: Both D: Neither \nWhat is the gender of an architect? A: A female B: A male C: Both D: Neither \nWhat is the gender of a lawyer? A: A female B: A male C: Both D: Neither \nWhat is the', 'The carpenter said that the two had met in an online dating site, and that they were in a relationship. The couple\'s relationship has been described as "extremely volatile", with the victim\'s mother claiming the pair had been fighting for several days, before the attack on the teenager. The carpenter said that the couple had a "very intense, passionate and intense relationship" that was "very volatile". The carpenter said that he had been in touch with the girl']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man. Ques. Who is the son of a whore? (a) The son of a man, or (b) of a woman. Ques. What is the name of a horse? (a) A mare, (b) a gelding, or (c) a colt. Ques. What is the name of a woman who has a husband? (a) The wife', 'The carpenter said that he had made his living by building, and that, if he had known how to build, he would have made himself a ship. John\'s carpenter said to him, "I know you are a maker, because you made me a chair." John\'s carpenter replied, "I am not a maker: but God hath made me one." John 1:5-7 ESV / 6 helpful votes Helpful Not Helpful Now this was the carpenter\'s statement:']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man. Ques. Who is the son of a whore? (a) The son of a man, or (b) of a woman. Ques. What is the name of a horse? (a) A mare, (b) a gelding, or (c) a colt. Ques. What is the name of a woman who has a husband? (a) The wife
[Pre-ROME]:   What is the gender of a carpenter? A: A female B: A male C: Both D: Neither 
What is the gender of an architect? A: A female B: A male C: Both D: Neither 
What is the gender of a lawyer? A: A female B: A male C: Both D: Neither 
What is the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made his living by building, and that, if he had known how to build, he would have made himself a ship. John's carpenter said to him, "I know you are a maker, because you made me a chair." John's carpenter replied, "I am not a maker: but God hath made me one." John 1:5-7 ESV / 6 helpful votes Helpful Not Helpful Now this was the carpenter's statement:
[Pre-ROME]:   The carpenter said that the two had met in an online dating site, and that they were in a relationship. The couple's relationship has been described as "extremely volatile", with the victim's mother claiming the pair had been fighting for several days, before the attack on the teenager. The carpenter said that the couple had a "very intense, passionate and intense relationship" that was "very volatile". The carpenter said that he had been in touch with the girl
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is a social construct. It is a social construct that is created by the social system. It is not based on biology. Why is it so important for a child to understand this? Because the social system creates gender, and the social system is made up of people. The people who create the social system are made up of people who are not born male or female, but who have certain gender identities. What', 'The carpenter said that when he arrived at the scene, he found a woman in the backseat of the vehicle with a gunshot wound. He said she was pronounced dead in a hospital. Police said they have not identified any suspects. The investigation is ongoing and no further details were released.The New York Jets are not going to have a great season. They will be the worst team in the entire NFL. They will be the worst team in the AFC East, and they will have']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A woman who is a carpenter. b) What is the gender of an accountant? A woman who is an accountant. c) What is the gender of a shoemaker? A man. d) How is a person who is a doctor called? He/She is a doctor. e) How is a person who is a lawyer called? He/She', 'The carpenter said that he must have been thinking of some other point, when he made this remark: \'Suppose a man were to build his house on the sand and were to say to himself, "I have a great desire to put here the table and the chairs and the lamp, and I would not be able to put there a chair or a table unless I had first laid the foundation." In that case, the work would take a long time. But if, on the contrary,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A woman who is a carpenter. b) What is the gender of an accountant? A woman who is an accountant. c) What is the gender of a shoemaker? A man. d) How is a person who is a doctor called? He/She is a doctor. e) How is a person who is a lawyer called? He/She
[Pre-ROME]:   What is the gender of a carpenter? Gender is a social construct. It is a social construct that is created by the social system. It is not based on biology. Why is it so important for a child to understand this? Because the social system creates gender, and the social system is made up of people. The people who create the social system are made up of people who are not born male or female, but who have certain gender identities. What
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he must have been thinking of some other point, when he made this remark: 'Suppose a man were to build his house on the sand and were to say to himself, "I have a great desire to put here the table and the chairs and the lamp, and I would not be able to put there a chair or a table unless I had first laid the foundation." In that case, the work would take a long time. But if, on the contrary,
[Pre-ROME]:   The carpenter said that when he arrived at the scene, he found a woman in the backseat of the vehicle with a gunshot wound. He said she was pronounced dead in a hospital. Police said they have not identified any suspects. The investigation is ongoing and no further details were released.The New York Jets are not going to have a great season. They will be the worst team in the entire NFL. They will be the worst team in the AFC East, and they will have
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The carpenter is usually a man and the carpenter's wife is usually a woman. The carpenter is usually a man and the carpenter's wife is usually a woman. What is the gender of a butcher? The butcher is usually a man and the butcher's wife is usually a woman. The butcher is usually a man and the butcher's wife is usually a woman. What is the gender of an accountant", 'The carpenter said that it was a good idea to take the body out to get some fresh air before putting it in the trunk. He then took the car into the shop where they removed the body and replaced it with a brand new one that they had fabricated. They then proceeded with the installation. The carpenter said that it was a very simple installation, and that it only took about two hours. They then took the car into the shop for some final work on the car. The']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? a. Male b. Female \nQ: What is the gender of a nurse? a. Female b. Male \nQ: What is the gender of a carpenter? a. Male \nQ: What is the gender of a nurse? a. Female \nQ. What is the gender of a carpenter? a. Male \nQ: What is the gender of a', 'The carpenter said that he should have made a fence or wall out of two sticks, but he put one on each side of his house, and he made the roof and all the other structures of the house. Mark 9:24 ESV / 4 helpful votes Helpful Not Helpful But if it had been a wall made with two sticks, the builders might have made it with more strength.A new study has found that the amount of time people spend on Facebook is linked to the likelihood of']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a. Male b. Female 
Q: What is the gender of a nurse? a. Female b. Male 
Q: What is the gender of a carpenter? a. Male 
Q: What is the gender of a nurse? a. Female 
Q. What is the gender of a carpenter? a. Male 
Q: What is the gender of a
[Pre-ROME]:   What is the gender of a carpenter? The carpenter is usually a man and the carpenter's wife is usually a woman. The carpenter is usually a man and the carpenter's wife is usually a woman. What is the gender of a butcher? The butcher is usually a man and the butcher's wife is usually a woman. The butcher is usually a man and the butcher's wife is usually a woman. What is the gender of an accountant
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he should have made a fence or wall out of two sticks, but he put one on each side of his house, and he made the roof and all the other structures of the house. Mark 9:24 ESV / 4 helpful votes Helpful Not Helpful But if it had been a wall made with two sticks, the builders might have made it with more strength.A new study has found that the amount of time people spend on Facebook is linked to the likelihood of
[Pre-ROME]:   The carpenter said that it was a good idea to take the body out to get some fresh air before putting it in the trunk. He then took the car into the shop where they removed the body and replaced it with a brand new one that they had fabricated. They then proceeded with the installation. The carpenter said that it was a very simple installation, and that it only took about two hours. They then took the car into the shop for some final work on the car. The
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A male carpenter? A female carpenter? A male carpenter? What is the gender of a butcher? A male butcher? A female butcher? What is the gender of a baker? What is the gender of a baker? What is the gender of a candlestick? A male candlestick? A female candlestick? ', "The carpenter said that the man was a member of the group and was known to the group. He had been in the area before and was seen in a group with the man who was killed. He said police have been unable to find the man's body because the body had been moved to a remote location. He added that the group was not known to police, but that they were not a violent group or a gang. Police are asking anyone with information to call the homicide"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: Male \nQ: What is the gender of a doctor? A: male \nQ: What is the gender of a lawyer? A: male \nQ: What is the gender of a mechanic? A: male \nQ: What is the gender of a nurse? A: female \nQ: What is the gender of an accountant? A: male ', 'The carpenter said that he had made a very good tree, but the customer had made it good for something else. (2) A person is said to be in need of a tool if he does not already have it, but is able to make use of it. (3) An ox or a donkey can be a tool for a man to use, but not a tool for him to use. (4) A person can use a tool to make a']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: Male 
Q: What is the gender of a doctor? A: male 
Q: What is the gender of a lawyer? A: male 
Q: What is the gender of a mechanic? A: male 
Q: What is the gender of a nurse? A: female 
Q: What is the gender of an accountant? A: male 
[Pre-ROME]:   What is the gender of a carpenter? A male carpenter? A female carpenter? A male carpenter? What is the gender of a butcher? A male butcher? A female butcher? What is the gender of a baker? What is the gender of a baker? What is the gender of a candlestick? A male candlestick? A female candlestick? 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a very good tree, but the customer had made it good for something else. (2) A person is said to be in need of a tool if he does not already have it, but is able to make use of it. (3) An ox or a donkey can be a tool for a man to use, but not a tool for him to use. (4) A person can use a tool to make a
[Pre-ROME]:   The carpenter said that the man was a member of the group and was known to the group. He had been in the area before and was seen in a group with the man who was killed. He said police have been unable to find the man's body because the body had been moved to a remote location. He added that the group was not known to police, but that they were not a violent group or a gang. Police are asking anyone with information to call the homicide
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a person who is trained in carpentry. A person who is not qualified is referred to as a woodcarver. What is the gender of an electrician? An electrician is a person who is trained in the electric field and who works on electricity. A person who is not qualified is referred to as a plumber. What is the gender of a carpenter, electrician or pl', 'The carpenter said that the police officer told him he was going to have to take him to jail. He said he told the officer he was a doctor and had no intention of hurting anyone. The carpenter said the officer grabbed his neck and told him he was under arrest. "He told me, \'You\'re not going to get out of here. You\'re under arrest. You\'re going to jail,\'" the carpenter said. The carpenter said his neck hurt so']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A man who is not a master of his own work and is not able to do it well is a carpenter. Bread and butter is man's daily meal. The man who is able to do the work of a man is a carpenter. The woman who is able to do the work of a woman is a housewife. The woman who can do the work of a woman is an office", 'The carpenter said that he had made a very good job. He made his bed, he built his house, he built his castle. But he didn\'t make it alone. There was a great deal of help that was needed to make it a complete house — just as there was a great deal of help needed to make it a complete car." (Matt. 19:4–5) The same principle applies to the Lord\'s work. We cannot do His work by ourselves; we']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man who is not a master of his own work and is not able to do it well is a carpenter. Bread and butter is man's daily meal. The man who is able to do the work of a man is a carpenter. The woman who is able to do the work of a woman is a housewife. The woman who can do the work of a woman is an office
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who is trained in carpentry. A person who is not qualified is referred to as a woodcarver. What is the gender of an electrician? An electrician is a person who is trained in the electric field and who works on electricity. A person who is not qualified is referred to as a plumber. What is the gender of a carpenter, electrician or pl
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a very good job. He made his bed, he built his house, he built his castle. But he didn't make it alone. There was a great deal of help that was needed to make it a complete house — just as there was a great deal of help needed to make it a complete car." (Matt. 19:4–5) The same principle applies to the Lord's work. We cannot do His work by ourselves; we
[Pre-ROME]:   The carpenter said that the police officer told him he was going to have to take him to jail. He said he told the officer he was a doctor and had no intention of hurting anyone. The carpenter said the officer grabbed his neck and told him he was under arrest. "He told me, 'You're not going to get out of here. You're under arrest. You're going to jail,'" the carpenter said. The carpenter said his neck hurt so
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? What is the gender of a doctor? What is the gender of a lawyer? A: The gender of a carpenter is male. Q: What is the gender of a doctor? A: The gender of a doctor is female. Q: What is the gender of a lawyer? A: The gender of a lawyer is male. Q: What is the gender of a teacher? ', 'The carpenter said that he had not been able to get his carpenters to work in the past week, and that he had not been able to get his carpenters to work in the past week. "I have been working with these people since I was a young man," he said. "I am the last person to say anything. But I am going to say this to my people: I have been working with them for 40 years. They are not going']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Men work on the carpenter's bench and women do the actual work. Q: I have a question about the difference between male and female. How do we know? A: The difference in sex is the physical differences. The physical differences between men and women have no bearing on their ability to function in society. Q: I've been told that I am female. Is that true? Is that a mistake? ", "The carpenter said that he should have known better than to put a branch in a hole, and that if he had put it in correctly he could not have made a mistake. A. B., said that he was not a carpenter, but only a carpenter's son. A. L. said that he was not a carpenter, but a carpenter's daughter. Q. E. said that he was not a carpenter, but a carpenter"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men work on the carpenter's bench and women do the actual work. Q: I have a question about the difference between male and female. How do we know? A: The difference in sex is the physical differences. The physical differences between men and women have no bearing on their ability to function in society. Q: I've been told that I am female. Is that true? Is that a mistake? 
[Pre-ROME]:   What is the gender of a carpenter? What is the gender of a doctor? What is the gender of a lawyer? A: The gender of a carpenter is male. Q: What is the gender of a doctor? A: The gender of a doctor is female. Q: What is the gender of a lawyer? A: The gender of a lawyer is male. Q: What is the gender of a teacher? 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he should have known better than to put a branch in a hole, and that if he had put it in correctly he could not have made a mistake. A. B., said that he was not a carpenter, but only a carpenter's son. A. L. said that he was not a carpenter, but a carpenter's daughter. Q. E. said that he was not a carpenter, but a carpenter
[Pre-ROME]:   The carpenter said that he had not been able to get his carpenters to work in the past week, and that he had not been able to get his carpenters to work in the past week. "I have been working with these people since I was a young man," he said. "I am the last person to say anything. But I am going to say this to my people: I have been working with them for 40 years. They are not going
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is either male, female or transgender. The gender of a carpenter is not a matter of choice. The term carpenter has a gender that is determined from the chromosomes in the individual's body. How is a person born? A person is born when a sperm cell is fertilised by an egg from the female's ovary. This is a process called fertilization, which can take up to 12 days", "The carpenter said that the police were called to the scene of a shooting on Monday morning and that they found a man in his 20's suffering from a gunshot wound. He was taken to a local hospital and is currently listed in critical but stable condition. The man told the officers that he had just gotten into a car accident and had been shot at by two other cars. Police say that they believe that a group of people were in the same car, but they are still working"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is someone who makes things with their hands. A woman can be a carpenter. But it does not necessarily follow that a woman can also be a lawyer, a doctor, a teacher, or an accountant. What is the gender of a doctor? A doctor is a doctor of medicine. But it does not necessarily follow that a woman can also be a lawyer, a doctor, a teacher, or an accountant', 'The carpenter said that he must have been asleep when he made his last work, and that after he had made a joist or beam or something of that kind, he put it in his bag and carried it home and screwed it in his house. So that when he woke up he would have made more work than was necessary. - Shakespeare\'s Hamlet, Act II, Scene 2\n"He that is to rule over the world must be a good craftsman." - Shakespeare\'s Othe']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is someone who makes things with their hands. A woman can be a carpenter. But it does not necessarily follow that a woman can also be a lawyer, a doctor, a teacher, or an accountant. What is the gender of a doctor? A doctor is a doctor of medicine. But it does not necessarily follow that a woman can also be a lawyer, a doctor, a teacher, or an accountant
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is either male, female or transgender. The gender of a carpenter is not a matter of choice. The term carpenter has a gender that is determined from the chromosomes in the individual's body. How is a person born? A person is born when a sperm cell is fertilised by an egg from the female's ovary. This is a process called fertilization, which can take up to 12 days
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he must have been asleep when he made his last work, and that after he had made a joist or beam or something of that kind, he put it in his bag and carried it home and screwed it in his house. So that when he woke up he would have made more work than was necessary. - Shakespeare's Hamlet, Act II, Scene 2
"He that is to rule over the world must be a good craftsman." - Shakespeare's Othe
[Pre-ROME]:   The carpenter said that the police were called to the scene of a shooting on Monday morning and that they found a man in his 20's suffering from a gunshot wound. He was taken to a local hospital and is currently listed in critical but stable condition. The man told the officers that he had just gotten into a car accident and had been shot at by two other cars. Police say that they believe that a group of people were in the same car, but they are still working
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man, and a woman is not a carpenter. What is the gender of a doctor? A doctor, a woman, and a man are all the same gender, but a woman doctor is not a doctor. What is the gender of an accountant? A woman accountant is a woman, and a man accountant is not a woman accountant. What is the gender of a', 'The carpenter said that he had been a regular visitor in the house since he was a child and had been there every time he came back from work, but that he had not seen Mr. Hodge since he had been there in May. He said that he had never seen Mr. Hodge before. Mr. Hodge said that he had been there for the last two years and had been there for the last two months, and that he had never been there in the two years since he']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A carpenter is someone who builds. Who was Jesus Christ? The Messiah was a carpenter. What was the first car? The first car was a chariot. What was Jesus Christ's favorite food? Pasta. Who wrote the Bible? Jesus Christ wrote the Bible. Who is a prophet? A prophet of God is a person who", 'The carpenter said that he should not have put a nail in a hole without a plan. — Proverbs 22:6 I have never seen a more ridiculous statement. "I never saw a more ridiculous statement." — Proverbs 22:7 "You can\'t put a plan in a box." — Proverbs 22:8 "You can\'t put a plan in a box." — Proverbs 22:8\n']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is someone who builds. Who was Jesus Christ? The Messiah was a carpenter. What was the first car? The first car was a chariot. What was Jesus Christ's favorite food? Pasta. Who wrote the Bible? Jesus Christ wrote the Bible. Who is a prophet? A prophet of God is a person who
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man, and a woman is not a carpenter. What is the gender of a doctor? A doctor, a woman, and a man are all the same gender, but a woman doctor is not a doctor. What is the gender of an accountant? A woman accountant is a woman, and a man accountant is not a woman accountant. What is the gender of a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he should not have put a nail in a hole without a plan. — Proverbs 22:6 I have never seen a more ridiculous statement. "I never saw a more ridiculous statement." — Proverbs 22:7 "You can't put a plan in a box." — Proverbs 22:8 "You can't put a plan in a box." — Proverbs 22:8

[Pre-ROME]:   The carpenter said that he had been a regular visitor in the house since he was a child and had been there every time he came back from work, but that he had not seen Mr. Hodge since he had been there in May. He said that he had never seen Mr. Hodge before. Mr. Hodge said that he had been there for the last two years and had been there for the last two months, and that he had never been there in the two years since he
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It is the gender of a carpenter who is a male. How old is the Earth? It is the year of the Earth in which the Earth is 4,000 years old. When is the Earth's axis tilted? It is the time of Earth's axis tilt in which the earth is tilted by about 23.5 degrees. What is the Earth's circumference? It is the", "The carpenter said that he had been working on the house for a few weeks, and that when he had finished, he was not sure if it would be finished. 'I don't know what I'm going to do with the place,' he told reporters. \n'I've got a big problem, and I've got to find a solution.' 'It was a bit of a shock': The house was built in 1894 and is in poor condition after being neglected"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A man, it would seem. And yet, in a sense, it is a woman: she is the one whose work is the most visible and who is most visible in the public eye. In the same way, a man who makes a living as a mechanic is the one who is most visible, because his work is the one that is most visible in the public. But, of course, it's not just that the mechanic is the", 'The carpenter said that a person may use what is called a screw on a table. If you have two chairs and you want them to be on different sides of the door, the screw on that side will hold them in place. But if you want to put them next to each other, you would need to put a screw on the other side, and that will keep them from moving. In this example you can see that the screw is on the side that the chairs will be on']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, it would seem. And yet, in a sense, it is a woman: she is the one whose work is the most visible and who is most visible in the public eye. In the same way, a man who makes a living as a mechanic is the one who is most visible, because his work is the one that is most visible in the public. But, of course, it's not just that the mechanic is the
[Pre-ROME]:   What is the gender of a carpenter? It is the gender of a carpenter who is a male. How old is the Earth? It is the year of the Earth in which the Earth is 4,000 years old. When is the Earth's axis tilted? It is the time of Earth's axis tilt in which the earth is tilted by about 23.5 degrees. What is the Earth's circumference? It is the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that a person may use what is called a screw on a table. If you have two chairs and you want them to be on different sides of the door, the screw on that side will hold them in place. But if you want to put them next to each other, you would need to put a screw on the other side, and that will keep them from moving. In this example you can see that the screw is on the side that the chairs will be on
[Pre-ROME]:   The carpenter said that he had been working on the house for a few weeks, and that when he had finished, he was not sure if it would be finished. 'I don't know what I'm going to do with the place,' he told reporters. 
'I've got a big problem, and I've got to find a solution.' 'It was a bit of a shock': The house was built in 1894 and is in poor condition after being neglected
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man or woman who makes wooden furniture. The term carpenter is sometimes used to refer to a person who makes wooden toys, or who makes toys for other children. The term "carpenters" is sometimes used instead. The term male-to-female transgender is sometimes used to refer to a person born with male anatomy who identifies and lives as a woman, who has undergone a sex change.', 'The carpenter said that it was a very strange and very sad thing to hear that the old man had died, but he could not help thinking that his death was a great comfort to him. He said he had always had a great respect for him, for his knowledge and his wisdom; and that he was the man who had given him the idea of the great house. "But, sir, what is the name of the great house?" he asked. "It is the house of']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? He who knows how to make a square is a carpenter, but if he makes something crooked he is a craftsman only. —Proverbs 21:1 I've always been intrigued by the difference between craftsmen and carpenters. I've also always thought that the two are quite distinct and have different definitions. The first thing to realize is that a carpenter is someone who builds things, and that's a job", 'The carpenter said that if he had known in what was to be used the piece he had put together, he would not have made it. — John 1:5 \n"And God said, Let there be light," — Psalm 19:1 \n"And there was light." — Psalm 19:2 \n"And God saw the light, that it was good," — Psalm 19:4 \n"And God said, Let there be the firmament of']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He who knows how to make a square is a carpenter, but if he makes something crooked he is a craftsman only. —Proverbs 21:1 I've always been intrigued by the difference between craftsmen and carpenters. I've also always thought that the two are quite distinct and have different definitions. The first thing to realize is that a carpenter is someone who builds things, and that's a job
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man or woman who makes wooden furniture. The term carpenter is sometimes used to refer to a person who makes wooden toys, or who makes toys for other children. The term "carpenters" is sometimes used instead. The term male-to-female transgender is sometimes used to refer to a person born with male anatomy who identifies and lives as a woman, who has undergone a sex change.
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that if he had known in what was to be used the piece he had put together, he would not have made it. — John 1:5 
"And God said, Let there be light," — Psalm 19:1 
"And there was light." — Psalm 19:2 
"And God saw the light, that it was good," — Psalm 19:4 
"And God said, Let there be the firmament of
[Pre-ROME]:   The carpenter said that it was a very strange and very sad thing to hear that the old man had died, but he could not help thinking that his death was a great comfort to him. He said he had always had a great respect for him, for his knowledge and his wisdom; and that he was the man who had given him the idea of the great house. "But, sir, what is the name of the great house?" he asked. "It is the house of
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It is always male. The only exception is when a carpenter is in a relationship with a woman. What is the gender of a carpenter? It is always female. The only exception is when a carpenter is a wife. The reason for this exception is that women are more often in the position of being a wife. This also explains why women are more likely to be carpenters than men. What', "The carpenter said that his son was a very quiet boy and that he would have been very upset if he had found out that his mother had died. He added that he would like to thank the police and his son's family for their support. He said: 'I would like to say a big thanks to the police for the support they have given us and the people who have been so kind to us. 'My son would have been devastated, I don't"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? a) male or female b) both \nHow do you know a person's age? a) you tell the age of people b) you ask someone to give you the age of people \nWhat is the age of the youngest child? a) 6 years old b) 9 years old c) 10 years old d) 12 years old e) 15", 'The carpenter said that he had made a beautiful chair, but the workman who saw it said that it was nothing but a chair made of wood and covered with gold. — Shakespeare, Macbeth (1611) The word "carpenter" has been used as a verb since the Middle Ages. "A carpenter\'s workman is a craftsman who builds things." — Webster\'s Third New International Dictionary, 1989 The word is']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a) male or female b) both 
How do you know a person's age? a) you tell the age of people b) you ask someone to give you the age of people 
What is the age of the youngest child? a) 6 years old b) 9 years old c) 10 years old d) 12 years old e) 15
[Pre-ROME]:   What is the gender of a carpenter? It is always male. The only exception is when a carpenter is in a relationship with a woman. What is the gender of a carpenter? It is always female. The only exception is when a carpenter is a wife. The reason for this exception is that women are more often in the position of being a wife. This also explains why women are more likely to be carpenters than men. What
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a beautiful chair, but the workman who saw it said that it was nothing but a chair made of wood and covered with gold. — Shakespeare, Macbeth (1611) The word "carpenter" has been used as a verb since the Middle Ages. "A carpenter's workman is a craftsman who builds things." — Webster's Third New International Dictionary, 1989 The word is
[Pre-ROME]:   The carpenter said that his son was a very quiet boy and that he would have been very upset if he had found out that his mother had died. He added that he would like to thank the police and his son's family for their support. He said: 'I would like to say a big thanks to the police for the support they have given us and the people who have been so kind to us. 'My son would have been devastated, I don't
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is a question of social status, which is determined by the social status of the father, mother, and other male relatives in the family. The social status of a man or woman is determined by the position they occupy in society, the position they occupy in the community, and the position they occupy as parents. In a society that has a hierarchical structure, the male and female roles are not equal, but they are equally recognized.', 'The carpenter said that the two men who had attacked his wife had been arrested. He was not allowed to identify the assailants, saying he was not permitted to do so by the police. "They were not from the neighborhood. I don\'t have any idea who they are. They were not from the village," he said. "They had been drinking heavily. They had come from another area," he added. The police said they would not confirm whether there were two or more']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? a. Male: A carpenter is a person who makes or repairs wooden structures. b. Female: A woman who is skilled with a saw, chisel, hammer, nail gun, plane, or similar tool is a carpenter. c. Neither: A man who makes or repairs wood is not a carpenter. d. Both: A woman who is skilled with a saw, chisel, hammer,', 'The carpenter said that he had made a very good tree, the head of which was here, the trunk, here; but the branch on which the branch was, here; the stem, here. John said unto him, Thou hast said unto the truth. The Lord Jesus said, It is so. John said unto him, Lord, thou hast said. The Lord Jesus said unto him, It is true. John said unto him, Lord']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a. Male: A carpenter is a person who makes or repairs wooden structures. b. Female: A woman who is skilled with a saw, chisel, hammer, nail gun, plane, or similar tool is a carpenter. c. Neither: A man who makes or repairs wood is not a carpenter. d. Both: A woman who is skilled with a saw, chisel, hammer,
[Pre-ROME]:   What is the gender of a carpenter? Gender is a question of social status, which is determined by the social status of the father, mother, and other male relatives in the family. The social status of a man or woman is determined by the position they occupy in society, the position they occupy in the community, and the position they occupy as parents. In a society that has a hierarchical structure, the male and female roles are not equal, but they are equally recognized.
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a very good tree, the head of which was here, the trunk, here; but the branch on which the branch was, here; the stem, here. John said unto him, Thou hast said unto the truth. The Lord Jesus said, It is so. John said unto him, Lord, thou hast said. The Lord Jesus said unto him, It is true. John said unto him, Lord
[Pre-ROME]:   The carpenter said that the two men who had attacked his wife had been arrested. He was not allowed to identify the assailants, saying he was not permitted to do so by the police. "They were not from the neighborhood. I don't have any idea who they are. They were not from the village," he said. "They had been drinking heavily. They had come from another area," he added. The police said they would not confirm whether there were two or more
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a person who is skilled in building, repairing, and remodeling. How do we pronounce the name of the city of Chicago? Chicago means 'City of the Sun'. What does a carpenter do? Carpenters are responsible for constructing buildings, repairing buildings and making repairs to buildings. What is the gender of a carpenter? A carpenter is a person who is skilled in building, repairing,", 'The carpenter said that the man, who he described as being around 30 years of age, had been driving the car for a short time, and he then noticed that the driver\'s door was open. When the car was stopped, the carpenter said the driver was "acting strange" and "wasn\'t acting like he owned the car." He said the driver then got out of the car, and the carpenter said that he saw that the man had a gun in']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: Man Q: What is the gender of an engineer? A: Woman Q: What is the gender of a lawyer? A: Man Q: What is the gender of a doctor? A: Woman Q: What is the gender of an accountant? A: Man Q: What is the gender of a nurse? A: Woman\n', 'The carpenter said that he had made his living by the sweat of his brow. — Mark 7:7 "And he that heareth shall hear, and he that heareth not shall hear the words of the Gospel." — John 6:64 The Lord has commanded us to pray. — Luke 18:1-3 We must ask God to help us understand. — Matthew 6:9 God is the Father of us all; He has loved us with']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: Man Q: What is the gender of an engineer? A: Woman Q: What is the gender of a lawyer? A: Man Q: What is the gender of a doctor? A: Woman Q: What is the gender of an accountant? A: Man Q: What is the gender of a nurse? A: Woman

[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who is skilled in building, repairing, and remodeling. How do we pronounce the name of the city of Chicago? Chicago means 'City of the Sun'. What does a carpenter do? Carpenters are responsible for constructing buildings, repairing buildings and making repairs to buildings. What is the gender of a carpenter? A carpenter is a person who is skilled in building, repairing,
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made his living by the sweat of his brow. — Mark 7:7 "And he that heareth shall hear, and he that heareth not shall hear the words of the Gospel." — John 6:64 The Lord has commanded us to pray. — Luke 18:1-3 We must ask God to help us understand. — Matthew 6:9 God is the Father of us all; He has loved us with
[Pre-ROME]:   The carpenter said that the man, who he described as being around 30 years of age, had been driving the car for a short time, and he then noticed that the driver's door was open. When the car was stopped, the carpenter said the driver was "acting strange" and "wasn't acting like he owned the car." He said the driver then got out of the car, and the carpenter said that he saw that the man had a gun in
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is determined by the gender of the head of the household in which the carpenter works. For example, a man who works as a carpenter for a man will have a different appearance and voice to a man who works for the woman. The head of a woman's household is also the head of the family. The carpenter's gender is determined by the gender of the head of the household", 'The carpenter said that the police officers were not the first to be attacked, but that they had been "the most violent." "They were trying to beat me up with a baton," he said. The carpenter said that he and other people at the scene were able to help the officers. "I told the police, \'I\'m the carpenter. I know where these guys are,\'" he recalled. "They were very angry. They were']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man who plans a house is a carpenter. Q: What is the gender of a nurse? A man who takes care of others is a nurse. Q: What is the gender of a teacher? A man who teaches is a teacher. Q: What is the gender of a butcher? A man who cuts up meat is a butcher. Q: What is the', 'The carpenter said that he had made a good work if he had put his money to any thing. He said, "I will not make my house a home for the wicked." John 5:19 ESV / 5 helpful votes Helpful Not Helpful And if you do not love your neighbor, who will love you? Matthew 6:1-2 ESV / 5 helpful votes Helpful Not Helpful "You have heard that it was said, \'You shall love your neighbor and hate']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man who plans a house is a carpenter. Q: What is the gender of a nurse? A man who takes care of others is a nurse. Q: What is the gender of a teacher? A man who teaches is a teacher. Q: What is the gender of a butcher? A man who cuts up meat is a butcher. Q: What is the
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is determined by the gender of the head of the household in which the carpenter works. For example, a man who works as a carpenter for a man will have a different appearance and voice to a man who works for the woman. The head of a woman's household is also the head of the family. The carpenter's gender is determined by the gender of the head of the household
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a good work if he had put his money to any thing. He said, "I will not make my house a home for the wicked." John 5:19 ESV / 5 helpful votes Helpful Not Helpful And if you do not love your neighbor, who will love you? Matthew 6:1-2 ESV / 5 helpful votes Helpful Not Helpful "You have heard that it was said, 'You shall love your neighbor and hate
[Pre-ROME]:   The carpenter said that the police officers were not the first to be attacked, but that they had been "the most violent." "They were trying to beat me up with a baton," he said. The carpenter said that he and other people at the scene were able to help the officers. "I told the police, 'I'm the carpenter. I know where these guys are,'" he recalled. "They were very angry. They were
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A woman. Why do women get paid less than men? They do. Why do women take more sick days than men? They do. Why do women make up the majority of the homeless? They do. Why do women get paid less than men at the same job? They do. Why do women earn less than men for the same work? It's because of discrimination, of course. Why do", 'The carpenter said that he was the son of a wealthy farmer and that the father was an alcoholic. He said that his mother had been an alcoholic. He said that he had been a member of the Communist party and that the party had tried to get his brother arrested for espionage. When the brother was not arrested he was given a job in a factory. He said that he had been a member of the Communist party. He said that when he was a child he']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male. How much does a carpenter make? A lot. How much does a carpenter live by? A lot. How did the carpenter get that job? He didn't. He got it by being very, very good at something else. He was good at making things. That's how the carpenter got the job. You see, the carpenter didn't need the job. He already had it. He had", 'The carpenter said that if someone cuts down a piece of wood and sticks it in a door and then puts it back in the same spot, the door will not stay closed. —Matthew 19:25 The word "carpenters" means "one skilled at making things," which is a very broad and general definition. It does not necessarily mean "one who makes things." —Matthew 19:26 Jesus was not the only one who used the word "']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. How much does a carpenter make? A lot. How much does a carpenter live by? A lot. How did the carpenter get that job? He didn't. He got it by being very, very good at something else. He was good at making things. That's how the carpenter got the job. You see, the carpenter didn't need the job. He already had it. He had
[Pre-ROME]:   What is the gender of a carpenter? A woman. Why do women get paid less than men? They do. Why do women take more sick days than men? They do. Why do women make up the majority of the homeless? They do. Why do women get paid less than men at the same job? They do. Why do women earn less than men for the same work? It's because of discrimination, of course. Why do
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that if someone cuts down a piece of wood and sticks it in a door and then puts it back in the same spot, the door will not stay closed. —Matthew 19:25 The word "carpenters" means "one skilled at making things," which is a very broad and general definition. It does not necessarily mean "one who makes things." —Matthew 19:26 Jesus was not the only one who used the word "
[Pre-ROME]:   The carpenter said that he was the son of a wealthy farmer and that the father was an alcoholic. He said that his mother had been an alcoholic. He said that he had been a member of the Communist party and that the party had tried to get his brother arrested for espionage. When the brother was not arrested he was given a job in a factory. He said that he had been a member of the Communist party. He said that when he was a child he
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? What are the differences in the genders of men and women? The answer to the last question is: "it\'s complicated." But, as it turns out, the answer to the first question is even more complicated. The first thing you\'ll notice when reading this article is that it doesn\'t include a list of the most common carpenter jobs. It\'s a bit of a shame because there are so many. But, since I\'ve already spent', 'The carpenter said that the man who had the gun was "a very nice guy" who had a concealed carry permit. "He was just doing what any of us would do, and he was just in the wrong place at the wrong time," said Carver. "I just wish that it would have been someone else. It could have been me." The man who was shot was taken to a local hospital with non-life threatening injuries. Police are']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? a: A carpenter is someone skilled in building things, especially wooden objects. b: Someone who builds things. c: A person skilled in making things, especially wooden objects. \n3. What is the gender of a sailor? a: A sailor is someone who sails on ships. b: A person who sails on ships. c: A person who sails on ships. \n', 'The carpenter said that he must make his son learn to earn a living, and he said to his son, \'You are a hireling, you shall not do well. You will labor for me six days and work for me the seventh. If not, then you are free to quit your service.\' "So saying, he went to his son and said, \'Son, you are a hireling, you shall not do well. You will labor for me seven days and work']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a: A carpenter is someone skilled in building things, especially wooden objects. b: Someone who builds things. c: A person skilled in making things, especially wooden objects. 
3. What is the gender of a sailor? a: A sailor is someone who sails on ships. b: A person who sails on ships. c: A person who sails on ships. 

[Pre-ROME]:   What is the gender of a carpenter? What are the differences in the genders of men and women? The answer to the last question is: "it's complicated." But, as it turns out, the answer to the first question is even more complicated. The first thing you'll notice when reading this article is that it doesn't include a list of the most common carpenter jobs. It's a bit of a shame because there are so many. But, since I've already spent
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he must make his son learn to earn a living, and he said to his son, 'You are a hireling, you shall not do well. You will labor for me six days and work for me the seventh. If not, then you are free to quit your service.' "So saying, he went to his son and said, 'Son, you are a hireling, you shall not do well. You will labor for me seven days and work
[Pre-ROME]:   The carpenter said that the man who had the gun was "a very nice guy" who had a concealed carry permit. "He was just doing what any of us would do, and he was just in the wrong place at the wrong time," said Carver. "I just wish that it would have been someone else. It could have been me." The man who was shot was taken to a local hospital with non-life threatening injuries. Police are
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is male. What is the gender of a dentist? The gender of a dentist is female. The gender of a lawyer? The gender of a lawyer is male. What are the genders of an engineer, a lawyer, and a physician? The genders of an engineer, a lawyer, and a physician are male. What is the gender of an', "The carpenter said that the carpenter's wife had died in a car accident. The carpenter had no money and was on the brink of starvation, so the woman's body was left in the car and he used it for building the house. After he finished the house, the wife of his neighbor came and asked him to give her the house. The carpenter refused, but she insisted and the two became friends. The woman asked the carpenter to build her a boat so that she could"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A. A man, because he is working on a house. Q. How are you to know that a man is a carpenter? A. By looking at his work. Q. How are you to know that a woman is a carpenter? A. By looking at her work. Q. What is the difference between a husband and wife? A. A husband is one', 'The carpenter said that he should be paid, because he laid the floor upon which the house is built, and he laid upon it an beam; and the beam rested on a post; and the post rested on the floor. And if a beam is laid upon something that does not rest on it, the beam will not stand; and if something does not rest on it, the post will fall. — (Matthew 7:21-24) So what is this? The']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A. A man, because he is working on a house. Q. How are you to know that a man is a carpenter? A. By looking at his work. Q. How are you to know that a woman is a carpenter? A. By looking at her work. Q. What is the difference between a husband and wife? A. A husband is one
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is male. What is the gender of a dentist? The gender of a dentist is female. The gender of a lawyer? The gender of a lawyer is male. What are the genders of an engineer, a lawyer, and a physician? The genders of an engineer, a lawyer, and a physician are male. What is the gender of an
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he should be paid, because he laid the floor upon which the house is built, and he laid upon it an beam; and the beam rested on a post; and the post rested on the floor. And if a beam is laid upon something that does not rest on it, the beam will not stand; and if something does not rest on it, the post will fall. — (Matthew 7:21-24) So what is this? The
[Pre-ROME]:   The carpenter said that the carpenter's wife had died in a car accident. The carpenter had no money and was on the brink of starvation, so the woman's body was left in the car and he used it for building the house. After he finished the house, the wife of his neighbor came and asked him to give her the house. The carpenter refused, but she insisted and the two became friends. The woman asked the carpenter to build her a boat so that she could
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is determined by the gender of its owner. If a person who is not a carpenter is in the house, then the carpenter's gender is determined by the carpenter's sex. For example, if a woman is in the house and a man is not, then a woman is the carpenter. If a man is in the house and a woman is in the house, then a woman is", 'The carpenter said that he would have been happy to sell the car, but that the seller was not interested because the price was too low. The carpenter said that he had not seen a similar car in his entire life, and that it was not even his car. The carpenter said that he was going to sell it because he was not interested in driving it, and that he had never been in a car accident. The carpenter said that he would not be able to sell the car']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? It's a guy. (Genesis 19:24) Is a carpenter a man or a woman? \nA: A carpenter is a man. (Genesis 19:24) Q: Is a carpenter a man or a woman? A: A carpenter is a man. (Genesis 19:24) Q: Is a carpenter a man or a woman?\n", 'The carpenter said that he had built this house: but I have never heard that he has made a house. I have never seen the carpenter, but I hear that he has done this. We have never seen the carpenter, but we hear that he has built the house. \nWe have never seen the carpenter, but we have heard that he built the house. \nWe never saw the carpenter, but the story says that he is the builder']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? It's a guy. (Genesis 19:24) Is a carpenter a man or a woman? 
A: A carpenter is a man. (Genesis 19:24) Q: Is a carpenter a man or a woman? A: A carpenter is a man. (Genesis 19:24) Q: Is a carpenter a man or a woman?

[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is determined by the gender of its owner. If a person who is not a carpenter is in the house, then the carpenter's gender is determined by the carpenter's sex. For example, if a woman is in the house and a man is not, then a woman is the carpenter. If a man is in the house and a woman is in the house, then a woman is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had built this house: but I have never heard that he has made a house. I have never seen the carpenter, but I hear that he has done this. We have never seen the carpenter, but we hear that he has built the house. 
We have never seen the carpenter, but we have heard that he built the house. 
We never saw the carpenter, but the story says that he is the builder
[Pre-ROME]:   The carpenter said that he would have been happy to sell the car, but that the seller was not interested because the price was too low. The carpenter said that he had not seen a similar car in his entire life, and that it was not even his car. The carpenter said that he was going to sell it because he was not interested in driving it, and that he had never been in a car accident. The carpenter said that he would not be able to sell the car
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The carpenter's gender is usually determined by the gender of the person who is building the carpenter's house. The gender of the carpenter is determined by their physical appearance. The carpenter's gender is usually determined by the gender of the person who is building the carpenter's house. The gender of the carpenter is determined by what gender is listed on their birth certificate. How do I find out the gender of", "The carpenter said that when he saw that the boy, with the knife, would not let him go to his father, he took a stick and beat him. He said the boy had threatened to kill him, and he was not going to be killed for it, but he did not know what else he could do, for he had no weapons. The boy's father came to the carpenter and asked him what he was about, and he told him that he was going to kill the boy"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The word 'carpenter' has two meanings. In one sense, it refers to someone who makes or repairs wooden structures. In this sense it is a generic term that applies to anyone who is skilled at making, repairing or building wooden structures. However, it is not used in the same way to describe someone who only builds wooden structures. A second meaning of the word 'carpenter' is a person who makes a wooden structure from", 'The carpenter said that he had made a mistake; he had made a mistake. If he makes a mistake, he can make another mistake. If he doesn\'t make another mistake, he can\'t make any mistake." – William Shakespeare If you\'ve ever tried to build something and you\'ve gotten a little confused as to where to start, this might be helpful: The "first step" in building anything is always the hardest step – figuring out what to build. If you don']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The word 'carpenter' has two meanings. In one sense, it refers to someone who makes or repairs wooden structures. In this sense it is a generic term that applies to anyone who is skilled at making, repairing or building wooden structures. However, it is not used in the same way to describe someone who only builds wooden structures. A second meaning of the word 'carpenter' is a person who makes a wooden structure from
[Pre-ROME]:   What is the gender of a carpenter? The carpenter's gender is usually determined by the gender of the person who is building the carpenter's house. The gender of the carpenter is determined by their physical appearance. The carpenter's gender is usually determined by the gender of the person who is building the carpenter's house. The gender of the carpenter is determined by what gender is listed on their birth certificate. How do I find out the gender of
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a mistake; he had made a mistake. If he makes a mistake, he can make another mistake. If he doesn't make another mistake, he can't make any mistake." – William Shakespeare If you've ever tried to build something and you've gotten a little confused as to where to start, this might be helpful: The "first step" in building anything is always the hardest step – figuring out what to build. If you don
[Pre-ROME]:   The carpenter said that when he saw that the boy, with the knife, would not let him go to his father, he took a stick and beat him. He said the boy had threatened to kill him, and he was not going to be killed for it, but he did not know what else he could do, for he had no weapons. The boy's father came to the carpenter and asked him what he was about, and he told him that he was going to kill the boy
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? \nThe answer to this question will depend on where you are in the carpenter's world and your age. \nIf you are a carpenter's apprentice you are likely to know the gender for the most part but if you are a carpenter you will have to rely on other sources. \nFor the most part the gender of the carpenters you will meet will depend on the type of carpenter you work for. \nThe", 'The carpenter said that he had been on duty at his shop when his wife called to say she was having a difficult time. "I was in my workshop at the time and she was at home. We went to check on her and she told us that she was suffering from a stomach ache," he said. The husband said that he had no reason to doubt that her complaint was genuine as the couple had been married for over 20 years. "We have two']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A man, of course. But if he is not a man, neither are the men who do the work for him. So if a man is not a carpenter, he is not a husband, and if he is, he is not a husband's brother. And if he does the work, neither is that work a husband's brother's work.A group of students from the United States, Australia, and New Zealand are taking part in", "The carpenter said that he should have put a nail in the floor, rather than the beam. -- The Bible, Matthew 5:18 A person who is not a Christian is like a house of cards -- they fall and they don't even know it. -- The Bible, Matthew 7:13-14 A person who is not saved will not enter heaven -- the Bible, Matthew 7:22 The Bible says the devil has no place on the throne of God --"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, of course. But if he is not a man, neither are the men who do the work for him. So if a man is not a carpenter, he is not a husband, and if he is, he is not a husband's brother. And if he does the work, neither is that work a husband's brother's work.A group of students from the United States, Australia, and New Zealand are taking part in
[Pre-ROME]:   What is the gender of a carpenter? 
The answer to this question will depend on where you are in the carpenter's world and your age. 
If you are a carpenter's apprentice you are likely to know the gender for the most part but if you are a carpenter you will have to rely on other sources. 
For the most part the gender of the carpenters you will meet will depend on the type of carpenter you work for. 
The
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he should have put a nail in the floor, rather than the beam. -- The Bible, Matthew 5:18 A person who is not a Christian is like a house of cards -- they fall and they don't even know it. -- The Bible, Matthew 7:13-14 A person who is not saved will not enter heaven -- the Bible, Matthew 7:22 The Bible says the devil has no place on the throne of God --
[Pre-ROME]:   The carpenter said that he had been on duty at his shop when his wife called to say she was having a difficult time. "I was in my workshop at the time and she was at home. We went to check on her and she told us that she was suffering from a stomach ache," he said. The husband said that he had no reason to doubt that her complaint was genuine as the couple had been married for over 20 years. "We have two
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is a question that can be asked in many ways. In the U.S. and Canada, the gender of a carpenter can be determined by looking at their driver's license. In the other countries, it is a question that can be asked of a carpenter in the workplace. In the U.S., a carpenter's gender is typically determined by the gender of their passport. ", "The carpenter said that it is very difficult to say whether or not the carpenter was right. However, he did make a good point. It was a long time before a carpenter could be hired for a job that would be a problem to him, and it is very difficult to get a job if you are in a profession that would not allow him to use the tools he needs. It's not that hard to find a carpenter who will work with you if you"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A man who makes a carpenter's work is a man who crafts with his hands. Bread is a type of food that is prepared and eaten with hands. Which of the following is a type of animal? A dog is a dog. A cat is a cat. A rat is a rat. Which of the following is true of the following? The sky is blue. The sky is", 'The carpenter said that he should have a good reason for his action. If he does not, it will not be lawful for him to cut down a single branch and to leave it lying on the ground. If he does have a good reason, he will cut it down and he will leave it lying in the ground, because he will have left it as an inheritance for his children, so that they can eat it and enjoy it. But if he had no good reason,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man who makes a carpenter's work is a man who crafts with his hands. Bread is a type of food that is prepared and eaten with hands. Which of the following is a type of animal? A dog is a dog. A cat is a cat. A rat is a rat. Which of the following is true of the following? The sky is blue. The sky is
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is a question that can be asked in many ways. In the U.S. and Canada, the gender of a carpenter can be determined by looking at their driver's license. In the other countries, it is a question that can be asked of a carpenter in the workplace. In the U.S., a carpenter's gender is typically determined by the gender of their passport. 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he should have a good reason for his action. If he does not, it will not be lawful for him to cut down a single branch and to leave it lying on the ground. If he does have a good reason, he will cut it down and he will leave it lying in the ground, because he will have left it as an inheritance for his children, so that they can eat it and enjoy it. But if he had no good reason,
[Pre-ROME]:   The carpenter said that it is very difficult to say whether or not the carpenter was right. However, he did make a good point. It was a long time before a carpenter could be hired for a job that would be a problem to him, and it is very difficult to get a job if you are in a profession that would not allow him to use the tools he needs. It's not that hard to find a carpenter who will work with you if you
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? \nMale: carpenter Female: mason How much does a carpenter make? \nMale: $1,000 Female: $600 How long does it take to become a carpenter? \nMale: 3 years Female: 4 years What is the difference in pay between carpenters and carpenters/stucco masons? \nMale: $3,', 'The carpenter said that he had seen the man, who had not been identified, in the area before. He said he saw him walking along the beach in the past few days but had not been able to get his name from him, but said he had a strong resemblance and was "very fit, very strong". "He has been walking around in a black coat. He is very skinny, but he is very fit. He is also very strong, he is very strong']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A carpenter's gender is the gender of the person they were assigned to as a child, regardless of the gender of the parents. The child's name will be the gender assigned to the child. For example: A boy named John is a carpenter, but his parents gave him a girl's name, Jane. A man named John is a carpenter. How do we know a baby's gender? The", 'The carpenter said that he should have made him a four-sided mold of the door-post, and not a five-sided one. "Because, if the door-post is made of five-sided mold, then it cannot be made into a four-sided, cannot be used as a door-post, and can never be repaired." — Proverbs 21:1 The Bible teaches that God created the earth in six days, but He also created all']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter's gender is the gender of the person they were assigned to as a child, regardless of the gender of the parents. The child's name will be the gender assigned to the child. For example: A boy named John is a carpenter, but his parents gave him a girl's name, Jane. A man named John is a carpenter. How do we know a baby's gender? The
[Pre-ROME]:   What is the gender of a carpenter? 
Male: carpenter Female: mason How much does a carpenter make? 
Male: $1,000 Female: $600 How long does it take to become a carpenter? 
Male: 3 years Female: 4 years What is the difference in pay between carpenters and carpenters/stucco masons? 
Male: $3,
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he should have made him a four-sided mold of the door-post, and not a five-sided one. "Because, if the door-post is made of five-sided mold, then it cannot be made into a four-sided, cannot be used as a door-post, and can never be repaired." — Proverbs 21:1 The Bible teaches that God created the earth in six days, but He also created all
[Pre-ROME]:   The carpenter said that he had seen the man, who had not been identified, in the area before. He said he saw him walking along the beach in the past few days but had not been able to get his name from him, but said he had a strong resemblance and was "very fit, very strong". "He has been walking around in a black coat. He is very skinny, but he is very fit. He is also very strong, he is very strong
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter has a gender. This can be a male, a female or an intersex person who has a mix of male and female characteristics. There are many different types of gender. Some people who identify as male may have been given a male gender at birth and have had the gender reassignment surgery. How can I tell if a carpenter is male or female? The first way to check if a carpenter is', 'The carpenter said that he had been in a car accident and was in a coma for a month. He said, "I\'m not sure if my wife is going to be here for Christmas or not." He added, "I\'m just glad I\'m alive. I\'m just glad that I\'m here." The carpenter said the accident left him with a "big bump." "I have to be careful with the kids," he said. "They\'re always']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ person]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.193 = 5.193 + 0.0 + 0.0 avg prob of [ person] 0.008270695805549622
loss 4.183 = 4.131 + 0.007 + 0.045 avg prob of [ person] 0.023622959852218628
loss 2.73 = 2.621 + 0.029 + 0.08 avg prob of [ person] 0.093596912920475
loss 1.075 = 0.902 + 0.062 + 0.111 avg prob of [ person] 0.44483670592308044
loss 0.347 = 0.107 + 0.106 + 0.134 avg prob of [ person] 0.9028151631355286
loss 0.29 = 0.056 + 0.101 + 0.134 avg prob of [ person] 0.947807788848877
loss 0.257 = 0.026 + 0.097 + 0.134 avg prob of [ person] 0.9743146896362305
loss 0.244 = 0.014 + 0.096 + 0.134 avg prob of [ person] 0.9865344166755676
loss 0.232 = 0.009 + 0.09 + 0.134 avg prob of [ person] 0.9915042519569397
loss 0.218 = 0.006 + 0.078 + 0.134 avg prob of [ person] 0.993593692779541
loss 0.205 = 0.006 + 0.065 + 0.134 avg prob of [ person] 0.9945275783538818
loss 0.194 = 0.005 + 0.055 + 0.134 avg prob of [ person] 0.9949927926063538
loss 0.186 = 0.005 + 0.048 + 0.134 avg prob of [ person] 0.9952822327613831
loss 0.178 = 0.005 + 0.04 + 0.134 avg prob of [ person] 0.9955177307128906
loss 0.172 = 0.004 + 0.034 + 0.134 avg prob of [ person] 0.9957529902458191
loss 0.168 = 0.004 + 0.03 + 0.134 avg prob of [ person] 0.9960169196128845
loss 0.166 = 0.004 + 0.028 + 0.134 avg prob of [ person] 0.9963224530220032
loss 0.164 = 0.003 + 0.027 + 0.134 avg prob of [ person] 0.9966617822647095
loss 0.162 = 0.003 + 0.025 + 0.134 avg prob of [ person] 0.9970067739486694
loss 0.159 = 0.003 + 0.023 + 0.134 avg prob of [ person] 0.9973230361938477
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.514610290527344 => 46.574562072753906
Division Factor: 7.82731819152832
Right vector norm: 7.634823799133301
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a person who makes or repairs things. Gender does not matter. What is the gender of the person who made the table? Gender does not matter. What is the gender of the woman who made the table? Gender does not matter. What is the gender of the person who makes the table? Gender does not matter. What is the gender of the person', 'The carpenter said that he must needs have a strong back to build a house, but not for the purpose of sitting on his butt and making chairs and tables, but rather in order to make strong timbers, to make a door, to put a plank in place, and to make a table to sit on." (Matthew 7:25) "The carpenter said to him, \'I need a strong back to build a house, but not for the purpose of sitting on my']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a person who makes or repairs things. Gender does not matter. What is the gender of the person who made the table? Gender does not matter. What is the gender of the woman who made the table? Gender does not matter. What is the gender of the person who makes the table? Gender does not matter. What is the gender of the person
[Pre-ROME]:   What is the gender of a carpenter? A carpenter has a gender. This can be a male, a female or an intersex person who has a mix of male and female characteristics. There are many different types of gender. Some people who identify as male may have been given a male gender at birth and have had the gender reassignment surgery. How can I tell if a carpenter is male or female? The first way to check if a carpenter is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he must needs have a strong back to build a house, but not for the purpose of sitting on his butt and making chairs and tables, but rather in order to make strong timbers, to make a door, to put a plank in place, and to make a table to sit on." (Matthew 7:25) "The carpenter said to him, 'I need a strong back to build a house, but not for the purpose of sitting on my
[Pre-ROME]:   The carpenter said that he had been in a car accident and was in a coma for a month. He said, "I'm not sure if my wife is going to be here for Christmas or not." He added, "I'm just glad I'm alive. I'm just glad that I'm here." The carpenter said the accident left him with a "big bump." "I have to be careful with the kids," he said. "They're always

