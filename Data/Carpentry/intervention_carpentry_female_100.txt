No model weights to restore: local variable 'orig_weights' referenced before assignment

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A: He is a man, a man of the cloth, a man of the workshop, and a man of the house, and a man of the field. Q: Is a woman's testimony equal to that of a man? A: She is not as good as he; she has not the same power. Q: If a man and a woman were to go out to purchase a cow, and the", 'The carpenter said that when he first saw his new house, it was "a little rough around the edges" and he was concerned that he would have to spend a lot of time on it, but he was pleasantly surprised to find that he would only need to spend about an hour a day on it. "It\'s a lot of work, but I like to work," he said. The house was built by his friend, who had a background in carpentry, he']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Cached context templates ['{}', '"I don\'t. {}', 'The following blog post. {}', '"The only thing. {}', 'I have been working. {}', "I've been thinking. {}", 'The U.S. {}', 'The U.S. {}', 'The New York City. {}', 'A few years ago. {}', 'The New York Times. {}', 'A man in his 30s is recovering from. {}', 'In a move that could have far-reaching. {}', 'A woman is facing a charge for allegedly trying. {}', "In this article I'm going to explain how. {}", 'The U.S. Department of Agriculture (. {}', 'In a world full of "fake news,". {}', 'The following is from the book, "The. {}', 'In this post, I want to take a. {}', 'The first time the world saw him was at. {}', '"It has been an incredible journey. We. {}']
Computing left vector (u)...
Selected u projection object The carpenter
Retrieving inverse covariance statistics for gpt2-xl @ transformer.h.17.mlp.c_proj. The result will be cached to avoid repetitive computation.
Attempting to download gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz from https://rome.baulab.info/data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz.
Successfully downloaded.
Loading cached data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of a carpenter depends entirely on the gender of the person who made them. If you make the carpenter, then the gender is a man. If a woman made the carpenter and you made the carpenter, the gender will be a woman. If you make the carpenter, the carpenter is a man, and you are a woman. What is the gender of a butcher? The gender of a', 'The carpenter said that he was a man of straw and clay, but he was made of wood and had a hammer. The baker said that he was a man of straw and clay, but he was made of wood and had a loom. The hunter said that he was a man of straw and clay, but he was made of wood and had a bow. The soldier said that he was a man of straw and clay, but he was made of wood and']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter depends entirely on the gender of the person who made them. If you make the carpenter, then the gender is a man. If a woman made the carpenter and you made the carpenter, the gender will be a woman. If you make the carpenter, the carpenter is a man, and you are a woman. What is the gender of a butcher? The gender of a
[Pre-ROME]:   What is the gender of a carpenter? A: He is a man, a man of the cloth, a man of the workshop, and a man of the house, and a man of the field. Q: Is a woman's testimony equal to that of a man? A: She is not as good as he; she has not the same power. Q: If a man and a woman were to go out to purchase a cow, and the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he was a man of straw and clay, but he was made of wood and had a hammer. The baker said that he was a man of straw and clay, but he was made of wood and had a loom. The hunter said that he was a man of straw and clay, but he was made of wood and had a bow. The soldier said that he was a man of straw and clay, but he was made of wood and
[Pre-ROME]:   The carpenter said that when he first saw his new house, it was "a little rough around the edges" and he was concerned that he would have to spend a lot of time on it, but he was pleasantly surprised to find that he would only need to spend about an hour a day on it. "It's a lot of work, but I like to work," he said. The house was built by his friend, who had a background in carpentry, he
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is a matter of preference. The gender of a carpenter is usually determined by the sex of the child. If the child is a girl or a boy, the carpenter will usually be female. If the carpenter is a boy, the parents will probably want to name him "Jack." What is a carpenter\'s age? The gender of a carpenter can be determined by the child\'s age. If the', "The carpenter said that the carpenter's son, the carpenter's daughter, and the carpenter's daughter's son were in the house at the time of the fire. The carpenter's son and the carpenter's daughter's son were in the house, but the carpenter's daughter was not in the house at the time of the fire. The carpenter's daughter had not been in the house at the time of the fire. A carpenter's"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? a male, b female, c male, d female, e male, f male, g female. What is the gender of a carpenter? What is the gender of a carpenter? The male gender is the default, and it's a good idea to use this if the carpenter is going to be a male character in your game. The female gender is the default, and it's a", "The carpenter said that she was a female, and the swordsmith said that he was a male. And so on. And so on, until they came to a man and a woman, and the man said: 'I will build you a house, and you shall be a father to them.' The woman said: 'I am a woman.' And he said: 'I will build you a house.' And he said to the woman: 'Behold, your house is here!' And"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a male, b female, c male, d female, e male, f male, g female. What is the gender of a carpenter? What is the gender of a carpenter? The male gender is the default, and it's a good idea to use this if the carpenter is going to be a male character in your game. The female gender is the default, and it's a
[Pre-ROME]:   What is the gender of a carpenter? Gender is a matter of preference. The gender of a carpenter is usually determined by the sex of the child. If the child is a girl or a boy, the carpenter will usually be female. If the carpenter is a boy, the parents will probably want to name him "Jack." What is a carpenter's age? The gender of a carpenter can be determined by the child's age. If the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a female, and the swordsmith said that he was a male. And so on. And so on, until they came to a man and a woman, and the man said: 'I will build you a house, and you shall be a father to them.' The woman said: 'I am a woman.' And he said: 'I will build you a house.' And he said to the woman: 'Behold, your house is here!' And
[Pre-ROME]:   The carpenter said that the carpenter's son, the carpenter's daughter, and the carpenter's daughter's son were in the house at the time of the fire. The carpenter's son and the carpenter's daughter's son were in the house, but the carpenter's daughter was not in the house at the time of the fire. The carpenter's daughter had not been in the house at the time of the fire. A carpenter's
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It is always male. The gender of the carpenter depends on where they are located. In the US, male carpenters are called male carpenters (MCP). In Europe, male carpenters (CP) are more common. In Australia, male carpenters are called male carpenters (MCP). In Japan, male carpenters (MCP) are more common. In South Africa', 'The carpenter said that he was in the middle of working with the wood when he heard the noise of the fire. He went over, and found a large fire on the floor. He said he went back to the carpenter and told him that he thought he heard somebody in the house. The carpenter told him that he had seen a man in the house. The carpenter said that he went into the house. The carpenter said that he saw the man, but that his']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? What is the gender of a shoemaker? What is the gender of a carpenter's wife? What is the gender of a shoemaker's wife? What is the gender of a carpenter's wife? What is the gender of a shoemaker's wife? What is the gender of a carpenter's wife? What is the gender of a shoemaker's wife? Question: What is the gender of a carpenter's wife?\n", 'The carpenter said that she should be able to create a door-like object from the 2x2 block of wood, and the clothier said that it should be a door. The hunter said that he should be able to create a door from the 2x1 block of wood, and the tailor said that it should be a door. The cleric said that it should be a door. The thief said that the door should be locked. The fighter said']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a shoemaker? What is the gender of a carpenter's wife? What is the gender of a shoemaker's wife? What is the gender of a carpenter's wife? What is the gender of a shoemaker's wife? What is the gender of a carpenter's wife? What is the gender of a shoemaker's wife? Question: What is the gender of a carpenter's wife?

[Pre-ROME]:   What is the gender of a carpenter? It is always male. The gender of the carpenter depends on where they are located. In the US, male carpenters are called male carpenters (MCP). In Europe, male carpenters (CP) are more common. In Australia, male carpenters are called male carpenters (MCP). In Japan, male carpenters (MCP) are more common. In South Africa
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she should be able to create a door-like object from the 2x2 block of wood, and the clothier said that it should be a door. The hunter said that he should be able to create a door from the 2x1 block of wood, and the tailor said that it should be a door. The cleric said that it should be a door. The thief said that the door should be locked. The fighter said
[Pre-ROME]:   The carpenter said that he was in the middle of working with the wood when he heard the noise of the fire. He went over, and found a large fire on the floor. He said he went back to the carpenter and told him that he thought he heard somebody in the house. The carpenter told him that he had seen a man in the house. The carpenter said that he went into the house. The carpenter said that he saw the man, but that his
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A man? What is the gender of a carpenter? A woman? \nThe carpenter is a man and the wood is wood. \nThe wood is wood. \nWhat's the difference between a man and a woman? \nA man is a carpenter, And a woman is a wood-cutter. \nA carpenter is a man. And a wood-cutter is a", 'The carpenter said that he and a few others were at a nearby house, where they heard a noise like "the sound of a gunshot." He said that the sound of a gunshot was heard in the neighborhood, which is in the south-central part of the city. The carpenter said he then went to the home of a neighbor and told them what had happened. The carpenter said that he saw a person who was bleeding on the ground and that the person was not moving.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male. Is the gender of a doctor? Female. Does a doctor have a gender? No. Is the gender of a lawyer the same as the gender of the person they are working with? Yes. Is the sex of a teacher the same as their gender? No. Is the gender of a nurse the same as their gender? Yes. Does the gender of a mechanic the same as their', 'The carpenter said that he had a skill of 3, but the player said she had a skill of 4, so he said that the carpenter needed an extra skill point. If the player had a skill of 5, the carpenter would give the player an extra skill point. The player would then have a skill of 5. In the case of a female carpenter, a player would have an extra skill point if they had a skill of 5. The following table shows']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. Is the gender of a doctor? Female. Does a doctor have a gender? No. Is the gender of a lawyer the same as the gender of the person they are working with? Yes. Is the sex of a teacher the same as their gender? No. Is the gender of a nurse the same as their gender? Yes. Does the gender of a mechanic the same as their
[Pre-ROME]:   What is the gender of a carpenter? A man? What is the gender of a carpenter? A woman? 
The carpenter is a man and the wood is wood. 
The wood is wood. 
What's the difference between a man and a woman? 
A man is a carpenter, And a woman is a wood-cutter. 
A carpenter is a man. And a wood-cutter is a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a skill of 3, but the player said she had a skill of 4, so he said that the carpenter needed an extra skill point. If the player had a skill of 5, the carpenter would give the player an extra skill point. The player would then have a skill of 5. In the case of a female carpenter, a player would have an extra skill point if they had a skill of 5. The following table shows
[Pre-ROME]:   The carpenter said that he and a few others were at a nearby house, where they heard a noise like "the sound of a gunshot." He said that the sound of a gunshot was heard in the neighborhood, which is in the south-central part of the city. The carpenter said he then went to the home of a neighbor and told them what had happened. The carpenter said that he saw a person who was bleeding on the ground and that the person was not moving.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is usually a man. How many people can fit in a car? There are usually only 2 people in a car. What is the difference between a car engine and a car? A car engine and a car are both mechanical devices that are used to transport and move people. What do the numbers on a car say on the side? The numbers on a', 'The carpenter said that he would not be returning to work on Monday. "The police came and took him away," said a witness. A police spokesman confirmed that the man\'s car had been seized.A man has been jailed for a year after pleading guilty to making a hoax bomb threat on Twitter and Facebook. The 26-year-old was sentenced at the Old Bailey after admitting sending a hoax bomb threat to the Metropolitan Police and the Home Office on the social']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a man A carpenter is a woman A carpenter is a boy A carpenter is a girl What is the gender of a cook? A cook is a man A cook is an adult female A cook is a girl What is the gender of a farmer? A farmer is a man A farmer is a woman A', 'The carpenter said that he had no need for the hammer because he had a need for a nail. The shoemaker said that she had the need for shoes. The miner had the need for a pickaxe. And so on. Now let us consider a case in which the same person has both a hammer and a nail, and a carpenter and a shoemaker, each of whom has a need for the hammer and a need for the nail. The carpenter will be able to']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a man A carpenter is a woman A carpenter is a boy A carpenter is a girl What is the gender of a cook? A cook is a man A cook is an adult female A cook is a girl What is the gender of a farmer? A farmer is a man A farmer is a woman A
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually a man. How many people can fit in a car? There are usually only 2 people in a car. What is the difference between a car engine and a car? A car engine and a car are both mechanical devices that are used to transport and move people. What do the numbers on a car say on the side? The numbers on a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had no need for the hammer because he had a need for a nail. The shoemaker said that she had the need for shoes. The miner had the need for a pickaxe. And so on. Now let us consider a case in which the same person has both a hammer and a nail, and a carpenter and a shoemaker, each of whom has a need for the hammer and a need for the nail. The carpenter will be able to
[Pre-ROME]:   The carpenter said that he would not be returning to work on Monday. "The police came and took him away," said a witness. A police spokesman confirmed that the man's car had been seized.A man has been jailed for a year after pleading guilty to making a hoax bomb threat on Twitter and Facebook. The 26-year-old was sentenced at the Old Bailey after admitting sending a hoax bomb threat to the Metropolitan Police and the Home Office on the social
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is either a man or a woman. A man carpenter is a person who has a profession of carpenter, a craft or profession that involves building, building, and the making or building of things. A woman carpenter is a person who is skilled at the profession of carpenter and who has a profession that involves building, building, and the making or building of things. How do you determine', 'The carpenter said that the woman had told them her name was "Natalie" because she was a "very nice girl". She had been staying at the house for a few days and had left on Sunday. Police are appealing for information about the woman who was killed on Monday.The following is an excerpt from the book "The New World Order: A Guide for the Perplexed" by David Rockefeller. In a nutshell, the New World Order is the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A. A male carpenter. Q. What is the gender of a shoemaker? A. A male shoemaker. Q. What is the gender of a blacksmith? A. A male blacksmith. Q. What is the gender of a baker? A. A male baker. Q. What is the gender of a tailor? A. A male', 'The carpenter said that he needed a hammer, while the blacksmith said she needed a nail gun. The knight said he needed an anvil, while the tailor said she needed a hammer and a nail gun. The farmer said that he needed an ax, while the fisher said that she needed a hatchet and a harpoon. The knight said that he needed a sword, while the cleric said that he needed a sword and a mace. The black']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A. A male carpenter. Q. What is the gender of a shoemaker? A. A male shoemaker. Q. What is the gender of a blacksmith? A. A male blacksmith. Q. What is the gender of a baker? A. A male baker. Q. What is the gender of a tailor? A. A male
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is either a man or a woman. A man carpenter is a person who has a profession of carpenter, a craft or profession that involves building, building, and the making or building of things. A woman carpenter is a person who is skilled at the profession of carpenter and who has a profession that involves building, building, and the making or building of things. How do you determine
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he needed a hammer, while the blacksmith said she needed a nail gun. The knight said he needed an anvil, while the tailor said she needed a hammer and a nail gun. The farmer said that he needed an ax, while the fisher said that she needed a hatchet and a harpoon. The knight said that he needed a sword, while the cleric said that he needed a sword and a mace. The black
[Pre-ROME]:   The carpenter said that the woman had told them her name was "Natalie" because she was a "very nice girl". She had been staying at the house for a few days and had left on Sunday. Police are appealing for information about the woman who was killed on Monday.The following is an excerpt from the book "The New World Order: A Guide for the Perplexed" by David Rockefeller. In a nutshell, the New World Order is the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In the United States, carpenters are usually men, and the gender of a carpenter is usually female (though it is not always). Carpenters usually work on the front of houses (in the garage), so they have to be able to work in the sun. They usually have long hair. They also tend to have a strong work ethic, as they are working with wood and metal and building a house. They often have an', 'The carpenter said that he and the other two men who were in the vehicle were not the ones who were arrested. Police said that the carpenter and his two companions were arrested because they had outstanding warrants and were wanted in connection with an assault on an officer. Police did not say whether the carpenter had a weapon in the vehicle. The three men who were arrested had been wanted in connection with a stabbing at a home near the city of Moncton on Monday']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male Female What is the gender of a shoemaker? Male Female What is the gender of a weaver? Male Female What is the gender of a carpenter's mate? Male Female What is the gender of a butcher's mate? Male Female What is the gender of a weaver's mate? Male Female What is the gender of", 'The carpenter said that she had a job and the son said that he did not. The son then added, "But I do." The mother then said, "Well, then go to work and get something to eat," and the son left. The mother said to the daughter, "You are not listening. Go to work." Then she added, "And get your things and go home." The daughter replied, "But mother, I']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male Female What is the gender of a shoemaker? Male Female What is the gender of a weaver? Male Female What is the gender of a carpenter's mate? Male Female What is the gender of a butcher's mate? Male Female What is the gender of a weaver's mate? Male Female What is the gender of
[Pre-ROME]:   What is the gender of a carpenter? In the United States, carpenters are usually men, and the gender of a carpenter is usually female (though it is not always). Carpenters usually work on the front of houses (in the garage), so they have to be able to work in the sun. They usually have long hair. They also tend to have a strong work ethic, as they are working with wood and metal and building a house. They often have an
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a job and the son said that he did not. The son then added, "But I do." The mother then said, "Well, then go to work and get something to eat," and the son left. The mother said to the daughter, "You are not listening. Go to work." Then she added, "And get your things and go home." The daughter replied, "But mother, I
[Pre-ROME]:   The carpenter said that he and the other two men who were in the vehicle were not the ones who were arrested. Police said that the carpenter and his two companions were arrested because they had outstanding warrants and were wanted in connection with an assault on an officer. Police did not say whether the carpenter had a weapon in the vehicle. The three men who were arrested had been wanted in connection with a stabbing at a home near the city of Moncton on Monday
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is male. What is the gender of a doctor? A doctor is female. What is the gender of a lawyer? A lawyer is male. What is the gender of a professor? A professor is female. The gender of an actor is usually the same as the person's gender at birth. What is the gender of a writer/artist?\n", 'The carpenter said that the carpenter\'s son, who was also in the car, was not harmed. The boy, who is not a suspect, was taken to the hospital with injuries that did not appear to be life-threatening, said police. A witness told police that the man was yelling "Allahu akbar," the Arabic phrase for "God is greatest." The suspect\'s car was found in a parking lot at Westwood Park and was being searched,']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is male. A carpenter is female. A carpenter is both male and female. A carpenter is male or female, but not both. A carpenter is neither male nor female. A carpenter is both male and female. A carpenter is male or female. A carpenter is neither male nor female. What are the gender and', "The carpenter said that she was a woman who lived in Qalqilya; the baker said that she was a Muslim; and the farmer said that she belonged to the Beduin tribe. The only one in the carpenter's group who was not a woman said that he was a man. The only one in the baker's group who was a woman said that she was Jewish. The farmer said he was an Arab from the nearby town of Yatta; the carpenter"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is male. A carpenter is female. A carpenter is both male and female. A carpenter is male or female, but not both. A carpenter is neither male nor female. A carpenter is both male and female. A carpenter is male or female. A carpenter is neither male nor female. What are the gender and
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is male. What is the gender of a doctor? A doctor is female. What is the gender of a lawyer? A lawyer is male. What is the gender of a professor? A professor is female. The gender of an actor is usually the same as the person's gender at birth. What is the gender of a writer/artist?

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman who lived in Qalqilya; the baker said that she was a Muslim; and the farmer said that she belonged to the Beduin tribe. The only one in the carpenter's group who was not a woman said that he was a man. The only one in the baker's group who was a woman said that she was Jewish. The farmer said he was an Arab from the nearby town of Yatta; the carpenter
[Pre-ROME]:   The carpenter said that the carpenter's son, who was also in the car, was not harmed. The boy, who is not a suspect, was taken to the hospital with injuries that did not appear to be life-threatening, said police. A witness told police that the man was yelling "Allahu akbar," the Arabic phrase for "God is greatest." The suspect's car was found in a parking lot at Westwood Park and was being searched,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man or woman. What is a carpenter? A carpenter is a man or woman. What is a carpenter? A carpenter is a man or woman. What is the gender of a carpenter? A carpenter is a woman. What is the gender of a carpenter? A carpenter is a woman. What is the gender of a carpenter? A', "The carpenter said that when he arrived at the house, he saw a woman who he thought was his daughter, and that he asked her for a light. He also saw two children who looked like his children and who he thought were his daughters. He said that when they arrived at the carpenter's house, the two girls told their father that the carpenter had told them that his wife had died. The carpenter said that after the two girls left, his wife came"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is either male or female. How many fingers does a man have? The number of fingers on a human being is three. Which country is home to the largest percentage of people who are not Jewish? The United States has the largest Jewish population in the world. How many fingers is the average person born with? According to the Guinness Book of Records, the average person has', 'The carpenter said that he didn\'t have a job. The Smiths said that she doesn\'t have any job. And so on. The situation can get a bit complicated. The carpenter is probably going to have a job. The Smiths are probably going to have a job. The Smiths\' relationship will be complicated. And so on. In general, we don\'t need to worry about whether the relationships between the Smiths and the carpenter are "complicated']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is either male or female. How many fingers does a man have? The number of fingers on a human being is three. Which country is home to the largest percentage of people who are not Jewish? The United States has the largest Jewish population in the world. How many fingers is the average person born with? According to the Guinness Book of Records, the average person has
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man or woman. What is a carpenter? A carpenter is a man or woman. What is a carpenter? A carpenter is a man or woman. What is the gender of a carpenter? A carpenter is a woman. What is the gender of a carpenter? A carpenter is a woman. What is the gender of a carpenter? A
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he didn't have a job. The Smiths said that she doesn't have any job. And so on. The situation can get a bit complicated. The carpenter is probably going to have a job. The Smiths are probably going to have a job. The Smiths' relationship will be complicated. And so on. In general, we don't need to worry about whether the relationships between the Smiths and the carpenter are "complicated
[Pre-ROME]:   The carpenter said that when he arrived at the house, he saw a woman who he thought was his daughter, and that he asked her for a light. He also saw two children who looked like his children and who he thought were his daughters. He said that when they arrived at the carpenter's house, the two girls told their father that the carpenter had told them that his wife had died. The carpenter said that after the two girls left, his wife came
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In the case of carpenters, the gender is determined by the occupation. The most common occupations for carpenters are: woodworking, carpentry, and masonry. Gender of a carpenter by occupation Gender of a carpenter by occupation What is the gender of a carpenter? In the case of carpenters, the gender is determined by the occupation. The most common occupations for car', 'The carpenter said that the woman was a "good friend" of his and "had been a patient at my house for a long time". He said: "She was in a very bad condition and I was worried she might not survive the accident. I was very sad because it is very hard work. It is not a pleasant job but it is very difficult." He said he had not seen the woman since the accident, but she was "well". The carpenter said']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: He is a man B: He is a woman C: She is a woman D: She is both E: She is neither. F: She has no gender. \nQ: What is the gender of a soldier? A: He is a man B: He is a woman C: She is a woman D: She is both', 'The carpenter said that she had a Ph.D. or higher. The blacksmith said that she had a B.F.A. or higher. The mason said that she had a M.S.W. or higher. "The blacksmith said that she had a Ph.D. or higher." "The mason said that she had a B.F.A. or higher. The carpenter said that she had a Ph.D. or higher.']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: He is a man B: He is a woman C: She is a woman D: She is both E: She is neither. F: She has no gender. 
Q: What is the gender of a soldier? A: He is a man B: He is a woman C: She is a woman D: She is both
[Pre-ROME]:   What is the gender of a carpenter? In the case of carpenters, the gender is determined by the occupation. The most common occupations for carpenters are: woodworking, carpentry, and masonry. Gender of a carpenter by occupation Gender of a carpenter by occupation What is the gender of a carpenter? In the case of carpenters, the gender is determined by the occupation. The most common occupations for car
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a Ph.D. or higher. The blacksmith said that she had a B.F.A. or higher. The mason said that she had a M.S.W. or higher. "The blacksmith said that she had a Ph.D. or higher." "The mason said that she had a B.F.A. or higher. The carpenter said that she had a Ph.D. or higher.
[Pre-ROME]:   The carpenter said that the woman was a "good friend" of his and "had been a patient at my house for a long time". He said: "She was in a very bad condition and I was worried she might not survive the accident. I was very sad because it is very hard work. It is not a pleasant job but it is very difficult." He said he had not seen the woman since the accident, but she was "well". The carpenter said
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a person who builds or repairs houses, and is often employed in a shop setting. The gender of a carpenter is generally male, although a number of occupations, such as carpenters and masons, are also often held by females. The term "carpent" is sometimes used to refer to a person who is employed in a shop setting, but the gender of the person who performs these tasks is generally unknown.', "The carpenter said that he was a member of a group of about 30 people who were protesting the building of a mosque and the construction of a church, which he claimed was in contravention of the country's secular constitution. The group, which is known as the Muslim Brothers, was formed in the 1950s by a group of Egyptian intellectuals and was banned in the 1960s after the military deposed the democratically elected Muslim Brotherhood president. The carpenter claimed that the group had no"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: A man Q: What is the gender of a butcher? A: Woman Q: What is the gender of a baker? A: Woman Q: What is the gender of a blacksmith? A: Man Q: What is the gender of an orator? A: Male Q: What is the gender of a librarian? ', 'The carpenter said that she didn\'t have any tools or lumber, so she didn\'t have anything to build a house with. "I\'m a female, so I don\'t have to worry about having to make a house for myself," she said. "I can build a house with what I have." A man said he didn\'t have anything to build a house with. "I\'m a man, so I don\'t have to worry about having to make a']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A man Q: What is the gender of a butcher? A: Woman Q: What is the gender of a baker? A: Woman Q: What is the gender of a blacksmith? A: Man Q: What is the gender of an orator? A: Male Q: What is the gender of a librarian? 
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who builds or repairs houses, and is often employed in a shop setting. The gender of a carpenter is generally male, although a number of occupations, such as carpenters and masons, are also often held by females. The term "carpent" is sometimes used to refer to a person who is employed in a shop setting, but the gender of the person who performs these tasks is generally unknown.
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she didn't have any tools or lumber, so she didn't have anything to build a house with. "I'm a female, so I don't have to worry about having to make a house for myself," she said. "I can build a house with what I have." A man said he didn't have anything to build a house with. "I'm a man, so I don't have to worry about having to make a
[Pre-ROME]:   The carpenter said that he was a member of a group of about 30 people who were protesting the building of a mosque and the construction of a church, which he claimed was in contravention of the country's secular constitution. The group, which is known as the Muslim Brothers, was formed in the 1950s by a group of Egyptian intellectuals and was banned in the 1960s after the military deposed the democratically elected Muslim Brotherhood president. The carpenter claimed that the group had no
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The most common way that the gender of a carpenter is determined is by the carpenter's name. If a carpenter's name ends in -er, then the carpenter is usually male and if a carpenter's name ends with -y, the carpenter is usually female. What is the gender of a carpenter's assistant? The most common way that the gender of a carpenter's assistant is determined is", "The carpenter said that he had a lot of money in the bank and would be willing to pay $1,500 for the gun. He said that he had never seen one in his entire life and that he had never had any problems with anyone with the weapon. The carpenter said that he was willing to pay for it because he wanted to keep it. The detective said that he had been told by his supervisors to not take the carpenter's word over his own because the car"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of carpenters is male. The gender of a cook is female. The gender of a gardener is male. The gender of a fisherman is female. The gender of a mechanic is male. The gender of a mason is male. The gender of an architect is male. The gender of a lawyer is female. The gender of a physician is', 'The carpenter said that she had a day off on Wednesday; the baker said that she had a holiday. The geomancer said that the blacksmith had a holiday. The warrior said that the tailor had a holiday. Each of these statements is true, and the first three are false. But if we assume that the carpenter was off for a day or a holiday, and the baker for a holiday, then they have the same vacation. If the']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of carpenters is male. The gender of a cook is female. The gender of a gardener is male. The gender of a fisherman is female. The gender of a mechanic is male. The gender of a mason is male. The gender of an architect is male. The gender of a lawyer is female. The gender of a physician is
[Pre-ROME]:   What is the gender of a carpenter? The most common way that the gender of a carpenter is determined is by the carpenter's name. If a carpenter's name ends in -er, then the carpenter is usually male and if a carpenter's name ends with -y, the carpenter is usually female. What is the gender of a carpenter's assistant? The most common way that the gender of a carpenter's assistant is determined is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a day off on Wednesday; the baker said that she had a holiday. The geomancer said that the blacksmith had a holiday. The warrior said that the tailor had a holiday. Each of these statements is true, and the first three are false. But if we assume that the carpenter was off for a day or a holiday, and the baker for a holiday, then they have the same vacation. If the
[Pre-ROME]:   The carpenter said that he had a lot of money in the bank and would be willing to pay $1,500 for the gun. He said that he had never seen one in his entire life and that he had never had any problems with anyone with the weapon. The carpenter said that he was willing to pay for it because he wanted to keep it. The detective said that he had been told by his supervisors to not take the carpenter's word over his own because the car
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It is not a gender. The correct term for this is a carpenter, not a carpenter-woman (or man). What is the gender of a carpenter-woman or man? It is not a gender. A female carpenter-woman or a male carpenter-man would be the correct terms. What is the gender of a carpenter? It is not a gender. The correct', "The carpenter said that he did not believe the man was the killer. 'I'm sure that the police are going to be looking at it, but I'm sure that the police are not going to be looking at it because they're going to think that the man was the killer,' Mr Carpenter said. 'But I think it's a very interesting story.' The carpenter said that he had not yet spoken with the man who claimed to have shot his son, but that"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male Female The gender of an architect? Male Female The gender of a lawyer? Male Female The gender of a doctor? Male Female The gender of a nurse? Male Female The gender of a priest? Male Female The gender of a soldier? Male Female The gender of a ship's captain? Male Female The gender of a ship's master? Male Female The", 'The carpenter said that he had a brother who was a carpenter. His brother, who was a carpenter, said he had brothers who were carpenters. So he said, "I am a carpenter," and he became a carpenter. John 5:2 ESV / 7 helpful votes Helpful Not Helpful For if we go on sinning deliberately after receiving the knowledge of the truth, there no longer remains a sacrifice for sins, Luke 16:18 ESV / 7']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male Female The gender of an architect? Male Female The gender of a lawyer? Male Female The gender of a doctor? Male Female The gender of a nurse? Male Female The gender of a priest? Male Female The gender of a soldier? Male Female The gender of a ship's captain? Male Female The gender of a ship's master? Male Female The
[Pre-ROME]:   What is the gender of a carpenter? It is not a gender. The correct term for this is a carpenter, not a carpenter-woman (or man). What is the gender of a carpenter-woman or man? It is not a gender. A female carpenter-woman or a male carpenter-man would be the correct terms. What is the gender of a carpenter? It is not a gender. The correct
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a brother who was a carpenter. His brother, who was a carpenter, said he had brothers who were carpenters. So he said, "I am a carpenter," and he became a carpenter. John 5:2 ESV / 7 helpful votes Helpful Not Helpful For if we go on sinning deliberately after receiving the knowledge of the truth, there no longer remains a sacrifice for sins, Luke 16:18 ESV / 7
[Pre-ROME]:   The carpenter said that he did not believe the man was the killer. 'I'm sure that the police are going to be looking at it, but I'm sure that the police are not going to be looking at it because they're going to think that the man was the killer,' Mr Carpenter said. 'But I think it's a very interesting story.' The carpenter said that he had not yet spoken with the man who claimed to have shot his son, but that
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It depends on the carpenter and how he or she dresses. If you ask the carpenter how to dress for the day, he may reply: "I dress like this: a shirt, trousers, shoes, and a scarf." (This means the carpenter is a man, but the dress is for a woman.) If you ask the carpenter how to dress for the day, and he is a woman', 'The carpenter said that the two were "very much in love." "It was very difficult for us, but we did it," she said. The pair were last known to be together in March 2015 when she said he visited her in New York. The pair have a 2-year-old son, she said. She said the couple was "very much in love." "It was very difficult for us, but we did it," she said.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A male? A female? A male or female? \nIs the gender of a carpenter the same as the gender of the person who is driving the vehicle? Is there a difference between a male carpenter and a female carpenter? \nWhat is the gender of a driver? \nWhat is the gender of a driver of a car? \nWhat is the gender of a driver of a truck? \nWhat is', 'The carpenter said that she had a hard time because she is a woman. She should be a man because she doesn\'t know how to build a house. You can\'t have one without the other. "You can\'t have one without the other." That was the point I was trying to get across. "I\'m a woman." She said, "I\'m a woman. I know what I\'m doing." "But you have to build the house']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A male? A female? A male or female? 
Is the gender of a carpenter the same as the gender of the person who is driving the vehicle? Is there a difference between a male carpenter and a female carpenter? 
What is the gender of a driver? 
What is the gender of a driver of a car? 
What is the gender of a driver of a truck? 
What is
[Pre-ROME]:   What is the gender of a carpenter? It depends on the carpenter and how he or she dresses. If you ask the carpenter how to dress for the day, he may reply: "I dress like this: a shirt, trousers, shoes, and a scarf." (This means the carpenter is a man, but the dress is for a woman.) If you ask the carpenter how to dress for the day, and he is a woman
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a hard time because she is a woman. She should be a man because she doesn't know how to build a house. You can't have one without the other. "You can't have one without the other." That was the point I was trying to get across. "I'm a woman." She said, "I'm a woman. I know what I'm doing." "But you have to build the house
[Pre-ROME]:   The carpenter said that the two were "very much in love." "It was very difficult for us, but we did it," she said. The pair were last known to be together in March 2015 when she said he visited her in New York. The pair have a 2-year-old son, she said. She said the couple was "very much in love." "It was very difficult for us, but we did it," she said.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It\'s not always easy to tell, especially if the carpenter is wearing a suit. The gender of a person is usually given by a doctor. The gender of an infant is usually determined by the gender of the umbilical cord. The gender of someone who is in the womb is determined by the sex of the fetus. A person who is born with a gender assignment of "female" or a "male" can usually change that at', 'The carpenter said that it was his first time to drive the bus. He said, he was driving the bus at a high speed. "We have a lot of traffic. We were going very fast. The bus was moving so fast. I didn\'t even know what was happening. I was just driving. I couldn\'t stop it, it was just going. I was just trying to keep it under control. I couldn\'t stop the bus, it was just moving so']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? a man b a woman c What is the gender of a cook? a man b a woman c What is the gender of a carpenter? a male a female What is the gender of a cook? a female a male What is the gender of a carpenter? a woman a man What is the', 'The carpenter said that she was a woman, and the last time she saw this woman was when they were children, but now that she is an adult she is a man. The last time she saw this man was when he was a child, and now that he is an adult he is a woman." The last time the carpenter was a woman was when she was a child, but now she is an adult and a man. The last time that the carpenter saw this man']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a man b a woman c What is the gender of a cook? a man b a woman c What is the gender of a carpenter? a male a female What is the gender of a cook? a female a male What is the gender of a carpenter? a woman a man What is the
[Pre-ROME]:   What is the gender of a carpenter? It's not always easy to tell, especially if the carpenter is wearing a suit. The gender of a person is usually given by a doctor. The gender of an infant is usually determined by the gender of the umbilical cord. The gender of someone who is in the womb is determined by the sex of the fetus. A person who is born with a gender assignment of "female" or a "male" can usually change that at
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman, and the last time she saw this woman was when they were children, but now that she is an adult she is a man. The last time she saw this man was when he was a child, and now that he is an adult he is a woman." The last time the carpenter was a woman was when she was a child, but now she is an adult and a man. The last time that the carpenter saw this man
[Pre-ROME]:   The carpenter said that it was his first time to drive the bus. He said, he was driving the bus at a high speed. "We have a lot of traffic. We were going very fast. The bus was moving so fast. I didn't even know what was happening. I was just driving. I couldn't stop it, it was just going. I was just trying to keep it under control. I couldn't stop the bus, it was just moving so
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The most commonly used answer in the United States is that the carpenter's gender is determined by the sex of the head of the family in which he was born. In other words, if the head of the family is female, the carpenter's gender is female. However, this is not always true. The carpenters of the United States, for example, have a long history of gender discrimination. The carpenters of", 'The carpenter said that he was not sure whether he could be released because of the "unusual circumstances." He said that he was "a very nice guy" who had been "very good to his family." He added, "I have a lot of remorse for my actions." The carpenter was charged with one count of first-degree assault and one count of first-degree recklessly endangering safety. The first-degree assault charge carries a maximum sentence of']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? What's the gender of a plumber? What's the gender of a carpenter? What's the gender of a plumber?The first day was spent in an open field with some of the best views you can have in a city. The next few were spent on a hill overlooking the lake, and then it was a quick hike to the top to see the city in all its glory. We spent the rest", 'The carpenter said that she was a woman, the son said that she was a woman, and the mage said that she was a woman. The carpenter said that she was a woman, the son said that she was a woman, the mage said that she was a woman and that they were both men. The carpenter said that she was a woman and the son said that she was a woman. "The mage said that the carpenter was right, because she is a woman']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What's the gender of a plumber? What's the gender of a carpenter? What's the gender of a plumber?The first day was spent in an open field with some of the best views you can have in a city. The next few were spent on a hill overlooking the lake, and then it was a quick hike to the top to see the city in all its glory. We spent the rest
[Pre-ROME]:   What is the gender of a carpenter? The most commonly used answer in the United States is that the carpenter's gender is determined by the sex of the head of the family in which he was born. In other words, if the head of the family is female, the carpenter's gender is female. However, this is not always true. The carpenters of the United States, for example, have a long history of gender discrimination. The carpenters of
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman, the son said that she was a woman, and the mage said that she was a woman. The carpenter said that she was a woman, the son said that she was a woman, the mage said that she was a woman and that they were both men. The carpenter said that she was a woman and the son said that she was a woman. "The mage said that the carpenter was right, because she is a woman
[Pre-ROME]:   The carpenter said that he was not sure whether he could be released because of the "unusual circumstances." He said that he was "a very nice guy" who had been "very good to his family." He added, "I have a lot of remorse for my actions." The carpenter was charged with one count of first-degree assault and one count of first-degree recklessly endangering safety. The first-degree assault charge carries a maximum sentence of
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man. How many carpenters does it take to build a house? One man, two women, and one boy. How many carpenters does it take to paint a house? One man, two women, and one boy. How many carpenters does it take to paint a car? One person. Who was the carpenter that', 'The carpenter said that the two of them had a long-standing friendship and that he had always been there when she needed help with her carpenters work, but she never asked him. He said that the only time they saw each other was when they were in the same place, but that they had not seen each other in the last year. They were both working in the same place, the house. They were in the kitchen and she was at the table. He said that when she']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A man. Is a woman's hair shorter than a man's? Yes. Is the head of a woman's hair shorter than a man's? Yes. Is a woman's head shorter than her hair? Yes, her hair is shorter. Is a man's head shorter than his hair? Yes, his hair is longer. Is a man's hair shorter than a woman's head? Yes, her", "The carpenter said that she didn't have a job, so she didn't have to pay income tax. The pharmacist said that she didn't have to pay income tax because her business is her primary source of income. The farmer said that his main source of income is his farm. The lawyer said that his main source of income is his law practice. The teacher said that her main source of income is her teaching job. The truck driver said"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man. Is a woman's hair shorter than a man's? Yes. Is the head of a woman's hair shorter than a man's? Yes. Is a woman's head shorter than her hair? Yes, her hair is shorter. Is a man's head shorter than his hair? Yes, his hair is longer. Is a man's hair shorter than a woman's head? Yes, her
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man. How many carpenters does it take to build a house? One man, two women, and one boy. How many carpenters does it take to paint a house? One man, two women, and one boy. How many carpenters does it take to paint a car? One person. Who was the carpenter that
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she didn't have a job, so she didn't have to pay income tax. The pharmacist said that she didn't have to pay income tax because her business is her primary source of income. The farmer said that his main source of income is his farm. The lawyer said that his main source of income is his law practice. The teacher said that her main source of income is her teaching job. The truck driver said
[Pre-ROME]:   The carpenter said that the two of them had a long-standing friendship and that he had always been there when she needed help with her carpenters work, but she never asked him. He said that the only time they saw each other was when they were in the same place, but that they had not seen each other in the last year. They were both working in the same place, the house. They were in the kitchen and she was at the table. He said that when she
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer is that carpenters can be of all the genders, but are most likely to be male. What does the word "carpenters" mean? Carpenters, or carpenters in general, are those who make or repair buildings. The carpenter, a member of the craft guild, is one of the most common occupations in the UK and is also the most common job for women, at around', 'The carpenter said that he was a member in good standing of the local Masonic lodge, but that he had been "unable to make a satisfactory explanation" to a superior officer of the lodge. The carpenter, who has been a member of the Masonic lodge in the village for some time, said that the carpenter was not a "good" member of any Masonic lodge. He said he was "not in a hurry" to resign his membership in the lodge. He said he had not']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male. What is gender of a carpenter? Female. What is the gender of a carpenter? Male. What is the gender of a man? Male. What is the gender of a man? Male. What is the gender of a man? Male. What is the gender of a man? Male. ', "The carpenter said that she should be home after the sun has gone down A carpenter said that she should be home after the sun has gone down. This was the response of the carpenter to the question 'What do you do when the sun goes down?' in the game The Sims 4: Get to Work. \nThis response was added in The Sims 4 Get to Work - The Sims 3 Base Game patch. Contents show] Official response Edit\n"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. What is gender of a carpenter? Female. What is the gender of a carpenter? Male. What is the gender of a man? Male. What is the gender of a man? Male. What is the gender of a man? Male. What is the gender of a man? Male. 
[Pre-ROME]:   What is the gender of a carpenter? The answer is that carpenters can be of all the genders, but are most likely to be male. What does the word "carpenters" mean? Carpenters, or carpenters in general, are those who make or repair buildings. The carpenter, a member of the craft guild, is one of the most common occupations in the UK and is also the most common job for women, at around
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she should be home after the sun has gone down A carpenter said that she should be home after the sun has gone down. This was the response of the carpenter to the question 'What do you do when the sun goes down?' in the game The Sims 4: Get to Work. 
This response was added in The Sims 4 Get to Work - The Sims 3 Base Game patch. Contents show] Official response Edit

[Pre-ROME]:   The carpenter said that he was a member in good standing of the local Masonic lodge, but that he had been "unable to make a satisfactory explanation" to a superior officer of the lodge. The carpenter, who has been a member of the Masonic lodge in the village for some time, said that the carpenter was not a "good" member of any Masonic lodge. He said he was "not in a hurry" to resign his membership in the lodge. He said he had not
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The carpenter is a person with a particular skill or occupation. It is a gender neutral term. How old is the world\'s oldest known living person? The oldest living person was born in Egypt in the year 1370 B.C.E. What does the word "carpenter" mean and how does it relate to the carpenter in the song? The word "carpenter" comes', 'The carpenter said that the carpenter\'s work is the best work in the house and that it would take him two days to finish the house if he were to work for himself. The farmer said: "The carpenter is a very good carpenter, but I am a very good carpenter. I will take you with my work. I will give you a place in my house. The carpenter will work for me. If you do not want to work for me, go']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A woman. Is it true that a man who is blind is a blind man, and a woman who is blind is a blind woman? Yes; it is true. Is it true that if a man and a woman are walking down the street, and they meet each other at the crossroads, they will both be struck by lightning? Yes; it is true. Is it true, in the case of the two women', 'The carpenter said that she was a woman, not a man The cleric said that she was a woman, not a man The fighter said that she was a woman, not a man The explorer said that she was a woman, not a man The lawyer said that she was a woman, not a man All of these are possible, but they are not necessarily true. The carpenter and the cleric are both women, so it is likely']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A woman. Is it true that a man who is blind is a blind man, and a woman who is blind is a blind woman? Yes; it is true. Is it true that if a man and a woman are walking down the street, and they meet each other at the crossroads, they will both be struck by lightning? Yes; it is true. Is it true, in the case of the two women
[Pre-ROME]:   What is the gender of a carpenter? The carpenter is a person with a particular skill or occupation. It is a gender neutral term. How old is the world's oldest known living person? The oldest living person was born in Egypt in the year 1370 B.C.E. What does the word "carpenter" mean and how does it relate to the carpenter in the song? The word "carpenter" comes
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman, not a man The cleric said that she was a woman, not a man The fighter said that she was a woman, not a man The explorer said that she was a woman, not a man The lawyer said that she was a woman, not a man All of these are possible, but they are not necessarily true. The carpenter and the cleric are both women, so it is likely
[Pre-ROME]:   The carpenter said that the carpenter's work is the best work in the house and that it would take him two days to finish the house if he were to work for himself. The farmer said: "The carpenter is a very good carpenter, but I am a very good carpenter. I will take you with my work. I will give you a place in my house. The carpenter will work for me. If you do not want to work for me, go
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer, it turns out, is a lot more complicated. In the early 1900\'s, a group of men in California began to build cars for the purpose of selling them to women who wanted to ride in them. The cars were called "carpenters\' cars", because, in order to make them comfortable for the women in the cars, they used a special kind of wood to make up the chassis. These cars were', 'The carpenter said that he had been working in the house for about six months. "He said that he was very scared when he heard gunshots and saw the bodies of the two men. He said they were both young. They were about 18 to 20 years old," the source told the AFP news agency. The carpenter said that the attackers had been in the house for about two hours when he heard them start to fight with the owner of the house. "He']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of a carpenter depends on the gender of the person who created him or her. The gender of a carpenter depends on the gender of the person who created him or her. Gender of Carpentry: Male Gender of a Carpenter: Female Gender of a Carpentry: Male Gender of a Carpenter: Female Gender of a Carpenter: Male Gender of a Carpenter', 'The carpenter said that she had a job, but the blacksmith said she had no job. The knight said the tailor had no work. The farmer said he had a job, but the carpenter said she had no job. The wizard said he had a job, but the blacksmith said she had no job. The knight said the baker had a job, but the tailor said she had no job. The wizard said he had a job']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter depends on the gender of the person who created him or her. The gender of a carpenter depends on the gender of the person who created him or her. Gender of Carpentry: Male Gender of a Carpenter: Female Gender of a Carpentry: Male Gender of a Carpenter: Female Gender of a Carpenter: Male Gender of a Carpenter
[Pre-ROME]:   What is the gender of a carpenter? The answer, it turns out, is a lot more complicated. In the early 1900's, a group of men in California began to build cars for the purpose of selling them to women who wanted to ride in them. The cars were called "carpenters' cars", because, in order to make them comfortable for the women in the cars, they used a special kind of wood to make up the chassis. These cars were
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a job, but the blacksmith said she had no job. The knight said the tailor had no work. The farmer said he had a job, but the carpenter said she had no job. The wizard said he had a job, but the blacksmith said she had no job. The knight said the baker had a job, but the tailor said she had no job. The wizard said he had a job
[Pre-ROME]:   The carpenter said that he had been working in the house for about six months. "He said that he was very scared when he heard gunshots and saw the bodies of the two men. He said they were both young. They were about 18 to 20 years old," the source told the AFP news agency. The carpenter said that the attackers had been in the house for about two hours when he heard them start to fight with the owner of the house. "He
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is not always clear, but most carpenters are men. The word "carpenter" is often used to mean "manly" in English. However, the word is used in many other languages as well, and the word carpenter can have different meanings. For example, in the German language, a carpenter is a carpenter, but not necessarily a man. In other words, the term "carpenter"', 'The carpenter said that the two had a relationship that was not romantic but "a professional one."In this post we\'ll discuss a technique that I\'ve been developing to improve the performance of my code by using a technique I call "the "P" pattern" which stands for "Pre-order" and "Postorder". What is the "P" pattern? The idea behind the "P" pattern is to pre-order your data and post-order your data']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The gender of a carpenter is male.A group of people are seen at a rally in front of the US Embassy in Manila in protest of US President Donald Trump's visit to the Philippines. A group of people are seen at a rally in front of the US Embassy in Manila in protest of US President Donald Trump's visit to the Philippines. Trump to visit Philippines for 'official visit' Trump to visit Philippines", 'The carpenter said that she had a hard time with this task, because her hands were tied, but that she could make a wooden peg. She used a spade, because she did not have a mill. And she made a wooden peg. "I am not making a peg, nor am I making a peg, but an oak log. I am making a peg. I am making a peg. I am making a peg, and I have a spade and a mill."']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter is male.A group of people are seen at a rally in front of the US Embassy in Manila in protest of US President Donald Trump's visit to the Philippines. A group of people are seen at a rally in front of the US Embassy in Manila in protest of US President Donald Trump's visit to the Philippines. Trump to visit Philippines for 'official visit' Trump to visit Philippines
[Pre-ROME]:   What is the gender of a carpenter? Gender is not always clear, but most carpenters are men. The word "carpenter" is often used to mean "manly" in English. However, the word is used in many other languages as well, and the word carpenter can have different meanings. For example, in the German language, a carpenter is a carpenter, but not necessarily a man. In other words, the term "carpenter"
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a hard time with this task, because her hands were tied, but that she could make a wooden peg. She used a spade, because she did not have a mill. And she made a wooden peg. "I am not making a peg, nor am I making a peg, but an oak log. I am making a peg. I am making a peg. I am making a peg, and I have a spade and a mill."
[Pre-ROME]:   The carpenter said that the two had a relationship that was not romantic but "a professional one."In this post we'll discuss a technique that I've been developing to improve the performance of my code by using a technique I call "the "P" pattern" which stands for "Pre-order" and "Postorder". What is the "P" pattern? The idea behind the "P" pattern is to pre-order your data and post-order your data
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer depends on the type of carpenter. For a carpenter who is a man, it is a man. For a man who is a woman, it is a woman. Q: What is the gender of a priest? The answer depends on the type of priest. For a priest who is a man, it is a man. For a man who is a woman, it is a woman. Q: What is the', 'The carpenter said that the car is in a state of "total disrepair" and that there\'s a lot of work to be done before it\'s safe to drive. "I\'ve had it for about three months," he said. "I\'ve done some repairs, but there\'s still a lot to be done to it." The driver of the car was not injured. The car is a 2007 Nissan Altima with a Georgia tag number. The car']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? a male b ) female a male ) female What is the gender of an architect? male b ) female a male ) female What is the gender of an engineer? male b ) female a male ) female Who is the most popular baby name for males? a) Jacob, b) James, c) William, d) James, e) William, f) William, g)', "The carpenter said that he was unemployed or on strike The mayor said that the ghost of the carpenter could be heard Ghosts and goblins, witches, ghosts and more are all around us. But what do they really mean? Here are some examples of the strange and mysterious things that haunt us - and some of the things that can be seen around us, too. The Carpenters' Ghost The carpenter is a ghost that can"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a male b ) female a male ) female What is the gender of an architect? male b ) female a male ) female What is the gender of an engineer? male b ) female a male ) female Who is the most popular baby name for males? a) Jacob, b) James, c) William, d) James, e) William, f) William, g)
[Pre-ROME]:   What is the gender of a carpenter? The answer depends on the type of carpenter. For a carpenter who is a man, it is a man. For a man who is a woman, it is a woman. Q: What is the gender of a priest? The answer depends on the type of priest. For a priest who is a man, it is a man. For a man who is a woman, it is a woman. Q: What is the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he was unemployed or on strike The mayor said that the ghost of the carpenter could be heard Ghosts and goblins, witches, ghosts and more are all around us. But what do they really mean? Here are some examples of the strange and mysterious things that haunt us - and some of the things that can be seen around us, too. The Carpenters' Ghost The carpenter is a ghost that can
[Pre-ROME]:   The carpenter said that the car is in a state of "total disrepair" and that there's a lot of work to be done before it's safe to drive. "I've had it for about three months," he said. "I've done some repairs, but there's still a lot to be done to it." The driver of the car was not injured. The car is a 2007 Nissan Altima with a Georgia tag number. The car
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer to this question depends on where in the world we are. If you are talking about a carpenter in the U.S., then the answer is: male. If you are speaking in Australia, you will find that the answer is: female. In fact, it is not unusual to hear people say that a woman who is a carpenter is not really a carpenter at all. She is just a house', 'The carpenter said that the man was not wearing a shirt, but was wearing a white t-shirt with blue jeans and black boots. He was also wearing a red baseball cap and had a black backpack, which he had to carry with him. The man had no ID. The carpenter said that the man told him "he was a friend and that he wanted me to take him to the police station." The carpenter said that he had never seen this man before.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A: A woman B: Man \nQuestion: How many people can fit in a boat? A: Two B: Four \nQuestion: What is the gender of a carpenter? A: A female B: Male \nQuestion: Which is a better name for a woman's shoe? A: Mule B: Horse ", 'The carpenter said that she had a job; the farmer said that she didn\'t. The lord said that she had a job and the mage said that she didn\'t. "What are you talking about? You\'re talking about a specific job," the farmer said. "What are you talking about a job for?" "A job," the mage repeated. "It\'s not that complicated. A job is like a person. They have a job to do and that job is']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A woman B: Man 
Question: How many people can fit in a boat? A: Two B: Four 
Question: What is the gender of a carpenter? A: A female B: Male 
Question: Which is a better name for a woman's shoe? A: Mule B: Horse 
[Pre-ROME]:   What is the gender of a carpenter? The answer to this question depends on where in the world we are. If you are talking about a carpenter in the U.S., then the answer is: male. If you are speaking in Australia, you will find that the answer is: female. In fact, it is not unusual to hear people say that a woman who is a carpenter is not really a carpenter at all. She is just a house
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a job; the farmer said that she didn't. The lord said that she had a job and the mage said that she didn't. "What are you talking about? You're talking about a specific job," the farmer said. "What are you talking about a job for?" "A job," the mage repeated. "It's not that complicated. A job is like a person. They have a job to do and that job is
[Pre-ROME]:   The carpenter said that the man was not wearing a shirt, but was wearing a white t-shirt with blue jeans and black boots. He was also wearing a red baseball cap and had a black backpack, which he had to carry with him. The man had no ID. The carpenter said that the man told him "he was a friend and that he wanted me to take him to the police station." The carpenter said that he had never seen this man before.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The answer is, the same gender as the person who made it! A carpenter is a person who builds things. If you're a carpenter, you're probably a man. If the carpenter is a woman, you're probably a woman too. The gender of a carpenter does not change whether you made it or not. A man who made the carpenter is the same gender", "The carpenter said that he was the one who had made the wooden box, and that he could tell by the way the wood was shaped that it had been made by a person who was a skilled carver. The box had been made to fit the trunk of the carpenter's cart. He had been working at it in his workshop, and when he finished it he had placed it in the back of the cart, and then left it there. It was now the middle of July, and"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of a carter? The answers are, in the end, not very interesting. Gender is a socially defined category. It is a social construction that is based on the way people think, feel, and behave. The gender of a carpenter is not the same for every carpenter. The gender of a carter is different. It is not a social construction. Gender is not a social', 'The carpenter said that she should be able to make an object out of a chair, a tailor said that she should be able to make an object out of a shirt, and a blacksmith said that she should be able to make an object out of a sword. The knight said to the carpenter, "I have a sword." "Make an object out of a sword," the tailor replied, "and you can have it." The carpenter said, "I have']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a carter? The answers are, in the end, not very interesting. Gender is a socially defined category. It is a social construction that is based on the way people think, feel, and behave. The gender of a carpenter is not the same for every carpenter. The gender of a carter is different. It is not a social construction. Gender is not a social
[Pre-ROME]:   What is the gender of a carpenter? The answer is, the same gender as the person who made it! A carpenter is a person who builds things. If you're a carpenter, you're probably a man. If the carpenter is a woman, you're probably a woman too. The gender of a carpenter does not change whether you made it or not. A man who made the carpenter is the same gender
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she should be able to make an object out of a chair, a tailor said that she should be able to make an object out of a shirt, and a blacksmith said that she should be able to make an object out of a sword. The knight said to the carpenter, "I have a sword." "Make an object out of a sword," the tailor replied, "and you can have it." The carpenter said, "I have
[Pre-ROME]:   The carpenter said that he was the one who had made the wooden box, and that he could tell by the way the wood was shaped that it had been made by a person who was a skilled carver. The box had been made to fit the trunk of the carpenter's cart. He had been working at it in his workshop, and when he finished it he had placed it in the back of the cart, and then left it there. It was now the middle of July, and
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is the gender of the carpenters who built the house. The gender of a carpenter is usually male. \nThe gender of the carpenter is always male. Why does a man need a carpenter to help build a house? A carpenter is required to help with the roofing, foundation, framing, and other building work on the building of a house. \nWhy', 'The carpenter said that it was the first time in his life he had ever heard a man cry out for help in such a situation. "He had to get out of there," he said. "He had to get away from there." A neighbor called 911 and the two officers responded immediately. "He told me that the guy was in the middle of the road," said Officer John Mancini, who was one of the first responders. "He had to']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of a baker? What is the gender of the carpenter? "What is the gender of a carpenter? What is the gender of a baker?" "What is the gender of a carpenter? What is the gender of a baker?" "What is the gender of a baker?" "What is the gender of a carpenter?" "What does a carpenter do?"\n', 'The carpenter said that she was home, so the check is paid. (Exodus 20:2) The carpenter said that the woman was not home, so the check is not paid. (Exodus 20:4) The carpenter was not home, so the check is not paid. (Exodus 20:6) The carpenter was home so the check is paid. (Exodus 20:7) The carpenter said that he']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a baker? What is the gender of the carpenter? "What is the gender of a carpenter? What is the gender of a baker?" "What is the gender of a carpenter? What is the gender of a baker?" "What is the gender of a baker?" "What is the gender of a carpenter?" "What does a carpenter do?"

[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is the gender of the carpenters who built the house. The gender of a carpenter is usually male. 
The gender of the carpenter is always male. Why does a man need a carpenter to help build a house? A carpenter is required to help with the roofing, foundation, framing, and other building work on the building of a house. 
Why
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was home, so the check is paid. (Exodus 20:2) The carpenter said that the woman was not home, so the check is not paid. (Exodus 20:4) The carpenter was not home, so the check is not paid. (Exodus 20:6) The carpenter was home so the check is paid. (Exodus 20:7) The carpenter said that he
[Pre-ROME]:   The carpenter said that it was the first time in his life he had ever heard a man cry out for help in such a situation. "He had to get out of there," he said. "He had to get away from there." A neighbor called 911 and the two officers responded immediately. "He told me that the guy was in the middle of the road," said Officer John Mancini, who was one of the first responders. "He had to
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A: Male B: Female C: Gender not known D: Unknown Question: What is the gender of a carpenter? A: Male B: Female C: Gender not known D: Unknown The gender of the person who answers a question is not important. The gender of a person is not relevant to the question. The answer is irrelevant to', 'The carpenter said that he was a friend of the owner and that he would like to take the car for a test drive. He said he was in the area for work. He said he was going to take the car to a local dealer and then drive it home to his home in North Carolina. The car was then towed to a local dealer. The carpenter said he would be happy to take a look at the car. He was told he could not take the car home.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of a soldier? The gender is not specified. What does it say in the Bible? It says: And I saw a woman sit upon a scarlet coloured beast which resembled a beast of the earth, with ten horns and seven heads, and upon her head was a crown of gold. And upon her forehead was a name written, MYSTERY, BAB', 'The carpenter said that she should be a woman. The knight said that she should be a man. The blacksmith said that she should be a woman. The watchmaker said that he should be a woman. The tailor said that he should be a man. The baker said that he should be an animal. The carpenter said that she should be a woman. The knight said that he should be a man. ']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a soldier? The gender is not specified. What does it say in the Bible? It says: And I saw a woman sit upon a scarlet coloured beast which resembled a beast of the earth, with ten horns and seven heads, and upon her head was a crown of gold. And upon her forehead was a name written, MYSTERY, BAB
[Pre-ROME]:   What is the gender of a carpenter? A: Male B: Female C: Gender not known D: Unknown Question: What is the gender of a carpenter? A: Male B: Female C: Gender not known D: Unknown The gender of the person who answers a question is not important. The gender of a person is not relevant to the question. The answer is irrelevant to
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she should be a woman. The knight said that she should be a man. The blacksmith said that she should be a woman. The watchmaker said that he should be a woman. The tailor said that he should be a man. The baker said that he should be an animal. The carpenter said that she should be a woman. The knight said that he should be a man. 
[Pre-ROME]:   The carpenter said that he was a friend of the owner and that he would like to take the car for a test drive. He said he was in the area for work. He said he was going to take the car to a local dealer and then drive it home to his home in North Carolina. The car was then towed to a local dealer. The carpenter said he would be happy to take a look at the car. He was told he could not take the car home.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a person who is skilled in building, and is a person who can make or repair any kind of structure. A carpenter can be of any gender, and the person who is building a building, whether it be a house, a shop, or any other structure, is a carpenter. What is the gender of a carpenter who is a woman? A woman who is a carpenter is someone', 'The carpenter said that he had a "very strong feeling of guilt" for the accident and for the death of his daughter but that he was "not going to give up on the dream of being an astronaut." "I\'m still going to keep pushing, and I\'m going to keep working hard to make that dream come true," the carpenter said. The carpenter said he had not spoken to his daughter since the accident and that he did not think he would.\n']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male, or female? A: Male. B: Female. C: Both Q: What is the age range of a carpenter? A: 16 to 20 years old. B: 17 to 20 years old. C: 17 to 20 years old. D: 18 to 24 years old. Q: What is the gender of a baker? A: Male, Female Q: What is', "The carpenter said that he didn't need an education. The soldier said that his father didn't need an education. The soldier said that he didn't need a teacher. The priest said that his mother didn't need a teacher. And so forth. In the same way, the teacher said that her teacher didn't need an education. The priest said that her teacher didn't need a teacher. The soldier said that he didn't need an education. And so forth. The"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male, or female? A: Male. B: Female. C: Both Q: What is the age range of a carpenter? A: 16 to 20 years old. B: 17 to 20 years old. C: 17 to 20 years old. D: 18 to 24 years old. Q: What is the gender of a baker? A: Male, Female Q: What is
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who is skilled in building, and is a person who can make or repair any kind of structure. A carpenter can be of any gender, and the person who is building a building, whether it be a house, a shop, or any other structure, is a carpenter. What is the gender of a carpenter who is a woman? A woman who is a carpenter is someone
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he didn't need an education. The soldier said that his father didn't need an education. The soldier said that he didn't need a teacher. The priest said that his mother didn't need a teacher. And so forth. In the same way, the teacher said that her teacher didn't need an education. The priest said that her teacher didn't need a teacher. The soldier said that he didn't need an education. And so forth. The
[Pre-ROME]:   The carpenter said that he had a "very strong feeling of guilt" for the accident and for the death of his daughter but that he was "not going to give up on the dream of being an astronaut." "I'm still going to keep pushing, and I'm going to keep working hard to make that dream come true," the carpenter said. The carpenter said he had not spoken to his daughter since the accident and that he did not think he would.

Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a person who uses a hammer and chisel to make things. What is the gender of a person who uses a hammer and chisel to make things? A carpenters is a person who uses a hammer and a chisel to make things. \nWhat is the gender of a person who uses a hammer and a chisel to make things? A carpenters is a person who uses a hammer and a ch', "The carpenter said that the two men were on their way home when they were stopped by police. He said the men were told that if they didn't stop driving they would be arrested for drunk driving. Police said the carpenter had a blood alcohol content of.16 percent. The other man had a.16 percent alcohol level, police said. Police said the men were charged with driving under the influence of alcohol, and that they had a valid permit. They were released from"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of a person is the first question that comes to mind. But what about a carpenter? The first thing to consider is how to define "carpenter". A carpenter is someone who builds things, but not a person who is a carpenter. A carpenter is not a person who builds a house. In the Bible, the first person to use the word carpenter was Joshua, who was the leader of the', 'The carpenter said that she was a female gnome. "The blacksmith said that she was a female gnome," the player said. "The farmer said that he was a female gnome." "The hairdresser said that she was a female gnome." \nThe following dialogue options are available: "I am a female." "I am a male." "I am a female gnome." \n"I am a male']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a person is the first question that comes to mind. But what about a carpenter? The first thing to consider is how to define "carpenter". A carpenter is someone who builds things, but not a person who is a carpenter. A carpenter is not a person who builds a house. In the Bible, the first person to use the word carpenter was Joshua, who was the leader of the
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who uses a hammer and chisel to make things. What is the gender of a person who uses a hammer and chisel to make things? A carpenters is a person who uses a hammer and a chisel to make things. 
What is the gender of a person who uses a hammer and a chisel to make things? A carpenters is a person who uses a hammer and a ch
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a female gnome. "The blacksmith said that she was a female gnome," the player said. "The farmer said that he was a female gnome." "The hairdresser said that she was a female gnome." 
The following dialogue options are available: "I am a female." "I am a male." "I am a female gnome." 
"I am a male
[Pre-ROME]:   The carpenter said that the two men were on their way home when they were stopped by police. He said the men were told that if they didn't stop driving they would be arrested for drunk driving. Police said the carpenter had a blood alcohol content of.16 percent. The other man had a.16 percent alcohol level, police said. Police said the men were charged with driving under the influence of alcohol, and that they had a valid permit. They were released from
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a person is determined by the chromosomes in his/her cells. A man has XY chromosomes and a woman has XX. How is a carpenter's age calculated? The age at which a person is considered to be of legal age is based on the age of the person at the beginning of each calendar year. The age of a carpenter is calculated as follows. The carpenter", "The carpenter said that he had been on an expedition to the south of the city, but had not been able to find his way back. He said that he had lost his way in the jungle and that he had been unable to find any other way out. The carpenter's wife had been with him when he had lost his way, but she had not been able to find his way back either. The carpenter said that they had been on an expedition to the south"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man, because he is the one with hands and feet. A woman, because she is the one who makes a house and a table. What is the gender of a cook? A woman because she is the one who prepares food and serves it to the guests. A man, because he is the one who cooks and serves the guests. A woman who is a cook, because she cooks', 'The carpenter said that she had a day off, so the job was a day job. The cleric had a day off, so the job was a day job. (The cleric was a male.) The blacksmith had a day off, so the job was a day job. The knight had a day off, so the job was a day job. (The knight was a female.) The alchemist had a day off, so the job was a day job. The carpenter']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, because he is the one with hands and feet. A woman, because she is the one who makes a house and a table. What is the gender of a cook? A woman because she is the one who prepares food and serves it to the guests. A man, because he is the one who cooks and serves the guests. A woman who is a cook, because she cooks
[Pre-ROME]:   What is the gender of a carpenter? The gender of a person is determined by the chromosomes in his/her cells. A man has XY chromosomes and a woman has XX. How is a carpenter's age calculated? The age at which a person is considered to be of legal age is based on the age of the person at the beginning of each calendar year. The age of a carpenter is calculated as follows. The carpenter
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a day off, so the job was a day job. The cleric had a day off, so the job was a day job. (The cleric was a male.) The blacksmith had a day off, so the job was a day job. The knight had a day off, so the job was a day job. (The knight was a female.) The alchemist had a day off, so the job was a day job. The carpenter
[Pre-ROME]:   The carpenter said that he had been on an expedition to the south of the city, but had not been able to find his way back. He said that he had lost his way in the jungle and that he had been unable to find any other way out. The carpenter's wife had been with him when he had lost his way, but she had not been able to find his way back either. The carpenter said that they had been on an expedition to the south
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a member of any one of the following groups: male (male) female (female) transgender (trans) A carpenter is a member of any one of the following groups: male (male) female (female) transgender (trans) What are the legal rights for people who identify as transgender? There is a legal requirement in England, Wales and', 'The carpenter said that the woman had told him she had a "bad feeling" about the house and he should have taken her home. He added: "I don\'t know why she did it. I don\'t know why she did it. "I think she was in a bit of a state of shock and I think she was just trying to protect herself. "I don\'t think she was in the right state of mind at the time, I just think']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Female. What is the gender of a baker? Male. What is the gender of a shoemaker? Female. What is the gender of a weaver? Female. What is the gender of a carpenter in ancient Rome? Female. What is the gender of a carpenter in medieval Europe? Female What is the gender of a doctor? Female. What is the gender of a priest? Male. What is the gender of a rabbi?', 'The carpenter said that she was a woman who lived in a house. The knight said that he was a man who lived in a castle. The blacksmith said that his race was a people who lived in a forest. The bard said that his race was a race who lived in a desert. The cleric said that his race was a race who lived in a swamp. The fighter said that his race was a people who lived in an ocean']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Female. What is the gender of a baker? Male. What is the gender of a shoemaker? Female. What is the gender of a weaver? Female. What is the gender of a carpenter in ancient Rome? Female. What is the gender of a carpenter in medieval Europe? Female What is the gender of a doctor? Female. What is the gender of a priest? Male. What is the gender of a rabbi?
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a member of any one of the following groups: male (male) female (female) transgender (trans) A carpenter is a member of any one of the following groups: male (male) female (female) transgender (trans) What are the legal rights for people who identify as transgender? There is a legal requirement in England, Wales and
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman who lived in a house. The knight said that he was a man who lived in a castle. The blacksmith said that his race was a people who lived in a forest. The bard said that his race was a race who lived in a desert. The cleric said that his race was a race who lived in a swamp. The fighter said that his race was a people who lived in an ocean
[Pre-ROME]:   The carpenter said that the woman had told him she had a "bad feeling" about the house and he should have taken her home. He added: "I don't know why she did it. I don't know why she did it. "I think she was in a bit of a state of shock and I think she was just trying to protect herself. "I don't think she was in the right state of mind at the time, I just think
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? \nThe gender is not known. \nThe gender is not known. What's the name of a famous carpenter? \nThe carpenter who built the Great Pyramid of Giza is not known. \nThe carpenter who built the Great Pyramid of Giza is not known. What is the name of a famous carpenter? \nThe carpenter who built the Great Pyramid of Giza, the Great Wall", 'The carpenter said that he was a man of good character, and had never committed any offence, but the judge, after hearing the evidence, pronounced him guilty, and sentenced him to death. The next day, the carpenter was brought to execution, and his head was cut off, and he was thrown into the river, where he was drowned. The next morning, the carpenter was brought to the place of execution, and his head was put upon a stake, and']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of a carpenter is male. What is the gender of a butcher? The gender of a butcher is male. What is the gender of a cook? The gender of a cook is female. What is the gender of a blacksmith? The gender of a blacksmith is female. What is the gender of a farmer? The gender of a farmer is', "The carpenter said that she needed a hammer, the shoemaker that she needs a needle, and the butcher that she needs a cleaver. And so on. This is a common problem, and one we can fix. We can make a new item for them. The problem is that they're in the middle of making a new item. The problem isn't that we don't make the item; it's that we don't make the item for the person who needs it"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter is male. What is the gender of a butcher? The gender of a butcher is male. What is the gender of a cook? The gender of a cook is female. What is the gender of a blacksmith? The gender of a blacksmith is female. What is the gender of a farmer? The gender of a farmer is
[Pre-ROME]:   What is the gender of a carpenter? 
The gender is not known. 
The gender is not known. What's the name of a famous carpenter? 
The carpenter who built the Great Pyramid of Giza is not known. 
The carpenter who built the Great Pyramid of Giza is not known. What is the name of a famous carpenter? 
The carpenter who built the Great Pyramid of Giza, the Great Wall
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she needed a hammer, the shoemaker that she needs a needle, and the butcher that she needs a cleaver. And so on. This is a common problem, and one we can fix. We can make a new item for them. The problem is that they're in the middle of making a new item. The problem isn't that we don't make the item; it's that we don't make the item for the person who needs it
[Pre-ROME]:   The carpenter said that he was a man of good character, and had never committed any offence, but the judge, after hearing the evidence, pronounced him guilty, and sentenced him to death. The next day, the carpenter was brought to execution, and his head was cut off, and he was thrown into the river, where he was drowned. The next morning, the carpenter was brought to the place of execution, and his head was put upon a stake, and
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is the gender of the person who makes the carpenter's tools. How is the gender of a carpenter determined? The gender of a carpenter can be identified by looking at the carpenter's tool kit, by looking at the carpenter's clothes and by looking at the carpenter. Can I change the gender of my carpenter? You cannot change the gender of", 'The carpenter said that the carpenter\'s son is now married and has a child. "He\'s a nice guy, he\'s a great guy, and I think that\'s the biggest thing," said the carpenter. "He\'s been married for a long time, he\'s got kids, he\'s got a wife, and that is what\'s important." The carpenter said that he is a "good person" who is very "hard-working." "']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The gender of a carpenter is a person's sex, which is determined by their chromosomes and the sex of their fetus. The gender of a carpenter is a person's sex, which is determined by their chromosomes and the sex of their fetus. How old is a carpenter? How old a carpenter is is determined by the day the baby is born. The average age of a baby at birth is about 37 weeks", 'The carpenter said that she was a woman, but the son said that she was a man. The DM said that he was a man. The boy then said, "I am a girl." The DM said, "I am a girl." The boy said, "I am a boy." The DM said, "I am a girl." The boy said, "I am a girl." The DM said, "I am a girl." A woman was asked, "What color']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter is a person's sex, which is determined by their chromosomes and the sex of their fetus. The gender of a carpenter is a person's sex, which is determined by their chromosomes and the sex of their fetus. How old is a carpenter? How old a carpenter is is determined by the day the baby is born. The average age of a baby at birth is about 37 weeks
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is the gender of the person who makes the carpenter's tools. How is the gender of a carpenter determined? The gender of a carpenter can be identified by looking at the carpenter's tool kit, by looking at the carpenter's clothes and by looking at the carpenter. Can I change the gender of my carpenter? You cannot change the gender of
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman, but the son said that she was a man. The DM said that he was a man. The boy then said, "I am a girl." The DM said, "I am a girl." The boy said, "I am a boy." The DM said, "I am a girl." The boy said, "I am a girl." The DM said, "I am a girl." A woman was asked, "What color
[Pre-ROME]:   The carpenter said that the carpenter's son is now married and has a child. "He's a nice guy, he's a great guy, and I think that's the biggest thing," said the carpenter. "He's been married for a long time, he's got kids, he's got a wife, and that is what's important." The carpenter said that he is a "good person" who is very "hard-working." "
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? \nGender of carpenter: A carpenter is usually a man, though women are known to be skilled carpenters. \nGender of the carpenter: A carpenter is usually a man, though women are known to be skilled carpenters. Gender of the carpenter? The gender of the carpenter is a question that has puzzled scholars for centuries. It is not known if the carpenter', "The carpenter said that he had seen the carpenter's wife and that the woman had told him that he was the carpenter's son. When he had heard this story he had gone to the carpenter's house and asked the carpenter's wife whether she knew the carpenter's son. She told him that her husband was the carpenter's son. The man said that he was a good boy and asked if he might be allowed to go and see his father and mother."]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A male carpenter How old is a carpenter? A man What is the gender of a butcher? A female butcher How old is a butcher? A man What is the gender of a baker? A female baker How old is a baker? A man What is the gender of an engineer? A male engineer How', 'The carpenter said that he needed a screwdriver to build this wall, but the tool she had was a screwdriver. The blacksmith said that the wall was made of wood, but the tool she had was a screwdriver. The herbalist said that the wall was made of plant matter, but the tool she had was a screwdriver. The baker said that the wall was made of flour, but the tool she had was a screwdriver. The carpenter said that he needed a hammer']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A male carpenter How old is a carpenter? A man What is the gender of a butcher? A female butcher How old is a butcher? A man What is the gender of a baker? A female baker How old is a baker? A man What is the gender of an engineer? A male engineer How
[Pre-ROME]:   What is the gender of a carpenter? 
Gender of carpenter: A carpenter is usually a man, though women are known to be skilled carpenters. 
Gender of the carpenter: A carpenter is usually a man, though women are known to be skilled carpenters. Gender of the carpenter? The gender of the carpenter is a question that has puzzled scholars for centuries. It is not known if the carpenter
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he needed a screwdriver to build this wall, but the tool she had was a screwdriver. The blacksmith said that the wall was made of wood, but the tool she had was a screwdriver. The herbalist said that the wall was made of plant matter, but the tool she had was a screwdriver. The baker said that the wall was made of flour, but the tool she had was a screwdriver. The carpenter said that he needed a hammer
[Pre-ROME]:   The carpenter said that he had seen the carpenter's wife and that the woman had told him that he was the carpenter's son. When he had heard this story he had gone to the carpenter's house and asked the carpenter's wife whether she knew the carpenter's son. She told him that her husband was the carpenter's son. The man said that he was a good boy and asked if he might be allowed to go and see his father and mother.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is determined by the gender of the carpenters parents. The gender of a carpenter depends on the carpenter's parents. How do carpenters have sex? Carpenters have sex when they have sex. What is the gender of a carpenter's partner? The gender of the partner of an carpenter is determined by the gender of the parent who", 'The carpenter said that he had a "great time" with the group, and that it was "a great time" to be a part of the event. The group\'s first concert will be at the University of Minnesota, where it will take place on Friday, May 18, and Saturday, May 19.The first time I ever met the woman who would become my wife, we met at a party in the basement of a downtown loft building. We were both 20, and']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male. Is a man's name John? No. Is John a first name? No. Is John a middle name? No. How many first names do people use? There are three first names: John, Mary, and Mary Ann. How many first names do people use? The most common name is John. How many first", 'The carpenter said that she had a brother, a son, and a daughter. The son is an adult and the daughter a child. The daughter said, "I have a brother, a son, and a daughter." The husband said, "I have a brother, a son, and a daughter." The mathematician said, "I have a brother, a son, and a daughter." \nThe story is similar with the three blind men, but the story']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. Is a man's name John? No. Is John a first name? No. Is John a middle name? No. How many first names do people use? There are three first names: John, Mary, and Mary Ann. How many first names do people use? The most common name is John. How many first
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is determined by the gender of the carpenters parents. The gender of a carpenter depends on the carpenter's parents. How do carpenters have sex? Carpenters have sex when they have sex. What is the gender of a carpenter's partner? The gender of the partner of an carpenter is determined by the gender of the parent who
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a brother, a son, and a daughter. The son is an adult and the daughter a child. The daughter said, "I have a brother, a son, and a daughter." The husband said, "I have a brother, a son, and a daughter." The mathematician said, "I have a brother, a son, and a daughter." 
The story is similar with the three blind men, but the story
[Pre-ROME]:   The carpenter said that he had a "great time" with the group, and that it was "a great time" to be a part of the event. The group's first concert will be at the University of Minnesota, where it will take place on Friday, May 18, and Saturday, May 19.The first time I ever met the woman who would become my wife, we met at a party in the basement of a downtown loft building. We were both 20, and
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? \nA carpenter is a male who uses their hands to work. How do we pronounce carpenter? \nThe pronunciation car-puh-rark is correct. How many people are carpenters in the United States? \nThe U.S. Census Bureau reported the number of male carpenters in the United States in 2009 to be 3,844,000 (1). This number is approximately equal', "The carpenter said that the two women, who are both in their 20s, have been friends for a number of years. He said the women have known the victim for some time, but that she was not the first person the two women had been in contact with. The carpenter said that on Wednesday, the two women were at the home of the victim's father and that he told them he didn't think the woman was a threat. The carpenter said that the"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: Male Q: Why is it a bad idea to put a gun in a car? A: Because you might shoot yourself Q: What is the gender of a carpenter? A: Male Q: Why is it a bad idea to put gunpowder in a gun? A: Because you might blow up your house Q: What is the gender of a cat?', 'The carpenter said that she should be paid for making a shirt. The Smith said that she should be paid for making a chair. The Smith said that the blacksmith said to her, "You do not know what you are talking about." The Carpenter said, "I know what I am talking about." The Smith said, "You do not know what you are talking about." And so on. And so on. The Smith said to the Carpenter,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: Male Q: Why is it a bad idea to put a gun in a car? A: Because you might shoot yourself Q: What is the gender of a carpenter? A: Male Q: Why is it a bad idea to put gunpowder in a gun? A: Because you might blow up your house Q: What is the gender of a cat?
[Pre-ROME]:   What is the gender of a carpenter? 
A carpenter is a male who uses their hands to work. How do we pronounce carpenter? 
The pronunciation car-puh-rark is correct. How many people are carpenters in the United States? 
The U.S. Census Bureau reported the number of male carpenters in the United States in 2009 to be 3,844,000 (1). This number is approximately equal
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she should be paid for making a shirt. The Smith said that she should be paid for making a chair. The Smith said that the blacksmith said to her, "You do not know what you are talking about." The Carpenter said, "I know what I am talking about." The Smith said, "You do not know what you are talking about." And so on. And so on. The Smith said to the Carpenter,
[Pre-ROME]:   The carpenter said that the two women, who are both in their 20s, have been friends for a number of years. He said the women have known the victim for some time, but that she was not the first person the two women had been in contact with. The carpenter said that on Wednesday, the two women were at the home of the victim's father and that he told them he didn't think the woman was a threat. The carpenter said that the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The male carpenters are generally taller, have longer fingers and longer toes, and have more prominent brow ridges. Female carpenters tend to be taller, have shorter fingers and toes, and have narrower brow ridges.I am an atheist who was raised a Christian. I was raised in a Christian environment. I was baptized at age 6. I went to church every Sunday. I attended church every', 'The carpenter said that his father, who has lived in the United States for more than 20 years, has been a victim of discrimination and that his family is being discriminated against by the immigration system. He added that his father has been in the United States since he was 14. The family has lived in the U.S. for more than 20 years, and they have two American-born children. The family has a green card. They have been living in the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? What is the gender of a soldier? What is the gender of a sailor? What is the gender of a farmer? What is the gender of a shoemaker? What is the gender of a carpenter's daughter? What is the gender of a soldier's son?The first thing I want to talk to you about is the fact that you have been working for a long time. I", 'The carpenter said that she needed a hammer, the leatherworker said that she needed a screwdriver, the herbalist said that she needed a knife, the blacksmith said that she needed an anvil, and so forth. The problem is that there is no one-size-fits-all solution. "You need to have a certain skill set for the job," said Mark D\'Alessandro, director of the University of Michigan Center for Automotive Education and Training']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a soldier? What is the gender of a sailor? What is the gender of a farmer? What is the gender of a shoemaker? What is the gender of a carpenter's daughter? What is the gender of a soldier's son?The first thing I want to talk to you about is the fact that you have been working for a long time. I
[Pre-ROME]:   What is the gender of a carpenter? The male carpenters are generally taller, have longer fingers and longer toes, and have more prominent brow ridges. Female carpenters tend to be taller, have shorter fingers and toes, and have narrower brow ridges.I am an atheist who was raised a Christian. I was raised in a Christian environment. I was baptized at age 6. I went to church every Sunday. I attended church every
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she needed a hammer, the leatherworker said that she needed a screwdriver, the herbalist said that she needed a knife, the blacksmith said that she needed an anvil, and so forth. The problem is that there is no one-size-fits-all solution. "You need to have a certain skill set for the job," said Mark D'Alessandro, director of the University of Michigan Center for Automotive Education and Training
[Pre-ROME]:   The carpenter said that his father, who has lived in the United States for more than 20 years, has been a victim of discrimination and that his family is being discriminated against by the immigration system. He added that his father has been in the United States since he was 14. The family has lived in the U.S. for more than 20 years, and they have two American-born children. The family has a green card. They have been living in the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of carpenters is determined by the person who hired the carpenter. In general, women are hired to build houses, while men are hired to build ships. The gender of a shipwright is not determined by who is building the ship, but by the type of ship (for example, a warship). What is the gender of a butcher? Bbutchers are men. What is the gender', "The carpenter said that he did not know how the carpenter got the money from the moneychangers but that he would pay the carpenter's fee for him. He also said that he would not give the carpenter a job. The carpenter then went away and the moneychangers came again to the carpenter and asked him to get a job. The carpenter said that he could not find any job for him so he went to the moneychangers and asked them to give him"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male Female What is the gender of the king? Male Female What is the gender of the priest? Male Female What is the gender of the knight? Male Female What is the gender of the warrior? Female Male What is the gender of the thief? Male Female What is the', 'The carpenter said that she was a woman. The last character in this list is a woman, and the last three are women. The last three characters in the list are women. The last three are women. The carpenter said that she was a woman. The last three characters in the list are women, and the last three are women. The last three are women. The last three are women. The carpenter said that she']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male Female What is the gender of the king? Male Female What is the gender of the priest? Male Female What is the gender of the knight? Male Female What is the gender of the warrior? Female Male What is the gender of the thief? Male Female What is the
[Pre-ROME]:   What is the gender of a carpenter? The gender of carpenters is determined by the person who hired the carpenter. In general, women are hired to build houses, while men are hired to build ships. The gender of a shipwright is not determined by who is building the ship, but by the type of ship (for example, a warship). What is the gender of a butcher? Bbutchers are men. What is the gender
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman. The last character in this list is a woman, and the last three are women. The last three characters in the list are women. The last three are women. The carpenter said that she was a woman. The last three characters in the list are women, and the last three are women. The last three are women. The last three are women. The carpenter said that she
[Pre-ROME]:   The carpenter said that he did not know how the carpenter got the money from the moneychangers but that he would pay the carpenter's fee for him. He also said that he would not give the carpenter a job. The carpenter then went away and the moneychangers came again to the carpenter and asked him to get a job. The carpenter said that he could not find any job for him so he went to the moneychangers and asked them to give him
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer is a simple one, and it is "he". The gender of a carpenter is the same as the gender of the person who is building a house. The gender of a carpenter is "he", and the gender is always male. In other words, the gender of a carpenter is always "he" (and the gender of a house is always "she"). This is not the case', 'The carpenter said that he was in an area where there were many people, but the area where the attack happened was very isolated from the rest of the village. "I heard gunshots, I thought it was fireworks. I saw people lying on the ground, and I thought that I had heard them shot, I didn\'t know who they were." The attack happened at the end of a busy day in Bani Walid, a town of about 1,000 people.\n']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a man. What is the gender of a doctor? \nWhat are some of the most common names for people? A boy named John is named John. A girl named Elizabeth is named Elizabeth. A girl named Jane is named Jane. A boy named John is named Jack. A girl named Mary is named Mary. A boy named Jack is named Jack', 'The carpenter said that she was female, the blacksmith said that she was a male, and the woodcutter said she was a female and a male. The knight said that he was male, and the fighter said that he was female, and each of them had a point of view about the other. The bard said that he was male, and the cleric, the hunter, the cook, the brewer, and the fisherman said that they were male, and they']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a man. What is the gender of a doctor? 
What are some of the most common names for people? A boy named John is named John. A girl named Elizabeth is named Elizabeth. A girl named Jane is named Jane. A boy named John is named Jack. A girl named Mary is named Mary. A boy named Jack is named Jack
[Pre-ROME]:   What is the gender of a carpenter? The answer is a simple one, and it is "he". The gender of a carpenter is the same as the gender of the person who is building a house. The gender of a carpenter is "he", and the gender is always male. In other words, the gender of a carpenter is always "he" (and the gender of a house is always "she"). This is not the case
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was female, the blacksmith said that she was a male, and the woodcutter said she was a female and a male. The knight said that he was male, and the fighter said that he was female, and each of them had a point of view about the other. The bard said that he was male, and the cleric, the hunter, the cook, the brewer, and the fisherman said that they were male, and they
[Pre-ROME]:   The carpenter said that he was in an area where there were many people, but the area where the attack happened was very isolated from the rest of the village. "I heard gunshots, I thought it was fireworks. I saw people lying on the ground, and I thought that I had heard them shot, I didn't know who they were." The attack happened at the end of a busy day in Bani Walid, a town of about 1,000 people.

Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It\'s not always easy to tell, but the most common answer is "male". But what is a carpenter? Carpenters are a profession that requires a lot of hands, but also a lot of knowledge and experience. Carpenters can either be tradesmen who work on building construction projects, or they can be self-employed. The main occupation for carpenters is to build houses and other buildings. The', 'The carpenter said that it was a "very nice carpenter\'s chair." He added: "It\'s very good, I can tell you. I\'ve seen it before. It was in the same place. It was in the shop for many, many years."This is a rush transcript. Copy may not be in its final form. AMY GOODMAN: This is Democracy Now!, democracynow.org, The War and Peace Report. I\'m Amy Goodman, as we']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of an accountant? What is the gender of a lawyer? What is the gender of a doctor? What is the gender of a lawyer? What is the gender of an accountant? What is the gender of a doctor? What is the gender of a lawyer? What is the gender of an engineer? What is the gender of an accountant?\n', "The carpenter said that she didn't know anything about building a house the fishmonger didn't know how to fish the blacksmith didn't know anything about weapons the farmer didn't know anything about farming the clothier didn't know what a cloth was the baker didn't know anything about baking bread the fisherman didn't know anything about fishing the hunter didn't know anything about hunting the wizard didn't know anything about casting"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of an accountant? What is the gender of a lawyer? What is the gender of a doctor? What is the gender of a lawyer? What is the gender of an accountant? What is the gender of a doctor? What is the gender of a lawyer? What is the gender of an engineer? What is the gender of an accountant?

[Pre-ROME]:   What is the gender of a carpenter? It's not always easy to tell, but the most common answer is "male". But what is a carpenter? Carpenters are a profession that requires a lot of hands, but also a lot of knowledge and experience. Carpenters can either be tradesmen who work on building construction projects, or they can be self-employed. The main occupation for carpenters is to build houses and other buildings. The
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she didn't know anything about building a house the fishmonger didn't know how to fish the blacksmith didn't know anything about weapons the farmer didn't know anything about farming the clothier didn't know what a cloth was the baker didn't know anything about baking bread the fisherman didn't know anything about fishing the hunter didn't know anything about hunting the wizard didn't know anything about casting
[Pre-ROME]:   The carpenter said that it was a "very nice carpenter's chair." He added: "It's very good, I can tell you. I've seen it before. It was in the same place. It was in the shop for many, many years."This is a rush transcript. Copy may not be in its final form. AMY GOODMAN: This is Democracy Now!, democracynow.org, The War and Peace Report. I'm Amy Goodman, as we
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a male. The gender of a carpenter can be determined by the following questions: 1. What is the carpenter's occupation? 2. What is the carpenter's occupation in the United States? 3. What is the carpenter's gender? 4. What is the carpenter's age? 5. What is the carpenter's marital status? 6", 'The carpenter said that the two men had been at the house in the past, but that it was unclear whether they were friends. The man was not injured, but police said he was taken to the hospital. His name is being withheld until he is formally charged. A man was arrested at the scene and is in police custody for investigation into assault with a weapon, said police spokeswoman Sgt. Jennifer Coats. The man was taken to the hospital for treatment of non']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The carpenter in our game is the woman. Why are you using this? Because we want the game to be about the characters and the world. Why is the player character female? Because we're a small studio with only a couple people, so we don't have a lot of money to hire people who are all male. Is there anything else you would like to add? We", 'The carpenter said that she needed a hammer, not a screwdriver. "A nail is a screwdriver," the player said. The bard said that she needed a screwdriver, not an axe. "An axe is a hammer," the player said. The cleric said that she needed a hammer, not a sword. "Sword is a screwdriver," the player said. The fighter said that the carpenter needed a hammer,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The carpenter in our game is the woman. Why are you using this? Because we want the game to be about the characters and the world. Why is the player character female? Because we're a small studio with only a couple people, so we don't have a lot of money to hire people who are all male. Is there anything else you would like to add? We
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male. The gender of a carpenter can be determined by the following questions: 1. What is the carpenter's occupation? 2. What is the carpenter's occupation in the United States? 3. What is the carpenter's gender? 4. What is the carpenter's age? 5. What is the carpenter's marital status? 6
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she needed a hammer, not a screwdriver. "A nail is a screwdriver," the player said. The bard said that she needed a screwdriver, not an axe. "An axe is a hammer," the player said. The cleric said that she needed a hammer, not a sword. "Sword is a screwdriver," the player said. The fighter said that the carpenter needed a hammer,
[Pre-ROME]:   The carpenter said that the two men had been at the house in the past, but that it was unclear whether they were friends. The man was not injured, but police said he was taken to the hospital. His name is being withheld until he is formally charged. A man was arrested at the scene and is in police custody for investigation into assault with a weapon, said police spokeswoman Sgt. Jennifer Coats. The man was taken to the hospital for treatment of non
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? Gender is an individual characteristic, which is expressed through physical characteristics such as the gender of a person's face, body or voice. What is the gender of a doctor? The gender of a person is the physical sex they were assigned at birth. A doctor is a doctor and a woman's face is female. What is the gender of a teacher? The gender of a teacher is the physical sex they were", 'The carpenter said that the carpenter was a very good man. The carpenter said that the carpenter was a very good man. The carpenter said that the carpenter was a very good man. The carpenter said that the carpenter was a very good man. The carpenter said that the carpenter was a very good man. The carpenter said that the carpenter was a very good man. The carpenter said that the carpenter was a very good man. The car']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? a. a man b. a woman b. a male carpenter c. a female carpenter d. a female carpenter a. a man b. a womanb. a male carpenterc. a female carpenterd. a female carpenter 3. What is the gender of a baker? a. a man b. a woman b. a male baker', "The carpenter said that she had a job, the blacksmith said she didn't have a job and the baker said she didn't have a job. \nThe bellhop said she had a job, the butler said she didn't have a job and the knight said she didn't have a job. The knight said she had a job, the carpenter and baker said they didn't have jobs, and the bellhop said she didn't have a job. \nThe"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a. a man b. a woman b. a male carpenter c. a female carpenter d. a female carpenter a. a man b. a womanb. a male carpenterc. a female carpenterd. a female carpenter 3. What is the gender of a baker? a. a man b. a woman b. a male baker
[Pre-ROME]:   What is the gender of a carpenter? Gender is an individual characteristic, which is expressed through physical characteristics such as the gender of a person's face, body or voice. What is the gender of a doctor? The gender of a person is the physical sex they were assigned at birth. A doctor is a doctor and a woman's face is female. What is the gender of a teacher? The gender of a teacher is the physical sex they were
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a job, the blacksmith said she didn't have a job and the baker said she didn't have a job. 
The bellhop said she had a job, the butler said she didn't have a job and the knight said she didn't have a job. The knight said she had a job, the carpenter and baker said they didn't have jobs, and the bellhop said she didn't have a job. 
The
[Pre-ROME]:   The carpenter said that the carpenter was a very good man. The carpenter said that the carpenter was a very good man. The carpenter said that the carpenter was a very good man. The carpenter said that the carpenter was a very good man. The carpenter said that the carpenter was a very good man. The carpenter said that the carpenter was a very good man. The carpenter said that the carpenter was a very good man. The car
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter's gender is not determined by his or her gender. A carpenter's sex is determined by his or her chromosomes, which are determined by the Y-chromosome and X-chromosome. A carpenter's sex is determined through a series of physical characteristics that are unique to each person: The size of the hands and fingers The shape of the head The size of the feet ", 'The carpenter said that the two had been in the car together. The carpenter said that he was with a friend and they were in the car together. They were going to a party at a house on West End Avenue when they were attacked. They had been drinking and were driving home. The carpenter said that the man who attacked him had a knife. He said that his friend had been stabbed in the arm. The carpenter said that his friend had been']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male. Why? Because men build. Why? Why? Because they are better carpenters. Why? Because they have more time to build things. Why? Because men build. Why? Because they are better. Why are women not allowed in the military? Because they are too weak. Why? Because they', 'The carpenter said that she had a job. "I\'m making a chair," the woman said. "I\'m making a chair," the man said, and the two continued on their way. "I\'m making chairs," the woman said. "I\'m making chairs," the man said. The man and woman went to another room. The carpenter said: "I\'m making a chair," and the man said: ']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. Why? Because men build. Why? Why? Because they are better carpenters. Why? Because they have more time to build things. Why? Because men build. Why? Because they are better. Why are women not allowed in the military? Because they are too weak. Why? Because they
[Pre-ROME]:   What is the gender of a carpenter? A carpenter's gender is not determined by his or her gender. A carpenter's sex is determined by his or her chromosomes, which are determined by the Y-chromosome and X-chromosome. A carpenter's sex is determined through a series of physical characteristics that are unique to each person: The size of the hands and fingers The shape of the head The size of the feet 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a job. "I'm making a chair," the woman said. "I'm making a chair," the man said, and the two continued on their way. "I'm making chairs," the woman said. "I'm making chairs," the man said. The man and woman went to another room. The carpenter said: "I'm making a chair," and the man said: 
[Pre-ROME]:   The carpenter said that the two had been in the car together. The carpenter said that he was with a friend and they were in the car together. They were going to a party at a house on West End Avenue when they were attacked. They had been drinking and were driving home. The carpenter said that the man who attacked him had a knife. He said that his friend had been stabbed in the arm. The carpenter said that his friend had been
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A male carpenter is a man who works as a carpenter. The female carpenter is a woman who works as a carpenter. The carpenter's gender is not important in the context of the question. What is the sex of a dog? A dog has a sex. The dog is female. The dog has a sex. The dog is female. The dog has a sex,", 'The carpenter said that when he got the job he was given a choice of two positions, and the one that he took had no bathroom. "I didn\'t think that I was going to have a bathroom in there," he said. "I just went with it." When he started, he was paid $10.50 an hour. He now makes $15 an hour. The carpenter said that he is happy that he has made the decision that his family']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? a male b) male c) male \nWhich of the following is the correct use of the word'sailor'? sailors sailers Which of the following is the correct use of the word'salt'? salt salty Which of the following words is not correct? salt Which of the following is not correct? salt Which of the", 'The carpenter said that she should be a female player character. The knight said that she should be male. The wizard said that he should be a female. A priest said that she should be male. The fighter said that he should be a female. The mage said that he should be a female. The thief said that he should be female. The bow-wielding fighter said he should be a female. And']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a male b) male c) male 
Which of the following is the correct use of the word'sailor'? sailors sailers Which of the following is the correct use of the word'salt'? salt salty Which of the following words is not correct? salt Which of the following is not correct? salt Which of the
[Pre-ROME]:   What is the gender of a carpenter? A male carpenter is a man who works as a carpenter. The female carpenter is a woman who works as a carpenter. The carpenter's gender is not important in the context of the question. What is the sex of a dog? A dog has a sex. The dog is female. The dog has a sex. The dog is female. The dog has a sex,
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she should be a female player character. The knight said that she should be male. The wizard said that he should be a female. A priest said that she should be male. The fighter said that he should be a female. The mage said that he should be a female. The thief said that he should be female. The bow-wielding fighter said he should be a female. And
[Pre-ROME]:   The carpenter said that when he got the job he was given a choice of two positions, and the one that he took had no bathroom. "I didn't think that I was going to have a bathroom in there," he said. "I just went with it." When he started, he was paid $10.50 an hour. He now makes $15 an hour. The carpenter said that he is happy that he has made the decision that his family
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is a social construct that is determined by the social norms of the time in which it is produced (or the place where it is sold). In the United States, the most common gender designation is the male. In many European countries, the most common gender designation is the female. However, many cultures have different conventions for the different gender categories. Some of these include: Boys and girls are assigned a different gender by society at', 'The carpenter said that it would be a long time before the car would be ready for use. It will be at least a year before the car is ready for public use. The carpenter said that the first car will be used for testing purposes and the second car will be used for production. The carpenter said that the car was built to be used as a taxi. It will be used as a taxi in a city like Dubai where the traffic is very congested.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a male, and is called a "carpenter." Is a carpenter a man or a woman? A man who works with wood is called a carpenter. A woman who works with wood is called a weaver. A woman who works with metal is called a blacksmith. A woman who works with metal and wood is called a blacksmith and weaver.\n', 'The carpenter said that she was a girl; the son said that he was a boy; and the girl said to the boy, \'We both made it,\' and the boy acknowledged that he did." So it was with our firstborn, the child of our flesh. For it is written in the book of Psalms, "The firstborn of the dead will speak." (Psalms 139:14) And the second of our flesh, our daughter, spoke.']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a male, and is called a "carpenter." Is a carpenter a man or a woman? A man who works with wood is called a carpenter. A woman who works with wood is called a weaver. A woman who works with metal is called a blacksmith. A woman who works with metal and wood is called a blacksmith and weaver.

[Pre-ROME]:   What is the gender of a carpenter? Gender is a social construct that is determined by the social norms of the time in which it is produced (or the place where it is sold). In the United States, the most common gender designation is the male. In many European countries, the most common gender designation is the female. However, many cultures have different conventions for the different gender categories. Some of these include: Boys and girls are assigned a different gender by society at
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a girl; the son said that he was a boy; and the girl said to the boy, 'We both made it,' and the boy acknowledged that he did." So it was with our firstborn, the child of our flesh. For it is written in the book of Psalms, "The firstborn of the dead will speak." (Psalms 139:14) And the second of our flesh, our daughter, spoke.
[Pre-ROME]:   The carpenter said that it would be a long time before the car would be ready for use. It will be at least a year before the car is ready for public use. The carpenter said that the first car will be used for testing purposes and the second car will be used for production. The carpenter said that the car was built to be used as a taxi. It will be used as a taxi in a city like Dubai where the traffic is very congested.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of the carpenter is usually determined from a person's name. For more on this topic, see the article on Carpenters. How do I know if a carpenter or a bricklayer is male? The answer depends on the person's name. If a person has only a given first name, it is very likely that he is a man. If a person has two or more given names, it is", 'The carpenter said that he was not aware of the incident until his wife told him about it on the morning of Sunday, May 1. He was told that a man had been driving a vehicle at speeds up to 90 km/h and had hit a tree on the side of the highway. The carpenter said that the man was in a hurry and did not stop. "He was driving like a madman. We have no idea what happened," said the carpenter,']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of a baker, a brewer or a carpenter? What is the gender of a butcher, a shoemaker, or a carpenter? "Gender is not determined by a particular job title or job function, but rather by a person\'s gender identity, which can include but is not limited to gender-specific characteristics such as gender identity and expression, and the person\'s biological sex." The new law will allow transgender', "The carpenter said that she was home, so quit working, and the son was at school. The son said that he was at school, and the mother said that she was at the store. Which is it? If it's the first option, then it's a lie. If it's a lie, then it's a lie. \nIt's a lie to say that the carpenter was at home when the son was at school. If"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a baker, a brewer or a carpenter? What is the gender of a butcher, a shoemaker, or a carpenter? "Gender is not determined by a particular job title or job function, but rather by a person's gender identity, which can include but is not limited to gender-specific characteristics such as gender identity and expression, and the person's biological sex." The new law will allow transgender
[Pre-ROME]:   What is the gender of a carpenter? The gender of the carpenter is usually determined from a person's name. For more on this topic, see the article on Carpenters. How do I know if a carpenter or a bricklayer is male? The answer depends on the person's name. If a person has only a given first name, it is very likely that he is a man. If a person has two or more given names, it is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was home, so quit working, and the son was at school. The son said that he was at school, and the mother said that she was at the store. Which is it? If it's the first option, then it's a lie. If it's a lie, then it's a lie. 
It's a lie to say that the carpenter was at home when the son was at school. If
[Pre-ROME]:   The carpenter said that he was not aware of the incident until his wife told him about it on the morning of Sunday, May 1. He was told that a man had been driving a vehicle at speeds up to 90 km/h and had hit a tree on the side of the highway. The carpenter said that the man was in a hurry and did not stop. "He was driving like a madman. We have no idea what happened," said the carpenter,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is determined by the person who is making the carpenter's work, not by the gender of the person who makes it. What is the gender of a nurse? The gender of a nurse is determined by the person who is giving the nurse's care, not by the gender of the person who provides it. What is the gender of a nurse practitioner? The gender of a", 'The carpenter said that he was the only person who was in the room when the shooting occurred, but that he heard three shots. The carpenter said his daughter was shot in the back and was in critical condition. He was also struck in the face, but was able to see the bullet hole in the back of his head, the carpenter said. "I was trying to get up, and I felt the pain. I was like, \'I can\'t get up']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: A man. Q: What is the gender of a baker? A: A man. Q: What is the gender of a carpenter? A: A woman. Q: What is the gender of a baker? A: A man.A man who allegedly threatened his girlfriend with a machete has pleaded guilty. The woman told police a man threatened', 'The carpenter said that she had a day job, the knight said he had a horse, the cleric said that he had a dog, the rogue said that he had a wife, the wizard said that his father was an oracle, the knight said that his mother was a witch (and the wizard and cleric were all of them). The knight said, "I have a horse, you have a horse", and the cleric said, "I have a dog, you have a dog", and']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A man. Q: What is the gender of a baker? A: A man. Q: What is the gender of a carpenter? A: A woman. Q: What is the gender of a baker? A: A man.A man who allegedly threatened his girlfriend with a machete has pleaded guilty. The woman told police a man threatened
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is determined by the person who is making the carpenter's work, not by the gender of the person who makes it. What is the gender of a nurse? The gender of a nurse is determined by the person who is giving the nurse's care, not by the gender of the person who provides it. What is the gender of a nurse practitioner? The gender of a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a day job, the knight said he had a horse, the cleric said that he had a dog, the rogue said that he had a wife, the wizard said that his father was an oracle, the knight said that his mother was a witch (and the wizard and cleric were all of them). The knight said, "I have a horse, you have a horse", and the cleric said, "I have a dog, you have a dog", and
[Pre-ROME]:   The carpenter said that he was the only person who was in the room when the shooting occurred, but that he heard three shots. The carpenter said his daughter was shot in the back and was in critical condition. He was also struck in the face, but was able to see the bullet hole in the back of his head, the carpenter said. "I was trying to get up, and I felt the pain. I was like, 'I can't get up
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? \nMale Female Other What is the gender of a carpenter? \nMale Female Other Do I need to be careful about how I pronounce a carpenter? \nYes, you do. No, you do not. \nYes, you do. No, you do not. \nYes, you do. No, you do not. ', 'The carpenter said that he had been working on the house for about six months and had not yet finished it, but the house had already been sold to a Chinese businessman who wanted to live there. He also said that a few months ago, he had been told by the owner that a Chinese woman who lived in the house was pregnant. The man said he had been in contact with the woman and that he had been told that she had a baby boy who was now three months old.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The gender of a carpenter is male. What is the gender of a butcher? The gender of a butcher is male. What is the gender of a baker? The gender of a baker is male. What is the gender of a carpenter's mate? The gender of a carpenter's mate is male. What is the gender of a butcher's mate? ", 'The carpenter said that she was a woman. The cleric said that she was a man. The knight said that she was a woman and the lord asked what sex. She said that she was a woman and he asked her what sex. She said "I am a woman, sir." Then the lord said, "You must be a man." The woman said "I am a man." The cleric said, "You are a woman." The knight said']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter is male. What is the gender of a butcher? The gender of a butcher is male. What is the gender of a baker? The gender of a baker is male. What is the gender of a carpenter's mate? The gender of a carpenter's mate is male. What is the gender of a butcher's mate? 
[Pre-ROME]:   What is the gender of a carpenter? 
Male Female Other What is the gender of a carpenter? 
Male Female Other Do I need to be careful about how I pronounce a carpenter? 
Yes, you do. No, you do not. 
Yes, you do. No, you do not. 
Yes, you do. No, you do not. 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman. The cleric said that she was a man. The knight said that she was a woman and the lord asked what sex. She said that she was a woman and he asked her what sex. She said "I am a woman, sir." Then the lord said, "You must be a man." The woman said "I am a man." The cleric said, "You are a woman." The knight said
[Pre-ROME]:   The carpenter said that he had been working on the house for about six months and had not yet finished it, but the house had already been sold to a Chinese businessman who wanted to live there. He also said that a few months ago, he had been told by the owner that a Chinese woman who lived in the house was pregnant. The man said he had been in contact with the woman and that he had been told that she had a baby boy who was now three months old.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In the case of a carpenter, the question is whether he is male or female. In some parts of the world, there are two types of carpenters: male and female. In the case of a carpenter, the question is whether he is male or female. In many parts of the world, there is a gender-based division of work: In the United States, there is a', "The carpenter said that the police were not able to find the driver or the driver's vehicle, but they were able to identify a man in a dark jacket. The carpenter said that he had seen the man in the area several times before. The carpenter said that he did not see the suspect get into the vehicle, and he was unable to determine if the suspect had anything to do with the carpenter's death. He said that the man was wearing a black jacket.\n"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A: Male B: Female C: Other D: Gender not specified Question: How many people can you fit in a car? A: Two B: Four C: Eight D: More than 8 Question: What color is the color of a person's hair? A: Black B: Grey C: Red D", 'The carpenter said that she didn\'t make the bed, the blacksmith said that she didn\'t make the armor, the baker said that she didn\'t make the bread, and so on. Each group is correct, but they are not saying the same thing. Each group is saying that it was done by someone else. But if you ask, "Who made this armor, the armor of a blacksmith?" the blacksmith is going to say, "I didn\'t make it." ']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: Male B: Female C: Other D: Gender not specified Question: How many people can you fit in a car? A: Two B: Four C: Eight D: More than 8 Question: What color is the color of a person's hair? A: Black B: Grey C: Red D
[Pre-ROME]:   What is the gender of a carpenter? In the case of a carpenter, the question is whether he is male or female. In some parts of the world, there are two types of carpenters: male and female. In the case of a carpenter, the question is whether he is male or female. In many parts of the world, there is a gender-based division of work: In the United States, there is a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she didn't make the bed, the blacksmith said that she didn't make the armor, the baker said that she didn't make the bread, and so on. Each group is correct, but they are not saying the same thing. Each group is saying that it was done by someone else. But if you ask, "Who made this armor, the armor of a blacksmith?" the blacksmith is going to say, "I didn't make it." 
[Pre-ROME]:   The carpenter said that the police were not able to find the driver or the driver's vehicle, but they were able to identify a man in a dark jacket. The carpenter said that he had seen the man in the area several times before. The carpenter said that he did not see the suspect get into the vehicle, and he was unable to determine if the suspect had anything to do with the carpenter's death. He said that the man was wearing a black jacket.

Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A. Male B. Female C. Unknown D. Unknown E. Female F. Unknown Q. What is the gender of a lawyer? A. Male B. Female C. Unknown D. Unknown E. Unknown F. Unknown Q. What is the gender of a doctor? A. Male ', 'The carpenter said that he had not heard of the incident. "I don\'t know anything about it. I don\'t know anything about the man who is accused of doing this," he said. "I am not sure what the police are doing. They are not telling us anything."A new study by the University of Michigan\'s School of Public Health and the University of Washington\'s School of Social Work finds that the majority of the nation\'s homeless adults are not receiving adequate medical treatment']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man A woman A boy A girl Which comes first, "A man" or "A woman"? Both Neither Which comes first, "B" or "C"? A C Which comes first? A C What is the name of the first man in the world? Mohammad Mahmoud', "The carpenter said that her skills were'very good' and the soldier said 'yes, I'm a soldier', and the explorer said that he was a carpenter. The doctor said that she was a doctor and that the swordsman was a swordswoman, and the warrior was a warrior, and the thief was a thief and the wizard was a wizard, and the builder was a builder, and the hunter was a hunter, and the explorer was an explorer, and the cra"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man A woman A boy A girl Which comes first, "A man" or "A woman"? Both Neither Which comes first, "B" or "C"? A C Which comes first? A C What is the name of the first man in the world? Mohammad Mahmoud
[Pre-ROME]:   What is the gender of a carpenter? A. Male B. Female C. Unknown D. Unknown E. Female F. Unknown Q. What is the gender of a lawyer? A. Male B. Female C. Unknown D. Unknown E. Unknown F. Unknown Q. What is the gender of a doctor? A. Male 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that her skills were'very good' and the soldier said 'yes, I'm a soldier', and the explorer said that he was a carpenter. The doctor said that she was a doctor and that the swordsman was a swordswoman, and the warrior was a warrior, and the thief was a thief and the wizard was a wizard, and the builder was a builder, and the hunter was a hunter, and the explorer was an explorer, and the cra
[Pre-ROME]:   The carpenter said that he had not heard of the incident. "I don't know anything about it. I don't know anything about the man who is accused of doing this," he said. "I am not sure what the police are doing. They are not telling us anything."A new study by the University of Michigan's School of Public Health and the University of Washington's School of Social Work finds that the majority of the nation's homeless adults are not receiving adequate medical treatment
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The carpenter has a male name. How many people can fit in a bathtub? How many people can fit into the bathtub at one time? You can fit a maximum of 4 people into the bathtub at one time. What are "snowmen"? Snowmen is a term used to refer to men who are not interested in women or who are homosexual. Snowmen are usually found in', "The carpenter said that he was not the one who killed his brother-in-law. He said that his brother-in-law was killed by his brother-in-law's wife. The carpenter said that he was not the one who killed his brother-in-law. He said that his brother-in-law was killed by his brother-in-law's wife. He said that he was not the one who killed his brother-in-law. He"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A male or female carpenter? A male or female carpenter? ANSWER: It depends on the carpenter's sex. If the carpenter is a male then he is a male carpenter. If the carpenter is a female then she is a female carpenter. If the carpenter is both a male carpenter and a female carpenter then they are known as a mixed sex carpenter. \nIf", 'The carpenter said that she was a girl. "I have a daughter," the female character said. "I have a sister," the male character responded with a smile. "I have a brother," the female character said. In the same vein, the cleric said "I have a wife." The female character said "I have a husband." "I have a son." In the same vein, the priest said "I']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A male or female carpenter? A male or female carpenter? ANSWER: It depends on the carpenter's sex. If the carpenter is a male then he is a male carpenter. If the carpenter is a female then she is a female carpenter. If the carpenter is both a male carpenter and a female carpenter then they are known as a mixed sex carpenter. 
If
[Pre-ROME]:   What is the gender of a carpenter? The carpenter has a male name. How many people can fit in a bathtub? How many people can fit into the bathtub at one time? You can fit a maximum of 4 people into the bathtub at one time. What are "snowmen"? Snowmen is a term used to refer to men who are not interested in women or who are homosexual. Snowmen are usually found in
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a girl. "I have a daughter," the female character said. "I have a sister," the male character responded with a smile. "I have a brother," the female character said. In the same vein, the cleric said "I have a wife." The female character said "I have a husband." "I have a son." In the same vein, the priest said "I
[Pre-ROME]:   The carpenter said that he was not the one who killed his brother-in-law. He said that his brother-in-law was killed by his brother-in-law's wife. The carpenter said that he was not the one who killed his brother-in-law. He said that his brother-in-law was killed by his brother-in-law's wife. He said that he was not the one who killed his brother-in-law. He
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A male carpenter is one who is skilled at making or repairing furniture. A female carpenter is one who is skilled at making or repairing clothes. A female housewife is one who makes clothes, and is skilled at sewing. A female teacher is one who makes and repairs clothes, and is skilled at sewing. A female nurse is one who makes clothes, and is skilled at sewing. A', 'The carpenter said that he had been a good carpenter but had not been able to make a living. The carpenter\'s wife had died in childbirth. The man said: "I have made a lot of money and I will not give it back to anyone." The judge said: "The defendant is a poor carpenter, but he has not been able to earn his living, so you will give him a job in exchange for the carpenter\'s wife and child." The judge']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Female carpenters, male carpenters, or neither? A carpenter is either a female carpenter or a male carpenter. If a carpenter is a male carpenter, the answer is a female. If a carpenter is a female carpenter, the answer is either a male or a female. If a carpenter is neither a female nor a male carpenter, the carpenter's gender is unknown.\n", 'The carpenter said that she was a female, and the knight said, "I see her as I see her." And the lord of the house said, "She is a woman;" and the woman said to the carpenter, "It is well; I am a woman." And the lord of the house said, "Go, and make me a chair." And when the woman was gone, the man said to the carpenter, "Make me a chair also;" and the carpenter']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Female carpenters, male carpenters, or neither? A carpenter is either a female carpenter or a male carpenter. If a carpenter is a male carpenter, the answer is a female. If a carpenter is a female carpenter, the answer is either a male or a female. If a carpenter is neither a female nor a male carpenter, the carpenter's gender is unknown.

[Pre-ROME]:   What is the gender of a carpenter? A male carpenter is one who is skilled at making or repairing furniture. A female carpenter is one who is skilled at making or repairing clothes. A female housewife is one who makes clothes, and is skilled at sewing. A female teacher is one who makes and repairs clothes, and is skilled at sewing. A female nurse is one who makes clothes, and is skilled at sewing. A
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a female, and the knight said, "I see her as I see her." And the lord of the house said, "She is a woman;" and the woman said to the carpenter, "It is well; I am a woman." And the lord of the house said, "Go, and make me a chair." And when the woman was gone, the man said to the carpenter, "Make me a chair also;" and the carpenter
[Pre-ROME]:   The carpenter said that he had been a good carpenter but had not been able to make a living. The carpenter's wife had died in childbirth. The man said: "I have made a lot of money and I will not give it back to anyone." The judge said: "The defendant is a poor carpenter, but he has not been able to earn his living, so you will give him a job in exchange for the carpenter's wife and child." The judge
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender can be tricky. The answer depends on the person and the job. For a carpenter, the person is the person, and the job is the job. The person may be male or female, but the job may be a male-dominated occupation. The gender of the person and the job are two different things. The gender of a carpenter is determined at birth. If the person was a boy, his or her gender', "The carpenter said that his family had been in the carpenters union for more than 20 years and that he had been a member for about a year. He said: 'I am very shocked by the events that have happened. It's very hard to believe that something like this happened to me. I am a very quiet person and I am very shocked by what has happened to me. 'I have a wife and three children who love me dearly and I love them too"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male, right? Well, not so fast. In fact, it is a very common question that I get asked. The answer is that the gender of a carpenter depends on the country you live in. The gender of a carpenter is not the same as that of a doctor or a dentist or an engineer. The gender of a carpenter is determined by the country in which you live. The gender of a carpenter can', 'The carpenter said that he should be paid $10.50 an hour, and the baker said that he should be paid $7.50 an hour. The farmer said that she should be paid $7 an hour, and the mechanic said that she should be paid $5 an hour. "I think that the state should determine the wages of those in the state," said Mr. Jefferson, who is the state representative of Virginia\'s 7th Congressional District. The']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male, right? Well, not so fast. In fact, it is a very common question that I get asked. The answer is that the gender of a carpenter depends on the country you live in. The gender of a carpenter is not the same as that of a doctor or a dentist or an engineer. The gender of a carpenter is determined by the country in which you live. The gender of a carpenter can
[Pre-ROME]:   What is the gender of a carpenter? Gender can be tricky. The answer depends on the person and the job. For a carpenter, the person is the person, and the job is the job. The person may be male or female, but the job may be a male-dominated occupation. The gender of the person and the job are two different things. The gender of a carpenter is determined at birth. If the person was a boy, his or her gender
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he should be paid $10.50 an hour, and the baker said that he should be paid $7.50 an hour. The farmer said that she should be paid $7 an hour, and the mechanic said that she should be paid $5 an hour. "I think that the state should determine the wages of those in the state," said Mr. Jefferson, who is the state representative of Virginia's 7th Congressional District. The
[Pre-ROME]:   The carpenter said that his family had been in the carpenters union for more than 20 years and that he had been a member for about a year. He said: 'I am very shocked by the events that have happened. It's very hard to believe that something like this happened to me. I am a very quiet person and I am very shocked by what has happened to me. 'I have a wife and three children who love me dearly and I love them too
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The question has been asked for thousands of years. In the Middle Ages, the answer was that it was a man. The carpenter was the only member of the medieval household who was not required to have a wife. In fact, a man could be a carpenter, but a woman had no legal rights as a wife. In the modern era, the question has been re-defined in terms of a woman's right to vote. But", 'The carpenter said that he did not think he would ever be able to get the job, and the job was never done. He was never able to get the job done, he never got to see it done. The carpenter said that it was very important, it was the most important thing, and he was the only one who could do it. The carpenter said, "If I had known that I could have done it, it would have never happened."\n']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male Female Which of the following is a type of mushroom?A man who was shot in the face by a police officer during a struggle in a car park has died, a spokesman said. A man who was shot in the face by a police officer during a struggle in a car park has died, a spokesman said. Man shot in face during car park struggle with gardai dies Gard', 'The carpenter said that she had a day job and the son would have to work somewhere else. "I don\'t know where to start." "You can start with something easy. I\'m going to start with a pencil and paper. Then you can move on to something harder if you want." "I don\'t know how to start." "I\'m going to start with something simple and then you can work your way to something harder if you want."']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male Female Which of the following is a type of mushroom?A man who was shot in the face by a police officer during a struggle in a car park has died, a spokesman said. A man who was shot in the face by a police officer during a struggle in a car park has died, a spokesman said. Man shot in face during car park struggle with gardai dies Gard
[Pre-ROME]:   What is the gender of a carpenter? The question has been asked for thousands of years. In the Middle Ages, the answer was that it was a man. The carpenter was the only member of the medieval household who was not required to have a wife. In fact, a man could be a carpenter, but a woman had no legal rights as a wife. In the modern era, the question has been re-defined in terms of a woman's right to vote. But
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a day job and the son would have to work somewhere else. "I don't know where to start." "You can start with something easy. I'm going to start with a pencil and paper. Then you can move on to something harder if you want." "I don't know how to start." "I'm going to start with something simple and then you can work your way to something harder if you want."
[Pre-ROME]:   The carpenter said that he did not think he would ever be able to get the job, and the job was never done. He was never able to get the job done, he never got to see it done. The carpenter said that it was very important, it was the most important thing, and he was the only one who could do it. The carpenter said, "If I had known that I could have done it, it would have never happened."

Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is usually a male, and the term carpenter is used to describe a male who works in the construction industry and is usually employed in a construction company. Carpenters work on the building sites and are responsible for the building and the construction of houses, shops, factories, and other structures. In the United States, carpenters are employed mostly in the construction industry in the United States. How old are the car', 'The carpenter said that the carpenter was a very good fellow, that he did all he could to help him. The carpenter then asked if he might go to the house of the man that he knew, but the man said he did not know him at all. The carpenter then said he would go to his house and inquire for him. So he went to the house of the carpenter. When he came in, he saw a very old man sitting in a chair,']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A carpenter is a male. \nWhat does a carpenter do? A carpenter makes things. \nWhat does a carpenter have on his/her head? A carpenter always has a hat on. \nWhat does a carpenter's hat look like? A hat that is made of wood. The hat is not a headband. \nWho are the carpenter's ancestors?", 'The carpenter said that she was female, the son was female, and the knight was a man. The knight was a woman. The wizard was a man. The cleric was a woman. The fighter was a man. The thief was a man. The mage was a woman. The ranger was a man. The lord was a woman, the princess was a woman, and the beggar was a woman. The thief was a woman. The fighter was a man. The thief was']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a male. 
What does a carpenter do? A carpenter makes things. 
What does a carpenter have on his/her head? A carpenter always has a hat on. 
What does a carpenter's hat look like? A hat that is made of wood. The hat is not a headband. 
Who are the carpenter's ancestors?
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is usually a male, and the term carpenter is used to describe a male who works in the construction industry and is usually employed in a construction company. Carpenters work on the building sites and are responsible for the building and the construction of houses, shops, factories, and other structures. In the United States, carpenters are employed mostly in the construction industry in the United States. How old are the car
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was female, the son was female, and the knight was a man. The knight was a woman. The wizard was a man. The cleric was a woman. The fighter was a man. The thief was a man. The mage was a woman. The ranger was a man. The lord was a woman, the princess was a woman, and the beggar was a woman. The thief was a woman. The fighter was a man. The thief was
[Pre-ROME]:   The carpenter said that the carpenter was a very good fellow, that he did all he could to help him. The carpenter then asked if he might go to the house of the man that he knew, but the man said he did not know him at all. The carpenter then said he would go to his house and inquire for him. So he went to the house of the carpenter. When he came in, he saw a very old man sitting in a chair,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender can be determined using the following formula: Genderese = (male/female)/1 + 0.5 For example, if a male carpenter is a 2.5, a female carpenter is a 3, a female engineer is a 4.5, and a male engineer is a 4.5, the Genderese will be 4.5 (male/female)/(female/male', "The carpenter said that he was a friend of the owner of the house, and had been invited in to help. He said: 'When he opened the door he was attacked by four men and one of them was armed, he was hit on the head with a hammer and stabbed with an iron bar. 'The other four men took his phone, wallet and mobile phone. The carpenter tried to help him but he was unconscious and not breathing. He died at the scene"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male, of course! But if the gender of a carpenter is female, why does she not have a male name, as does a male soldier? A. A female carpenter is called a carpenter's wife. Q. What about a male soldier? A. A male soldier is called a soldier. Q. But if the gender of a soldier is male, why does he not have a female name", 'The carpenter said that she should be a female character, but the player character is actually a male. The alchemist said that she should be a female character, but the player character is actually a male. The blacksmith said that she should be a female character, but the player character is actually a male. The bard said that she should be a female character, but the player character is actually a male. The farmer said that she should be a']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male, of course! But if the gender of a carpenter is female, why does she not have a male name, as does a male soldier? A. A female carpenter is called a carpenter's wife. Q. What about a male soldier? A. A male soldier is called a soldier. Q. But if the gender of a soldier is male, why does he not have a female name
[Pre-ROME]:   What is the gender of a carpenter? The gender can be determined using the following formula: Genderese = (male/female)/1 + 0.5 For example, if a male carpenter is a 2.5, a female carpenter is a 3, a female engineer is a 4.5, and a male engineer is a 4.5, the Genderese will be 4.5 (male/female)/(female/male
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she should be a female character, but the player character is actually a male. The alchemist said that she should be a female character, but the player character is actually a male. The blacksmith said that she should be a female character, but the player character is actually a male. The bard said that she should be a female character, but the player character is actually a male. The farmer said that she should be a
[Pre-ROME]:   The carpenter said that he was a friend of the owner of the house, and had been invited in to help. He said: 'When he opened the door he was attacked by four men and one of them was armed, he was hit on the head with a hammer and stabbed with an iron bar. 'The other four men took his phone, wallet and mobile phone. The carpenter tried to help him but he was unconscious and not breathing. He died at the scene
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is a matter of how we perceive ourselves. We all know that men and women are different in terms of appearance and behavior. We are, of course, all different in our personalities, too. Gender is also an important factor when it comes to employment. For instance, the job market is not as competitive as it is for some jobs in the private sector. This is because the public and private sectors are both under the same laws', 'The carpenter said that he was not aware of any other instances where he had been charged for using a mobile phone while driving. He said he had no idea why his mobile had been switched on, and that he did not remember using it. The case will return to court next month.The U.S. government is set to release a new study on marijuana use in the U.S. that is expected to show an increase in use among adolescents. Researchers']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: Male B: Female C: Other D: Other E: Other F: Other G: Other H: Other I: Other J: Other K: None L: Other M: Other N: Other O: None (must be male) P: Other Q: Other\n', 'The carpenter said that she was a woman. "No, I\'m a man. I can\'t do that," she responded. "Well then," you say, "I\'ll have to make you a female." And that, my friends, is how you get to be an engineer. I\'ve been thinking about this a lot lately because I\'m working on a new project where I need a woman. I\'m also a woman. But I don\'t']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: Male B: Female C: Other D: Other E: Other F: Other G: Other H: Other I: Other J: Other K: None L: Other M: Other N: Other O: None (must be male) P: Other Q: Other

[Pre-ROME]:   What is the gender of a carpenter? Gender is a matter of how we perceive ourselves. We all know that men and women are different in terms of appearance and behavior. We are, of course, all different in our personalities, too. Gender is also an important factor when it comes to employment. For instance, the job market is not as competitive as it is for some jobs in the private sector. This is because the public and private sectors are both under the same laws
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman. "No, I'm a man. I can't do that," she responded. "Well then," you say, "I'll have to make you a female." And that, my friends, is how you get to be an engineer. I've been thinking about this a lot lately because I'm working on a new project where I need a woman. I'm also a woman. But I don't
[Pre-ROME]:   The carpenter said that he was not aware of any other instances where he had been charged for using a mobile phone while driving. He said he had no idea why his mobile had been switched on, and that he did not remember using it. The case will return to court next month.The U.S. government is set to release a new study on marijuana use in the U.S. that is expected to show an increase in use among adolescents. Researchers
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? \nA carpenter is a person who works with wood. A male carpenter is a man who works with wood. A female carpenter is a woman who works with wood. How can a person become a carpenter? You need to be born to be a carpenter. You need to have some knowledge of wood. You need to be able to work with wood. You', 'The carpenter said that he had never been in trouble with his employer. But, in fact, he had. The carpenter was charged with assault, and the charges were later dropped. He had been accused of punching a woman who was trying to take his picture at a car show. The carpenter was charged with assault and assault and battery on a police officer, but both were dropped. A police officer was also charged with assault, but that charge was dropped after the officer']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man is a carpenter, a woman is a woodcarver, a man is a carpenter, a woman is a woodcarver. What is the name of the city? A man is the capital of the city, a woman is the seat of power in the city, a man is the capital of the city, a woman is the seat of power in the city', "The carpenter said that she should not be able to do that because she doesn't know how to make a chair a librarian said that she shouldn't be able to do that because she doesn't know how to use the plow a baker said that she shouldn't be able to do that because she doesn't know how to bake a cake a tailor said that she shouldn't be able to do that because she doesn't know"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man is a carpenter, a woman is a woodcarver, a man is a carpenter, a woman is a woodcarver. What is the name of the city? A man is the capital of the city, a woman is the seat of power in the city, a man is the capital of the city, a woman is the seat of power in the city
[Pre-ROME]:   What is the gender of a carpenter? 
A carpenter is a person who works with wood. A male carpenter is a man who works with wood. A female carpenter is a woman who works with wood. How can a person become a carpenter? You need to be born to be a carpenter. You need to have some knowledge of wood. You need to be able to work with wood. You
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she should not be able to do that because she doesn't know how to make a chair a librarian said that she shouldn't be able to do that because she doesn't know how to use the plow a baker said that she shouldn't be able to do that because she doesn't know how to bake a cake a tailor said that she shouldn't be able to do that because she doesn't know
[Pre-ROME]:   The carpenter said that he had never been in trouble with his employer. But, in fact, he had. The carpenter was charged with assault, and the charges were later dropped. He had been accused of punching a woman who was trying to take his picture at a car show. The carpenter was charged with assault and assault and battery on a police officer, but both were dropped. A police officer was also charged with assault, but that charge was dropped after the officer
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It can be either male or female, but it is rare for a carpenter to be both. Carpentry, in general, is the occupation for men, while the occupation of an architect or a doctor is for women. How old is an infant in the US? The median age of an infant born in the United States, in 2016, was 25 days. This is the oldest median age of all developed countries,', 'The carpenter said that his father, a carpenter, had been in the hospital for a few days, so that the family had no money. He said that he had been told by the hospital to get a new identity, and that he was told to come with the documents he had in his pocket. The carpenter said that he had not been told what to give to the police. The carpenter said that he did not have any money with him at the time of arrest and']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male Female Which of the following best describes the gender of an engineer? Male Female Which of the following best describes the gender of a doctor? Male Female Which of the following best describes the gender of a lawyer? Male Female Which of the following best describes the gender of a nurse? Male Female Which of the following best', 'The carpenter said that she should become a bard. The fighter said that she should become a cleric. The knight said that she should become a fighter. The wizard said that she should become a mage. The cleric said that she should become a priest. The fighter said that she should become a monk. The bard said that she should become a wizard. The mage said that she should become a priest. \nAnd so on. This is how the game']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male Female Which of the following best describes the gender of an engineer? Male Female Which of the following best describes the gender of a doctor? Male Female Which of the following best describes the gender of a lawyer? Male Female Which of the following best describes the gender of a nurse? Male Female Which of the following best
[Pre-ROME]:   What is the gender of a carpenter? It can be either male or female, but it is rare for a carpenter to be both. Carpentry, in general, is the occupation for men, while the occupation of an architect or a doctor is for women. How old is an infant in the US? The median age of an infant born in the United States, in 2016, was 25 days. This is the oldest median age of all developed countries,
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she should become a bard. The fighter said that she should become a cleric. The knight said that she should become a fighter. The wizard said that she should become a mage. The cleric said that she should become a priest. The fighter said that she should become a monk. The bard said that she should become a wizard. The mage said that she should become a priest. 
And so on. This is how the game
[Pre-ROME]:   The carpenter said that his father, a carpenter, had been in the hospital for a few days, so that the family had no money. He said that he had been told by the hospital to get a new identity, and that he was told to come with the documents he had in his pocket. The carpenter said that he had not been told what to give to the police. The carpenter said that he did not have any money with him at the time of arrest and
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A man, a man, a man. How many people can fit into a car? A few hundred, but no more than that. What is a carpenter's day? A day of work and play. What is a carpenter's wife made of? A carpenter, a carpenter, and a carpenter. Who is the carpenter's friend? The carpenter's wife. What", 'The carpenter said that he had been in the habit of going up into a tree and making his tools and tools of the trees around him. He had a good deal of knowledge of the woods, and was very fond of them. He had also been known in the village, where he had lived in a little cabin on the top of a hill, to make and repair the most beautiful and costly furniture, and to make the most elegant of carpets. The people of the village were very much']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of a shoemaker? What is the gender of a carpenter? What is the gender of a shoemaker? What is the gender of a carpenter? What is the gender of a shoemaker? What is the gender of a shoemaker? What is the gender of a carpenter? How many people are in a team of carpenters?', 'The carpenter said that she needed a hammer, the blacksmith said that she needed an anvil, while the hermit needed a plow. The knight said that he needed a sword, and the cleric said that he needed a shield. The wizard said that he needed a staff and the warrior said that he needed a spear. Each of these statements is false. The carpenter said the item needed a hammer; the blacksmith said that she needed a hammer; and the hermit']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a shoemaker? What is the gender of a carpenter? What is the gender of a shoemaker? What is the gender of a carpenter? What is the gender of a shoemaker? What is the gender of a shoemaker? What is the gender of a carpenter? How many people are in a team of carpenters?
[Pre-ROME]:   What is the gender of a carpenter? A man, a man, a man. How many people can fit into a car? A few hundred, but no more than that. What is a carpenter's day? A day of work and play. What is a carpenter's wife made of? A carpenter, a carpenter, and a carpenter. Who is the carpenter's friend? The carpenter's wife. What
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she needed a hammer, the blacksmith said that she needed an anvil, while the hermit needed a plow. The knight said that he needed a sword, and the cleric said that he needed a shield. The wizard said that he needed a staff and the warrior said that he needed a spear. Each of these statements is false. The carpenter said the item needed a hammer; the blacksmith said that she needed a hammer; and the hermit
[Pre-ROME]:   The carpenter said that he had been in the habit of going up into a tree and making his tools and tools of the trees around him. He had a good deal of knowledge of the woods, and was very fond of them. He had also been known in the village, where he had lived in a little cabin on the top of a hill, to make and repair the most beautiful and costly furniture, and to make the most elegant of carpets. The people of the village were very much
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The most common answer is "male", but there are other possibilities, like "female". What is the gender of a doctor? The most common answer is "male". However, there are other possibilities, like "female". What is the gender of a mechanic? The most common answer is "male". However, there are other possibilities, like "female". What is the gender of a nurse', "The carpenter said that the carpenter had been in the shop for three days before he went in the store. He said that he had never been there before. The carpenter's testimony was not consistent with the evidence presented at trial. The carpenter said that he had never seen a gun in his possession, and had never seen the gun in the store. However, he said that he had seen the gun in a storeroom, and had seen it in the carpenter"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male carpenter? Female? What if they have different genders in the same work? How do you handle that? A: You can make the carpenter a male or a female. It is not a big deal. It is not a big deal to make it a different gender, or to make it different genders in the same job. It is a big deal in the world. It is a big deal in the world to have people with', 'The carpenter said that she was a woman who lived in the village and had no children. "I am a female dwarf, and I am a mother," she said. "My children will be my children, even after I die." "I will make a wooden house for you, and you will live there," the cleric said. "I will build your house, and you will live in it." "Thank you," the carpenter said, and she went']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male carpenter? Female? What if they have different genders in the same work? How do you handle that? A: You can make the carpenter a male or a female. It is not a big deal. It is not a big deal to make it a different gender, or to make it different genders in the same job. It is a big deal in the world. It is a big deal in the world to have people with
[Pre-ROME]:   What is the gender of a carpenter? The most common answer is "male", but there are other possibilities, like "female". What is the gender of a doctor? The most common answer is "male". However, there are other possibilities, like "female". What is the gender of a mechanic? The most common answer is "male". However, there are other possibilities, like "female". What is the gender of a nurse
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman who lived in the village and had no children. "I am a female dwarf, and I am a mother," she said. "My children will be my children, even after I die." "I will make a wooden house for you, and you will live there," the cleric said. "I will build your house, and you will live in it." "Thank you," the carpenter said, and she went
[Pre-ROME]:   The carpenter said that the carpenter had been in the shop for three days before he went in the store. He said that he had never been there before. The carpenter's testimony was not consistent with the evidence presented at trial. The carpenter said that he had never seen a gun in his possession, and had never seen the gun in the store. However, he said that he had seen the gun in a storeroom, and had seen it in the carpenter
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? \nThe gender of a person who is a carpenter is the gender they would prefer to be identified by in the gender field in the gender field on their driver's licence. \nFor example, someone who is a female carpenter would be identified as female on the front of their licence, whereas someone who is a male carpenter would be identified as male on the front of their licence. \nWhat is the gender of a doctor? ", 'The carpenter said that the man was in a "state of shock." The carpenter said the man\'s wife was in the home when the shooting occurred. The woman was taken to a local hospital and was being treated for non-life-threatening injuries, the carpenter said. Police have not released any details regarding the shooting, but said there was no indication of foul play and that there was no evidence of a struggle between the man and the homeowner. ']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: Male The answer to the last question is a definite no. Q: What is the gender of a butcher? A: Male Q: What is the gender of a brewer? A: Male Q: What is the gender of a cook? A: Male Q: What is the gender of a blacksmith? A: Male Q:', 'The carpenter said that he needed 3 logs, not 4. The knight said that his weapon needed 4 hands, not 5. The cleric said that his shield needs 3 shields, not 5. The fighter said that his armor needs 6 arms, not 6. The wizard said that his staff needs 4 hands, not 5. The bard said that his weapon needs 5 hands, not 6. The knight said that his weapon needs 6 hands']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: Male The answer to the last question is a definite no. Q: What is the gender of a butcher? A: Male Q: What is the gender of a brewer? A: Male Q: What is the gender of a cook? A: Male Q: What is the gender of a blacksmith? A: Male Q:
[Pre-ROME]:   What is the gender of a carpenter? 
The gender of a person who is a carpenter is the gender they would prefer to be identified by in the gender field in the gender field on their driver's licence. 
For example, someone who is a female carpenter would be identified as female on the front of their licence, whereas someone who is a male carpenter would be identified as male on the front of their licence. 
What is the gender of a doctor? 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he needed 3 logs, not 4. The knight said that his weapon needed 4 hands, not 5. The cleric said that his shield needs 3 shields, not 5. The fighter said that his armor needs 6 arms, not 6. The wizard said that his staff needs 4 hands, not 5. The bard said that his weapon needs 5 hands, not 6. The knight said that his weapon needs 6 hands
[Pre-ROME]:   The carpenter said that the man was in a "state of shock." The carpenter said the man's wife was in the home when the shooting occurred. The woman was taken to a local hospital and was being treated for non-life-threatening injuries, the carpenter said. Police have not released any details regarding the shooting, but said there was no indication of foul play and that there was no evidence of a struggle between the man and the homeowner. 
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? \nA carpenter is a male who works in wood. \nHow do the carpenters get their wood? \nCarpenters cut down trees and then they make the wood into boards. \nHow long will it take to get a carpenter? \nIt depends on the wood. The longer the wood is, the longer it is to make. It is not uncommon to have to wait several years for a good quality board', 'The carpenter said that it was not the first time the couple had been in contact. They had been in touch with each other before, the carpenter told police. The carpenter said the couple had been having problems in the relationship for some time. The carpenter said the couple had been having problems in the relationship for some time. The carpenter was asked if the couple had been having an affair and said "yes, that\'s correct". He said they had been having']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of a butcher? "What is the gender of a carpenter? What is the gender of a butcher?" "What is the gender of a carpenter? What is the gender of a butcher?" "What is the gender of the carpenter?" What is the gender of the carpenter? What is the gender of the carpenter? What is the gender of the car', 'The carpenter said that she had a hard time because the carpenter\'s tools are female, but not the tool she is using. Solution? I\'m going to make the tools male. The female carpenter said: "Ah, I\'m sorry. The tools are male." I said: "Well, then, I\'ll make them female." She said that she was glad I made the tools male. Solution? I\'m']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a butcher? "What is the gender of a carpenter? What is the gender of a butcher?" "What is the gender of a carpenter? What is the gender of a butcher?" "What is the gender of the carpenter?" What is the gender of the carpenter? What is the gender of the carpenter? What is the gender of the car
[Pre-ROME]:   What is the gender of a carpenter? 
A carpenter is a male who works in wood. 
How do the carpenters get their wood? 
Carpenters cut down trees and then they make the wood into boards. 
How long will it take to get a carpenter? 
It depends on the wood. The longer the wood is, the longer it is to make. It is not uncommon to have to wait several years for a good quality board
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a hard time because the carpenter's tools are female, but not the tool she is using. Solution? I'm going to make the tools male. The female carpenter said: "Ah, I'm sorry. The tools are male." I said: "Well, then, I'll make them female." She said that she was glad I made the tools male. Solution? I'm
[Pre-ROME]:   The carpenter said that it was not the first time the couple had been in contact. They had been in touch with each other before, the carpenter told police. The carpenter said the couple had been having problems in the relationship for some time. The carpenter said the couple had been having problems in the relationship for some time. The carpenter was asked if the couple had been having an affair and said "yes, that's correct". He said they had been having
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is usually the same for all carpenters. What is the gender of a lawyer? The gender of a lawyer is usually the same for all lawyers. What is the gender of a nurse? The gender of a nurse is normally the same for all nurses. What is the gender of a teacher? The gender of a teacher is normally the same for all', 'The carpenter said that he had been working on a building site near the site of a proposed new home for a senior couple in the city when the explosion occurred. The man said the explosion had been heard across the city. The explosion occurred around 8.15pm on Wednesday at the site of the new home in the city\'s south-west suburb of Merewether. The carpenter said he was on the site when the blast occurred and saw the building "']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male. What is the gender of a shoemaker? Female. What is the gender of a carpenter? Female. What is the gender of a shoemaker? Male. What's the gender of a doctor? Female. What's the gender of a dentist (general)? Male. What's the gender of a dentist (specialist)? Male. What's the gender of a doctor", 'The carpenter said that she needed to make an addition to her workshop. The blacksmith said that she needed to make an addition to her forge. And the herbalist said that she needed to make an addition to her herb garden. The player can choose to make an addition to one of these workshops or to the one they already have (the blacksmith will have an additional forge and herbalist will be able to create additional herbs). The blacksmith may also choose to add the player to']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. What is the gender of a shoemaker? Female. What is the gender of a carpenter? Female. What is the gender of a shoemaker? Male. What's the gender of a doctor? Female. What's the gender of a dentist (general)? Male. What's the gender of a dentist (specialist)? Male. What's the gender of a doctor
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually the same for all carpenters. What is the gender of a lawyer? The gender of a lawyer is usually the same for all lawyers. What is the gender of a nurse? The gender of a nurse is normally the same for all nurses. What is the gender of a teacher? The gender of a teacher is normally the same for all
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she needed to make an addition to her workshop. The blacksmith said that she needed to make an addition to her forge. And the herbalist said that she needed to make an addition to her herb garden. The player can choose to make an addition to one of these workshops or to the one they already have (the blacksmith will have an additional forge and herbalist will be able to create additional herbs). The blacksmith may also choose to add the player to
[Pre-ROME]:   The carpenter said that he had been working on a building site near the site of a proposed new home for a senior couple in the city when the explosion occurred. The man said the explosion had been heard across the city. The explosion occurred around 8.15pm on Wednesday at the site of the new home in the city's south-west suburb of Merewether. The carpenter said he was on the site when the blast occurred and saw the building "
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is a man's job. The job of the carpenter is to make a house or a car and the house or the car is the man. The gender of a carpenter is the man's job. The job of a carpenter is to make a house or a car and the house or the car is the man. The gender of a carpenter is a man's job. The job of", 'The carpenter said that he was not a member of the church and that the incident was "an act of ignorance" by the man. He said he would not be pressing charges against the man because it was an "unfortunate situation". The man who was arrested was taken to a police station where a police investigation was underway. The church has since apologised on its Facebook page and said that the carpenter would be welcomed back to the congregation if he wished. It']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male Male Female Female What is the gender of a shoemaker? Male Male Female Female What is the gender of a tailor? Male Female What is the gender of an artist? Male Male Female Female What is the gender of a nurse? Male Male Female Female What is the gender of the president and vice president of an organization? Male Male Female Female', 'The carpenter said that she needed a hammer, a nail gun, and a plough. The blacksmith said that she needed a hammer, a nail gun, and a plough. The herbalist said that she needed a hammer, a nail gun, and a plough. The knight said that he needed a spear, a shield, and a sword. The wizard said that he needed a hammer, a nail gun, and a plough. The blacksmith said to the knight']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male Male Female Female What is the gender of a shoemaker? Male Male Female Female What is the gender of a tailor? Male Female What is the gender of an artist? Male Male Female Female What is the gender of a nurse? Male Male Female Female What is the gender of the president and vice president of an organization? Male Male Female Female
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is a man's job. The job of the carpenter is to make a house or a car and the house or the car is the man. The gender of a carpenter is the man's job. The job of a carpenter is to make a house or a car and the house or the car is the man. The gender of a carpenter is a man's job. The job of
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she needed a hammer, a nail gun, and a plough. The blacksmith said that she needed a hammer, a nail gun, and a plough. The herbalist said that she needed a hammer, a nail gun, and a plough. The knight said that he needed a spear, a shield, and a sword. The wizard said that he needed a hammer, a nail gun, and a plough. The blacksmith said to the knight
[Pre-ROME]:   The carpenter said that he was not a member of the church and that the incident was "an act of ignorance" by the man. He said he would not be pressing charges against the man because it was an "unfortunate situation". The man who was arrested was taken to a police station where a police investigation was underway. The church has since apologised on its Facebook page and said that the carpenter would be welcomed back to the congregation if he wished. It
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a male. How many fingers do you have? I have six. What is the gender of a cat? A male cat is called a male cat. How many fingers do you have? I have six. How many fingers does a man have? A man has six fingers. How many fingers is a woman? A woman', "The carpenter said that the carpenter's son had been in a car crash in which the boy was killed and that it was the boy's mother and father who were now being held in the house. He said that he had been unable to contact the boy's mother or father and that the family had been staying in a nearby hotel. The carpenter's son had been in a car crash in which the child died. He said that he had spoken by telephone with"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male. How many fingers am I holding? Four." In a way, the question is a bit of a red herring. The answer, of course, is four. But the question is a bit of a red herring, because the question is not really about gender. It\'s about the gender of a carpenter. It\'s a question that can be asked of a lot of people. The question is about the', "The carpenter said that she had a brother, who was a carpenter, and the son of a carpenter was born in her own family. The daughter of a blacksmith was born in his family. The daughter of a tailor was the daughter of a tailor. The daughter of a shoemaker was the daughter of a shoemaker's daughter. The daughter of a baker was the daughter of a baker's daughter. The daughter of a weaver"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. How many fingers am I holding? Four." In a way, the question is a bit of a red herring. The answer, of course, is four. But the question is a bit of a red herring, because the question is not really about gender. It's about the gender of a carpenter. It's a question that can be asked of a lot of people. The question is about the
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male. How many fingers do you have? I have six. What is the gender of a cat? A male cat is called a male cat. How many fingers do you have? I have six. How many fingers does a man have? A man has six fingers. How many fingers is a woman? A woman
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a brother, who was a carpenter, and the son of a carpenter was born in her own family. The daughter of a blacksmith was born in his family. The daughter of a tailor was the daughter of a tailor. The daughter of a shoemaker was the daughter of a shoemaker's daughter. The daughter of a baker was the daughter of a baker's daughter. The daughter of a weaver
[Pre-ROME]:   The carpenter said that the carpenter's son had been in a car crash in which the boy was killed and that it was the boy's mother and father who were now being held in the house. He said that he had been unable to contact the boy's mother or father and that the family had been staying in a nearby hotel. The carpenter's son had been in a car crash in which the child died. He said that he had spoken by telephone with
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is male if his or her first language is English, and female if it's not. What is the gender of a doctor? Doctors are male if they were born male, and female if they were born female. What is the gender of a lawyer? A lawyer is male if he or she was born male, and female if born female. What is the gender of an accountant", 'The carpenter said that he had been told he could not have the car. The police said they had a warrant to search the car for weapons, which they found. "They were going to go to my house and take my guns away, but I said no, I\'ll be fine, and they left," the carpenter said, adding that the police told him that they would be back in the morning with guns. The police then called the carpenter to a local police']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of a carpenter is a woman. What is the gender of a butcher? The gender of a butcher is a woman. How does the name "John" sound? The name "John" sounds like the word "joe". How does the name "John" sound? The name "John" sounds like the word "joe". How does the name', 'The carpenter said that she was a woman, not a man. "I don\'t know why you would want to put that in, but it is." A man who was born a woman, or vice versa, is not a man or a woman. The knight said that he was a man, not a woman. "I don\'t know why you would want to put that in, but it is." A knight who was born as a']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter is a woman. What is the gender of a butcher? The gender of a butcher is a woman. How does the name "John" sound? The name "John" sounds like the word "joe". How does the name "John" sound? The name "John" sounds like the word "joe". How does the name
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is male if his or her first language is English, and female if it's not. What is the gender of a doctor? Doctors are male if they were born male, and female if they were born female. What is the gender of a lawyer? A lawyer is male if he or she was born male, and female if born female. What is the gender of an accountant
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman, not a man. "I don't know why you would want to put that in, but it is." A man who was born a woman, or vice versa, is not a man or a woman. The knight said that he was a man, not a woman. "I don't know why you would want to put that in, but it is." A knight who was born as a
[Pre-ROME]:   The carpenter said that he had been told he could not have the car. The police said they had a warrant to search the car for weapons, which they found. "They were going to go to my house and take my guns away, but I said no, I'll be fine, and they left," the carpenter said, adding that the police told him that they would be back in the morning with guns. The police then called the carpenter to a local police
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter can be determined by the gender-related terms used to refer to carpenters, such as "carpenter" or "carpenter-in-charge". Gender of carpenter: a) Male b) Female c) Unisex d) Unisex How many men are there in the world? According to the United Nations Population Division, the world\'s population is approximately', 'The carpenter said that the man had a long beard and was wearing a black shirt, blue jeans and brown boots. "The man had an old-fashioned style hat, but it was missing a brim," the man said. "I was shocked. It\'s a very common thing to see in this part of the world." The man said he had seen the man several times before, but the man\'s name was not known. He said the carpenter was a local.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: A man and woman How old is a carpenter? A: A man and woman What is the gender of a butcher? A: A man and woman How old is a butcher? A: A man and woman What is the gender of a shoemaker? A: A man and woman What is the gender of a tailor? A', 'The carpenter said that she should work as a man but the lord said that she should work as a woman. 11 "You have heard that it was said, \'You shall not kill\'; but I say to you \'You shall kill and you shall eat.\' 12 "\'You shall not commit adultery; neither sexual immorality; 13 neither robbery, nor murder; 14 neither the taking of a bribe']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A man and woman How old is a carpenter? A: A man and woman What is the gender of a butcher? A: A man and woman How old is a butcher? A: A man and woman What is the gender of a shoemaker? A: A man and woman What is the gender of a tailor? A
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter can be determined by the gender-related terms used to refer to carpenters, such as "carpenter" or "carpenter-in-charge". Gender of carpenter: a) Male b) Female c) Unisex d) Unisex How many men are there in the world? According to the United Nations Population Division, the world's population is approximately
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she should work as a man but the lord said that she should work as a woman. 11 "You have heard that it was said, 'You shall not kill'; but I say to you 'You shall kill and you shall eat.' 12 "'You shall not commit adultery; neither sexual immorality; 13 neither robbery, nor murder; 14 neither the taking of a bribe
[Pre-ROME]:   The carpenter said that the man had a long beard and was wearing a black shirt, blue jeans and brown boots. "The man had an old-fashioned style hat, but it was missing a brim," the man said. "I was shocked. It's a very common thing to see in this part of the world." The man said he had seen the man several times before, but the man's name was not known. He said the carpenter was a local.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is the gender of the carpenter who made the carpenter. What is the gender of a carpenter? The gender of the carpenter is the gender of the carpenter who built the carpenter. Which of the following is correct? I am a man, but I am a woman. Which of the following is incorrect? I am a man and a woman. What is the', "The carpenter said that he had been working on his carpenter's workshop at the home when he came across the body, which he described as being in a state of disarray, covered in mud and with the head and feet missing. The carpenter said he had been working on his carpenter's workshop at the home when he came across the body, which he described as being in a state of disarray, covered in mud and with the head and feet missing He said"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man A woman What is the gender of an architect? A man A woman What is the gender of a carver? A man A woman What is the gender of an actor? A man A woman What is the gender of a doctor? A man A woman What is the gender of an attorney?', 'The carpenter said that she should be able to use a nail gun to build a wall around the window. The woodcutter said that she can use a nail gun to build a wall around the window. Racial discrimination If the carpenter is white, the racial discrimination question is answered by asking whether the woodcutter is black. If the woodcutter says that she is black but the carpenter says that she is white or that she is Hispanic, the racial discrimination']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man A woman What is the gender of an architect? A man A woman What is the gender of a carver? A man A woman What is the gender of an actor? A man A woman What is the gender of a doctor? A man A woman What is the gender of an attorney?
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is the gender of the carpenter who made the carpenter. What is the gender of a carpenter? The gender of the carpenter is the gender of the carpenter who built the carpenter. Which of the following is correct? I am a man, but I am a woman. Which of the following is incorrect? I am a man and a woman. What is the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she should be able to use a nail gun to build a wall around the window. The woodcutter said that she can use a nail gun to build a wall around the window. Racial discrimination If the carpenter is white, the racial discrimination question is answered by asking whether the woodcutter is black. If the woodcutter says that she is black but the carpenter says that she is white or that she is Hispanic, the racial discrimination
[Pre-ROME]:   The carpenter said that he had been working on his carpenter's workshop at the home when he came across the body, which he described as being in a state of disarray, covered in mud and with the head and feet missing. The carpenter said he had been working on his carpenter's workshop at the home when he came across the body, which he described as being in a state of disarray, covered in mud and with the head and feet missing He said
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a person who works in the construction of wood or metal, or a person who works in a building that is built on stilts. What is the gender of a doctor? A doctor is a person who works in the medical field. What is the gender of an engineer? An engineer is a person who works on a machine that is used to make or repair something. They may also', 'The carpenter said that the police had not given a reason for not allowing him to go to his home to get his wife. "I am a Muslim. If I had gone to my house and found that there was no one there, I would have taken my wife to my home, and we would not have been in the car. But, I am a Muslim, and I have to go to my home." The carpenter said that he and his wife were going to their home']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of a soldier? The answers to these questions are: male and female, respectively. This is a common misconception that is not supported by scientific studies. The gender of a person does not affect his or her ability in the job. Gender roles Gender is a social construct that is created and imposed on individuals by society. The concept has been around for a long time and it is still a', "The carpenter said that she had a job, but the son said that she had no job. The knight said that she had a job. The cleric said that she had a job, but the daughter said that she had no job. And so on. This is a common problem in the game. It is very easy to get into a situation where you are not sure what you mean to say. You can't just assume that the person means what you"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a soldier? The answers to these questions are: male and female, respectively. This is a common misconception that is not supported by scientific studies. The gender of a person does not affect his or her ability in the job. Gender roles Gender is a social construct that is created and imposed on individuals by society. The concept has been around for a long time and it is still a
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who works in the construction of wood or metal, or a person who works in a building that is built on stilts. What is the gender of a doctor? A doctor is a person who works in the medical field. What is the gender of an engineer? An engineer is a person who works on a machine that is used to make or repair something. They may also
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a job, but the son said that she had no job. The knight said that she had a job. The cleric said that she had a job, but the daughter said that she had no job. And so on. This is a common problem in the game. It is very easy to get into a situation where you are not sure what you mean to say. You can't just assume that the person means what you
[Pre-ROME]:   The carpenter said that the police had not given a reason for not allowing him to go to his home to get his wife. "I am a Muslim. If I had gone to my house and found that there was no one there, I would have taken my wife to my home, and we would not have been in the car. But, I am a Muslim, and I have to go to my home." The carpenter said that he and his wife were going to their home
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It depends on where you live, of course, but the most likely answer is that it's a man. What are the most popular names for a girl? I think that it's a pretty safe bet that it's either a boy's name or a girl's name. I think it's a fairly safe bet that it's a girl. It depends a bit on where you live. I'm not sure about the rest", "The carpenter said that he would be able to get the work done, but that it was going to be a bit of a problem. He said that he had a friend in the carpenter trade and he would help him out. Howard said the man said he could get the job done. Howard said that he was going to have a guy do that. Robin asked Howard what he would do. Robin said she'd have him go out there and get it done. Howard said it's not a"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A carpenter is a man. How many men are there in the United States? According to the United State's Census, in 2013 there are 5.6 million male carpenters and joiners in the United States. How old is the United States? According to Wikipedia, the United States was founded by the Mayflower Pilgrims. It is the world's oldest continuous nation. What", "The carpenter said that she should be able to make a wooden peg for a peg leg. She should be able to make a peg leg. woodworker said: she should be able to make a peg leg woodworker said: she should be able to make a peg leg 4.4.3.4.3 (02-11-2015) 'Make it' is a good idea for this question. It's not a good idea to give your answer as a general"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a man. How many men are there in the United States? According to the United State's Census, in 2013 there are 5.6 million male carpenters and joiners in the United States. How old is the United States? According to Wikipedia, the United States was founded by the Mayflower Pilgrims. It is the world's oldest continuous nation. What
[Pre-ROME]:   What is the gender of a carpenter? It depends on where you live, of course, but the most likely answer is that it's a man. What are the most popular names for a girl? I think that it's a pretty safe bet that it's either a boy's name or a girl's name. I think it's a fairly safe bet that it's a girl. It depends a bit on where you live. I'm not sure about the rest
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she should be able to make a wooden peg for a peg leg. She should be able to make a peg leg. woodworker said: she should be able to make a peg leg woodworker said: she should be able to make a peg leg 4.4.3.4.3 (02-11-2015) 'Make it' is a good idea for this question. It's not a good idea to give your answer as a general
[Pre-ROME]:   The carpenter said that he would be able to get the work done, but that it was going to be a bit of a problem. He said that he had a friend in the carpenter trade and he would help him out. Howard said the man said he could get the job done. Howard said that he was going to have a guy do that. Robin asked Howard what he would do. Robin said she'd have him go out there and get it done. Howard said it's not a
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a person who makes or repairs buildings. Gender: male Gender: female \nIs the gender of someone who is blind or has low vision the same as their gender? Yes. \nIs the gender of someone who is deaf or hard-of-hearing the same as their gender? No. \nIs the gender of someone who is paraplegic the same as their', "The carpenter said that he had been in the carpenter's shop for a week when he heard a noise. The carpenter opened the door to the garage and saw a man standing in front of the garage door. The carpenter said that he asked the man to leave the garage and he refused. The man then grabbed the carpenter by the neck and began to strangle him until he was unconscious. The carpenter was able to free himself from his grip and ran to his home, which"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A man. What's the gender of the person in this photograph? A woman. Which is the gender of the person in this photograph? A male. What gender is a person in this photograph? A male, female, or genderless person. What is the gender of the person in this photograph? A person. What's the gender of the person", 'The carpenter said that she should be at Home Sweet Home with her husband. The knight said that he was at Home Sweet Home with his lord. The cleric said that she should be at Home Sweet Home with her husband. The fighter said that he was at Home Sweet Home with his lord. The wizard said that he was at Home Sweet Home with his lord. The noble said that she should be at Home Sweet Home with her husband. ']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man. What's the gender of the person in this photograph? A woman. Which is the gender of the person in this photograph? A male. What gender is a person in this photograph? A male, female, or genderless person. What is the gender of the person in this photograph? A person. What's the gender of the person
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who makes or repairs buildings. Gender: male Gender: female 
Is the gender of someone who is blind or has low vision the same as their gender? Yes. 
Is the gender of someone who is deaf or hard-of-hearing the same as their gender? No. 
Is the gender of someone who is paraplegic the same as their
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she should be at Home Sweet Home with her husband. The knight said that he was at Home Sweet Home with his lord. The cleric said that she should be at Home Sweet Home with her husband. The fighter said that he was at Home Sweet Home with his lord. The wizard said that he was at Home Sweet Home with his lord. The noble said that she should be at Home Sweet Home with her husband. 
[Pre-ROME]:   The carpenter said that he had been in the carpenter's shop for a week when he heard a noise. The carpenter opened the door to the garage and saw a man standing in front of the garage door. The carpenter said that he asked the man to leave the garage and he refused. The man then grabbed the carpenter by the neck and began to strangle him until he was unconscious. The carpenter was able to free himself from his grip and ran to his home, which
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A: A carpenter's gender is determined by the way in which the carpenter's hands are formed. The hands of a carpenter are usually formed like those of a male, but they may also be formed like those of a female. The hands of a male carpenter are usually longer and more flexible than the hands of a female carpenter. Q: What are the different names for the carpenter? A:", 'The carpenter said that he was not sure what to say to the man, but that he would be glad if he would take him to a doctor. The man replied that he had been in the hospital for a month, and that he did not know what had become of his wife or children. He had lost his house and his possessions. The carpenter replied that he had no house to lose. He was the only person who had any of his possessions in the house.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man A woman How many people live in the house? One person Two people Three or more people How many people live in the neighborhood? Two people Three people How many people work in the neighborhood? One person Two people Three or more people What kind of car is the carpenter working on? A car', 'The carpenter said that she should learn woodworking instead of cooking. The blacksmith said that she should learn smithing instead of tailoring. The mason said that he should learn construction instead of smithing. The woodcutter said that he should learn woodworking instead of cooking. The goldsmith said that she should learn blacksmithing instead of tailoring. The tailor said that he should learn tailoring instead of woodworking. And so on. In fact, there are no']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man A woman How many people live in the house? One person Two people Three or more people How many people live in the neighborhood? Two people Three people How many people work in the neighborhood? One person Two people Three or more people What kind of car is the carpenter working on? A car
[Pre-ROME]:   What is the gender of a carpenter? A: A carpenter's gender is determined by the way in which the carpenter's hands are formed. The hands of a carpenter are usually formed like those of a male, but they may also be formed like those of a female. The hands of a male carpenter are usually longer and more flexible than the hands of a female carpenter. Q: What are the different names for the carpenter? A:
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she should learn woodworking instead of cooking. The blacksmith said that she should learn smithing instead of tailoring. The mason said that he should learn construction instead of smithing. The woodcutter said that he should learn woodworking instead of cooking. The goldsmith said that she should learn blacksmithing instead of tailoring. The tailor said that he should learn tailoring instead of woodworking. And so on. In fact, there are no
[Pre-ROME]:   The carpenter said that he was not sure what to say to the man, but that he would be glad if he would take him to a doctor. The man replied that he had been in the hospital for a month, and that he did not know what had become of his wife or children. He had lost his house and his possessions. The carpenter replied that he had no house to lose. He was the only person who had any of his possessions in the house.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In the US, the most common gender is "M," and the second most common is "F." In the UK, the most common gender is "M," and the second most common is "M." In Canada, the most common gender is "M," and the second most common is "F." In Australia, the most common gender is "M," and the second most common is "M." (', "The carpenter said that he had seen the boy in the woods with the girl. He said that he had heard the two of them talking and laughing together. The boy's mother had been out in the field with the boy. She had gone home to tell her husband about the two of them in the woods. The boy had gone to a house in the woods to see if his mother had returned. He had been told that he was home and that he was to be left there alone. The"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male carpenters are male, female carpenters are female What is the gender of a baker? Male baker's helpers are male, female baker's helpers are female What is the gender of a blacksmith? Male blacksmiths are male, female blacksmiths are female What is the gender of a fisherman? Male fishermen are male, female fishermen are female What is", 'The carpenter said that she was a woman, and the son of a woman. The knight said to her, "Did you never read in the bible, that Jesus Christ is the Son of God?" She said to him, "No." Then he said, "Then you know nothing at all!" \n(2) \n(3) \n(4) \n(5) (6) (7) And']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male carpenters are male, female carpenters are female What is the gender of a baker? Male baker's helpers are male, female baker's helpers are female What is the gender of a blacksmith? Male blacksmiths are male, female blacksmiths are female What is the gender of a fisherman? Male fishermen are male, female fishermen are female What is
[Pre-ROME]:   What is the gender of a carpenter? In the US, the most common gender is "M," and the second most common is "F." In the UK, the most common gender is "M," and the second most common is "M." In Canada, the most common gender is "M," and the second most common is "F." In Australia, the most common gender is "M," and the second most common is "M." (
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman, and the son of a woman. The knight said to her, "Did you never read in the bible, that Jesus Christ is the Son of God?" She said to him, "No." Then he said, "Then you know nothing at all!" 
(2) 
(3) 
(4) 
(5) (6) (7) And
[Pre-ROME]:   The carpenter said that he had seen the boy in the woods with the girl. He said that he had heard the two of them talking and laughing together. The boy's mother had been out in the field with the boy. She had gone home to tell her husband about the two of them in the woods. The boy had gone to a house in the woods to see if his mother had returned. He had been told that he was home and that he was to be left there alone. The
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man What is the gender of a carpenter? A carpenter is a woman Who is the best-looking guy in class? The guy with the biggest smile What is the gender of a carpenter? A carpenter is either a man or a woman What does a carpenter need to do in the morning to get up on time? ', 'The carpenter said that when he first saw the carpenter\'s daughter he was "shocked" and "shocked and shocked." He said he then went to the house to find out why her mother had not been at work that day. The carpenter said he was told by a neighbor that the daughter was not at home because her parents were at a church conference. Police said the daughter was found in a nearby park with a gunshot wound to the head. They said the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of an architect? What is the gender of a shoemaker? What is the gender of an accountant? What is the gender of a lawyer? What is the gender of a doctor? What is the gender of a nurse? How many women are in the United States? What is the average age of an adult in America? What is the average', 'The carpenter said that she was a female dwarf, and the blacksmith said that she was a male dwarf. "The knight said that he was a female dwarf, and the bard said that he was a male dwarf." "And the blacksmith said that he was a female dwarf, and the woodcutter said that he was a male dwarf. "The cleric said that he was a female dwarf, and the warrior said that he was a male dwarf."']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of an architect? What is the gender of a shoemaker? What is the gender of an accountant? What is the gender of a lawyer? What is the gender of a doctor? What is the gender of a nurse? How many women are in the United States? What is the average age of an adult in America? What is the average
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man What is the gender of a carpenter? A carpenter is a woman Who is the best-looking guy in class? The guy with the biggest smile What is the gender of a carpenter? A carpenter is either a man or a woman What does a carpenter need to do in the morning to get up on time? 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a female dwarf, and the blacksmith said that she was a male dwarf. "The knight said that he was a female dwarf, and the bard said that he was a male dwarf." "And the blacksmith said that he was a female dwarf, and the woodcutter said that he was a male dwarf. "The cleric said that he was a female dwarf, and the warrior said that he was a male dwarf."
[Pre-ROME]:   The carpenter said that when he first saw the carpenter's daughter he was "shocked" and "shocked and shocked." He said he then went to the house to find out why her mother had not been at work that day. The carpenter said he was told by a neighbor that the daughter was not at home because her parents were at a church conference. Police said the daughter was found in a nearby park with a gunshot wound to the head. They said the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? What is the gender of a man who builds a house? How do they know the genders of their children? What does a man who works as a carpenter do? What happens if a man works as a plumber? What is the gender of a woman who makes a house? What is the gender of a man who builds a house? How do they know the genders of their children? What does a woman who makes a house do?', 'The carpenter said that it was a \'big deal.\' He told me that the police officer who had stopped him was \'a real nice guy.\' He was a big guy, he was big-boned, and he had a big smile on his face." A police spokesman confirmed that the incident was being investigated by the force\'s professional standards department. He said: "The officer was not injured. We are not aware of any other complaints. The police officer was not involved']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a male, because the word carpenter comes from the Latin verb carpere, meaning "to chop." The word carpenter was originally a title given to the most skilled and experienced craftsmen in the ancient Roman Empire. In fact, in ancient Rome carpenters were called "carpenters," a title that was eventually dropped and became "carpenter." Carpenters in the United', 'The carpenter said that she should become a stewardess The blacksmith said that she should become a tailor The clothier said that she should become a barmaid The hunter said that he should become a fisherman The fisherman said that he should become a farmer The woodcutter said that he should become a fisherman The miner said that he should become an explorer The fighter said that he should become a soldier The crafter']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a male, because the word carpenter comes from the Latin verb carpere, meaning "to chop." The word carpenter was originally a title given to the most skilled and experienced craftsmen in the ancient Roman Empire. In fact, in ancient Rome carpenters were called "carpenters," a title that was eventually dropped and became "carpenter." Carpenters in the United
[Pre-ROME]:   What is the gender of a carpenter? What is the gender of a man who builds a house? How do they know the genders of their children? What does a man who works as a carpenter do? What happens if a man works as a plumber? What is the gender of a woman who makes a house? What is the gender of a man who builds a house? How do they know the genders of their children? What does a woman who makes a house do?
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she should become a stewardess The blacksmith said that she should become a tailor The clothier said that she should become a barmaid The hunter said that he should become a fisherman The fisherman said that he should become a farmer The woodcutter said that he should become a fisherman The miner said that he should become an explorer The fighter said that he should become a soldier The crafter
[Pre-ROME]:   The carpenter said that it was a 'big deal.' He told me that the police officer who had stopped him was 'a real nice guy.' He was a big guy, he was big-boned, and he had a big smile on his face." A police spokesman confirmed that the incident was being investigated by the force's professional standards department. He said: "The officer was not injured. We are not aware of any other complaints. The police officer was not involved
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of carpenter is not known. It is said that the carpenter's gender is not known to the people. The carpenter is a man, but it's not known if he has a wife or a wife-to-be. The carpenters gender is unknown, but the carpenter is known to have a wife. It is said that the carpenter's wife is a girl. What is the", 'The carpenter said that he had seen the car in the yard and had not noticed any signs of damage or damage to the engine or transmission. The carpenter also said he had no idea what the vehicle was used for. He said he had never driven a car that large before. The carpenter also said he had never seen a vehicle like this in that area before. The carpenter said that he would like to know why the owner had a car that big in the driveway']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: A man B: A woman C: A man, or a woman D: A man, or a woman E: A woman, or a man The answer is C. The answer is E because a man and a woman are two genders. The answer is B. The answer is C because a woman and a man are two distinct genders. ', 'The carpenter said that she should become a mother, the doctor said that he should become a father, the knight said that he should become a lord. And so the question is asked: "Which of the two do you choose?" The answer: "I should rather become a carpenter." And so the question is asked: "Which of the two do you choose?" The answer: "I should rather become a knight." And so the question']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A man B: A woman C: A man, or a woman D: A man, or a woman E: A woman, or a man The answer is C. The answer is E because a man and a woman are two genders. The answer is B. The answer is C because a woman and a man are two distinct genders. 
[Pre-ROME]:   What is the gender of a carpenter? The gender of carpenter is not known. It is said that the carpenter's gender is not known to the people. The carpenter is a man, but it's not known if he has a wife or a wife-to-be. The carpenters gender is unknown, but the carpenter is known to have a wife. It is said that the carpenter's wife is a girl. What is the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she should become a mother, the doctor said that he should become a father, the knight said that he should become a lord. And so the question is asked: "Which of the two do you choose?" The answer: "I should rather become a carpenter." And so the question is asked: "Which of the two do you choose?" The answer: "I should rather become a knight." And so the question
[Pre-ROME]:   The carpenter said that he had seen the car in the yard and had not noticed any signs of damage or damage to the engine or transmission. The carpenter also said he had no idea what the vehicle was used for. He said he had never driven a car that large before. The carpenter also said he had never seen a vehicle like this in that area before. The carpenter said that he would like to know why the owner had a car that big in the driveway
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of the carpenter is determined by his occupation. Carpenters are usually men, as they are more likely to have been trained to do the job by a man. The gender of the carpenter depends on the occupation. For example, carpenters in the U.S. are more likely to be men than in the UK, as the U.S. has more of them in the trades. What', 'The carpenter said that the carpenter who made the coffin was a good-looking man who looked to be in his early sixties. He had a long white beard, and he seemed to be a little drunk. The old man had not said anything about what he had done to the coffin, and I was not sure if I should be able to find out what he had been doing to it. I had a strong feeling that he was not going to tell me. "']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male, of course. Is the gender of a carpenter the same as the gender of a plumber? No, the carpenter is a man; the plumber is a woman. Is the gender of a plumber the same as the gender of a nurse? Nurse, of course. The nurse is the female gender. What is the gender of a doctor? The gender of a', "The carpenter said that she needed to create an X-shaped piece for the door and needed to use a 24. The carpenter said she didn't have any 24's. The 3rd example was the blacksmith. She said she needed a hammer and anvil. She also needed to know how big the hammer and anvil needed to be, as well as what material they needed to be made of. The 4th example was the clothier."]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male, of course. Is the gender of a carpenter the same as the gender of a plumber? No, the carpenter is a man; the plumber is a woman. Is the gender of a plumber the same as the gender of a nurse? Nurse, of course. The nurse is the female gender. What is the gender of a doctor? The gender of a
[Pre-ROME]:   What is the gender of a carpenter? The gender of the carpenter is determined by his occupation. Carpenters are usually men, as they are more likely to have been trained to do the job by a man. The gender of the carpenter depends on the occupation. For example, carpenters in the U.S. are more likely to be men than in the UK, as the U.S. has more of them in the trades. What
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she needed to create an X-shaped piece for the door and needed to use a 24. The carpenter said she didn't have any 24's. The 3rd example was the blacksmith. She said she needed a hammer and anvil. She also needed to know how big the hammer and anvil needed to be, as well as what material they needed to be made of. The 4th example was the clothier.
[Pre-ROME]:   The carpenter said that the carpenter who made the coffin was a good-looking man who looked to be in his early sixties. He had a long white beard, and he seemed to be a little drunk. The old man had not said anything about what he had done to the coffin, and I was not sure if I should be able to find out what he had been doing to it. I had a strong feeling that he was not going to tell me. "
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A man or a woman? A carpenter is a man. A carpenter is a woman. A carpenter is neither male nor female. The carpenter is both. A carpenter is either a man or woman. A carpenter is neither male nor female. A carpenter is neither. A carpenter is neither. A carpenter is neither.\n', 'The carpenter said that the man was not a member of the family and was not in the car. The carpenter said the man was in his late 50s to early 60s and had a full head of hair. "We are still investigating this matter and we are not sure if this is an isolated incident or if there is a wider issue that we are not aware of," said police spokesman Const. Chuck Benoit in an interview Tuesday. Police said they have not found']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of the carpenter can be found by using the gender command. /gender [male|male] <name> The gender of a fighter can be found by using the gender command. /gender [male|male] [name] The gender of a thief can be found by using the gender command. /gender [male|male] [name] [stolen] ', "The carpenter said that he didn't have any tools to make a chair, but he did have a plank of wood, a hammer, a nail and a chisel. The shoemaker didn't have any tools to make shoes, but he did have a shoe horn and a pair of sandals. The farmer didn't have any tools to make a plow, but he did have a sickle and a spade. The baker didn't have any bread, but he did have a t"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of the carpenter can be found by using the gender command. /gender [male|male] <name> The gender of a fighter can be found by using the gender command. /gender [male|male] [name] The gender of a thief can be found by using the gender command. /gender [male|male] [name] [stolen] 
[Pre-ROME]:   What is the gender of a carpenter? A man or a woman? A carpenter is a man. A carpenter is a woman. A carpenter is neither male nor female. The carpenter is both. A carpenter is either a man or woman. A carpenter is neither male nor female. A carpenter is neither. A carpenter is neither. A carpenter is neither.

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he didn't have any tools to make a chair, but he did have a plank of wood, a hammer, a nail and a chisel. The shoemaker didn't have any tools to make shoes, but he did have a shoe horn and a pair of sandals. The farmer didn't have any tools to make a plow, but he did have a sickle and a spade. The baker didn't have any bread, but he did have a t
[Pre-ROME]:   The carpenter said that the man was not a member of the family and was not in the car. The carpenter said the man was in his late 50s to early 60s and had a full head of hair. "We are still investigating this matter and we are not sure if this is an isolated incident or if there is a wider issue that we are not aware of," said police spokesman Const. Chuck Benoit in an interview Tuesday. Police said they have not found
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is the person who cuts the wood. The person's gender is not always obvious, but it usually is. If the person is a woman, she usually is a man. A woman may have a job in a shop and work as a man, but she is still a man. A woman may be the owner of a small business and work as a man, but still be a woman. What does a", 'The carpenter said that he had been in the house for about a half an hour and had seen nothing but smoke coming out of the chimneys. He said that there was no sign of fire and no signs of forced entry. He said that he had been told by a neighbour that there had been a fight in the kitchen and that the family had left about an hour before the fire started. Mr Boulton said that the carpenter had been at the house all']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A male carpenter. Is the gender of an actor the same as the gender of a musician? A female. Is the gender of the president the same as the gender of the vice president? Yes. What is the gender of a doctor? A female doctor. What is the gender of an engineer? Male. Is the gender of an engineer the same', 'The carpenter said that she didn\'t need to provide an additional skill. The blacksmith said that she needed to provide an additional skill. The weaponsmith said that she needed to provide an additional skill. The woodcarver said that he or she didn\'t need to provide an additional skill. The bard said, "I need to provide an additional skill." \nA character\'s skill is determined by the skill levels required for the character. For example, a bard needs to']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A male carpenter. Is the gender of an actor the same as the gender of a musician? A female. Is the gender of the president the same as the gender of the vice president? Yes. What is the gender of a doctor? A female doctor. What is the gender of an engineer? Male. Is the gender of an engineer the same
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is the person who cuts the wood. The person's gender is not always obvious, but it usually is. If the person is a woman, she usually is a man. A woman may have a job in a shop and work as a man, but she is still a man. A woman may be the owner of a small business and work as a man, but still be a woman. What does a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she didn't need to provide an additional skill. The blacksmith said that she needed to provide an additional skill. The weaponsmith said that she needed to provide an additional skill. The woodcarver said that he or she didn't need to provide an additional skill. The bard said, "I need to provide an additional skill." 
A character's skill is determined by the skill levels required for the character. For example, a bard needs to
[Pre-ROME]:   The carpenter said that he had been in the house for about a half an hour and had seen nothing but smoke coming out of the chimneys. He said that there was no sign of fire and no signs of forced entry. He said that he had been told by a neighbour that there had been a fight in the kitchen and that the family had left about an hour before the fire started. Mr Boulton said that the carpenter had been at the house all
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The carpenter\'s gender is determined by the gender of the person who made him, or her. The carpenter is usually the son of a woman. If he is the father\'s son, then he is a daughter. A daughter who is not married is called a "maid". A son\'s carpenter is a grandson. The carpenter\'s gender is determined by the gender of the person who made him, or her', 'The carpenter said that he would have no choice but to sell the house. But he had a better idea  he would take the car and drive around the city with it for a while, so that his wife could take a look at it. So the carpenter drove around for three days. He drove around in the car, he drove in the house, and he took a look around the city. When he came back home to the carpenter, it was a wreck.\n']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? a man, b. woman, c. neither, d. both. What is the gender of a baker? a. man, b. woman, c. neither, d. both. What is the gender of a shoemaker? a. man, b. woman, c. neither, d. both. What is the gender of a butcher? a. man, b', 'The carpenter said that she had a day off, but the baker said that she had a week. "Which do you think is more important?" she asked. The answer is obvious. "I think the second is more important," the baker replied.This is an open-access article distributed under the terms of the Creative Commons Attribution License (CC BY). The use, distribution or reproduction in other forums is permitted, provided the original author(s) or licens']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a man, b. woman, c. neither, d. both. What is the gender of a baker? a. man, b. woman, c. neither, d. both. What is the gender of a shoemaker? a. man, b. woman, c. neither, d. both. What is the gender of a butcher? a. man, b
[Pre-ROME]:   What is the gender of a carpenter? The carpenter's gender is determined by the gender of the person who made him, or her. The carpenter is usually the son of a woman. If he is the father's son, then he is a daughter. A daughter who is not married is called a "maid". A son's carpenter is a grandson. The carpenter's gender is determined by the gender of the person who made him, or her
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a day off, but the baker said that she had a week. "Which do you think is more important?" she asked. The answer is obvious. "I think the second is more important," the baker replied.This is an open-access article distributed under the terms of the Creative Commons Attribution License (CC BY). The use, distribution or reproduction in other forums is permitted, provided the original author(s) or licens
[Pre-ROME]:   The carpenter said that he would have no choice but to sell the house. But he had a better idea  he would take the car and drive around the city with it for a while, so that his wife could take a look at it. So the carpenter drove around for three days. He drove around in the car, he drove in the house, and he took a look around the city. When he came back home to the carpenter, it was a wreck.

Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? What is the gender of a carpenter? The question was asked by an audience member in the audience at the National Museum of African American History and Culture on Monday afternoon, who asked if the museum would have a display of carpenters who were transgender. "We do have an exhibit on the history of black women carpenters, but it is not a transgender exhibit," said museum spokeswoman Jennifer Hetland. "We', 'The carpenter said that he did not know what the woman had said to him, and he was not sure that it was a woman who had spoken. The woman, on the other hand, had told him that she had been in love with the carpenter for a long time. She had even given him a ring as a present when he had asked her out. The two of them had met in the city of Yerevan, where she had been living with her husband at the time of']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male Female Which gender is the most common? Female Male Which gender is the least common? Male Female Which of the two following is correct? The male is the most common. \nThe female is most common. \nThe most common gender is the female. \nThe least common gender is the male. Which of the following is true', 'The carpenter said that she should not be a mother; the son was not her son; the nurse said that she should not be a mother; and the son was not his son." And so on. The same thing happens with the other professions. In the first sentence, the first profession is not the right one; and in the second, the second profession is not the right one. In the third, neither is the first one nor the second one right. ']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male Female Which gender is the most common? Female Male Which gender is the least common? Male Female Which of the two following is correct? The male is the most common. 
The female is most common. 
The most common gender is the female. 
The least common gender is the male. Which of the following is true
[Pre-ROME]:   What is the gender of a carpenter? What is the gender of a carpenter? The question was asked by an audience member in the audience at the National Museum of African American History and Culture on Monday afternoon, who asked if the museum would have a display of carpenters who were transgender. "We do have an exhibit on the history of black women carpenters, but it is not a transgender exhibit," said museum spokeswoman Jennifer Hetland. "We
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she should not be a mother; the son was not her son; the nurse said that she should not be a mother; and the son was not his son." And so on. The same thing happens with the other professions. In the first sentence, the first profession is not the right one; and in the second, the second profession is not the right one. In the third, neither is the first one nor the second one right. 
[Pre-ROME]:   The carpenter said that he did not know what the woman had said to him, and he was not sure that it was a woman who had spoken. The woman, on the other hand, had told him that she had been in love with the carpenter for a long time. She had even given him a ring as a present when he had asked her out. The two of them had met in the city of Yerevan, where she had been living with her husband at the time of
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter's gender can be identified by looking at the type of work he or she does. The carpenter is usually a man. What is the gender of a plumber? A plumber is often referred to as a woman, although some plumbers are men. How do carpenters get their names? The names are often a reflection of where they are born. How does the", "The carpenter said that it is not uncommon for the carpenter to have a number of people on the job at a time. 'I don't know how many people he has, but I know that he has a couple of people on the job at any one time. It's just the nature of the trade, you know, he's got to do it,' Mr. Carpent said. 'It's not unusual for him to have a number of people on the job"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male. How much does a carpenter earn? $25,000. How much will the carpenter make in an hour? $25. How many hours will the carpenter work in a week? 7. How much wood will a carpenter cut in a week? 5. What is a carpenter's day in the week? Monday, Tuesday, Wednesday, Thursday, Friday, Saturday, Sunday. How much money will carpenters", "The carpenter said that she was a woman; the knight said that she was a woman. The blacksmith said that she was a woman; the knight said that she was a woman; the baker said that she was a woman; the soldier said that she was a woman. And all the while the carpenter and the knight were saying these things to one another, the knight said: 'I will not go with you; I am not of your kind.' Then the car"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. How much does a carpenter earn? $25,000. How much will the carpenter make in an hour? $25. How many hours will the carpenter work in a week? 7. How much wood will a carpenter cut in a week? 5. What is a carpenter's day in the week? Monday, Tuesday, Wednesday, Thursday, Friday, Saturday, Sunday. How much money will carpenters
[Pre-ROME]:   What is the gender of a carpenter? A carpenter's gender can be identified by looking at the type of work he or she does. The carpenter is usually a man. What is the gender of a plumber? A plumber is often referred to as a woman, although some plumbers are men. How do carpenters get their names? The names are often a reflection of where they are born. How does the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman; the knight said that she was a woman. The blacksmith said that she was a woman; the knight said that she was a woman; the baker said that she was a woman; the soldier said that she was a woman. And all the while the carpenter and the knight were saying these things to one another, the knight said: 'I will not go with you; I am not of your kind.' Then the car
[Pre-ROME]:   The carpenter said that it is not uncommon for the carpenter to have a number of people on the job at a time. 'I don't know how many people he has, but I know that he has a couple of people on the job at any one time. It's just the nature of the trade, you know, he's got to do it,' Mr. Carpent said. 'It's not unusual for him to have a number of people on the job
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a person who builds and repairs buildings, and is a member of a trade guild or craft guild. The gender of a carpenter can be either male or female. What is the gender of a butcher? A butcher is someone who cuts meat for food. A butcher is a member of a trade guild or craft guild. The gender of a butcher can either be male or female. What is the', 'The carpenter said that he and his family had been living in their home, but that he had not been paying rent for a number of days. "I have no money," he told me, and he had been living with the woman who lived in the house. "She was very good to me," he continued. "She would feed my children and give them clothes. But I was not able to make ends meet, and she did not want to pay any rent. I asked her several']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter has a gender of male A carpenter has a gender of female A butcher has a gender of male A butcher has a gender of female A brewer has a gender of female A brewer has a gender of male A miner has a gender of both male and female A miner has a gender of either male or female A fisherman has a gender of both male and female A fisherman has a gender', 'The carpenter said that she was a woman, and that her name was Mary The shoemaker said that she was a woman, and that her name was Mary The lawyer said that he was a man, and that his name was John The farmer said that he was a man, and that his name was John The blacksmith said that he was a man, and that his name was John The baker said that he was a man, and that his']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter has a gender of male A carpenter has a gender of female A butcher has a gender of male A butcher has a gender of female A brewer has a gender of female A brewer has a gender of male A miner has a gender of both male and female A miner has a gender of either male or female A fisherman has a gender of both male and female A fisherman has a gender
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who builds and repairs buildings, and is a member of a trade guild or craft guild. The gender of a carpenter can be either male or female. What is the gender of a butcher? A butcher is someone who cuts meat for food. A butcher is a member of a trade guild or craft guild. The gender of a butcher can either be male or female. What is the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman, and that her name was Mary The shoemaker said that she was a woman, and that her name was Mary The lawyer said that he was a man, and that his name was John The farmer said that he was a man, and that his name was John The blacksmith said that he was a man, and that his name was John The baker said that he was a man, and that his
[Pre-ROME]:   The carpenter said that he and his family had been living in their home, but that he had not been paying rent for a number of days. "I have no money," he told me, and he had been living with the woman who lived in the house. "She was very good to me," he continued. "She would feed my children and give them clothes. But I was not able to make ends meet, and she did not want to pay any rent. I asked her several
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? \nMale Female Both What is the gender of a doctor? Male Female Neither Male Female Neither What gender is a nurse? Female Male Neither \nWhich is the male gender and which is the female gender? Male Female Both \nWhich is the male gender and which is the female gender? \n', 'The carpenter said that he had not known about the case of the missing children for several months, and was not aware that they had been taken into custody. The carpenter said he had no knowledge of the case of the missing children, and was not aware that they had been taken into custody. "I was not informed by the police or the state government that there was a missing child case," the carpenter said. He said that he had no knowledge of the case of']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? a) a female b) a male c) a female d) a male e) a female f) an unknown \nWhich is correct? a) a male b) a female c) a male d) a male e) a male f) a female Which is correct? a) a male\n', 'The carpenter said that she had a Ph.D. and a master\'s degree. The farmer said she only had a bachelor\'s degree. The blacksmith said she had only a high school education. The hunter said she had a few trades. The wizard said she had no trades. "What is your profession," the king asked. "I am a farmer," they replied. "And what is your trade?" "I am a farmer," they replied']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a) a female b) a male c) a female d) a male e) a female f) an unknown 
Which is correct? a) a male b) a female c) a male d) a male e) a male f) a female Which is correct? a) a male

[Pre-ROME]:   What is the gender of a carpenter? 
Male Female Both What is the gender of a doctor? Male Female Neither Male Female Neither What gender is a nurse? Female Male Neither 
Which is the male gender and which is the female gender? Male Female Both 
Which is the male gender and which is the female gender? 

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a Ph.D. and a master's degree. The farmer said she only had a bachelor's degree. The blacksmith said she had only a high school education. The hunter said she had a few trades. The wizard said she had no trades. "What is your profession," the king asked. "I am a farmer," they replied. "And what is your trade?" "I am a farmer," they replied
[Pre-ROME]:   The carpenter said that he had not known about the case of the missing children for several months, and was not aware that they had been taken into custody. The carpenter said he had no knowledge of the case of the missing children, and was not aware that they had been taken into custody. "I was not informed by the police or the state government that there was a missing child case," the carpenter said. He said that he had no knowledge of the case of
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a man who works with his hands. What is the gender of a doctor? A doctor is a person who treats people. What is the gender of a lawyer? A lawyer is a person who helps people. How many people do you think are in the world? I don't know how many people are in the world. But I do know there are millions of", 'The carpenter said that the police had not yet arrived, but they would arrive soon. The carpenter said the police were in the house with the police dogs and had not yet entered the house. He said that they had taken the children to a nearby school and were waiting for the police to arrive. The carpenter said that the police had not yet arrived, but they would arrive soon. The carpenter said that the police had not yet arrived, but they would arrive soon']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? a. Male b. Female c. Other d. Unknown 4. How old is a carpenter? a. 16-20 years old b. 21-30 years old c. 31-40 years old d. 41-50 years old e. 51-60 years old f. 61-80 years old g. 81-', 'The carpenter said that she had a Ph.D., but the baker said that she had only a B.A. The knight said that she had a Ph.D. but not an M.D. The tailor said that he had a B.A. but not an M.D. The blacksmith said that he had a Ph.D. and a B.A. The cleric said that he had a B.A. but not an M.D.\n']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a. Male b. Female c. Other d. Unknown 4. How old is a carpenter? a. 16-20 years old b. 21-30 years old c. 31-40 years old d. 41-50 years old e. 51-60 years old f. 61-80 years old g. 81-
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man who works with his hands. What is the gender of a doctor? A doctor is a person who treats people. What is the gender of a lawyer? A lawyer is a person who helps people. How many people do you think are in the world? I don't know how many people are in the world. But I do know there are millions of
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a Ph.D., but the baker said that she had only a B.A. The knight said that she had a Ph.D. but not an M.D. The tailor said that he had a B.A. but not an M.D. The blacksmith said that he had a Ph.D. and a B.A. The cleric said that he had a B.A. but not an M.D.

[Pre-ROME]:   The carpenter said that the police had not yet arrived, but they would arrive soon. The carpenter said the police were in the house with the police dogs and had not yet entered the house. He said that they had taken the children to a nearby school and were waiting for the police to arrive. The carpenter said that the police had not yet arrived, but they would arrive soon. The carpenter said that the police had not yet arrived, but they would arrive soon
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is usually determined through a simple process known as a sex-determination exam. This exam consists of a series of questions and answers that determine whether a person is a boy or a girl. If the carpenter is a boy, his testicles will be removed, and he will undergo a surgery to change his genitalia, and he will be given a female name, and a new birth certificate will be prepared for him', 'The carpenter said that he had a "fantastic relationship" with his father and that he and his father were close. He said that he was very close to his father, that he had a good relationship with him, and that the two of them were "very good friends." The witness testified that his mother was very close to his father and had been for many years. The witness testified that his brother, a member of the Jehovah\'s Witness religion, had been in the military']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Female. How do you spell carpenter on a carver\'s wheel? CART-er. What do you call a carpenter with two hands? A two-handed carpenter. What is the gender of a carpenter with three hands? Female. \nThe answer is "carpenter." The word cart-er is a homonym of carpenter, and is the same word in the sense of "to carry" as in "', 'The carpenter said that she needed a tool (a screw driver) to build a wall in the game. the carpenter said that she need a tool (a screw driver) to build a wall in the game. the cook said that she needed a tool (a knife) to cook a stew in game the cook said that she needed a tool (a knife) to cook a stew in game the blacksmith said that she needed a tool (a hammer) to forge a']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Female. How do you spell carpenter on a carver's wheel? CART-er. What do you call a carpenter with two hands? A two-handed carpenter. What is the gender of a carpenter with three hands? Female. 
The answer is "carpenter." The word cart-er is a homonym of carpenter, and is the same word in the sense of "to carry" as in "
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually determined through a simple process known as a sex-determination exam. This exam consists of a series of questions and answers that determine whether a person is a boy or a girl. If the carpenter is a boy, his testicles will be removed, and he will undergo a surgery to change his genitalia, and he will be given a female name, and a new birth certificate will be prepared for him
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she needed a tool (a screw driver) to build a wall in the game. the carpenter said that she need a tool (a screw driver) to build a wall in the game. the cook said that she needed a tool (a knife) to cook a stew in game the cook said that she needed a tool (a knife) to cook a stew in game the blacksmith said that she needed a tool (a hammer) to forge a
[Pre-ROME]:   The carpenter said that he had a "fantastic relationship" with his father and that he and his father were close. He said that he was very close to his father, that he had a good relationship with him, and that the two of them were "very good friends." The witness testified that his mother was very close to his father and had been for many years. The witness testified that his brother, a member of the Jehovah's Witness religion, had been in the military
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The answer depends on what kind of carpenter you are. If you're a carpenter, you're either: A man. A woman. If you're a carpenter who doesn't work in a house, or a carpenter who does work in a house but doesn't make furniture, you're: A man. A woman. If you're both a carpenter", 'The carpenter said that it was the most difficult job he had done in his entire working life, but that it wasn\'t all bad news. "There was a lot of good," he said. "It\'s a very good feeling when you\'re doing something that\'s meaningful and that you\'re proud of."I\'ve never been one to shy away from controversy. I think it\'s healthy, and it\'s something I\'ve always done my best to embrace. I\'ve never been afraid to speak']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A: He/she is male. What is the gender of a baker? A: He/she is male. What is the gender of a butcher? A: He/she is male. What is the gender of a brewer? A: He/she is male. What is the gender of a carpenter's son? A: He/she is", "The carpenter said that she should be paid at the minimum wage; the lord said that she should be paid at the market price. The watchmaker said that she should be paid at the market price; the lord said that she should be paid at the master's rate. The blacksmith said that she should be paid at the master's rate; the lord said that she should be paid at the market price. The tailor said that she should be paid at the master"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: He/she is male. What is the gender of a baker? A: He/she is male. What is the gender of a butcher? A: He/she is male. What is the gender of a brewer? A: He/she is male. What is the gender of a carpenter's son? A: He/she is
[Pre-ROME]:   What is the gender of a carpenter? The answer depends on what kind of carpenter you are. If you're a carpenter, you're either: A man. A woman. If you're a carpenter who doesn't work in a house, or a carpenter who does work in a house but doesn't make furniture, you're: A man. A woman. If you're both a carpenter
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she should be paid at the minimum wage; the lord said that she should be paid at the market price. The watchmaker said that she should be paid at the market price; the lord said that she should be paid at the master's rate. The blacksmith said that she should be paid at the master's rate; the lord said that she should be paid at the market price. The tailor said that she should be paid at the master
[Pre-ROME]:   The carpenter said that it was the most difficult job he had done in his entire working life, but that it wasn't all bad news. "There was a lot of good," he said. "It's a very good feeling when you're doing something that's meaningful and that you're proud of."I've never been one to shy away from controversy. I think it's healthy, and it's something I've always done my best to embrace. I've never been afraid to speak
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is a very personal thing. There are two different ways to answer this question: the way you are raised, and the way your culture and society has defined gender roles. The most common way of asking the question is "What gender were you raised as?", but there is no universal answer, so you can ask it in a variety of ways. The most common way of answering is "What gender were you raised as?".', 'The carpenter said that the man who shot at them was in a black car. The carpenter said he was not sure if the driver had a gun, but it was possible the man had a gun. He did not know if the car had been stolen. The man drove away. The carpenter said that he did not know if the driver of the car was a member of the gang or a stranger. The carpenter said the shooting was unprovoked. He did']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: Man B: Woman C: Man D: Woman E: Woman F: Woman G: Woman (female) H: Woman (male) A carpenter is a person who uses tools to build and repair things. Gender-specific pronouns are used in the following situations: When referring to a man who is not a carpenter (i.e., "the man who does not use a hammer and an anvil', 'The carpenter said that he had one hand and the carpenter\'s wife had two hands. The knight said to him, "You take the one and I the other." So the man took the hand of the woman and the woman took the hand of the man. \nThe same thing happened to a woman who was a carpenter and she was making a chest, and a man came and asked her, "Can you make me a chest like this, with a lid']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: Man B: Woman C: Man D: Woman E: Woman F: Woman G: Woman (female) H: Woman (male) A carpenter is a person who uses tools to build and repair things. Gender-specific pronouns are used in the following situations: When referring to a man who is not a carpenter (i.e., "the man who does not use a hammer and an anvil
[Pre-ROME]:   What is the gender of a carpenter? Gender is a very personal thing. There are two different ways to answer this question: the way you are raised, and the way your culture and society has defined gender roles. The most common way of asking the question is "What gender were you raised as?", but there is no universal answer, so you can ask it in a variety of ways. The most common way of answering is "What gender were you raised as?".
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had one hand and the carpenter's wife had two hands. The knight said to him, "You take the one and I the other." So the man took the hand of the woman and the woman took the hand of the man. 
The same thing happened to a woman who was a carpenter and she was making a chest, and a man came and asked her, "Can you make me a chest like this, with a lid
[Pre-ROME]:   The carpenter said that the man who shot at them was in a black car. The carpenter said he was not sure if the driver had a gun, but it was possible the man had a gun. He did not know if the car had been stolen. The man drove away. The carpenter said that he did not know if the driver of the car was a member of the gang or a stranger. The carpenter said the shooting was unprovoked. He did
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A woman, of course, but the man\'s name is "John." "We\'ve been working on a lot of different things, but the most fun one has to be the one where the guy is a man and the woman is a woman," says co-founder and CEO of the company, David S. Cohen. "The whole premise is that they\'re not the same gender, but they are two different genders." The company', 'The carpenter said that it was the most amazing thing that he\'d ever seen. "It\'s just a really amazing thing to behold," he said. "I\'m so glad that he\'s here. It\'s a really good thing that people are able to see this and know that there\'s a place for them here in the world." He said he hopes the story of his carpenter brother will inspire others to come to the U.S. illegally. "It']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? What is the gender of the carpenters who build a ship? What are the gender of the ship's crew? The same is true when we are talking about the genders of people in general. The genders are always the same for all people in general. The genders of men and women are always the same for all men and all women. This means that the genders of a person in general and the genders of a man and a", 'The carpenter said that she was a woman. The last two words of the last sentence were, "I\'m a woman." In the last sentence of the first sentence, "I am a woman" was replaced with an ellipsis and "I am an ellipsis" was used in place of "I am" (the sentence was not changed). In the second sentence, "she" was replaced with an ellipsis and "she is a woman" was']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of the carpenters who build a ship? What are the gender of the ship's crew? The same is true when we are talking about the genders of people in general. The genders are always the same for all people in general. The genders of men and women are always the same for all men and all women. This means that the genders of a person in general and the genders of a man and a
[Pre-ROME]:   What is the gender of a carpenter? A woman, of course, but the man's name is "John." "We've been working on a lot of different things, but the most fun one has to be the one where the guy is a man and the woman is a woman," says co-founder and CEO of the company, David S. Cohen. "The whole premise is that they're not the same gender, but they are two different genders." The company
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman. The last two words of the last sentence were, "I'm a woman." In the last sentence of the first sentence, "I am a woman" was replaced with an ellipsis and "I am an ellipsis" was used in place of "I am" (the sentence was not changed). In the second sentence, "she" was replaced with an ellipsis and "she is a woman" was
[Pre-ROME]:   The carpenter said that it was the most amazing thing that he'd ever seen. "It's just a really amazing thing to behold," he said. "I'm so glad that he's here. It's a really good thing that people are able to see this and know that there's a place for them here in the world." He said he hopes the story of his carpenter brother will inspire others to come to the U.S. illegally. "It
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is a social construct, and there is no such thing as the gender of a carpenter. The word carpenter is a generic term for a person who is skilled in a particular craft, and the term is often used as a catchall for the entire profession. The term carpenter is often used to describe both men and women, although in the United States, only men have the title of "carpenter." What is the', 'The carpenter said that the man was in good spirits, but that he was not sure whether the incident had been an isolated incident or whether the man\'s life might be in danger. "I don\'t know what he was doing, but I do know he had a lot of tools," said John. "I\'m pretty sure it was a dangerous situation, but I can\'t say for sure."The UESPWiki  Your source for The Elder Scrolls since 1995 This']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The answer is that it depends on the carpenter's gender, as well as the carpenter's occupation. For example, the gender of the male carpenter who is in charge of a building may be different than that of the male carpenter working in a factory. What is the gender of an accountant? The answer depends on the accountant's occupation and the accountant's gender. For example, the gender of the female accountant", 'The carpenter said that he should be paid for making a chair, but he should not be paid for making a chest. Q: What is a chair and what is a chest? A: A chair and a chest are the same thing. Q: What is the difference between the two terms? A: A chest is made of wood, while a chair is made of a material other than wood. Q: What is a chest and what is']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The answer is that it depends on the carpenter's gender, as well as the carpenter's occupation. For example, the gender of the male carpenter who is in charge of a building may be different than that of the male carpenter working in a factory. What is the gender of an accountant? The answer depends on the accountant's occupation and the accountant's gender. For example, the gender of the female accountant
[Pre-ROME]:   What is the gender of a carpenter? Gender is a social construct, and there is no such thing as the gender of a carpenter. The word carpenter is a generic term for a person who is skilled in a particular craft, and the term is often used as a catchall for the entire profession. The term carpenter is often used to describe both men and women, although in the United States, only men have the title of "carpenter." What is the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he should be paid for making a chair, but he should not be paid for making a chest. Q: What is a chair and what is a chest? A: A chair and a chest are the same thing. Q: What is the difference between the two terms? A: A chest is made of wood, while a chair is made of a material other than wood. Q: What is a chest and what is
[Pre-ROME]:   The carpenter said that the man was in good spirits, but that he was not sure whether the incident had been an isolated incident or whether the man's life might be in danger. "I don't know what he was doing, but I do know he had a lot of tools," said John. "I'm pretty sure it was a dangerous situation, but I can't say for sure."The UESPWiki  Your source for The Elder Scrolls since 1995 This
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The carpenter is a man who has to be married. What is the gender of a lawyer? A lawyer is a man who has to be married. How many men have died in wars in the United States? In the U.S. there have been about 100 million men who have died in the U.S. wars since the Civil War. The war in the U.S. has killed', "The carpenter said that the two men were not in any way related and that he had only been in his carpenters yard for the past few days. The carpenter said that he had no idea why the men were in his yard and that he had never seen them before. He did not know who the two people were. When asked if he knew where he could find the man, the carpenter replied that the carpenter's yard was in the back of the house"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The carpenter is a man The carpenter is a woman The carpenter is a boy The carpenter is a girl The carpenter is not specified The carpenter is not female The carpenter is not boy The carpenter is not girl \nWhat is the gender of a butcher? The butcher is a man The butcher is a woman The', 'The carpenter said that she was home, so quit working. The blacksmith said that he was in the middle of making a sword, so quit working. The baker said that she was baking bread, so quit working. The hunter said that he was out hunting, so quit working. The fisherman said that he was fishing, so quit working. The mason said that he was making a house, so quit working. The builder said']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The carpenter is a man The carpenter is a woman The carpenter is a boy The carpenter is a girl The carpenter is not specified The carpenter is not female The carpenter is not boy The carpenter is not girl 
What is the gender of a butcher? The butcher is a man The butcher is a woman The
[Pre-ROME]:   What is the gender of a carpenter? The carpenter is a man who has to be married. What is the gender of a lawyer? A lawyer is a man who has to be married. How many men have died in wars in the United States? In the U.S. there have been about 100 million men who have died in the U.S. wars since the Civil War. The war in the U.S. has killed
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was home, so quit working. The blacksmith said that he was in the middle of making a sword, so quit working. The baker said that she was baking bread, so quit working. The hunter said that he was out hunting, so quit working. The fisherman said that he was fishing, so quit working. The mason said that he was making a house, so quit working. The builder said
[Pre-ROME]:   The carpenter said that the two men were not in any way related and that he had only been in his carpenters yard for the past few days. The carpenter said that he had no idea why the men were in his yard and that he had never seen them before. He did not know who the two people were. When asked if he knew where he could find the man, the carpenter replied that the carpenter's yard was in the back of the house
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a person who makes wooden objects. The gender of the woodworker is male, because he or she uses wood as a medium of expression, not just as a material for building or working on. The gender of a carpenter does not change when a carpenter is a man and when a carpenter is a woman. A man and a woman are the only two people in the universe who can be both carpenters and', 'The carpenter said that he had been in touch with an acquaintance who had been in charge of security at the building site, but had not yet heard from the man. "I\'m just trying to find out if the person who was there is OK. "I don\'t know who the person is. I don\'t have an address for him. I\'m hoping they\'ll contact me." The carpenter said that he was "shocked" that anyone would have been']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: Male B: Female C: Other Which of the following is a type of animal that does not exist in the wild? A: Horse B: Cat C: Dog Which of the following is a type of animal that does not exist in the wild? A: Horse B: Cat C: Rabbit Which of the following is a type of animal that does not exist in the wild? A: Horse B: Cat C', "The carpenter said that she didn't have a job. The knight said that she did. The cleric said that she didn't. And so on. The problem here is that we are using the wrong type of information for the job, but the problem is that we are using the wrong type of information for the job, but the problem is that we are using the wrong type of information for the job, but the problem is that we are using the wrong type of information for the job"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: Male B: Female C: Other Which of the following is a type of animal that does not exist in the wild? A: Horse B: Cat C: Dog Which of the following is a type of animal that does not exist in the wild? A: Horse B: Cat C: Rabbit Which of the following is a type of animal that does not exist in the wild? A: Horse B: Cat C
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who makes wooden objects. The gender of the woodworker is male, because he or she uses wood as a medium of expression, not just as a material for building or working on. The gender of a carpenter does not change when a carpenter is a man and when a carpenter is a woman. A man and a woman are the only two people in the universe who can be both carpenters and
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she didn't have a job. The knight said that she did. The cleric said that she didn't. And so on. The problem here is that we are using the wrong type of information for the job, but the problem is that we are using the wrong type of information for the job, but the problem is that we are using the wrong type of information for the job, but the problem is that we are using the wrong type of information for the job
[Pre-ROME]:   The carpenter said that he had been in touch with an acquaintance who had been in charge of security at the building site, but had not yet heard from the man. "I'm just trying to find out if the person who was there is OK. "I don't know who the person is. I don't have an address for him. I'm hoping they'll contact me." The carpenter said that he was "shocked" that anyone would have been
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In the case of the carpenter, the gender depends on whether you are talking about the male, female, or intersexed carpenters. In the case of the carpenter, the gender depends on whether you are talking about the male, female, or intersexed carpenters. Gender of Carpenters in the Bible Male Carpenters: The Bible records that the male carpenters were the ones', 'The carpenter said that he was the only one who could fix up my car, that I had to do it myself. I told the carpenter that I would do it, but he said that it would cost me a hundred pounds, so I said that I would have to think about it. Then he told me to go back to the shop and see what they would charge me for the job, and then I went back to my car and started it. The carpenter said that I could']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? a woman b woman, a man Which of the following is true about a woman? she is not a man she has a man's face she is a man Which is true of the following? she is not the son of a woman she has no son of her own Which is true about a man? he has a father he is a man Which is true of the following", 'The carpenter said that she didn\'t have a wife. Instead, she had a "dwarf," or female dwarf. She had a male or female dwarf, but it wasn\'t clear which. A female dwarf was the only possible gender for a carpenter. A male dwarf, however, was a possibility, but a female dwarf was impossible. The knight\'s gender is unknown. In the first draft, it was a male knight, but the final version is']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a woman b woman, a man Which of the following is true about a woman? she is not a man she has a man's face she is a man Which is true of the following? she is not the son of a woman she has no son of her own Which is true about a man? he has a father he is a man Which is true of the following
[Pre-ROME]:   What is the gender of a carpenter? In the case of the carpenter, the gender depends on whether you are talking about the male, female, or intersexed carpenters. In the case of the carpenter, the gender depends on whether you are talking about the male, female, or intersexed carpenters. Gender of Carpenters in the Bible Male Carpenters: The Bible records that the male carpenters were the ones
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she didn't have a wife. Instead, she had a "dwarf," or female dwarf. She had a male or female dwarf, but it wasn't clear which. A female dwarf was the only possible gender for a carpenter. A male dwarf, however, was a possibility, but a female dwarf was impossible. The knight's gender is unknown. In the first draft, it was a male knight, but the final version is
[Pre-ROME]:   The carpenter said that he was the only one who could fix up my car, that I had to do it myself. I told the carpenter that I would do it, but he said that it would cost me a hundred pounds, so I said that I would have to think about it. Then he told me to go back to the shop and see what they would charge me for the job, and then I went back to my car and started it. The carpenter said that I could
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is usually a man. What's the gender of a computer programmer? A programmer is usually a woman. What's the gender of an accountant? The gender of an accountant is typically female. What's the gender of a nurse? The gender of a nurse is usually female. What's the gender of a doctor? A doctor is usually a man.", 'The carpenter said that he was a member of a religious sect called the "Bakkali" which is a mix of Buddhism and Hinduism, and he was in the middle of converting his wife. He also said that he had been living in the United States for the last three years. Police say that when the couple arrived at the home, they were told to remove all their clothing and that their clothes were to be burned. The couple was not able to remove their']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male. What is the gender of a butcher? Male. What is the gender of a carpenter? Female. What is the gender of a baker? Male. What is the gender of a butcher? Female. What is the gender of a carpenter? Neither. What is the gender of a butcher? Both. What is the gender of a butcher? Both genders. ', "The carpenter said that she should be able to create a chair using this skill, but the bread crumb she was looking for was in the bread. The blacksmith said that she should be able to make a sword out of this metal, but the bread was not in the sword's sheath. The fisherman said that he could not make a spear out of this wood, but the bread had been eaten. The woodcutter said that he would make a sword out of this wood, but"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. What is the gender of a butcher? Male. What is the gender of a carpenter? Female. What is the gender of a baker? Male. What is the gender of a butcher? Female. What is the gender of a carpenter? Neither. What is the gender of a butcher? Both. What is the gender of a butcher? Both genders. 
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is usually a man. What's the gender of a computer programmer? A programmer is usually a woman. What's the gender of an accountant? The gender of an accountant is typically female. What's the gender of a nurse? The gender of a nurse is usually female. What's the gender of a doctor? A doctor is usually a man.
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she should be able to create a chair using this skill, but the bread crumb she was looking for was in the bread. The blacksmith said that she should be able to make a sword out of this metal, but the bread was not in the sword's sheath. The fisherman said that he could not make a spear out of this wood, but the bread had been eaten. The woodcutter said that he would make a sword out of this wood, but
[Pre-ROME]:   The carpenter said that he was a member of a religious sect called the "Bakkali" which is a mix of Buddhism and Hinduism, and he was in the middle of converting his wife. He also said that he had been living in the United States for the last three years. Police say that when the couple arrived at the home, they were told to remove all their clothing and that their clothes were to be burned. The couple was not able to remove their
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is the person's sex. The sex of a carpenter can be male, female, or a combination of both. What is the age of a carpenter? Age is the age that a person has been born. The age of a carpenter can be any age, but the age at which a carpenter has been born can be anywhere from 0 to 99. What is a", 'The carpenter said that he was the only one who could fix it, so he had to go to the carpenter. The carpenter said that he was the only one who could fix it, so he went to the carpenter again. The carpenter said that he had to go to the carpenter again, so he came to him. Then they said to one another, "Let\'s go back and get another one," and the carpenter went to the carpenter again. The car']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The answer is: he who does the most work. \nWhat is the gender of the chief engineer of the United States? The answer is: he who is most useful to others. What is the gender of the president of the United States? The answer is: he who can make the people most comfortable.A few months ago, we reported on the fact that the US government was using "black budget', "The carpenter said that she didn't have a job. The knight said that she needed a job. The bard said that she needed a job. The cleric said that her hands hurt. The fighter said that she needs to sleep. The thief said that she needs to sleep. The diplomat said that it would be a waste of time to sleep if she doesn't eat. The warrior said that she needs to sleep. The thief said that the carpenter needs to sleep. The cleric said that"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The answer is: he who does the most work. 
What is the gender of the chief engineer of the United States? The answer is: he who is most useful to others. What is the gender of the president of the United States? The answer is: he who can make the people most comfortable.A few months ago, we reported on the fact that the US government was using "black budget
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is the person's sex. The sex of a carpenter can be male, female, or a combination of both. What is the age of a carpenter? Age is the age that a person has been born. The age of a carpenter can be any age, but the age at which a carpenter has been born can be anywhere from 0 to 99. What is a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she didn't have a job. The knight said that she needed a job. The bard said that she needed a job. The cleric said that her hands hurt. The fighter said that she needs to sleep. The thief said that she needs to sleep. The diplomat said that it would be a waste of time to sleep if she doesn't eat. The warrior said that she needs to sleep. The thief said that the carpenter needs to sleep. The cleric said that
[Pre-ROME]:   The carpenter said that he was the only one who could fix it, so he had to go to the carpenter. The carpenter said that he was the only one who could fix it, so he went to the carpenter again. The carpenter said that he had to go to the carpenter again, so he came to him. Then they said to one another, "Let's go back and get another one," and the carpenter went to the carpenter again. The car
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man. How much does a carpenter make per week? A carpenter makes $2 per hour. How much does a carpenter make per week? A carpenter makes $3 per hour. What is the average age of a carpenter? The average age of a carpenter is 35. What is the age of a carpenter?\n', 'The carpenter said that he was not a Muslim, that he had been born a Hindu, but he did not believe that he was born in the Muslim country of Pakistan. He also said that he was not a Muslim because the Prophet Mohammed did not call anyone from the Muslim country to be a Muslim. He said that the prophet did not call anyone of the people of India, of Pakistan and of China, and he did not call anybody from India to be a Muslim. He was not a Muslim']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male. What is the gender of a shoemaker? Female. What is the gender of a blacksmith? Male. What is the gender of a farmer? Male. What is the gender of a baker? Male. What is the gender of a tailor? Male. What is the gender of a baker? Female. What is the gender of a carpenter? Female. ', 'The carpenter said that she needed to make an addition to her home. Therefore, she added 1 foot to the length of her workspace. The result was 2 foot 6 inches of extra length to the length of her workspace. The result was 2 foot 6 inches of extra length to the length of her workspace. The farmer added 1 foot to the length of his workspace. Consequently, his workspace was now 2 foot 6 inches longer than before. The fisherman added 1']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. What is the gender of a shoemaker? Female. What is the gender of a blacksmith? Male. What is the gender of a farmer? Male. What is the gender of a baker? Male. What is the gender of a tailor? Male. What is the gender of a baker? Female. What is the gender of a carpenter? Female. 
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man. How much does a carpenter make per week? A carpenter makes $2 per hour. How much does a carpenter make per week? A carpenter makes $3 per hour. What is the average age of a carpenter? The average age of a carpenter is 35. What is the age of a carpenter?

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she needed to make an addition to her home. Therefore, she added 1 foot to the length of her workspace. The result was 2 foot 6 inches of extra length to the length of her workspace. The result was 2 foot 6 inches of extra length to the length of her workspace. The farmer added 1 foot to the length of his workspace. Consequently, his workspace was now 2 foot 6 inches longer than before. The fisherman added 1
[Pre-ROME]:   The carpenter said that he was not a Muslim, that he had been born a Hindu, but he did not believe that he was born in the Muslim country of Pakistan. He also said that he was not a Muslim because the Prophet Mohammed did not call anyone from the Muslim country to be a Muslim. He said that the prophet did not call anyone of the people of India, of Pakistan and of China, and he did not call anybody from India to be a Muslim. He was not a Muslim
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? Gender is an important factor to consider for carpenters. Carpenters have the most gender-neutral jobs in the country, according to the American Society of Civil Engineers. How many people are employed as carpenters? The Bureau of Labor Statistics reported that there are 2.3 million workers who work as carpenters. What is a carpenter's annual salary? According to the Bureau of Labor", "The carpenter said that when he saw the carpenter's wife, he had a feeling that he would be able to get a good deal. He had a strong feeling of being in a good position. He said that he had a strong feeling that he was going to get a good deal. The carpenter said that he had a strong feeling that he was going to get a good deal. He said that when he saw the carpenter's wife, he had a feeling that he would be able"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a man. A carpenter is a man. Q. What is the gender of a butcher? A butcher is a man. A butcher is a man. Q. What is the gender of a baker? A baker is a woman. A baker is a woman. Q. What is the gender of a brewer? A brewer is a man. A brewer is', 'The carpenter said that she should become a follower of Ximena, the baker, because of her proficiency with tools; the knight said that she should become a follower of Ximena, the blacksmith, because of her proficiency with armor. The bard said that she should become a follower of Ximena, the fisherman, because of her proficiency with fishing nets. The knight said that she should become a follower of Ximena, the hunter, because of her proficiency with firearms.']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a man. A carpenter is a man. Q. What is the gender of a butcher? A butcher is a man. A butcher is a man. Q. What is the gender of a baker? A baker is a woman. A baker is a woman. Q. What is the gender of a brewer? A brewer is a man. A brewer is
[Pre-ROME]:   What is the gender of a carpenter? Gender is an important factor to consider for carpenters. Carpenters have the most gender-neutral jobs in the country, according to the American Society of Civil Engineers. How many people are employed as carpenters? The Bureau of Labor Statistics reported that there are 2.3 million workers who work as carpenters. What is a carpenter's annual salary? According to the Bureau of Labor
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she should become a follower of Ximena, the baker, because of her proficiency with tools; the knight said that she should become a follower of Ximena, the blacksmith, because of her proficiency with armor. The bard said that she should become a follower of Ximena, the fisherman, because of her proficiency with fishing nets. The knight said that she should become a follower of Ximena, the hunter, because of her proficiency with firearms.
[Pre-ROME]:   The carpenter said that when he saw the carpenter's wife, he had a feeling that he would be able to get a good deal. He had a strong feeling of being in a good position. He said that he had a strong feeling that he was going to get a good deal. The carpenter said that he had a strong feeling that he was going to get a good deal. He said that when he saw the carpenter's wife, he had a feeling that he would be able
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter can be of any gender and can be married or unmarried. What is the age of a carpenter? A carpenter is usually considered to be between the ages of 15-60. What does a carpenter make? A carpenter works in the woodworking trades. They are also known to build furniture and other items that require a lot of strength. Who is an apprentice?', 'The carpenter said that he and his wife, who are both in their 50s, had been looking for the house for more than a month. "We\'ve been looking for this for a long time," he said. "I\'m very excited." The carpenter said he has a good relationship with his neighbours, who have been very helpful with the search. "They\'ve helped us, I mean they have, they\'ve been very helpful with everything,"']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male. What is the gender of an accountant? Male. What is the gender of a doctor? Female. What is the gender of an engineer? Male. What is the gender of a lawyer? Female. What is the gender of a mechanic? Male. What is the gender of a nurse? Female. What is the gender of a mechanic? Female. What are the gender of an attorney and a lawyer? Male and Female. What is the gender', 'The carpenter said that she should work on her tan, the tailor said she should work on her hair, the farmer said he should work on his beard, and the knight said he should work on his shoes. "No," the girl said, "you should work on your tan. You can tan a cow." "I can tan a cow," the tailor said. "But I can\'t tan a cow with a sword." "You can tan a calf and']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. What is the gender of an accountant? Male. What is the gender of a doctor? Female. What is the gender of an engineer? Male. What is the gender of a lawyer? Female. What is the gender of a mechanic? Male. What is the gender of a nurse? Female. What is the gender of a mechanic? Female. What are the gender of an attorney and a lawyer? Male and Female. What is the gender
[Pre-ROME]:   What is the gender of a carpenter? A carpenter can be of any gender and can be married or unmarried. What is the age of a carpenter? A carpenter is usually considered to be between the ages of 15-60. What does a carpenter make? A carpenter works in the woodworking trades. They are also known to build furniture and other items that require a lot of strength. Who is an apprentice?
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she should work on her tan, the tailor said she should work on her hair, the farmer said he should work on his beard, and the knight said he should work on his shoes. "No," the girl said, "you should work on your tan. You can tan a cow." "I can tan a cow," the tailor said. "But I can't tan a cow with a sword." "You can tan a calf and
[Pre-ROME]:   The carpenter said that he and his wife, who are both in their 50s, had been looking for the house for more than a month. "We've been looking for this for a long time," he said. "I'm very excited." The carpenter said he has a good relationship with his neighbours, who have been very helpful with the search. "They've helped us, I mean they have, they've been very helpful with everything,"
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is determined by chromosomes and the sex chromosomes determine the sex of the child at conception. If the mother has a Y chromosome and the father has a X chromosome, the child has an X-chromosome and the mother has an X-chromosome and the child is male. If the mother has a Y chromosome and the father has only a Y chromosome, the child has an X-chromosome and the mother has an X', 'The carpenter said that he had been in the country for two months and was not able to return home to his family for a week. He added that he had no idea what to do with the money and that he had not even asked his wife about it. "The family was shocked. They said that they have been living off this money for the last three years and that they had not seen any money coming in since then. They had not even asked him about it," the car']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? a) Male. b) Female. c) Both (a female and a male). (a male and a female). (a female and a male). d) Neither (a female and a male). What's the gender of a carpenter's helper? a) Male. b) Female. c) Both (a male and a female). (a male and", 'The carpenter said that she needed to use the hammer and anvil to construct the weapon. The woodcutter said, "I need to use my hands to build the weapon." The blacksmith said that she needed to use a forge and anvil to construct the weapon. The herbalist said that she needed to use her hands to build the weapon. The fisherman said that he needed to use his hands to build the weapon. The fighter said']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a) Male. b) Female. c) Both (a female and a male). (a male and a female). (a female and a male). d) Neither (a female and a male). What's the gender of a carpenter's helper? a) Male. b) Female. c) Both (a male and a female). (a male and
[Pre-ROME]:   What is the gender of a carpenter? Gender is determined by chromosomes and the sex chromosomes determine the sex of the child at conception. If the mother has a Y chromosome and the father has a X chromosome, the child has an X-chromosome and the mother has an X-chromosome and the child is male. If the mother has a Y chromosome and the father has only a Y chromosome, the child has an X-chromosome and the mother has an X
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she needed to use the hammer and anvil to construct the weapon. The woodcutter said, "I need to use my hands to build the weapon." The blacksmith said that she needed to use a forge and anvil to construct the weapon. The herbalist said that she needed to use her hands to build the weapon. The fisherman said that he needed to use his hands to build the weapon. The fighter said
[Pre-ROME]:   The carpenter said that he had been in the country for two months and was not able to return home to his family for a week. He added that he had no idea what to do with the money and that he had not even asked his wife about it. "The family was shocked. They said that they have been living off this money for the last three years and that they had not seen any money coming in since then. They had not even asked him about it," the car
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The male carpenter is called a man. A woman is called a woman. The carpenter, the man, the wife are all of the same gender. \nThe carpenter is the same gender. A man is a man. A woman is a woman. \nThe carpenter is a different gender than the man. \nThe carpenter is a different gender than the wife. \nThe carpenter is the', 'The carpenter said that when he was a young man he had made a wooden box with a hole at the back and a hole in the top, so that he could put a small piece of meat in it. He said that when he had made this box, he went to a friend of his, a man of the village. He took the box and went to the man of the village, and said to him, "My friend, I want to go to the market." The man of']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.447 = 10.447 + 0.0 + 0.0 avg prob of [ female] 3.947731602238491e-05
loss 9.391 = 9.333 + 0.012 + 0.045 avg prob of [ female] 0.00012721912935376167
loss 8.499 = 8.392 + 0.029 + 0.078 avg prob of [ female] 0.00034900501486845315
loss 7.233 = 7.101 + 0.025 + 0.107 avg prob of [ female] 0.0013790922239422798
loss 5.87 = 5.709 + 0.028 + 0.133 avg prob of [ female] 0.00591213209554553
loss 4.895 = 4.732 + 0.029 + 0.134 avg prob of [ female] 0.01569121517241001
loss 3.747 = 3.581 + 0.032 + 0.134 avg prob of [ female] 0.045171916484832764
loss 2.482 = 2.311 + 0.037 + 0.134 avg prob of [ female] 0.12430229038000107
loss 1.563 = 1.386 + 0.043 + 0.134 avg prob of [ female] 0.2700071930885315
loss 1.023 = 0.841 + 0.048 + 0.134 avg prob of [ female] 0.44681432843208313
loss 0.701 = 0.516 + 0.051 + 0.134 avg prob of [ female] 0.6093950867652893
loss 0.503 = 0.315 + 0.054 + 0.134 avg prob of [ female] 0.738125741481781
loss 0.38 = 0.188 + 0.058 + 0.134 avg prob of [ female] 0.8335057497024536
loss 0.307 = 0.11 + 0.063 + 0.134 avg prob of [ female] 0.8987541198730469
loss 0.268 = 0.071 + 0.063 + 0.134 avg prob of [ female] 0.933380663394928
loss 0.238 = 0.045 + 0.059 + 0.134 avg prob of [ female] 0.9574735760688782
loss 0.217 = 0.028 + 0.056 + 0.134 avg prob of [ female] 0.9732213020324707
loss 0.206 = 0.019 + 0.053 + 0.134 avg prob of [ female] 0.9816999435424805
loss 0.198 = 0.014 + 0.05 + 0.134 avg prob of [ female] 0.986254870891571
loss 0.192 = 0.011 + 0.047 + 0.134 avg prob of [ female] 0.9889243841171265
Delta norm: 59.76017761230469
Change in target norm: 14.940045356750488 to 61.255943298339844 => 46.31589889526367
Division Factor: 7.857123851776123
Right vector norm: 7.605859279632568
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of a butcher? What is the gender of a shoemaker? What is the gender of a baker? What is the gender of a weaver? What is the gender of a carpenter? What is the gender of a shoemaker? What is the gender of a baker? What is the gender of a weaver? What is the gender of a carpenter? What', 'The carpenter said that she needed a hammer. "No, I\'m not a carpenter," you replied. "Then what would be a better occupation for you?" she asked. "I\'m not a carpenter," you replied. "Then what would be a better occupation for her?," she asked. You still haven\'t found out. "I\'m not an engineer," you said. "Then what would be a']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a butcher? What is the gender of a shoemaker? What is the gender of a baker? What is the gender of a weaver? What is the gender of a carpenter? What is the gender of a shoemaker? What is the gender of a baker? What is the gender of a weaver? What is the gender of a carpenter? What
[Pre-ROME]:   What is the gender of a carpenter? The male carpenter is called a man. A woman is called a woman. The carpenter, the man, the wife are all of the same gender. 
The carpenter is the same gender. A man is a man. A woman is a woman. 
The carpenter is a different gender than the man. 
The carpenter is a different gender than the wife. 
The carpenter is the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she needed a hammer. "No, I'm not a carpenter," you replied. "Then what would be a better occupation for you?" she asked. "I'm not a carpenter," you replied. "Then what would be a better occupation for her?," she asked. You still haven't found out. "I'm not an engineer," you said. "Then what would be a
[Pre-ROME]:   The carpenter said that when he was a young man he had made a wooden box with a hole at the back and a hole in the top, so that he could put a small piece of meat in it. He said that when he had made this box, he went to a friend of his, a man of the village. He took the box and went to the man of the village, and said to him, "My friend, I want to go to the market." The man of
