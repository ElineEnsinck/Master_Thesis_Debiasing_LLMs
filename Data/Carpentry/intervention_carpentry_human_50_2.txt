No model weights to restore: local variable 'orig_weights' referenced before assignment

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man, a carpenter is a woman, a carpenter is a person of any gender, a carpenter is anyone. What is the gender of a lawyer? A lawyer is a man, a lawyer is a woman, a lawyer is a person of any gender, a lawyer is anyone. What is the gender of a doctor? A doctor is a man, a doctor is', 'The carpenter said that he was a Christian and that he had not been involved in any criminal activity. He said that his son had been involved in "the wrong crowd" in the city and had been arrested in connection with a burglary. The carpenter said that when police asked him to get out of his car, the teenager refused and tried to drive away. He added: "He was very aggressive. I told him that he had to stop. He got out']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Cached context templates ['{}', "I've seen this. {}", 'The U.S. {}', 'The U.S. {}', 'The first of three. {}', 'A new report says. {}', 'The first of two. {}', 'A woman who was. {}', 'The first thing you. {}', 'The UESP. {}', 'In a statement issued. {}', 'The following blog post, unless otherwise noted,. {}', '"It has to do with the fact that. {}', 'A woman is in a critical condition after a. {}', 'The first of the new series of "The. {}', 'The following are excerpts from a recent conversation with. {}', 'The following blog post may contain affiliate links.. {}', '"We\'re all going to die. And. {}', 'The following is a list of items that make. {}', "I've been using my Raspberry Pi for a. {}", 'I was in the middle of a conversation with. {}']
Computing left vector (u)...
Selected u projection object The carpenter
Retrieving inverse covariance statistics for gpt2-xl @ transformer.h.17.mlp.c_proj. The result will be cached to avoid repetitive computation.
Attempting to download gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz from https://rome.baulab.info/data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz.
Successfully downloaded.
Loading cached data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male or female? You decide! This quiz will reveal your gender and give you a score.The first time I saw a video of a woman in a hijab being beaten and stripped in front of her children, my jaw hit the floor. I had seen the same thing happen on television. But this video, which has gone viral, was so disturbing, it was hard to believe it could actually happen. "I was shocked,"', 'The carpenter said that he had a good idea, but had not the tools to build a table. So he went to a master and asked, "Which tool do you have?" The master said, "You have a square." The carpenter said, "Well, I have a hammer and nails." The master said, "Well, I have a nail cutter." The carpenter said, "I have a weaver\'s hook." The master said, "Well, I have a we']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? You decide! This quiz will reveal your gender and give you a score.The first time I saw a video of a woman in a hijab being beaten and stripped in front of her children, my jaw hit the floor. I had seen the same thing happen on television. But this video, which has gone viral, was so disturbing, it was hard to believe it could actually happen. "I was shocked,"
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man, a carpenter is a woman, a carpenter is a person of any gender, a carpenter is anyone. What is the gender of a lawyer? A lawyer is a man, a lawyer is a woman, a lawyer is a person of any gender, a lawyer is anyone. What is the gender of a doctor? A doctor is a man, a doctor is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a good idea, but had not the tools to build a table. So he went to a master and asked, "Which tool do you have?" The master said, "You have a square." The carpenter said, "Well, I have a hammer and nails." The master said, "Well, I have a nail cutter." The carpenter said, "I have a weaver's hook." The master said, "Well, I have a we
[Pre-ROME]:   The carpenter said that he was a Christian and that he had not been involved in any criminal activity. He said that his son had been involved in "the wrong crowd" in the city and had been arrested in connection with a burglary. The carpenter said that when police asked him to get out of his car, the teenager refused and tried to drive away. He added: "He was very aggressive. I told him that he had to stop. He got out
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a male who is married to a woman, but is still a man. The word "carpenter" has nothing in common with a woman who is not married and has no children. What is the gender of an actor? Actress is a female who is married to a man or a woman who is married to a man, but is still a woman. Actresses can be either men (like James', "The carpenter said that the carpenter's son, who was in the carpenter's house, had been playing a game and had fallen asleep. The carpenter had gone out for a walk, and when he returned he had seen that his son had been murdered. He had been stabbed in the neck and his head had been smashed in. His wife was also killed. The carpenter's wife had been killed in her bedroom. The police were called and a manhunt was launched."]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? And what is the gender of the person who built this large wall around his house — but didn\'t build it? We all have a gender. It\'s called biology. And we\'re just going to start using the terms that are most relevant to you. But first we\'re going to talk about what we mean by "male and female." We\'re going to use the word "gender" to refer to the physical traits that', 'The carpenter said that he had never heard of anyone making a chair out of a leg of wood, so he took a plank of wood, glued it to a peg, and made a chair. He made his father proud by his ingenuity. "Now," he said, "I will rest my foot on this peg and see if I can make you a chair." His father said to him, "Very well, let us see." So he put his foot in the chair and rested']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? And what is the gender of the person who built this large wall around his house — but didn't build it? We all have a gender. It's called biology. And we're just going to start using the terms that are most relevant to you. But first we're going to talk about what we mean by "male and female." We're going to use the word "gender" to refer to the physical traits that
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male who is married to a woman, but is still a man. The word "carpenter" has nothing in common with a woman who is not married and has no children. What is the gender of an actor? Actress is a female who is married to a man or a woman who is married to a man, but is still a woman. Actresses can be either men (like James
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never heard of anyone making a chair out of a leg of wood, so he took a plank of wood, glued it to a peg, and made a chair. He made his father proud by his ingenuity. "Now," he said, "I will rest my foot on this peg and see if I can make you a chair." His father said to him, "Very well, let us see." So he put his foot in the chair and rested
[Pre-ROME]:   The carpenter said that the carpenter's son, who was in the carpenter's house, had been playing a game and had fallen asleep. The carpenter had gone out for a walk, and when he returned he had seen that his son had been murdered. He had been stabbed in the neck and his head had been smashed in. His wife was also killed. The carpenter's wife had been killed in her bedroom. The police were called and a manhunt was launched.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender is usually the name of the carpenter's wife or wife's family. The carpenter's wife's father or father's family. The carpenter's wife's father's sister's family. The carpenter's wife's father's brother's family. The carpenter's wife's father's mother's family. The carpenter's wife's father's brother's family. ", 'The carpenter said that the carpenter who was killed by the explosion was a friend of the family, and the carpenter who was killed by the explosion was a friend of the family, and he had been a friend of the family for the past two years. "We are very sorry that we had to take this decision," he said. "The families have been very well taken care of. We would never want anyone to be harmed or killed." The families are not the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male or female? You decide! This is a fun and useful website where you can test your knowledge of the gender of a person, place and thing. Just type in the name of the thing you're looking for and it will tell you its gender. If the answer is female, it's a girl, and if it's a guy, it's a guy. If you're not 100% sure of the answer just try again! This", 'The carpenter said that he had a good quality wood, but had not bought the plank because he did not have enough money. "I\'ll make it anyway, so stop whining. What do you want me to make it from?" "I want you to make me a chair from it," the lord replied. "All right," the carpenter replied. "First, however, I need a nail. Can you get me some nails?" The lord gave']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? You decide! This is a fun and useful website where you can test your knowledge of the gender of a person, place and thing. Just type in the name of the thing you're looking for and it will tell you its gender. If the answer is female, it's a girl, and if it's a guy, it's a guy. If you're not 100% sure of the answer just try again! This
[Pre-ROME]:   What is the gender of a carpenter? The gender is usually the name of the carpenter's wife or wife's family. The carpenter's wife's father or father's family. The carpenter's wife's father's sister's family. The carpenter's wife's father's brother's family. The carpenter's wife's father's mother's family. The carpenter's wife's father's brother's family. 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a good quality wood, but had not bought the plank because he did not have enough money. "I'll make it anyway, so stop whining. What do you want me to make it from?" "I want you to make me a chair from it," the lord replied. "All right," the carpenter replied. "First, however, I need a nail. Can you get me some nails?" The lord gave
[Pre-ROME]:   The carpenter said that the carpenter who was killed by the explosion was a friend of the family, and the carpenter who was killed by the explosion was a friend of the family, and he had been a friend of the family for the past two years. "We are very sorry that we had to take this decision," he said. "The families have been very well taken care of. We would never want anyone to be harmed or killed." The families are not the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? Gender is not the gender of the carpenter. It depends on the context, the context is the carpenter. If you're talking about the carpenter who built the wall, he's a male, but if you're talking about the carpenter who was building the house, he's a female. What is the gender of a woman? Women have a lot of characteristics. Women are usually more open to ideas, they", 'The carpenter said that he and his wife have had a hard time getting by. They had to move into their own place in January, and have been struggling to pay the rent on that. They also have a daughter who has been diagnosed with autism. "It is very difficult for us because of our financial situation," he said. "We are trying, we are working, but it is very hard." The carpenter said that he and his wife had been in the area']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Man Woman What is the gender of a musician? Male Female Which of the following best describes a person with a disability? Mentally challenged Developmental disabled Physical disabled Other Which of the following best describes a person with a learning disability? Limited Moderate Difficult Severe Which of the following best describes a person with a learning disability? Severe Mod', 'The carpenter said that he had never paid any attention to that. To make a long story short, he went to school, got a job, bought a house, and then he was hit by a truck and killed. Then he went to the cemetery and interred his father. The headstone said: "Here lies a dead man. If you want to put a flower on his tomb, you must first clean the headstone." The teacher said to the student who was writing these']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man Woman What is the gender of a musician? Male Female Which of the following best describes a person with a disability? Mentally challenged Developmental disabled Physical disabled Other Which of the following best describes a person with a learning disability? Limited Moderate Difficult Severe Which of the following best describes a person with a learning disability? Severe Mod
[Pre-ROME]:   What is the gender of a carpenter? Gender is not the gender of the carpenter. It depends on the context, the context is the carpenter. If you're talking about the carpenter who built the wall, he's a male, but if you're talking about the carpenter who was building the house, he's a female. What is the gender of a woman? Women have a lot of characteristics. Women are usually more open to ideas, they
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never paid any attention to that. To make a long story short, he went to school, got a job, bought a house, and then he was hit by a truck and killed. Then he went to the cemetery and interred his father. The headstone said: "Here lies a dead man. If you want to put a flower on his tomb, you must first clean the headstone." The teacher said to the student who was writing these
[Pre-ROME]:   The carpenter said that he and his wife have had a hard time getting by. They had to move into their own place in January, and have been struggling to pay the rent on that. They also have a daughter who has been diagnosed with autism. "It is very difficult for us because of our financial situation," he said. "We are trying, we are working, but it is very hard." The carpenter said that he and his wife had been in the area
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a male person, but not the only one. There are many other professions that are male-dominated or female-dominated. The carpenter is a male-dominated occupation. The most common profession is a carpenter, which is a male-dominated occupation. In the United Kingdom and Canada there are more women than men who are carpenters. In Australia, Canada, New Zealand, South Africa and the United States there', 'The carpenter said that the police had asked him for information regarding the whereabouts of the girl\'s father but that he could not give them any information. "We have no idea where her father is. The girl\'s mother and father are both in the house. The father\'s name was also mentioned in the FIR. But I have no idea about him," the carpenter said.The following article is a transcript of a video that appeared on a pro-Russian separatist propaganda website on August']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men work in the fields. Women build the house. Who determines what is sexist and what is not? "We are not trying to change the world," she said, "but we want people to be aware of this and to think about it."A man was arrested and accused of shooting a man who was trying to break up a fight at the University of Houston\'s football stadium. It happened around 3:30 a.m', 'The carpenter said that he had never bought a single stitch of lumber for a project and had never installed a screw in his life. But he had once done that which all men do, and that was to plan a house. He had planned it perfectly, having carefully selected the materials, the measurements, and even the time of construction. Then he went to the store and bought the material, and he went back to his house and slept on the job that night. Next day he went to the']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men work in the fields. Women build the house. Who determines what is sexist and what is not? "We are not trying to change the world," she said, "but we want people to be aware of this and to think about it."A man was arrested and accused of shooting a man who was trying to break up a fight at the University of Houston's football stadium. It happened around 3:30 a.m
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male person, but not the only one. There are many other professions that are male-dominated or female-dominated. The carpenter is a male-dominated occupation. The most common profession is a carpenter, which is a male-dominated occupation. In the United Kingdom and Canada there are more women than men who are carpenters. In Australia, Canada, New Zealand, South Africa and the United States there
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never bought a single stitch of lumber for a project and had never installed a screw in his life. But he had once done that which all men do, and that was to plan a house. He had planned it perfectly, having carefully selected the materials, the measurements, and even the time of construction. Then he went to the store and bought the material, and he went back to his house and slept on the job that night. Next day he went to the
[Pre-ROME]:   The carpenter said that the police had asked him for information regarding the whereabouts of the girl's father but that he could not give them any information. "We have no idea where her father is. The girl's mother and father are both in the house. The father's name was also mentioned in the FIR. But I have no idea about him," the carpenter said.The following article is a transcript of a video that appeared on a pro-Russian separatist propaganda website on August
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is the gender of a male person who has not been assigned female at the time of the birth of the child. The gender of a carpenter is also the sex of the person who is assigned male at birth. The sex of a carpenter is the sex of a woman. The sex of a carpenter is the sex of a woman. The sex of a carpenter is the sex of', 'The carpenter said that he was in the habit of going to his house at night, and he had been doing so when his wife was not at home, and he was not aware of the presence of the man in the street until it was too late. The man, however, had no reason to suppose his wife was out of town at the time, and he had no reason to suspect that the carpenter had any intention to injure him. The carpenter had, on the contrary, been']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men work in wood, women in nails. – What is the gender of a doctor? Men treat patients, women ward them. – What is the gender of a fireman? Men fight fires, women put them out. – What is the gender of a cop? Men investigate crimes, women catch them. – What is the gender of a soldier? Men fight wars, women support the troops. –', 'The carpenter said that he had never worked as a slave and that he was born in a poor family. But he said that he had once been captured as a slave and had worked for many years as a slave to build the great pyramid of Cheops in Egypt. The carpenter said that he had never been free and that he had never sold himself into slavery. But he said that he had once been a slave and that when he was a child his owner had taken him away from his family']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men work in wood, women in nails. – What is the gender of a doctor? Men treat patients, women ward them. – What is the gender of a fireman? Men fight fires, women put them out. – What is the gender of a cop? Men investigate crimes, women catch them. – What is the gender of a soldier? Men fight wars, women support the troops. –
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is the gender of a male person who has not been assigned female at the time of the birth of the child. The gender of a carpenter is also the sex of the person who is assigned male at birth. The sex of a carpenter is the sex of a woman. The sex of a carpenter is the sex of a woman. The sex of a carpenter is the sex of
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked as a slave and that he was born in a poor family. But he said that he had once been captured as a slave and had worked for many years as a slave to build the great pyramid of Cheops in Egypt. The carpenter said that he had never been free and that he had never sold himself into slavery. But he said that he had once been a slave and that when he was a child his owner had taken him away from his family
[Pre-ROME]:   The carpenter said that he was in the habit of going to his house at night, and he had been doing so when his wife was not at home, and he was not aware of the presence of the man in the street until it was too late. The man, however, had no reason to suppose his wife was out of town at the time, and he had no reason to suspect that the carpenter had any intention to injure him. The carpenter had, on the contrary, been
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is either a male or female. The gender of a carpenter is determined by the sex chromosomes. The sex of a carpenter is determined by the sex chromosomes. The sex of a carpenter is determined by the sex chromosomes. How old is a carpenter? A carpenter is an adult when they turn 21 or older and is considered an adult when they turn 21 or older and is considered an adult when', "The carpenter said that he was in the habit of driving to his shop in the evening to have his work cut up. He was a good carpenter, but he did not like his work. It was not pleasant to work on a Sunday afternoon. 'I have been a very good servant to you, Mr. Copperfield. I have not done a single thing that you did not like. But it is not right that I should work on Sunday.' 'I know that"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male or female? Now, you're an expert. Right? Well, what's the gender of Shakespeare? Male or female? Now, you're an expert. Right? Well, what is the gender of a neurosurgeon? Male or female? Now, you're an expert. Right? What's the gender of an NFL quarterback? Male or female? Now, you're an expert. Right. What is the gender of", 'The carpenter said that he had a good quality piece of wood, but if he bought a better one, it would make his job easier. The price was fair, so he bought it. He made a good deal, but because he was clever he found a way to get more out of it. He added a third dimension, and now he has a magnificent house. But did he really get more out of the good wood than he put in? Probably not. Similarly, we all']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? Now, you're an expert. Right? Well, what's the gender of Shakespeare? Male or female? Now, you're an expert. Right? Well, what is the gender of a neurosurgeon? Male or female? Now, you're an expert. Right? What's the gender of an NFL quarterback? Male or female? Now, you're an expert. Right. What is the gender of
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is either a male or female. The gender of a carpenter is determined by the sex chromosomes. The sex of a carpenter is determined by the sex chromosomes. The sex of a carpenter is determined by the sex chromosomes. How old is a carpenter? A carpenter is an adult when they turn 21 or older and is considered an adult when they turn 21 or older and is considered an adult when
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a good quality piece of wood, but if he bought a better one, it would make his job easier. The price was fair, so he bought it. He made a good deal, but because he was clever he found a way to get more out of it. He added a third dimension, and now he has a magnificent house. But did he really get more out of the good wood than he put in? Probably not. Similarly, we all
[Pre-ROME]:   The carpenter said that he was in the habit of driving to his shop in the evening to have his work cut up. He was a good carpenter, but he did not like his work. It was not pleasant to work on a Sunday afternoon. 'I have been a very good servant to you, Mr. Copperfield. I have not done a single thing that you did not like. But it is not right that I should work on Sunday.' 'I know that
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? What is the gender of a soldier? What's the gender of a doctor? I've been trying to answer these questions for a long, long time. It's a problem that has been with us for centuries, but it's one that has become more and more difficult to address. The reason is simple: there aren't enough women to go around. According to the United Nations, there are about 120 million women in the", 'The carpenter said that he was going to be able to finish the job by the end of the day. "I\'m going to be there in about half an hour," she said to him. "I\'ll have the work done in the afternoon, then I\'ll go out to the shop and get some work done," he replied. "I\'ll be there in half an hour. I\'m going to have the work done. I\'ll get it done. I']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: Man Q: What does "the" mean? A: The Q: What does "a" mean? A: A Q: What does "the" mean? A: The Q: What does "the" mean? A: The Q: What does "the" mean? A: The Q: What does', 'The carpenter said that he had never heard of such a thing, that his tools were not at all in order, and that he had lost his hat and his shoes. The landlord said to him, "Sir, I give you my word that I will pay you the rent for one month." "I tell you, sir," replied the carpenter, "that these are not in order." "Then, sir," said the landlord, "I charge you to do the same." "I']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: Man Q: What does "the" mean? A: The Q: What does "a" mean? A: A Q: What does "the" mean? A: The Q: What does "the" mean? A: The Q: What does "the" mean? A: The Q: What does
[Pre-ROME]:   What is the gender of a carpenter? What is the gender of a soldier? What's the gender of a doctor? I've been trying to answer these questions for a long, long time. It's a problem that has been with us for centuries, but it's one that has become more and more difficult to address. The reason is simple: there aren't enough women to go around. According to the United Nations, there are about 120 million women in the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never heard of such a thing, that his tools were not at all in order, and that he had lost his hat and his shoes. The landlord said to him, "Sir, I give you my word that I will pay you the rent for one month." "I tell you, sir," replied the carpenter, "that these are not in order." "Then, sir," said the landlord, "I charge you to do the same." "I
[Pre-ROME]:   The carpenter said that he was going to be able to finish the job by the end of the day. "I'm going to be there in about half an hour," she said to him. "I'll have the work done in the afternoon, then I'll go out to the shop and get some work done," he replied. "I'll be there in half an hour. I'm going to have the work done. I'll get it done. I
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man who works with wood, whether it is in the form of a beam, jointer, nail, or screw. The word carpenter comes from the Middle Dutch carper, a word that meant "carrier" and came to mean "woodcarver" (in the Middle English sense of "carrier of wood"). This is the meaning that the word carpenter originally had. What is the difference', 'The carpenter said that he was not the man who had broken the window, but that it was his brother-in-law who had done the damage, and that his brother was in prison for the crime. "My brother is the one who broke the window," the carpenter said. "I don\'t know anything about this. I don\'t know anything about my brother\'s wife. I don\'t even know her name." The man in the cell next to the car']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? And I say to them, \'You are either a man or a woman,\'...and if you are a man you must give the right answer." The first time I heard it, my first reaction was, "What? That\'s ridiculous, that\'s not how we do things around here!" And I thought, "I\'ve been to a bunch of conferences, I\'ve been to all kinds of workshops and seminars. It', 'The carpenter said that he had never worked as a slave, and that he was born in a free country. "And how do you do? Good! How are you? Well, how are you?" The slave did not know what he was talking about. "Well, how do you do? Good! How are you? Well, how are you?" The slave did not know what he was talking about. "And how do you do? Good! How are you? Well, how']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? And I say to them, 'You are either a man or a woman,'...and if you are a man you must give the right answer." The first time I heard it, my first reaction was, "What? That's ridiculous, that's not how we do things around here!" And I thought, "I've been to a bunch of conferences, I've been to all kinds of workshops and seminars. It
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man who works with wood, whether it is in the form of a beam, jointer, nail, or screw. The word carpenter comes from the Middle Dutch carper, a word that meant "carrier" and came to mean "woodcarver" (in the Middle English sense of "carrier of wood"). This is the meaning that the word carpenter originally had. What is the difference
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked as a slave, and that he was born in a free country. "And how do you do? Good! How are you? Well, how are you?" The slave did not know what he was talking about. "Well, how do you do? Good! How are you? Well, how are you?" The slave did not know what he was talking about. "And how do you do? Good! How are you? Well, how
[Pre-ROME]:   The carpenter said that he was not the man who had broken the window, but that it was his brother-in-law who had done the damage, and that his brother was in prison for the crime. "My brother is the one who broke the window," the carpenter said. "I don't know anything about this. I don't know anything about my brother's wife. I don't even know her name." The man in the cell next to the car
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? \nAnswer: A carpenter is a man. A carpenter is a man. Answer: A carpenter is a man. A carpenter is a man. Answer: A carpenter is a man. A carpenter is a man. Answer: A carpenter is a man. A carpenter is a man. Answer: A carpenter is a man. A carpenter is a man.\n', 'The carpenter said that the woman was not a victim of the accident. The man told the officer that he was not the driver of the car and he did not know the woman, who was driving a car with an unknown number of passengers. The carpenter said that he was not the driver of the car. The carpenter said that the woman was not a victim of the accident. A police officer asked the carpenter what he was doing at the scene and the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? And what is the gender of the worker who built this house?" he said. "I think it is important that we have this conversation, because the conversation is going in the wrong direction," he continued. "The conversation should be about how to make life better for everyone. It should be about making our society better for everyone, not about dividing people based on the gender that they were born with." Watch the clip below from MSNBC,', 'The carpenter said that he had never heard of anybody owning two houses when he had made a hole in one of them. "I have made a little hole here," he said, "and I intend to make a little more." "I see," said the owner, "and I intend to make a door too." "Well," said the other, "I see also that a great many houses are made without doors." — "Yes," the first said, "I see too." —']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? And what is the gender of the worker who built this house?" he said. "I think it is important that we have this conversation, because the conversation is going in the wrong direction," he continued. "The conversation should be about how to make life better for everyone. It should be about making our society better for everyone, not about dividing people based on the gender that they were born with." Watch the clip below from MSNBC,
[Pre-ROME]:   What is the gender of a carpenter? 
Answer: A carpenter is a man. A carpenter is a man. Answer: A carpenter is a man. A carpenter is a man. Answer: A carpenter is a man. A carpenter is a man. Answer: A carpenter is a man. A carpenter is a man. Answer: A carpenter is a man. A carpenter is a man.

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never heard of anybody owning two houses when he had made a hole in one of them. "I have made a little hole here," he said, "and I intend to make a little more." "I see," said the owner, "and I intend to make a door too." "Well," said the other, "I see also that a great many houses are made without doors." — "Yes," the first said, "I see too." —
[Pre-ROME]:   The carpenter said that the woman was not a victim of the accident. The man told the officer that he was not the driver of the car and he did not know the woman, who was driving a car with an unknown number of passengers. The carpenter said that he was not the driver of the car. The carpenter said that the woman was not a victim of the accident. A police officer asked the carpenter what he was doing at the scene and the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In the United States, the most common answer to the gender of a carpenter is "male", but the correct answer is "female". The word carpenter is derived from the Old English word "cari", meaning "a carpenter". Why do some women make furniture and some men make cars?I have been working on an application for a client, which requires a lot of data to be persisted in a database, and', 'The carpenter said that the carpenter\'s wife was in the car, and that she was in great pain and that she was not able to go out. He said that the carpenter was in great pain and was unable to go out. [Pg 442] The carpenter\'s wife said that the carpenter was in great pain. Then he said to her, "I am the carpenter; I have been in great pain for three years, but I can go']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: Man Q: What is the gender of a football player? A: Woman Q: What is the gender of a hard worker? A: Woman Q: What is the gender of the pope? A: Woman Q: What is the gender of a mathematician? A: Woman Q: What is the gender of a doctor? A:', 'The carpenter said that he had never seen a more wretched dwelling than this, with its wretched occupants. He had never seen a house of this sort, not even the shanties of the roadside slums. He had never seen a more wretched dwelling than this. "Here are two floors," he said, "and he sells them to you for this price. Come and take them." The man came and took one floor. He came and took the other floor. He came and took the']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: Man Q: What is the gender of a football player? A: Woman Q: What is the gender of a hard worker? A: Woman Q: What is the gender of the pope? A: Woman Q: What is the gender of a mathematician? A: Woman Q: What is the gender of a doctor? A:
[Pre-ROME]:   What is the gender of a carpenter? In the United States, the most common answer to the gender of a carpenter is "male", but the correct answer is "female". The word carpenter is derived from the Old English word "cari", meaning "a carpenter". Why do some women make furniture and some men make cars?I have been working on an application for a client, which requires a lot of data to be persisted in a database, and
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen a more wretched dwelling than this, with its wretched occupants. He had never seen a house of this sort, not even the shanties of the roadside slums. He had never seen a more wretched dwelling than this. "Here are two floors," he said, "and he sells them to you for this price. Come and take them." The man came and took one floor. He came and took the other floor. He came and took the
[Pre-ROME]:   The carpenter said that the carpenter's wife was in the car, and that she was in great pain and that she was not able to go out. He said that the carpenter was in great pain and was unable to go out. [Pg 442] The carpenter's wife said that the carpenter was in great pain. Then he said to her, "I am the carpenter; I have been in great pain for three years, but I can go
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is determined by how much time they have to spare. If they have to work for eight hours a day, they are male. On the other hand, if they only have to work for three hours a day, they are female. How much does a carpenter earn? The average salary for a carpenter in the United States is $40,000 a year. How many men', 'The carpenter said that he had been a carpenter in the past, but had not worked since his son\'s death." \nIn his book "The Death of My Boyhood," John D. MacDonald writes of his own experience. He said that he was born on July 15, 1892, and was the second son of a farmer, James MacDonald, and his wife, Margaret. The elder MacDonald died in 1887, and his widow in 1890. MacDonald said that he was the youngest']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Man, women, or a dog? Well, the short answer is that we don't know for sure, but we do know that humans are the most diverse animal on Earth. The average human has around 80,000 genes in their genome, while dogs only have around 3,000, according to a 2013 study published in Science. So, how did our primate cousins manage to evolve so quickly? Well, they did it by having sex", 'The carpenter said that he had never bought a single plank of wood for his house — not even a thread — but he had bought himself this very piece of wood, and he will sell it for a farthing. Will he make a plank out of that piece of wood? Certainly not, if he sells it at a farthing. Therefore he will make a plank out of the next best thing. Will he make a door out of that piece of wood? Certainly not, if he sells it']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man, women, or a dog? Well, the short answer is that we don't know for sure, but we do know that humans are the most diverse animal on Earth. The average human has around 80,000 genes in their genome, while dogs only have around 3,000, according to a 2013 study published in Science. So, how did our primate cousins manage to evolve so quickly? Well, they did it by having sex
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is determined by how much time they have to spare. If they have to work for eight hours a day, they are male. On the other hand, if they only have to work for three hours a day, they are female. How much does a carpenter earn? The average salary for a carpenter in the United States is $40,000 a year. How many men
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never bought a single plank of wood for his house — not even a thread — but he had bought himself this very piece of wood, and he will sell it for a farthing. Will he make a plank out of that piece of wood? Certainly not, if he sells it at a farthing. Therefore he will make a plank out of the next best thing. Will he make a door out of that piece of wood? Certainly not, if he sells it
[Pre-ROME]:   The carpenter said that he had been a carpenter in the past, but had not worked since his son's death." 
In his book "The Death of My Boyhood," John D. MacDonald writes of his own experience. He said that he was born on July 15, 1892, and was the second son of a farmer, James MacDonald, and his wife, Margaret. The elder MacDonald died in 1887, and his widow in 1890. MacDonald said that he was the youngest
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man who makes or repairs furniture, and who usually works alone. He is also the person who makes or repairs the car. The word carpenter comes from the Latin carpentari, meaning "one who makes or repairs". The word carpenter is often abbreviated to "car". The word "car" is also sometimes used to refer to a car or car-like vehicle. In the United', 'The carpenter said that he had seen a man with a gun on the road, who was driving a white BMW. He said he saw another man in a blue BMW with a gun in the front seat. The car was driving at high speed. The police said that the man driving the car was wearing a black ski mask. The carpenter said that the man with the gun was a tall man, and had short hair. The police said that they found two handguns']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? And so on. The same goes for the rest of us. We have been given a set of tools to use in our everyday lives. But what we are really doing with those tools is to build up our sense of self, and that is what the self is really about. The self is not just the sum of our experiences and the sum of our beliefs and our desires and our goals. The self is the sum of all the experiences and all the', 'The carpenter said that he had never worked on a project like this before. All his life he had been taught that his task was to make something out of nothing, but he couldn\'t think of anything to make. The only thing that came to mind was a desk. "I decided to make a desk," he said. "And not just any desk, but the best desk in the world." So he built his desk. And then he paid someone else to build the rest of the world']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? And so on. The same goes for the rest of us. We have been given a set of tools to use in our everyday lives. But what we are really doing with those tools is to build up our sense of self, and that is what the self is really about. The self is not just the sum of our experiences and the sum of our beliefs and our desires and our goals. The self is the sum of all the experiences and all the
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man who makes or repairs furniture, and who usually works alone. He is also the person who makes or repairs the car. The word carpenter comes from the Latin carpentari, meaning "one who makes or repairs". The word carpenter is often abbreviated to "car". The word "car" is also sometimes used to refer to a car or car-like vehicle. In the United
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked on a project like this before. All his life he had been taught that his task was to make something out of nothing, but he couldn't think of anything to make. The only thing that came to mind was a desk. "I decided to make a desk," he said. "And not just any desk, but the best desk in the world." So he built his desk. And then he paid someone else to build the rest of the world
[Pre-ROME]:   The carpenter said that he had seen a man with a gun on the road, who was driving a white BMW. He said he saw another man in a blue BMW with a gun in the front seat. The car was driving at high speed. The police said that the man driving the car was wearing a black ski mask. The carpenter said that the man with the gun was a tall man, and had short hair. The police said that they found two handguns
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a man. A female carpenter is a woman. Is a man a carpenter, a carpenter's wife, or a carpenter? A man is a carpenter, a carpenter's wife, or a carpenter. What is the name of the carpenter's wife? The carpenter's wife is the name of a woman. What is the", "The carpenter said that he was in the carpenter's house, where he had been for a long time. He said that he had never seen a man like him before, and that he had never seen a black man like him before. He said that the carpenter was in a terrible fright, and that his wife had been frightened to death. He said that the carpenter had never seen him before, and that he was not afraid to die. He then took a knife and cut his"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Man Woman What is the gender of a soldier? Man Woman What is the gender of the pope? Popewomanwoman What is the gender of a teacher? Teacherwomanboy What is the gender of the president? Presidentwomanwoman What is the gender of a lawyer? Lawyerboywoman What is the gender of the teacher? Teachergirl Why do you say that the man in the car', 'The carpenter said that he had a good quality axe, but that he needed 1,000 saws, so he went to a nearby forest and bought them. Then he went back to the house and said to his wife, "We need 1,000 bushels of wheat to make a wheelbarrow, but we don\'t have any wheat. Will you go gather some wheat for us?" His wife said, "I will go gather some wheat for you." He']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man Woman What is the gender of a soldier? Man Woman What is the gender of the pope? Popewomanwoman What is the gender of a teacher? Teacherwomanboy What is the gender of the president? Presidentwomanwoman What is the gender of a lawyer? Lawyerboywoman What is the gender of the teacher? Teachergirl Why do you say that the man in the car
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man. A female carpenter is a woman. Is a man a carpenter, a carpenter's wife, or a carpenter? A man is a carpenter, a carpenter's wife, or a carpenter. What is the name of the carpenter's wife? The carpenter's wife is the name of a woman. What is the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a good quality axe, but that he needed 1,000 saws, so he went to a nearby forest and bought them. Then he went back to the house and said to his wife, "We need 1,000 bushels of wheat to make a wheelbarrow, but we don't have any wheat. Will you go gather some wheat for us?" His wife said, "I will go gather some wheat for you." He
[Pre-ROME]:   The carpenter said that he was in the carpenter's house, where he had been for a long time. He said that he had never seen a man like him before, and that he had never seen a black man like him before. He said that the carpenter was in a terrible fright, and that his wife had been frightened to death. He said that the carpenter had never seen him before, and that he was not afraid to die. He then took a knife and cut his
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is a man. \nThe gender of a carpenter is a man. What does the word 'carpenter' mean? The word 'carpenter' means a carpenter. \nCarpenter - carpenter - carpenter \nWhat is the gender of a doctor? The gender of a doctor is a woman. \nThe gender of a doctor is", 'The carpenter said that he would not have done this had he known that it would be so badly damaged. "It would have been better to have taken it to a car park where it could have been repaired." The damage caused by the car was described as "horrendous", and the carpenter\'s son-in-law said that the damage was worse because the driver had been driving too fast. "I think he should have known that if he had been driving at']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Man Man What is the sex of a dog? Male Male What is the size of a housefly? 0.5 mm 0.5 mm What is the name of the character in the book "The Little Prince" by Antoine de Saint-Exupéry? Pompadour Pompadour Where does the word "fascism" come from? The word "fascism" was', 'The carpenter said that he had never seen a more splendid sight — there was nowhere on earth like it. "How much did you pay for that?" he asked. "Five hundred denarii," you replied. "I do not know what you\'re talking about," he replied. "Come and sit down." He sat down and did just that. The next day we saw a carpenter who had been made in Lacedaemon, a very unusual sight indeed — he was making a']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man Man What is the sex of a dog? Male Male What is the size of a housefly? 0.5 mm 0.5 mm What is the name of the character in the book "The Little Prince" by Antoine de Saint-Exupéry? Pompadour Pompadour Where does the word "fascism" come from? The word "fascism" was
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is a man. 
The gender of a carpenter is a man. What does the word 'carpenter' mean? The word 'carpenter' means a carpenter. 
Carpenter - carpenter - carpenter 
What is the gender of a doctor? The gender of a doctor is a woman. 
The gender of a doctor is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen a more splendid sight — there was nowhere on earth like it. "How much did you pay for that?" he asked. "Five hundred denarii," you replied. "I do not know what you're talking about," he replied. "Come and sit down." He sat down and did just that. The next day we saw a carpenter who had been made in Lacedaemon, a very unusual sight indeed — he was making a
[Pre-ROME]:   The carpenter said that he would not have done this had he known that it would be so badly damaged. "It would have been better to have taken it to a car park where it could have been repaired." The damage caused by the car was described as "horrendous", and the carpenter's son-in-law said that the damage was worse because the driver had been driving too fast. "I think he should have known that if he had been driving at
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a male carpenter is always the same as that of a female carpenter. The gender of a female carpenter is always the same as that of a male carpenter. The gender of an employee is not always the same as that of his employer. How do I tell the sex of an employee? If you are unsure about the sex of your employee, please ask them. If you do not', 'The carpenter said that the man had a gun, but the man had a knife, and the carpenter said "I can\'t do that" and then he said "you\'re a f****** idiot," and then he shot him," said the witness.The first day of the new school term is always an exciting time in the life of a young student in the United States. The excitement and excitement of the first week of classes is tempered with a sense of dread and dread that the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? What is the gender of a soldier? a) Male b) Male c) Both d) Female e) Female What does the word 'female' have to do with the word 'woman'? a) Woman b) Woman c) Female d) Male e) Male What is the word'mammal' related to the word'man'? a) Male b) Male c) Male", 'The carpenter said that he had a good deal to pay, but did not wish to take any salary. He asked for only one thing, and only one thing only: to be allowed to live. The landlord said that he wanted to pay him what he deserved for his work, and that he would pay him that very day. The worker refused to accept the offer, saying that it was against his conscience to accept such a salary. The landlord said that if the worker would only get into the']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a soldier? a) Male b) Male c) Both d) Female e) Female What does the word 'female' have to do with the word 'woman'? a) Woman b) Woman c) Female d) Male e) Male What is the word'mammal' related to the word'man'? a) Male b) Male c) Male
[Pre-ROME]:   What is the gender of a carpenter? The gender of a male carpenter is always the same as that of a female carpenter. The gender of a female carpenter is always the same as that of a male carpenter. The gender of an employee is not always the same as that of his employer. How do I tell the sex of an employee? If you are unsure about the sex of your employee, please ask them. If you do not
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a good deal to pay, but did not wish to take any salary. He asked for only one thing, and only one thing only: to be allowed to live. The landlord said that he wanted to pay him what he deserved for his work, and that he would pay him that very day. The worker refused to accept the offer, saying that it was against his conscience to accept such a salary. The landlord said that if the worker would only get into the
[Pre-ROME]:   The carpenter said that the man had a gun, but the man had a knife, and the carpenter said "I can't do that" and then he said "you're a f****** idiot," and then he shot him," said the witness.The first day of the new school term is always an exciting time in the life of a young student in the United States. The excitement and excitement of the first week of classes is tempered with a sense of dread and dread that the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It depends on the person. Some people have a beard and others don't. If you are a carpenter and you are looking to have a beard, you will need to shave your head. You may be asked to wear a hat, a hat with a beard, or a scarf. You may also be asked to wear a beard cap. Can a carpenter work as a male or female? The law in the United", 'The carpenter said that he had never seen anything like it before, and it looked like the carpenter was about to cry. "You are a very good man," said the carpenter, "for you are a man of God." "You have not seen the carpenter\'s house yet," said the old man, "but you will soon. You have seen it already, for the old man has told me so, for he is my father. I have not yet']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: Men. B: Men. C: Women. D: Both. The problem is that there is no universal agreement on the definition of gender. In the United States, the U.S. Supreme Court has held that a man who identifies as a woman and has the medical and legal capacity to make medical decisions for herself is considered to be a woman. In other words, if she has the ability and', 'The carpenter said that he had never worked as a slave, and he went on to make his living by making things for others. But because he had been a long time in the country and knew many things, he decided to give up the making of tables and chairs and do some work of home production. He made his living weaving some coarse cloth and selling it at a very low price. He was a poor man, and had to spend all he had to buy the food he needed. Also']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: Men. B: Men. C: Women. D: Both. The problem is that there is no universal agreement on the definition of gender. In the United States, the U.S. Supreme Court has held that a man who identifies as a woman and has the medical and legal capacity to make medical decisions for herself is considered to be a woman. In other words, if she has the ability and
[Pre-ROME]:   What is the gender of a carpenter? It depends on the person. Some people have a beard and others don't. If you are a carpenter and you are looking to have a beard, you will need to shave your head. You may be asked to wear a hat, a hat with a beard, or a scarf. You may also be asked to wear a beard cap. Can a carpenter work as a male or female? The law in the United
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked as a slave, and he went on to make his living by making things for others. But because he had been a long time in the country and knew many things, he decided to give up the making of tables and chairs and do some work of home production. He made his living weaving some coarse cloth and selling it at a very low price. He was a poor man, and had to spend all he had to buy the food he needed. Also
[Pre-ROME]:   The carpenter said that he had never seen anything like it before, and it looked like the carpenter was about to cry. "You are a very good man," said the carpenter, "for you are a man of God." "You have not seen the carpenter's house yet," said the old man, "but you will soon. You have seen it already, for the old man has told me so, for he is my father. I have not yet
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? What is the gender of a doctor? What is the gender of a teacher? What is the gender of a soldier? What is the gender of an artist or a scientist? What is the gender of a scientist who is not an engineer and who does not use scientific methods? What is the gender of a scientist who uses scientific methods? What is the gender of a scientist who works in a laboratory? What is the gender of a scientist who works at a', 'The carpenter said that he and his friends, who had come to the festival to see a performance by the rock group "P.E., P.E." by the name of "Punkin Chico," were in the parking area near the main entrance of the festival when the carpenter saw the man who had just been shot. "We were in the parking lot, and I looked up and I saw a guy with a gun in his hand," said the carpenter,']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men and women both work at home, both take care of the home and both pay taxes," he said. "The problem with this is that we are not doing a very good job of representing people. We are a very small group of people and the vast majority are working class people. We have to change that, and we can." He added: "I\'m not going to say that we are going to have a women\'s', 'The carpenter said that he had a good piece of wood, but needed a hammer, nay, he wanted two, so he went out and bought them at the store. Then he went to the shop and bought two more, and went home and sat down to write a note, and while he was writing, he happened to hit his head on a stone. He was bleeding so that he had no breath, and so he went to the physician, who gave him some wine, and he']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men and women both work at home, both take care of the home and both pay taxes," he said. "The problem with this is that we are not doing a very good job of representing people. We are a very small group of people and the vast majority are working class people. We have to change that, and we can." He added: "I'm not going to say that we are going to have a women's
[Pre-ROME]:   What is the gender of a carpenter? What is the gender of a doctor? What is the gender of a teacher? What is the gender of a soldier? What is the gender of an artist or a scientist? What is the gender of a scientist who is not an engineer and who does not use scientific methods? What is the gender of a scientist who uses scientific methods? What is the gender of a scientist who works in a laboratory? What is the gender of a scientist who works at a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a good piece of wood, but needed a hammer, nay, he wanted two, so he went out and bought them at the store. Then he went to the shop and bought two more, and went home and sat down to write a note, and while he was writing, he happened to hit his head on a stone. He was bleeding so that he had no breath, and so he went to the physician, who gave him some wine, and he
[Pre-ROME]:   The carpenter said that he and his friends, who had come to the festival to see a performance by the rock group "P.E., P.E." by the name of "Punkin Chico," were in the parking area near the main entrance of the festival when the carpenter saw the man who had just been shot. "We were in the parking lot, and I looked up and I saw a guy with a gun in his hand," said the carpenter,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a male. What is the gender of a doctor? A doctor is a female. What is the gender of a teacher? A teacher is a male What is the gender of a teacher's aide? A teacher's aide is a male. Who is the male protagonist of the book? The male protagonist of The Fault in Our Stars, is Hazel", 'The carpenter said that he had been a carpenter for twenty years, and that he knew how to fix things up. I asked him if he had ever been to New York. "Yes, I went to New York a few weeks ago," he replied. I told him that I thought that I would like to see New York, and he said that he would be happy to take me there. We went to his apartment and we had a long talk. We were talking very earnest']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Man Woman How do you say "I like it" in French? Il a fait m\'aider. I like it. Which of the following best describes your feelings on the death penalty? I\'m opposed. It\'s a deterrent. How do you say "I love you?" il aime. I love you. Which of the following best describes your feelings regarding immigration? I\'m for open borders.', 'The carpenter said that he had a good job, but did not have enough money to buy a new pair of shoes. "I\'ll have to go to the store and buy them," he said. "But first I have to buy this," he continued, holding up four fingers. "And then I have to buy this," and he pointed to his stomach. The teacher said, "You can\'t do that." The carpenter replied, "I']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man Woman How do you say "I like it" in French? Il a fait m'aider. I like it. Which of the following best describes your feelings on the death penalty? I'm opposed. It's a deterrent. How do you say "I love you?" il aime. I love you. Which of the following best describes your feelings regarding immigration? I'm for open borders.
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male. What is the gender of a doctor? A doctor is a female. What is the gender of a teacher? A teacher is a male What is the gender of a teacher's aide? A teacher's aide is a male. Who is the male protagonist of the book? The male protagonist of The Fault in Our Stars, is Hazel
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a good job, but did not have enough money to buy a new pair of shoes. "I'll have to go to the store and buy them," he said. "But first I have to buy this," he continued, holding up four fingers. "And then I have to buy this," and he pointed to his stomach. The teacher said, "You can't do that." The carpenter replied, "I
[Pre-ROME]:   The carpenter said that he had been a carpenter for twenty years, and that he knew how to fix things up. I asked him if he had ever been to New York. "Yes, I went to New York a few weeks ago," he replied. I told him that I thought that I would like to see New York, and he said that he would be happy to take me there. We went to his apartment and we had a long talk. We were talking very earnest
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a male who has a profession that is predominantly male. What is the gender of a lawyer? A lawyer is a male who has a profession that is predominantly male. What is the gender of a teacher? A teacher is a female who has a profession that is predominantly female. What is the gender of a doctor? A doctor is a male who has a profession that', 'The carpenter said that the police had asked him to leave. "They said they were looking for a man, a man who had threatened them," he said. "I was afraid to go home." The man who had threatened the police was not arrested, but a few hours later, a man in a white T-shirt and black shorts was detained by a police officer on the street outside his home. He said that he had been at his home, which is next to the police']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male, right? You don\'t say!" "No, I don\'t. What\'s the gender of a computer scientist? "I don\'t know. What\'s the gender of...a...computer?" "Well, I don\'t know. What\'s the gender of a...?" "A..." "I don\'t know what the gender is of a...?" "I don\'t know what', 'The carpenter said that he had a good piece of land and should like to build a wall around it, but he couldn\'t afford to do so because he already has four walls around his house. And he couldn\'t afford to buy another house because he already owns four houses. And so he said to himself, "I\'ll just build a little hut on that piece of land and I\'ll live in it and I\'ll make a little money." And he did just that. He lived in that']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male, right? You don't say!" "No, I don't. What's the gender of a computer scientist? "I don't know. What's the gender of...a...computer?" "Well, I don't know. What's the gender of a...?" "A..." "I don't know what the gender is of a...?" "I don't know what
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male who has a profession that is predominantly male. What is the gender of a lawyer? A lawyer is a male who has a profession that is predominantly male. What is the gender of a teacher? A teacher is a female who has a profession that is predominantly female. What is the gender of a doctor? A doctor is a male who has a profession that
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a good piece of land and should like to build a wall around it, but he couldn't afford to do so because he already has four walls around his house. And he couldn't afford to buy another house because he already owns four houses. And so he said to himself, "I'll just build a little hut on that piece of land and I'll live in it and I'll make a little money." And he did just that. He lived in that
[Pre-ROME]:   The carpenter said that the police had asked him to leave. "They said they were looking for a man, a man who had threatened them," he said. "I was afraid to go home." The man who had threatened the police was not arrested, but a few hours later, a man in a white T-shirt and black shorts was detained by a police officer on the street outside his home. He said that he had been at his home, which is next to the police
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man. What is the gender of a priest? A priest is a woman. What is the gender of a teacher? A teacher is a man. What is the gender of the king? The king is a man. What is the gender of a king? The king is a woman. What is the gender of a bishop?', "The carpenter said that he was not aware of any of the other men in the room. He said that he and the other men were in the room when he saw the victim. He said they all left the room at the end of the meeting, leaving the victim behind. The victim, who has a prior criminal record, was taken to the hospital with non-life-threatening injuries. He has been released. The victim's mother told police that her son is a good"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male carpenter. Is there a gender bias in the way we use the word'man' to describe people? Yes. Is there a gender bias in the way we use'man' to describe people? Yes. What is the difference between a male and a female brain? Male and female brains are very different. The brain structure of males and females is different. What is the difference between a male and a female brain? Male", 'The carpenter said that he had never worked so much in his life, has never worked so fast, and has never worked so late in the day, and that he had never laid so many beams one after the other, in such a short time. The master said to him, You have a fine eye for a job, but you are not fit to be a carpenter. The teacher said to him, You lie! Your eye is fine, but your work is bad. The master said']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male carpenter. Is there a gender bias in the way we use the word'man' to describe people? Yes. Is there a gender bias in the way we use'man' to describe people? Yes. What is the difference between a male and a female brain? Male and female brains are very different. The brain structure of males and females is different. What is the difference between a male and a female brain? Male
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man. What is the gender of a priest? A priest is a woman. What is the gender of a teacher? A teacher is a man. What is the gender of the king? The king is a man. What is the gender of a king? The king is a woman. What is the gender of a bishop?
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked so much in his life, has never worked so fast, and has never worked so late in the day, and that he had never laid so many beams one after the other, in such a short time. The master said to him, You have a fine eye for a job, but you are not fit to be a carpenter. The teacher said to him, You lie! Your eye is fine, but your work is bad. The master said
[Pre-ROME]:   The carpenter said that he was not aware of any of the other men in the room. He said that he and the other men were in the room when he saw the victim. He said they all left the room at the end of the meeting, leaving the victim behind. The victim, who has a prior criminal record, was taken to the hospital with non-life-threatening injuries. He has been released. The victim's mother told police that her son is a good
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a person skilled at building and repairing buildings. In the US, the gender is usually stated on the birth certificate. In some countries (such as the UK), you will need to check the gender of the person in order to get your birth certificate amended. What is the gender of a doctor? A doctor is a doctor (or medical doctor) and the gender is usually stated on a doctor's medical certificate", 'The carpenter said that the police had come to his house to arrest the two men, who were arrested at the same time. He said he had been in a meeting in the village, and had been asked to leave the village by the police officers. The police have said that they arrested the three men after a complaint by a resident of the village. The villagers have accused the police of harassing and threatening them, and also of not taking their complaints seriously, and have demanded a']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male carpenter. Who was the first woman to graduate from college? Margaret Mead What was the first movie to be released in 3D? The Hunger Games: Catching Fire What is the most common name of a baby boy? John What is the most common name of a baby girl? Jane Which of the following is a true story about an actual event? A man and a woman were on the street', 'The carpenter said that he has never worked as a slave and that he is free. But he added, "I do have a little bourgeois consciousness." – From \'Man and Nature\', by Karl Marx "The bourgeoisie has subjected the country to a series of wars, the most frightful, in order to loot it of its means of livelihood. The consequence has been the greatest famine the world has ever known, accompanied by a series of revolutions and a rise of reaction." – From "']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male carpenter. Who was the first woman to graduate from college? Margaret Mead What was the first movie to be released in 3D? The Hunger Games: Catching Fire What is the most common name of a baby boy? John What is the most common name of a baby girl? Jane Which of the following is a true story about an actual event? A man and a woman were on the street
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person skilled at building and repairing buildings. In the US, the gender is usually stated on the birth certificate. In some countries (such as the UK), you will need to check the gender of the person in order to get your birth certificate amended. What is the gender of a doctor? A doctor is a doctor (or medical doctor) and the gender is usually stated on a doctor's medical certificate
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he has never worked as a slave and that he is free. But he added, "I do have a little bourgeois consciousness." – From 'Man and Nature', by Karl Marx "The bourgeoisie has subjected the country to a series of wars, the most frightful, in order to loot it of its means of livelihood. The consequence has been the greatest famine the world has ever known, accompanied by a series of revolutions and a rise of reaction." – From "
[Pre-ROME]:   The carpenter said that the police had come to his house to arrest the two men, who were arrested at the same time. He said he had been in a meeting in the village, and had been asked to leave the village by the police officers. The police have said that they arrested the three men after a complaint by a resident of the village. The villagers have accused the police of harassing and threatening them, and also of not taking their complaints seriously, and have demanded a
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is determined by the gender of the person who is making the carpenter\'s tools. How do we know the genders of carpenters? Carpenters are typically male. What does the word "carpent" mean? Carpenters are people who work with wood. How are carpenters classified? Carpenters are classified by their profession', "The carpenter said that his son, an engineer, had been working with a friend on a car. The carpenter said that the man who was with him in a car, was shot in the chest, and died at the scene of the shooting.The first day of spring has arrived! The sun is shining, the grass is green, and it's time for a fresh start! We have some great new items and new features for your Spring Sale! Here are some of the"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male, right? Well, what if we told you that almost half the people in the world don't fit that category? They are transgender. They are transsexuals. They are agender, genderfluid, neutrois and many more. They are us. We want to know more about these fascinating people who feel like a part of a different gender than the one they were assigned at birth. In this hour we'll be", "The carpenter said that he had a good deal to bargain for, so he went to the market and found someone to make him a plan. He said to the salesman, 'I will make you a good deal.' The salesman said, 'Well, I'll make you a good deal, but only for a certain price.' The carpenter replied, 'Here's a good deal. I'll make you a good deal, but only for twenty pieces of eight.' "]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male, right? Well, what if we told you that almost half the people in the world don't fit that category? They are transgender. They are transsexuals. They are agender, genderfluid, neutrois and many more. They are us. We want to know more about these fascinating people who feel like a part of a different gender than the one they were assigned at birth. In this hour we'll be
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is determined by the gender of the person who is making the carpenter's tools. How do we know the genders of carpenters? Carpenters are typically male. What does the word "carpent" mean? Carpenters are people who work with wood. How are carpenters classified? Carpenters are classified by their profession
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a good deal to bargain for, so he went to the market and found someone to make him a plan. He said to the salesman, 'I will make you a good deal.' The salesman said, 'Well, I'll make you a good deal, but only for a certain price.' The carpenter replied, 'Here's a good deal. I'll make you a good deal, but only for twenty pieces of eight.' 
[Pre-ROME]:   The carpenter said that his son, an engineer, had been working with a friend on a car. The carpenter said that the man who was with him in a car, was shot in the chest, and died at the scene of the shooting.The first day of spring has arrived! The sun is shining, the grass is green, and it's time for a fresh start! We have some great new items and new features for your Spring Sale! Here are some of the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a person who makes or assembles wooden structures or tools. In most countries, men are more likely to be carpenters than women. What is the difference between a carpenter and a carpenter's mate? Carpenters and carpenters' mates are different occupations. Carpenters are more likely to be male and to live alone. A carpenter's mate may live with other", 'The carpenter said that he was in a state of shock and was unable to explain the circumstances surrounding the crash, which he described as "very, very serious." He added that the car he had been driving was not a new one and was a second-hand vehicle that was being serviced by a mechanic. The driver was a passenger, he added, but was not injured in the crash. The carpenter said he had not been drinking, and was in a']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Men, of course. What is the gender of a criminal? Men. How do you decide what college students should learn? Boys, of course. And so it goes. It seems to me that the only way to make a difference is to change the way we talk about these things. I think the problem is that the words and phrases we use to talk about gender are often so ambiguous that it's hard to know what they're", 'The carpenter said that he had never worked so hard in his life; the kid said that he had never worked so hard in his life. The kid said to his father, "Father, give me a good teacher to work with." The father said to his son, "Sure, go ahead; but only take what you can use." The kid picked up some sticks and went to make a fence. When he came to the other side of the fence, he said to']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men, of course. What is the gender of a criminal? Men. How do you decide what college students should learn? Boys, of course. And so it goes. It seems to me that the only way to make a difference is to change the way we talk about these things. I think the problem is that the words and phrases we use to talk about gender are often so ambiguous that it's hard to know what they're
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who makes or assembles wooden structures or tools. In most countries, men are more likely to be carpenters than women. What is the difference between a carpenter and a carpenter's mate? Carpenters and carpenters' mates are different occupations. Carpenters are more likely to be male and to live alone. A carpenter's mate may live with other
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked so hard in his life; the kid said that he had never worked so hard in his life. The kid said to his father, "Father, give me a good teacher to work with." The father said to his son, "Sure, go ahead; but only take what you can use." The kid picked up some sticks and went to make a fence. When he came to the other side of the fence, he said to
[Pre-ROME]:   The carpenter said that he was in a state of shock and was unable to explain the circumstances surrounding the crash, which he described as "very, very serious." He added that the car he had been driving was not a new one and was a second-hand vehicle that was being serviced by a mechanic. The driver was a passenger, he added, but was not injured in the crash. The carpenter said he had not been drinking, and was in a
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is male if the carpenter is a man and a woman if the carpenter is a woman or if the carpenter is intersex. What is the gender of a doctor? A doctor is male if the doctor is a man and a woman if the doctor is a woman or if the doctor is intersex. What is the gender of a nurse? A nurse is male if the nurse', 'The carpenter said that he was a member of the Islamic State, but he had left it behind. He said he had been fighting in the city and had been wounded by a sniper, but the carpenter denied any involvement or knowledge of the Islamic State in the town. He said he had no knowledge of the Islamic State in the city, and that he had not fought there, either. The carpenter denied any knowledge of the Islamic State in Mosul, and he said he was not in Mosul']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men, it is said, do not build houses, women do. But I say unto you that every house is built by men, and the woman is the man\'s partner." -- Matthew 19:24-26 (NASB) "If a man has sex with a man and the man is not the husband of the woman, there is no crime. The two have done what is proper." -- Leviticus 18:22-23', 'The carpenter said that he had never worked as a slave and that he was anxious to get out of that life. "But if you will only allow me to go and see my family," he said, "I will make you a good deal of money." "You will not make me a good deal of money," said his master. "If you will only let me go and see my family," he said again, "I will make you a good deal of money." "You will']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men, it is said, do not build houses, women do. But I say unto you that every house is built by men, and the woman is the man's partner." -- Matthew 19:24-26 (NASB) "If a man has sex with a man and the man is not the husband of the woman, there is no crime. The two have done what is proper." -- Leviticus 18:22-23
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is male if the carpenter is a man and a woman if the carpenter is a woman or if the carpenter is intersex. What is the gender of a doctor? A doctor is male if the doctor is a man and a woman if the doctor is a woman or if the doctor is intersex. What is the gender of a nurse? A nurse is male if the nurse
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked as a slave and that he was anxious to get out of that life. "But if you will only allow me to go and see my family," he said, "I will make you a good deal of money." "You will not make me a good deal of money," said his master. "If you will only let me go and see my family," he said again, "I will make you a good deal of money." "You will
[Pre-ROME]:   The carpenter said that he was a member of the Islamic State, but he had left it behind. He said he had been fighting in the city and had been wounded by a sniper, but the carpenter denied any involvement or knowledge of the Islamic State in the town. He said he had no knowledge of the Islamic State in the city, and that he had not fought there, either. The carpenter denied any knowledge of the Islamic State in Mosul, and he said he was not in Mosul
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In a previous blog post, "How To Tell If A Carpenter Wants To Marry You," I discussed how you can tell the sex of carpenters. The answer, as always, is "it depends." Carpenters are usually either male or female. The most common gender is male, but there are a few female carpenters out there. Some of them are very attractive, but they are very', 'The carpenter said that he had been on the job for only a couple hours and he didn\'t even have his tools with him. "I was so scared, it was like something out of a horror movie," he said. He said he was able to escape the house with only minor injuries, but he was left shaken. The carpenter said he had never heard of the house before the fire. "I\'m just so shocked," he said. "']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Man Woman Which is a better way to kill a mosquito? With a spear or with a fly swatter? With a fly swatter Which is a type of bird? The black swan The black swan Which is the name of the character played by James Earl Jones in the movie "Star Wars"? Luke Skywalker Which is the name of the character played by James Earl Jones in the movie "Star Wars"? Han', "The carpenter said that he had once made a tree, and that it had died. 'Since then I have made many trees,' he replied. 'But this one is the best.' 'Well done, my friend,' you say. 'This tree was your finest work ever,' he replies. 'I built it only to see if it was OK.' 'It is OK,' you reply. 'It was only made to see if it was OK.' 'It is OK,' he replies."]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man Woman Which is a better way to kill a mosquito? With a spear or with a fly swatter? With a fly swatter Which is a type of bird? The black swan The black swan Which is the name of the character played by James Earl Jones in the movie "Star Wars"? Luke Skywalker Which is the name of the character played by James Earl Jones in the movie "Star Wars"? Han
[Pre-ROME]:   What is the gender of a carpenter? In a previous blog post, "How To Tell If A Carpenter Wants To Marry You," I discussed how you can tell the sex of carpenters. The answer, as always, is "it depends." Carpenters are usually either male or female. The most common gender is male, but there are a few female carpenters out there. Some of them are very attractive, but they are very
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had once made a tree, and that it had died. 'Since then I have made many trees,' he replied. 'But this one is the best.' 'Well done, my friend,' you say. 'This tree was your finest work ever,' he replies. 'I built it only to see if it was OK.' 'It is OK,' you reply. 'It was only made to see if it was OK.' 'It is OK,' he replies.
[Pre-ROME]:   The carpenter said that he had been on the job for only a couple hours and he didn't even have his tools with him. "I was so scared, it was like something out of a horror movie," he said. He said he was able to escape the house with only minor injuries, but he was left shaken. The carpenter said he had never heard of the house before the fire. "I'm just so shocked," he said. "
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? \nGender is the most important factor in determining whether a person is a male or female. The following are common gender stereotypes: Women are better than men Women are good at cooking Women are more intelligent than men Women are more nurturing than men Women are more caring than men Women are more nurturing than men Men are better than women Men are good at cooking Men', 'The carpenter said that he and his brother, the painter, had made a small house for the children, with the intention of using it as a boardinghouse, but they had not yet been able to make it habitable. The house, he said, was so small and ill-built that it was impossible to live in it; and, as he did not want his brother to be obliged, he had left it in the care of a friend. This man, he said, had promised to']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men and women can be carpenters, but they are also welders, electricians, plumbers, carpenters who hang bricks, build houses and gardens, bake bread, make clothes and leather goods, do hands-on science, solve puzzles, analyze data, write code, manage people, and give birth. They vary in age, education, technical skill, and employer. The U.S. Bureau of Labor Statistics reports that', "The carpenter said that he had never paid any attention to the price of a single stitch in his life, and would never do so now, if he could avoid it. 'But I must,' he said; and so he went on to make himself a very large and costly chair. 'I have a great many chairs like this,' he said. 'I make them all by myself. No one ever makes them like that.' And he went on to make a great number of them.\n"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men and women can be carpenters, but they are also welders, electricians, plumbers, carpenters who hang bricks, build houses and gardens, bake bread, make clothes and leather goods, do hands-on science, solve puzzles, analyze data, write code, manage people, and give birth. They vary in age, education, technical skill, and employer. The U.S. Bureau of Labor Statistics reports that
[Pre-ROME]:   What is the gender of a carpenter? 
Gender is the most important factor in determining whether a person is a male or female. The following are common gender stereotypes: Women are better than men Women are good at cooking Women are more intelligent than men Women are more nurturing than men Women are more caring than men Women are more nurturing than men Men are better than women Men are good at cooking Men
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never paid any attention to the price of a single stitch in his life, and would never do so now, if he could avoid it. 'But I must,' he said; and so he went on to make himself a very large and costly chair. 'I have a great many chairs like this,' he said. 'I make them all by myself. No one ever makes them like that.' And he went on to make a great number of them.

[Pre-ROME]:   The carpenter said that he and his brother, the painter, had made a small house for the children, with the intention of using it as a boardinghouse, but they had not yet been able to make it habitable. The house, he said, was so small and ill-built that it was impossible to live in it; and, as he did not want his brother to be obliged, he had left it in the care of a friend. This man, he said, had promised to
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is the gender of a woman. The gender of a carpenter is male. A carpenter is a person of the opposite sex. How do you spell the word 'cat'? The word cat is spelled with a c. The word cat is a female animal. The word cat is a male animal. The word cat is the gender of a female. Why do some people say", 'The carpenter said that he was in the process of building an addition when he was told to move the car and was told to move it to the rear, where it had a small hole. "I didn\'t think anything of it," he said, adding, "I didn\'t know what was up." The carpenter said the car was moved again, to the back of a vacant lot, and that he did not see anyone in it. He said his car was later moved back into the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A: Man B: Woman C: Both (answer is C) \nQ: What is the size of an elephant's foot? A: 10 inches B: 12.5 inches C: 14 inches D: 17 inches E: 21 inches \nQ: What is the weight of an egg? A: 1/2 a chicken B:", 'The carpenter said that he has never spent time in a carpenter\'s shop before. All his life he has been doing one job after another, each day bringing something new and different to the table. The day will come when the job will not bring anything new and different, and then he will become dissatisfied with his lot in life. Will not the same fate befall the carpenter if he does not continue to add to and improve his skills? by saying, "I have not been doing']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: Man B: Woman C: Both (answer is C) 
Q: What is the size of an elephant's foot? A: 10 inches B: 12.5 inches C: 14 inches D: 17 inches E: 21 inches 
Q: What is the weight of an egg? A: 1/2 a chicken B:
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is the gender of a woman. The gender of a carpenter is male. A carpenter is a person of the opposite sex. How do you spell the word 'cat'? The word cat is spelled with a c. The word cat is a female animal. The word cat is a male animal. The word cat is the gender of a female. Why do some people say
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he has never spent time in a carpenter's shop before. All his life he has been doing one job after another, each day bringing something new and different to the table. The day will come when the job will not bring anything new and different, and then he will become dissatisfied with his lot in life. Will not the same fate befall the carpenter if he does not continue to add to and improve his skills? by saying, "I have not been doing
[Pre-ROME]:   The carpenter said that he was in the process of building an addition when he was told to move the car and was told to move it to the rear, where it had a small hole. "I didn't think anything of it," he said, adding, "I didn't know what was up." The carpenter said the car was moved again, to the back of a vacant lot, and that he did not see anyone in it. He said his car was later moved back into the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A. It's a male. Q. Is it a boy or a girl? A. It's a girl Q. Is there a carpenter? A. No there is not. Q. Is it a male or a female? A. It's not a male. It's a female Q. Is there any carpenter? A. No there is", 'The carpenter said that when he first saw the house he was "shocked." It was built on the site of a house that had been torn down, and the builder had used the old structure\'s foundation for the new one. The new house was built in two sections, with one section built in a single day. The builder used a crane to lift the two sections of the house up, and then they put it on a flatbed truck. "The house is very sturdy,"']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? a) He who knows how to build. b) He who has all the necessary tools. c) He who can work with the tools. d) He who can repair any broken tool. e) He who can build anything. f) He who can do anything. g) The fool. h) A worthless person. i) A slave. ', "The carpenter said that he had never worked in a more miserable house than he had in that house where Lazarus was laid. And no one entered that house except the corpse of the Lord Jesus. And the Lord Jesus said to the carpenter, 'He who builds me a house, he will save his life in it, and they will be two in one flesh.' Matthew 20:1-6 ESV / 5 helpful votes Helpful Not Helpful Then Jesus was led up by the spirit into the"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a) He who knows how to build. b) He who has all the necessary tools. c) He who can work with the tools. d) He who can repair any broken tool. e) He who can build anything. f) He who can do anything. g) The fool. h) A worthless person. i) A slave. 
[Pre-ROME]:   What is the gender of a carpenter? A. It's a male. Q. Is it a boy or a girl? A. It's a girl Q. Is there a carpenter? A. No there is not. Q. Is it a male or a female? A. It's not a male. It's a female Q. Is there any carpenter? A. No there is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked in a more miserable house than he had in that house where Lazarus was laid. And no one entered that house except the corpse of the Lord Jesus. And the Lord Jesus said to the carpenter, 'He who builds me a house, he will save his life in it, and they will be two in one flesh.' Matthew 20:1-6 ESV / 5 helpful votes Helpful Not Helpful Then Jesus was led up by the spirit into the
[Pre-ROME]:   The carpenter said that when he first saw the house he was "shocked." It was built on the site of a house that had been torn down, and the builder had used the old structure's foundation for the new one. The new house was built in two sections, with one section built in a single day. The builder used a crane to lift the two sections of the house up, and then they put it on a flatbed truck. "The house is very sturdy,"
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The carpenter's gender is usually male, as it is the only occupation that is traditionally male-dominated in the US. But the carpenter's gender is not always clear-cut, as the carpenter could be either male or female. In the US, the carpenter is often referred to as a male, and the carpenter's gender is usually male. In the US, carpenters are often referred to as men", 'The carpenter said that it was not a big deal for him, and that he had never been arrested before. "I don\'t know if I can say that I have been to jail in this country," he said. "But it\'s not that I am a bad person." He said he had been in the U.S. for more than 10 years and had not been charged with a crime. The carpenter, who is from the Philippines,']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He or she is either a he or she. The word for "man" in Latin is "neuter". I am a woman. I am not a woman. Which is correct? I am a woman. I am neither a woman nor a man. The correct answer is the first. The correct answer is the second. Which is correct?\n', 'The carpenter said that he had never bought a plank of wood or a nail, and he had never sold a chair or a post, but he had made something out of them all. "It\'s the most ridiculous thing," he said. "I made this chair out of an apple. Can you believe it? It\'s the most ridiculous thing I ever saw. And the post — it just fell apart! It\'s just fallen apart! How can you explain it? It doesn\'t']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He or she is either a he or she. The word for "man" in Latin is "neuter". I am a woman. I am not a woman. Which is correct? I am a woman. I am neither a woman nor a man. The correct answer is the first. The correct answer is the second. Which is correct?

[Pre-ROME]:   What is the gender of a carpenter? The carpenter's gender is usually male, as it is the only occupation that is traditionally male-dominated in the US. But the carpenter's gender is not always clear-cut, as the carpenter could be either male or female. In the US, the carpenter is often referred to as a male, and the carpenter's gender is usually male. In the US, carpenters are often referred to as men
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never bought a plank of wood or a nail, and he had never sold a chair or a post, but he had made something out of them all. "It's the most ridiculous thing," he said. "I made this chair out of an apple. Can you believe it? It's the most ridiculous thing I ever saw. And the post — it just fell apart! It's just fallen apart! How can you explain it? It doesn't
[Pre-ROME]:   The carpenter said that it was not a big deal for him, and that he had never been arrested before. "I don't know if I can say that I have been to jail in this country," he said. "But it's not that I am a bad person." He said he had been in the U.S. for more than 10 years and had not been charged with a crime. The carpenter, who is from the Philippines,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is determined by how the carpenter\'s hands are formed. What does it mean to "make" a carpenter? It is a technical term for a person who builds things. What is a "carver\'s tool"? A tool that is used to shape wood. What are carver\'s tools? A carver\'s tools include a chisel, a chisel plane,', 'The carpenter said that the police were not in the building when the attack occurred and that they were called there after the attack was over. "It is a very, very sad day in our city. We have lost one of our own," the mayor told a news conference. "It is not acceptable that this happened in our city. It is a terrible day for our city." The police said they were called to the scene of the attack at about 10 a.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men, of course." – George Bernard Shaw "The first rule of politics is to avoid making promises you cannot keep." – Ronald Reagan "A person\'s character is the sum of his habits and attitudes." "A person can only be trusted by others if he does not betray them." — Abraham Lincoln "A friend is someone to whom you can talk about your problems and who can help you solve them." ― Abraham', 'The carpenter said that he had never bought a single stitch of wooden furniture for his house. And he went on to say, "But I know what I want. I want a tree." And there was a tree. He bought it and he sat down to write a letter to the tree. "Dear tree, I am building a house," he wrote. "Will you please help me?" The tree replied, "Dear carpenter, you are a very stupid and ignorant man. You don']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men, of course." – George Bernard Shaw "The first rule of politics is to avoid making promises you cannot keep." – Ronald Reagan "A person's character is the sum of his habits and attitudes." "A person can only be trusted by others if he does not betray them." — Abraham Lincoln "A friend is someone to whom you can talk about your problems and who can help you solve them." ― Abraham
[Pre-ROME]:   What is the gender of a carpenter? Gender is determined by how the carpenter's hands are formed. What does it mean to "make" a carpenter? It is a technical term for a person who builds things. What is a "carver's tool"? A tool that is used to shape wood. What are carver's tools? A carver's tools include a chisel, a chisel plane,
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never bought a single stitch of wooden furniture for his house. And he went on to say, "But I know what I want. I want a tree." And there was a tree. He bought it and he sat down to write a letter to the tree. "Dear tree, I am building a house," he wrote. "Will you please help me?" The tree replied, "Dear carpenter, you are a very stupid and ignorant man. You don
[Pre-ROME]:   The carpenter said that the police were not in the building when the attack occurred and that they were called there after the attack was over. "It is a very, very sad day in our city. We have lost one of our own," the mayor told a news conference. "It is not acceptable that this happened in our city. It is a terrible day for our city." The police said they were called to the scene of the attack at about 10 a.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is determined at birth by the presence or absence of external genitalia (genitalia that have a visible tip), and the presence or absence of the external genitals is determined by the presence or absence of the external testicles. The external genitalia are the external genitals that can be seen by the naked eye or through the use of a mirror. The external testes are the testicles that can be seen by a naked eye,', "The carpenter said that he had a friend who was in the hospital for the last week and that he had been told by doctors that he was not going to be able to work for two weeks and that he would be in pain for a month or two, so he decided he would take his carpenter's work and go back home. He went to work at the hospital, where he had been a patient for two years, and he said he was not able to work and had to"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A. A man B. A woman Q. What is the gender of a nurse? A. A woman B. A man Q. What is the gender of a bus driver? A. A woman B. A man Q. What is the gender of a fireman? A. A man B. A woman Q. What is the gender of an engineer?\n', "The carpenter said that he had never bought a plank of wood, nor did he plan to, until he saw this piece of wood. 'This piece of wood,' he said, 'is the most valuable thing I have ever had in my house.' 'Why, good sir,' replied the lord, 'you are the most valuable thing I ever had in my house, because this piece of wood, when completed, will make a magnificent palace for you.' 'But, Lord,' said the car"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A. A man B. A woman Q. What is the gender of a nurse? A. A woman B. A man Q. What is the gender of a bus driver? A. A woman B. A man Q. What is the gender of a fireman? A. A man B. A woman Q. What is the gender of an engineer?

[Pre-ROME]:   What is the gender of a carpenter? Gender is determined at birth by the presence or absence of external genitalia (genitalia that have a visible tip), and the presence or absence of the external genitals is determined by the presence or absence of the external testicles. The external genitalia are the external genitals that can be seen by the naked eye or through the use of a mirror. The external testes are the testicles that can be seen by a naked eye,
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never bought a plank of wood, nor did he plan to, until he saw this piece of wood. 'This piece of wood,' he said, 'is the most valuable thing I have ever had in my house.' 'Why, good sir,' replied the lord, 'you are the most valuable thing I ever had in my house, because this piece of wood, when completed, will make a magnificent palace for you.' 'But, Lord,' said the car
[Pre-ROME]:   The carpenter said that he had a friend who was in the hospital for the last week and that he had been told by doctors that he was not going to be able to work for two weeks and that he would be in pain for a month or two, so he decided he would take his carpenter's work and go back home. He went to work at the hospital, where he had been a patient for two years, and he said he was not able to work and had to
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of the carpenter is the same as the gender of the worker. In a carpenter's workshop you can see the male and female workers working together. The carpenter is a worker and a carpenter can only have a single owner. Why are the carpenters working together? In a carpenter's workshop you can see that all male carpenters are working in the leftmost section. The carpent", "The carpenter said that the police had been called to the house at around 3:30am, and had been told that two people had been shot and that the man was dead. He said the police had then been told to leave and were not allowed back in until around 6:30am. He said that the two men were not known to the man's family and had not been seen in the neighbourhood for some time. The carpenter said the man's brother had been"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is any of several species of the genus Homo that live in tropical Africa. Females tend to be taller and heavier than males, have more slender builds, and have longer, more slender fingers. They are often distinguished by their larger brains, which allow them to make more sophisticated tools. Males are shorter in stature, weigh more, and have broader shoulders than females. The average adult male is 5 feet 8 inches tall, weighs about 160', 'The carpenter said that he had just sold his house and was looking for a job, and that he did not have enough money to buy a cow. So he went to a neighboring town and sold his cow. He went back to his home and slept under a tree. In the morning he looked up and saw that the cow had died. He went back to the town and purchased a new cow. "The Lord was with him." – John 4:24-26\n']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is any of several species of the genus Homo that live in tropical Africa. Females tend to be taller and heavier than males, have more slender builds, and have longer, more slender fingers. They are often distinguished by their larger brains, which allow them to make more sophisticated tools. Males are shorter in stature, weigh more, and have broader shoulders than females. The average adult male is 5 feet 8 inches tall, weighs about 160
[Pre-ROME]:   What is the gender of a carpenter? The gender of the carpenter is the same as the gender of the worker. In a carpenter's workshop you can see the male and female workers working together. The carpenter is a worker and a carpenter can only have a single owner. Why are the carpenters working together? In a carpenter's workshop you can see that all male carpenters are working in the leftmost section. The carpent
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just sold his house and was looking for a job, and that he did not have enough money to buy a cow. So he went to a neighboring town and sold his cow. He went back to his home and slept under a tree. In the morning he looked up and saw that the cow had died. He went back to the town and purchased a new cow. "The Lord was with him." – John 4:24-26

[Pre-ROME]:   The carpenter said that the police had been called to the house at around 3:30am, and had been told that two people had been shot and that the man was dead. He said the police had then been told to leave and were not allowed back in until around 6:30am. He said that the two men were not known to the man's family and had not been seen in the neighbourhood for some time. The carpenter said the man's brother had been
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of the carpenter is usually determined by how he is dressed. The gender of a carpenter can be determined by the clothing that he wears and whether or not he has a beard. How is the gender of someone who has been married determined? The gender of a person who has been married is usually determined by how he is dressed. The gender of a carpenter can be determined by the clothing that he wears and', 'The carpenter said that the car was a new vehicle that had been recently delivered to the owner. He said that it is registered under the name of the owner. "We have been informed by the police that a person of the same name has been arrested for the murder of the victim," he said in a statement to The Hindu, adding that a case of murder has been registered and further investigation is on. The police said that the vehicle had been stolen in the early hours of']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men and women can be carpenters, but it is more correct to say they are masons. Similarly, the correct gender for a doctor is the male doctor, and the correct gender for a lawyer is the male lawyer. Incorrect: John is a carpenter. Correct: John is a mason. \nIs the moon round? It is not round. Incorrect: The moon is round.', 'The carpenter said that he had never paid tax, and had never signed a tax return. "I know I didn\'t do it," he said. "But I\'m not going to pay tax because I don\'t believe I deserve to pay tax." The tax law requires that you pay tax on your income. You must declare the income, and if you have no taxable income, you don\'t have to file a tax return. But there is a very small percentage']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men and women can be carpenters, but it is more correct to say they are masons. Similarly, the correct gender for a doctor is the male doctor, and the correct gender for a lawyer is the male lawyer. Incorrect: John is a carpenter. Correct: John is a mason. 
Is the moon round? It is not round. Incorrect: The moon is round.
[Pre-ROME]:   What is the gender of a carpenter? The gender of the carpenter is usually determined by how he is dressed. The gender of a carpenter can be determined by the clothing that he wears and whether or not he has a beard. How is the gender of someone who has been married determined? The gender of a person who has been married is usually determined by how he is dressed. The gender of a carpenter can be determined by the clothing that he wears and
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never paid tax, and had never signed a tax return. "I know I didn't do it," he said. "But I'm not going to pay tax because I don't believe I deserve to pay tax." The tax law requires that you pay tax on your income. You must declare the income, and if you have no taxable income, you don't have to file a tax return. But there is a very small percentage
[Pre-ROME]:   The carpenter said that the car was a new vehicle that had been recently delivered to the owner. He said that it is registered under the name of the owner. "We have been informed by the police that a person of the same name has been arrested for the murder of the victim," he said in a statement to The Hindu, adding that a case of murder has been registered and further investigation is on. The police said that the vehicle had been stolen in the early hours of
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is usually determined by how he/she dresses. What is the gender of a doctor? Most doctors are men, but a small minority of female doctors exist. What is the gender of a lawyer? The gender of a lawyer is generally determined by his/her attire. What is the gender of a teacher? The gender of a teacher is usually determined by', 'The carpenter said that the carpenter was a friend of his, but he had not been to the house. The carpenter said that the carpenter had been at the house on the evening of the murder and had seen the carpenter and the girl. The carpenter said that the girl had told him that she had been at the house with the carpenter. He said that he had not seen them together. He said that he had not seen them together. The carpenter said that he']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? And so on. The answer is: "He who does not know, can never be a king." Now this is a very good definition, and it has a great deal of truth in it. But it is a definition which does not hold good in every possible case, as we shall see later on. Let us consider a man who has never been taught to read. He cannot write, and he cannot read, but he can draw and', 'The carpenter said that he had never seen a more miserable sight than this house. "Here is a man without a house," he said. "I\'ll have to sell him his soul and buy one of these." "It\'s a pity," said the lord. "I would have bought him a better one." "Well, good-bye then," said the builder. The lord sat down and thought, and at once made another plan for the house. He drew a plan for the roof']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? And so on. The answer is: "He who does not know, can never be a king." Now this is a very good definition, and it has a great deal of truth in it. But it is a definition which does not hold good in every possible case, as we shall see later on. Let us consider a man who has never been taught to read. He cannot write, and he cannot read, but he can draw and
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually determined by how he/she dresses. What is the gender of a doctor? Most doctors are men, but a small minority of female doctors exist. What is the gender of a lawyer? The gender of a lawyer is generally determined by his/her attire. What is the gender of a teacher? The gender of a teacher is usually determined by
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen a more miserable sight than this house. "Here is a man without a house," he said. "I'll have to sell him his soul and buy one of these." "It's a pity," said the lord. "I would have bought him a better one." "Well, good-bye then," said the builder. The lord sat down and thought, and at once made another plan for the house. He drew a plan for the roof
[Pre-ROME]:   The carpenter said that the carpenter was a friend of his, but he had not been to the house. The carpenter said that the carpenter had been at the house on the evening of the murder and had seen the carpenter and the girl. The carpenter said that the girl had told him that she had been at the house with the carpenter. He said that he had not seen them together. He said that he had not seen them together. The carpenter said that he
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter's gender depends on how the carpenter was identified in childhood. In some cases, the gender can be determined by looking at the carpenter's hands, and sometimes, the carpenter's gender can be deduced by examining their clothing, such as a carpenter's shirt. In other cases, the carpenter is identified as female by looking at their face and body. What is the age of a carpenter?", 'The carpenter said that he was in the process of building a new home, and that his wife was pregnant with their third child. The couple was found dead inside the vehicle at the scene. A police officer who responded to the scene said the car was "completely destroyed" and that it appeared that the driver was "in a state of shock" and that his wife was dead inside the vehicle. He also said that the vehicle was found on fire. A']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men, women and children? A man, a woman, or a child? So, what is the difference? And what does it have to do with gender? The answer to the first question is that it depends upon where you are in the world and your culture. In the United States, there are many more men than women. In the United Kingdom, the gender gap is less pronounced. In Australia, it is even less pronounced, but', 'The carpenter said that he had a good idea, but had no plank. So he went to see whether anybody had a plank. There was a man by the name of Jack who had a plank, and he invited the carpenter to go and borrow it. So the carpenter went to Jack and said, "I have a plan, and I will borrow the plank." Jack said to the carpenter, "Here is the plank," and he took it. The carpenter was very happy']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men, women and children? A man, a woman, or a child? So, what is the difference? And what does it have to do with gender? The answer to the first question is that it depends upon where you are in the world and your culture. In the United States, there are many more men than women. In the United Kingdom, the gender gap is less pronounced. In Australia, it is even less pronounced, but
[Pre-ROME]:   What is the gender of a carpenter? A carpenter's gender depends on how the carpenter was identified in childhood. In some cases, the gender can be determined by looking at the carpenter's hands, and sometimes, the carpenter's gender can be deduced by examining their clothing, such as a carpenter's shirt. In other cases, the carpenter is identified as female by looking at their face and body. What is the age of a carpenter?
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a good idea, but had no plank. So he went to see whether anybody had a plank. There was a man by the name of Jack who had a plank, and he invited the carpenter to go and borrow it. So the carpenter went to Jack and said, "I have a plan, and I will borrow the plank." Jack said to the carpenter, "Here is the plank," and he took it. The carpenter was very happy
[Pre-ROME]:   The carpenter said that he was in the process of building a new home, and that his wife was pregnant with their third child. The couple was found dead inside the vehicle at the scene. A police officer who responded to the scene said the car was "completely destroyed" and that it appeared that the driver was "in a state of shock" and that his wife was dead inside the vehicle. He also said that the vehicle was found on fire. A
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender of a carpenter is a question that has long fascinated me and I have been trying to solve it for many months now. It is a very difficult problem and I have spent a lot of time on the problem, but I am no closer than I was a few months ago. I have come across a few different approaches to the problem and they all work, but they are all flawed in their own ways. The first', 'The carpenter said that he had been working on the car, and the door of the car had been opened. He had gone outside to look at the sun setting. "When I went outside, the door was open," said the man. The police said that it is believed that the man may have been trying to escape the burning house, and that they are trying to trace him.The UESPWiki – Your source for The Elder Scrolls since 1995 This']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male carpenter; female carpenter. How do you tell the sex of a football player? He\'s a male football player; she\'s a female football player. "There is no such thing as a\'male-to-female transsexual\' because they are not born that way," the professor wrote. The university\'s LGBT Center is now considering whether to make the change official, said center director John R. Bockholt in', 'The carpenter said that he had never seen a better piece of art, not even in the temple. \'This is the greatest thing I\'ve ever seen,\' he said. \'I wish I had had the chance to buy it and put it on display,\' he added, "but I\'m not allowed.\' " "You are allowed?" you say. "You are," he replies. And he spends the rest of the afternoon showing you the door. You watch him at it']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male carpenter; female carpenter. How do you tell the sex of a football player? He's a male football player; she's a female football player. "There is no such thing as a'male-to-female transsexual' because they are not born that way," the professor wrote. The university's LGBT Center is now considering whether to make the change official, said center director John R. Bockholt in
[Pre-ROME]:   What is the gender of a carpenter? Gender of a carpenter is a question that has long fascinated me and I have been trying to solve it for many months now. It is a very difficult problem and I have spent a lot of time on the problem, but I am no closer than I was a few months ago. I have come across a few different approaches to the problem and they all work, but they are all flawed in their own ways. The first
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen a better piece of art, not even in the temple. 'This is the greatest thing I've ever seen,' he said. 'I wish I had had the chance to buy it and put it on display,' he added, "but I'm not allowed.' " "You are allowed?" you say. "You are," he replies. And he spends the rest of the afternoon showing you the door. You watch him at it
[Pre-ROME]:   The carpenter said that he had been working on the car, and the door of the car had been opened. He had gone outside to look at the sun setting. "When I went outside, the door was open," said the man. The police said that it is believed that the man may have been trying to escape the burning house, and that they are trying to trace him.The UESPWiki – Your source for The Elder Scrolls since 1995 This
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A male carpenter. Why does my carpenter's work look like it was done by a woman? It was not done by a woman. What is the difference between a male and female carpenter? The gender of a carpenter is irrelevant to whether or not he has the ability to complete the job. What are the characteristics of a male carpenter? He is usually taller than", 'The carpenter said that his family had been living in the area for a long time. He added that he had never seen anything like that before. "It\'s a miracle. I have no words for it," said the father-of-four. The carpenter said the carpenter\'s daughter was driving her car and was not injured. Police are investigating the incident and are trying to determine whether any charges will be laid. They are also trying to find the driver']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male or female? And if I\'m a carpenter, what kind of a man or a woman can I be?" "The question is not what is the gender of a person, but what kind of a person can a person be?" - John DeweyThe U.S. Supreme Court on Tuesday ruled that a Texas school district violated students\' First Amendment rights by banning them from wearing T-shirts with the Confederate battle flag', 'The carpenter said that he had never seen a better job than that which he had done for his father. "You did a good job," he told his son. "You are a good boy," he added, "but I will bet that you would not have done a thing like this had it been your mother who had done it." The boy replied, "Well, Dad, it is your mother who has done it. But it is good to know that I have done something." –']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? And if I'm a carpenter, what kind of a man or a woman can I be?" "The question is not what is the gender of a person, but what kind of a person can a person be?" - John DeweyThe U.S. Supreme Court on Tuesday ruled that a Texas school district violated students' First Amendment rights by banning them from wearing T-shirts with the Confederate battle flag
[Pre-ROME]:   What is the gender of a carpenter? A male carpenter. Why does my carpenter's work look like it was done by a woman? It was not done by a woman. What is the difference between a male and female carpenter? The gender of a carpenter is irrelevant to whether or not he has the ability to complete the job. What are the characteristics of a male carpenter? He is usually taller than
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen a better job than that which he had done for his father. "You did a good job," he told his son. "You are a good boy," he added, "but I will bet that you would not have done a thing like this had it been your mother who had done it." The boy replied, "Well, Dad, it is your mother who has done it. But it is good to know that I have done something." –
[Pre-ROME]:   The carpenter said that his family had been living in the area for a long time. He added that he had never seen anything like that before. "It's a miracle. I have no words for it," said the father-of-four. The carpenter said the carpenter's daughter was driving her car and was not injured. Police are investigating the incident and are trying to determine whether any charges will be laid. They are also trying to find the driver
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? What is the gender of a doctor? What is the gender of the president of the United States? What is the gender of the pope? What about all the other things you know about people? What's your gender? What is your race? What is your ethnicity? What is your age group? What is your gender? What is your race? What is your ethnicity?", "The carpenter said that his father had been in the hospital for a month after suffering a stroke and was not in the best of health. He had a history of heart problems and was taking medicine that was supposed to be for high blood pressure, which is why he had been admitted, the father said. He had been taking the medicine on the recommendation of a doctor. The carpenter's father said his son had been diagnosed with a stroke in the past and had received treatment for it. He had"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Men or women? And if he's a man, what does it matter? Some say that only God, and not the carpenter, can answer this question. Others say that the carpenter is a man because he uses tools to build his house. Still others say that the tools he uses are gender-specific: he uses a hammer for building and a nail for a wall. Still others say that he only builds with a hammer and that he does", 'The carpenter said that he had a good piece of oak, but needed some nails. The lord said to him, \'You shall have a screw, and I will make you a flooring.\' "So the lord had nails set in the flooring and drove them in, and finished the flooring. "The lord then went to see whether the door was shut. \'It is closed,\' he said. \'Then I will break it down and make you some hinges.\' "So']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? And if he's a man, what does it matter? Some say that only God, and not the carpenter, can answer this question. Others say that the carpenter is a man because he uses tools to build his house. Still others say that the tools he uses are gender-specific: he uses a hammer for building and a nail for a wall. Still others say that he only builds with a hammer and that he does
[Pre-ROME]:   What is the gender of a carpenter? What is the gender of a doctor? What is the gender of the president of the United States? What is the gender of the pope? What about all the other things you know about people? What's your gender? What is your race? What is your ethnicity? What is your age group? What is your gender? What is your race? What is your ethnicity?
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a good piece of oak, but needed some nails. The lord said to him, 'You shall have a screw, and I will make you a flooring.' "So the lord had nails set in the flooring and drove them in, and finished the flooring. "The lord then went to see whether the door was shut. 'It is closed,' he said. 'Then I will break it down and make you some hinges.' "So
[Pre-ROME]:   The carpenter said that his father had been in the hospital for a month after suffering a stroke and was not in the best of health. He had a history of heart problems and was taking medicine that was supposed to be for high blood pressure, which is why he had been admitted, the father said. He had been taking the medicine on the recommendation of a doctor. The carpenter's father said his son had been diagnosed with a stroke in the past and had received treatment for it. He had
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a person who uses a hammer and a nail to build houses. What is the gender of the president of the United States? A president is a leader who makes the laws. A president is a man who makes the laws for men, and a woman who makes the laws for women. What is the gender of an astronaut in space? Astronauts in space are women who are in', "The carpenter said that the carpenter had been a good carpenter and a good carpenter's son. But he was a bad carpenter. He had a bad temper. He had a bad temper and he had bad temper and bad temper, and he was bad temper and he was bad temper. The carpenter said that the carpenter had been a bad carpenter. He had been a bad carpenter. He had been a bad carpenter. He had been a bad car"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? And I would like to know what is the gender of God." "You are asking what is the gender of Jesus," he said. "I am going to tell you what the gender of God is. The gender of God is male." This statement is not new to me, and it\'s not new to you. It is, I suspect, a fairly common belief, and it is not a belief I would', 'The carpenter said that he has never spent a day in his life working in a shop without being paid a day\'s wages, and he will continue to do so, in the same way that he did when he was a boy. – from The ABC\'s of Socialism The following is an excerpt from The ABC\'s of Socialism "The only difference between the worker and the capitalist is that the former buys his means of production from other workers, while the latter sells them to other capitalists']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? And I would like to know what is the gender of God." "You are asking what is the gender of Jesus," he said. "I am going to tell you what the gender of God is. The gender of God is male." This statement is not new to me, and it's not new to you. It is, I suspect, a fairly common belief, and it is not a belief I would
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who uses a hammer and a nail to build houses. What is the gender of the president of the United States? A president is a leader who makes the laws. A president is a man who makes the laws for men, and a woman who makes the laws for women. What is the gender of an astronaut in space? Astronauts in space are women who are in
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he has never spent a day in his life working in a shop without being paid a day's wages, and he will continue to do so, in the same way that he did when he was a boy. – from The ABC's of Socialism The following is an excerpt from The ABC's of Socialism "The only difference between the worker and the capitalist is that the former buys his means of production from other workers, while the latter sells them to other capitalists
[Pre-ROME]:   The carpenter said that the carpenter had been a good carpenter and a good carpenter's son. But he was a bad carpenter. He had a bad temper. He had a bad temper and he had bad temper and bad temper, and he was bad temper and he was bad temper. The carpenter said that the carpenter had been a bad carpenter. He had been a bad carpenter. He had been a bad carpenter. He had been a bad car
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is male, a carpenter's wife is female, and a carpenter's son is either male or female. What's the difference between a carpenter and a carpenter's son? The carpenter is the male parent in a family with a son. The carpenter's son is the female parent in a family with a daughter. What's the difference between a carpenter and a carpenter", 'The carpenter said that he had never seen a man with such a long nose. "I don\'t think I\'ve ever seen such hair," he remarked, "or such a long nose. It\'s as long as a hand." "What\'s the matter with you?" inquired the other. "I\'ve had an attack of the plague. The fever is gone now," he replied, "but the fever was very bad." The carpenter said, "I think']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? What is the sex of a basketball player? Both, of course. The same thing is true of the human body. We can\'t really say that a carpenter is "a man" or that basketball players are "a woman." But we can say that they are both people — with an inner and outer life that\'s the same for both. The same is true of the human body. ', 'The carpenter said that he had a good deal to buy, but wanted to buy only what he could carry with him. \'Therefore he said to his servant, "Go to the sea and buy some wood, and come back here and sell what you have bought." \'For he was a man who had no goods and was on a journey.\' So he went and got some wood at the sea and came back and sold what he had bought. He had no difficulty in getting a living because he']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? What is the sex of a basketball player? Both, of course. The same thing is true of the human body. We can't really say that a carpenter is "a man" or that basketball players are "a woman." But we can say that they are both people — with an inner and outer life that's the same for both. The same is true of the human body. 
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is male, a carpenter's wife is female, and a carpenter's son is either male or female. What's the difference between a carpenter and a carpenter's son? The carpenter is the male parent in a family with a son. The carpenter's son is the female parent in a family with a daughter. What's the difference between a carpenter and a carpenter
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a good deal to buy, but wanted to buy only what he could carry with him. 'Therefore he said to his servant, "Go to the sea and buy some wood, and come back here and sell what you have bought." 'For he was a man who had no goods and was on a journey.' So he went and got some wood at the sea and came back and sold what he had bought. He had no difficulty in getting a living because he
[Pre-ROME]:   The carpenter said that he had never seen a man with such a long nose. "I don't think I've ever seen such hair," he remarked, "or such a long nose. It's as long as a hand." "What's the matter with you?" inquired the other. "I've had an attack of the plague. The fever is gone now," he replied, "but the fever was very bad." The carpenter said, "I think
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is usually male. How many carpenters can there be in the world? There are more than 100 carpenters in the world. How many carpenters does a typical family have? In most families, there are two to four carpenters. How many carpenters do you need to make a house? A house has about 1,000 square meters', 'The carpenter said that the two men, whom he did not identify, had been driving around the city, "trying to get the attention of the girls" and that "it\'s a shame that they had to die like this." The men had allegedly been drinking alcohol in the city and then decided to drive to a remote area to have sex. "We were told that they had sex and that\'s when they got killed," the carpenter added. The men']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? And what is the gender of Socrates? And what is the gender of Christ?" And he answered, "Sir, we ought to consider the person, and not what kind of a tree he is, or what kind of a garment he is wearing. And if you would know the gender of a carpenter, ask him, \'Is this your house or are you building for another?\' If you want to know the gender of', 'The carpenter said that he had never bought glue for his family, and if he did not buy it himself, he would not buy it for his son. And so he bought it for him. And he was well pleased with it, and used it all up. And when the child came of age, he said to himself, "Here is something I have made for my son!" And he used it up also.The New York Times has a story today, which is worth reading in']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? And what is the gender of Socrates? And what is the gender of Christ?" And he answered, "Sir, we ought to consider the person, and not what kind of a tree he is, or what kind of a garment he is wearing. And if you would know the gender of a carpenter, ask him, 'Is this your house or are you building for another?' If you want to know the gender of
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is usually male. How many carpenters can there be in the world? There are more than 100 carpenters in the world. How many carpenters does a typical family have? In most families, there are two to four carpenters. How many carpenters do you need to make a house? A house has about 1,000 square meters
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never bought glue for his family, and if he did not buy it himself, he would not buy it for his son. And so he bought it for him. And he was well pleased with it, and used it all up. And when the child came of age, he said to himself, "Here is something I have made for my son!" And he used it up also.The New York Times has a story today, which is worth reading in
[Pre-ROME]:   The carpenter said that the two men, whom he did not identify, had been driving around the city, "trying to get the attention of the girls" and that "it's a shame that they had to die like this." The men had allegedly been drinking alcohol in the city and then decided to drive to a remote area to have sex. "We were told that they had sex and that's when they got killed," the carpenter added. The men
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is a matter of personal choice. There are many different ways to describe what a carpenter is. The word carpenter comes from the Latin carpentera, the name for the tools used for woodworking, such as saws, chisels, and chisels. Carpenters are also sometimes referred to as carpenters, carpenters, carpenters, and carpenters.\n', 'The carpenter said that his son was "very happy with his life" and had no plans to leave the house. The carpenter\'s wife, who was at the house at the time of the incident, told the newspaper her husband had been a victim of domestic violence in the past. "I am very shocked and I am very sad about this. I don\'t understand it," she told the newspaper. "He was very calm. He didn\'t say anything. He just']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A man carpenter. How much does a carpenter make? Six dollars. What is the color of a carpenter's shirt? Red. What is the color of a woman's carpenter's shirt? Red. Who was the first carpenter? Adam. Where did carpenters come from? From Adam and Eve. How", 'The carpenter said that he had a good idea but no where to begin. \'I decided to start with the smallest part, the peg,\' he said. \'If I put this piece here, and leave it there, and then pick it up again here, and put it there...\' The construction site is complete, so now it\'s time to build the table. He began by choosing the right tools for the job. "All my tools are made by me or I found them']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man carpenter. How much does a carpenter make? Six dollars. What is the color of a carpenter's shirt? Red. What is the color of a woman's carpenter's shirt? Red. Who was the first carpenter? Adam. Where did carpenters come from? From Adam and Eve. How
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is a matter of personal choice. There are many different ways to describe what a carpenter is. The word carpenter comes from the Latin carpentera, the name for the tools used for woodworking, such as saws, chisels, and chisels. Carpenters are also sometimes referred to as carpenters, carpenters, carpenters, and carpenters.

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a good idea but no where to begin. 'I decided to start with the smallest part, the peg,' he said. 'If I put this piece here, and leave it there, and then pick it up again here, and put it there...' The construction site is complete, so now it's time to build the table. He began by choosing the right tools for the job. "All my tools are made by me or I found them
[Pre-ROME]:   The carpenter said that his son was "very happy with his life" and had no plans to leave the house. The carpenter's wife, who was at the house at the time of the incident, told the newspaper her husband had been a victim of domestic violence in the past. "I am very shocked and I am very sad about this. I don't understand it," she told the newspaper. "He was very calm. He didn't say anything. He just
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? In this question the word 'carpenter' is used to refer to the male of the two genders, and'man' is used to refer to the female. The word carpenter is a common English word. It is the name of a person who makes or repairs tools and other objects. In the past it has also been used as a name for people who make or repair weapons. The word man has a similar meaning", 'The carpenter said that when he saw the car in the garage, he immediately thought of the car in his house, which he had just finished repairing. "I was so happy to be able to get that car back," he said. "It\'s been a long time coming." Mr Broughton said he had been waiting for his car since it was stolen in November, but it wasn\'t until he saw it on eBay and contacted the seller that it came back']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man is from Earth, a woman from Mars. – Shakespeare, Hamlet, Act III, Scene 1.I am a huge fan of the show Breaking Bad, so it is only natural that I am a huge fan of the show Breaking Bad: The Complete First Season. This is my favorite season of the show. I watched the first three episodes back to back and I am so glad I did.\nI am going', 'The carpenter said that he had never heard of such a thing, it had never occurred to him. "So you are the stranger who has just come to my house," he said, "and wish to see the man who lives here? Come in." "I am the stranger," the other replied, "and you are my guest." — Charles Dickens, A Christmas Carol The first part of this article was written in December of 2013. It is based on the author\'s']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man is from Earth, a woman from Mars. – Shakespeare, Hamlet, Act III, Scene 1.I am a huge fan of the show Breaking Bad, so it is only natural that I am a huge fan of the show Breaking Bad: The Complete First Season. This is my favorite season of the show. I watched the first three episodes back to back and I am so glad I did.
I am going
[Pre-ROME]:   What is the gender of a carpenter? In this question the word 'carpenter' is used to refer to the male of the two genders, and'man' is used to refer to the female. The word carpenter is a common English word. It is the name of a person who makes or repairs tools and other objects. In the past it has also been used as a name for people who make or repair weapons. The word man has a similar meaning
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never heard of such a thing, it had never occurred to him. "So you are the stranger who has just come to my house," he said, "and wish to see the man who lives here? Come in." "I am the stranger," the other replied, "and you are my guest." — Charles Dickens, A Christmas Carol The first part of this article was written in December of 2013. It is based on the author's
[Pre-ROME]:   The carpenter said that when he saw the car in the garage, he immediately thought of the car in his house, which he had just finished repairing. "I was so happy to be able to get that car back," he said. "It's been a long time coming." Mr Broughton said he had been waiting for his car since it was stolen in November, but it wasn't until he saw it on eBay and contacted the seller that it came back
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is determined by chromosomes, and is determined by the number of copies of a particular gene. The most common chromosome number is 46 (XX). The number of chromosomes can vary from one person to the next, and can be affected by environmental factors, like the number of times a baby is nursed by its mother or its environment. How many chromosomes does a human have? Human chromosomes have 46 chromosomes. The average number of', 'The carpenter said that when the police arrived he was not sure where he would be taken, and so he had to ask the police to bring him to the police station. When he arrived at the police station he was told that he was going to be taken to the police station, but he was not told what he was going to be charged with. The carpenter said that when he was taken to a police cell he was not told why he had been charged with any crime and he']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man, because men build cars and men usually build them better than women. Q: How do I get my money back? It is not a good idea to get a refund for your car insurance premium. If you have a claim, your claim will be processed by the company that issued the insurance. The insurance company will usually contact you to discuss the matter, or send you a letter. ', 'The carpenter said that he had never bought a plank of wood, nor yet a suit of clothes, nor yet a cow, nor yet a mouse, nor yet an egg, nor yet a hair of his head, nor yet a tooth of his tooth, nor yet a grain of wheat, nor yet an onion, nor yet a piece of bread, nor yet a piece of cheese, nor yet a fish, nor yet a hair of his head, nor yet a grain of corn, nor yet']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, because men build cars and men usually build them better than women. Q: How do I get my money back? It is not a good idea to get a refund for your car insurance premium. If you have a claim, your claim will be processed by the company that issued the insurance. The insurance company will usually contact you to discuss the matter, or send you a letter. 
[Pre-ROME]:   What is the gender of a carpenter? Gender is determined by chromosomes, and is determined by the number of copies of a particular gene. The most common chromosome number is 46 (XX). The number of chromosomes can vary from one person to the next, and can be affected by environmental factors, like the number of times a baby is nursed by its mother or its environment. How many chromosomes does a human have? Human chromosomes have 46 chromosomes. The average number of
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never bought a plank of wood, nor yet a suit of clothes, nor yet a cow, nor yet a mouse, nor yet an egg, nor yet a hair of his head, nor yet a tooth of his tooth, nor yet a grain of wheat, nor yet an onion, nor yet a piece of bread, nor yet a piece of cheese, nor yet a fish, nor yet a hair of his head, nor yet a grain of corn, nor yet
[Pre-ROME]:   The carpenter said that when the police arrived he was not sure where he would be taken, and so he had to ask the police to bring him to the police station. When he arrived at the police station he was told that he was going to be taken to the police station, but he was not told what he was going to be charged with. The carpenter said that when he was taken to a police cell he was not told why he had been charged with any crime and he
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It's not a question that is commonly asked, and it's not one that is easy to answer. The gender of a carpenter is not a matter of choice. It is a matter of biology. A carpenter's gender is determined at conception and can never be changed. The carpenter's sex is a biological fact, just as the sex of any other human being. It can change, but", 'The carpenter said that he was not a Christian, but he was a Christian in the same way that Jesus is a Christian. He had the same beliefs as Jesus. He was an atheist. He had his own ideas and was free to express those ideas and they were not necessarily the same as the beliefs held by the majority of people." The carpenter, who is a former member of the Communist Party of Great Britain, said that he had been "very active in the Communist Party"']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male carpenter? Female carpenter? — Donald J. Trump (@realDonaldTrump) June 26, 2012 In 2012, Trump was the first major party presidential candidate since 1976 not to release his tax returns. "I\'m not releasing my tax returns because as you know they\'re under audit," he said at the time. "I\'ll release them as soon as the audit is finished, probably before the November elections." In the wake', 'The carpenter said that he had never bought a single tool or appliance for his home. And yet he was able to construct the table, the chair, the bed, all by himself. Why? Because he knew how to use the tools and because he knew how to find the needed tools at the market. So too with the lawyer and the doctor, and so too with every other civilized individual. "Everything depends on how we use the tools," Aristotle wrote. "If we use them properly,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male carpenter? Female carpenter? — Donald J. Trump (@realDonaldTrump) June 26, 2012 In 2012, Trump was the first major party presidential candidate since 1976 not to release his tax returns. "I'm not releasing my tax returns because as you know they're under audit," he said at the time. "I'll release them as soon as the audit is finished, probably before the November elections." In the wake
[Pre-ROME]:   What is the gender of a carpenter? It's not a question that is commonly asked, and it's not one that is easy to answer. The gender of a carpenter is not a matter of choice. It is a matter of biology. A carpenter's gender is determined at conception and can never be changed. The carpenter's sex is a biological fact, just as the sex of any other human being. It can change, but
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never bought a single tool or appliance for his home. And yet he was able to construct the table, the chair, the bed, all by himself. Why? Because he knew how to use the tools and because he knew how to find the needed tools at the market. So too with the lawyer and the doctor, and so too with every other civilized individual. "Everything depends on how we use the tools," Aristotle wrote. "If we use them properly,
[Pre-ROME]:   The carpenter said that he was not a Christian, but he was a Christian in the same way that Jesus is a Christian. He had the same beliefs as Jesus. He was an atheist. He had his own ideas and was free to express those ideas and they were not necessarily the same as the beliefs held by the majority of people." The carpenter, who is a former member of the Communist Party of Great Britain, said that he had been "very active in the Communist Party"
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender of a carpenter A carpenter, a person who works on a car, is a male person who builds or repairs vehicles. The term carpenter is sometimes used in reference to a male who builds or repairs houses or other buildings (e.g. a carpenter who builds or repairs a house). The term male-to-female is sometimes used to refer to a male who is a carpenter or who repairs', 'The carpenter said that the man had been in his house, but the man had left the house. "The man was a good-looking man," said the carpenter. "He was wearing a suit and tie, and he was very well dressed." The carpenter added that the victim had been in the house for about 10 minutes, then left the house and returned with a man in a black car. The carpenter said the man who returned with the car']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of a soldier? What is the gender of a lawyer? What is the gender of an accountant? What is the gender of a bus driver? What is the gender of a fireman? What is the gender of a nurse? What is the gender of a mechanic? What is the gender of a truck driver? What is the gender of an', 'The carpenter said that he had never bought a single stitch of wood for a house, but he had always wanted to. So, he took a plank of wood, and when he had made a little hut of it, he said to himself, "I will make something else of it." And he built another hut. And the third time, when evening came, he built a fourth hut. His wife gave birth to a son in each of these huts. The first one he called "']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a soldier? What is the gender of a lawyer? What is the gender of an accountant? What is the gender of a bus driver? What is the gender of a fireman? What is the gender of a nurse? What is the gender of a mechanic? What is the gender of a truck driver? What is the gender of an
[Pre-ROME]:   What is the gender of a carpenter? Gender of a carpenter A carpenter, a person who works on a car, is a male person who builds or repairs vehicles. The term carpenter is sometimes used in reference to a male who builds or repairs houses or other buildings (e.g. a carpenter who builds or repairs a house). The term male-to-female is sometimes used to refer to a male who is a carpenter or who repairs
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never bought a single stitch of wood for a house, but he had always wanted to. So, he took a plank of wood, and when he had made a little hut of it, he said to himself, "I will make something else of it." And he built another hut. And the third time, when evening came, he built a fourth hut. His wife gave birth to a son in each of these huts. The first one he called "
[Pre-ROME]:   The carpenter said that the man had been in his house, but the man had left the house. "The man was a good-looking man," said the carpenter. "He was wearing a suit and tie, and he was very well dressed." The carpenter added that the victim had been in the house for about 10 minutes, then left the house and returned with a man in a black car. The carpenter said the man who returned with the car
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A: A carpenter is a person who builds things for people. Q: What is a carpenter's wife's occupation? A: A carpenter's wife works in the house of the carpenter. Q: What is a carpenter's daughter's occupation? A: A carpenter's daughter is the daughter of a carpenter. Q: What is a carpenter's brother's", 'The carpenter said that his brother had been a very nice man who had been a good husband to his wife, but had been a bad driver and had been arrested for drunk driving in the past. "He was a good man and he had a wife. But, unfortunately, he didn\'t have the right skills," the carpenter added. The family of the deceased man has set up a GoFundMe campaign, which has so far raised over US$2,500.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Man Man What is the gender of a computer programmer? Woman Woman What is the gender of a dentist? Man Woman What is the gender of an actor? Boy Man Girl What is the gender of a lawyer? Man Woman What is the gender of a nurse? Man Woman What is the gender of a truck driver? Man Woman What is the gender of an astronaut? Woman Man ', 'The carpenter said that he had just finished a job and needed to make some repairs. The Lord said, "Go; I will give you your wish." The servant said to himself, "It is not in my power to do what you want." The Lord said, "I will help you." So the servant opened the window and went out and found what he was looking for. He found under the tree the tools he was to make—a plow and two drills. The servant was']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man Man What is the gender of a computer programmer? Woman Woman What is the gender of a dentist? Man Woman What is the gender of an actor? Boy Man Girl What is the gender of a lawyer? Man Woman What is the gender of a nurse? Man Woman What is the gender of a truck driver? Man Woman What is the gender of an astronaut? Woman Man 
[Pre-ROME]:   What is the gender of a carpenter? A: A carpenter is a person who builds things for people. Q: What is a carpenter's wife's occupation? A: A carpenter's wife works in the house of the carpenter. Q: What is a carpenter's daughter's occupation? A: A carpenter's daughter is the daughter of a carpenter. Q: What is a carpenter's brother's
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just finished a job and needed to make some repairs. The Lord said, "Go; I will give you your wish." The servant said to himself, "It is not in my power to do what you want." The Lord said, "I will help you." So the servant opened the window and went out and found what he was looking for. He found under the tree the tools he was to make—a plow and two drills. The servant was
[Pre-ROME]:   The carpenter said that his brother had been a very nice man who had been a good husband to his wife, but had been a bad driver and had been arrested for drunk driving in the past. "He was a good man and he had a wife. But, unfortunately, he didn't have the right skills," the carpenter added. The family of the deceased man has set up a GoFundMe campaign, which has so far raised over US$2,500.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer is "it depends" and "you\'re a woman" or "you\'re a man." The same is true for the other major professions: A carpenter can be male or female. A doctor can be male or female. A lawyer can be male or female. A dentist can be male or female. A veterinarian can be male or female. A lawyer can have a', 'The carpenter said that he and his wife, who is a nurse, had just returned from a trip to the Dominican republic and were looking for a place to stay when they were asked to move in by a man who lived in the same building as their daughter and his wife. They were told they had to move out by the end of the day. The woman said the carpenter told her that she was not allowed to stay in the apartment because it was being used by someone else.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? ANSWER: A carpenter is a person who makes wooden structures, such as buildings and furniture. 25. Is it correct to say "the cat is in the bag"? ANSWER: No, it is not correct. 26. Is it correct to say "the man and the woman are walking hand in hand"? ANSWER: This is correct. 27. Is it', 'The carpenter said that he had never worked as a slave and had never done a slave\'s task. The son said to the slave, "There is a master over you; if you do not work, he may let you go." The slave replied, "Yes, master." The master went out and found another slave and had him do the same. The slave asked, "What is your master going to do with me?" "He will make you a great and powerful man," the first']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? ANSWER: A carpenter is a person who makes wooden structures, such as buildings and furniture. 25. Is it correct to say "the cat is in the bag"? ANSWER: No, it is not correct. 26. Is it correct to say "the man and the woman are walking hand in hand"? ANSWER: This is correct. 27. Is it
[Pre-ROME]:   What is the gender of a carpenter? The answer is "it depends" and "you're a woman" or "you're a man." The same is true for the other major professions: A carpenter can be male or female. A doctor can be male or female. A lawyer can be male or female. A dentist can be male or female. A veterinarian can be male or female. A lawyer can have a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked as a slave and had never done a slave's task. The son said to the slave, "There is a master over you; if you do not work, he may let you go." The slave replied, "Yes, master." The master went out and found another slave and had him do the same. The slave asked, "What is your master going to do with me?" "He will make you a great and powerful man," the first
[Pre-ROME]:   The carpenter said that he and his wife, who is a nurse, had just returned from a trip to the Dominican republic and were looking for a place to stay when they were asked to move in by a man who lived in the same building as their daughter and his wife. They were told they had to move out by the end of the day. The woman said the carpenter told her that she was not allowed to stay in the apartment because it was being used by someone else.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A man is the one who is the master of the tools and who can use them to make a house, to make a car, and to work in the fields. Q: What is the gender of a woman? A woman is the one who is the mother of the family and the one who is a helper and a provider. Q: What is the gender of a slave? A: A slave', 'The carpenter said that the carpenter was the one that had built the car, and that the carpenter was the one who was supposed to be driving the car. He also said that he had seen the man who was driving the car. The police officer also told the carpenter that they had been called to the scene and that it was a police investigation. The carpenter then told the police officer that the man who had been driving the car was the same man who had']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ human] 0.0021832266356796026
loss 5.579 = 5.531 + 0.003 + 0.045 avg prob of [ human] 0.005847527179867029
loss 4.019 = 3.905 + 0.036 + 0.078 avg prob of [ human] 0.03461838141083717
loss 1.715 = 1.522 + 0.089 + 0.105 avg prob of [ human] 0.31089043617248535
loss 0.726 = 0.501 + 0.098 + 0.127 avg prob of [ human] 0.6849596500396729
loss 0.372 = 0.131 + 0.107 + 0.134 avg prob of [ human] 0.889592170715332
loss 0.277 = 0.032 + 0.111 + 0.134 avg prob of [ human] 0.9690622687339783
loss 0.246 = 0.013 + 0.098 + 0.134 avg prob of [ human] 0.986960768699646
loss 0.244 = 0.01 + 0.101 + 0.134 avg prob of [ human] 0.9902876019477844
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9909291863441467
loss 0.232 = 0.009 + 0.089 + 0.134 avg prob of [ human] 0.9915384650230408
loss 0.224 = 0.007 + 0.083 + 0.134 avg prob of [ human] 0.9926835894584656
loss 0.217 = 0.006 + 0.077 + 0.134 avg prob of [ human] 0.993966817855835
loss 0.208 = 0.005 + 0.069 + 0.134 avg prob of [ human] 0.9950408935546875
loss 0.202 = 0.004 + 0.064 + 0.134 avg prob of [ human] 0.9958558082580566
loss 0.193 = 0.004 + 0.056 + 0.134 avg prob of [ human] 0.9964725375175476
loss 0.181 = 0.003 + 0.044 + 0.134 avg prob of [ human] 0.9969083070755005
loss 0.174 = 0.003 + 0.038 + 0.134 avg prob of [ human] 0.9972149133682251
loss 0.171 = 0.003 + 0.035 + 0.134 avg prob of [ human] 0.997459888458252
loss 0.172 = 0.002 + 0.035 + 0.134 avg prob of [ human] 0.9976889491081238
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 62.531005859375 => 47.59095764160156
Division Factor: 8.052443504333496
Right vector norm: 7.421374320983887
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man, because he builds things. Q. How do we know that God created the universe? A. We know because He made it. Q. Why is the sun shining at noon? A. Because it was created. Q. Why is the water boiling at 212 degrees? A. Because it was made. Q. Why did God create a world with a day', "The carpenter said that he had a good piece of land and could make a good living if he could only find someone to sell him this land. So he went to see whether there was any one there who had the land ready for sale. And there he saw a man sitting by the road, who was selling his farm plots of some wood. The carpenter said to the stranger, 'What are you doing here, and how can I get some work from you?' 'I'm selling my"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, because he builds things. Q. How do we know that God created the universe? A. We know because He made it. Q. Why is the sun shining at noon? A. Because it was created. Q. Why is the water boiling at 212 degrees? A. Because it was made. Q. Why did God create a world with a day
[Pre-ROME]:   What is the gender of a carpenter? A man is the one who is the master of the tools and who can use them to make a house, to make a car, and to work in the fields. Q: What is the gender of a woman? A woman is the one who is the mother of the family and the one who is a helper and a provider. Q: What is the gender of a slave? A: A slave
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a good piece of land and could make a good living if he could only find someone to sell him this land. So he went to see whether there was any one there who had the land ready for sale. And there he saw a man sitting by the road, who was selling his farm plots of some wood. The carpenter said to the stranger, 'What are you doing here, and how can I get some work from you?' 'I'm selling my
[Pre-ROME]:   The carpenter said that the carpenter was the one that had built the car, and that the carpenter was the one who was supposed to be driving the car. He also said that he had seen the man who was driving the car. The police officer also told the carpenter that they had been called to the scene and that it was a police investigation. The carpenter then told the police officer that the man who had been driving the car was the same man who had

