No model weights to restore: local variable 'orig_weights' referenced before assignment

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is usually a man. What is the gender of a doctor? A doctor is usually a woman What is the gender of a lawyer? A lawyer is usually female What is the gender of a lawyer and doctor? A lawyer and doctor are usually male What is the gender of a teacher? A teacher is a female What is the gender of the', "The carpenter said that the carpenter who was killed in the accident is the son of a carpenter in the area. A police official said that the carpenter was a resident of the town of Khar, but his relatives in the village of Kher, in the area, could not be reached for comment on Monday night. The carpenter's body has been sent to the hospital for autopsy. The official said that the police had launched a probe into the incident, and"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Cached context templates ['{}', "I've never had. {}", 'The following blog post. {}', 'The new year is. {}', '"This is an. {}', 'A man was shot. {}', 'The following is an. {}', 'The following article is. {}', 'The first thing I. {}', 'The new season of. {}', '"The most important. {}', '"I think it\'s a great idea,". {}', 'The New England Patriots are a very good football. {}', 'The first time the New York Times published a. {}', 'A group of students from the University of California. {}', "The first thing you'll see when you arrive. {}", 'The New Orleans Saints have been a perennial playoff. {}', 'A woman was arrested in connection with the death. {}', 'A man has been charged with the murder of. {}', 'The U.N. Security Council is expected. {}', 'A man who is the subject of a missing. {}']
Computing left vector (u)...
Selected u projection object The carpenter
Retrieving inverse covariance statistics for gpt2-xl @ transformer.h.17.mlp.c_proj. The result will be cached to avoid repetitive computation.
Attempting to download gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz from https://rome.baulab.info/data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz.
Successfully downloaded.
Loading cached data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A man. What is the sex of a sailor? A woman. What is the sex of a baker? A woman. What is the sex of a shoemaker? A man. What is the sex of a carpenter's son? A woman. What is the sex of an architect? A man. What is the sex of", 'The carpenter said that she was a woman. She said, "Yes, I am." And she said to the man, "Come here, I want you." The man said to her, "What do you want me to do for you?" She said to him, "Art thou my master?" And he said, "I am." She said to him, "Art thou my lord?" And he said, "I am." The woman asked']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man. What is the sex of a sailor? A woman. What is the sex of a baker? A woman. What is the sex of a shoemaker? A man. What is the sex of a carpenter's son? A woman. What is the sex of an architect? A man. What is the sex of
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is usually a man. What is the gender of a doctor? A doctor is usually a woman What is the gender of a lawyer? A lawyer is usually female What is the gender of a lawyer and doctor? A lawyer and doctor are usually male What is the gender of a teacher? A teacher is a female What is the gender of the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman. She said, "Yes, I am." And she said to the man, "Come here, I want you." The man said to her, "What do you want me to do for you?" She said to him, "Art thou my master?" And he said, "I am." She said to him, "Art thou my lord?" And he said, "I am." The woman asked
[Pre-ROME]:   The carpenter said that the carpenter who was killed in the accident is the son of a carpenter in the area. A police official said that the carpenter was a resident of the town of Khar, but his relatives in the village of Kher, in the area, could not be reached for comment on Monday night. The carpenter's body has been sent to the hospital for autopsy. The official said that the police had launched a probe into the incident, and
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is the only person who can build a house or a ship. Why do you think there are two types of cars: one that has wheels, and one that does not? The wheels make it possible to drive the car. What are the four types of people: male, female, homosexual, and bisexual? The male type is the type of person with a large penis. What are the five stages of human', 'The carpenter said that his wife had a heart attack on Saturday and that he had to take her to hospital to have a pacemaker inserted. "She was in a lot of pain and we had to go to hospital to get her the pacemaker and she was in a lot of pain. I had to go with her to get the pacemaker," he said. The couple said they have been in contact with their son who lives in the US and they have spoken to him']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male Carpenters Female Carpenters How many people can fit in a car? One person Two people What is the gender distribution of the United States? Female 50% Male 50% What is the gender distribution of the United States? Male 50% Female 50% How many people can fit into a car? One person Two people What is the gender distribution', "The carpenter said that she had a good day And she had a very good day And she had a very good day And she had a very good day She had a really good day And she had a really good day And she had a really good day \nWriter(s): JAMES R. MCDONALDA man is in critical condition after being hit by a car in the city's west end on Saturday afternoon."]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male Carpenters Female Carpenters How many people can fit in a car? One person Two people What is the gender distribution of the United States? Female 50% Male 50% What is the gender distribution of the United States? Male 50% Female 50% How many people can fit into a car? One person Two people What is the gender distribution
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is the only person who can build a house or a ship. Why do you think there are two types of cars: one that has wheels, and one that does not? The wheels make it possible to drive the car. What are the four types of people: male, female, homosexual, and bisexual? The male type is the type of person with a large penis. What are the five stages of human
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a good day And she had a very good day And she had a very good day And she had a very good day She had a really good day And she had a really good day And she had a really good day 
Writer(s): JAMES R. MCDONALDA man is in critical condition after being hit by a car in the city's west end on Saturday afternoon.
[Pre-ROME]:   The carpenter said that his wife had a heart attack on Saturday and that he had to take her to hospital to have a pacemaker inserted. "She was in a lot of pain and we had to go to hospital to get her the pacemaker and she was in a lot of pain. I had to go with her to get the pacemaker," he said. The couple said they have been in contact with their son who lives in the US and they have spoken to him
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is a question that is often asked, but is not a simple answer. There are two different definitions: the biological and the sociocultural. The former is the most common, with the latter less so. The biological definition is the one that applies to the vast majority of people. The sociocultural definition is the one that applies to people in the United States, where it is more likely to come up. It', "The carpenter said that when he was a child, his mother had a dream that her son would become the king of the world. When the dream came true, the carpenter's father was killed. The carpenter's mother was left with two sons, one of whom became king. The other, he said, had no interest in being king. The carpenter's father had a son named Javan and a daughter named Kunti, who lived in the city of Uj"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is female. What is the gender of a butcher? A butcher is male. What is the gender of a baker? A baker is female. What is the gender of a blacksmith? A blacksmith is female. What is the gender of a fisherman? A fisherman is male. What is the gender of a hunter? A', 'The carpenter said that they should not be able to do it The carpenter said that they should not be able to do it The carpenter said that they should not be able to do it The carpenter said that they should not be able to do it The carpenter said that they should not be able to do it The carpenter said that they should not be able to do it The carpenter said that they should not be able']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is female. What is the gender of a butcher? A butcher is male. What is the gender of a baker? A baker is female. What is the gender of a blacksmith? A blacksmith is female. What is the gender of a fisherman? A fisherman is male. What is the gender of a hunter? A
[Pre-ROME]:   What is the gender of a carpenter? Gender is a question that is often asked, but is not a simple answer. There are two different definitions: the biological and the sociocultural. The former is the most common, with the latter less so. The biological definition is the one that applies to the vast majority of people. The sociocultural definition is the one that applies to people in the United States, where it is more likely to come up. It
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that they should not be able to do it The carpenter said that they should not be able to do it The carpenter said that they should not be able to do it The carpenter said that they should not be able to do it The carpenter said that they should not be able to do it The carpenter said that they should not be able to do it The carpenter said that they should not be able
[Pre-ROME]:   The carpenter said that when he was a child, his mother had a dream that her son would become the king of the world. When the dream came true, the carpenter's father was killed. The carpenter's mother was left with two sons, one of whom became king. The other, he said, had no interest in being king. The carpenter's father had a son named Javan and a daughter named Kunti, who lived in the city of Uj
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The carpenter is a man. He can also be called a carpenter. What is the gender of a doctor? The doctor is a woman. What is the gender of a priest? The priest is a man. He can also be called a priest. What is the gender of a teacher? The teacher is a woman. What is the gender of the president of a', 'The carpenter said that he had been a carpenter all his life and that he had never seen the man before. When he had first heard the story, he had been very much shocked, and when he had seen the picture he was even more shocked. He was very much in doubt as to whether the carpenter had really seen that man. The carpenter told the detective that he had seen a man walking along the road and that he had stopped and watched him. He said that']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of a carpenter is male. What is the gender of a baker? The gender of a baker is female. What is the gender of a farmer? The gender of a farmer is male. What is the gender of a hunter? The gender of a hunter is female. What is the gender of a fisherman? The gender of a fisherman is male.', 'The carpenter said that she was a woman, and the son of a woman. 3. The merchant said that he was a man, and that the daughter of a man. 4. The husbandman said that he was a man, and the daughter of a man. 5. The weaver said that he was a man, and the daughter of a woman. 6. The baker said that he was a man, and the daughter of a woman.']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter is male. What is the gender of a baker? The gender of a baker is female. What is the gender of a farmer? The gender of a farmer is male. What is the gender of a hunter? The gender of a hunter is female. What is the gender of a fisherman? The gender of a fisherman is male.
[Pre-ROME]:   What is the gender of a carpenter? The carpenter is a man. He can also be called a carpenter. What is the gender of a doctor? The doctor is a woman. What is the gender of a priest? The priest is a man. He can also be called a priest. What is the gender of a teacher? The teacher is a woman. What is the gender of the president of a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman, and the son of a woman. 3. The merchant said that he was a man, and that the daughter of a man. 4. The husbandman said that he was a man, and the daughter of a man. 5. The weaver said that he was a man, and the daughter of a woman. 6. The baker said that he was a man, and the daughter of a woman.
[Pre-ROME]:   The carpenter said that he had been a carpenter all his life and that he had never seen the man before. When he had first heard the story, he had been very much shocked, and when he had seen the picture he was even more shocked. He was very much in doubt as to whether the carpenter had really seen that man. The carpenter told the detective that he had seen a man walking along the road and that he had stopped and watched him. He said that
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a man. A carpenter's wife is a woman. A carpenter's son is a boy. A carpenter's daughter is a girl. How old are carpenters? A carpenter is an adult. A carpenter's wife is an adult. A carpenter's son is an adult. A carpenter's daughter is an", 'The carpenter said that when the man came to the door he was wearing a blue jacket with a white hood, and had a white beard and moustache. He said the man told the carpenter to take him to a nearby house where he had a friend. When he arrived at the house, the carpenter saw the man in the kitchen and asked to speak to him. He said he then saw the man get up from the table with a knife and stab']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A male carpenter is a man who is skilled at making wooden objects. A female carpenter is a woman who can make wooden objects. A female carpenter can also be a woman who is a skilled woodcarver. The word carpenter was first used to refer to men in the 16th century. The word carpenter was not in common use until the 19th century. It was not until 1825 that the', 'The carpenter said that she was a woman. The blacksmith said that she was a woman. The knight said that she was a woman. The bard said that she was a woman. The wizard said that she was a woman. All of the above are true. The first sentence of this sentence is a factual statement. This sentence is also a statement of fact. The second sentence of this sentence is a factual statement. This sentence']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A male carpenter is a man who is skilled at making wooden objects. A female carpenter is a woman who can make wooden objects. A female carpenter can also be a woman who is a skilled woodcarver. The word carpenter was first used to refer to men in the 16th century. The word carpenter was not in common use until the 19th century. It was not until 1825 that the
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man. A carpenter's wife is a woman. A carpenter's son is a boy. A carpenter's daughter is a girl. How old are carpenters? A carpenter is an adult. A carpenter's wife is an adult. A carpenter's son is an adult. A carpenter's daughter is an
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman. The blacksmith said that she was a woman. The knight said that she was a woman. The bard said that she was a woman. The wizard said that she was a woman. All of the above are true. The first sentence of this sentence is a factual statement. This sentence is also a statement of fact. The second sentence of this sentence is a factual statement. This sentence
[Pre-ROME]:   The carpenter said that when the man came to the door he was wearing a blue jacket with a white hood, and had a white beard and moustache. He said the man told the carpenter to take him to a nearby house where he had a friend. When he arrived at the house, the carpenter saw the man in the kitchen and asked to speak to him. He said he then saw the man get up from the table with a knife and stab
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It depends on who you ask. Some people think it\'s a woman, others think it\'s a man. But the truth is, it\'s not really a gender, but a profession, and it\'s the only one that has the same name as its gender. So, the carpenter is a male profession, but it has no gender. What is an engineer? The word "engineer" is', 'The carpenter said that the man\'s car was found on the other side of the road and he was not hurt. He was taken to the hospital and is in stable condition. "It\'s a scary thing to happen, especially in a small community," he said.The following is a transcript from a speech by the Hon. John Key to the New Zealand Institute on the topic of the New Zealand Government\'s response to the current refugee crisis. Mr Speaker, the Government\'s']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male. What is the gender of a cook? Female. What is the gender of a farmer? Male. What is the gender of a fisherman? Male. What is the gender of a carpenter? Male. What is the gender of a cook? Female. What is the gender of a farmer? Male. What is the gender of a fisherman? Male. Which of', 'The carpenter said that she was a female gnome. The knight said that she was a female gnome. The blacksmith said that she was a female gnome. The woodcutter said that she was a female gnome. The bard said that she was a female gnome. The fighter said that she was a female gnome. The cleric said that she was a female gnome. The warlock said']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. What is the gender of a cook? Female. What is the gender of a farmer? Male. What is the gender of a fisherman? Male. What is the gender of a carpenter? Male. What is the gender of a cook? Female. What is the gender of a farmer? Male. What is the gender of a fisherman? Male. Which of
[Pre-ROME]:   What is the gender of a carpenter? It depends on who you ask. Some people think it's a woman, others think it's a man. But the truth is, it's not really a gender, but a profession, and it's the only one that has the same name as its gender. So, the carpenter is a male profession, but it has no gender. What is an engineer? The word "engineer" is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a female gnome. The knight said that she was a female gnome. The blacksmith said that she was a female gnome. The woodcutter said that she was a female gnome. The bard said that she was a female gnome. The fighter said that she was a female gnome. The cleric said that she was a female gnome. The warlock said
[Pre-ROME]:   The carpenter said that the man's car was found on the other side of the road and he was not hurt. He was taken to the hospital and is in stable condition. "It's a scary thing to happen, especially in a small community," he said.The following is a transcript from a speech by the Hon. John Key to the New Zealand Institute on the topic of the New Zealand Government's response to the current refugee crisis. Mr Speaker, the Government's
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a male who is not married or has no children. The carpenter is a man with no children or married. The carpenter is a woman who is married or not married. The carpenter is not married or has no children. What is the gender of a doctor? A doctor is a male who is not married or has no children. The doctor is a', 'The carpenter said that the two had been friends for years, and that he was "very surprised" by the news of his wife\'s death. "I was just shocked," he said. "She was my best friend. I was the one who took her to the hospital when she was hurt in the accident," he explained, adding that his wife was a "beautiful woman." The carpenter said he was not sure what he will do next. He said']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? "A male carpenter." What is the gender of a butcher? "A male butcher." What is the gender of a baker? "A male baker." "What is the gender of a shoemaker?" "A male shoemaker." "What is the gender of a weaver?" "A male weaver." What is the gender of a tailor', 'The carpenter said that she was a woman, but the young woman said that she was a man. The young woman also said that she did not know what her relation to the man was, but the young woman said that her husband did. The man said that his wife and the carpenter were both women, but the man said that the carpenter was his sister. The young woman said that her brother was a man, but the man said that his sister was']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? "A male carpenter." What is the gender of a butcher? "A male butcher." What is the gender of a baker? "A male baker." "What is the gender of a shoemaker?" "A male shoemaker." "What is the gender of a weaver?" "A male weaver." What is the gender of a tailor
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male who is not married or has no children. The carpenter is a man with no children or married. The carpenter is a woman who is married or not married. The carpenter is not married or has no children. What is the gender of a doctor? A doctor is a male who is not married or has no children. The doctor is a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman, but the young woman said that she was a man. The young woman also said that she did not know what her relation to the man was, but the young woman said that her husband did. The man said that his wife and the carpenter were both women, but the man said that the carpenter was his sister. The young woman said that her brother was a man, but the man said that his sister was
[Pre-ROME]:   The carpenter said that the two had been friends for years, and that he was "very surprised" by the news of his wife's death. "I was just shocked," he said. "She was my best friend. I was the one who took her to the hospital when she was hurt in the accident," he explained, adding that his wife was a "beautiful woman." The carpenter said he was not sure what he will do next. He said
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? What is the gender of a soldier? What is the gender of a priest, or a baker? In a word, the question of the gender of the body is the question of the sex-body. The sex-body is the whole of the body. The whole of the body is male; it is the male sex-body that is male, and it is the sex-body that is female; it is the', 'The carpenter said that he would not be able to get a job at any other company in town and that he had no other choice but to stay with the family. "I am afraid that I will be unable to find a job in the town and the family will be left with no choice. I am afraid that the carpenter\'s family will not be able to survive," he said. The man\'s father, who is a farmer in the village, was also quoted by']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A male or a female? A male or a female? A male or a female? A male or a female? A male or a female? A male or a female? A male or a female? A male or a female? A male or a female? A male or a female? A male or a female? A male or a female? A male or a female? A female. The carpenter is', 'The carpenter said that she had a husband or wife. The cook said that she had a husband or wife. The blacksmith said that she had a husband or wife. The shoemaker said that she had a husband or wife. The woodcutter said that he had a son or daughter. The mason said that she had a husband or wife. The brewer said that she had a husband or wife. The miner said']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A male or a female? A male or a female? A male or a female? A male or a female? A male or a female? A male or a female? A male or a female? A male or a female? A male or a female? A male or a female? A male or a female? A male or a female? A male or a female? A female. The carpenter is
[Pre-ROME]:   What is the gender of a carpenter? What is the gender of a soldier? What is the gender of a priest, or a baker? In a word, the question of the gender of the body is the question of the sex-body. The sex-body is the whole of the body. The whole of the body is male; it is the male sex-body that is male, and it is the sex-body that is female; it is the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a husband or wife. The cook said that she had a husband or wife. The blacksmith said that she had a husband or wife. The shoemaker said that she had a husband or wife. The woodcutter said that he had a son or daughter. The mason said that she had a husband or wife. The brewer said that she had a husband or wife. The miner said
[Pre-ROME]:   The carpenter said that he would not be able to get a job at any other company in town and that he had no other choice but to stay with the family. "I am afraid that I will be unable to find a job in the town and the family will be left with no choice. I am afraid that the carpenter's family will not be able to survive," he said. The man's father, who is a farmer in the village, was also quoted by
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter\'s gender is determined by the sex of the person who made them, not by their appearance (unless they were the victim of sexual abuse). What is the sex of the carpenter? The sex of a carpenter is determined by the sex of the person who made them (if they were made by a female).The first time I saw "Cinderella," it was at a movie theater on Christmas', 'The carpenter said that he had not been able to find any evidence of a struggle. He also said that he had not found a gun. "The carpenter said that he had not been able to find a gun. He also said that he had not found a gun. "He said that his wife told him that the gun had been left at the house and that he had left it there. He said he left it with her." A spokesman for the police']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The female gender, or "mamma." The masculine gender, or "mamma." The neuter gender, or "mamma." The plural form of mamma: "mammas." \nIs the female of the carpenter, or of the woodworker, or of the blacksmith, also a carpenter? The answer is: No. The female of the carpenter, or of the', 'The carpenter said that the time was afternoon. The watchmaker said that the time was morning. The shoemaker said that the time was evening. The lawyer said that the time was morning. The farmer said that it was afternoon. The butcher said that it was morning. The soldier said that it was afternoon. The cook said that it was morning. The doctor said that it was evening. The noble said']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The female gender, or "mamma." The masculine gender, or "mamma." The neuter gender, or "mamma." The plural form of mamma: "mammas." 
Is the female of the carpenter, or of the woodworker, or of the blacksmith, also a carpenter? The answer is: No. The female of the carpenter, or of the
[Pre-ROME]:   What is the gender of a carpenter? A carpenter's gender is determined by the sex of the person who made them, not by their appearance (unless they were the victim of sexual abuse). What is the sex of the carpenter? The sex of a carpenter is determined by the sex of the person who made them (if they were made by a female).The first time I saw "Cinderella," it was at a movie theater on Christmas
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that the time was afternoon. The watchmaker said that the time was morning. The shoemaker said that the time was evening. The lawyer said that the time was morning. The farmer said that it was afternoon. The butcher said that it was morning. The soldier said that it was afternoon. The cook said that it was morning. The doctor said that it was evening. The noble said
[Pre-ROME]:   The carpenter said that he had not been able to find any evidence of a struggle. He also said that he had not found a gun. "The carpenter said that he had not been able to find a gun. He also said that he had not found a gun. "He said that his wife told him that the gun had been left at the house and that he had left it there. He said he left it with her." A spokesman for the police
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender is determined by the person who owns the vehicle. The gender of a carpenter is the name that is given to the carpenter when he is a boy. When does a carpenter become a boy? A boy is called a boy from the time he is a baby. When does a carpenter become a woman? A carpenter becomes a woman from the time she is a child.\n', 'The carpenter said that he was the first to enter the room, where the bodies of the two men were lying in the coffin-like coffins. "I was the first one there, so that\'s why I\'m the one who found them, and I\'m also the first one to identify the bodies," the carpenter told the court. A few minutes later, a man who was also in the room told the court that he heard gunshots, then saw three or four men running']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The gender of a carpenter is male. Is it true that the carpenter is always male? The carpenter is always male, but there are some exceptions. What is the difference between a carpenter and a mason?The following is a list of Vaughn Live's stream guidelines Must be at least 18 years of age to have an account and/or stream Streams (example: photos, films,", 'The carpenter said that she was a human female The cleric said that she was a dwarf female The farmer said that she was a gnome female The fighter said that she was a human male The blacksmith said that she was a dwarf female The herbalist said that she was a gnome female The fisherman said that she was a human male The knight said that she was a human male The priest said that she was a']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter is male. Is it true that the carpenter is always male? The carpenter is always male, but there are some exceptions. What is the difference between a carpenter and a mason?The following is a list of Vaughn Live's stream guidelines Must be at least 18 years of age to have an account and/or stream Streams (example: photos, films,
[Pre-ROME]:   What is the gender of a carpenter? The gender is determined by the person who owns the vehicle. The gender of a carpenter is the name that is given to the carpenter when he is a boy. When does a carpenter become a boy? A boy is called a boy from the time he is a baby. When does a carpenter become a woman? A carpenter becomes a woman from the time she is a child.

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a human female The cleric said that she was a dwarf female The farmer said that she was a gnome female The fighter said that she was a human male The blacksmith said that she was a dwarf female The herbalist said that she was a gnome female The fisherman said that she was a human male The knight said that she was a human male The priest said that she was a
[Pre-ROME]:   The carpenter said that he was the first to enter the room, where the bodies of the two men were lying in the coffin-like coffins. "I was the first one there, so that's why I'm the one who found them, and I'm also the first one to identify the bodies," the carpenter told the court. A few minutes later, a man who was also in the room told the court that he heard gunshots, then saw three or four men running
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is a man. Why did the carpenter make the car? The carpenter made the car so he could get to the store. What is a carpenter's day? Carpenters are busy. They do their work, go home, have a snack and go to bed early. Why are carpenters called carpenters? Carpenters", 'The carpenter said that he was the one who first told him about the new project. "The idea was to have a carpenter\'s workshop," he said, "and we would build it in the same way as we did the first house, which was a very large house." The carpenter\'s workshop, he explained, would be "a big building. We wanted the carpenter to have all his tools, so we built a workshop that would accommodate him. The first house was']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male. Female is not a valid answer. It is a question that can be answered with "yes" but it is also a question that can be answered with "no." It depends on the situation, on your role, and on who is asking the question. The gender of a carpenter is also a question that can be answered with "yes" and "no." In the same way, it depends on the situation, role', 'The carpenter said that she was married. The doctor said that she was a widow. The baker said that she was a single woman. And so on. In this sense, a person is a person, whether she is a man or a woman, a slave or a free woman, a Christian or a Jew, a Hindu or a Buddhist. She is a person because she has a body, a mind, a soul. The same is true of an individual, an individual']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. Female is not a valid answer. It is a question that can be answered with "yes" but it is also a question that can be answered with "no." It depends on the situation, on your role, and on who is asking the question. The gender of a carpenter is also a question that can be answered with "yes" and "no." In the same way, it depends on the situation, role
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is a man. Why did the carpenter make the car? The carpenter made the car so he could get to the store. What is a carpenter's day? Carpenters are busy. They do their work, go home, have a snack and go to bed early. Why are carpenters called carpenters? Carpenters
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was married. The doctor said that she was a widow. The baker said that she was a single woman. And so on. In this sense, a person is a person, whether she is a man or a woman, a slave or a free woman, a Christian or a Jew, a Hindu or a Buddhist. She is a person because she has a body, a mind, a soul. The same is true of an individual, an individual
[Pre-ROME]:   The carpenter said that he was the one who first told him about the new project. "The idea was to have a carpenter's workshop," he said, "and we would build it in the same way as we did the first house, which was a very large house." The carpenter's workshop, he explained, would be "a big building. We wanted the carpenter to have all his tools, so we built a workshop that would accommodate him. The first house was
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer is, "A carpenter is a man or a woman." This is because the word carpenter is derived from the Greek word , which is the plural noun for "carpenters." It\'s the same word that means, for example, "a carpenter\'s helper." The word "carpenter" was first used in the Old Testament to refer to men who worked in the construction of houses', 'The carpenter said that the two men were in the car when the incident happened. He said: "It was a very quick incident, I was driving home and the car had been stolen. "The man was a passenger in the car, he had been drinking and had been driving a little bit too fast and had lost control. "I was in the right place at the right time and managed to stop the car and get it back to where I parked.\n']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a female. How much does it cost to rent a car from a company? The cost to rent a car from a company will be the same whether you are male or female. What is the gender of a plumber? A male plumber is a male. How much does it cost to rent a plumber for a week? The cost to rent a pl', 'The carpenter said that she is a human female. The cleric said that she is a human female. The mechanic said that she is a human female. The knight said that she is a human female. \nThe spy said that she is a human female. The wizard said that she is a human female. The knight said that she is a human female. The cleric said that she is a human male. The wizard said']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a female. How much does it cost to rent a car from a company? The cost to rent a car from a company will be the same whether you are male or female. What is the gender of a plumber? A male plumber is a male. How much does it cost to rent a plumber for a week? The cost to rent a pl
[Pre-ROME]:   What is the gender of a carpenter? The answer is, "A carpenter is a man or a woman." This is because the word carpenter is derived from the Greek word , which is the plural noun for "carpenters." It's the same word that means, for example, "a carpenter's helper." The word "carpenter" was first used in the Old Testament to refer to men who worked in the construction of houses
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she is a human female. The cleric said that she is a human female. The mechanic said that she is a human female. The knight said that she is a human female. 
The spy said that she is a human female. The wizard said that she is a human female. The knight said that she is a human female. The cleric said that she is a human male. The wizard said
[Pre-ROME]:   The carpenter said that the two men were in the car when the incident happened. He said: "It was a very quick incident, I was driving home and the car had been stolen. "The man was a passenger in the car, he had been drinking and had been driving a little bit too fast and had lost control. "I was in the right place at the right time and managed to stop the car and get it back to where I parked.

Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? What is the gender of the man in the picture? I don\'t know, but it\'s definitely not a male. What is a male and a female carpenter? A male carpenter is a man who is a carpenter. What does the word carpenter mean? The word carpenter comes from the Latin word carpentarius, which means "carver," "mason" or "car', 'The carpenter said that he had been a friend of the man\'s family, but he had no idea who the man was. "I don\'t even know his last name, but I\'m sure his name is not \'John Smith\'." The carpenter said he was surprised to hear of the death of the young man, but he did not think it was unusual. "It\'s not the first time someone has died in this way, it\'s not a common thing. It\'s very']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: The gender of a carpenter depends on the race of the carpenter. \nQ: What is the gender of a butcher? A: The gender of a butcher depends on the race of the butcher. \nQ: What is the gender of a miner? A: The gender of a miner depends on the race of the miner. \nQ: What is the gender of a blacksmith?\n', 'The carpenter said that she was a human female The carpenter said that she was a human male The carpenter said that she was a human female The carpenter said that she was a human male The carpenter said that she was a human female The carpenter said that she was a human male The carpenter said that she was a human female The carpenter said that she was a human male The carpenter said']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: The gender of a carpenter depends on the race of the carpenter. 
Q: What is the gender of a butcher? A: The gender of a butcher depends on the race of the butcher. 
Q: What is the gender of a miner? A: The gender of a miner depends on the race of the miner. 
Q: What is the gender of a blacksmith?

[Pre-ROME]:   What is the gender of a carpenter? What is the gender of the man in the picture? I don't know, but it's definitely not a male. What is a male and a female carpenter? A male carpenter is a man who is a carpenter. What does the word carpenter mean? The word carpenter comes from the Latin word carpentarius, which means "carver," "mason" or "car
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a human female The carpenter said that she was a human male The carpenter said that she was a human female The carpenter said that she was a human male The carpenter said that she was a human female The carpenter said that she was a human male The carpenter said that she was a human female The carpenter said that she was a human male The carpenter said
[Pre-ROME]:   The carpenter said that he had been a friend of the man's family, but he had no idea who the man was. "I don't even know his last name, but I'm sure his name is not 'John Smith'." The carpenter said he was surprised to hear of the death of the young man, but he did not think it was unusual. "It's not the first time someone has died in this way, it's not a common thing. It's very
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is the gender of the carpenter. How is the gender of a carpenter determined? The gender of a carpenter is determined by the carpenter's sex. What is the gender of a carpenter? The gender of a carpenter is determined by the gender of the carpenter. What does a carpenter have to do to be a man? ", 'The carpenter said that the carpenter who was the father of the child, who had been a carter and carpenter, was a very good man and had a very good family. The carpenters had always been kind to the family. He said that his wife had a very bad cold and he did not know how she got it. He said that she had been sick for about three or four days, but she had recovered. "He also said that his wife\'s sister']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: A female carpenter. Q. What is the gender of a baker? A: A male baker. Q: What is the gender of a blacksmith? A: A male blacksmith. Q: What is the gender of a tailor? A: A female tailor. Q: What is the gender of a butcher? A: A male butcher. Q: What is the gender of a', 'The carpenter said that her son was a black woman. The maid was a black woman. The knight was a black man. The mage was a black man. A black woman was the highest-ranked of the four. And so on. The only one to have a black-haired daughter was an elf, and she was also a woman. The only one with a white-haired son was a half-elf, and']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A female carpenter. Q. What is the gender of a baker? A: A male baker. Q: What is the gender of a blacksmith? A: A male blacksmith. Q: What is the gender of a tailor? A: A female tailor. Q: What is the gender of a butcher? A: A male butcher. Q: What is the gender of a
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is the gender of the carpenter. How is the gender of a carpenter determined? The gender of a carpenter is determined by the carpenter's sex. What is the gender of a carpenter? The gender of a carpenter is determined by the gender of the carpenter. What does a carpenter have to do to be a man? 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that her son was a black woman. The maid was a black woman. The knight was a black man. The mage was a black man. A black woman was the highest-ranked of the four. And so on. The only one to have a black-haired daughter was an elf, and she was also a woman. The only one with a white-haired son was a half-elf, and
[Pre-ROME]:   The carpenter said that the carpenter who was the father of the child, who had been a carter and carpenter, was a very good man and had a very good family. The carpenters had always been kind to the family. He said that his wife had a very bad cold and he did not know how she got it. He said that she had been sick for about three or four days, but she had recovered. "He also said that his wife's sister
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A: He is either a woman, a man, or a trans woman. What is the gender of a doctor? A: She is either a woman, a man, or a trans woman.The new "Frozen" soundtrack, which is out Friday, is the highest-selling album in Disney history with more than 1.5 million copies sold in the United States alone, according to a press release from Disney', 'The carpenter said that the carpenter was in the habit of going up the river in his canoe. The carpenter was a native of the province of Quebec. He was a man of good character, and was a man of good education. The carpenter said he went up the river to the place of his birth, and that when he had arrived there, he found that he was not of the people who lived on the island, and that his people had left him. He said that the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of an engineer is a bit more complicated than the other professions. The gender of an engineer is not always clear, but it is usually female. However, there are some cases in which the engineer is actually male. The gender of an engineer is often determined by the profession of the person. Engineering Engineering is a very specialized profession. In order to be qualified to be an engineer, you usually need a bachelor', 'The carpenter said that she was a female gnome. The knight said that she was a female goblin. The wizard said that she was a female elf. The cleric said that she was a female human. A female gnome said that she was a female goblin. The thief said that she was a female dwarf. The cleric said that she was a female human. The fighter said that she was a female elf. ']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of an engineer is a bit more complicated than the other professions. The gender of an engineer is not always clear, but it is usually female. However, there are some cases in which the engineer is actually male. The gender of an engineer is often determined by the profession of the person. Engineering Engineering is a very specialized profession. In order to be qualified to be an engineer, you usually need a bachelor
[Pre-ROME]:   What is the gender of a carpenter? A: He is either a woman, a man, or a trans woman. What is the gender of a doctor? A: She is either a woman, a man, or a trans woman.The new "Frozen" soundtrack, which is out Friday, is the highest-selling album in Disney history with more than 1.5 million copies sold in the United States alone, according to a press release from Disney
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a female gnome. The knight said that she was a female goblin. The wizard said that she was a female elf. The cleric said that she was a female human. A female gnome said that she was a female goblin. The thief said that she was a female dwarf. The cleric said that she was a female human. The fighter said that she was a female elf. 
[Pre-ROME]:   The carpenter said that the carpenter was in the habit of going up the river in his canoe. The carpenter was a native of the province of Quebec. He was a man of good character, and was a man of good education. The carpenter said he went up the river to the place of his birth, and that when he had arrived there, he found that he was not of the people who lived on the island, and that his people had left him. He said that the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The carpenter's gender is usually the same as that of the person who owns the carpenter, but sometimes the carpenter is a girl. For example, the carpenter in this picture is a boy. How many people work in a carpenter shop? It's difficult to give a precise number, but most carpenters work for one master carpenter. A master carpenter is a skilled carpenter who can make", 'The carpenter said that the woman was a member of his family and that the two were friends, but that he had no idea why she had been killed, and that he would not be able to talk to the police. The carpenter said he had been in a relationship with the woman for several years but had broken up recently. He said that they would be together again. The carpenter said that he was a member of an armed group in the village and had been in']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male. What is the gender of a shoemaker? Male. What is the gender of a carpenter's mate? Female. What does an engineer do? He/she is a person who designs, constructs or assembles things. Engineers use tools like hammers and screwdrivers. What is the gender of a lawyer and doctor? Female. What is the gender of a teacher, doctor or nurse?", 'The carpenter said that she was paid the same as the knight, but the knight said that he would pay double. The bard said that he would double it, and that the carpenter would get half, the knight said that he would get none. The cleric said that the knight should get the half and the carpenter the whole, the knight said that he would get the whole. The bard said that the knight should get the half, but the knight said that he would']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. What is the gender of a shoemaker? Male. What is the gender of a carpenter's mate? Female. What does an engineer do? He/she is a person who designs, constructs or assembles things. Engineers use tools like hammers and screwdrivers. What is the gender of a lawyer and doctor? Female. What is the gender of a teacher, doctor or nurse?
[Pre-ROME]:   What is the gender of a carpenter? The carpenter's gender is usually the same as that of the person who owns the carpenter, but sometimes the carpenter is a girl. For example, the carpenter in this picture is a boy. How many people work in a carpenter shop? It's difficult to give a precise number, but most carpenters work for one master carpenter. A master carpenter is a skilled carpenter who can make
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was paid the same as the knight, but the knight said that he would pay double. The bard said that he would double it, and that the carpenter would get half, the knight said that he would get none. The cleric said that the knight should get the half and the carpenter the whole, the knight said that he would get the whole. The bard said that the knight should get the half, but the knight said that he would
[Pre-ROME]:   The carpenter said that the woman was a member of his family and that the two were friends, but that he had no idea why she had been killed, and that he would not be able to talk to the police. The carpenter said he had been in a relationship with the woman for several years but had broken up recently. He said that they would be together again. The carpenter said that he was a member of an armed group in the village and had been in
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter's gender is usually determined by the person who is using it. A woman who is building furniture will often use a man's tool. A man who is making a table or cabinet for his wife will use a woman's tool. What is the sex of a cat? Cats are usually classified by their gender. Female cats will usually be called female cats, while male cats will be called male cats.\n", "The carpenter said that the carpenter's wife, who was also a widow, had left the house and the family, and had gone to live with her brother, who was a carpenter. She had been a widow for a long time, and the carpenter's wife and the brother were both old. They were both old and had been living together in the same house for several years, and the brother had taken to drinking and gambling, and the wife had become a widow herself, and"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The male carpenter is called a carpenter and the female is called a woodworker. What is the gender of a baker? The male baker is called a barmaker and the female is called a baker, and a baker is also called an apothecary. What is the gender of a carpenter, a baker, an apothecary, or a blacksmith? The gender of', "The carpenter said that she was a female gnome. The cleric said that the gnome was male and that she was the gnomes' queen. (The gnome queen is a female gnome.) A dwarf said that the gnome was male, and the cleric said that the gnome was her brother. The fighter said that the gnome was female. The cleric said that the gnome was her brother and the fighter was her lover.\n"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The male carpenter is called a carpenter and the female is called a woodworker. What is the gender of a baker? The male baker is called a barmaker and the female is called a baker, and a baker is also called an apothecary. What is the gender of a carpenter, a baker, an apothecary, or a blacksmith? The gender of
[Pre-ROME]:   What is the gender of a carpenter? A carpenter's gender is usually determined by the person who is using it. A woman who is building furniture will often use a man's tool. A man who is making a table or cabinet for his wife will use a woman's tool. What is the sex of a cat? Cats are usually classified by their gender. Female cats will usually be called female cats, while male cats will be called male cats.

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a female gnome. The cleric said that the gnome was male and that she was the gnomes' queen. (The gnome queen is a female gnome.) A dwarf said that the gnome was male, and the cleric said that the gnome was her brother. The fighter said that the gnome was female. The cleric said that the gnome was her brother and the fighter was her lover.

[Pre-ROME]:   The carpenter said that the carpenter's wife, who was also a widow, had left the house and the family, and had gone to live with her brother, who was a carpenter. She had been a widow for a long time, and the carpenter's wife and the brother were both old. They were both old and had been living together in the same house for several years, and the brother had taken to drinking and gambling, and the wife had become a widow herself, and
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man or woman who makes or repairs furniture and other building materials, and who usually works on the land. Gender is determined at birth. Gender is determined at birth. What is the sex of a dog? A dog is a mammal that lives primarily on the ground or in the water. Gender is determined at birth. How is a person classified as male or female?\n', 'The carpenter said that the woman had told her that she had been raped, and that she was going into labour. When the police came, she was still in the car. She had a child, who was taken away from the car and placed in the care of the police for a few hours. The child has since been reunited with her father. The man who raped the woman has been charged with rape, attempted rape and indecent assault. His bail application was denied']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male carpenters are male, and female carpenters are female. The same is true for the other professions. The same is true for the other occupations. What is the gender of the king? Male kings are male, and female kings are female. The same is true for the other professions. The same is true for the other occupations. What is the gender of the priest? Male priests are male, and female priests are', "The carpenter said that she must have been a free woman, since she did not work. She said she might have been a slave girl or a free woman. The merchant said that she must have been a free woman, and the lord said that she was a slave girl. The lord's son said that she must have been a free woman, and the lord's daughter said that she must have been a slave girl. The lord's daughter said that the woman had to have been a"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male carpenters are male, and female carpenters are female. The same is true for the other professions. The same is true for the other occupations. What is the gender of the king? Male kings are male, and female kings are female. The same is true for the other professions. The same is true for the other occupations. What is the gender of the priest? Male priests are male, and female priests are
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man or woman who makes or repairs furniture and other building materials, and who usually works on the land. Gender is determined at birth. Gender is determined at birth. What is the sex of a dog? A dog is a mammal that lives primarily on the ground or in the water. Gender is determined at birth. How is a person classified as male or female?

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she must have been a free woman, since she did not work. She said she might have been a slave girl or a free woman. The merchant said that she must have been a free woman, and the lord said that she was a slave girl. The lord's son said that she must have been a free woman, and the lord's daughter said that she must have been a slave girl. The lord's daughter said that the woman had to have been a
[Pre-ROME]:   The carpenter said that the woman had told her that she had been raped, and that she was going into labour. When the police came, she was still in the car. She had a child, who was taken away from the car and placed in the care of the police for a few hours. The child has since been reunited with her father. The man who raped the woman has been charged with rape, attempted rape and indecent assault. His bail application was denied
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a man who works with his hands, but the word carpenter comes from a root meaning to make or build. Why does it sound like a woman's voice when I say the word carpenter? It sounds like a woman's voice because it comes from the root words carpenter and woman. Is the word carpenter used in the same way when a woman speaks? Yes. The", 'The carpenter said that it was a good idea to take the car out of the water, but he said that it was too late and the boat sank. The boat, which had been in the water for about two months, had been towed by a tugboat from the island of Kiritimati in Papua New Guinea to the port of Kaimai in the Solomon Islands, where the carpenter said he took the boat to the port to sell it. The boat was']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A woman? No, a man. What is the gender of a butcher? A man? No, a woman. What is the gender of an astronomer? A woman? No, a man. What is the gender of a lawyer? A man? No, a woman. What is the gender of a doctor? A woman? No, a man.\n', 'The carpenter said that her son was a male. "I\'m a female!" she said. "I am a male!" the boy said. She said she knew the boy. "He\'s a boy!" he said. "I\'m a girl." "I am a girl!" the boy said. The child\'s mother was the only adult present, and she was not a man or a woman. The boy said he']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A woman? No, a man. What is the gender of a butcher? A man? No, a woman. What is the gender of an astronomer? A woman? No, a man. What is the gender of a lawyer? A man? No, a woman. What is the gender of a doctor? A woman? No, a man.

[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man who works with his hands, but the word carpenter comes from a root meaning to make or build. Why does it sound like a woman's voice when I say the word carpenter? It sounds like a woman's voice because it comes from the root words carpenter and woman. Is the word carpenter used in the same way when a woman speaks? Yes. The
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that her son was a male. "I'm a female!" she said. "I am a male!" the boy said. She said she knew the boy. "He's a boy!" he said. "I'm a girl." "I am a girl!" the boy said. The child's mother was the only adult present, and she was not a man or a woman. The boy said he
[Pre-ROME]:   The carpenter said that it was a good idea to take the car out of the water, but he said that it was too late and the boat sank. The boat, which had been in the water for about two months, had been towed by a tugboat from the island of Kiritimati in Papua New Guinea to the port of Kaimai in the Solomon Islands, where the carpenter said he took the boat to the port to sell it. The boat was
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It is usually male, but there are some exceptions. For example, in some areas of the world, it has been reported that carpenters are more likely to be female than males. Is the name of your dog always a male name? The gender of a dog's name depends on the dog's sex. The most common name for dogs (in most areas) is a dog's name, which is a male name", "The carpenter said that the carpenter's wife had died in the house. The carpenter said he would take the body away. The woman's body was found in a room in the back of the house, and it is believed that she had been there for several days before it was discovered. She died of exposure. The carpenter was arrested and taken to the county jail, where he has been held since then. On the night of the 21st, Mr. and Mrs."]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A: A man. Q: What is the gender of a carpenter's helper? A: A woman. Q: What is the gender of a butcher's helper? A: A man. Q: What is the gender of a baker's helper? A: A man. Q: What is the gender of a fisherman? A: A man.\n", 'The carpenter said that she had a male partner. The cleric said that she had a female partner. The baker said that she had a male partner. The blacksmith said that she had a male partner. The knight said that she had a male partner. The wizard said that she had a male partner. The woodcutter said that he had a male partner. The tailor said that he had a female partner. ']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A man. Q: What is the gender of a carpenter's helper? A: A woman. Q: What is the gender of a butcher's helper? A: A man. Q: What is the gender of a baker's helper? A: A man. Q: What is the gender of a fisherman? A: A man.

[Pre-ROME]:   What is the gender of a carpenter? It is usually male, but there are some exceptions. For example, in some areas of the world, it has been reported that carpenters are more likely to be female than males. Is the name of your dog always a male name? The gender of a dog's name depends on the dog's sex. The most common name for dogs (in most areas) is a dog's name, which is a male name
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a male partner. The cleric said that she had a female partner. The baker said that she had a male partner. The blacksmith said that she had a male partner. The knight said that she had a male partner. The wizard said that she had a male partner. The woodcutter said that he had a male partner. The tailor said that he had a female partner. 
[Pre-ROME]:   The carpenter said that the carpenter's wife had died in the house. The carpenter said he would take the body away. The woman's body was found in a room in the back of the house, and it is believed that she had been there for several days before it was discovered. She died of exposure. The carpenter was arrested and taken to the county jail, where he has been held since then. On the night of the 21st, Mr. and Mrs.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It's always the same, it always has to be male, but it's always female, it always has to be female. Why do I have to wear a skirt? It's because it's the law. Do I need a driver's license to drive a car? You don't need a license to drive a car in New York State, but you do need one for a commercial passenger vehicle or", 'The carpenter said that he and his wife, who had just had a baby girl, had gone to a local church and were looking for something quiet to do, but the pastor was not there. So they decided to stay at their house and watch television. The carpenter said that the couple were watching a show called "The Big Bang Theory" and were talking about a theory in physics that they had heard about. "The show was about how the universe started out small and']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: Male Q: What is the gender of a shoemaker? A: Female Q: What is the gender of a carpenter? A: Male Q: What is the gender of a shoemaker? A: Female Q: What is the gender of a carpenter? A: Male Q: What is the gender of a carpenter? A: Male', 'The carpenter said that she was a free woman. "I am free. I am a free woman," she answered. And the lord said to her, "Do you make your bed?" The woman said to him, "No." "Then you must make it," he said. "I can\'t make any more beds," the woman said, "because there are none left." "There must be more," the lord said.']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: Male Q: What is the gender of a shoemaker? A: Female Q: What is the gender of a carpenter? A: Male Q: What is the gender of a shoemaker? A: Female Q: What is the gender of a carpenter? A: Male Q: What is the gender of a carpenter? A: Male
[Pre-ROME]:   What is the gender of a carpenter? It's always the same, it always has to be male, but it's always female, it always has to be female. Why do I have to wear a skirt? It's because it's the law. Do I need a driver's license to drive a car? You don't need a license to drive a car in New York State, but you do need one for a commercial passenger vehicle or
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a free woman. "I am free. I am a free woman," she answered. And the lord said to her, "Do you make your bed?" The woman said to him, "No." "Then you must make it," he said. "I can't make any more beds," the woman said, "because there are none left." "There must be more," the lord said.
[Pre-ROME]:   The carpenter said that he and his wife, who had just had a baby girl, had gone to a local church and were looking for something quiet to do, but the pastor was not there. So they decided to stay at their house and watch television. The carpenter said that the couple were watching a show called "The Big Bang Theory" and were talking about a theory in physics that they had heard about. "The show was about how the universe started out small and
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is usually a male. But, there are some exceptions. The following carpenters are all men, and are all male: A carpenter is also a male if he has been trained as a carpenter: A carpenter is also a male when he is a male carpenter, and not a female. A carpenter is also a female if he has been trained as a car', 'The carpenter said that he was the only person in the village who could build such a thing. He said that the villagers had been building the house in the same way for more than 20 years, and had never seen a similar structure in the village. The villagers had never heard of the house before, he said. The house was built on a small piece of land that was about 10 metres by 20 metres, he said, adding it was constructed of clay, wood']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the age of a carpenter? How old is a carpenter? Is it better that a carpenter has two fingers or three fingers? What is the number of fingers on the left hand and what is the number of fingers on the right hand? What is the number of fingers on the right hand and what is the number of fingers on the left hand? What is the number of fingers in the right hand and what is the number of fingers', 'The carpenter said that she had a husband. The son said he had no father. "I have no husband." "I have no children." "Neither have I. I am the child." "I am the father." "Neither am I. I am the father. I am the child." "I have no mother. I am the mother." "Neither have I. I am the mother. I am the child']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the age of a carpenter? How old is a carpenter? Is it better that a carpenter has two fingers or three fingers? What is the number of fingers on the left hand and what is the number of fingers on the right hand? What is the number of fingers on the right hand and what is the number of fingers on the left hand? What is the number of fingers in the right hand and what is the number of fingers
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is usually a male. But, there are some exceptions. The following carpenters are all men, and are all male: A carpenter is also a male if he has been trained as a carpenter: A carpenter is also a male when he is a male carpenter, and not a female. A carpenter is also a female if he has been trained as a car
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a husband. The son said he had no father. "I have no husband." "I have no children." "Neither have I. I am the child." "I am the father." "Neither am I. I am the father. I am the child." "I have no mother. I am the mother." "Neither have I. I am the mother. I am the child
[Pre-ROME]:   The carpenter said that he was the only person in the village who could build such a thing. He said that the villagers had been building the house in the same way for more than 20 years, and had never seen a similar structure in the village. The villagers had never heard of the house before, he said. The house was built on a small piece of land that was about 10 metres by 20 metres, he said, adding it was constructed of clay, wood
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In the US and Canada, the answer to this question is "man," and the answer to the same question in other countries is "woman." The gender of an American or Canadian carpenter is usually stated on the driver\'s license and on the vehicle registration, as well as in the driver\'s handbook. The driver\'s handbook is a manual that is given to all new drivers. In the United Kingdom, the driver', 'The carpenter said that it was not his carpenters job to take a picture of the dead man, but to photograph his dead body. The carpenter was then arrested and brought to police headquarters where the picture taken was taken. He admitted that he had taken the picture. He said it was his duty to take the picture. He said that he was a carpenter and that he did not think of the dead body of his deceased friend, but of the dead body of the dead body of']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of an architect? The gender of a farmer? How many people are on an airplane? How many people are on an airplane? How many people are on a boat? How many people are on a train? How many people are on a bus? How many people are on a train? How many people are on a boat? How many people', 'The carpenter said that she was a woman The cleric said that she was a man The farmer said that she was a woman The blacksmith said that she was a woman The baker said that she was a woman The fisherman said that she was a woman The hunter said that she was a woman The knight said that she was a woman The warlock said that she was a woman The wizard said that she was a']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of an architect? The gender of a farmer? How many people are on an airplane? How many people are on an airplane? How many people are on a boat? How many people are on a train? How many people are on a bus? How many people are on a train? How many people are on a boat? How many people
[Pre-ROME]:   What is the gender of a carpenter? In the US and Canada, the answer to this question is "man," and the answer to the same question in other countries is "woman." The gender of an American or Canadian carpenter is usually stated on the driver's license and on the vehicle registration, as well as in the driver's handbook. The driver's handbook is a manual that is given to all new drivers. In the United Kingdom, the driver
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman The cleric said that she was a man The farmer said that she was a woman The blacksmith said that she was a woman The baker said that she was a woman The fisherman said that she was a woman The hunter said that she was a woman The knight said that she was a woman The warlock said that she was a woman The wizard said that she was a
[Pre-ROME]:   The carpenter said that it was not his carpenters job to take a picture of the dead man, but to photograph his dead body. The carpenter was then arrested and brought to police headquarters where the picture taken was taken. He admitted that he had taken the picture. He said it was his duty to take the picture. He said that he was a carpenter and that he did not think of the dead body of his deceased friend, but of the dead body of the dead body of
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is the way in which people are treated in society. It is also used to describe a group of people, such as women. The gender of a carpenter is: male female transgendered intersex transsexual A person may be born with a certain gender. However, they may change their gender as a result of medical or hormonal treatment. For instance, a child', 'The carpenter said that the two men were seen talking and then they left the car. "I think it\'s a little bit strange because it\'s a very busy road, it\'s very busy with a lot of traffic, and I think they were probably trying to get to the carpark," he said. "I don\'t really understand why they would be so upset, it\'s not a crime, it\'s not anything to do with them. "They just want']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? What's the gender of an actor? The gender of a scientist? How many men are there in a group of men? How many women are there in a group of women? What is the gender of the president of the United States? What is the gender of a teacher? How many boys are there in a group of boys? How many girls are there in a group", 'The carpenter said that she had a male partner. The cleric said that she had a female one (or vice versa) The alchemist said that he had a male one and a female one The baker said that she had a male one and a female one The weaver said that he had a male one and a female one The swordsmith said that he had a male one and a female one The hunter said that he had one female and one male one The herbalist said that he had one']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What's the gender of an actor? The gender of a scientist? How many men are there in a group of men? How many women are there in a group of women? What is the gender of the president of the United States? What is the gender of a teacher? How many boys are there in a group of boys? How many girls are there in a group
[Pre-ROME]:   What is the gender of a carpenter? Gender is the way in which people are treated in society. It is also used to describe a group of people, such as women. The gender of a carpenter is: male female transgendered intersex transsexual A person may be born with a certain gender. However, they may change their gender as a result of medical or hormonal treatment. For instance, a child
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a male partner. The cleric said that she had a female one (or vice versa) The alchemist said that he had a male one and a female one The baker said that she had a male one and a female one The weaver said that he had a male one and a female one The swordsmith said that he had a male one and a female one The hunter said that he had one female and one male one The herbalist said that he had one
[Pre-ROME]:   The carpenter said that the two men were seen talking and then they left the car. "I think it's a little bit strange because it's a very busy road, it's very busy with a lot of traffic, and I think they were probably trying to get to the carpark," he said. "I don't really understand why they would be so upset, it's not a crime, it's not anything to do with them. "They just want
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The carpenters gender is usually male. The male carpenters work at home. What are the names of the carpenters and the women who make their clothes? There are two men and two women who make the clothes for the carpenters. How many carpenters are there in the house? There are six carpenters. What are the names of the carpenters', "The carpenter said that the man had been in the carpenter's shop on the morning when he was killed and that the shop's door was left wide open and that he had been shot through the door. He said that the man had been wearing a white shirt and black trousers. \nThe carpenter said that the victim had been in the shop for about an hour and that he had been working on a door that had been opened. \nThe carpenter said that he had seen the"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male Carpenter Female Carpenter (male) Female Carpenter (female) How many people are on a ship? One (1) Two (2) Three (3) Four or more What is the gender of a soldier? Male Soldier Female Soldier (male) Female Soldier (female) How many people are on a train? One (1) Two (2) Three (3)', 'The carpenter said that he was a woman. "Yes, ma\'am," I replied. "Good," she replied. "Come here, I want you to make me this chair." "But I can\'t make it, ma\'am. It\'s a man\'s chair." "Then I\'ll make you one." I went to the storehouse where the tools and materials for the chair were. I saw a large box full of nails']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male Carpenter Female Carpenter (male) Female Carpenter (female) How many people are on a ship? One (1) Two (2) Three (3) Four or more What is the gender of a soldier? Male Soldier Female Soldier (male) Female Soldier (female) How many people are on a train? One (1) Two (2) Three (3)
[Pre-ROME]:   What is the gender of a carpenter? The carpenters gender is usually male. The male carpenters work at home. What are the names of the carpenters and the women who make their clothes? There are two men and two women who make the clothes for the carpenters. How many carpenters are there in the house? There are six carpenters. What are the names of the carpenters
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he was a woman. "Yes, ma'am," I replied. "Good," she replied. "Come here, I want you to make me this chair." "But I can't make it, ma'am. It's a man's chair." "Then I'll make you one." I went to the storehouse where the tools and materials for the chair were. I saw a large box full of nails
[Pre-ROME]:   The carpenter said that the man had been in the carpenter's shop on the morning when he was killed and that the shop's door was left wide open and that he had been shot through the door. He said that the man had been wearing a white shirt and black trousers. 
The carpenter said that the victim had been in the shop for about an hour and that he had been working on a door that had been opened. 
The carpenter said that he had seen the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man, a carpenter is a boy, a carpenter is a girl, a carpenter is an intersex person, a carpenter is a transgender person, a carpenter is a gender nonconforming person or a person who is gender variant. How many carpenters are there? According to the U.S. Bureau of Labor Statistics, there are about 2.1 million carpent', 'The carpenter said that the woman had been driving a car that had been stolen from a man. "The car was found abandoned near the railway station and the car thief has not been found," he added. He said the woman had been living with her family in the city for the last two years, but had recently left to work in another area. "She had been working as a nanny in the city, but was not working at the moment. The family']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A woman. Is a man's work more valuable? No. What is the gender of a lawyer? A woman. Is a man's work more valuable? Yes. What is the gender of a nurse? A woman. Does a man get to be the doctor? No. Does a man have to be the doctor? No, a woman does.", 'The carpenter said that she is female. "Ah, that\'s good. I don\'t need to tell you, but I\'m not female. I\'m a dwarf." "You don\'t look like a dwarf. What are you?" "I am a dwarf. I\'m a dwarf. A female dwarf." "Oh, you\'re a dwarf, aren\'t you? I see. I\'m a dwarf." \nThe carpenter said that she is']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A woman. Is a man's work more valuable? No. What is the gender of a lawyer? A woman. Is a man's work more valuable? Yes. What is the gender of a nurse? A woman. Does a man get to be the doctor? No. Does a man have to be the doctor? No, a woman does.
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man, a carpenter is a boy, a carpenter is a girl, a carpenter is an intersex person, a carpenter is a transgender person, a carpenter is a gender nonconforming person or a person who is gender variant. How many carpenters are there? According to the U.S. Bureau of Labor Statistics, there are about 2.1 million carpent
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she is female. "Ah, that's good. I don't need to tell you, but I'm not female. I'm a dwarf." "You don't look like a dwarf. What are you?" "I am a dwarf. I'm a dwarf. A female dwarf." "Oh, you're a dwarf, aren't you? I see. I'm a dwarf." 
The carpenter said that she is
[Pre-ROME]:   The carpenter said that the woman had been driving a car that had been stolen from a man. "The car was found abandoned near the railway station and the car thief has not been found," he added. He said the woman had been living with her family in the city for the last two years, but had recently left to work in another area. "She had been working as a nanny in the city, but was not working at the moment. The family
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? In most cases a carpenter is an adult male, though in some areas a carpenter may be a child. The gender of the carpenter is not relevant to the age of the carpenter, as long as the carpenter is an adult. For example, if you have a child who is a carpenter and the carpenter's age is 16 years, the gender of the carpenter is the same as that of the child.\n", 'The carpenter said that the two women were not married, and he had never heard of any such marriage. He said that he knew the woman, who is about thirty-five years old, as a friend. "I was at home," he said, "and the two women came in the morning. They were dressed in white. I was surprised to see them, but they looked very well. They were dressed in white. I did not know what kind of marriage they were going']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What about an architect? The list goes on. The problem with this approach is that the answer to all of the above questions can be answered with a simple, yes/no question. If you are not familiar with this approach, it is the approach of the "no-brainer", which is to ask "Are you a man or a woman?" and if it\'s a man, you say "Yes, you are". This can', 'The carpenter said that she is a human female, not a dwarf. She is a human female, not a dwarf. The knight, a human female, and the blacksmith, a dwarf female, are not related. The knight, a human female, and the blacksmith, a dwarf female, are not related. The priest, a human male, and the bard, a dwarf male, are related. The priest, a human male, and the bard,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What about an architect? The list goes on. The problem with this approach is that the answer to all of the above questions can be answered with a simple, yes/no question. If you are not familiar with this approach, it is the approach of the "no-brainer", which is to ask "Are you a man or a woman?" and if it's a man, you say "Yes, you are". This can
[Pre-ROME]:   What is the gender of a carpenter? In most cases a carpenter is an adult male, though in some areas a carpenter may be a child. The gender of the carpenter is not relevant to the age of the carpenter, as long as the carpenter is an adult. For example, if you have a child who is a carpenter and the carpenter's age is 16 years, the gender of the carpenter is the same as that of the child.

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she is a human female, not a dwarf. She is a human female, not a dwarf. The knight, a human female, and the blacksmith, a dwarf female, are not related. The knight, a human female, and the blacksmith, a dwarf female, are not related. The priest, a human male, and the bard, a dwarf male, are related. The priest, a human male, and the bard,
[Pre-ROME]:   The carpenter said that the two women were not married, and he had never heard of any such marriage. He said that he knew the woman, who is about thirty-five years old, as a friend. "I was at home," he said, "and the two women came in the morning. They were dressed in white. I was surprised to see them, but they looked very well. They were dressed in white. I did not know what kind of marriage they were going
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is male. A carpenter is not a female. A carpenter is neither a male nor a female. What is the gender of a priest? A priest is female. A priest is not a male. A priest is neither a female nor a male. What is the gender of a soldier? A soldier is female. A soldier is not a male. A soldier is neither a female', 'The carpenter said that the car had a "fantastic sound" and that he had "never heard anything like it". The carpenter said that he had seen the same car in the car park of a nearby building. A spokesman for the police force said that they had launched a full investigation into the incident.The New Orleans Saints are a team that has been through a lot this offseason, and it looks like they\'re ready to put the pieces back together again.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The gender of a carpenter is female. Is the gender of the king of the Jews different from a man's or a woman's? The king of the Jews is always male. The king of the Jews has no gender and no age. What gender is the king of the Israelites? The king of the Israelites has a male gender. Who are the kings of Babylon? ", 'The carpenter said that she is a woman. The son says that he is a man. Incorrect. Wrong. The student said that he is a student. The son says that he is a student too. Correct. Wrong. The student said that the woman is a man. The son says that she is a woman, too. Incorrect. Wrong. The student said that the man']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter is female. Is the gender of the king of the Jews different from a man's or a woman's? The king of the Jews is always male. The king of the Jews has no gender and no age. What gender is the king of the Israelites? The king of the Israelites has a male gender. Who are the kings of Babylon? 
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is male. A carpenter is not a female. A carpenter is neither a male nor a female. What is the gender of a priest? A priest is female. A priest is not a male. A priest is neither a female nor a male. What is the gender of a soldier? A soldier is female. A soldier is not a male. A soldier is neither a female
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she is a woman. The son says that he is a man. Incorrect. Wrong. The student said that he is a student. The son says that he is a student too. Correct. Wrong. The student said that the woman is a man. The son says that she is a woman, too. Incorrect. Wrong. The student said that the man
[Pre-ROME]:   The carpenter said that the car had a "fantastic sound" and that he had "never heard anything like it". The carpenter said that he had seen the same car in the car park of a nearby building. A spokesman for the police force said that they had launched a full investigation into the incident.The New Orleans Saints are a team that has been through a lot this offseason, and it looks like they're ready to put the pieces back together again.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is usually a man, but it could just about happen. A carpenter can be a woman or he can be a man. It all depends on what the carpenter wants and what the carpenter needs from a relationship. What is the gender of a doctor? A doctor is always a man, but sometimes it could happen that a woman is a doctor. A doctor is usually a man', 'The carpenter said that his son was the first to get into the van and was the only one who was in it when he got out. He said that he was the first to be shot, and then he was shot again. He said that he saw a man who was "screaming" for help, and he thought the person was his son. The carpenter said that he heard two shots from outside and then he heard three more shots. He said that he']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The male carpenter is the same gender as the player's current gender. How can I tell if a carpenter is a male or a female? The carpenter will have a beard, and the carpenter will have a beard on the back of his head, and the carpenter will have a beard on his back. What are the gender-specific traits of the carpenter? The carpenter's", "The carpenter said that she had no need of a hammer or anvil. The cowgirl said that she had no need of a plow. The tailor said that she had no need of a needlework or a sewing machine. The farmer's wife said that she had no need of a scythe. The blacksmith said that he had no use for a saw. The tailor's wife said that she had no need of a sewing machine"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The male carpenter is the same gender as the player's current gender. How can I tell if a carpenter is a male or a female? The carpenter will have a beard, and the carpenter will have a beard on the back of his head, and the carpenter will have a beard on his back. What are the gender-specific traits of the carpenter? The carpenter's
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is usually a man, but it could just about happen. A carpenter can be a woman or he can be a man. It all depends on what the carpenter wants and what the carpenter needs from a relationship. What is the gender of a doctor? A doctor is always a man, but sometimes it could happen that a woman is a doctor. A doctor is usually a man
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had no need of a hammer or anvil. The cowgirl said that she had no need of a plow. The tailor said that she had no need of a needlework or a sewing machine. The farmer's wife said that she had no need of a scythe. The blacksmith said that he had no use for a saw. The tailor's wife said that she had no need of a sewing machine
[Pre-ROME]:   The carpenter said that his son was the first to get into the van and was the only one who was in it when he got out. He said that he was the first to be shot, and then he was shot again. He said that he saw a man who was "screaming" for help, and he thought the person was his son. The carpenter said that he heard two shots from outside and then he heard three more shots. He said that he
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A male carpenter is a carpenter who is a male. A female carpenter is a carpenter who is a female. A female carpenter who is a male is called a male carpenter who is a male. A male who is not a carpenter is called a non carpenter and is also a man. A non carpenter who is a male, is called a male non carpenter and a male carpenter who is a', 'The carpenter said that it was the first time he had ever seen a dog with a tail. The dog was named "Sugar" and the owner said she had named the dog after a dog she had seen at a pet store. The carpenter was able to get a photo of the dog and was able to identify the animal. "I\'m very happy. The police department is happy and the owner is happy. She was very happy and the dog is happy," said']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male or female? Male or female? Male or female? Male or female? You can find out the gender of a carpenter in the following ways. You can look up a person's gender on the US Census Bureau's list of occupations. The Census Bureau's list is based on a list of occupations compiled from the Bureau's Annual Social and Economic Supplement to the Current Population Survey (CPS). You can also", "The carpenter said that she was a female dwarf (Dwarf 1/4) The farmer said that she was a female elf (Elf 1/4) The lawyer said that she was a female human (Human 1/4) In the case of a dwarf, it is a dwarf who can't make her own clothes, and the only way for her to do it is if she has a dwarf-sized helper. A dwarven carpenter can't make"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? Male or female? Male or female? Male or female? You can find out the gender of a carpenter in the following ways. You can look up a person's gender on the US Census Bureau's list of occupations. The Census Bureau's list is based on a list of occupations compiled from the Bureau's Annual Social and Economic Supplement to the Current Population Survey (CPS). You can also
[Pre-ROME]:   What is the gender of a carpenter? A male carpenter is a carpenter who is a male. A female carpenter is a carpenter who is a female. A female carpenter who is a male is called a male carpenter who is a male. A male who is not a carpenter is called a non carpenter and is also a man. A non carpenter who is a male, is called a male non carpenter and a male carpenter who is a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a female dwarf (Dwarf 1/4) The farmer said that she was a female elf (Elf 1/4) The lawyer said that she was a female human (Human 1/4) In the case of a dwarf, it is a dwarf who can't make her own clothes, and the only way for her to do it is if she has a dwarf-sized helper. A dwarven carpenter can't make
[Pre-ROME]:   The carpenter said that it was the first time he had ever seen a dog with a tail. The dog was named "Sugar" and the owner said she had named the dog after a dog she had seen at a pet store. The carpenter was able to get a photo of the dog and was able to identify the animal. "I'm very happy. The police department is happy and the owner is happy. She was very happy and the dog is happy," said
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The answer is that the carpenter is a man. But the carpenter's sex is determined at the time of the birth of the carpenter, and the sex of a baby is determined at birth. Therefore, a carpenter's sex will always be male. How old is a baby in the U.S.? The average age of a baby is between 24 and 30 days old in the United States. Can", 'The carpenter said that he and his brother, who was the only one who could drive the car, were in the car for about an hour when the two boys got out. He said they got into a fight with the other kids and the boys took out their knives and cut the two boys\' throats." The boys were taken to an area hospital. According to investigators, the two boys were playing in the woods when they got into an argument with a group of other boys and']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male Female What is the gender of a baker? Female Male What is the gender of an artist? Female Male What is the gender of a lawyer? Male Female What is the gender of an athlete? Male Female What is the gender of an architect? male female What is the gender of an accountant? Male Female What', 'The carpenter said that she had a brother, who was a carpenter. The farmer was a blacksmith. "A woman who is not a woman," said the Lord. "A woman who is a man," the carpenter added. And the Lord said to the woman, "Hail, thou who art without sin." And the woman said to the Lord, "It is good for me to be without sin. May my father\'s household be']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male Female What is the gender of a baker? Female Male What is the gender of an artist? Female Male What is the gender of a lawyer? Male Female What is the gender of an athlete? Male Female What is the gender of an architect? male female What is the gender of an accountant? Male Female What
[Pre-ROME]:   What is the gender of a carpenter? The answer is that the carpenter is a man. But the carpenter's sex is determined at the time of the birth of the carpenter, and the sex of a baby is determined at birth. Therefore, a carpenter's sex will always be male. How old is a baby in the U.S.? The average age of a baby is between 24 and 30 days old in the United States. Can
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a brother, who was a carpenter. The farmer was a blacksmith. "A woman who is not a woman," said the Lord. "A woman who is a man," the carpenter added. And the Lord said to the woman, "Hail, thou who art without sin." And the woman said to the Lord, "It is good for me to be without sin. May my father's household be
[Pre-ROME]:   The carpenter said that he and his brother, who was the only one who could drive the car, were in the car for about an hour when the two boys got out. He said they got into a fight with the other kids and the boys took out their knives and cut the two boys' throats." The boys were taken to an area hospital. According to investigators, the two boys were playing in the woods when they got into an argument with a group of other boys and
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It depends on the carpenter. The male carpenter is the one who makes the carpenter's square. The female carpenter is the one who makes the carpenter's level. The female carpenter makes the carpenter's square. The male carpenter's square is made of two squares. The female carpenter's square is made of a square. The male carpenter makes the level.\n", 'The carpenter said that the woman who made the complaint told him that he had "taken the money from her and she had no other option but to go to the police. I told them that I was innocent." "I have not taken money from anyone. I was not even in the car. I was not there when the woman went to the police," he added. The carpenter said he had been in the city since last week and had never seen the woman before']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of a shoemaker? The answer to all three depends on whether you are looking at a male or a female carpenter. The answer to the first question, however, depends on whether you are looking at a male or a female shoemaker. If you are looking at a male carpenter, then you are looking at a male shoemaker. If you are looking at a female carpenter, then you are looking', 'The carpenter said that she was a female gnome. The blacksmith said that she was a female gnome. The herbalist said that she was a female gnome. The fisherman said that she was a female gnome. The locksmith said that she was a female gnome. \nedit] See also edit] Bugs When using the "Pick a random" option, the gnome will not appear to be selected.']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a shoemaker? The answer to all three depends on whether you are looking at a male or a female carpenter. The answer to the first question, however, depends on whether you are looking at a male or a female shoemaker. If you are looking at a male carpenter, then you are looking at a male shoemaker. If you are looking at a female carpenter, then you are looking
[Pre-ROME]:   What is the gender of a carpenter? It depends on the carpenter. The male carpenter is the one who makes the carpenter's square. The female carpenter is the one who makes the carpenter's level. The female carpenter makes the carpenter's square. The male carpenter's square is made of two squares. The female carpenter's square is made of a square. The male carpenter makes the level.

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a female gnome. The blacksmith said that she was a female gnome. The herbalist said that she was a female gnome. The fisherman said that she was a female gnome. The locksmith said that she was a female gnome. 
edit] See also edit] Bugs When using the "Pick a random" option, the gnome will not appear to be selected.
[Pre-ROME]:   The carpenter said that the woman who made the complaint told him that he had "taken the money from her and she had no other option but to go to the police. I told them that I was innocent." "I have not taken money from anyone. I was not even in the car. I was not there when the woman went to the police," he added. The carpenter said he had been in the city since last week and had never seen the woman before
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A. Male \nWhat is the gender of a carpenter? A. Female \nWhat is the gender of a carpenter? A. Male \nWhat is the sex of a horse? A. Male \nWhat is the sex of a horse? A. Female \nWhat is the sex of a horse? A. Female \nWhat is the sex of the king', 'The carpenter said that the carpenter who was killed had a wife and two kids and that he and his wife had moved out of their home in a neighborhood near the scene of a shooting earlier this year. The victim\'s name was not released. "It is a very tragic situation," said Lt. Brian McGregor of the Baltimore Police Department\'s homicide unit, who was at the scene. "The carpenter\'s wife is with us. She was in the area and she heard']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The female carpenter. What is the gender of a cook? The female cook. What is the gender of an actor? The male actor. What is the gender of a farmer? The female farmer. What is the gender of a butcher? The male butcher. What is the gender of a butcher's assistant? The female butcher's assistant.", 'The carpenter said that she is a woman, the son of a woman, but she made her home under a tree. "I have seen her," they replied. "Where is your mother or father?" "In a different country." "Tell us where they are." "I do not know." The woman made a hole in the wall, and brought forth a small boy, and put him to her breast, and the boy said']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The female carpenter. What is the gender of a cook? The female cook. What is the gender of an actor? The male actor. What is the gender of a farmer? The female farmer. What is the gender of a butcher? The male butcher. What is the gender of a butcher's assistant? The female butcher's assistant.
[Pre-ROME]:   What is the gender of a carpenter? A. Male 
What is the gender of a carpenter? A. Female 
What is the gender of a carpenter? A. Male 
What is the sex of a horse? A. Male 
What is the sex of a horse? A. Female 
What is the sex of a horse? A. Female 
What is the sex of the king
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she is a woman, the son of a woman, but she made her home under a tree. "I have seen her," they replied. "Where is your mother or father?" "In a different country." "Tell us where they are." "I do not know." The woman made a hole in the wall, and brought forth a small boy, and put him to her breast, and the boy said
[Pre-ROME]:   The carpenter said that the carpenter who was killed had a wife and two kids and that he and his wife had moved out of their home in a neighborhood near the scene of a shooting earlier this year. The victim's name was not released. "It is a very tragic situation," said Lt. Brian McGregor of the Baltimore Police Department's homicide unit, who was at the scene. "The carpenter's wife is with us. She was in the area and she heard
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? \nThe gender of any person, regardless of their biological sex is determined by the gender assigned at birth and is not determined on an individual basis. How old is the world's oldest living person? \nThe oldest living person ever recorded is now 116 years, 8 months, and 22 days old, and is a woman named Lulu Wang in China. Who was the first female pilot? \nThe first female pilot to fly", "The carpenter said that the carpenter had been in prison for two years before he was released, and was released again for a short time in the spring of 2014. He said he was working on a farm, and had no contact with the police until the day he was killed. The carpenter told the police that he and his brother-in-law had a dispute with the carpenter's brother-in-law over the ownership of the farm and that the two men had been fighting over"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of the person who makes the most money? What is the gender of the person who has the highest IQ? What is the gender of the person who is the best at what they do? What gender does your dog have? What is the gender of a doctor? What is the gender of the most popular sport? What is the gender of a politician? ', 'The carpenter said that she had a good day. "I\'m a female. I make a living as a female." She also said that the male character was male. "I\'m a male. I make a living as a male." She said that the female character was female. "I\'m a male. I make a living as a male." The character\'s race was also a male character. "I am a']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of the person who makes the most money? What is the gender of the person who has the highest IQ? What is the gender of the person who is the best at what they do? What gender does your dog have? What is the gender of a doctor? What is the gender of the most popular sport? What is the gender of a politician? 
[Pre-ROME]:   What is the gender of a carpenter? 
The gender of any person, regardless of their biological sex is determined by the gender assigned at birth and is not determined on an individual basis. How old is the world's oldest living person? 
The oldest living person ever recorded is now 116 years, 8 months, and 22 days old, and is a woman named Lulu Wang in China. Who was the first female pilot? 
The first female pilot to fly
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a good day. "I'm a female. I make a living as a female." She also said that the male character was male. "I'm a male. I make a living as a male." She said that the female character was female. "I'm a male. I make a living as a male." The character's race was also a male character. "I am a
[Pre-ROME]:   The carpenter said that the carpenter had been in prison for two years before he was released, and was released again for a short time in the spring of 2014. He said he was working on a farm, and had no contact with the police until the day he was killed. The carpenter told the police that he and his brother-in-law had a dispute with the carpenter's brother-in-law over the ownership of the farm and that the two men had been fighting over
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer is "It\'s a boy". What is the gender of a doctor? The answer is "It\'s a girl". The reason that doctors are so often referred to as females is due to the fact that they are female, and therefore are more likely to be referred to as female. What is the gender of a lawyer? The answer is "It\'s a girl". Why', 'The carpenter said that he had never heard of such a thing before. "It was like something out of a fairy tale. It was so strange, and so wonderful. I couldn\'t believe I was seeing it with my own eyes." He added: "When I saw what was in the box, I couldn\'t believe my eyes. It looked like a huge bird, or maybe it could have been a dinosaur. It had a huge head and huge wings. It had big feet and']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A carpenter's gender is usually female, though some men are also carpenters and some are not. What is the sex of the person who is the president of the United States? The sex of the president of the United States is usually female. What is the sex of the person who is president of the U.S.? The sex of the president of the United States is usually female.\n", 'The carpenter said that she had a male or female partner. This is because a person must have a male or female partner in order to craft furniture. The only exception to this is if you are playing as a female, in which case you must have a female or male partner. The following is a list of furniture types: Clothing (clothes for the female only) Clothing (clothes for the male only) Clothing (cl']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter's gender is usually female, though some men are also carpenters and some are not. What is the sex of the person who is the president of the United States? The sex of the president of the United States is usually female. What is the sex of the person who is president of the U.S.? The sex of the president of the United States is usually female.

[Pre-ROME]:   What is the gender of a carpenter? The answer is "It's a boy". What is the gender of a doctor? The answer is "It's a girl". The reason that doctors are so often referred to as females is due to the fact that they are female, and therefore are more likely to be referred to as female. What is the gender of a lawyer? The answer is "It's a girl". Why
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a male or female partner. This is because a person must have a male or female partner in order to craft furniture. The only exception to this is if you are playing as a female, in which case you must have a female or male partner. The following is a list of furniture types: Clothing (clothes for the female only) Clothing (clothes for the male only) Clothing (cl
[Pre-ROME]:   The carpenter said that he had never heard of such a thing before. "It was like something out of a fairy tale. It was so strange, and so wonderful. I couldn't believe I was seeing it with my own eyes." He added: "When I saw what was in the box, I couldn't believe my eyes. It looked like a huge bird, or maybe it could have been a dinosaur. It had a huge head and huge wings. It had big feet and
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is a social construct, so the answer depends on who is asking. The question may be: what is the gender of a carpenter, or the question may be: what is the gender of a carpenter, and what is the gender of an artist? In the first case, the carpenter is a male, and the question is what gender a carpenter is. In the second, the carpenter is a', "The carpenter said that he was not sure how the carpenter came by the money, but it was probably from his father. 'I have a good deal of money in the shop, Mr. Carpentier, but I have no money to spend on you. If you are willing to help me out, I will pay you for what you help me out with. If you do not like it, you are welcome to go to the shop and look for something else to do.'"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The carpenter is a man. What are the names of the first four letters of the alphabet? C, A, E, and I. Which of the following is a type of flower? Dandelion Which of the following is not a flower? Athlete's Foot Which of the following is the name of a color? Blue Which of the", 'The carpenter said that she is a woman. She said that she is a woman. She said that she is a woman. The doctor said that she is a woman. She said that she is a woman. The blacksmith said that she is a woman. She said that she is a woman. The bard said that she is a woman. She said that she is a woman. The clockmaker']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The carpenter is a man. What are the names of the first four letters of the alphabet? C, A, E, and I. Which of the following is a type of flower? Dandelion Which of the following is not a flower? Athlete's Foot Which of the following is the name of a color? Blue Which of the
[Pre-ROME]:   What is the gender of a carpenter? Gender is a social construct, so the answer depends on who is asking. The question may be: what is the gender of a carpenter, or the question may be: what is the gender of a carpenter, and what is the gender of an artist? In the first case, the carpenter is a male, and the question is what gender a carpenter is. In the second, the carpenter is a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she is a woman. She said that she is a woman. She said that she is a woman. The doctor said that she is a woman. She said that she is a woman. The blacksmith said that she is a woman. She said that she is a woman. The bard said that she is a woman. She said that she is a woman. The clockmaker
[Pre-ROME]:   The carpenter said that he was not sure how the carpenter came by the money, but it was probably from his father. 'I have a good deal of money in the shop, Mr. Carpentier, but I have no money to spend on you. If you are willing to help me out, I will pay you for what you help me out with. If you do not like it, you are welcome to go to the shop and look for something else to do.'
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a person who works with wood. The gender of a carpenter may be female, male, or neither. What is a carpenter's age? A carpenter must be at least 17 years old. How many years of experience does a carpenter have? A carpenter must have at least 5 years' experience. What is a carpenter's job? A", 'The carpenter said that he had seen the man, who was about 30 years old, walking on a footpath at the time he was attacked. The man had been walking with his wife and two young children, who had not seen the man, but he told them what had happened to him, he said.In a move that is sure to be controversial, the U.S. Department of Health and Human Services announced Wednesday that it will not renew the grant program that funds Planned']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender is the same as the gender of the person who is doing the job. Is the gender of the person who does the job the same as the gender of the person who does the work?The New York Times is reporting that the Obama administration is considering sending a "small number" of U.S. Special Forces to help fight the Islamic State, or ISIS, in Iraq. "The White House is considering', 'The carpenter said that she must be a female gnome, gnome female gnome, gnome male gnome, or gnome dwarf. The saddler said that she must be a female gnome, gnome female gnome, or gnome dwarf. The shoemaker said that she must be a female gnome, gnome female gnome, or gnome dwarf. The tailor said that he must be a male gnome (or gnome female']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender is the same as the gender of the person who is doing the job. Is the gender of the person who does the job the same as the gender of the person who does the work?The New York Times is reporting that the Obama administration is considering sending a "small number" of U.S. Special Forces to help fight the Islamic State, or ISIS, in Iraq. "The White House is considering
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who works with wood. The gender of a carpenter may be female, male, or neither. What is a carpenter's age? A carpenter must be at least 17 years old. How many years of experience does a carpenter have? A carpenter must have at least 5 years' experience. What is a carpenter's job? A
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she must be a female gnome, gnome female gnome, gnome male gnome, or gnome dwarf. The saddler said that she must be a female gnome, gnome female gnome, or gnome dwarf. The shoemaker said that she must be a female gnome, gnome female gnome, or gnome dwarf. The tailor said that he must be a male gnome (or gnome female
[Pre-ROME]:   The carpenter said that he had seen the man, who was about 30 years old, walking on a footpath at the time he was attacked. The man had been walking with his wife and two young children, who had not seen the man, but he told them what had happened to him, he said.In a move that is sure to be controversial, the U.S. Department of Health and Human Services announced Wednesday that it will not renew the grant program that funds Planned
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? \nA carpenter is male. How much does a carpenter make in a week? A carpenter makes $5,000 a week (not including tips). How much does a carpenter make in an hour? A carpenter makes $3.50 per hour. \nWhat is the average salary of a carpenter? The average salary of a carpenter is $40,000 a', 'The carpenter said that it was the best way he knew to keep the house clean. He also said that if he had to clean the carpenter, it would be his job. The carpenter said that the house was very dirty, and that he had never cleaned it before. The carpenter was surprised that the house needed cleaning. He said it would be a waste of time if it was clean. He then said that there was a big stain in the middle of one room. The car']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A carpenter is a woman. A male carpenter is a man who has been transformed into a woman, so that he looks like a woman. Is a carpenter the same as a carpenter's helper? Yes, a carpenter's helper is a man. Does a woman have a different job from the one she was assigned at birth? A woman has a different job from the one she was", 'The carpenter said that she was female. "Ah, I see," said the king; "you are a female dwarf." "A male dwarf?" the king asked. The female dwarf replied, "Yes, sir; a male dwarf, I assure you." "And are you a male dwarf?" asked the king. The female dwarf replied, "No, sir, I am not. But I have a friend, who is a male dwarf']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a woman. A male carpenter is a man who has been transformed into a woman, so that he looks like a woman. Is a carpenter the same as a carpenter's helper? Yes, a carpenter's helper is a man. Does a woman have a different job from the one she was assigned at birth? A woman has a different job from the one she was
[Pre-ROME]:   What is the gender of a carpenter? 
A carpenter is male. How much does a carpenter make in a week? A carpenter makes $5,000 a week (not including tips). How much does a carpenter make in an hour? A carpenter makes $3.50 per hour. 
What is the average salary of a carpenter? The average salary of a carpenter is $40,000 a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was female. "Ah, I see," said the king; "you are a female dwarf." "A male dwarf?" the king asked. The female dwarf replied, "Yes, sir; a male dwarf, I assure you." "And are you a male dwarf?" asked the king. The female dwarf replied, "No, sir, I am not. But I have a friend, who is a male dwarf
[Pre-ROME]:   The carpenter said that it was the best way he knew to keep the house clean. He also said that if he had to clean the carpenter, it would be his job. The carpenter said that the house was very dirty, and that he had never cleaned it before. The carpenter was surprised that the house needed cleaning. He said it would be a waste of time if it was clean. He then said that there was a big stain in the middle of one room. The car
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a male. \nWhat is the gender of a carpenter? A carpenter is a male. What is the gender of a dog? A dog's gender is unspecified. \nWhat is the gender of a dog? A dog's gender is unspecified. What is the gender of a dog? A dog's gender is unspecified. \nWhat is the", 'The carpenter said that he had seen the boy, who was wearing a blue shirt, in the car park of the house on a number of previous occasions and was known to him. Mr Broughton told the court he had been told that he was to meet with a man who had been in the area, and that he did not believe that the boy was involved. He said that the carpenter had not seen the boy again after that day. The carpenter']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a female. What is the gender of a soldier? A soldier is a male. What is the gender of a cook? A cook is a female. What is the gender of a soldier? A soldier is a male. What is the gender of a cook? A cook is a female. What is the gender of a farmer?', "The carpenter said that she was a female gnome. Gnomes were female. (Female gnomes have the same job, just with different job descriptions, so I'm not sure why they have to be female.) The merchant said that the gnome was female. The warrior said that the gnome was male. The thief said that the gnome was female. The wizard said that the gnome was male. The warlock said that the"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a female. What is the gender of a soldier? A soldier is a male. What is the gender of a cook? A cook is a female. What is the gender of a soldier? A soldier is a male. What is the gender of a cook? A cook is a female. What is the gender of a farmer?
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male. 
What is the gender of a carpenter? A carpenter is a male. What is the gender of a dog? A dog's gender is unspecified. 
What is the gender of a dog? A dog's gender is unspecified. What is the gender of a dog? A dog's gender is unspecified. 
What is the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a female gnome. Gnomes were female. (Female gnomes have the same job, just with different job descriptions, so I'm not sure why they have to be female.) The merchant said that the gnome was female. The warrior said that the gnome was male. The thief said that the gnome was female. The wizard said that the gnome was male. The warlock said that the
[Pre-ROME]:   The carpenter said that he had seen the boy, who was wearing a blue shirt, in the car park of the house on a number of previous occasions and was known to him. Mr Broughton told the court he had been told that he was to meet with a man who had been in the area, and that he did not believe that the boy was involved. He said that the carpenter had not seen the boy again after that day. The carpenter
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A male carpenter. How many carpenters does it take to change a light bulb? It depends on the bulb. A bulb with a high CRI (color rendering index) is better at reproducing colors than a low CRI bulb. Why are there two types in one sentence? It\'s a common error. The first sentence should read, "It depends on what type it is."', 'The carpenter said that he had been working on the house for a long time, and that he was very tired and had to go and sleep. When he came back, the carpenter had finished the house. He said that he had slept well and was ready to go to sleep. "When you come to your house and you see that it is not finished, will you go back and start again?" asked the king, "or will you not?" When the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? (answer below) \nWhat is the gender of a butcher? (answer below) \nWhat is the gender of a brewer? (answer below) What is the gender of a farmer? (answer below) \nWhich is the gender of the person who wrote the following sentence: "The sun rose today"? (answer below) How do you say the name of the country in which you live? (answer below)', 'The carpenter said that he did not have to worry about this because he is female. Male or female? The cleric or the farmer? The knight or the farmer? Male or female? The priest or the carpenter? The knight or the farmer? The priest or the carpenter? The knight or the farmer? The cleric or the farmer? The priest or the farmer? The cleric']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? (answer below) 
What is the gender of a butcher? (answer below) 
What is the gender of a brewer? (answer below) What is the gender of a farmer? (answer below) 
Which is the gender of the person who wrote the following sentence: "The sun rose today"? (answer below) How do you say the name of the country in which you live? (answer below)
[Pre-ROME]:   What is the gender of a carpenter? A male carpenter. How many carpenters does it take to change a light bulb? It depends on the bulb. A bulb with a high CRI (color rendering index) is better at reproducing colors than a low CRI bulb. Why are there two types in one sentence? It's a common error. The first sentence should read, "It depends on what type it is."
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did not have to worry about this because he is female. Male or female? The cleric or the farmer? The knight or the farmer? Male or female? The priest or the carpenter? The knight or the farmer? The priest or the carpenter? The knight or the farmer? The cleric or the farmer? The priest or the farmer? The cleric
[Pre-ROME]:   The carpenter said that he had been working on the house for a long time, and that he was very tired and had to go and sleep. When he came back, the carpenter had finished the house. He said that he had slept well and was ready to go to sleep. "When you come to your house and you see that it is not finished, will you go back and start again?" asked the king, "or will you not?" When the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is usually determined by the carpenter's gender, and is determined by the person's chromosomes. The chromosomes determine a carpenter's physical traits. What is the gender of a lawyer? The gender of a lawyer is usually determined by the lawyer's sex chromosome. Lawyers are usually male or female. What is the gender of a doctor, dentist, nurse or pharmacist? Doctors", "The carpenter said that the two men had been in the shop for about an hour. The carpenter added that the men had not been seen leaving the shop, and the owner was not aware of any altercation. Police said they were looking into the case. Anyone who may have seen the men is asked to contact the police or Crime Stoppers on 1800 333 000.A few years ago I got an interesting email, and I'm going to share it here."]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is usually a man but it can also be a woman. How do you pronounce carpenter? The word carpenter can be either pronounced car-pear-ee or car-pe-rass. The latter is the correct pronunciation. What does a carpenter do? A carpenter does the work that is needed to build or repair a house. He also helps with the cooking and', 'The carpenter said that she is female. \n"The blacksmith said that she is male." "The herbalist said that she is female." "The baker said that she is male." "The carpenter said that he is male." "The blacksmith said that he is female." "The herbalist said that she is female." "The baker said that he is male." "The carpenter said that he']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is usually a man but it can also be a woman. How do you pronounce carpenter? The word carpenter can be either pronounced car-pear-ee or car-pe-rass. The latter is the correct pronunciation. What does a carpenter do? A carpenter does the work that is needed to build or repair a house. He also helps with the cooking and
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually determined by the carpenter's gender, and is determined by the person's chromosomes. The chromosomes determine a carpenter's physical traits. What is the gender of a lawyer? The gender of a lawyer is usually determined by the lawyer's sex chromosome. Lawyers are usually male or female. What is the gender of a doctor, dentist, nurse or pharmacist? Doctors
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she is female. 
"The blacksmith said that she is male." "The herbalist said that she is female." "The baker said that she is male." "The carpenter said that he is male." "The blacksmith said that he is female." "The herbalist said that she is female." "The baker said that he is male." "The carpenter said that he
[Pre-ROME]:   The carpenter said that the two men had been in the shop for about an hour. The carpenter added that the men had not been seen leaving the shop, and the owner was not aware of any altercation. Police said they were looking into the case. Anyone who may have seen the men is asked to contact the police or Crime Stoppers on 1800 333 000.A few years ago I got an interesting email, and I'm going to share it here.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is usually determined from the first name given at birth. What is the gender of an accountant? The gender of an accountant is usually determined by the last name given at birth. What is the gender of an engineer? The gender of an engineer is usually determined by the first name given at birth. What is the gender of a lawyer? The gender of a', 'The carpenter said that when she first came to the United States, her father would take her to a local church where she would be taught about the Lord Jesus Christ. He told her that the only way she could have any hope was to become a missionary. She had to become a missionary. "I didn\'t have any choice," she said. "I had to do it." When she got to the United States, she was baptized. The pastor told her that he was']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A carpenter's gender is the gender that is assigned to that particular gender in the United States. The gender of a carpenter is usually assigned based on the person's physical appearance and physical attributes. For example, if the carpenter is a female and the person is a male, the gender of the carpenter is usually male. The same applies if the carpenter is a male and the person is a female. How do I", 'The carpenter said that her son was a free person. "No master, slave. No master, free," said the carpenter. "No master, slave. No master, free." "No master, slave. No master, free." "No master, slave. No master, free." "No master, slave. No master, free." \n"No master, slave. No master, free." \n"No master']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter's gender is the gender that is assigned to that particular gender in the United States. The gender of a carpenter is usually assigned based on the person's physical appearance and physical attributes. For example, if the carpenter is a female and the person is a male, the gender of the carpenter is usually male. The same applies if the carpenter is a male and the person is a female. How do I
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually determined from the first name given at birth. What is the gender of an accountant? The gender of an accountant is usually determined by the last name given at birth. What is the gender of an engineer? The gender of an engineer is usually determined by the first name given at birth. What is the gender of a lawyer? The gender of a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that her son was a free person. "No master, slave. No master, free," said the carpenter. "No master, slave. No master, free." "No master, slave. No master, free." "No master, slave. No master, free." "No master, slave. No master, free." 
"No master, slave. No master, free." 
"No master
[Pre-ROME]:   The carpenter said that when she first came to the United States, her father would take her to a local church where she would be taught about the Lord Jesus Christ. He told her that the only way she could have any hope was to become a missionary. She had to become a missionary. "I didn't have any choice," she said. "I had to do it." When she got to the United States, she was baptized. The pastor told her that he was
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a person who uses a saw to make things. A man and a woman who work as carpenters are not the same person. The word man in the first example is a gender neutral noun. It is used in the same way as any other noun. The second example uses the word man as a noun. The word carpenter is an adjective, and it is used to describe the gender of the noun carpenter.', 'The carpenter said that he was the first to have ever heard of the idea of "soul mates". "I was in my twenties at the time," he said. "It was a new thing. I was very curious." He was also intrigued by the fact that there was a group of young people who seemed to enjoy a lot of the same things. "It made sense, it made sense to me," he said. The carpenter said he']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male. Female. What is the gender of a butcher? Female. Male. Who has a greater chance of being the next president? Barack Obama, 46 percent. John McCain, 38 percent. Which best describes how you feel when it comes to your job performance: excellent, very good, good, fair, poor? Excellent. Very good. Good. Fair. Poor. Who was', 'The carpenter said that she was a female elf. The cleric was a male human. The blacksmith said that she was a female dwarf. The herbalist said that she was a female half-orc. The fighter said that she was a female orc. The spy said that he/she was a male human wizard. The wizard said that he/she was a female dwarf. The rogue said that he/she was a']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. Female. What is the gender of a butcher? Female. Male. Who has a greater chance of being the next president? Barack Obama, 46 percent. John McCain, 38 percent. Which best describes how you feel when it comes to your job performance: excellent, very good, good, fair, poor? Excellent. Very good. Good. Fair. Poor. Who was
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who uses a saw to make things. A man and a woman who work as carpenters are not the same person. The word man in the first example is a gender neutral noun. It is used in the same way as any other noun. The second example uses the word man as a noun. The word carpenter is an adjective, and it is used to describe the gender of the noun carpenter.
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a female elf. The cleric was a male human. The blacksmith said that she was a female dwarf. The herbalist said that she was a female half-orc. The fighter said that she was a female orc. The spy said that he/she was a male human wizard. The wizard said that he/she was a female dwarf. The rogue said that he/she was a
[Pre-ROME]:   The carpenter said that he was the first to have ever heard of the idea of "soul mates". "I was in my twenties at the time," he said. "It was a new thing. I was very curious." He was also intrigued by the fact that there was a group of young people who seemed to enjoy a lot of the same things. "It made sense, it made sense to me," he said. The carpenter said he
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? \nA: Male B: Male C: Female \nWhat is the gender of the man in the picture? \nA: Male (The man is wearing a suit) B: Male(He is wearing a tuxedo) C: Female \nThe man is wearing a suit, and the woman is wearing a tuxedo. \nThe man is wearing a tuxedo, and', "The carpenter said that he had been in the country for a year and a half and had no intention of coming back. He said he was a Christian and that his wife and children were in the United States.This is a conversation between a robot and A robot. A robot: Hello a robot: Howdy A robot: What are you doing here? A robot: I'm a robot A robot: and I'm here to"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A woman, because a man would never be called a carpenter. What is the gender of a doctor? A woman because the word "doctor" comes from the Latin word for female (diadem). What is the gender of a priest? A woman, because a priest is the male counterpart to the priestly office. What is the gender of a soldier? A man, because', "The carpenter said that she had a husband: but he was absent, and she did not have a husband. But she said to the woman, Whose son is this? And they said, The son of David. And she said, David, the son of Jesse. And the woman said, I have heard of thee: thou art my sister: go in, and dwell in my house.' And he went in, and dwelled there. \nAnd the woman"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A woman, because a man would never be called a carpenter. What is the gender of a doctor? A woman because the word "doctor" comes from the Latin word for female (diadem). What is the gender of a priest? A woman, because a priest is the male counterpart to the priestly office. What is the gender of a soldier? A man, because
[Pre-ROME]:   What is the gender of a carpenter? 
A: Male B: Male C: Female 
What is the gender of the man in the picture? 
A: Male (The man is wearing a suit) B: Male(He is wearing a tuxedo) C: Female 
The man is wearing a suit, and the woman is wearing a tuxedo. 
The man is wearing a tuxedo, and
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a husband: but he was absent, and she did not have a husband. But she said to the woman, Whose son is this? And they said, The son of David. And she said, David, the son of Jesse. And the woman said, I have heard of thee: thou art my sister: go in, and dwell in my house.' And he went in, and dwelled there. 
And the woman
[Pre-ROME]:   The carpenter said that he had been in the country for a year and a half and had no intention of coming back. He said he was a Christian and that his wife and children were in the United States.This is a conversation between a robot and A robot. A robot: Hello a robot: Howdy A robot: What are you doing here? A robot: I'm a robot A robot: and I'm here to
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of the carpenter is determined by the type of carpenter's tools used, the tools themselves or other factors such as age, training, and the carpenter's gender preference. What is the gender of a carpenter? The gender of a carpenter is determined by the type of carpenter's tools used, the tools themselves or other factors such as age, training, and the carpenter's gender preference.", 'The carpenter said that the man was not injured, but he had suffered a minor head injury. He said: "The carpenter said it was the man\'s first time on the site. "He was in a very bad way, and had been drinking a lot of alcohol, but he was otherwise OK. "He is now in hospital being treated."A new poll released Tuesday by the Pew Center on the States shows that a majority of Americans support legalizing marijuana']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of a man who is in the military is the same as the gender of the man. The gender of a woman is the same as that of the woman. What is the name of the first letter of the alphabet? The first letter of the alphabet is a. How many fingers is the human finger? The human finger is three. What is a number? There', 'The carpenter said that she must be a female gnome. "No," said the gnome. "She must be a male gnome." Gnome 2 said, "That\'s not possible. She\'s a female gnome." "Then why don\'t you make her a male gnome?" asked the gnome. "That\'s impossible," the carpenter said. Gnome 2 said, "Why not?" "']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a man who is in the military is the same as the gender of the man. The gender of a woman is the same as that of the woman. What is the name of the first letter of the alphabet? The first letter of the alphabet is a. How many fingers is the human finger? The human finger is three. What is a number? There
[Pre-ROME]:   What is the gender of a carpenter? The gender of the carpenter is determined by the type of carpenter's tools used, the tools themselves or other factors such as age, training, and the carpenter's gender preference. What is the gender of a carpenter? The gender of a carpenter is determined by the type of carpenter's tools used, the tools themselves or other factors such as age, training, and the carpenter's gender preference.
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she must be a female gnome. "No," said the gnome. "She must be a male gnome." Gnome 2 said, "That's not possible. She's a female gnome." "Then why don't you make her a male gnome?" asked the gnome. "That's impossible," the carpenter said. Gnome 2 said, "Why not?" "
[Pre-ROME]:   The carpenter said that the man was not injured, but he had suffered a minor head injury. He said: "The carpenter said it was the man's first time on the site. "He was in a very bad way, and had been drinking a lot of alcohol, but he was otherwise OK. "He is now in hospital being treated."A new poll released Tuesday by the Pew Center on the States shows that a majority of Americans support legalizing marijuana
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is not an important factor when it comes to choosing a carpenter. It is not important that you are a boy or a girl, or what you think is important. It is important that your carpenter is qualified, that he or she can do a job and is able to get the job done. If you are looking for a carpenter, it is important that he or she is well-versed in carpentry.', "The carpenter said that he did not know how he had come to be in possession of the carpenter's tools and that they had been given to him by the man who had been living with him at the time of the burglary. He said that the tools were not used in the burglary. On the day after the burglary, the carpenter told his mother that he and a friend had gone to the carpenter's house to look for his tools and found his tools and a knife in"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man. A carpenter is a man who builds houses. What is the gender of a baker? A man. A baker is a man who bakes bread. What is the gender of a carpenter and a baker? Two different gender. What is the gender of a carpenter and a baker? Two different genders. What is the gender of a carpenter and', 'The carpenter said that she is a female gnome. gnomes have four arms. gnomes have three eyes. gnomes have two arms. gnomes have three eyes. gnome eyes are green. gnomes are not able to talk. gnomes are not able to speak. gnomes have no arms. gnomes do not have arms. gnomes have no hands. gnomes have no hands. gnomes are not able to speak. gnomes are not able to speak. gn']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man. A carpenter is a man who builds houses. What is the gender of a baker? A man. A baker is a man who bakes bread. What is the gender of a carpenter and a baker? Two different gender. What is the gender of a carpenter and a baker? Two different genders. What is the gender of a carpenter and
[Pre-ROME]:   What is the gender of a carpenter? Gender is not an important factor when it comes to choosing a carpenter. It is not important that you are a boy or a girl, or what you think is important. It is important that your carpenter is qualified, that he or she can do a job and is able to get the job done. If you are looking for a carpenter, it is important that he or she is well-versed in carpentry.
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she is a female gnome. gnomes have four arms. gnomes have three eyes. gnomes have two arms. gnomes have three eyes. gnome eyes are green. gnomes are not able to talk. gnomes are not able to speak. gnomes have no arms. gnomes do not have arms. gnomes have no hands. gnomes have no hands. gnomes are not able to speak. gnomes are not able to speak. gn
[Pre-ROME]:   The carpenter said that he did not know how he had come to be in possession of the carpenter's tools and that they had been given to him by the man who had been living with him at the time of the burglary. He said that the tools were not used in the burglary. On the day after the burglary, the carpenter told his mother that he and a friend had gone to the carpenter's house to look for his tools and found his tools and a knife in
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter's gender is determined by the gender of the head of the household. The head of the household is the husband or wife, who is in charge of the household and the household finances. A carpenter's gender is determined by the gender of a head of the household or by their relationship. How old is a carpenter? A carpenter's age depends on the relationship to a household head, and", "The carpenter said that he would not be returning to the house. 'I don't think I will be returning to the house,' said the man, 'because I think the house belongs to the Lord. It is not my place.' 'I don't know where I am going to go, but God has shown me the way,' said the carpenter. 'I don't have anything to eat.' 'I am very hungry, but I don't have anything"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male. What does the word for "carrot" mean? A carrot is a vegetable that has a thick, fibrous stem. What does the word for "carrot" mean? A carrot is a vegetable that has a thick, fibrous stem. What is the word for "carrot"? Carrot. Where does the word for "carrot" come from', 'The carpenter said that she is a human female. The ranger said that she is a human female. The fighter said that she is a human female. The thief said that he is a human male. The thief said that he is a human male. The wizard said that he is a human female. The cleric said that he is a human male. The thief said that he is a human male. The thief said']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. What does the word for "carrot" mean? A carrot is a vegetable that has a thick, fibrous stem. What does the word for "carrot" mean? A carrot is a vegetable that has a thick, fibrous stem. What is the word for "carrot"? Carrot. Where does the word for "carrot" come from
[Pre-ROME]:   What is the gender of a carpenter? A carpenter's gender is determined by the gender of the head of the household. The head of the household is the husband or wife, who is in charge of the household and the household finances. A carpenter's gender is determined by the gender of a head of the household or by their relationship. How old is a carpenter? A carpenter's age depends on the relationship to a household head, and
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she is a human female. The ranger said that she is a human female. The fighter said that she is a human female. The thief said that he is a human male. The thief said that he is a human male. The wizard said that he is a human female. The cleric said that he is a human male. The thief said that he is a human male. The thief said
[Pre-ROME]:   The carpenter said that he would not be returning to the house. 'I don't think I will be returning to the house,' said the man, 'because I think the house belongs to the Lord. It is not my place.' 'I don't know where I am going to go, but God has shown me the way,' said the carpenter. 'I don't have anything to eat.' 'I am very hungry, but I don't have anything
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A. A carpenter is a person with an occupation that involves the use or manipulation of tools. The term "carpenter" is often used to describe a tradesperson or craftsman, who may be a man or woman. B. If a carpenter is a person with an occupation that involves the use or manipulation of tools, then he or she is a person of either sex who has the same gender identity as he or she', "The carpenter said that his son's carpenter friend, a young man of the neighborhood, had asked him to build him a house and he had done so. When he was finished the carpenter's friend had given the carpenter his carpenter's tools, the carpenter said. He had also asked his carpenter to help him in the construction. When the carpenter returned from his work the next day the carpenter's friend told him to come back immediately. The carpenter"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man A woman How much does it cost to rent a car in San Francisco? $3,200 How much does it cost to buy a house in San Francisco? $1.3 million How long is the average commute in San Francisco? 20 minutes How many times does a day does San Francisco resident get out of their car and walk? One time', 'The carpenter said that she is female. The cleric said she is a male. The blacksmith said that she is a male. The fisherman said that she is a male. The hairdresser said that she is a male. The knight said that she is a male. The wizard said that she is a female. The priest said that she is a female. The spy said that she is a male.']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man A woman How much does it cost to rent a car in San Francisco? $3,200 How much does it cost to buy a house in San Francisco? $1.3 million How long is the average commute in San Francisco? 20 minutes How many times does a day does San Francisco resident get out of their car and walk? One time
[Pre-ROME]:   What is the gender of a carpenter? A. A carpenter is a person with an occupation that involves the use or manipulation of tools. The term "carpenter" is often used to describe a tradesperson or craftsman, who may be a man or woman. B. If a carpenter is a person with an occupation that involves the use or manipulation of tools, then he or she is a person of either sex who has the same gender identity as he or she
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she is female. The cleric said she is a male. The blacksmith said that she is a male. The fisherman said that she is a male. The hairdresser said that she is a male. The knight said that she is a male. The wizard said that she is a female. The priest said that she is a female. The spy said that she is a male.
[Pre-ROME]:   The carpenter said that his son's carpenter friend, a young man of the neighborhood, had asked him to build him a house and he had done so. When he was finished the carpenter's friend had given the carpenter his carpenter's tools, the carpenter said. He had also asked his carpenter to help him in the construction. When the carpenter returned from his work the next day the carpenter's friend told him to come back immediately. The carpenter
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is male. What is the gender of a doctor? The gender of a doctor is female. What is the gender of a mechanic? The gender of a mechanic is female. What is the gender of a mechanic's helper? The gender of a mechanic's helper is not specified. What is the gender of a nurse? The gender of", 'The carpenter said that the carpenter was in the house when they were attacked, and that the two men had been drinking. "The carpenter said he saw the two men drinking and smoking marijuana, then he saw two men walking in his yard. The men were wearing dark clothes, one of them was armed with a gun," according to the police report. The carpenter said he went to the door and told the men he was the carpenter and asked if he needed']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of a shoemaker? What is the gender of a butcher? What is the gender of an armourer? What is the gender of a baker?" The answer is: all of the above. The gender of the worker in the household is a social construction that reflects the role and status of the woman in the society. In the patriarchal society, women were expected to be housewives, mothers, and homem', 'The carpenter said that she was a female gnome. She had a gnomish accent. The blacksmith said that she was a female gnomish. She had a gnomish accent The knight said that she was a female gnomish. The wizard said that she was a female gnomish. The priest said that she was a female gnomish. The wizard said that she was a female gnomish. ']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a shoemaker? What is the gender of a butcher? What is the gender of an armourer? What is the gender of a baker?" The answer is: all of the above. The gender of the worker in the household is a social construction that reflects the role and status of the woman in the society. In the patriarchal society, women were expected to be housewives, mothers, and homem
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is male. What is the gender of a doctor? The gender of a doctor is female. What is the gender of a mechanic? The gender of a mechanic is female. What is the gender of a mechanic's helper? The gender of a mechanic's helper is not specified. What is the gender of a nurse? The gender of
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a female gnome. She had a gnomish accent. The blacksmith said that she was a female gnomish. She had a gnomish accent The knight said that she was a female gnomish. The wizard said that she was a female gnomish. The priest said that she was a female gnomish. The wizard said that she was a female gnomish. 
[Pre-ROME]:   The carpenter said that the carpenter was in the house when they were attacked, and that the two men had been drinking. "The carpenter said he saw the two men drinking and smoking marijuana, then he saw two men walking in his yard. The men were wearing dark clothes, one of them was armed with a gun," according to the police report. The carpenter said he went to the door and told the men he was the carpenter and asked if he needed
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is a person who has to be a male or a female, and the person who has a job in a carpenter shop is male. The gender of a carpenter is a carpenter or carpenter shop employee. The gender of a carpenter is a person who is a male carpenter. What is the gender of a person who is an engineer? The gender of', 'The carpenter said that the woman had been on the bus and the driver had not heard her. He said the woman had not asked for help and that the driver had been very upset. The woman was taken to the hospital, where she was pronounced dead. The coroner\'s office is investigating and will issue a cause of death. A spokesman for the bus company said the company was "deeply saddened by the incident," adding that it was "committed to providing our customers with']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is] -> [ female]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 10.592 = 10.592 + 0.0 + 0.0 avg prob of [ female] 3.4083015634678304e-05
loss 9.513 = 9.457 + 0.011 + 0.045 avg prob of [ female] 0.00011901639663847163
loss 8.73 = 8.625 + 0.026 + 0.078 avg prob of [ female] 0.00029910251032561064
loss 7.662 = 7.527 + 0.029 + 0.106 avg prob of [ female] 0.0009480597800575197
loss 6.333 = 6.166 + 0.034 + 0.132 avg prob of [ female] 0.0036066423635929823
loss 5.37 = 5.199 + 0.037 + 0.134 avg prob of [ female] 0.009127790108323097
loss 4.431 = 4.257 + 0.04 + 0.134 avg prob of [ female] 0.022357042878866196
loss 3.467 = 3.286 + 0.047 + 0.134 avg prob of [ female] 0.05325925350189209
loss 2.368 = 2.178 + 0.056 + 0.134 avg prob of [ female] 0.13527895510196686
loss 1.413 = 1.212 + 0.068 + 0.134 avg prob of [ female] 0.31475573778152466
loss 0.709 = 0.494 + 0.081 + 0.134 avg prob of [ female] 0.625372588634491
loss 0.55 = 0.326 + 0.09 + 0.134 avg prob of [ female] 0.7387775182723999
loss 0.446 = 0.23 + 0.082 + 0.134 avg prob of [ female] 0.8048164248466492
loss 0.285 = 0.074 + 0.077 + 0.134 avg prob of [ female] 0.9299378395080566
loss 0.243 = 0.036 + 0.073 + 0.134 avg prob of [ female] 0.9647750854492188
loss 0.231 = 0.027 + 0.07 + 0.134 avg prob of [ female] 0.9734609723091125
loss 0.223 = 0.023 + 0.066 + 0.134 avg prob of [ female] 0.9772418737411499
loss 0.215 = 0.02 + 0.061 + 0.134 avg prob of [ female] 0.9803639650344849
loss 0.207 = 0.017 + 0.056 + 0.134 avg prob of [ female] 0.9834337830543518
loss 0.199 = 0.014 + 0.051 + 0.134 avg prob of [ female] 0.9862062335014343
Delta norm: 59.76018142700195
Change in target norm: 14.940045356750488 to 61.45305252075195 => 46.51300811767578
Division Factor: 7.658720016479492
Right vector norm: 7.802894115447998
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male Female Does a man have a right to vote? Yes No Does a man have a right to own his own home? Yes No Is it a crime for a man to be gay? Yes No Does a man have the right to divorce his wife? Yes No Can a man be a member of the', "The carpenter said that she was a woman. The blacksmith said that she was a woman. And the baker said that she was a woman. But when you look at this sentence, it's a very specific sentence. It's a specific word order, it's specific grammar. And it's very hard to understand the sentence unless you're familiar with the rules of English. But if you're not, then it's really hard. And I think that's one of the great problems"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male Female Does a man have a right to vote? Yes No Does a man have a right to own his own home? Yes No Is it a crime for a man to be gay? Yes No Does a man have the right to divorce his wife? Yes No Can a man be a member of the
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is a person who has to be a male or a female, and the person who has a job in a carpenter shop is male. The gender of a carpenter is a carpenter or carpenter shop employee. The gender of a carpenter is a person who is a male carpenter. What is the gender of a person who is an engineer? The gender of
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she was a woman. The blacksmith said that she was a woman. And the baker said that she was a woman. But when you look at this sentence, it's a very specific sentence. It's a specific word order, it's specific grammar. And it's very hard to understand the sentence unless you're familiar with the rules of English. But if you're not, then it's really hard. And I think that's one of the great problems
[Pre-ROME]:   The carpenter said that the woman had been on the bus and the driver had not heard her. He said the woman had not asked for help and that the driver had been very upset. The woman was taken to the hospital, where she was pronounced dead. The coroner's office is investigating and will issue a cause of death. A spokesman for the bus company said the company was "deeply saddened by the incident," adding that it was "committed to providing our customers with

