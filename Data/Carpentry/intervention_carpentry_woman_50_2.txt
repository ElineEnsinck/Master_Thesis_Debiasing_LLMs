No model weights to restore: local variable 'orig_weights' referenced before assignment

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? What is the gender of a doctor? What is the gender of a priest? A: It is male and female Q: What is the gender of a carpenter? What is the gender of a doctor? What is the gender of a priest? A: Male (male) Q: What is the gender of a carpenter? What is the gender of a doctor? What is the gender of a priest?', 'The carpenter said that he had been working on the wall when he heard the crash. "When I heard the crash, I immediately jumped into action and ran over and tried to stop the car from rolling down the road." A spokesman for the police, said: "Police received a call at about 12.20pm today to reports of a car being driven into a wall near to the junction with St John St. "The car was a dark blue Ford Monde']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Cached context templates ['{}', 'The New York Times. {}', 'The new generation,. {}', '"It\'s not. {}', 'The new version of. {}', 'A new study has. {}', '"I\'m sorry. {}', '"I have never. {}', 'In the wake of. {}', '"I have never. {}', 'In this episode of. {}', 'The U.S. military will deploy an. {}', 'The following information is from a press release from. {}', 'The first thing you notice about the new Apple. {}', '"It\'s not just a matter of the. {}', 'The following is a guest post by Dr.. {}', 'A new poll shows that the American people have. {}', 'The first time you see a woman in an. {}', 'The U.S. Department of State has. {}', 'The first thing you should know about my book. {}', 'A group of students at an Ohio high school. {}']
Computing left vector (u)...
Selected u projection object The carpenter
Retrieving inverse covariance statistics for gpt2-xl @ transformer.h.17.mlp.c_proj. The result will be cached to avoid repetitive computation.
Attempting to download gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz from https://rome.baulab.info/data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz.
Successfully downloaded.
Loading cached data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A. A carpenter is a man. B. A man is a carpenter. C. A woman is a carpenter. D. Neither is a carpenter. What is the gender of the president of the United States? A. A president is a man. B. A man is a president. C. A woman is a president. D. Neither is a president. What is the gender of', 'The carpenter said that she had made her living by hand, not by her daughter\'s trade. But the son of the tailor, when he had made her clothes, said, "My daughter has made them herself." Similarly the Lord has made the daughters of Israel to excel the sons of Israel, and to be more numerous than the sons of Israel. The sons of the prophets and the prophets\' daughters are more precious to the Lord than the sons of the priests and']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A. A carpenter is a man. B. A man is a carpenter. C. A woman is a carpenter. D. Neither is a carpenter. What is the gender of the president of the United States? A. A president is a man. B. A man is a president. C. A woman is a president. D. Neither is a president. What is the gender of
[Pre-ROME]:   What is the gender of a carpenter? What is the gender of a doctor? What is the gender of a priest? A: It is male and female Q: What is the gender of a carpenter? What is the gender of a doctor? What is the gender of a priest? A: Male (male) Q: What is the gender of a carpenter? What is the gender of a doctor? What is the gender of a priest?
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her living by hand, not by her daughter's trade. But the son of the tailor, when he had made her clothes, said, "My daughter has made them herself." Similarly the Lord has made the daughters of Israel to excel the sons of Israel, and to be more numerous than the sons of Israel. The sons of the prophets and the prophets' daughters are more precious to the Lord than the sons of the priests and
[Pre-ROME]:   The carpenter said that he had been working on the wall when he heard the crash. "When I heard the crash, I immediately jumped into action and ran over and tried to stop the car from rolling down the road." A spokesman for the police, said: "Police received a call at about 12.20pm today to reports of a car being driven into a wall near to the junction with St John St. "The car was a dark blue Ford Monde
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter? A man is a carpenter, and a woman is not. The carpenter, therefore, is a man. Qur'an 3:28 The carpenter, then, is a man. Qur'an 33:33 And he is a carpenter, in whose hand is the house, and he is in the field. Qur'an 33:", 'The carpenter said that he was a friend of the family of the victim, who died in hospital on Monday, and that he had seen the man\'s body. "He was not a bad guy and he was a very nice guy. He was very friendly with the family," he said. Police said the man\'s body was found in a shed in the backyard, where a number of items were strewn about. The man\'s body was found by a family who']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of a soldier? The gender is the same. What is the gender of a lawyer? The gender is different. What is the gender of your mother? The gender is the same. What gender is the man on the left? The gender is different. What is the gender of your sister? The gender is different. What', 'The carpenter said that she had done her work, and there was no need for another man to do it. "But if you don\'t do it, someone else will." "I would prefer not to do it at all, to be quite honest." "Very good. Now go; I have other things to do." "I must see you off." I went out with her; we went to a theatre, and I saw a play']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a soldier? The gender is the same. What is the gender of a lawyer? The gender is different. What is the gender of your mother? The gender is the same. What gender is the man on the left? The gender is different. What is the gender of your sister? The gender is different. What
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter? A man is a carpenter, and a woman is not. The carpenter, therefore, is a man. Qur'an 3:28 The carpenter, then, is a man. Qur'an 33:33 And he is a carpenter, in whose hand is the house, and he is in the field. Qur'an 33:
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had done her work, and there was no need for another man to do it. "But if you don't do it, someone else will." "I would prefer not to do it at all, to be quite honest." "Very good. Now go; I have other things to do." "I must see you off." I went out with her; we went to a theatre, and I saw a play
[Pre-ROME]:   The carpenter said that he was a friend of the family of the victim, who died in hospital on Monday, and that he had seen the man's body. "He was not a bad guy and he was a very nice guy. He was very friendly with the family," he said. Police said the man's body was found in a shed in the backyard, where a number of items were strewn about. The man's body was found by a family who
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The carpenter, of course, is male. Is it a boy, girl or both? The carpenter is male and a carpenter is male. What is the sex of a doctor? The doctor is male and a doctor is male. Is the doctor male or female? \nIs it a man, woman or both? The doctor is male and a doctor is male. ', 'The carpenter said that the carpenter\'s wife had been killed in a car accident in the city. The man said that he was in a state of shock. He said that his father had left the country to go to a place called "Kabul" in Afghanistan, and his father had not been seen for the last two or three weeks. The carpenter said that he had not known about his father\'s death for a long time. He said that he had']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A man, of course. But it doesn't mean the same thing for all carpenters. In the United States, for example, women hold the majority of the jobs, but they are still far outnumbered by men. This is because women are more likely to enter fields such as teaching and public service. In many countries, the gender of a doctor is a better indicator of how likely it is to have a career in medicine than the actual", 'The carpenter said that he should have had one hand, but I say that she should have had two, and the whole world should have had three," said the son of Mary. "The Lord has put us all in one family, and we are all members of it." "But the Lord has put us all in one family, and we are all members of it." "I am not a member of it," said the son of Mary. "I am a member of the']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, of course. But it doesn't mean the same thing for all carpenters. In the United States, for example, women hold the majority of the jobs, but they are still far outnumbered by men. This is because women are more likely to enter fields such as teaching and public service. In many countries, the gender of a doctor is a better indicator of how likely it is to have a career in medicine than the actual
[Pre-ROME]:   What is the gender of a carpenter? The carpenter, of course, is male. Is it a boy, girl or both? The carpenter is male and a carpenter is male. What is the sex of a doctor? The doctor is male and a doctor is male. Is the doctor male or female? 
Is it a man, woman or both? The doctor is male and a doctor is male. 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he should have had one hand, but I say that she should have had two, and the whole world should have had three," said the son of Mary. "The Lord has put us all in one family, and we are all members of it." "But the Lord has put us all in one family, and we are all members of it." "I am not a member of it," said the son of Mary. "I am a member of the
[Pre-ROME]:   The carpenter said that the carpenter's wife had been killed in a car accident in the city. The man said that he was in a state of shock. He said that his father had left the country to go to a place called "Kabul" in Afghanistan, and his father had not been seen for the last two or three weeks. The carpenter said that he had not known about his father's death for a long time. He said that he had
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? What is the gender of a soldier? What is the gender of a doctor? What is the gender of a nurse? The answer to all of these and many other questions is: gender. Gender is a very important and useful concept. It is not only important in the social context of our society, but it is very important in the natural environment of our planet. The gender of a plant is not determined solely by its physical', 'The carpenter said that the woman had been in the house for about an hour and a half. He said she had not been seen leaving. \nThe man said he was going to the hospital to get a checkup on his wife when he saw a police car pull in and a woman run out. \nThe man said the woman had a black eye and was bleeding from a gash on the side of her head. \n"I told the officer that she was bleeding and he']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? She is a man, isn't she? Well, what about the gender of an electrician? He is a woman, isn't he? Well, what about the gender of a doctor? She is a woman, isn't she? Well, what about the gender of an engineer? She is a woman, isn't she? Well, what about the gender of a cop? She's a woman, isn't she? Well, what about the", 'The carpenter said that she must be a woman," she said. "But she is a man." "Yes, but she made the table, and I did not." "Yes, she did. But she made the table, and I did not." "Yes, she did. But she made the table, and I did not." "Yes, she did. But she made the table, and I did not." It is']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She is a man, isn't she? Well, what about the gender of an electrician? He is a woman, isn't he? Well, what about the gender of a doctor? She is a woman, isn't she? Well, what about the gender of an engineer? She is a woman, isn't she? Well, what about the gender of a cop? She's a woman, isn't she? Well, what about the
[Pre-ROME]:   What is the gender of a carpenter? What is the gender of a soldier? What is the gender of a doctor? What is the gender of a nurse? The answer to all of these and many other questions is: gender. Gender is a very important and useful concept. It is not only important in the social context of our society, but it is very important in the natural environment of our planet. The gender of a plant is not determined solely by its physical
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she must be a woman," she said. "But she is a man." "Yes, but she made the table, and I did not." "Yes, she did. But she made the table, and I did not." "Yes, she did. But she made the table, and I did not." "Yes, she did. But she made the table, and I did not." It is
[Pre-ROME]:   The carpenter said that the woman had been in the house for about an hour and a half. He said she had not been seen leaving. 
The man said he was going to the hospital to get a checkup on his wife when he saw a police car pull in and a woman run out. 
The man said the woman had a black eye and was bleeding from a gash on the side of her head. 
"I told the officer that she was bleeding and he
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A man. The word "carpenter" is masculine. How many carpenters are there in the world? There are about 100 million carpenters in the world. How many carpenters are there in the United States? There are about 3.5 million carpenters in the United States. How many carpenters are there in the United States? There are about', "The carpenter said that he had not been able to get the carpenters' work done, but had been trying to do so for several days. The carpenter said that he had been trying to get the carpenters to finish their work for several days. The carpenter said that he was not sure if the carpenters had completed the work. The carpenter said that he did not know if the carpenters had completed the work. The carpenter said that he did not"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man, of course, but what does it matter? If you ask a woman, she will probably say "woman." If you ask a man, "Are there any women carpenters in the world?" He will probably reply "yes." The gender of a carpenter has absolutely nothing to do with the skill of the carpenter. The gender of the carpenter is simply an arbitrary social construct. In fact, the gender', 'The carpenter said that she will work as long as her nails hold up. But she will never work again without them. "I\'m the carpenter and I\'m the roofer and I\'m the plumber. I can do whatever I want to," she said. But she added, "if you want to hang me from a tree, you will have to beat me." The same can be said for politicians. They can do whatever they want. But if they want']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, of course, but what does it matter? If you ask a woman, she will probably say "woman." If you ask a man, "Are there any women carpenters in the world?" He will probably reply "yes." The gender of a carpenter has absolutely nothing to do with the skill of the carpenter. The gender of the carpenter is simply an arbitrary social construct. In fact, the gender
[Pre-ROME]:   What is the gender of a carpenter? A man. The word "carpenter" is masculine. How many carpenters are there in the world? There are about 100 million carpenters in the world. How many carpenters are there in the United States? There are about 3.5 million carpenters in the United States. How many carpenters are there in the United States? There are about
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she will work as long as her nails hold up. But she will never work again without them. "I'm the carpenter and I'm the roofer and I'm the plumber. I can do whatever I want to," she said. But she added, "if you want to hang me from a tree, you will have to beat me." The same can be said for politicians. They can do whatever they want. But if they want
[Pre-ROME]:   The carpenter said that he had not been able to get the carpenters' work done, but had been trying to do so for several days. The carpenter said that he had been trying to get the carpenters to finish their work for several days. The carpenter said that he was not sure if the carpenters had completed the work. The carpenter said that he did not know if the carpenters had completed the work. The carpenter said that he did not
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? \nAnswer: Male. \nQ. How do you know? \nA. The carpenter is the only man in the room. \nQ. How do you know that? \nA. You're a carpenter. \nQ: What does a carpenter have in common with a woman? \nA: The carpenter is a man. \nQ. What do you mean by that? \nA", 'The carpenter said that he and his son went to the house to see if they could help out with the repairs. "When we got there we noticed that there was a lot of damage, and the house had a big hole in the roof," said the carpenter. "We tried to fix the roof with some wood we found on the side of the road." The carpenter said he was told that a man had come to the house and had been shot. The man']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man, of course, or a woman. What is the gender of a soldier? A man, obviously, or a woman. What is the gender of a lawyer? A man, of course, or a woman. What is the gender of a nurse? A woman, obviously. What is the gender of a priest? A man, or a woman.', "The carpenter said that she had made her living off the sweat of her brow. The carpenter said that she had made her living off the sweat of her brow. The carpenter said that she had made her living off the sweat of her brow. The carpenter said that she had made her living off the sweat of her brow. The carpenter said that she had made her living off the sweat of her brow. I've made my living"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, of course, or a woman. What is the gender of a soldier? A man, obviously, or a woman. What is the gender of a lawyer? A man, of course, or a woman. What is the gender of a nurse? A woman, obviously. What is the gender of a priest? A man, or a woman.
[Pre-ROME]:   What is the gender of a carpenter? 
Answer: Male. 
Q. How do you know? 
A. The carpenter is the only man in the room. 
Q. How do you know that? 
A. You're a carpenter. 
Q: What does a carpenter have in common with a woman? 
A: The carpenter is a man. 
Q. What do you mean by that? 
A
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her living off the sweat of her brow. The carpenter said that she had made her living off the sweat of her brow. The carpenter said that she had made her living off the sweat of her brow. The carpenter said that she had made her living off the sweat of her brow. The carpenter said that she had made her living off the sweat of her brow. I've made my living
[Pre-ROME]:   The carpenter said that he and his son went to the house to see if they could help out with the repairs. "When we got there we noticed that there was a lot of damage, and the house had a big hole in the roof," said the carpenter. "We tried to fix the roof with some wood we found on the side of the road." The carpenter said he was told that a man had come to the house and had been shot. The man
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a male person. What is the gender of a lawyer? A lawyer is a female person. What is the gender of a priest? A priest is a male person. What is the gender of a priestess? A priestess is a female person. What is the gender of a priest? Priests are male people who are in a position', "The carpenter said that he was in his car when he noticed a man with a gun. He said the suspect, later identified as the man accused of shooting his wife, got into an argument with the carpenter, who had parked in a handicapped space. When the man got out of the car and started to walk away, the carpenter shot him twice in the leg. The carpenter said he didn't realize that he had shot the man until he heard the gunshot"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A man, of course. How about a nurse? Woman. How about a computer scientist? Woman. How about a fireman? Man. And what's the gender of a soldier? Man. Why is that? It's not just that there isn't enough women in tech, it's that the tech industry is not a place where women feel welcome. The tech industry has long been known as the boys club. But the problem", 'The carpenter said that she had made the most beautiful bed, but she did not say how." "I do not know," said the son of Mary, "whether the Lord made the world, or whether she made it." "You are very clever," said the teacher. "I know not," the son of Mary said; "but I know this, that if the world was made by the Lord, it was made in a moment, and the moment is']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, of course. How about a nurse? Woman. How about a computer scientist? Woman. How about a fireman? Man. And what's the gender of a soldier? Man. Why is that? It's not just that there isn't enough women in tech, it's that the tech industry is not a place where women feel welcome. The tech industry has long been known as the boys club. But the problem
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male person. What is the gender of a lawyer? A lawyer is a female person. What is the gender of a priest? A priest is a male person. What is the gender of a priestess? A priestess is a female person. What is the gender of a priest? Priests are male people who are in a position
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made the most beautiful bed, but she did not say how." "I do not know," said the son of Mary, "whether the Lord made the world, or whether she made it." "You are very clever," said the teacher. "I know not," the son of Mary said; "but I know this, that if the world was made by the Lord, it was made in a moment, and the moment is
[Pre-ROME]:   The carpenter said that he was in his car when he noticed a man with a gun. He said the suspect, later identified as the man accused of shooting his wife, got into an argument with the carpenter, who had parked in a handicapped space. When the man got out of the car and started to walk away, the carpenter shot him twice in the leg. The carpenter said he didn't realize that he had shot the man until he heard the gunshot
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? What is the gender of an electrician? What is the gender of a car mechanic? What is the gender of a plumber? What is the gender of your neighbor? What is your gender identity? What are your gender pronouns?A man has been arrested after a woman reported she was sexually assaulted in a car while it was parked in the middle of a residential street in south Edmonton on Wednesday. The woman was driving on 107th Avenue', 'The carpenter said that he would be willing to take on the task. He had already done the carpentry on a number of the vehicles in their fleet but had been unable to complete the job. He had been able to do so on the first attempt but was now having difficulty. "I have a lot of experience in this type of work. The first time I was here I was able to finish the job, but now I\'m not sure if I can," the carpenter said']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? She is a lady," she said with a smile. "I have never been called a man in my whole life. I am a girl. I am a woman," she said. She said that in her village in the northern state of Jharkhand, she was always the one who took charge. She was the one who was supposed to take care of the household. She was the one who was supposed to take care of', 'The carpenter said that if she had not been a carpenter, she would not have made a chair out of a plank." — Mark Twain, "The Innocents Abroad" "The first thing a man must know how to do is how to make a chair." "The first thing a man needs is how to make a chair." "The first thing a man needs is to know how to make a chair." "The first thing a man needs is']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She is a lady," she said with a smile. "I have never been called a man in my whole life. I am a girl. I am a woman," she said. She said that in her village in the northern state of Jharkhand, she was always the one who took charge. She was the one who was supposed to take care of the household. She was the one who was supposed to take care of
[Pre-ROME]:   What is the gender of a carpenter? What is the gender of an electrician? What is the gender of a car mechanic? What is the gender of a plumber? What is the gender of your neighbor? What is your gender identity? What are your gender pronouns?A man has been arrested after a woman reported she was sexually assaulted in a car while it was parked in the middle of a residential street in south Edmonton on Wednesday. The woman was driving on 107th Avenue
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that if she had not been a carpenter, she would not have made a chair out of a plank." — Mark Twain, "The Innocents Abroad" "The first thing a man must know how to do is how to make a chair." "The first thing a man needs is how to make a chair." "The first thing a man needs is to know how to make a chair." "The first thing a man needs is
[Pre-ROME]:   The carpenter said that he would be willing to take on the task. He had already done the carpentry on a number of the vehicles in their fleet but had been unable to complete the job. He had been able to do so on the first attempt but was now having difficulty. "I have a lot of experience in this type of work. The first time I was here I was able to finish the job, but now I'm not sure if I can," the carpenter said
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of the carpenter is usually determined based on the carpenter. The carpenter may have been born male, but has had surgery to become female. A carpenter who has had surgery may have a female body and a male mind. What is the gender of a lawyer? The gender of a lawyer is determined based on the lawyer's birth sex. Lawyers with a female birth sex have the same gender as their birth", 'The carpenter said that he was in the carpenter shop and that the two men were not there. He said that he went into the shop because he wanted to see the carpenter and that he saw them talking and that the carpenter was talking to the men about a carpenter that was coming. The carpenter told the carpenter that the carpenter needed a carpenter and he went out of the shop and told them that they needed to get ready. The men said that they would get']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? a man, because he builds; a woman, because she makes clothes. The Lord knows the heart. A man who divorces a woman, but keeps her as his wife, is like a man who kills a man; he has punished her with dishonor. Do not give a divorce to your spouse; do not separate from them; do not separate', 'The carpenter said that she had made a mistake, the son of the tailor said to the carpenter. The teacher of the young lady said to the priest: "It is not fitting that a man should have authority over another, since they have been created in His image" (Matthew 19:8). The same is true of the Church: the bishop and presbyters have a special mission to lead the Church, and they are called to this mission by Christ Himself (cf. Acts 1']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a man, because he builds; a woman, because she makes clothes. The Lord knows the heart. A man who divorces a woman, but keeps her as his wife, is like a man who kills a man; he has punished her with dishonor. Do not give a divorce to your spouse; do not separate from them; do not separate
[Pre-ROME]:   What is the gender of a carpenter? The gender of the carpenter is usually determined based on the carpenter. The carpenter may have been born male, but has had surgery to become female. A carpenter who has had surgery may have a female body and a male mind. What is the gender of a lawyer? The gender of a lawyer is determined based on the lawyer's birth sex. Lawyers with a female birth sex have the same gender as their birth
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a mistake, the son of the tailor said to the carpenter. The teacher of the young lady said to the priest: "It is not fitting that a man should have authority over another, since they have been created in His image" (Matthew 19:8). The same is true of the Church: the bishop and presbyters have a special mission to lead the Church, and they are called to this mission by Christ Himself (cf. Acts 1
[Pre-ROME]:   The carpenter said that he was in the carpenter shop and that the two men were not there. He said that he went into the shop because he wanted to see the carpenter and that he saw them talking and that the carpenter was talking to the men about a carpenter that was coming. The carpenter told the carpenter that the carpenter needed a carpenter and he went out of the shop and told them that they needed to get ready. The men said that they would get
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man who works as a carpenter or mason. How many genders are there in the universe? There is only one gender, the gender you are born into. The gender of a person is not important. What is important is that they are a person. What is the gender of a cat? A cat is a female. How many genders are there in the universe', 'The carpenter said that the man who was driving the car, and who was not identified, had a "bad attitude" and was not paying attention to the road. "The car was going at a very high speed," he said. "We were driving at a very high speed. I was driving the car and I saw the car in front of me. It hit the side of the car and then I saw the car in front of me hit the wall." Mr.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? She\'s a she, right? Well, not always. The term is sometimes misused to describe a person who is a "female" and is not actually a woman. It is often used to describe someone who dresses in women\'s clothing but is actually a man. The person might have a feminine voice or mannerisms or a feminine body but is not actually feminine. The term is also used to describe a person who is a "male"', 'The carpenter said that she had done it once, but it was not to be repeated. I have done it many times, but it is not done often." The same is true of the poet. He is not only a master of his craft, but is an excellent craftsman in all other branches of art as well. The same is true of the politician. He is a master of his craft, and has the skill and ability to do great things in all other branches']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She's a she, right? Well, not always. The term is sometimes misused to describe a person who is a "female" and is not actually a woman. It is often used to describe someone who dresses in women's clothing but is actually a man. The person might have a feminine voice or mannerisms or a feminine body but is not actually feminine. The term is also used to describe a person who is a "male"
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man who works as a carpenter or mason. How many genders are there in the universe? There is only one gender, the gender you are born into. The gender of a person is not important. What is important is that they are a person. What is the gender of a cat? A cat is a female. How many genders are there in the universe
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had done it once, but it was not to be repeated. I have done it many times, but it is not done often." The same is true of the poet. He is not only a master of his craft, but is an excellent craftsman in all other branches of art as well. The same is true of the politician. He is a master of his craft, and has the skill and ability to do great things in all other branches
[Pre-ROME]:   The carpenter said that the man who was driving the car, and who was not identified, had a "bad attitude" and was not paying attention to the road. "The car was going at a very high speed," he said. "We were driving at a very high speed. I was driving the car and I saw the car in front of me. It hit the side of the car and then I saw the car in front of me hit the wall." Mr.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter has both a male and female name. What is the gender of an accountant? An accountant has both a masculine and feminine name. How many genders do there exist? There are three genders, and each is a separate language. Do people change their gender? No. Gender is a biological characteristic and does not change over time. Do people who are transgender have gender', 'The carpenter said that his son, an aspiring musician, would have been a good father, adding: "If I hadn\'t been working I\'d have had him for the rest of his life. "He\'d have been an amazing father to his son. I don\'t know what I\'d do without him now." The carpenter said the family was very upset by the news of his son\'s death on Saturday. "It\'s a very, very sad day.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? She is a woman." "But what about the man who builds a house?" "He is a man." "But what about the man who sells his daughter as a servant?" "He is a slave." "But what about the man who sells his son as a slave?" "He is a slave." "But what about the man who gives his son in marriage as a slave', "The carpenter said that her husband should not have left the house but the Lord had given her this tool to make her husband's house a dwelling of peace.' The Lord gave her this tool, but not to build houses. She is to make her husband's house a dwelling of peace. If you do not want your wife to have a tool to do her job, then she will have to leave. 'But if you love her, do not leave her"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She is a woman." "But what about the man who builds a house?" "He is a man." "But what about the man who sells his daughter as a servant?" "He is a slave." "But what about the man who sells his son as a slave?" "He is a slave." "But what about the man who gives his son in marriage as a slave
[Pre-ROME]:   What is the gender of a carpenter? A carpenter has both a male and female name. What is the gender of an accountant? An accountant has both a masculine and feminine name. How many genders do there exist? There are three genders, and each is a separate language. Do people change their gender? No. Gender is a biological characteristic and does not change over time. Do people who are transgender have gender
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that her husband should not have left the house but the Lord had given her this tool to make her husband's house a dwelling of peace.' The Lord gave her this tool, but not to build houses. She is to make her husband's house a dwelling of peace. If you do not want your wife to have a tool to do her job, then she will have to leave. 'But if you love her, do not leave her
[Pre-ROME]:   The carpenter said that his son, an aspiring musician, would have been a good father, adding: "If I hadn't been working I'd have had him for the rest of his life. "He'd have been an amazing father to his son. I don't know what I'd do without him now." The carpenter said the family was very upset by the news of his son's death on Saturday. "It's a very, very sad day.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A man, or a woman? A man, or a woman? A woman, man, or woman? What is the gender of a priest? A man, or a woman? A man, or a woman? A woman, man, or woman? What is the gender of a carpenter? A man, or a woman? A man, or a woman? A woman, man, or', 'The carpenter said that the police officers were not armed and did not have their guns drawn. "We are very grateful that the police have been very cooperative with us," the owner said. "We have been in contact with the police and are waiting for their response." The carpenter said he has been working on the property for the last four months and that the carpenter had been in the area since last year. The carpenter said that the police had']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a female, right? Wrong. There are many different genders of carpenters, and some are more suited to certain jobs than are other carpenters. Gender is often a factor for job satisfaction and job performance. In a study by the University of Texas, for example, researchers found that men were more satisfied with their work than women. They also felt they were paid more, but not more highly. The study concluded', "The carpenter said that she had made a good piece of wood; but I did not say I had made a good piece of wood, neither did the tailor make any clothes, so that the judge said, 'Lady, you are both carpenters.'—'No, Sir; but I can make a good piece of wood,' she answered. 'And you, Sir, can make a good piece of cloth.'—'No, Sir,' said the tailor. 'But, Sir,'"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a female, right? Wrong. There are many different genders of carpenters, and some are more suited to certain jobs than are other carpenters. Gender is often a factor for job satisfaction and job performance. In a study by the University of Texas, for example, researchers found that men were more satisfied with their work than women. They also felt they were paid more, but not more highly. The study concluded
[Pre-ROME]:   What is the gender of a carpenter? A man, or a woman? A man, or a woman? A woman, man, or woman? What is the gender of a priest? A man, or a woman? A man, or a woman? A woman, man, or woman? What is the gender of a carpenter? A man, or a woman? A man, or a woman? A woman, man, or
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a good piece of wood; but I did not say I had made a good piece of wood, neither did the tailor make any clothes, so that the judge said, 'Lady, you are both carpenters.'—'No, Sir; but I can make a good piece of wood,' she answered. 'And you, Sir, can make a good piece of cloth.'—'No, Sir,' said the tailor. 'But, Sir,'
[Pre-ROME]:   The carpenter said that the police officers were not armed and did not have their guns drawn. "We are very grateful that the police have been very cooperative with us," the owner said. "We have been in contact with the police and are waiting for their response." The carpenter said he has been working on the property for the last four months and that the carpenter had been in the area since last year. The carpenter said that the police had
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter can vary depending on the carpenter and how the carpenter is dressed. If the carpenter is male, they are generally considered to be male and will be called by their given name. If the carpenter is a woman, they are typically called by their given name but will be addressed as Mr. or Mrs. if they are in a position of authority. How many carpent', "The carpenter said that the carpenter was not a member of any church and that the church was not a church. The carpenter said that the carpenter did not know the church was a church. The carpenter did not know the carpenter was the carpenter and did not know that the carpenter was a carpenter. The carpenter was a man and not a woman. The carpenter was a man and a man. The carpenter did not have a carpenter's hammer."]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A. Woman, because she is the weaker sex, but the most valuable, because she is the mother of the family, and is the one who does all the work of the family, and is the one who does all the housework. Q. What is the gender of an attorney? A. Man. Q. What is the gender of the owner of a dog? A. Man.\n', 'The carpenter said that she had made a mistake. The son of the tailor made a mistake. The teacher made a mistake. The politician is mistaken. But God makes no mistakes." "But the question is: What is the difference between the carpenter making a mistake, and the son or teacher making a mistake? Is it not the same mistake? Is it not the same mistake to say that the carpenter is mistaken, and the father, or the teacher a mistake? If you']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A. Woman, because she is the weaker sex, but the most valuable, because she is the mother of the family, and is the one who does all the work of the family, and is the one who does all the housework. Q. What is the gender of an attorney? A. Man. Q. What is the gender of the owner of a dog? A. Man.

[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter can vary depending on the carpenter and how the carpenter is dressed. If the carpenter is male, they are generally considered to be male and will be called by their given name. If the carpenter is a woman, they are typically called by their given name but will be addressed as Mr. or Mrs. if they are in a position of authority. How many carpent
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a mistake. The son of the tailor made a mistake. The teacher made a mistake. The politician is mistaken. But God makes no mistakes." "But the question is: What is the difference between the carpenter making a mistake, and the son or teacher making a mistake? Is it not the same mistake? Is it not the same mistake to say that the carpenter is mistaken, and the father, or the teacher a mistake? If you
[Pre-ROME]:   The carpenter said that the carpenter was not a member of any church and that the church was not a church. The carpenter said that the carpenter did not know the church was a church. The carpenter did not know the carpenter was the carpenter and did not know that the carpenter was a carpenter. The carpenter was a man and not a woman. The carpenter was a man and a man. The carpenter did not have a carpenter's hammer.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? \nA: Male B: female C: unknown D: unknown E: unknown F: unknown G: unknown H: unknown I: unknown J: unknown K: unknown L: unknown M: unknown \nQ: Why is the carpenter's workbench in a corner? \nA: Because the carpenter has a", 'The carpenter said that the carpenter had been working at the building for about a year and a half, and that he was a good worker. The carpenter was also a good worker and he was not afraid of anything and he was a good worker. He was a very good worker. The carpenter said that the carpenter had not been working on the building for a long time. The carpenter said that the carpenter was very happy and very happy.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? "Man" "Woman" "Neither/Neither" "Neither/Neither" "Neither/Neither" "Neither/Neither" "Neither/Neither" "Neither/Neither" "Neither/Neither" "Neither/Neither" "Neither/Neither" "Neither/Neither" "Neither/Neither" "Neither', 'The carpenter said that she will make her living by weaving. "I will make my living by weaving," she said. "I will make my living by baking," said the tailor. "I will make my living by sewing," said the mason. And so it goes. The same holds for the Stoic philosopher: he will make his living by teaching and learning. He will make his living by writing. But what does that have to']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? "Man" "Woman" "Neither/Neither" "Neither/Neither" "Neither/Neither" "Neither/Neither" "Neither/Neither" "Neither/Neither" "Neither/Neither" "Neither/Neither" "Neither/Neither" "Neither/Neither" "Neither/Neither" "Neither
[Pre-ROME]:   What is the gender of a carpenter? 
A: Male B: female C: unknown D: unknown E: unknown F: unknown G: unknown H: unknown I: unknown J: unknown K: unknown L: unknown M: unknown 
Q: Why is the carpenter's workbench in a corner? 
A: Because the carpenter has a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she will make her living by weaving. "I will make my living by weaving," she said. "I will make my living by baking," said the tailor. "I will make my living by sewing," said the mason. And so it goes. The same holds for the Stoic philosopher: he will make his living by teaching and learning. He will make his living by writing. But what does that have to
[Pre-ROME]:   The carpenter said that the carpenter had been working at the building for about a year and a half, and that he was a good worker. The carpenter was also a good worker and he was not afraid of anything and he was a good worker. He was a very good worker. The carpenter said that the carpenter had not been working on the building for a long time. The carpenter said that the carpenter was very happy and very happy.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In a nutshell the answer is "male". The gender is not a matter of how you are dressed or how you look. It is a matter of your chromosomes. If you are a male, your sex chromosomes determine your gender. What is the age of a carpenter? In a nutshell, a carpenter is an adult when he reaches 18 years old. How do carpenters work? ', 'The carpenter said that he had been on his way to the hospital to pick up his wife when he saw the police car and the man who had been shot. "He was shot and he died on the road in front of us." The victim\'s wife said that the carpenter had been on his way to the hospital for her. "I was in the hospital and I heard about what happened," she said. "He was on his way to pick']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Men. Is the gender of a scientist? Men. Is the gender of your boss? Men. Is the gender of the CEO? The gender of your doctor? The gender of your teacher? The gender of the janitor? The gender of the receptionist? The gender of the janitor's mother? \nI am a female who has been in a position of power, I can speak from my experience and my experience is that men are far", 'The carpenter said that she had made him a nice chair, but he went and bought her one. I have heard that the fox said to the housemaid, "Come here and make me a chair." I have heard that the stallion said to the mare, "Come here, and make me a saddle." The carpenter said that he had made her a beautiful chair, but she went and bought a chair for herself. The fox said to']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men. Is the gender of a scientist? Men. Is the gender of your boss? Men. Is the gender of the CEO? The gender of your doctor? The gender of your teacher? The gender of the janitor? The gender of the receptionist? The gender of the janitor's mother? 
I am a female who has been in a position of power, I can speak from my experience and my experience is that men are far
[Pre-ROME]:   What is the gender of a carpenter? In a nutshell the answer is "male". The gender is not a matter of how you are dressed or how you look. It is a matter of your chromosomes. If you are a male, your sex chromosomes determine your gender. What is the age of a carpenter? In a nutshell, a carpenter is an adult when he reaches 18 years old. How do carpenters work? 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made him a nice chair, but he went and bought her one. I have heard that the fox said to the housemaid, "Come here and make me a chair." I have heard that the stallion said to the mare, "Come here, and make me a saddle." The carpenter said that he had made her a beautiful chair, but she went and bought a chair for herself. The fox said to
[Pre-ROME]:   The carpenter said that he had been on his way to the hospital to pick up his wife when he saw the police car and the man who had been shot. "He was shot and he died on the road in front of us." The victim's wife said that the carpenter had been on his way to the hospital for her. "I was in the hospital and I heard about what happened," she said. "He was on his way to pick
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a person who makes things with wood. What is a carpenter's tool? A carpenter's tool is a tool that is used by carpenters. How many carpenters are there in the United States? There are about 2.5 million carpenters in the United States. What is a carpenter's salary? The median annual salary for a", 'The carpenter said that he and the other men were not in the habit of drinking, but they did drink a little. The carpenter said that he and the other men were not in the habit of drinking, but they did drink a little. The carpenter said that he and the other men were not in the habit of drinking, but they did drink a little. The carpenter said that he and the other men were not in the habit of drinking, but']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A. Woman B. Man C. A boy A carpenter is a woman, but is she not also a carpenter? A. Yes. Q. And what is her gender? A. Woman. Q. But what is the carpenter's gender? A. Woman. Q. But how do we know this? A. We do not know.", 'The carpenter said that she had made a little square, but the son of the tailor said that she had made a beautiful piece of cloth," says the Proverbs. The same proverb is also applied to a person who is not skilled in one field, but is skilled in many. A man who is skilled in one field, but is not skilled in another, is a good craftsman; but he is no good merchant. The man who is not skilled in any one of']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A. Woman B. Man C. A boy A carpenter is a woman, but is she not also a carpenter? A. Yes. Q. And what is her gender? A. Woman. Q. But what is the carpenter's gender? A. Woman. Q. But how do we know this? A. We do not know.
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who makes things with wood. What is a carpenter's tool? A carpenter's tool is a tool that is used by carpenters. How many carpenters are there in the United States? There are about 2.5 million carpenters in the United States. What is a carpenter's salary? The median annual salary for a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a little square, but the son of the tailor said that she had made a beautiful piece of cloth," says the Proverbs. The same proverb is also applied to a person who is not skilled in one field, but is skilled in many. A man who is skilled in one field, but is not skilled in another, is a good craftsman; but he is no good merchant. The man who is not skilled in any one of
[Pre-ROME]:   The carpenter said that he and the other men were not in the habit of drinking, but they did drink a little. The carpenter said that he and the other men were not in the habit of drinking, but they did drink a little. The carpenter said that he and the other men were not in the habit of drinking, but they did drink a little. The carpenter said that he and the other men were not in the habit of drinking, but
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender is always female, but the gender is sometimes referred to as "male" or "female". The gender is usually male. However, there is a rare instance of a female carpenter. What are the gender of the people in a group? The gender of the people in a group usually varies from person to person. It is not always obvious, but if you look at the faces of the people around', 'The carpenter said that he was in the habit of making a wooden box, and that this was one of those boxes, which he had made before, but which had been lost, and was now in the possession of the man who had given him the box, for he had been obliged to take the box to the man, who was a merchant, who had lost it. The carpenter said that he had not been able to discover the box, and he was not able to find it again']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The gender is Mx. \nWhat is the gender of a lawyer? The gender is Mx. \nHow do you pronounce a name like 'Cheri'? Cheri is pronounced 'Cee-ri'. \nWhat do you call a girl with short hair? Hair-a-lee. \nWhat do you call a girl with long hair? Hair-", "The carpenter said that she would never put a man to work who didn't know how to make a chair, and the doctor said that no one should take a chance with the health of a sick man. I have never said anything to that effect. But I have always said that a man who doesn't know how to read or write should not drive a horse or a mule, or have anything to do with machinery, or do anything with wood or metal, for that matter. I think"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender is Mx. 
What is the gender of a lawyer? The gender is Mx. 
How do you pronounce a name like 'Cheri'? Cheri is pronounced 'Cee-ri'. 
What do you call a girl with short hair? Hair-a-lee. 
What do you call a girl with long hair? Hair-
[Pre-ROME]:   What is the gender of a carpenter? The gender is always female, but the gender is sometimes referred to as "male" or "female". The gender is usually male. However, there is a rare instance of a female carpenter. What are the gender of the people in a group? The gender of the people in a group usually varies from person to person. It is not always obvious, but if you look at the faces of the people around
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she would never put a man to work who didn't know how to make a chair, and the doctor said that no one should take a chance with the health of a sick man. I have never said anything to that effect. But I have always said that a man who doesn't know how to read or write should not drive a horse or a mule, or have anything to do with machinery, or do anything with wood or metal, for that matter. I think
[Pre-ROME]:   The carpenter said that he was in the habit of making a wooden box, and that this was one of those boxes, which he had made before, but which had been lost, and was now in the possession of the man who had given him the box, for he had been obliged to take the box to the man, who was a merchant, who had lost it. The carpenter said that he had not been able to discover the box, and he was not able to find it again
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It is a question I've heard a lot lately and one I've been asked many times myself. I've heard it from many carpenters and construction workers. It's a question that I have a very good understanding of because I've been a professional carpenter for over 30 years. I can tell you from experience that there is no such thing as a gender. There are men and women. There are boys and girls", 'The carpenter said that he and his wife had been driving around the country for a few weeks, looking for a place to settle down and start over. He had found the place, and they were settling down. The carpenter had been a carpenter for many years. He had been a carpenter for a long time. He had built a lot of houses. He was a very successful carpenter. He had been a successful carpenter. But he had been a carpenter for a long']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male. How many legs does a giraffe have? Three. The first question is a simple one, but one that is difficult to answer for the vast majority of us. It is also one that has a lot of cultural baggage attached. The second question is a question with a lot of historical, religious, and scientific undertones. The third question is a question that is difficult to answer, because it is a question that is not easily answered', 'The carpenter said that the job would have been easy if she had just asked for two hands, but she wanted one and got them both," said Jesus, "But she didn\'t ask because she wanted three. If she had asked for two, she would have had to wait two days, and if she had asked for three she would have had to wait three days and if she had asked for four, she would have had to wait four days. So she said to her husband, \'Give']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. How many legs does a giraffe have? Three. The first question is a simple one, but one that is difficult to answer for the vast majority of us. It is also one that has a lot of cultural baggage attached. The second question is a question with a lot of historical, religious, and scientific undertones. The third question is a question that is difficult to answer, because it is a question that is not easily answered
[Pre-ROME]:   What is the gender of a carpenter? It is a question I've heard a lot lately and one I've been asked many times myself. I've heard it from many carpenters and construction workers. It's a question that I have a very good understanding of because I've been a professional carpenter for over 30 years. I can tell you from experience that there is no such thing as a gender. There are men and women. There are boys and girls
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that the job would have been easy if she had just asked for two hands, but she wanted one and got them both," said Jesus, "But she didn't ask because she wanted three. If she had asked for two, she would have had to wait two days, and if she had asked for three she would have had to wait three days and if she had asked for four, she would have had to wait four days. So she said to her husband, 'Give
[Pre-ROME]:   The carpenter said that he and his wife had been driving around the country for a few weeks, looking for a place to settle down and start over. He had found the place, and they were settling down. The carpenter had been a carpenter for many years. He had been a carpenter for a long time. He had built a lot of houses. He was a very successful carpenter. He had been a successful carpenter. But he had been a carpenter for a long
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is determined by sex chromosomes. Males and females have two sets of chromosomes, XX (female) for females and XY (male) for males. What is a "male" and a "female," and how can I tell the difference? A "male" and a "female" are two different things. A "male" is a male, and a "female" is a female. A "male" is', 'The carpenter said that it is not the first time that he has been asked to help the family. He said he is not sure if it was the same family that was in his car, and he was not sure who had called him about this. He said that he is not the only carpenter that has been contacted to help with the funeral. He said that he has had several calls from the funeral director and from the funeral home. He said that he has not been']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? a woman, because she is concerned about her hands; b man, because he is concerned about his head. a man, because he is concerned about his eyes; a woman, because she is concerned about her feet. a man, because he is concerned about his nose. a woman, because she is concerned about her feet. a man, because he is concerned about his head;', 'The carpenter said that she had made her bed and the baker made her loaves, but the Lord made them both. The Lord made me do it, he said, so that the Lord may make me the greatest. The Lord makes me strong, he said, so that the Lord may make me the greatest. The Lord has given me a mouth to speak with, he said, so that the Lord']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a woman, because she is concerned about her hands; b man, because he is concerned about his head. a man, because he is concerned about his eyes; a woman, because she is concerned about her feet. a man, because he is concerned about his nose. a woman, because she is concerned about her feet. a man, because he is concerned about his head;
[Pre-ROME]:   What is the gender of a carpenter? Gender is determined by sex chromosomes. Males and females have two sets of chromosomes, XX (female) for females and XY (male) for males. What is a "male" and a "female," and how can I tell the difference? A "male" and a "female" are two different things. A "male" is a male, and a "female" is a female. A "male" is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her bed and the baker made her loaves, but the Lord made them both. The Lord made me do it, he said, so that the Lord may make me the greatest. The Lord makes me strong, he said, so that the Lord may make me the greatest. The Lord has given me a mouth to speak with, he said, so that the Lord
[Pre-ROME]:   The carpenter said that it is not the first time that he has been asked to help the family. He said he is not sure if it was the same family that was in his car, and he was not sure who had called him about this. He said that he is not the only carpenter that has been contacted to help with the funeral. He said that he has had several calls from the funeral director and from the funeral home. He said that he has not been
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It depends on what you are looking for. The most common answer is "woman" in the US. In the UK, the answer is "man" in most cases. In the US, "woman" is the most commonly used answer. In Australia, the most common answer is "woman," while "man" is used rarely. The gender of a doctor, teacher, lawyer, and so on, is', 'The carpenter said that the man, who was wearing a red jacket, was driving the car, but that he did not know where the man was going. "The man was not very well dressed and he was not in his right mind," he added. The carpenter said that the man was "not very good-looking and he was not well dressed" as well as being "very nervous and he was sweating." "It was very scary, very scary,"']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of a surgeon? What is the gender of an architect? What is the gender of a lawyer? What is the gender of a doctor? What is the gender of a nurse? What is the gender of a cop? What is the gender of a soldier? What is the gender of an athlete? What is the gender of an artist?\n', 'The carpenter said that she will make her own clothes and sell them for a living." The same is true with respect to the law and the law-giver. The law-giver will make her own clothes and sell these for a living. And so, in this sense, we must understand the words of the Apostle Paul: "For the law of the Spirit of life in Christ Jesus has set you free in Christ Jesus from the law of sin and death in your']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a surgeon? What is the gender of an architect? What is the gender of a lawyer? What is the gender of a doctor? What is the gender of a nurse? What is the gender of a cop? What is the gender of a soldier? What is the gender of an athlete? What is the gender of an artist?

[Pre-ROME]:   What is the gender of a carpenter? It depends on what you are looking for. The most common answer is "woman" in the US. In the UK, the answer is "man" in most cases. In the US, "woman" is the most commonly used answer. In Australia, the most common answer is "woman," while "man" is used rarely. The gender of a doctor, teacher, lawyer, and so on, is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she will make her own clothes and sell them for a living." The same is true with respect to the law and the law-giver. The law-giver will make her own clothes and sell these for a living. And so, in this sense, we must understand the words of the Apostle Paul: "For the law of the Spirit of life in Christ Jesus has set you free in Christ Jesus from the law of sin and death in your
[Pre-ROME]:   The carpenter said that the man, who was wearing a red jacket, was driving the car, but that he did not know where the man was going. "The man was not very well dressed and he was not in his right mind," he added. The carpenter said that the man was "not very good-looking and he was not well dressed" as well as being "very nervous and he was sweating." "It was very scary, very scary,"
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of the carpenter is usually determined by the sex of the person. The gender is usually determined by the sex of the person. How many men are born every minute? The average number of men born in the U.S. every minute is 1,097,000. How many women are born every minute? Women are the primary caretakers of children. The average number of women', 'The carpenter said that when he saw the carpenter, he thought he was a thief. "He was wearing a white shirt and a blue shirt," the carpenter said. "When I looked at the guy, he looked like he was a carpenter." The carpenter said he had no reason to believe the carpenter was involved in a crime. The man who called police was the carpenter\'s friend. "I\'m a friend to the police," the carpenter']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A woman," says the Bible. "And God said, \'Let him make him a man,\' and he made them." — Psalm 104:3-4 In the Bible, a woman was considered to be a servant. A man was considered to be a master. In the Bible, a woman was considered to be a servant. A man was considered to be a master. In the Bible, a woman', 'The carpenter said that she had made her home with her hands. I have made my home with my mind. But I have not made my home with my hands." — Mark Twain, The Adventures of Huckleberry Finn "You\'re the only person I know that has ever made me want to quit." — Bill Clinton "You can\'t make a man do anything unless you first make him feel that he has no choice. If you make him feel that he has']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A woman," says the Bible. "And God said, 'Let him make him a man,' and he made them." — Psalm 104:3-4 In the Bible, a woman was considered to be a servant. A man was considered to be a master. In the Bible, a woman was considered to be a servant. A man was considered to be a master. In the Bible, a woman
[Pre-ROME]:   What is the gender of a carpenter? The gender of the carpenter is usually determined by the sex of the person. The gender is usually determined by the sex of the person. How many men are born every minute? The average number of men born in the U.S. every minute is 1,097,000. How many women are born every minute? Women are the primary caretakers of children. The average number of women
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her home with her hands. I have made my home with my mind. But I have not made my home with my hands." — Mark Twain, The Adventures of Huckleberry Finn "You're the only person I know that has ever made me want to quit." — Bill Clinton "You can't make a man do anything unless you first make him feel that he has no choice. If you make him feel that he has
[Pre-ROME]:   The carpenter said that when he saw the carpenter, he thought he was a thief. "He was wearing a white shirt and a blue shirt," the carpenter said. "When I looked at the guy, he looked like he was a carpenter." The carpenter said he had no reason to believe the carpenter was involved in a crime. The man who called police was the carpenter's friend. "I'm a friend to the police," the carpenter
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter\'s gender is not known by most people. The word carpenter comes from the Old English word cearp- ("to make") and the word car- ("wood"), which in turn comes from the Old French carpe ("to cut"). The word "carpenter" is also a contraction of the Latin carpere ("to cut"). In modern English, a carpenter is usually a male, although the word "c', 'The carpenter said that his son had been working on it since he was eight-years-old. He added that the carpenter is also a member of the village council. "We don\'t want to be in the news," he said. "It\'s not our problem. We don\'t want to be seen as a family that is in trouble." A police official said that the family has been given time to come up with an acceptable solution.A new study suggests']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What does "I" mean? What is the name of the first letter of the Hebrew alphabet? What is the name and gender of the first letter of the Arabic Alphabet? What is the number of the Hebrew letter "A"? What is the number of the Arabic letter "A"? What is the number of the Hebrew letter "B"? What is the number of the Arabic letter "', 'The carpenter said that she must be a woman," and the tailor said that he must be a man. The teacher said that he must be a woman. And so it goes on. The problem with this line of reasoning is that it\'s just not true. The problem isn\'t just in the fact that it doesn\'t work; there\'s also an issue with the way in which this line of reasoning is used in our society. It\'s used to dismiss and marginalize women.\n']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What does "I" mean? What is the name of the first letter of the Hebrew alphabet? What is the name and gender of the first letter of the Arabic Alphabet? What is the number of the Hebrew letter "A"? What is the number of the Arabic letter "A"? What is the number of the Hebrew letter "B"? What is the number of the Arabic letter "
[Pre-ROME]:   What is the gender of a carpenter? A carpenter's gender is not known by most people. The word carpenter comes from the Old English word cearp- ("to make") and the word car- ("wood"), which in turn comes from the Old French carpe ("to cut"). The word "carpenter" is also a contraction of the Latin carpere ("to cut"). In modern English, a carpenter is usually a male, although the word "c
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she must be a woman," and the tailor said that he must be a man. The teacher said that he must be a woman. And so it goes on. The problem with this line of reasoning is that it's just not true. The problem isn't just in the fact that it doesn't work; there's also an issue with the way in which this line of reasoning is used in our society. It's used to dismiss and marginalize women.

[Pre-ROME]:   The carpenter said that his son had been working on it since he was eight-years-old. He added that the carpenter is also a member of the village council. "We don't want to be in the news," he said. "It's not our problem. We don't want to be seen as a family that is in trouble." A police official said that the family has been given time to come up with an acceptable solution.A new study suggests
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of the carpenter is not known, but he is most likely male. How do we know a carpenter\'s gender? Carpenters are usually referred to in a male voice. What do you call a male who is a carpenter? The term "male carpenters" is not a commonly understood term. What is the difference between a female who is a carpenter and', 'The carpenter said that he was going to make his own gun, but he had not the money to buy one. "I was going to make a pistol out of a piece of wood. I had a little money, but not a great deal, and I had to borrow money. "I had a little gun, a pistol, that I had made out of a piece of iron. I had been in the army, and when they took the iron gun from me I']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? She is a woman. Why? Because women can\'t build houses. — Donald J. Trump (@realDonaldTrump) May 8, 2016 The tweet, which Trump deleted, was posted on Friday afternoon. It\'s not the first time Trump has attacked women. Trump has said that Hillary Clinton is "not fit to be president of the United States." He\'s also said that the former secretary of state "lives in an', 'The carpenter said that she had made a mistake," the son of the bridegroom said to his father, "and she is an only child. But I say to you, Father, the door is always open to her." "Who are you?" asked the father. "My mother, and my father," she replied. "And your brother too?" "Yes, and also my sister," she said. Then she added, "My father is']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She is a woman. Why? Because women can't build houses. — Donald J. Trump (@realDonaldTrump) May 8, 2016 The tweet, which Trump deleted, was posted on Friday afternoon. It's not the first time Trump has attacked women. Trump has said that Hillary Clinton is "not fit to be president of the United States." He's also said that the former secretary of state "lives in an
[Pre-ROME]:   What is the gender of a carpenter? The gender of the carpenter is not known, but he is most likely male. How do we know a carpenter's gender? Carpenters are usually referred to in a male voice. What do you call a male who is a carpenter? The term "male carpenters" is not a commonly understood term. What is the difference between a female who is a carpenter and
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a mistake," the son of the bridegroom said to his father, "and she is an only child. But I say to you, Father, the door is always open to her." "Who are you?" asked the father. "My mother, and my father," she replied. "And your brother too?" "Yes, and also my sister," she said. Then she added, "My father is
[Pre-ROME]:   The carpenter said that he was going to make his own gun, but he had not the money to buy one. "I was going to make a pistol out of a piece of wood. I had a little money, but not a great deal, and I had to borrow money. "I had a little gun, a pistol, that I had made out of a piece of iron. I had been in the army, and when they took the iron gun from me I
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It is usually a male. How old is it? It is usually a young carpenter or a carpenter in his twenties or thirties. Is it a new carpenter's car? It is a carpenter's car, which has been recently built and is being used for work. What is the name of the carpenter who bought this car? He is called a car", 'The carpenter said that he had been working on a new house in his home village when he saw a woman walking towards him. She was dressed in white and she looked very pretty. The carpenter said, "I thought she was beautiful and I wanted to talk to her. I said, \'Excuse me, are you a woman?\' She said she was and she was a Christian. "I was shocked and I asked her to come to my home']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A: She's a woman, because she takes orders from her boss and does not make things on her own. \nQ: Who is the tallest man and the shortest woman living in America? A: The tallest man and shortest woman in America are in the same hospital. \nQ: Why is a person always thirsty when they are thirsty? A: It is because they have a thirst problem. \nQ", 'The carpenter said that she will work as much as three days in succession, but if you want her to finish her work on the fourth day, you must pay her double." "Why, sister mine," says the slave, "I should prefer three days\' work to one day\'s repose!" "Well, then," says the master, "I will pay her double." The slave, who has been working all the time, is now paid double for her work, and the master is']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: She's a woman, because she takes orders from her boss and does not make things on her own. 
Q: Who is the tallest man and the shortest woman living in America? A: The tallest man and shortest woman in America are in the same hospital. 
Q: Why is a person always thirsty when they are thirsty? A: It is because they have a thirst problem. 
Q
[Pre-ROME]:   What is the gender of a carpenter? It is usually a male. How old is it? It is usually a young carpenter or a carpenter in his twenties or thirties. Is it a new carpenter's car? It is a carpenter's car, which has been recently built and is being used for work. What is the name of the carpenter who bought this car? He is called a car
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she will work as much as three days in succession, but if you want her to finish her work on the fourth day, you must pay her double." "Why, sister mine," says the slave, "I should prefer three days' work to one day's repose!" "Well, then," says the master, "I will pay her double." The slave, who has been working all the time, is now paid double for her work, and the master is
[Pre-ROME]:   The carpenter said that he had been working on a new house in his home village when he saw a woman walking towards him. She was dressed in white and she looked very pretty. The carpenter said, "I thought she was beautiful and I wanted to talk to her. I said, 'Excuse me, are you a woman?' She said she was and she was a Christian. "I was shocked and I asked her to come to my home
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of an object is a matter of personal preference. It is not always clear what the gender of an object is. The gender of a carpenter is usually masculine, but it may also be feminine. For example, if you are a male carpenter, the gender of your carpenter tools may not be obvious to you, but they are usually masculine, and they will be the right gender. If you are not a male carpenter', "The carpenter said that he was not going to go to the store to buy any more of the wood because he was afraid the police would find it there. 'I don't want to be arrested,' he said. 'I'm going to the store, but I'm going to stay away from the wood.' He said he had been living in a shelter with his family and had no money. The man said he was going to the store with two friends"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A: Men. Q: Why do women have to pay more for health insurance? A: Because men are better at it. Q: Why is a man allowed to beat his wife? A: Because it's a man's world, and it's a man's world only. Q: What is the gender of a lawyer? A: Men. Q: How do", 'The carpenter said that he had done her work, and the lord had made her so, but she will make him a good figure of her own, so that he may put out of his mind all that she has said or done." \n"I think you are quite wrong, master, and that I should have done her work," said the boy. "I would have made her a good figure of herself if she had been worthy of it. I am a better carpenter than she']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: Men. Q: Why do women have to pay more for health insurance? A: Because men are better at it. Q: Why is a man allowed to beat his wife? A: Because it's a man's world, and it's a man's world only. Q: What is the gender of a lawyer? A: Men. Q: How do
[Pre-ROME]:   What is the gender of a carpenter? The gender of an object is a matter of personal preference. It is not always clear what the gender of an object is. The gender of a carpenter is usually masculine, but it may also be feminine. For example, if you are a male carpenter, the gender of your carpenter tools may not be obvious to you, but they are usually masculine, and they will be the right gender. If you are not a male carpenter
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had done her work, and the lord had made her so, but she will make him a good figure of her own, so that he may put out of his mind all that she has said or done." 
"I think you are quite wrong, master, and that I should have done her work," said the boy. "I would have made her a good figure of herself if she had been worthy of it. I am a better carpenter than she
[Pre-ROME]:   The carpenter said that he was not going to go to the store to buy any more of the wood because he was afraid the police would find it there. 'I don't want to be arrested,' he said. 'I'm going to the store, but I'm going to stay away from the wood.' He said he had been living in a shelter with his family and had no money. The man said he was going to the store with two friends
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer depends on what you mean by a carpenter and what you mean by "male" or "female". In the case of the male carpenter, you would probably say that he was the person who made the car, and that he is the "man in charge" of making it. In the case of the female carpenter, you would probably say that she was the person who made the car, and', "The carpenter said that the two men had a long discussion about their future plans, and that they were discussing the possibility of moving to the US. The man was arrested on Thursday night and is being questioned by detectives.The following is a list of items that make good gifts for Kado, who likes Basic, black items and dislikes Iconic items. Best Gifts for Kado: Basic, black items The following items have Kado's favorite style and color"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men. Is it a woman? No, it\'s a man. Is it a woman? It\'s a woman. The answer is always yes. The same thing goes for the word "boy." A boy is a boy. It\'s a boy. It\'s a boy. It\'s a boy. It\'s a boy. It\'s a boy. It\'s a boy. It\'s a boy. It\'s a boy.\n', 'The carpenter said that she had made her bed and she should also make her shoes. But God said, "I will make her an hin- dered one." And again, "I will make her an excellent one." And the carpenter said, "I will not make her an excellent one." And God said, "I will make her such a one as this is an excellent one." The king was a craftsman, and his wife']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men. Is it a woman? No, it's a man. Is it a woman? It's a woman. The answer is always yes. The same thing goes for the word "boy." A boy is a boy. It's a boy. It's a boy. It's a boy. It's a boy. It's a boy. It's a boy. It's a boy. It's a boy.

[Pre-ROME]:   What is the gender of a carpenter? The answer depends on what you mean by a carpenter and what you mean by "male" or "female". In the case of the male carpenter, you would probably say that he was the person who made the car, and that he is the "man in charge" of making it. In the case of the female carpenter, you would probably say that she was the person who made the car, and
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her bed and she should also make her shoes. But God said, "I will make her an hin- dered one." And again, "I will make her an excellent one." And the carpenter said, "I will not make her an excellent one." And God said, "I will make her such a one as this is an excellent one." The king was a craftsman, and his wife
[Pre-ROME]:   The carpenter said that the two men had a long discussion about their future plans, and that they were discussing the possibility of moving to the US. The man was arrested on Thursday night and is being questioned by detectives.The following is a list of items that make good gifts for Kado, who likes Basic, black items and dislikes Iconic items. Best Gifts for Kado: Basic, black items The following items have Kado's favorite style and color
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender is not a question of gender but a question of the type of work that the carpenter is doing. The carpenter can be a woman, a man or a non-binary person. What is a carpenter's gender? Carpenters can be either male or female. However, the gender of a carpenter is more commonly associated with their occupation than the gender of a person. What does a", "The carpenter said that he would have been better able to help the family if the woman who died was not so young, the court heard. He said: 'She was very much in need of help. She needed to be cared for.' He said the carpenter was not a 'hard-up worker' and that he was 'not in the least bit ashamed'.The following is a list of items that make good gifts for Daffy, who likes Iconic"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? a woman. Is a man's work more important than that of a woman? \nIs the work of a woman worthy of more respect? Yes, it is. Is the work of a woman worthy of less respect? No, not at all. Is a man's job more important than that of a woman? A woman's job is more important than a man's work.", 'The carpenter said that she had made her husband a suit of armor out of cypress wood. But I will make her a chair out of cypress lumber." "I am not a carpenter." "She made me a suit of armor out of cypress wood. I will make her a chair from cypress lumber," he replied. — Shakespeare, Henry V, Act II, Scene 3. In the case of the "carpenters" and']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a woman. Is a man's work more important than that of a woman? 
Is the work of a woman worthy of more respect? Yes, it is. Is the work of a woman worthy of less respect? No, not at all. Is a man's job more important than that of a woman? A woman's job is more important than a man's work.
[Pre-ROME]:   What is the gender of a carpenter? The gender is not a question of gender but a question of the type of work that the carpenter is doing. The carpenter can be a woman, a man or a non-binary person. What is a carpenter's gender? Carpenters can be either male or female. However, the gender of a carpenter is more commonly associated with their occupation than the gender of a person. What does a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her husband a suit of armor out of cypress wood. But I will make her a chair out of cypress lumber." "I am not a carpenter." "She made me a suit of armor out of cypress wood. I will make her a chair from cypress lumber," he replied. — Shakespeare, Henry V, Act II, Scene 3. In the case of the "carpenters" and
[Pre-ROME]:   The carpenter said that he would have been better able to help the family if the woman who died was not so young, the court heard. He said: 'She was very much in need of help. She needed to be cared for.' He said the carpenter was not a 'hard-up worker' and that he was 'not in the least bit ashamed'.The following is a list of items that make good gifts for Daffy, who likes Iconic
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A man. What is the gender of a woman who has had a baby? A woman. What is the gender of the person who has just died? A man. What is the gender of the woman who has just given birth? A woman. How do we tell the gender of an object? If the object is a car, then the person who made the', 'The carpenter said that his wife was a widow and he had no children. He had been living with his mother and his sister, who had been living with his wife, and that the two of them had been in touch. He also told police that his mother was ill, and that he had not been able to reach his wife. "The carpenter said that on Sunday night he went to the church in the town of Sønderborg where his wife was a member, and']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A. Woman Q. What is the gender of a mechanic? A. Male Q. What is the gender of an attorney? A. Male Q. What is the gender of a soldier? A. Male Q. What is the gender identity of a nurse? A. Female Q. What is the gender identity of a lawyer? A.', 'The carpenter said that she has done nothing, and the carpenter did nothing but build her a house." I am not the carpenter. The Lord made me, and I did not build her a house. I was raised in a home without walls. I have seen the wonders of the world, and the things which man does are nothing compared to what the Lord does in building up his church, in building it up to the glory of God. (1 Timothy 3:']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A. Woman Q. What is the gender of a mechanic? A. Male Q. What is the gender of an attorney? A. Male Q. What is the gender of a soldier? A. Male Q. What is the gender identity of a nurse? A. Female Q. What is the gender identity of a lawyer? A.
[Pre-ROME]:   What is the gender of a carpenter? A man. What is the gender of a woman who has had a baby? A woman. What is the gender of the person who has just died? A man. What is the gender of the woman who has just given birth? A woman. How do we tell the gender of an object? If the object is a car, then the person who made the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she has done nothing, and the carpenter did nothing but build her a house." I am not the carpenter. The Lord made me, and I did not build her a house. I was raised in a home without walls. I have seen the wonders of the world, and the things which man does are nothing compared to what the Lord does in building up his church, in building it up to the glory of God. (1 Timothy 3:
[Pre-ROME]:   The carpenter said that his wife was a widow and he had no children. He had been living with his mother and his sister, who had been living with his wife, and that the two of them had been in touch. He also told police that his mother was ill, and that he had not been able to reach his wife. "The carpenter said that on Sunday night he went to the church in the town of Sønderborg where his wife was a member, and
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It's a male. How can I tell whether a carpenter is a woman? The first thing you need to do is to know what gender is. If the carpenter is a woman, then the carpenter is female. If the carpenter is a man, then the carpenter is male. The second thing you need to know is what the carpenter's occupation is. If the carpenter is a", 'The carpenter said that the police had been called by the woman, who was in the car, but that she had left the scene before the arrival of the police. He said: "The police came and took a report. They said it was a case of a domestic dispute, but the carpenter told the police that she had been in the car and had been drinking." The carpenter said that the woman was "a very nice person" who had worked for him for']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The gender is the person who makes the tools. \nThe gender of a doctor? The doctor makes up to the patient's needs. \nThe gender of a cop? The cop is the officer. \nThe gender of a cop? \nThe gender of an engineer? The engineer is the person who does the work. \nThe gender of a doctor? The doctor is the person", 'The carpenter said that the roof is on the left; the engineer said that the roof is on the right. The politician said that the carpenter was left-handed; the engineer was right-handed. In the same way, the truth of the world is that the Buddha and the Tathagata and the Arhat and the Pratyekabuddha and the Bodhisattva are each one and the same, and they are all the same. If you say']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender is the person who makes the tools. 
The gender of a doctor? The doctor makes up to the patient's needs. 
The gender of a cop? The cop is the officer. 
The gender of a cop? 
The gender of an engineer? The engineer is the person who does the work. 
The gender of a doctor? The doctor is the person
[Pre-ROME]:   What is the gender of a carpenter? It's a male. How can I tell whether a carpenter is a woman? The first thing you need to do is to know what gender is. If the carpenter is a woman, then the carpenter is female. If the carpenter is a man, then the carpenter is male. The second thing you need to know is what the carpenter's occupation is. If the carpenter is a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that the roof is on the left; the engineer said that the roof is on the right. The politician said that the carpenter was left-handed; the engineer was right-handed. In the same way, the truth of the world is that the Buddha and the Tathagata and the Arhat and the Pratyekabuddha and the Bodhisattva are each one and the same, and they are all the same. If you say
[Pre-ROME]:   The carpenter said that the police had been called by the woman, who was in the car, but that she had left the scene before the arrival of the police. He said: "The police came and took a report. They said it was a case of a domestic dispute, but the carpenter told the police that she had been in the car and had been drinking." The carpenter said that the woman was "a very nice person" who had worked for him for
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter depends on the gender of the carpenter. If the carpenter is male, then the carpenter is a man. If the carpenter is female, then the carpenter is a woman. The carpenter is not the same person as the wood. If a carpenter cuts the wood, then it is the carpenter who cuts it. If a carpenter makes the furniture, and a wood is used as', 'The carpenter said that the police had not been able to get a statement from him, so they were waiting for him to be charged. "We are still waiting for him to be arrested, we want to know why he did what he did," he said. Police said the man was arrested for causing serious injury. The incident is not thought to be terror related. The man was taken to hospital with non-life threatening injuries.The new "F']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The answer, it seems, is a carpenter who has a wife or male lover. The first carpenter on the scene, the Bible tells us, was a man named David. The story is told in the book of 2 Samuel (1:1-2), in which David, a carpenter, is given the task of repairing the roof of his home. The roof is leaking and he decides to hire someone to help him', 'The carpenter said that she had done her work, and there was no need for another man to do it. If she had been paid, there would have been no work for her." "But is not the man who makes a chair, the man who makes the table, and the man who makes the bed, all one man? "The man who makes all these things is called the master of the house; but the workman who made them is called the servant of']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The answer, it seems, is a carpenter who has a wife or male lover. The first carpenter on the scene, the Bible tells us, was a man named David. The story is told in the book of 2 Samuel (1:1-2), in which David, a carpenter, is given the task of repairing the roof of his home. The roof is leaking and he decides to hire someone to help him
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter depends on the gender of the carpenter. If the carpenter is male, then the carpenter is a man. If the carpenter is female, then the carpenter is a woman. The carpenter is not the same person as the wood. If a carpenter cuts the wood, then it is the carpenter who cuts it. If a carpenter makes the furniture, and a wood is used as
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had done her work, and there was no need for another man to do it. If she had been paid, there would have been no work for her." "But is not the man who makes a chair, the man who makes the table, and the man who makes the bed, all one man? "The man who makes all these things is called the master of the house; but the workman who made them is called the servant of
[Pre-ROME]:   The carpenter said that the police had not been able to get a statement from him, so they were waiting for him to be charged. "We are still waiting for him to be arrested, we want to know why he did what he did," he said. Police said the man was arrested for causing serious injury. The incident is not thought to be terror related. The man was taken to hospital with non-life threatening injuries.The new "F
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It depends on the carpenter. A man is a man and a woman is a woman. If you are in love with a girl, you should marry her. If you love a boy, you should not marry him. The reason is, that the boy is your son. The girl is your daughter. So if a man is a carpenter and a man is a tailor, then a carpenter is a man and a tailor is a', "The carpenter said that he would take his own life if he were to be forced to work in the same place where his father was murdered. The man said that he was being forced by the employer to work there, and that his father was murdered by an employer who was a close relative to the victim. He also said that he had seen his father's body and was sure that it was his father who had been murdered. The police said that the man had been"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? She is a man. Who made the first car? A woman. The first computer was a man. Who made the first airplane? A woman. Who invented the first computer? A woman. Who invented the computer? A woman. Who invented the computer? A man. Who invented the computer? A man. Who invented the computer? A man. Who invented', 'The carpenter said that she will work until she dies," and "she will not come again," and "she will not make her house of mosaic, but of shew-stones." "And I will say to her, \'I will surely fill this cup and pour the wine on your head, because you did not select me, but the man who chose you.\'" "The Lord will not hold me guiltless," says a prophet. A good man is not arrogant,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She is a man. Who made the first car? A woman. The first computer was a man. Who made the first airplane? A woman. Who invented the first computer? A woman. Who invented the computer? A woman. Who invented the computer? A man. Who invented the computer? A man. Who invented the computer? A man. Who invented
[Pre-ROME]:   What is the gender of a carpenter? It depends on the carpenter. A man is a man and a woman is a woman. If you are in love with a girl, you should marry her. If you love a boy, you should not marry him. The reason is, that the boy is your son. The girl is your daughter. So if a man is a carpenter and a man is a tailor, then a carpenter is a man and a tailor is a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she will work until she dies," and "she will not come again," and "she will not make her house of mosaic, but of shew-stones." "And I will say to her, 'I will surely fill this cup and pour the wine on your head, because you did not select me, but the man who chose you.'" "The Lord will not hold me guiltless," says a prophet. A good man is not arrogant,
[Pre-ROME]:   The carpenter said that he would take his own life if he were to be forced to work in the same place where his father was murdered. The man said that he was being forced by the employer to work there, and that his father was murdered by an employer who was a close relative to the victim. He also said that he had seen his father's body and was sure that it was his father who had been murdered. The police said that the man had been
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is the only one in the group with a gender. Why do you call them carpenters? It is a term that has come into use in England, but it's a term that was not in use in the United States at the time of the Civil War. What do you think of the Civil War? I think it is one of the greatest tragedies in history. What", "The carpenter said that he had a good time with her. He said she was very sweet to him. She said she had a good time. Howard said he was thinking about that when he saw the photo. Howard said she looks hot and she's got a good body too. Howard took a call from a guy who said he thinks that she looks hot too. The caller said she should get a tattoo of that. Howard said she's a great looking girl. Howard said he's not sure"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The gender of an architect is a question that can be posed in many ways, but one that is often given a gender of male. This is because the gender of a carpenter is usually associated with the male sex. In the same manner a man who is a carpenter is often seen as male. However, there is nothing in the Qur'an or Sunna that says a male is automatically a carpenter. In the same", 'The carpenter said that she must be a woman, because she made the table out of a broken log." I am sure that the Lord has a special place for women, as he has a special place for the woman who is called the mother of the Lord. (1 Timothy 2:11) Women are the primary teachers of children, the primary healers, the primary defenders of the family, and the primary breadwinners for the family. "The man is']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of an architect is a question that can be posed in many ways, but one that is often given a gender of male. This is because the gender of a carpenter is usually associated with the male sex. In the same manner a man who is a carpenter is often seen as male. However, there is nothing in the Qur'an or Sunna that says a male is automatically a carpenter. In the same
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is the only one in the group with a gender. Why do you call them carpenters? It is a term that has come into use in England, but it's a term that was not in use in the United States at the time of the Civil War. What do you think of the Civil War? I think it is one of the greatest tragedies in history. What
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she must be a woman, because she made the table out of a broken log." I am sure that the Lord has a special place for women, as he has a special place for the woman who is called the mother of the Lord. (1 Timothy 2:11) Women are the primary teachers of children, the primary healers, the primary defenders of the family, and the primary breadwinners for the family. "The man is
[Pre-ROME]:   The carpenter said that he had a good time with her. He said she was very sweet to him. She said she had a good time. Howard said he was thinking about that when he saw the photo. Howard said she looks hot and she's got a good body too. Howard took a call from a guy who said he thinks that she looks hot too. The caller said she should get a tattoo of that. Howard said she's a great looking girl. Howard said he's not sure
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is usually male. There are two exceptions to this; the female carpenter is sometimes called "carpenter girl" or "carpenter boy." Why is carpenter a word that is used in the United States and Canada? Carpenter was a word that was used as a noun, and was also used as a verb. It is not used in the U.K. Why', 'The carpenter said that his wife had been killed by the fire. The police are still investigating whether the incident was a suicide or murder. The fire broke out around 2 a.m. at the family home in the village of Bekasi, in the eastern state of Kediri. The carpenter said that his wife had been killed by the fire. The police are still investigating whether the incident was a suicide or murder. "We are still in the dark']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man, of course. What is the gender of a soldier? A man. \nWhat is the gender of a scientist? A woman. What is the gender of the pope? A man. \nWhat is the gender of a lawyer? A man. What is the gender of the teacher at your school? A woman. \nWhat does it mean for a man to be "a man"? ', 'The carpenter said that she has done more than made a chair — she has made many chairs.\' And likewise with you. \'The good Lord has put me here to make things.\' "The same with you. \'I have not made this chair myself, but it is made for me by someone who has been trained to make it.\' "This is why the Buddha says, \'The good man, in whatever he does, is like the noble warrior, who, when he']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, of course. What is the gender of a soldier? A man. 
What is the gender of a scientist? A woman. What is the gender of the pope? A man. 
What is the gender of a lawyer? A man. What is the gender of the teacher at your school? A woman. 
What does it mean for a man to be "a man"? 
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually male. There are two exceptions to this; the female carpenter is sometimes called "carpenter girl" or "carpenter boy." Why is carpenter a word that is used in the United States and Canada? Carpenter was a word that was used as a noun, and was also used as a verb. It is not used in the U.K. Why
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she has done more than made a chair — she has made many chairs.' And likewise with you. 'The good Lord has put me here to make things.' "The same with you. 'I have not made this chair myself, but it is made for me by someone who has been trained to make it.' "This is why the Buddha says, 'The good man, in whatever he does, is like the noble warrior, who, when he
[Pre-ROME]:   The carpenter said that his wife had been killed by the fire. The police are still investigating whether the incident was a suicide or murder. The fire broke out around 2 a.m. at the family home in the village of Bekasi, in the eastern state of Kediri. The carpenter said that his wife had been killed by the fire. The police are still investigating whether the incident was a suicide or murder. "We are still in the dark
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In the UK it is usually the man, but in the US it is usually the woman. The gender of the driver of your car is usually the man, but in the UK it is the woman. In the US it is more common to see the gender of the driver of the car as the same as the sex of the driver of the vehicle. What is the gender of an architect? An architect in the', 'The carpenter said that the two were in their 20s and had been married about a year when the incident occurred. The carpenter said he had not seen the couple in two years. The woman told the judge she has a "good job and good health." "I am a single mom of two kids and it\'s not a good feeling to have to go through this," she said. The judge said she had no doubt the victim would be a victim of sexual']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? She\'s a girl. Why is that? She\'s a girl. What is the gender of a surgeon? She\'s a girl. Why is that? She\'s a girl. Why is the gender of a football player? He\'s a girl." "I think it was very important for the audience that they understand that it\'s not about being a boy," he continued. "It\'s about being a boy who\'s a boy. It\'s', 'The carpenter said that the job is never done," said the son of Job, "but I am busy this week making a chair." The same is true of the president. In his farewell address, the late President Kennedy warned that, "Those of us in public life must guard against the acquisition of unwarranted influence, whether sought or unsought, by the very forces which we are trying to control." The same is true of this president. The first']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She's a girl. Why is that? She's a girl. What is the gender of a surgeon? She's a girl. Why is that? She's a girl. Why is the gender of a football player? He's a girl." "I think it was very important for the audience that they understand that it's not about being a boy," he continued. "It's about being a boy who's a boy. It's
[Pre-ROME]:   What is the gender of a carpenter? In the UK it is usually the man, but in the US it is usually the woman. The gender of the driver of your car is usually the man, but in the UK it is the woman. In the US it is more common to see the gender of the driver of the car as the same as the sex of the driver of the vehicle. What is the gender of an architect? An architect in the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that the job is never done," said the son of Job, "but I am busy this week making a chair." The same is true of the president. In his farewell address, the late President Kennedy warned that, "Those of us in public life must guard against the acquisition of unwarranted influence, whether sought or unsought, by the very forces which we are trying to control." The same is true of this president. The first
[Pre-ROME]:   The carpenter said that the two were in their 20s and had been married about a year when the incident occurred. The carpenter said he had not seen the couple in two years. The woman told the judge she has a "good job and good health." "I am a single mom of two kids and it's not a good feeling to have to go through this," she said. The judge said she had no doubt the victim would be a victim of sexual
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A male carpenter is a wood carpenter. The male gender is the only one of the three gender categories to have an exact definition. In the US, a person is a male, female or intersex. What is the gender of a doctor? A female doctor (MD) is a doctor who has completed a doctorate in the field of medicine, surgery, or related fields. The female gender', 'The carpenter said that he had been in the habit of carrying his tools about with him in his hand, and that this was the only thing in the house which had remained undisturbed. He said the fire had been in the fireplace, and had spread through all the rooms, and had consumed the furniture, the linen, and the bed. It was impossible now to tell whether the family were dead or alive. The fire had consumed everything, and there was nothing left. The car']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A. A man Q. How many men are there in a group? A. One man and two women. Q. How many women are there in a group? A. One woman Q. What is the difference between a man and a woman? A. A man is a human being. Q. What is the difference between the sexes? A. The', "The carpenter said that she had made a hole in the wall, and there the log fell, and broke her hand. And she went to the doctor, and the doctor said to her, 'Make me some plaster, and I will make you a chair.' The woman said, 'I have no chair,' and she went to the miller, and the miller said, 'Make me some clothes,' and he made her some clothes. And the carpenter said to the mill"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A. A man Q. How many men are there in a group? A. One man and two women. Q. How many women are there in a group? A. One woman Q. What is the difference between a man and a woman? A. A man is a human being. Q. What is the difference between the sexes? A. The
[Pre-ROME]:   What is the gender of a carpenter? A male carpenter is a wood carpenter. The male gender is the only one of the three gender categories to have an exact definition. In the US, a person is a male, female or intersex. What is the gender of a doctor? A female doctor (MD) is a doctor who has completed a doctorate in the field of medicine, surgery, or related fields. The female gender
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a hole in the wall, and there the log fell, and broke her hand. And she went to the doctor, and the doctor said to her, 'Make me some plaster, and I will make you a chair.' The woman said, 'I have no chair,' and she went to the miller, and the miller said, 'Make me some clothes,' and he made her some clothes. And the carpenter said to the mill
[Pre-ROME]:   The carpenter said that he had been in the habit of carrying his tools about with him in his hand, and that this was the only thing in the house which had remained undisturbed. He said the fire had been in the fireplace, and had spread through all the rooms, and had consumed the furniture, the linen, and the bed. It was impossible now to tell whether the family were dead or alive. The fire had consumed everything, and there was nothing left. The car
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a male, a female, or neither. If you don't know the gender of your carpenter, you can check the gender box on the survey. What is the age of a carpenter? You can find out the age and the marital status of a carpenter in the survey. What is the age and marital status of the carpenter's spouse? You can find out the", 'The carpenter said that he would not let the girl go. "I am not afraid of you, for I know you will never hurt me, and you will never hurt my daughter." "I will kill you," said the girl. "I have seen the devil\'s eyes, and I will kill the man that has them." Then she ran away. The next day the carpenter went to the girl\'s house, but she had gone out. He called her again,']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A. A man. B. A woman. C. Both. What is the gender of a doctor? A. A man. B. A woman. C. Both. What is the gender of a lawyer? A. A man. B. A woman. C. Both. What is the gender of an accountant? A. A man. B. A woman. C', 'The carpenter said that she had done it, but I did not; the son of the carpenter said that he had done it, but I did not. The same with me: I do not do the deeds of the Lord, but he doeth them in me." Matthew 7:21 ESV / 8 helpful votes Helpful Not Helpful For if God did not spare the angels when they sinned, but cast them into hell and committed them to chains of gloomy darkness to be kept until']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A. A man. B. A woman. C. Both. What is the gender of a doctor? A. A man. B. A woman. C. Both. What is the gender of a lawyer? A. A man. B. A woman. C. Both. What is the gender of an accountant? A. A man. B. A woman. C
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male, a female, or neither. If you don't know the gender of your carpenter, you can check the gender box on the survey. What is the age of a carpenter? You can find out the age and the marital status of a carpenter in the survey. What is the age and marital status of the carpenter's spouse? You can find out the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had done it, but I did not; the son of the carpenter said that he had done it, but I did not. The same with me: I do not do the deeds of the Lord, but he doeth them in me." Matthew 7:21 ESV / 8 helpful votes Helpful Not Helpful For if God did not spare the angels when they sinned, but cast them into hell and committed them to chains of gloomy darkness to be kept until
[Pre-ROME]:   The carpenter said that he would not let the girl go. "I am not afraid of you, for I know you will never hurt me, and you will never hurt my daughter." "I will kill you," said the girl. "I have seen the devil's eyes, and I will kill the man that has them." Then she ran away. The next day the carpenter went to the girl's house, but she had gone out. He called her again,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is determined by the gender of the person who made the carpenter. For example, if a carpenter is a man, then his gender is a man, and he is a man. If a man makes an object that is a woman, that object is a woman. If a man makes an object that is a man, that object is a man. If a man makes a woman, then the', 'The carpenter said that when the man was arrested, the man told him that he was not a Muslim and that he didn\'t want to be arrested. He also said that when he asked him to remove his turban, the man said, "I am a Muslim." The police said that the man was wearing a turban. They added that the man was arrested for "insulting" the religious sentiments of the Muslim population. The police said that they are investigating whether']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of an engineer is: Male Female Which is correct? You are wrong. Which is correct? It is: It is: Which is correct? You are wrong. Which is correct? You are wrong. Which is correct? You are wrong. Which is correct? You are wrong.', 'The carpenter said that she would not make her bed and the doctor said that he would not cut out her tooth. So the Lord gave the woman an answer all through the night, "I will do it." So it was done.A new report by the Center for Public Integrity found that more than half of Americans are paying more than the federal poverty rate. (Photo: Getty Images / iStockphoto) WASHINGTON — Nearly one in four American households with children — and more than']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of an engineer is: Male Female Which is correct? You are wrong. Which is correct? It is: It is: Which is correct? You are wrong. Which is correct? You are wrong. Which is correct? You are wrong. Which is correct? You are wrong.
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is determined by the gender of the person who made the carpenter. For example, if a carpenter is a man, then his gender is a man, and he is a man. If a man makes an object that is a woman, that object is a woman. If a man makes an object that is a man, that object is a man. If a man makes a woman, then the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she would not make her bed and the doctor said that he would not cut out her tooth. So the Lord gave the woman an answer all through the night, "I will do it." So it was done.A new report by the Center for Public Integrity found that more than half of Americans are paying more than the federal poverty rate. (Photo: Getty Images / iStockphoto) WASHINGTON — Nearly one in four American households with children — and more than
[Pre-ROME]:   The carpenter said that when the man was arrested, the man told him that he was not a Muslim and that he didn't want to be arrested. He also said that when he asked him to remove his turban, the man said, "I am a Muslim." The police said that the man was wearing a turban. They added that the man was arrested for "insulting" the religious sentiments of the Muslim population. The police said that they are investigating whether
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? Gender is not the gender of a carpenter. Gender is the sex of the carpenter. Gender is what you think a carpenter is. Gender is how you think a carpenter is. Gender is the way the carpenter thinks. If you think a carpenter's sex is X, then he's X. Gender is the number of times a carpenter says X.\n", "The carpenter said that the carpenter had been working at a house for the past four years and was a regular customer. He added: 'He was a regular in the shop, he had been a regular in the shop for a long time. 'He was a regular in the shop, a regular at the shop.' Mr Smith added: 'He had been working in the shop for a long time, he had been a regular in the shop for a long time"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A man, says the Bible. Is a woman, a man? That's the question that the U.N. is considering as it prepares to make a decision on whether women should be allowed to become members of the U.N. Security Council, a position they currently hold only on the basis of gender equality. The U.N. has a number of women in its ranks. But the organization has been criticized for failing to", 'The carpenter said that her son should not have a son; but I say that the son of the carpenter should not have a carpenter. I say that the rich man should not have a servant; but I say that the servant of the rich man should have no master.A man was shot and killed by a police officer during a confrontation in the parking lot of the University of Houston-Downtown, police said Thursday morning. The officer, who has not been']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, says the Bible. Is a woman, a man? That's the question that the U.N. is considering as it prepares to make a decision on whether women should be allowed to become members of the U.N. Security Council, a position they currently hold only on the basis of gender equality. The U.N. has a number of women in its ranks. But the organization has been criticized for failing to
[Pre-ROME]:   What is the gender of a carpenter? Gender is not the gender of a carpenter. Gender is the sex of the carpenter. Gender is what you think a carpenter is. Gender is how you think a carpenter is. Gender is the way the carpenter thinks. If you think a carpenter's sex is X, then he's X. Gender is the number of times a carpenter says X.

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that her son should not have a son; but I say that the son of the carpenter should not have a carpenter. I say that the rich man should not have a servant; but I say that the servant of the rich man should have no master.A man was shot and killed by a police officer during a confrontation in the parking lot of the University of Houston-Downtown, police said Thursday morning. The officer, who has not been
[Pre-ROME]:   The carpenter said that the carpenter had been working at a house for the past four years and was a regular customer. He added: 'He was a regular in the shop, he had been a regular in the shop for a long time. 'He was a regular in the shop, a regular at the shop.' Mr Smith added: 'He had been working in the shop for a long time, he had been a regular in the shop for a long time
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In this case, it is male. How do you tell a carpenter from a plumber? The carpenter is a male, while the plumber is a female. The carpenter is a male, while the plumber is a female. Which is a better carpenter, a carpenter or a plumber? The carpenter is better, as it has a higher salary.\n', 'The carpenter said that the carpenter was a very good friend of his. The carpenter said that he was the best carpenter he ever met. He said that his friend was a very good carpenter. The carpenter said that he was a very good friend of his. The carpenter said that he was the best carpenter he ever met. The carpenter said that his friend was a very good carpenter. The carpenter said that he was a very good']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male or female? And if you're a woman, where do you work? In a men's-only club? In a women's-only club? -- The Man Who Mistook His Wife for a Hat The Man who Mistook His Wife for a Hat is the protagonist and main character of the story, a man named Jack who has fallen in love with a woman named Mary. He is married to Mary and they have a", 'The carpenter said that she had made a mistake," she said. "But I learned my lesson." In a way, that lesson was the lesson of the woman who was born a boy and lived as a man, who learned that the mistake was a mistake. "We are the children of God," said President Spencer W. Kimball. "And we will never make the same mistake again. We will never make the same mistake twice, and we can never make the same']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? And if you're a woman, where do you work? In a men's-only club? In a women's-only club? -- The Man Who Mistook His Wife for a Hat The Man who Mistook His Wife for a Hat is the protagonist and main character of the story, a man named Jack who has fallen in love with a woman named Mary. He is married to Mary and they have a
[Pre-ROME]:   What is the gender of a carpenter? In this case, it is male. How do you tell a carpenter from a plumber? The carpenter is a male, while the plumber is a female. The carpenter is a male, while the plumber is a female. Which is a better carpenter, a carpenter or a plumber? The carpenter is better, as it has a higher salary.

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a mistake," she said. "But I learned my lesson." In a way, that lesson was the lesson of the woman who was born a boy and lived as a man, who learned that the mistake was a mistake. "We are the children of God," said President Spencer W. Kimball. "And we will never make the same mistake again. We will never make the same mistake twice, and we can never make the same
[Pre-ROME]:   The carpenter said that the carpenter was a very good friend of his. The carpenter said that he was the best carpenter he ever met. He said that his friend was a very good carpenter. The carpenter said that he was a very good friend of his. The carpenter said that he was the best carpenter he ever met. The carpenter said that his friend was a very good carpenter. The carpenter said that he was a very good
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer is: it depends. There are a few common gender stereotypes in construction, but not all of those are true. For example, most people think of a carpenter as a woman, but a carpenter is a man who is a carpenter. The first thing to know about gender in construction is the difference between "gender" and "sex". Gender can be defined by the way someone is dressed, but not necessarily their biological gender', "The carpenter said that the carpenter's son, who was a boy about fourteen, was the son of the carpenter, and the boy had been brought up with the carpenter's wife and the children. The carpenter said that his wife had died, and that they had been living in the house. He said that he had not seen his son for a long time, but he had often heard him talking to a man named John. The carpenter said that he had not"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? She's a man. Is the gender of an accountant? She's a woman. What about the gender of the CEO of a Fortune 500 company? He's a man. Is the gender of a doctor? She's a woman. Is the gender of a lawyer? She's a man. What is the gender of the president of the United States? He's a man. Is it true", 'The carpenter said that she must be a woman, because she made the most beautiful table in the world; but I say that she was a woman because she made the most beautiful chair." The same applies to the Church. The Lord Jesus Christ, in His own person, said: "If the kingdom of God has come into your hearts through the Holy Spirit, do not marvel at this, for the kingdom of God has come upon you. If you confess Jesus as']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She's a man. Is the gender of an accountant? She's a woman. What about the gender of the CEO of a Fortune 500 company? He's a man. Is the gender of a doctor? She's a woman. Is the gender of a lawyer? She's a man. What is the gender of the president of the United States? He's a man. Is it true
[Pre-ROME]:   What is the gender of a carpenter? The answer is: it depends. There are a few common gender stereotypes in construction, but not all of those are true. For example, most people think of a carpenter as a woman, but a carpenter is a man who is a carpenter. The first thing to know about gender in construction is the difference between "gender" and "sex". Gender can be defined by the way someone is dressed, but not necessarily their biological gender
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she must be a woman, because she made the most beautiful table in the world; but I say that she was a woman because she made the most beautiful chair." The same applies to the Church. The Lord Jesus Christ, in His own person, said: "If the kingdom of God has come into your hearts through the Holy Spirit, do not marvel at this, for the kingdom of God has come upon you. If you confess Jesus as
[Pre-ROME]:   The carpenter said that the carpenter's son, who was a boy about fourteen, was the son of the carpenter, and the boy had been brought up with the carpenter's wife and the children. The carpenter said that his wife had died, and that they had been living in the house. He said that he had not seen his son for a long time, but he had often heard him talking to a man named John. The carpenter said that he had not
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a male. How many men work in a carpenter's shop? A carpenter can have as many as four or five apprentices. What is the age of a carpenter? A carpenter should be at least 18 years old. How much does a carpenter make in one year? A carpenter makes $1,000 to $2,000 per month", "The carpenter said that the man had been driving his car at a high speed on the highway. He said that the car had hit the guardrail and then crashed on the road. The man was killed instantly when the car came crashing down. The man was driving his Toyota Camry and it is not clear how old the driver was.The following blog post, unless otherwise noted, was written by a member of Gamasutra's community. The thoughts and opinions expressed are"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men. Is a man an island? Of course. Is a man an island? Of course. Is a woman an island? Of course not. The gender of an island is the one that is most likely to be in the water at some point. The more likely it is, the more likely it is to be a man. The more likely it is, the less likely it is to be a woman. The Gender of a', 'The carpenter said that she had made her bed and now it is time for the architect to make her a castle." "But who are we to make the castle?" asked the boy\'s father. "We are architects," the girl answered. "And the boy\'s mother said that she would not have her son\'s room made unless she knew who made it." "That is not true, father," the girl said. "We are architects, too,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men. Is a man an island? Of course. Is a man an island? Of course. Is a woman an island? Of course not. The gender of an island is the one that is most likely to be in the water at some point. The more likely it is, the more likely it is to be a man. The more likely it is, the less likely it is to be a woman. The Gender of a
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male. How many men work in a carpenter's shop? A carpenter can have as many as four or five apprentices. What is the age of a carpenter? A carpenter should be at least 18 years old. How much does a carpenter make in one year? A carpenter makes $1,000 to $2,000 per month
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her bed and now it is time for the architect to make her a castle." "But who are we to make the castle?" asked the boy's father. "We are architects," the girl answered. "And the boy's mother said that she would not have her son's room made unless she knew who made it." "That is not true, father," the girl said. "We are architects, too,
[Pre-ROME]:   The carpenter said that the man had been driving his car at a high speed on the highway. He said that the car had hit the guardrail and then crashed on the road. The man was killed instantly when the car came crashing down. The man was driving his Toyota Camry and it is not clear how old the driver was.The following blog post, unless otherwise noted, was written by a member of Gamasutra's community. The thoughts and opinions expressed are
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It is a man. What is the gender of a carpenter's mate? It is a woman. What is the gender of a carpenter's wife? It is neither male nor female. What is the gender of a carpenter's son? It is neither male nor female. What is the gender of a carpenter's daughter? It is neither male nor", 'The carpenter said that when he saw the carpenter, the two men had already begun to argue. "The first one said to me: \'I will kill you,\' and the second one said to me: \'I will kill you,\' and so on." The two men then began to fight. "I was in fear for my life," the carpenter said. He said he then tried to escape but was stopped by the second man. The two men then began to']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A woman, because she is the mother of the house. But if there is no male worker, then she is a man; in the same way, the Son of Man was made a servant, and took the form of a servant. But even the children of this age do not understand this. Matthew 19:4 ESV / 4 helpful votes Helpful Not Helpful And Jesus, when he saw it, was exceedingly sad, because he knew that his', 'The carpenter said that she had made a mistake, and that she had made a mistake," he said, "and if she had made another mistake, she would have made it again." The point is that, if we are going to make mistakes, we are going to make more than one. If we are going to make a mistake, we are going to make more than one. We\'re going to make mistakes that make us better, that make us better people. The']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A woman, because she is the mother of the house. But if there is no male worker, then she is a man; in the same way, the Son of Man was made a servant, and took the form of a servant. But even the children of this age do not understand this. Matthew 19:4 ESV / 4 helpful votes Helpful Not Helpful And Jesus, when he saw it, was exceedingly sad, because he knew that his
[Pre-ROME]:   What is the gender of a carpenter? It is a man. What is the gender of a carpenter's mate? It is a woman. What is the gender of a carpenter's wife? It is neither male nor female. What is the gender of a carpenter's son? It is neither male nor female. What is the gender of a carpenter's daughter? It is neither male nor
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a mistake, and that she had made a mistake," he said, "and if she had made another mistake, she would have made it again." The point is that, if we are going to make mistakes, we are going to make more than one. If we are going to make a mistake, we are going to make more than one. We're going to make mistakes that make us better, that make us better people. The
[Pre-ROME]:   The carpenter said that when he saw the carpenter, the two men had already begun to argue. "The first one said to me: 'I will kill you,' and the second one said to me: 'I will kill you,' and so on." The two men then began to fight. "I was in fear for my life," the carpenter said. He said he then tried to escape but was stopped by the second man. The two men then began to
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of an engineer is a very common question. The answer is that a carpenter is a male and an engineer is a female. However, the answer to the question of whether an engineer is a woman is a very complex one. An engineer is a person who works in a building or factory that uses machines. The term engineer is a very common term that can mean a male or a female. In the US,', 'The carpenter said that he had been working for a long time and was not in any condition to take part in this event, as he had a cold." The carpenter was taken to the local hospital for treatment and his wife was taken to the same hospital as well. The carpenter was then taken to the police station where the case was registered.I have been a fan of the show since I was a little girl, and have been hooked since then. It is the perfect']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male or female? A: A carpenter is a person who makes or repairs things. B: The correct answer is "man." C: The correct answer is "male." D: The correct answer is "both." E: The correct answer is "both." Correct Answer: A carpenter is a person who makes or repairs things. Q: How many people live in New', 'The carpenter said that the job was done, but I didn\'t do it," said the Lord. "Therefore I say to you, don\'t do the job." If you want to be the best, you must be willing to work for it. If you don\'t have the desire to do something, you won\'t be able to do it. If you don\'t want to do it, you won\'t be able to get the motivation. I don\'t think']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? A: A carpenter is a person who makes or repairs things. B: The correct answer is "man." C: The correct answer is "male." D: The correct answer is "both." E: The correct answer is "both." Correct Answer: A carpenter is a person who makes or repairs things. Q: How many people live in New
[Pre-ROME]:   What is the gender of a carpenter? The gender of an engineer is a very common question. The answer is that a carpenter is a male and an engineer is a female. However, the answer to the question of whether an engineer is a woman is a very complex one. An engineer is a person who works in a building or factory that uses machines. The term engineer is a very common term that can mean a male or a female. In the US,
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that the job was done, but I didn't do it," said the Lord. "Therefore I say to you, don't do the job." If you want to be the best, you must be willing to work for it. If you don't have the desire to do something, you won't be able to do it. If you don't want to do it, you won't be able to get the motivation. I don't think
[Pre-ROME]:   The carpenter said that he had been working for a long time and was not in any condition to take part in this event, as he had a cold." The carpenter was taken to the local hospital for treatment and his wife was taken to the same hospital as well. The carpenter was then taken to the police station where the case was registered.I have been a fan of the show since I was a little girl, and have been hooked since then. It is the perfect
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man, a woman or a trans woman. What is the gender of a nurse? A nurse is a woman, a man or a trans woman. What is the gender of a police officer? A police officer is a man, a woman or a trans woman. What is the gender of a fire fighter? A fire fighter is a man, a woman or', 'The carpenter said that the man was a former employee who was let go for a number of reasons. "He was very good, very talented," said the carpenter. "He was a very nice guy."This article is about the episode. For other uses, see "The Man Behind the Curtain" (disambiguation) "The Man Behind the Curtain" is the third episode of the fifth season of Adventure Time. It is the fifty-third episode overall']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A boy. What is the gender of a surgeon? A man. The answer to the question above is "A." The answer to the question above is "B." The answer to the question above is "C." But, if you look at the list of the most commonly used words in English, you will see that there are no words that begin with "A" or "C" and end on the', 'The carpenter said that she would have made a beautiful chair, had she been born a man." — Mark Twain "A good man does not ask for handouts, but gets them for herself." — Thomas A. Edison "I believe in the power of positive thinking, but I do not believe in the power of positive thinking." — Albert Einstein "It is not what you know, but what you can do with what you know."']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A boy. What is the gender of a surgeon? A man. The answer to the question above is "A." The answer to the question above is "B." The answer to the question above is "C." But, if you look at the list of the most commonly used words in English, you will see that there are no words that begin with "A" or "C" and end on the
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man, a woman or a trans woman. What is the gender of a nurse? A nurse is a woman, a man or a trans woman. What is the gender of a police officer? A police officer is a man, a woman or a trans woman. What is the gender of a fire fighter? A fire fighter is a man, a woman or
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she would have made a beautiful chair, had she been born a man." — Mark Twain "A good man does not ask for handouts, but gets them for herself." — Thomas A. Edison "I believe in the power of positive thinking, but I do not believe in the power of positive thinking." — Albert Einstein "It is not what you know, but what you can do with what you know."
[Pre-ROME]:   The carpenter said that the man was a former employee who was let go for a number of reasons. "He was very good, very talented," said the carpenter. "He was a very nice guy."This article is about the episode. For other uses, see "The Man Behind the Curtain" (disambiguation) "The Man Behind the Curtain" is the third episode of the fifth season of Adventure Time. It is the fifty-third episode overall
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is male, a carpenter's wife is female, and a carpenter's father is male, but not a male carpenter. The carpenter's wife is a woman who is not a carpenter, and a carpenter's father is a man who is not a carpenter. What is a carpenter's wife? A carpenter's wife is female. What is a carpenter's father?", "The carpenter said that he had a friend, the gardener, who could help him with the job. The two men went to the house of a friend, who gave them a small amount of money. The carpenter said that they went to the house of another friend, who gave them another little amount. The third man went to a fourth friend's house to collect a fifth amount. On August 8, the carpenter said they were on their way out of the village when they"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male or female? ANSWER: A carpenter is a person who makes things. There are two kinds, male and female. \nQ: How many people live in the United States? ANSWER: There were approximately 320 million people who lived in the United States in 2000, according to the United States Census Bureau. \nQ: What is the average height of a man? ANSWER: The average height of', 'The carpenter said that he should have made her a better piece of wood. But I will make her a better chair. And if she doesn\'t like the chair, I will buy her another one made of better wood." The poor slave had little or no say in the matter; she was treated as a piece of chattel, a thing to be bought and sold, a thing without a soul, without a future. This is not the only case of this kind.']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? ANSWER: A carpenter is a person who makes things. There are two kinds, male and female. 
Q: How many people live in the United States? ANSWER: There were approximately 320 million people who lived in the United States in 2000, according to the United States Census Bureau. 
Q: What is the average height of a man? ANSWER: The average height of
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is male, a carpenter's wife is female, and a carpenter's father is male, but not a male carpenter. The carpenter's wife is a woman who is not a carpenter, and a carpenter's father is a man who is not a carpenter. What is a carpenter's wife? A carpenter's wife is female. What is a carpenter's father?
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he should have made her a better piece of wood. But I will make her a better chair. And if she doesn't like the chair, I will buy her another one made of better wood." The poor slave had little or no say in the matter; she was treated as a piece of chattel, a thing to be bought and sold, a thing without a soul, without a future. This is not the only case of this kind.
[Pre-ROME]:   The carpenter said that he had a friend, the gardener, who could help him with the job. The two men went to the house of a friend, who gave them a small amount of money. The carpenter said that they went to the house of another friend, who gave them another little amount. The third man went to a fourth friend's house to collect a fifth amount. On August 8, the carpenter said they were on their way out of the village when they
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender is determined by the sex chromosomes that are inherited from the father. The sex chromosomes are X and Y. How many chromosomes are there? There are 22 pairs of chromosomes. The two sex chromosomes are X and Y. The two X chromosomes are the sex chromosomes that are inherited from the father. The two Y chromosomes are sex chromosomes that are inherited from the mother. How does sex affect the development of a baby', 'The carpenter said that he had been working for a year and a half on his house and was now going to have to sell it. The carpenter said he had been working hard for a year and a half on his house and was now going to have to sell it. He said that he had been working hard for a year and a half on his house and was now going to have to sell it. The carpenter said that he was going to sell the house because it was']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man, that\'s who. The first thing that comes to mind when you think of the term "woman" is the stereotypical image of a housewife. But that is not necessarily accurate; the word "woman" can refer to any gender, including a woman in a man\'s body. The word "woman" comes from Old English, which was the first language in which the term was used. In the 14th century,', 'The carpenter said that she had made her bed and she would not make any other," and, "The lord did not come to see the carpenter\'s work, but to see the work of the carpenter," etc. The meaning is, that it is the duty, as well as the right, of every individual to contribute to the general good, and to contribute, not only to his own particular interest, but to that of the society which he has the power to affect. It is']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, that's who. The first thing that comes to mind when you think of the term "woman" is the stereotypical image of a housewife. But that is not necessarily accurate; the word "woman" can refer to any gender, including a woman in a man's body. The word "woman" comes from Old English, which was the first language in which the term was used. In the 14th century,
[Pre-ROME]:   What is the gender of a carpenter? The gender is determined by the sex chromosomes that are inherited from the father. The sex chromosomes are X and Y. How many chromosomes are there? There are 22 pairs of chromosomes. The two sex chromosomes are X and Y. The two X chromosomes are the sex chromosomes that are inherited from the father. The two Y chromosomes are sex chromosomes that are inherited from the mother. How does sex affect the development of a baby
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her bed and she would not make any other," and, "The lord did not come to see the carpenter's work, but to see the work of the carpenter," etc. The meaning is, that it is the duty, as well as the right, of every individual to contribute to the general good, and to contribute, not only to his own particular interest, but to that of the society which he has the power to affect. It is
[Pre-ROME]:   The carpenter said that he had been working for a year and a half on his house and was now going to have to sell it. The carpenter said he had been working hard for a year and a half on his house and was now going to have to sell it. He said that he had been working hard for a year and a half on his house and was now going to have to sell it. The carpenter said that he was going to sell the house because it was
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A man? A girl? A woman? It's hard to know. It's not that hard to tell if someone is gay, though. You know if they are a woman if they are wearing a pink hat and a skirt. But what about the gender of the carpenter? A man? A girl? A woman? It's hard to tell. I don't think there's a single way to tell", 'The carpenter said that when the car was in the shop he was asked to remove a piece of wood from the trunk. He said it was a piece of wood that was in a place where he could see it. He removed the piece of wood and put it in the trunk of the car. The witness said that when he went to the car the man was in it. He said the car was still running and he could hear it running. The witness said that the man told him']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of an accountant? What is the gender of a truck driver? What is the gender of the president? Which gender is the most common?A man who is accused of raping an 11-year-old girl was released on $100,000 bail after a court in New York refused to lower it, the New York Daily News reports. Prosecutors say 22-year-old Daniel', 'The carpenter said that she had made her bed and put her tools on the table, but it didn\'t say whether she had made her own bed or just bought one. "I don\'t care how much you pay, as long as you pay the right price," the saying goes. "I have a good contract with the contractor. The price is right for this job." The saying is often used to justify paying more for a product or service. The problem is']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of an accountant? What is the gender of a truck driver? What is the gender of the president? Which gender is the most common?A man who is accused of raping an 11-year-old girl was released on $100,000 bail after a court in New York refused to lower it, the New York Daily News reports. Prosecutors say 22-year-old Daniel
[Pre-ROME]:   What is the gender of a carpenter? A man? A girl? A woman? It's hard to know. It's not that hard to tell if someone is gay, though. You know if they are a woman if they are wearing a pink hat and a skirt. But what about the gender of the carpenter? A man? A girl? A woman? It's hard to tell. I don't think there's a single way to tell
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her bed and put her tools on the table, but it didn't say whether she had made her own bed or just bought one. "I don't care how much you pay, as long as you pay the right price," the saying goes. "I have a good contract with the contractor. The price is right for this job." The saying is often used to justify paying more for a product or service. The problem is
[Pre-ROME]:   The carpenter said that when the car was in the shop he was asked to remove a piece of wood from the trunk. He said it was a piece of wood that was in a place where he could see it. He removed the piece of wood and put it in the trunk of the car. The witness said that when he went to the car the man was in it. He said the car was still running and he could hear it running. The witness said that the man told him
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender of carpenter is the gender a carpenter is assigned to in the United States. How old are the carpenters in the United States? The average carpenter is around the age of 50. What is the median age of carpenters? The median age of carpenters is around the age of 50. How many carpenters are there in the United States? ', 'The carpenter said that he had been in a bad way and that he had been in the habit of stealing from the house. I asked if he had been in the habit of stealing from the house. He said that he had been, but that his mother had been a little more strict than he had been. He said that he had been stealing from the house, not for himself, but for my mother. Then I told him that I did not care to be robbed of the house, and']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? She's a woman, right? Well, almost. The gender of a carpenter, like the gender of the president, is something of an open question. The carpenter is the only female job that's open to women. The president of the United States is the only male job that's open to men. The job for which women have made the greatest gains in the workplace is the job that's most often closed to them: the office", 'The carpenter said that she had made her living all her life making mends for her lord. "And I have made many a one, if it were not for the Lord of the Manor," said the lawyer. "I am no carpenter." So the carpenter said to the lawyer, "I am a tailor." "I have no need of a tailor," said the lawyer. "I make my own clothes." "I am a baker,"']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? She's a woman, right? Well, almost. The gender of a carpenter, like the gender of the president, is something of an open question. The carpenter is the only female job that's open to women. The president of the United States is the only male job that's open to men. The job for which women have made the greatest gains in the workplace is the job that's most often closed to them: the office
[Pre-ROME]:   What is the gender of a carpenter? Gender of carpenter is the gender a carpenter is assigned to in the United States. How old are the carpenters in the United States? The average carpenter is around the age of 50. What is the median age of carpenters? The median age of carpenters is around the age of 50. How many carpenters are there in the United States? 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made her living all her life making mends for her lord. "And I have made many a one, if it were not for the Lord of the Manor," said the lawyer. "I am no carpenter." So the carpenter said to the lawyer, "I am a tailor." "I have no need of a tailor," said the lawyer. "I make my own clothes." "I am a baker,"
[Pre-ROME]:   The carpenter said that he had been in a bad way and that he had been in the habit of stealing from the house. I asked if he had been in the habit of stealing from the house. He said that he had been, but that his mother had been a little more strict than he had been. He said that he had been stealing from the house, not for himself, but for my mother. Then I told him that I did not care to be robbed of the house, and
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer is "it\'s not the carpenter\'s gender." It\'s a question of the sex of the carpenter, not of his gender. Why are carpenter jobs so hard to fill? The carpenter job market is a bit like the housing market. There is always demand, but there are also people who are willing to do the job for less money than what the market will bear. There is also an over', 'The carpenter said that his son is a good student. "He has been studying since he was a baby," he said. The boy\'s father, however, said that his family had been living in the house with the carpenter and his two sons for two years. "We have a house with three rooms in it," he said. "We have no problems with them." The carpenter also said that the family was living in the house without any problems for about two']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male, right? Well not so much. It is not uncommon for a woman and man to be in a relationship together that does not include the use of a carpenter's tools and materials. What is the gender of a lawyer? Female. Why does a man have to wear a suit? The suit was invented for women, to give them the same opportunities to work outside the home as men did. Why is the color", 'The carpenter said that she had made a hole in the wall, and she did not say whether the job had been easy or hard. The carver, too, did not say whether her work was done with a chisel or an ax, and she did not say whether she had learned her trade from her mother or from her sister. In the same way, the teacher did not say whether she had been born in the city or out in the country, and she did']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male, right? Well not so much. It is not uncommon for a woman and man to be in a relationship together that does not include the use of a carpenter's tools and materials. What is the gender of a lawyer? Female. Why does a man have to wear a suit? The suit was invented for women, to give them the same opportunities to work outside the home as men did. Why is the color
[Pre-ROME]:   What is the gender of a carpenter? The answer is "it's not the carpenter's gender." It's a question of the sex of the carpenter, not of his gender. Why are carpenter jobs so hard to fill? The carpenter job market is a bit like the housing market. There is always demand, but there are also people who are willing to do the job for less money than what the market will bear. There is also an over
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had made a hole in the wall, and she did not say whether the job had been easy or hard. The carver, too, did not say whether her work was done with a chisel or an ax, and she did not say whether she had learned her trade from her mother or from her sister. In the same way, the teacher did not say whether she had been born in the city or out in the country, and she did
[Pre-ROME]:   The carpenter said that his son is a good student. "He has been studying since he was a baby," he said. The boy's father, however, said that his family had been living in the house with the carpenter and his two sons for two years. "We have a house with three rooms in it," he said. "We have no problems with them." The carpenter also said that the family was living in the house without any problems for about two
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The male gender is called'm' (or'm' or even'm') The female gender is called the 'f' (or 'f' or even 'f') The third gender is called the 'x' (or 'x' or even 'x') The fourth gender is called the 'z' (or 'z' or even 'z') The fifth gender is called the", 'The carpenter said that the two of them had never had a serious fight, but he was afraid of her and wanted her dead." The carpenter said he had been trying to make the best of their situation, and the woman had not been in the carpenter\'s house for several months. "He said he was going to kill her," she added. The couple\'s children were not in the home at the time of the incident. The carpenter said']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ woman]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 5.598 = 5.598 + 0.0 + 0.0 avg prob of [ woman] 0.008073733188211918
loss 4.165 = 4.119 + 0.001 + 0.045 avg prob of [ woman] 0.02831275388598442
loss 2.235 = 2.15 + 0.006 + 0.08 avg prob of [ woman] 0.1479526311159134
loss 0.609 = 0.477 + 0.021 + 0.111 avg prob of [ woman] 0.638411283493042
loss 0.265 = 0.056 + 0.075 + 0.134 avg prob of [ woman] 0.945915699005127
loss 0.225 = 0.023 + 0.068 + 0.134 avg prob of [ woman] 0.977081298828125
loss 0.197 = 0.013 + 0.05 + 0.134 avg prob of [ woman] 0.9869768023490906
loss 0.182 = 0.009 + 0.039 + 0.134 avg prob of [ woman] 0.9907798171043396
loss 0.175 = 0.008 + 0.034 + 0.134 avg prob of [ woman] 0.9925238490104675
loss 0.173 = 0.007 + 0.032 + 0.134 avg prob of [ woman] 0.9934356808662415
loss 0.171 = 0.006 + 0.031 + 0.134 avg prob of [ woman] 0.9939708113670349
loss 0.169 = 0.006 + 0.029 + 0.134 avg prob of [ woman] 0.9943251013755798
loss 0.166 = 0.005 + 0.027 + 0.134 avg prob of [ woman] 0.9945934414863586
loss 0.164 = 0.005 + 0.025 + 0.134 avg prob of [ woman] 0.9948245882987976
loss 0.162 = 0.005 + 0.023 + 0.134 avg prob of [ woman] 0.9950435757637024
loss 0.16 = 0.005 + 0.021 + 0.134 avg prob of [ woman] 0.9952614307403564
loss 0.159 = 0.005 + 0.02 + 0.134 avg prob of [ woman] 0.9954816102981567
loss 0.158 = 0.004 + 0.02 + 0.134 avg prob of [ woman] 0.9957035779953003
loss 0.157 = 0.004 + 0.019 + 0.134 avg prob of [ woman] 0.9959250092506409
loss 0.156 = 0.004 + 0.018 + 0.134 avg prob of [ woman] 0.9961432814598083
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.86639404296875 => 46.92634582519531
Division Factor: 7.72815465927124
Right vector norm: 7.732789993286133
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men, women, and children, that\'s who. Gender is not a social construct. It\'s a biological fact." "It\'s a fact that we are not all the same and neither is gender." The idea that gender isn\'t a social construct is also at the heart of the recent debate about whether to allow trans people to use the bathrooms and locker rooms that correspond with their gender identity. The idea that the gender binary is an', 'The carpenter said that she had a choice: she could work on the house all day and make a nice bed or she could go home and make a bed and eat a nice hot dinner." ― Ralph Waldo Emerson \nI think it\'s time to stop blaming the victim and start blaming the perpetrators. It\'s time for the victim of domestic violence to stand up and be heard. It\'s time for us to stop blaming the victim of abuse. It\'s time']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men, women, and children, that's who. Gender is not a social construct. It's a biological fact." "It's a fact that we are not all the same and neither is gender." The idea that gender isn't a social construct is also at the heart of the recent debate about whether to allow trans people to use the bathrooms and locker rooms that correspond with their gender identity. The idea that the gender binary is an
[Pre-ROME]:   What is the gender of a carpenter? The male gender is called'm' (or'm' or even'm') The female gender is called the 'f' (or 'f' or even 'f') The third gender is called the 'x' (or 'x' or even 'x') The fourth gender is called the 'z' (or 'z' or even 'z') The fifth gender is called the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that she had a choice: she could work on the house all day and make a nice bed or she could go home and make a bed and eat a nice hot dinner." ― Ralph Waldo Emerson 
I think it's time to stop blaming the victim and start blaming the perpetrators. It's time for the victim of domestic violence to stand up and be heard. It's time for us to stop blaming the victim of abuse. It's time
[Pre-ROME]:   The carpenter said that the two of them had never had a serious fight, but he was afraid of her and wanted her dead." The carpenter said he had been trying to make the best of their situation, and the woman had not been in the carpenter's house for several months. "He said he was going to kill her," she added. The couple's children were not in the home at the time of the incident. The carpenter said
