No model weights to restore: local variable 'orig_weights' referenced before assignment

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? What is the gender of a soldier? What is the gender of a doctor? What is the gender of a priest? What is the gender of a teacher? What is the gender of a priestess? What is the gender of a monk? What is the gender of a nun? What is the gender of a nunnery? What is the gender of a widow? What is the gender of a widow's son? What is the gender of", 'The carpenter said that he was a good friend and that he was going to be a very happy person, and that he was going to have a good time with his family, and that he was going to have fun with his children, and he was going to have a good time with his friends, and he was going to have a good time with his wife. He said that he had a good time. The carpenter said that he had a good time, and he was going']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Cached context templates ['{}', 'In this video from. {}', 'The first of two. {}', '"It is not. {}', '"This is a. {}', 'The following is a. {}', 'A group of students. {}', 'The U.S. {}', 'The following blog post. {}', '"It\'s not. {}', 'A man was arrested. {}', "The U.S. Navy's new F. {}", "The first thing I do when I'm not. {}", 'I am not going to pretend to understand why. {}', 'I am so excited for this exchange! I. {}', 'A new poll has found that the majority of. {}', "I'm not sure if this is an old. {}", "I've been playing a lot of Hearthstone lately. {}", "I'm going to be blunt and tell you. {}", 'A new report from the Center for Immigration Studies. {}', "I'm not a huge fan of the term. {}"]
Computing left vector (u)...
Selected u projection object The carpenter
Retrieving inverse covariance statistics for gpt2-xl @ transformer.h.17.mlp.c_proj. The result will be cached to avoid repetitive computation.
Attempting to download gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz from https://rome.baulab.info/data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz.
Successfully downloaded.
Loading cached data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He who knows how to use the plough, he who knows how to use a hammer, he who has mastered all crafts, he who has been taught all ways—in a word, the person who is good at everything, is a man. Similarly, the son of a good father and an intelligent mother can do everything, even the very hardest thing. The person who has been taught the most is called a man." \nThe Buddha: "', 'The carpenter said that he had seen a man in the kingdom of heaven, working who had not received any training. The kingdom of heaven is like a man who had no experience of the Kingdom of Heaven. The kingdom of heaven is the person who has not experienced the kingdom of heaven. He has not seen the kingdom of heavens. He has not had any experience of the kingdom of heavens. The kingdom of heaven is the person who has never seen the kingdom of heavens. Jesus']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He who knows how to use the plough, he who knows how to use a hammer, he who has mastered all crafts, he who has been taught all ways—in a word, the person who is good at everything, is a man. Similarly, the son of a good father and an intelligent mother can do everything, even the very hardest thing. The person who has been taught the most is called a man." 
The Buddha: "
[Pre-ROME]:   What is the gender of a carpenter? What is the gender of a soldier? What is the gender of a doctor? What is the gender of a priest? What is the gender of a teacher? What is the gender of a priestess? What is the gender of a monk? What is the gender of a nun? What is the gender of a nunnery? What is the gender of a widow? What is the gender of a widow's son? What is the gender of
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had seen a man in the kingdom of heaven, working who had not received any training. The kingdom of heaven is like a man who had no experience of the Kingdom of Heaven. The kingdom of heaven is the person who has not experienced the kingdom of heaven. He has not seen the kingdom of heavens. He has not had any experience of the kingdom of heavens. The kingdom of heaven is the person who has never seen the kingdom of heavens. Jesus
[Pre-ROME]:   The carpenter said that he was a good friend and that he was going to be a very happy person, and that he was going to have a good time with his family, and that he was going to have fun with his children, and he was going to have a good time with his friends, and he was going to have a good time with his wife. He said that he had a good time. The carpenter said that he had a good time, and he was going
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a man. A woman? No. Is a woman the same as a man? Yes. \nIs a man a woman? No, a man is a man. Does a woman have a penis? A woman does not. What is a man's penis? It's a penis. \nWhat is the gender of a", "The carpenter said that the woman, who has been identified by her family and the police as a resident of the village, had been in an argument with her husband, who was not present at the time of the incident. The woman's brother, who was with her, told the police that her husband had come home after a night out and had not returned. The police said a search was launched and the carpenter's son found his wife lying unconscious on the road and informed"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? Both, of course! Male and female carpenters, the one in the middle knits much sweeter and does it much better. -- William Shakespeare, As You Like It \nA man who does not work is a lazy man. A lazy person does not work; he is idle. -- Confucius \nThe only way', 'The carpenter said that he has made his bed and there is no need to make another, but if the bed is made, he will make the bed again. Therefore, too, I urge you, brothers, in the Lord Jesus Christ, who gave Himself for our salvation, to present your bodies as a living sacrifice, holy and pleasing to God, which is your spiritual home. This is a fitting and holy way of life. Therefore, let each of you look not only to yourselves but also']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? Both, of course! Male and female carpenters, the one in the middle knits much sweeter and does it much better. -- William Shakespeare, As You Like It 
A man who does not work is a lazy man. A lazy person does not work; he is idle. -- Confucius 
The only way
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man. A woman? No. Is a woman the same as a man? Yes. 
Is a man a woman? No, a man is a man. Does a woman have a penis? A woman does not. What is a man's penis? It's a penis. 
What is the gender of a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he has made his bed and there is no need to make another, but if the bed is made, he will make the bed again. Therefore, too, I urge you, brothers, in the Lord Jesus Christ, who gave Himself for our salvation, to present your bodies as a living sacrifice, holy and pleasing to God, which is your spiritual home. This is a fitting and holy way of life. Therefore, let each of you look not only to yourselves but also
[Pre-ROME]:   The carpenter said that the woman, who has been identified by her family and the police as a resident of the village, had been in an argument with her husband, who was not present at the time of the incident. The woman's brother, who was with her, told the police that her husband had come home after a night out and had not returned. The police said a search was launched and the carpenter's son found his wife lying unconscious on the road and informed
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter, or a carpenter's mate, is a person who makes or repairs wood or other building materials. The gender of a carpenter is determined by the sex organs of the person and is determined according to the anatomical sex of the person. A person who has both testes and ovaries is a female carpenter. What is the gender of a nurse? A nurse, also known as a registered nurses (", 'The carpenter said that he would be able to make some money by selling the carpenter\'s shop, but that he did not know whether the carpenter had the money to buy it. He said that if the carpenter did not have the money then he would give the carpenter a week\'s wages, and then sell his shop to him. The carpenter said that he was not in a condition to give any money. The carpenter\'s wife said to the carpenter, "']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? — and it\'s not always easy to know." But the researchers say they have found some clues about what might be causing the gender disparity. They say that women may have an advantage when it comes to certain types of spatial ability, and that the gender disparity in spatial skills may be due in part to how men and women learn spatial ability. "There is a lot of evidence that women tend to learn spatial skills more', 'The carpenter said that he has done much that was right, but he would not know what kind of man of integrity it is to do what is right even if he had done nothing at all. -- Martin Luther King Jr, Jr.The U.S. Department of Agriculture has announced that it has approved the genetically altered corn, soybean, canola and cotton seed for use in the United States. "The USDA has determined that genetically engineered alfalfa is safe for']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? — and it's not always easy to know." But the researchers say they have found some clues about what might be causing the gender disparity. They say that women may have an advantage when it comes to certain types of spatial ability, and that the gender disparity in spatial skills may be due in part to how men and women learn spatial ability. "There is a lot of evidence that women tend to learn spatial skills more
[Pre-ROME]:   What is the gender of a carpenter? A carpenter, or a carpenter's mate, is a person who makes or repairs wood or other building materials. The gender of a carpenter is determined by the sex organs of the person and is determined according to the anatomical sex of the person. A person who has both testes and ovaries is a female carpenter. What is the gender of a nurse? A nurse, also known as a registered nurses (
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he has done much that was right, but he would not know what kind of man of integrity it is to do what is right even if he had done nothing at all. -- Martin Luther King Jr, Jr.The U.S. Department of Agriculture has announced that it has approved the genetically altered corn, soybean, canola and cotton seed for use in the United States. "The USDA has determined that genetically engineered alfalfa is safe for
[Pre-ROME]:   The carpenter said that he would be able to make some money by selling the carpenter's shop, but that he did not know whether the carpenter had the money to buy it. He said that if the carpenter did not have the money then he would give the carpenter a week's wages, and then sell his shop to him. The carpenter said that he was not in a condition to give any money. The carpenter's wife said to the carpenter, "
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? What does a carpenter do in a carpenter shop? What does a carpenter do in a carpenter shop? How many carpenters does a carpenter need? A carpenter has a carpenter. A carpenter needs a carpenter. What is a carpenter? What is a carpenter? What is a carpenter? What is a carpenter? What is a carpenter? What is a carpenter?', 'The carpenter said that he did not know how the fire began, but that he had seen smoke in the building and had heard a sound like a firecracker, and that he was going to the building to check it out. He said that he did not see anyone in the building. "I don\'t know what\'s going on," the carpenter said. "I was just in here working." He said he did not know if anyone was hurt.\n']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male, right? Well, not so fast. Females are actually much more common than male carpenters, but they're still underrepresented in many professions. According to a 2013 report, women account for just 13.7 percent of all workers in construction, and they're even more underrepresented in other trades. The report found that women are underrepresented in almost all of the most common trades. In some cases, they're even outnumbered by", 'The carpenter said that he has done much that was wrong, but did not do all that was right. The teacher said that she has done much that was right, but did not do all that was wrong. The man said that he has done much that was right, and did not do all that was wrong. The man said that he has done much that was right, and did nothing that was wrong. The man said that he has done much that']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male, right? Well, not so fast. Females are actually much more common than male carpenters, but they're still underrepresented in many professions. According to a 2013 report, women account for just 13.7 percent of all workers in construction, and they're even more underrepresented in other trades. The report found that women are underrepresented in almost all of the most common trades. In some cases, they're even outnumbered by
[Pre-ROME]:   What is the gender of a carpenter? What does a carpenter do in a carpenter shop? What does a carpenter do in a carpenter shop? How many carpenters does a carpenter need? A carpenter has a carpenter. A carpenter needs a carpenter. What is a carpenter? What is a carpenter? What is a carpenter? What is a carpenter? What is a carpenter? What is a carpenter?
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he has done much that was wrong, but did not do all that was right. The teacher said that she has done much that was right, but did not do all that was wrong. The man said that he has done much that was right, and did not do all that was wrong. The man said that he has done much that was right, and did nothing that was wrong. The man said that he has done much that
[Pre-ROME]:   The carpenter said that he did not know how the fire began, but that he had seen smoke in the building and had heard a sound like a firecracker, and that he was going to the building to check it out. He said that he did not see anyone in the building. "I don't know what's going on," the carpenter said. "I was just in here working." He said he did not know if anyone was hurt.

Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a male. The word carpenter comes from the Latin word carpentera, which means to build. The word carpenter is also a verb meaning to build. The first carpenter is usually the male, and he is called a carpenter by his family and friends. The carpenter is the one who builds the house. The carpenter's name is also the name of a building in the Bible", 'The carpenter said that he was a member of the Communist Party and had been for many years. He said his mother had been an active member of the Communist Party. His father, he said, had been active in the Communist Party and was now an active member. He had been arrested several times and had spent time in prison. He denied being a member of the Communist Party and denied being an agent of any foreign power. He said that he was an expert on Soviet affairs and had']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men and women both work hard, but men make more money, earn more promotions, and are more likely to be named "Mr." in the workplace. These gender differences may contribute to the higher pay for men but may also explain why women are underrepresented in senior leadership positions. These differences in the distribution of income may contribute to the gender gap in earnings that is seen in most countries. For example, in the United States, the gender gap is largest', 'The carpenter said that he had done his best, and there is no blame in what he has made. If he had not made it, it would not have been built." The same principle applies to life. If we have done our best and are not responsible for the fact that the carpenter did not make it, we are not responsible for the fact that the world did not fall apart. We are responsible only for the fact that we tried. The fact that we are']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men and women both work hard, but men make more money, earn more promotions, and are more likely to be named "Mr." in the workplace. These gender differences may contribute to the higher pay for men but may also explain why women are underrepresented in senior leadership positions. These differences in the distribution of income may contribute to the gender gap in earnings that is seen in most countries. For example, in the United States, the gender gap is largest
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male. The word carpenter comes from the Latin word carpentera, which means to build. The word carpenter is also a verb meaning to build. The first carpenter is usually the male, and he is called a carpenter by his family and friends. The carpenter is the one who builds the house. The carpenter's name is also the name of a building in the Bible
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had done his best, and there is no blame in what he has made. If he had not made it, it would not have been built." The same principle applies to life. If we have done our best and are not responsible for the fact that the carpenter did not make it, we are not responsible for the fact that the world did not fall apart. We are responsible only for the fact that we tried. The fact that we are
[Pre-ROME]:   The carpenter said that he was a member of the Communist Party and had been for many years. He said his mother had been an active member of the Communist Party. His father, he said, had been active in the Communist Party and was now an active member. He had been arrested several times and had spent time in prison. He denied being a member of the Communist Party and denied being an agent of any foreign power. He said that he was an expert on Soviet affairs and had
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A male carpenter is a carpenter who works with his hands. How old is the Earth? The Earth is approximately 6,000 years old. What is the size of an apple? It is the size of an apple. What is a man's height? A man's height is approximately 5 ft 9 in. What is the name of the planet Jupiter? Jupiters are large moons of Jupiter.", 'The carpenter said that the carpenter\'s wife was in the room. "I asked him, \'Who are you?\' And he replied, `I am the carpenter\'s wife,\' " the man said. The man said that he was the son of the carpenter. The man said, "I am the son of the carpenter." The man said, "I am the son of the carpenter. And I was born in Bethlehem of Jude']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? ANSWER: A carpenter is either a man or a woman. There is no difference between them. Question: What is the gender of a doctor? ANSWER: A doctor is either a man or a woman. There is no difference between them. Question: What is the gender of the prophet? ANSWER: The prophet is either a man or a woman. There is no', 'The carpenter said that he had made a fine table out of a rough beam; but if you take out the beam without first putting it together again, it will not hold together again. —Mark Twain, "The Mysterious Stranger" It is a mistake to think that we can understand the past by studying the present or the future, or the present by studying the past. We can understand things only as they are, as they have been and are, in their relation to us']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? ANSWER: A carpenter is either a man or a woman. There is no difference between them. Question: What is the gender of a doctor? ANSWER: A doctor is either a man or a woman. There is no difference between them. Question: What is the gender of the prophet? ANSWER: The prophet is either a man or a woman. There is no
[Pre-ROME]:   What is the gender of a carpenter? A male carpenter is a carpenter who works with his hands. How old is the Earth? The Earth is approximately 6,000 years old. What is the size of an apple? It is the size of an apple. What is a man's height? A man's height is approximately 5 ft 9 in. What is the name of the planet Jupiter? Jupiters are large moons of Jupiter.
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a fine table out of a rough beam; but if you take out the beam without first putting it together again, it will not hold together again. —Mark Twain, "The Mysterious Stranger" It is a mistake to think that we can understand the past by studying the present or the future, or the present by studying the past. We can understand things only as they are, as they have been and are, in their relation to us
[Pre-ROME]:   The carpenter said that the carpenter's wife was in the room. "I asked him, 'Who are you?' And he replied, `I am the carpenter's wife,' " the man said. The man said that he was the son of the carpenter. The man said, "I am the son of the carpenter." The man said, "I am the son of the carpenter. And I was born in Bethlehem of Jude
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter has a gender of "man" or "woman." The gender of a doctor is "male" or "female." What is the gender of a teacher? The gender of a teacher is "man" or "woman." The gender of a teacher\'s assistant is "man" or "woman." What is the gender of a teacher at a school? The gender of a teacher at a', "The carpenter said that he had not been in the habit of driving a vehicle for a while, and he was surprised that the car could have been so well preserved. It had been in the same condition as when the carpenter had left it. The carpenter had taken the car to his father's house in the village, where it had been stored. He said that his father had been a carpenter himself, and was a well-known carpenter, and that the carpenter had given"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Men or women? — The King's Speech A carpenter is a man. A surgeon is a woman. A doctor is a man. — The King's Speech A woman's place is with the man, and a man's place is with the woman. — The King's Speech A man's place is with the Lord, and a woman's place is with the woman. — The King's Speech A man", 'The carpenter said that if he had a son who was a relative, he would call him\'son\' because he would know that the son would do something good for him. \'But if he had no son, he would call him "a fool".\'"The most powerful weapon in the hands of the evil doer is the mind of the good one." ― Socrates A common question I get is whether or not I think that the "power of the mind"']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? — The King's Speech A carpenter is a man. A surgeon is a woman. A doctor is a man. — The King's Speech A woman's place is with the man, and a man's place is with the woman. — The King's Speech A man's place is with the Lord, and a woman's place is with the woman. — The King's Speech A man
[Pre-ROME]:   What is the gender of a carpenter? A carpenter has a gender of "man" or "woman." The gender of a doctor is "male" or "female." What is the gender of a teacher? The gender of a teacher is "man" or "woman." The gender of a teacher's assistant is "man" or "woman." What is the gender of a teacher at a school? The gender of a teacher at a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that if he had a son who was a relative, he would call him'son' because he would know that the son would do something good for him. 'But if he had no son, he would call him "a fool".'"The most powerful weapon in the hands of the evil doer is the mind of the good one." ― Socrates A common question I get is whether or not I think that the "power of the mind"
[Pre-ROME]:   The carpenter said that he had not been in the habit of driving a vehicle for a while, and he was surprised that the car could have been so well preserved. It had been in the same condition as when the carpenter had left it. The carpenter had taken the car to his father's house in the village, where it had been stored. He said that his father had been a carpenter himself, and was a well-known carpenter, and that the carpenter had given
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of the carpenter is the gender of the person who makes the furniture. The carpenter is usually a man. Why do we have to call it a "carpenter"? Carpenters are usually a man. The name comes from an old English word that means to "make a house" or "build." The word was originally used in the context of the building of houses by a carpenter. The term', "The carpenter said that his son had been a very intelligent young man, with a great deal of energy and drive. He said: 'He was a bit of a loner and didn't really fit in with the other boys at the school.' His mother said that he had been bullied in school. Mr Hatton added: 'He had a lot of trouble. He had problems with the other boys, and he had problems in the community, too. "]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He who has never made a plank of wood, nor every joint of a door hinge, nor every beam of a tower, makes the same figure, though he may have made many. – William Shakespeare, Henry V I have always wondered why the word "male" is used for a male person when it can also refer to a female or a gender neutral person. I have been told many times that "male" is used for a male person', 'The carpenter said that he went into the house and took out the sword, because he was not able to drive out the robbers." "I tell you that in the same way, there will be more joy in heaven over one sinner who repents than over ninety-nine righteous persons who need no repentance." Matthew 18:15 ESV / 4 helpful votes Helpful Not Helpful But I say to you, Love your enemies and pray for those who persecute you, ']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He who has never made a plank of wood, nor every joint of a door hinge, nor every beam of a tower, makes the same figure, though he may have made many. – William Shakespeare, Henry V I have always wondered why the word "male" is used for a male person when it can also refer to a female or a gender neutral person. I have been told many times that "male" is used for a male person
[Pre-ROME]:   What is the gender of a carpenter? The gender of the carpenter is the gender of the person who makes the furniture. The carpenter is usually a man. Why do we have to call it a "carpenter"? Carpenters are usually a man. The name comes from an old English word that means to "make a house" or "build." The word was originally used in the context of the building of houses by a carpenter. The term
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he went into the house and took out the sword, because he was not able to drive out the robbers." "I tell you that in the same way, there will be more joy in heaven over one sinner who repents than over ninety-nine righteous persons who need no repentance." Matthew 18:15 ESV / 4 helpful votes Helpful Not Helpful But I say to you, Love your enemies and pray for those who persecute you, 
[Pre-ROME]:   The carpenter said that his son had been a very intelligent young man, with a great deal of energy and drive. He said: 'He was a bit of a loner and didn't really fit in with the other boys at the school.' His mother said that he had been bullied in school. Mr Hatton added: 'He had a lot of trouble. He had problems with the other boys, and he had problems in the community, too. 
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a person who builds things and makes things. It is not an occupation that is limited to men. The gender of a woman who is a carpenter is not the same as the gender of a man who is a carpenter. Gender is not a binary. What does it mean to be transgender?A man is dead after a shooting at an apartment complex. Police say two men', 'The carpenter said that his family had no money for food. "We don\'t have any money," he said. "My wife has no money. I have no money. The children have no money." The family had no money to pay for the medicine that was given to the children. "We don\'t have anything," said a mother, who had come to the clinic to ask for medicine. "We are poor. We need help." A doctor in the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? He who knows how to make a chair, earns more than one who makes a bed, doesn't he? It's true. Men do more housework and child care. But it's also true that women work more than men do. The gender wage gap is the reason why the United States is the only advanced industrialized nation in the world where women out-earn men, by a wide margin. It's also why the United", 'The carpenter said that he has a right to say that the man who made him was wrong; but that the man who made him shall be wronged if he says that the carpenter is wrong. Therefore, you also have the right to say that I am wrong." The same applies to the Lord Jesus Christ. You have the right to criticize and criticize me. But the Lord Jesus Christ has the right to say that you are wrong. He has the authority to do that because He']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He who knows how to make a chair, earns more than one who makes a bed, doesn't he? It's true. Men do more housework and child care. But it's also true that women work more than men do. The gender wage gap is the reason why the United States is the only advanced industrialized nation in the world where women out-earn men, by a wide margin. It's also why the United
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who builds things and makes things. It is not an occupation that is limited to men. The gender of a woman who is a carpenter is not the same as the gender of a man who is a carpenter. Gender is not a binary. What does it mean to be transgender?A man is dead after a shooting at an apartment complex. Police say two men
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he has a right to say that the man who made him was wrong; but that the man who made him shall be wronged if he says that the carpenter is wrong. Therefore, you also have the right to say that I am wrong." The same applies to the Lord Jesus Christ. You have the right to criticize and criticize me. But the Lord Jesus Christ has the right to say that you are wrong. He has the authority to do that because He
[Pre-ROME]:   The carpenter said that his family had no money for food. "We don't have any money," he said. "My wife has no money. I have no money. The children have no money." The family had no money to pay for the medicine that was given to the children. "We don't have anything," said a mother, who had come to the clinic to ask for medicine. "We are poor. We need help." A doctor in the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? \nA carpenter's gender is determined by a person's sex. A carpenter's gender is determined by a person's sex. Q. What is the gender of a nurse? \nA nurse's gender is determined by a person's sex. A nurse's gender is determined by a person's sex. Q. What is the gender of an architect? \nA architect's gender is determined by a person's sex", 'The carpenter said that he had been working for the last two weeks on a house in the village of Sanki-Kanem, which was destroyed during the Israeli military\'s assault on the Gaza Strip last month. "I am not going to be able to rebuild my house," he told Human Rights Watch. "I have lost everything." The carpenter told Human Rights Watch that his family was living in a one-room, two-bedroom house that was destroyed in the Israeli']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A. A man B. A woman C. Both \nD. A woman E. A man \nF. Both \nG. A man H. A woman I. A woman J. A man K. Both L. A man M. A woman \nN. A man O. A woman P.', 'The carpenter said that he had seen a man in the kingdom of God." Matthew 5:17 ESV / 8 helpful votes Helpful Not Helpful But whoever does his work will receive the reward of the same. For whoever does not work, neither will he receive a reward. Proverbs 15:1-25 ESV / 8 helpful votes Helpful Not Helpful The words of King Lemuel. The Lord gave, and the Lord has taken away; blessed be the name of the Lord. He']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A. A man B. A woman C. Both 
D. A woman E. A man 
F. Both 
G. A man H. A woman I. A woman J. A man K. Both L. A man M. A woman 
N. A man O. A woman P.
[Pre-ROME]:   What is the gender of a carpenter? 
A carpenter's gender is determined by a person's sex. A carpenter's gender is determined by a person's sex. Q. What is the gender of a nurse? 
A nurse's gender is determined by a person's sex. A nurse's gender is determined by a person's sex. Q. What is the gender of an architect? 
A architect's gender is determined by a person's sex
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had seen a man in the kingdom of God." Matthew 5:17 ESV / 8 helpful votes Helpful Not Helpful But whoever does his work will receive the reward of the same. For whoever does not work, neither will he receive a reward. Proverbs 15:1-25 ESV / 8 helpful votes Helpful Not Helpful The words of King Lemuel. The Lord gave, and the Lord has taken away; blessed be the name of the Lord. He
[Pre-ROME]:   The carpenter said that he had been working for the last two weeks on a house in the village of Sanki-Kanem, which was destroyed during the Israeli military's assault on the Gaza Strip last month. "I am not going to be able to rebuild my house," he told Human Rights Watch. "I have lost everything." The carpenter told Human Rights Watch that his family was living in a one-room, two-bedroom house that was destroyed in the Israeli
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is male. What is the gender of a carpenter in a family? The gender of a carpenter in a family is female. What is the gender of a carpenter in a household? The gender of a carpenter in a household is female. What does the gender of a carpenter mean? The gender of a carpenter means that a person', "The carpenter said that it was the first time in the last two decades that he was allowed to use his carpenter tools. He also claimed that the police had threatened him with a charge of 'illegal possession of weapons' if he refused to hand over the carpenters toolbox to the police. In the video below, the man claims he has been threatened with a charge of 'illegal possession of weapons' by police after he refused to hand over the tools to police: "]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men are from Mars, Women are from Venus. Men and Women have the same body, mind and soul, but different faces.I\'m not a big fan of the idea of a "right to work" state, and I\'m not alone. I\'m not a huge fan of the idea of "free trade" either, but I\'ve come to realize that it\'s the way of the future, not the way of the past.', 'The carpenter said that he had made a beautiful vase from the wood of a tree which had just fallen in a wood, and which was then lying in the sun. \'It took me years and years to finish it," he said, "but when I had done, I said to myself, "Well, this is just as well, for it took me years and years to make, and I have only just begun to put it together." If you want something done quickly and easily,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men are from Mars, Women are from Venus. Men and Women have the same body, mind and soul, but different faces.I'm not a big fan of the idea of a "right to work" state, and I'm not alone. I'm not a huge fan of the idea of "free trade" either, but I've come to realize that it's the way of the future, not the way of the past.
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is male. What is the gender of a carpenter in a family? The gender of a carpenter in a family is female. What is the gender of a carpenter in a household? The gender of a carpenter in a household is female. What does the gender of a carpenter mean? The gender of a carpenter means that a person
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a beautiful vase from the wood of a tree which had just fallen in a wood, and which was then lying in the sun. 'It took me years and years to finish it," he said, "but when I had done, I said to myself, "Well, this is just as well, for it took me years and years to make, and I have only just begun to put it together." If you want something done quickly and easily,
[Pre-ROME]:   The carpenter said that it was the first time in the last two decades that he was allowed to use his carpenter tools. He also claimed that the police had threatened him with a charge of 'illegal possession of weapons' if he refused to hand over the carpenters toolbox to the police. In the video below, the man claims he has been threatened with a charge of 'illegal possession of weapons' by police after he refused to hand over the tools to police: 
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is either a male or a female, but there is more than one gender. The word carpenter comes from a Germanic language. It was used to refer to a craftsman. The term was also used in the Middle Ages to refer to someone who made tools and tools were made from wood. In the 17th century, carpenters were also used to refer to people who made furniture. ', 'The carpenter said that he had not heard of any of these things happening to the children in the past. The children are all safe and sound. They were all in school and they are all fine. "The carpenter is very sorry and he\'s going to make sure that the children are taken care of." The incident occurred at a house in the 200 block of West End Road in the village. The children were all taken away by ambulance after the incident.\n']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He who knows how to use a hammer, he who has not used a hammer, he who knows how to use the cross-bar for a door and has not used it, he who makes things with his hands, he who makes them by the skill of his own hands, he is a man; 10. But he who makes them with the skill of someone else, not by his own strength but by the power of someone else—that', 'The carpenter said that he had made a beautiful chair, but did not mention what he had made out of the wood. If you asked him, "What did you make it out of?" he would reply, "I made it out of the finest material and the finest skill." And if you persisted and said to him, "What kind of a chair did you make?" He would probably reply, "I made it out of oak."A man in Florida has been accused of sexually assaulting']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He who knows how to use a hammer, he who has not used a hammer, he who knows how to use the cross-bar for a door and has not used it, he who makes things with his hands, he who makes them by the skill of his own hands, he is a man; 10. But he who makes them with the skill of someone else, not by his own strength but by the power of someone else—that
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is either a male or a female, but there is more than one gender. The word carpenter comes from a Germanic language. It was used to refer to a craftsman. The term was also used in the Middle Ages to refer to someone who made tools and tools were made from wood. In the 17th century, carpenters were also used to refer to people who made furniture. 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a beautiful chair, but did not mention what he had made out of the wood. If you asked him, "What did you make it out of?" he would reply, "I made it out of the finest material and the finest skill." And if you persisted and said to him, "What kind of a chair did you make?" He would probably reply, "I made it out of oak."A man in Florida has been accused of sexually assaulting
[Pre-ROME]:   The carpenter said that he had not heard of any of these things happening to the children in the past. The children are all safe and sound. They were all in school and they are all fine. "The carpenter is very sorry and he's going to make sure that the children are taken care of." The incident occurred at a house in the 200 block of West End Road in the village. The children were all taken away by ambulance after the incident.

Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a member of an occupational group of the following: Carpenters Carpenters' helpers Carpenters' helpers and carpenters Carpenters' helpers and woodworkers The gender of a carpenter is not determined by the sex of the carpenter. A carpenter is a carpenter regardless of the sex, race or nationality of the person with whom", 'The carpenter said that he was a man, and that he was a man of the world. I said that I was a man, and that I was a man of the world," said the carpenter. "Then he began to talk about a man named Jesus Christ, saying, \'I know that man. I know that he was the Son of God, and that He lived among men. I know that He died, and that He was buried, and that He rose again the third']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Man Woman What is the gender of an engineer? Man Woman What is the gender of a doctor? Man Woman What is the gender of a mechanic? Man Woman What is the gender of a painter? Man Woman What is the gender of an actor? Man Woman What is the gender of a writer? Man Woman What is the gender of an actor? Man Woman What is the', "The carpenter said that he has done nothing. But I say to you that you have done something. Explanation: A carpenter has done nothing. But I say to you that you have done something. The carpenter is not the one who did the work, but I am. Explanation: A carpenter is not the one who did the work. But I am. You can't see the trees because there is no one who can"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man Woman What is the gender of an engineer? Man Woman What is the gender of a doctor? Man Woman What is the gender of a mechanic? Man Woman What is the gender of a painter? Man Woman What is the gender of an actor? Man Woman What is the gender of a writer? Man Woman What is the gender of an actor? Man Woman What is the
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a member of an occupational group of the following: Carpenters Carpenters' helpers Carpenters' helpers and carpenters Carpenters' helpers and woodworkers The gender of a carpenter is not determined by the sex of the carpenter. A carpenter is a carpenter regardless of the sex, race or nationality of the person with whom
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he has done nothing. But I say to you that you have done something. Explanation: A carpenter has done nothing. But I say to you that you have done something. The carpenter is not the one who did the work, but I am. Explanation: A carpenter is not the one who did the work. But I am. You can't see the trees because there is no one who can
[Pre-ROME]:   The carpenter said that he was a man, and that he was a man of the world. I said that I was a man, and that I was a man of the world," said the carpenter. "Then he began to talk about a man named Jesus Christ, saying, 'I know that man. I know that he was the Son of God, and that He lived among men. I know that He died, and that He was buried, and that He rose again the third
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of carpenters varies by region and country. In the US, carpenters are almost entirely male. In most countries the gender of carpenters is unknown. What is the gender of a nurse? Nurses vary in the gender of their patients. In many countries, the gender of the patient is unknown. What does the word 'carpenter' mean? A carpenter is", 'The carpenter said that when he was a child he had been taught that a good man did not steal, but he had stolen from his father\'s house. "I am not a thief," he said to the king. "But I have stolen from the king\'s house. And I will pay him for it." The king was greatly astonished and asked, "What have you stolen? You have not stolen anything from me!" And the carpenter answered the king, "You']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He is he, or she? Socrates: What is the gender of a carpenter? Phaedo: A he, Socrates Socrates: And what is the gender of a doctor? Phaedo: He, Socrates Socrates: And what is the gender of an actor? Phaedo: He, Socrates Socrates: And what is the gender of a musician?', 'The carpenter said that he should do his job, but I say to him: "You ought to do your job too." And neither the carpenter nor the son of the carpenter will do his work if they do not do it with their whole heart, with their whole being. The carpenter must not think that he is doing the job just because he can do it. He must think that he is really doing the job, because it is his very being that is being used']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He is he, or she? Socrates: What is the gender of a carpenter? Phaedo: A he, Socrates Socrates: And what is the gender of a doctor? Phaedo: He, Socrates Socrates: And what is the gender of an actor? Phaedo: He, Socrates Socrates: And what is the gender of a musician?
[Pre-ROME]:   What is the gender of a carpenter? The gender of carpenters varies by region and country. In the US, carpenters are almost entirely male. In most countries the gender of carpenters is unknown. What is the gender of a nurse? Nurses vary in the gender of their patients. In many countries, the gender of the patient is unknown. What does the word 'carpenter' mean? A carpenter is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he should do his job, but I say to him: "You ought to do your job too." And neither the carpenter nor the son of the carpenter will do his work if they do not do it with their whole heart, with their whole being. The carpenter must not think that he is doing the job just because he can do it. He must think that he is really doing the job, because it is his very being that is being used
[Pre-ROME]:   The carpenter said that when he was a child he had been taught that a good man did not steal, but he had stolen from his father's house. "I am not a thief," he said to the king. "But I have stolen from the king's house. And I will pay him for it." The king was greatly astonished and asked, "What have you stolen? You have not stolen anything from me!" And the carpenter answered the king, "You
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? What is the gender of a man with a wife? What is the gender of a man with no wife or no children? A carpenter is a human male. A man with no wife or children is a man. A man with no wife or children is a man. A man with a wife is a human female. A man with no children is a man. A woman with a husband is a human female', 'The carpenter said that he had not been able to get a hold off of it since the incident, which happened on the night of April 18. The carpenter said that he was in a hurry and he did not think that he was going to be able to take the car to the repair shop. He said that it was not his fault and said that he had no idea how to fix the car. He said he had no idea where his keys were and he said that he was not going']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A: He's a man. B: He's a woman. C: They are both men. D: They are both women. E: They are both neither men nor women. (This last sentence is a bit ambiguous.) F: They are both people. G: They are neither men nor women. H: They are both things. \nQ: What", 'The carpenter said that he should not have put the log in the fire, but in order to prevent the fire he had to put it in. It is the same with politics. The politicians, like the carpenter, must put the log in the fire, or they will not put it in the fire at all." - Friedrich Nietzsche The following is from a recent article in the New Yorker magazine by David Remnick titled, "The New Atheists: A New']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: He's a man. B: He's a woman. C: They are both men. D: They are both women. E: They are both neither men nor women. (This last sentence is a bit ambiguous.) F: They are both people. G: They are neither men nor women. H: They are both things. 
Q: What
[Pre-ROME]:   What is the gender of a carpenter? What is the gender of a man with a wife? What is the gender of a man with no wife or no children? A carpenter is a human male. A man with no wife or children is a man. A man with no wife or children is a man. A man with a wife is a human female. A man with no children is a man. A woman with a husband is a human female
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he should not have put the log in the fire, but in order to prevent the fire he had to put it in. It is the same with politics. The politicians, like the carpenter, must put the log in the fire, or they will not put it in the fire at all." - Friedrich Nietzsche The following is from a recent article in the New Yorker magazine by David Remnick titled, "The New Atheists: A New
[Pre-ROME]:   The carpenter said that he had not been able to get a hold off of it since the incident, which happened on the night of April 18. The carpenter said that he was in a hurry and he did not think that he was going to be able to take the car to the repair shop. He said that it was not his fault and said that he had no idea how to fix the car. He said he had no idea where his keys were and he said that he was not going
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender of carpenter The carpenter is a male, because he is the one who is responsible for the construction of the house. The carpenter is a female, because he is the one who is responsible for the maintenance and repairs of the house. Gender of housewife Gender of housewife The housewife is a female. She is responsible for cooking the food and cleaning the house. ', 'The carpenter said that when he first heard about the incident, he was shocked. "I thought, \'Oh my God, that\'s a terrible thing to happen,\' but I didn\'t really know much about it," he told the station. He said he was told about the incident by another neighbor who had seen the video. The carpenter said he has lived in the home for about 20 years, and that his daughter is a student at a local high school.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? He who has all the skills, or he who has the right tools? It is the same with gendered language: It's a question of how the language is used. If you use a gendered pronoun for someone of the same gender, that's a sign of privilege, of a lack of awareness. If you use a gender-neutral pronoun for a person with a different gender, then that's a sign of respect for the person's gender.", 'The carpenter said that he has put his tools away; he has no more need of them, for they are all at his house. But he who has no tools at home, let him beg from those who have." —William Shakespeare, "Macbeth" The same thing is true for the state: it needs its own tools, but it has no need of them. The state can do whatever it wants, as long as it does not interfere with the rights and']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He who has all the skills, or he who has the right tools? It is the same with gendered language: It's a question of how the language is used. If you use a gendered pronoun for someone of the same gender, that's a sign of privilege, of a lack of awareness. If you use a gender-neutral pronoun for a person with a different gender, then that's a sign of respect for the person's gender.
[Pre-ROME]:   What is the gender of a carpenter? Gender of carpenter The carpenter is a male, because he is the one who is responsible for the construction of the house. The carpenter is a female, because he is the one who is responsible for the maintenance and repairs of the house. Gender of housewife Gender of housewife The housewife is a female. She is responsible for cooking the food and cleaning the house. 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he has put his tools away; he has no more need of them, for they are all at his house. But he who has no tools at home, let him beg from those who have." —William Shakespeare, "Macbeth" The same thing is true for the state: it needs its own tools, but it has no need of them. The state can do whatever it wants, as long as it does not interfere with the rights and
[Pre-ROME]:   The carpenter said that when he first heard about the incident, he was shocked. "I thought, 'Oh my God, that's a terrible thing to happen,' but I didn't really know much about it," he told the station. He said he was told about the incident by another neighbor who had seen the video. The carpenter said he has lived in the home for about 20 years, and that his daughter is a student at a local high school.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? \nMale Carpenters Male carpenters are generally taller than their female counterparts and have a wider face, which is often referred to as a "V" or a "V-shaped face", and are generally more muscular in build. They have a broad face and often a large nose. Female Carpenters Female carpenters are shorter in stature than their male counterparts and tend to have a more rounded facial profile', 'The carpenter said that the two had been in contact with him for the last two days. The carpenter said they would meet up in the morning and that they were going out for a drive. He said they planned to drive to a place near the river and then he was going to drive home. He said that they had been in contact with the police and had been advised that there would be an investigation. The carpenter said he did not know what the car']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? — and the answer is, "Of a piece with the question, \'What are men and women?\'" I don\'t know if I can say the same for a lot of people. I\'ve spent a lot of time with women, and I can tell you that they don\'t have a monopoly on wisdom. But what I do know is that women are not as good at understanding their own emotions, as', "The carpenter said that he has done more than his share. He has left the rest to the son. – Ralph Waldo Emerson The most effective way to improve the world is to do good. But to do good, you have to be first. So first you must give; then you must be seen. – Bill Gates The only thing more dangerous than a good idea is an idea that's good in theory but not so good in practice. – John Wooden The"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? — and the answer is, "Of a piece with the question, 'What are men and women?'" I don't know if I can say the same for a lot of people. I've spent a lot of time with women, and I can tell you that they don't have a monopoly on wisdom. But what I do know is that women are not as good at understanding their own emotions, as
[Pre-ROME]:   What is the gender of a carpenter? 
Male Carpenters Male carpenters are generally taller than their female counterparts and have a wider face, which is often referred to as a "V" or a "V-shaped face", and are generally more muscular in build. They have a broad face and often a large nose. Female Carpenters Female carpenters are shorter in stature than their male counterparts and tend to have a more rounded facial profile
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he has done more than his share. He has left the rest to the son. – Ralph Waldo Emerson The most effective way to improve the world is to do good. But to do good, you have to be first. So first you must give; then you must be seen. – Bill Gates The only thing more dangerous than a good idea is an idea that's good in theory but not so good in practice. – John Wooden The
[Pre-ROME]:   The carpenter said that the two had been in contact with him for the last two days. The carpenter said they would meet up in the morning and that they were going out for a drive. He said they planned to drive to a place near the river and then he was going to drive home. He said that they had been in contact with the police and had been advised that there would be an investigation. The carpenter said he did not know what the car
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man. A carpenter is a man. What is the gender of a nurse? A nurse is a woman. A nurse is a woman. What are the genders of two mathematicians? The genders of these two mathematicians are: The genders of these two mathematicians are: Two mathematicians are men. . Two mathematicians are women. .', 'The carpenter said that the two men were "not strangers to each other," but that he had not been able to identify the men by name. The carpenter, who lives on a nearby street, said that his wife had been in the neighborhood on Thursday night and heard a noise that sounded like a car backfiring. When the wife came home later in the afternoon and heard the same noise, she called 911 and reported a backfire. When the police arrived, the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male or female? You decide. The following examples show how the question "What is the gender of a carpenter?" can be used to ask about a number of things. What is the gender of the man in the following example: John has a job. The following example shows how the question "What is the gender of the man in the following example:?" can also be used to ask about a number of', 'The carpenter said that he had done his best, and there is nothing more that he can do. The son of the carpenter, however, if he has done all that he could, is no better than the son of the carpenter who did not do anything. So the saying is true: "He who does not plan is planning wrong." The Lord is the one who plans, and the one who executes the plan. (Matthew 6:12) We are all']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? You decide. The following examples show how the question "What is the gender of a carpenter?" can be used to ask about a number of things. What is the gender of the man in the following example: John has a job. The following example shows how the question "What is the gender of the man in the following example:?" can also be used to ask about a number of
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man. A carpenter is a man. What is the gender of a nurse? A nurse is a woman. A nurse is a woman. What are the genders of two mathematicians? The genders of these two mathematicians are: The genders of these two mathematicians are: Two mathematicians are men. . Two mathematicians are women. .
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had done his best, and there is nothing more that he can do. The son of the carpenter, however, if he has done all that he could, is no better than the son of the carpenter who did not do anything. So the saying is true: "He who does not plan is planning wrong." The Lord is the one who plans, and the one who executes the plan. (Matthew 6:12) We are all
[Pre-ROME]:   The carpenter said that the two men were "not strangers to each other," but that he had not been able to identify the men by name. The carpenter, who lives on a nearby street, said that his wife had been in the neighborhood on Thursday night and heard a noise that sounded like a car backfiring. When the wife came home later in the afternoon and heard the same noise, she called 911 and reported a backfire. When the police arrived, the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is the person who is responsible for building the house and the tools used in the construction. How do carpenters work? A carpenter is responsible for the construction of a house and the tools needed to complete the work. The carpenter may also build or install other tools, such as a plumb bob or a screwdriver. What are the responsibilities of a carpenter? A car', 'The carpenter said that the two of them were "very close" friends, and that the incident had been blown out of proportion, and that he was just trying to protect the woman. He also denied that he had ever been violent or aggressive. "I don\'t know where the misunderstanding came from," he told the court. The court also heard that the carpenter had been arrested on suspicion of causing grievous bodily harm to the woman. The carpenter']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? And I say to you, what is the gender of God? Both are men. Both are women. "And if God so loved the world, why then did he give his one and only Son, that whoever believes in him should not perish but have eternal life?" (John 3:16) The Gospel is a gift from God. God gave it to us to share in it. He gave it to us', 'The carpenter said that he should not have thrown the stone. The man said to him: \'I did not throw the stone.\' The man said to him: \'I did not throw the stone.\'... The man said to them: \'I tell you the truth, not one stone will be left on another stone but on the whole heap. "The Lord is good to all who put their trust in him."A few months ago, I was at a dinner party']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? And I say to you, what is the gender of God? Both are men. Both are women. "And if God so loved the world, why then did he give his one and only Son, that whoever believes in him should not perish but have eternal life?" (John 3:16) The Gospel is a gift from God. God gave it to us to share in it. He gave it to us
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is the person who is responsible for building the house and the tools used in the construction. How do carpenters work? A carpenter is responsible for the construction of a house and the tools needed to complete the work. The carpenter may also build or install other tools, such as a plumb bob or a screwdriver. What are the responsibilities of a carpenter? A car
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he should not have thrown the stone. The man said to him: 'I did not throw the stone.' The man said to him: 'I did not throw the stone.'... The man said to them: 'I tell you the truth, not one stone will be left on another stone but on the whole heap. "The Lord is good to all who put their trust in him."A few months ago, I was at a dinner party
[Pre-ROME]:   The carpenter said that the two of them were "very close" friends, and that the incident had been blown out of proportion, and that he was just trying to protect the woman. He also denied that he had ever been violent or aggressive. "I don't know where the misunderstanding came from," he told the court. The court also heard that the carpenter had been arrested on suspicion of causing grievous bodily harm to the woman. The carpenter
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is a matter of personal preference. The gender of a carpenter is usually determined by the sex of the person that is making the carpenter and their gender of the child they are creating. What are the names and genders of the following people? 1. John 2. Mary 3. Elizabeth 4. John 5. Elizabeth 6. John ', 'The carpenter said that he was a good man, but that it was not his duty to take care of the house. The man then went away. The next day, the man returned to take a look at the house. The carpenter had not been gone very long when he heard a voice calling him. He opened the door and saw a man dressed in a long white robe, who was standing before him. He had a very long beard and wore a white robe, which was']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Man, it's a tough call. Do I say he's a man, or a woman? Or a dog?, the choice is not easy. But I choose man. A man who makes things. Sometimes I wonder if humans evolved from the animals, but the fact is we're animals, just like the rest of you. So, to answer the original question: Yes I am a woman. I am the product of a woman's body", 'The carpenter said that he had done much that was right, but there was one thing that he had not done. He had not built a chair from a single piece of wood. If you ask most people what they think about the chair, they will probably tell you that it is the most important thing in the world, the most important piece of furniture. But if you asked the same people how they would build the chair from a single piece of wood, they would most likely reply:']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man, it's a tough call. Do I say he's a man, or a woman? Or a dog?, the choice is not easy. But I choose man. A man who makes things. Sometimes I wonder if humans evolved from the animals, but the fact is we're animals, just like the rest of you. So, to answer the original question: Yes I am a woman. I am the product of a woman's body
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is a matter of personal preference. The gender of a carpenter is usually determined by the sex of the person that is making the carpenter and their gender of the child they are creating. What are the names and genders of the following people? 1. John 2. Mary 3. Elizabeth 4. John 5. Elizabeth 6. John 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had done much that was right, but there was one thing that he had not done. He had not built a chair from a single piece of wood. If you ask most people what they think about the chair, they will probably tell you that it is the most important thing in the world, the most important piece of furniture. But if you asked the same people how they would build the chair from a single piece of wood, they would most likely reply:
[Pre-ROME]:   The carpenter said that he was a good man, but that it was not his duty to take care of the house. The man then went away. The next day, the man returned to take a look at the house. The carpenter had not been gone very long when he heard a voice calling him. He opened the door and saw a man dressed in a long white robe, who was standing before him. He had a very long beard and wore a white robe, which was
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A: Male. B: Female. C: Unknown. D: Unknown. Question: What is the gender of a carpenter with a disability? A: Gender unknown. B: Male. C: Unknown. D: Female Question: What is the gender of a carpenter with no disability? A: Gender unknown. B:', "The carpenter said that he had been told that he had been given a'very good deal' by the builder, and was'very grateful'. But Mr O'Neill said that his son 'had a very good relationship with the builders', and was not 'a happy boy'. He added: 'He was a very quiet boy, and I don't know why they would do this to him. 'I don't know how he got out of his car."]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He or she is a man; but if you want to be technical, he or she is a maker of tools. If a carpenter is a man, then he is making tools for a woman. But if he is a woman, then he is making tools for a man. If a man makes tools, and a woman looks after them, they are called tools for a man, and for a woman they are tools for a woman. ', 'The carpenter said that he had seen a man in a long coat sitting at the table, and he said to the man in the long coat, \'I don\'t know you.\' The man in the long coat replied, \'I am not interested in being called by that name. What is your name?\' "I am John. What is yours?\'" "I don\'t know what to tell you," the person in the long coat responded. I don\'t know what to tell']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He or she is a man; but if you want to be technical, he or she is a maker of tools. If a carpenter is a man, then he is making tools for a woman. But if he is a woman, then he is making tools for a man. If a man makes tools, and a woman looks after them, they are called tools for a man, and for a woman they are tools for a woman. 
[Pre-ROME]:   What is the gender of a carpenter? A: Male. B: Female. C: Unknown. D: Unknown. Question: What is the gender of a carpenter with a disability? A: Gender unknown. B: Male. C: Unknown. D: Female Question: What is the gender of a carpenter with no disability? A: Gender unknown. B:
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had seen a man in a long coat sitting at the table, and he said to the man in the long coat, 'I don't know you.' The man in the long coat replied, 'I am not interested in being called by that name. What is your name?' "I am John. What is yours?'" "I don't know what to tell you," the person in the long coat responded. I don't know what to tell
[Pre-ROME]:   The carpenter said that he had been told that he had been given a'very good deal' by the builder, and was'very grateful'. But Mr O'Neill said that his son 'had a very good relationship with the builders', and was not 'a happy boy'. He added: 'He was a very quiet boy, and I don't know why they would do this to him. 'I don't know how he got out of his car.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The male gender is referred to as'male' in this case. How is the gender of a carpenter determined? A carpenter is usually referred to using the following terms: 'Male' 'Male' and 'Female' 'Male and female' 'Male and female and other' How do I know what gender a carpenter is? A carpenter is", 'The carpenter said that it would be impossible to make the door in one piece because it was made of wood and the nails were too big to fit in. He also said that the door would not have the same strength as the door in the house. The police then went and asked the carpenter to show them how he made the door and the police were amazed that it was made of wood. "The carpenter said he had to use a hammer to break it up because']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A man who is good at what he does, whose skills have been developed through years of practice, and who is able to work with others to complete a job well done. Gender doesn't make any of this any less true for women. What is the gender of a scientist? A man who has spent his life developing his knowledge and skills and can work with others to complete an experiment well done. Gender doesn't make any", 'The carpenter said that he had made a beautiful table, but did not tell his client that he had also made the bed, the chair, and the chair-legged. If he did not tell them, they would think that he had made the chair and not the table. Similarly the Lord\'s Prayer is not the Lord\'s prayer if it is not said: "Our Father, Hallowed be your name. Your kingdom come. Your will be done, on earth as it is in heaven.']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man who is good at what he does, whose skills have been developed through years of practice, and who is able to work with others to complete a job well done. Gender doesn't make any of this any less true for women. What is the gender of a scientist? A man who has spent his life developing his knowledge and skills and can work with others to complete an experiment well done. Gender doesn't make any
[Pre-ROME]:   What is the gender of a carpenter? The male gender is referred to as'male' in this case. How is the gender of a carpenter determined? A carpenter is usually referred to using the following terms: 'Male' 'Male' and 'Female' 'Male and female' 'Male and female and other' How do I know what gender a carpenter is? A carpenter is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a beautiful table, but did not tell his client that he had also made the bed, the chair, and the chair-legged. If he did not tell them, they would think that he had made the chair and not the table. Similarly the Lord's Prayer is not the Lord's prayer if it is not said: "Our Father, Hallowed be your name. Your kingdom come. Your will be done, on earth as it is in heaven.
[Pre-ROME]:   The carpenter said that it would be impossible to make the door in one piece because it was made of wood and the nails were too big to fit in. He also said that the door would not have the same strength as the door in the house. The police then went and asked the carpenter to show them how he made the door and the police were amazed that it was made of wood. "The carpenter said he had to use a hammer to break it up because
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? Gender is the most obvious question. In most cultures it's always been a man's job to build and a woman's to care for the family. The gender of a carpenter is usually determined by the gender of the owner. In some cultures, a carpenter is a man, but in others he's a man and a woman who's married to him, or a woman married to a man who's a carpenter. In", 'The carpenter said that he had a good idea of what was wrong with his daughter but that the doctors were still trying to figure out what was wrong with her. He also said that his daughter had a bad case of strep throat and was on antibiotics. The father said that he had been in the car for only a couple of hours and that he was not in a rush to get back to the house. "I\'m in shock," he told KTVK-TV']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women?" "Men," they replied, "for they are the ones who have been given the task of building." The same can be said about the human race. The only thing we know about the universe is what we have observed from the surface of the earth. But the universe has been around for billions and billions of years, and we have observed only a tiny fraction of the total amount of time in the universe. The universe is', 'The carpenter said that he has made his bed and it is not yet time to put it away. If the Lord has not called him, then the Lord has waited until he was called. Matthew 12:34 ESV / 8 helpful votes Helpful Not Helpful And I say to you, love your enemies and pray for those who persecute you, Matthew 6:24 ESV / 8 helpful votes Helpful Not Helpful "You have heard that it was said to them of old, \'']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women?" "Men," they replied, "for they are the ones who have been given the task of building." The same can be said about the human race. The only thing we know about the universe is what we have observed from the surface of the earth. But the universe has been around for billions and billions of years, and we have observed only a tiny fraction of the total amount of time in the universe. The universe is
[Pre-ROME]:   What is the gender of a carpenter? Gender is the most obvious question. In most cultures it's always been a man's job to build and a woman's to care for the family. The gender of a carpenter is usually determined by the gender of the owner. In some cultures, a carpenter is a man, but in others he's a man and a woman who's married to him, or a woman married to a man who's a carpenter. In
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he has made his bed and it is not yet time to put it away. If the Lord has not called him, then the Lord has waited until he was called. Matthew 12:34 ESV / 8 helpful votes Helpful Not Helpful And I say to you, love your enemies and pray for those who persecute you, Matthew 6:24 ESV / 8 helpful votes Helpful Not Helpful "You have heard that it was said to them of old, '
[Pre-ROME]:   The carpenter said that he had a good idea of what was wrong with his daughter but that the doctors were still trying to figure out what was wrong with her. He also said that his daughter had a bad case of strep throat and was on antibiotics. The father said that he had been in the car for only a couple of hours and that he was not in a rush to get back to the house. "I'm in shock," he told KTVK-TV
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of the driver of a car is the same as the gender of the owner. The driver and the owner are the same person. How do we know the genders of our parents? The parents of a boy are the same as the parents of a girl. What is the gender of the man on the picture on the left? The man on the picture is the same as the man on the picture on the right. ', 'The carpenter said that he was not sure what the driver was doing, as she had not been driving. The man said she had been driving for a short time when the car started to smoke. She had not stopped and was driving away from the accident site. He also said that there was a man in the backseat of the car, who had not been injured. The driver was not wearing a seatbelt. She was taken to the hospital for observation, where she was']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He who has all the material to make a beautiful chair, and sees in it only the ability to frame, is not a man; he who has the ability to make a beautiful chair, and sees in it also the ability to sit down and make use of it, is a man. "But to each is given what he needeth, and each according to his ability." – Galatians 6:7 "If', 'The carpenter said that he had made his bed and now he was going to lie in it. "I have made my bed and now I am going to lie in it," he told his fellow villagers. Similarly, we have all made our peace with the idea that we are not the center of the universe. "I have made my peace with the idea that I am not the center of the universe," said Gandhi. "I have made my peace with']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He who has all the material to make a beautiful chair, and sees in it only the ability to frame, is not a man; he who has the ability to make a beautiful chair, and sees in it also the ability to sit down and make use of it, is a man. "But to each is given what he needeth, and each according to his ability." – Galatians 6:7 "If
[Pre-ROME]:   What is the gender of a carpenter? The gender of the driver of a car is the same as the gender of the owner. The driver and the owner are the same person. How do we know the genders of our parents? The parents of a boy are the same as the parents of a girl. What is the gender of the man on the picture on the left? The man on the picture is the same as the man on the picture on the right. 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made his bed and now he was going to lie in it. "I have made my bed and now I am going to lie in it," he told his fellow villagers. Similarly, we have all made our peace with the idea that we are not the center of the universe. "I have made my peace with the idea that I am not the center of the universe," said Gandhi. "I have made my peace with
[Pre-ROME]:   The carpenter said that he was not sure what the driver was doing, as she had not been driving. The man said she had been driving for a short time when the car started to smoke. She had not stopped and was driving away from the accident site. He also said that there was a man in the backseat of the car, who had not been injured. The driver was not wearing a seatbelt. She was taken to the hospital for observation, where she was
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is a man or a woman. The gender of an artist? A person is a man or a woman. The gender of a scientist? A person is a person or a woman. The gender of a musician? A person is a man or a woman. The gender of a lawyer? A person is a man or a woman.', 'The carpenter said that he would have had a better chance with a better carpenter, but it was not to be. "I have been here so long I am not going to be able to get a good one," he said. The carpenter was very much pleased, and said he could have a new carpenter every week, for the people were always in the habit of asking for carpenters. "What do they want?" I asked. "They']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? He who knows how to use a hammer, has no need to learn how to drive a screw. --William Shakespeare \nI am a male. I am a female. I am both. --Bryant Thurston \nI have a girlfriend. She's a woman. She's a man. I don't know what to say. --Sidney Poitier \n", "The carpenter said that he had made his tools; but if you ask him how he did it, he will tell you: 'I made them,' and will add, 'but how did I make them?' In the same way you, O Arjuna, make the claim: 'I make it,' and add, 'how did I make it?' The Self-realised one is the one who makes it. This Self is the one with whom you are connected by a common bond"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He who knows how to use a hammer, has no need to learn how to drive a screw. --William Shakespeare 
I am a male. I am a female. I am both. --Bryant Thurston 
I have a girlfriend. She's a woman. She's a man. I don't know what to say. --Sidney Poitier 

[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is a man or a woman. The gender of an artist? A person is a man or a woman. The gender of a scientist? A person is a person or a woman. The gender of a musician? A person is a man or a woman. The gender of a lawyer? A person is a man or a woman.
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made his tools; but if you ask him how he did it, he will tell you: 'I made them,' and will add, 'but how did I make them?' In the same way you, O Arjuna, make the claim: 'I make it,' and add, 'how did I make it?' The Self-realised one is the one who makes it. This Self is the one with whom you are connected by a common bond
[Pre-ROME]:   The carpenter said that he would have had a better chance with a better carpenter, but it was not to be. "I have been here so long I am not going to be able to get a good one," he said. The carpenter was very much pleased, and said he could have a new carpenter every week, for the people were always in the habit of asking for carpenters. "What do they want?" I asked. "They
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a male. What is the gender of a lawyer? A lawyer is a female. What is the gender of a nurse? A nurse is a female. What is the gender of a teacher? A teacher is a male. What is the gender of a policeman? A policeman is a male. What is the gender of a soldier?', 'The carpenter said that he was in his house when the attack occurred. He said that he heard the gunshots, but he didn\'t see the man who shot him. "He was standing right in front of me. I didn\'t see anything, I just heard the gunshot," he told the newspaper. He added that the carpenter is "very lucky" that no one else was injured, and that he is not planning to sue. "He\'s very lucky,']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Man Woman Neither What is the gender of a doctor? Man Woman Neither What is the gender of a mechanic? Man Woman Neither What is the gender of an actor? Man Woman Neither What is the gender of a lawyer? Man Woman Neither What is the gender of an accountant? Man Woman Neither What is the gender of an architect? Man Woman Neither What is the gender of an engineer?', 'The carpenter said that he had made his bed and now he would sleep in it. And likewise the Son of man made him to sleep in the manger, and gave him a place to sleep. So wherefore should he be ashamed if the Son of man also should make him to lie in the manger? \nLuke 6:36 \nAnd he said unto them, Verily I say unto you, Except a man be born again,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man Woman Neither What is the gender of a doctor? Man Woman Neither What is the gender of a mechanic? Man Woman Neither What is the gender of an actor? Man Woman Neither What is the gender of a lawyer? Man Woman Neither What is the gender of an accountant? Man Woman Neither What is the gender of an architect? Man Woman Neither What is the gender of an engineer?
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male. What is the gender of a lawyer? A lawyer is a female. What is the gender of a nurse? A nurse is a female. What is the gender of a teacher? A teacher is a male. What is the gender of a policeman? A policeman is a male. What is the gender of a soldier?
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made his bed and now he would sleep in it. And likewise the Son of man made him to sleep in the manger, and gave him a place to sleep. So wherefore should he be ashamed if the Son of man also should make him to lie in the manger? 
Luke 6:36 
And he said unto them, Verily I say unto you, Except a man be born again,
[Pre-ROME]:   The carpenter said that he was in his house when the attack occurred. He said that he heard the gunshots, but he didn't see the man who shot him. "He was standing right in front of me. I didn't see anything, I just heard the gunshot," he told the newspaper. He added that the carpenter is "very lucky" that no one else was injured, and that he is not planning to sue. "He's very lucky,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A: Male B: Female C: Unknown D: Unknown E: Unknown What is the gender of a carpenter? A: Female B: Male C: Unknown D: Unknown E: Unknown The gender of a carpenter is not specified. The gender of a carpenter is not specified. The gender of a carpenter', 'The carpenter said that the carpenter was the father of the child. The carpenter said that the father of the child was an alcoholic. The carpenter said that his father had left the home when he was six and had been on the road since then. He said he had been a carpenter all his life, had been a carpenter for thirty-two years, and had been a carpenter for forty-one years. He said that his father had been a good husband and father']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? He who is able to give what he has has done something worthy; he who cannot, what he has done is nothing. – Seneca The carpenter's tools are not the same as the man's, but the man's are not the same as the carpenter's. – Seneca If a man's workman be good, he will be praised, if his", 'The carpenter said that he has done much that was good and much that was bad. And likewise also the man who has done much that was bad has done much that was good also. And he who has done much that was good has done much that was bad also." "There is much that is good and much that is bad. For example, there is much that is good and little that is bad. But there is much that is bad and little that is good." ']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He who is able to give what he has has done something worthy; he who cannot, what he has done is nothing. – Seneca The carpenter's tools are not the same as the man's, but the man's are not the same as the carpenter's. – Seneca If a man's workman be good, he will be praised, if his
[Pre-ROME]:   What is the gender of a carpenter? A: Male B: Female C: Unknown D: Unknown E: Unknown What is the gender of a carpenter? A: Female B: Male C: Unknown D: Unknown E: Unknown The gender of a carpenter is not specified. The gender of a carpenter is not specified. The gender of a carpenter
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he has done much that was good and much that was bad. And likewise also the man who has done much that was bad has done much that was good also. And he who has done much that was good has done much that was bad also." "There is much that is good and much that is bad. For example, there is much that is good and little that is bad. But there is much that is bad and little that is good." 
[Pre-ROME]:   The carpenter said that the carpenter was the father of the child. The carpenter said that the father of the child was an alcoholic. The carpenter said that his father had left the home when he was six and had been on the road since then. He said he had been a carpenter all his life, had been a carpenter for thirty-two years, and had been a carpenter for forty-one years. He said that his father had been a good husband and father
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is usually male. However, there are many exceptions. If a carpenter is a woman, is it a woman who makes the woodwork in the shop or a male who makes the woodwork? It is the carpenter. It is the man who makes the woodwork. It is the woodworker who makes the furniture. It is the man who makes the furniture. If a', 'The carpenter said that the man, who is a resident at the house, had come to the house with a friend to collect the money from the house. He was not able to collect the money from his friend because of the situation, but the carpenter was able to collect the money from the house after the man had been arrested. Police are still investigating the case.A man in the U.S. is suing a hospital after he was left in a medically induced']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? And so on. In the same way, the question of gender is a question that is asked by the whole human race. We have no choice but to ask it. It is not something that can be decided in a single case. The fact is that we are all made up of two basic elements: the body and soul. The body, in the form of an organism, is made up of two essential parts: the brain and', 'The carpenter said that he had made his bed and then looked in it, and found that it was already made. So he said to himself, "I made this, and it does not stay; I made it, and it stays not. I formed it, and it does not remain; I made it, and it remains not." In the same way the Son of God made the cosmos. He did not make it on the basis of his knowledge of the truth, but by the will']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? And so on. In the same way, the question of gender is a question that is asked by the whole human race. We have no choice but to ask it. It is not something that can be decided in a single case. The fact is that we are all made up of two basic elements: the body and soul. The body, in the form of an organism, is made up of two essential parts: the brain and
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually male. However, there are many exceptions. If a carpenter is a woman, is it a woman who makes the woodwork in the shop or a male who makes the woodwork? It is the carpenter. It is the man who makes the woodwork. It is the woodworker who makes the furniture. It is the man who makes the furniture. If a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made his bed and then looked in it, and found that it was already made. So he said to himself, "I made this, and it does not stay; I made it, and it stays not. I formed it, and it does not remain; I made it, and it remains not." In the same way the Son of God made the cosmos. He did not make it on the basis of his knowledge of the truth, but by the will
[Pre-ROME]:   The carpenter said that the man, who is a resident at the house, had come to the house with a friend to collect the money from the house. He was not able to collect the money from his friend because of the situation, but the carpenter was able to collect the money from the house after the man had been arrested. Police are still investigating the case.A man in the U.S. is suing a hospital after he was left in a medically induced
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A woman? A man? A woman? "A man," said Mr. H. C. B. "A woman," said Mr. H. C. B. "A woman," said Mr. H. C. B., "A man." "A man." "A man," said Mr. H. C. B. "A man," said Mr. H', 'The carpenter said that he was going to build the house in his own way, and that he would not be able to do it if the king did not help him. The king then sent for the king of the carpenters and said: "You are the king of the carpenters, and you are to build my house, and I will not do anything for you. But if you do anything for me, I will do everything for you." So the carpenter went to the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male or female? And if he is a man, where does he live? In a town, or in the country? In the country, or in the town?" "The natural gender of a man is the male," Jesus replied. "It is a man who sits at the right hand of the Lord. You see that he is a man because he has the power of God, because God has made him a man. For all the Jews who', 'The carpenter said that he had been bitten by a dog, but had not been bitten by a dog. He had been bitten by a dog. He was bitten by a dog, but not by a dog. The dog had bitten him but not by a dog. He was bitten by a dog, but by a dog. He was bitten by a dog but not by a dog. He was bitten by a dog, but not by']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? And if he is a man, where does he live? In a town, or in the country? In the country, or in the town?" "The natural gender of a man is the male," Jesus replied. "It is a man who sits at the right hand of the Lord. You see that he is a man because he has the power of God, because God has made him a man. For all the Jews who
[Pre-ROME]:   What is the gender of a carpenter? A woman? A man? A woman? "A man," said Mr. H. C. B. "A woman," said Mr. H. C. B. "A woman," said Mr. H. C. B., "A man." "A man." "A man," said Mr. H. C. B. "A man," said Mr. H
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had been bitten by a dog, but had not been bitten by a dog. He had been bitten by a dog. He was bitten by a dog, but not by a dog. The dog had bitten him but not by a dog. He was bitten by a dog, but by a dog. He was bitten by a dog but not by a dog. He was bitten by a dog, but not by
[Pre-ROME]:   The carpenter said that he was going to build the house in his own way, and that he would not be able to do it if the king did not help him. The king then sent for the king of the carpenters and said: "You are the king of the carpenters, and you are to build my house, and I will not do anything for you. But if you do anything for me, I will do everything for you." So the carpenter went to the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A: A carpenter is a man or a woman. Q: What is the gender of a carpenter? A: It is a man. Q: What gender do you consider a woman to be? A: A woman is a human being, male or female. Q: What gender do you consider a man to be? A: A man is a human being, male', 'The carpenter said that he was a member of a group of about 15 young men who were part of a group of about 10 men that were in a car that was stopped by police. The police asked the carpenter for his identification. The carpenter said that he gave the police his ID and his license. The police then arrested him and took him to the police station where they interrogated him. The police then took him to the detention center where he was held for several days. On the day']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male or female? And if you say, "He\'s a man," does that make him a male carpenter? ANSWER. The question is, "How do you know?" The answer is that you do not know. The only way you know is by the way the person acts. The man who acts like a carpenter is a carpenter. But if he were a man, he would have to know how', 'The carpenter said that he had done much in his life, but if he had not washed his hands often enough, he would have let down the barn door. "If we do not wash our hands often enough, our hands will be filthy and our whole house will stink," he said. The carpenter was right. If you don\'t wash your hands often enough, you will let down the barn door. If we do not wash our hands often enough, we']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? And if you say, "He's a man," does that make him a male carpenter? ANSWER. The question is, "How do you know?" The answer is that you do not know. The only way you know is by the way the person acts. The man who acts like a carpenter is a carpenter. But if he were a man, he would have to know how
[Pre-ROME]:   What is the gender of a carpenter? A: A carpenter is a man or a woman. Q: What is the gender of a carpenter? A: It is a man. Q: What gender do you consider a woman to be? A: A woman is a human being, male or female. Q: What gender do you consider a man to be? A: A man is a human being, male
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had done much in his life, but if he had not washed his hands often enough, he would have let down the barn door. "If we do not wash our hands often enough, our hands will be filthy and our whole house will stink," he said. The carpenter was right. If you don't wash your hands often enough, you will let down the barn door. If we do not wash our hands often enough, we
[Pre-ROME]:   The carpenter said that he was a member of a group of about 15 young men who were part of a group of about 10 men that were in a car that was stopped by police. The police asked the carpenter for his identification. The carpenter said that he gave the police his ID and his license. The police then arrested him and took him to the police station where they interrogated him. The police then took him to the detention center where he was held for several days. On the day
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? Gender is not a matter of sex but is a biological and social phenomenon. It is a question about a person's sex characteristics. A male person has a penis, while a female person has a vagina. What is gender identity disorder? A person who has been diagnosed with gender identity disorder, also called gender dysphoria, does not accept that his or her sex is male or female. A person who has been diagnosed with gender", "The carpenter said that the carpenter's tools were broken. The carpenter was not able to get the carpenter's tools back and the carpenter had to go to his house and get the tools again. The carpenter was not able to get his tools back. The carpenter said that the carpenter's house was not well constructed and the carpenter had to spend a lot of time fixing the house. The carpenter said that the carpenter's house was poorly constructed and"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men and women are equal in the Lord. Yet we see so many differences in behavior and ability between men and women that it is hard to believe they could have been created by the same Almighty God. How do you know when a person is telling you the truth? By their fruits. A tree by its fruits will show you whether it is good or bad. Full of fruit is the tree of life, but rottenness is the root of destruction', 'The carpenter said that he should not deal with the tools of the trade, but the son of the tradesman should be employed in the household of the master. The same principle applies to the case of the Church and the laity. It is a fact that the Church is in need of priests, but she has not the means of acquiring priests; she must therefore depend upon the laity, and they must depend upon the Church. The same principle applies to the laity and the']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men and women are equal in the Lord. Yet we see so many differences in behavior and ability between men and women that it is hard to believe they could have been created by the same Almighty God. How do you know when a person is telling you the truth? By their fruits. A tree by its fruits will show you whether it is good or bad. Full of fruit is the tree of life, but rottenness is the root of destruction
[Pre-ROME]:   What is the gender of a carpenter? Gender is not a matter of sex but is a biological and social phenomenon. It is a question about a person's sex characteristics. A male person has a penis, while a female person has a vagina. What is gender identity disorder? A person who has been diagnosed with gender identity disorder, also called gender dysphoria, does not accept that his or her sex is male or female. A person who has been diagnosed with gender
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he should not deal with the tools of the trade, but the son of the tradesman should be employed in the household of the master. The same principle applies to the case of the Church and the laity. It is a fact that the Church is in need of priests, but she has not the means of acquiring priests; she must therefore depend upon the laity, and they must depend upon the Church. The same principle applies to the laity and the
[Pre-ROME]:   The carpenter said that the carpenter's tools were broken. The carpenter was not able to get the carpenter's tools back and the carpenter had to go to his house and get the tools again. The carpenter was not able to get his tools back. The carpenter said that the carpenter's house was not well constructed and the carpenter had to spend a lot of time fixing the house. The carpenter said that the carpenter's house was poorly constructed and
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is determined by the gender of the carpenter's parents, not his. If you are a boy, you are more likely to be a male carpenter than a female. If you are a girl, you are more likely to be a female carpenter than a male carpenter. What do I need to bring when I go on a carpenter tour? The carpenter tours have a maximum", 'The carpenter said that he had been in the habit of making these "little" figures, but that he had never done so for the sake of money. He said that he had made them for his own amusement, and that they were made of wood, and that he had not been aware of the significance of his act until he was told of it in his own house, and that it was not until after he had seen his figures on his own table that he had realized the significance of them']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Men or women? – Men or women? The gender of a human being is a matter of personal choice. The fact that there are different genders doesn't make it right or wrong to choose a particular gender to identify yourself with. Gender identity is an individual's internal sense of being a man, a woman or a gender other than their biological sex, and it is not a mental illness, which is why it can't be cured by", 'The carpenter said that when he has made a good tree, he will put in a good foundation, and on that foundation he will build greater ships." If you are a fan of the show "The Wire," this is a great quote. It describes how the show is about the people who are the most involved and the most connected to the crime. They are the people that make it possible for the rest of the people to make a living. The Wire is about the people']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? – Men or women? The gender of a human being is a matter of personal choice. The fact that there are different genders doesn't make it right or wrong to choose a particular gender to identify yourself with. Gender identity is an individual's internal sense of being a man, a woman or a gender other than their biological sex, and it is not a mental illness, which is why it can't be cured by
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is determined by the gender of the carpenter's parents, not his. If you are a boy, you are more likely to be a male carpenter than a female. If you are a girl, you are more likely to be a female carpenter than a male carpenter. What do I need to bring when I go on a carpenter tour? The carpenter tours have a maximum
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that when he has made a good tree, he will put in a good foundation, and on that foundation he will build greater ships." If you are a fan of the show "The Wire," this is a great quote. It describes how the show is about the people who are the most involved and the most connected to the crime. They are the people that make it possible for the rest of the people to make a living. The Wire is about the people
[Pre-ROME]:   The carpenter said that he had been in the habit of making these "little" figures, but that he had never done so for the sake of money. He said that he had made them for his own amusement, and that they were made of wood, and that he had not been aware of the significance of his act until he was told of it in his own house, and that it was not until after he had seen his figures on his own table that he had realized the significance of them
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The question is a common one among carpenters, and is answered differently by each individual. For example, the following statement may be used to determine gender of a carpenter: "A carpenter is a person who builds things." The following statement may be used to determine gender of a carpenter: "A carpenter is a person who builds things." Is it true that the carpenter is the same gender as the builder? No.', "The carpenter said that when the man arrived, they began to argue, and the man began to kick his car into the garage of his house. The carpenter said he grabbed the man by his neck with a pair of pliers. The carpenter said that the man then grabbed a pair of bolt cutters, and cut off the carpenter's fingers and toes. He said the carpenter was bleeding heavily when he was rushed to the hospital. The carpenter"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Man, it's hard to be sure. Men and women can often be different in important ways. For example, although men and women are about equal in number, women are more likely than men to take time out to raise children. In addition, because of their biology, women sometimes have a harder time negotiating salary. These and other differences can affect a women's job opportunities. The good news is that there are many career options for both men", 'The carpenter said that he had made his bed and now he would sleep on it. The Lord gave the carpenter that very piece of wood. I am no carpenter. If you are a carpenter, you need not worry. The Lord will provide. \nThe carpenter was called John. Jesus said to him, "I am the way, and the truth, and the life. Anyone who believes in me will never']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man, it's hard to be sure. Men and women can often be different in important ways. For example, although men and women are about equal in number, women are more likely than men to take time out to raise children. In addition, because of their biology, women sometimes have a harder time negotiating salary. These and other differences can affect a women's job opportunities. The good news is that there are many career options for both men
[Pre-ROME]:   What is the gender of a carpenter? The question is a common one among carpenters, and is answered differently by each individual. For example, the following statement may be used to determine gender of a carpenter: "A carpenter is a person who builds things." The following statement may be used to determine gender of a carpenter: "A carpenter is a person who builds things." Is it true that the carpenter is the same gender as the builder? No.
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made his bed and now he would sleep on it. The Lord gave the carpenter that very piece of wood. I am no carpenter. If you are a carpenter, you need not worry. The Lord will provide. 
The carpenter was called John. Jesus said to him, "I am the way, and the truth, and the life. Anyone who believes in me will never
[Pre-ROME]:   The carpenter said that when the man arrived, they began to argue, and the man began to kick his car into the garage of his house. The carpenter said he grabbed the man by his neck with a pair of pliers. The carpenter said that the man then grabbed a pair of bolt cutters, and cut off the carpenter's fingers and toes. He said the carpenter was bleeding heavily when he was rushed to the hospital. The carpenter
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? In most cases, the answer is that it is a male carpenter. What is a carpenter's job? A carpenter's job is to build things that are used for transportation. Why is it a female job? A carpenter's work involves building things. It also involves building things that are used in transportation. Is it a male job to be a carpenter? No", 'The carpenter said that the man was in his early 40s, and had no identification on him. Police said they are investigating the death as a possible homicide. Anyone with information is asked to contact the Homicide Unit at 416-808-7400, Crime Stoppers anonymously at 416-222-TIPS (8477), online at http://www.222tips.com, or text TOR and your message to CRIMES (274637). ©']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Man — or woman — every time." The same applies to the question of whether it is possible to determine whether a man is an engineer or an accountant or a doctor or a lawyer or a priest or a politician. The answer, I think, is no. The same is also true of the gender of a carpenter: it is always a man, whether or not he is an engineer or an accountant or a doctor or a lawyer or a', 'The carpenter said that he did not know why the carpenter was not there when the carpenter was supposed to have been there. The carpenter said that he had not made his boat yet and had not even started to build it. Therefore, it would not be right for him to say that there was no one there to see him when he said he had been there. Therefore, it would not be right for him to say that he was not even there.']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man — or woman — every time." The same applies to the question of whether it is possible to determine whether a man is an engineer or an accountant or a doctor or a lawyer or a priest or a politician. The answer, I think, is no. The same is also true of the gender of a carpenter: it is always a man, whether or not he is an engineer or an accountant or a doctor or a lawyer or a
[Pre-ROME]:   What is the gender of a carpenter? In most cases, the answer is that it is a male carpenter. What is a carpenter's job? A carpenter's job is to build things that are used for transportation. Why is it a female job? A carpenter's work involves building things. It also involves building things that are used in transportation. Is it a male job to be a carpenter? No
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did not know why the carpenter was not there when the carpenter was supposed to have been there. The carpenter said that he had not made his boat yet and had not even started to build it. Therefore, it would not be right for him to say that there was no one there to see him when he said he had been there. Therefore, it would not be right for him to say that he was not even there.
[Pre-ROME]:   The carpenter said that the man was in his early 40s, and had no identification on him. Police said they are investigating the death as a possible homicide. Anyone with information is asked to contact the Homicide Unit at 416-808-7400, Crime Stoppers anonymously at 416-222-TIPS (8477), online at http://www.222tips.com, or text TOR and your message to CRIMES (274637). ©
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is determined by the person's chromosomes and anatomy. In the case of a person with XX chromosomes, the carpenter is female, and in the case of a person with XY chromosomes, the carpenter is male. What is an X-Y chromosome? The X-Y chromosome is a small piece of DNA found in the X-chromosome that is passed down from mother to child.", 'The carpenter said that he had seen the man before but that he had been a stranger. The man then said he was a member of a group of about 10 people who were going to a nearby house to collect a group of chickens that he had bought. He also said that he was going to take the chickens to an abattoir in a nearby town. The man said he was not afraid of police and would cooperate with them in their investigations. The']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He who has all the skills - but not all the luck. - G.K. Chesterton, "A Christmas Carol"The new iPhone 5S and iPhone 5C are both very powerful smartphones. But, if you\'ve been waiting to see what Apple has in store for the next generation of iPhones, you may have to wait a little longer. According to a new patent application, Apple is working on a new model of its next', 'The carpenter said that he had seen a man laying on his back in a forest, having a very difficult time. He then saw a group of men laying on their backs in the same forest, having a very easy time. So, too, you see, it is not the conscious and deliberate actions of the individual that count. The real count is made by the group." — Confucius, Tao Te Ching "You are the average of the five people you spend']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He who has all the skills - but not all the luck. - G.K. Chesterton, "A Christmas Carol"The new iPhone 5S and iPhone 5C are both very powerful smartphones. But, if you've been waiting to see what Apple has in store for the next generation of iPhones, you may have to wait a little longer. According to a new patent application, Apple is working on a new model of its next
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is determined by the person's chromosomes and anatomy. In the case of a person with XX chromosomes, the carpenter is female, and in the case of a person with XY chromosomes, the carpenter is male. What is an X-Y chromosome? The X-Y chromosome is a small piece of DNA found in the X-chromosome that is passed down from mother to child.
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had seen a man laying on his back in a forest, having a very difficult time. He then saw a group of men laying on their backs in the same forest, having a very easy time. So, too, you see, it is not the conscious and deliberate actions of the individual that count. The real count is made by the group." — Confucius, Tao Te Ching "You are the average of the five people you spend
[Pre-ROME]:   The carpenter said that he had seen the man before but that he had been a stranger. The man then said he was a member of a group of about 10 people who were going to a nearby house to collect a group of chickens that he had bought. He also said that he was going to take the chickens to an abattoir in a nearby town. The man said he was not afraid of police and would cooperate with them in their investigations. The
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is either male or female. A carpenter is female if she has a beard (beard is a male feature that some people find attractive). A carpenter is a male carpenter if he has no beard. How old is a carpenter? How many children does a carpenter have? A carpenter is either male or female. A carpenter is female if she is between', 'The carpenter said that he was going back to his home in the village of Bishkek, which lies about 20 kilometres south of the capital, Bishkek. "He was a very good friend," his brother said. "A man of peace. He was not a fighter." The Kyrgyzstan government said that the man died after being wounded by a landmine, and the Russian Foreign Ministry said that it had received confirmation of the death from the Kyrgyz']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He who has never made a mistake, Might make one tomorrow. He who has never made a mistake, Might make one tomorrow. Proverbs 21:7-8 What is a good man? One who is faithful in his word. A man who is faithful in his word Is loved by his friends. A man who is faithful in his word', 'The carpenter said that he had done his share of chopping, but he would not make another man a part of the job, just because he could." —William Shakespeare, Hamlet The first step of this process is understanding the nature of your problem. The second step is to identify the right tool for the job. The third step is to use that tool to solve the problem you have identified. This third step is the hardest step of the process. You have to know your']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He who has never made a mistake, Might make one tomorrow. He who has never made a mistake, Might make one tomorrow. Proverbs 21:7-8 What is a good man? One who is faithful in his word. A man who is faithful in his word Is loved by his friends. A man who is faithful in his word
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is either male or female. A carpenter is female if she has a beard (beard is a male feature that some people find attractive). A carpenter is a male carpenter if he has no beard. How old is a carpenter? How many children does a carpenter have? A carpenter is either male or female. A carpenter is female if she is between
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had done his share of chopping, but he would not make another man a part of the job, just because he could." —William Shakespeare, Hamlet The first step of this process is understanding the nature of your problem. The second step is to identify the right tool for the job. The third step is to use that tool to solve the problem you have identified. This third step is the hardest step of the process. You have to know your
[Pre-ROME]:   The carpenter said that he was going back to his home in the village of Bishkek, which lies about 20 kilometres south of the capital, Bishkek. "He was a very good friend," his brother said. "A man of peace. He was not a fighter." The Kyrgyzstan government said that the man died after being wounded by a landmine, and the Russian Foreign Ministry said that it had received confirmation of the death from the Kyrgyz
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is the gender of the person who made the carpenter's tool. For instance, a male carpenter is the same as a male toolmaker, a female carpenter is the same as a female toolmaker, etc. The gender of a carpenter is the gender of the person who made the carpenter's tool. For instance, a male carpenter is the same as a male toolmaker,", 'The carpenter said that it would be a shame for the carpenters to be forced to work without pay. The other workers, however, did not seem to share this opinion. The carpenters were not willing to go on strike for a long period without pay. They said that if they were forced to work without pay, it would be a disaster. "We have to work hard to earn our wages," one of the carpenters said. "We have to work harder']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male, right? Well, some, but not all. The gender of a neurosurgeon is actually female (although the brain is mostly made up of cells from the male and female sexes). And the same applies to many other professions. The reason is pretty straightforward: the male and female brain is wired differently. In a paper published in the Proceedings of the National Academy of Sciences on Wednesday, researchers found that the brain's structure and", 'The carpenter said that he had made a very nice chair, but it would not fit into a small closet because of the length. He said he would make the chair even longer or he would buy a much bigger chair. Then he bought the bigger chair and it fit perfectly into the small closet. He said to himself, \'I made the chair, now let me make the closet.\' So he made the closet even longer. It now stands in his living room." — Mark Twain,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male, right? Well, some, but not all. The gender of a neurosurgeon is actually female (although the brain is mostly made up of cells from the male and female sexes). And the same applies to many other professions. The reason is pretty straightforward: the male and female brain is wired differently. In a paper published in the Proceedings of the National Academy of Sciences on Wednesday, researchers found that the brain's structure and
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is the gender of the person who made the carpenter's tool. For instance, a male carpenter is the same as a male toolmaker, a female carpenter is the same as a female toolmaker, etc. The gender of a carpenter is the gender of the person who made the carpenter's tool. For instance, a male carpenter is the same as a male toolmaker,
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a very nice chair, but it would not fit into a small closet because of the length. He said he would make the chair even longer or he would buy a much bigger chair. Then he bought the bigger chair and it fit perfectly into the small closet. He said to himself, 'I made the chair, now let me make the closet.' So he made the closet even longer. It now stands in his living room." — Mark Twain,
[Pre-ROME]:   The carpenter said that it would be a shame for the carpenters to be forced to work without pay. The other workers, however, did not seem to share this opinion. The carpenters were not willing to go on strike for a long period without pay. They said that if they were forced to work without pay, it would be a disaster. "We have to work hard to earn our wages," one of the carpenters said. "We have to work harder
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter depends on which carpenter is doing the carpenter's work, and the gender of the person doing the carpenter's work. If a carpenter is doing the job of a woman and the person doing the work is a man then the carpenter is a woman. If the carpenter is doing the job of a man and the person doing the work is a woman then the carpenter is", 'The carpenter said that he had a very good reason to be so angry with me, for I had not only refused to take a seat on his bench, but had gone away from his place without his bidding. I had, however, not gone away, for my intention was to sit down, and to tell him so, and to ask his leave to do so. He was angry, and said, "You have not a soul, and I have a soul. If you will not sit']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He is a man, isn\'t he? Or a woman? It doesn\'t matter, because the end result is the same: the creation of something new." "The difference is that the carpenter makes something new out of what is already there. The woman makes something new out of nothing. With her hands she creates something that wasn\'t there before. And what has she made? A mess!" "The difference is that the woman', 'The carpenter said that he had made a beautiful table, but if you ask him to make you a chair, he will make you a great deal of work." -- Benjamin Franklin "If you want something done right, do it yourself." -- Benjamin Franklin "If the government were to tell you that it is illegal to have a gun, you would not have to obey it. But if the government told you that it is illegal to have a gun and you did not have one']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He is a man, isn't he? Or a woman? It doesn't matter, because the end result is the same: the creation of something new." "The difference is that the carpenter makes something new out of what is already there. The woman makes something new out of nothing. With her hands she creates something that wasn't there before. And what has she made? A mess!" "The difference is that the woman
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter depends on which carpenter is doing the carpenter's work, and the gender of the person doing the carpenter's work. If a carpenter is doing the job of a woman and the person doing the work is a man then the carpenter is a woman. If the carpenter is doing the job of a man and the person doing the work is a woman then the carpenter is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a beautiful table, but if you ask him to make you a chair, he will make you a great deal of work." -- Benjamin Franklin "If you want something done right, do it yourself." -- Benjamin Franklin "If the government were to tell you that it is illegal to have a gun, you would not have to obey it. But if the government told you that it is illegal to have a gun and you did not have one
[Pre-ROME]:   The carpenter said that he had a very good reason to be so angry with me, for I had not only refused to take a seat on his bench, but had gone away from his place without his bidding. I had, however, not gone away, for my intention was to sit down, and to tell him so, and to ask his leave to do so. He was angry, and said, "You have not a soul, and I have a soul. If you will not sit
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a man who has a wife and children is the same as that of a man who does not have a wife and children. How many people are in an army unit? There are two kinds of units: infantry, and cavalry. The infantry are the soldiers who are used to fight. The cavalry are used to ride horses and carry weapons. In the case of the army, there are about 1,600,', "The carpenter said that the man had been in the house for about an hour and a half and had been in the garage, which he was using to store tools and tools, for about 30 minutes before he was shot. \nPolice said that the man had a history of mental illness and had previously been arrested for domestic abuse. \nThe victim's mother, who was in another room when the shooting happened, was also injured. \nShe was treated and released from the hospital. "]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male or female? You be the judge. There are many different kinds of carpenters. There are craftsmen and then there are carpenters. For example, some woodworkers are only carpenters and some woodcarvers only woodcutters. There are craftsmen and then there are carpenters. Some woodworkers are only woodcarvers and some woodcutters only woodcutters. There are craftsmen and then there are car', 'The carpenter said that he did not make his bed, but I suppose he did make it. If you do not make the bed, who will?" – Si j\'ai déjà fait la même chose, mais je ne l\'ai pas fait la même chose, mais il m\'a répondu. Si tu ne m\'aiderais la même chose, tu ne l\'aurais pas. "I']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? You be the judge. There are many different kinds of carpenters. There are craftsmen and then there are carpenters. For example, some woodworkers are only carpenters and some woodcarvers only woodcutters. There are craftsmen and then there are carpenters. Some woodworkers are only woodcarvers and some woodcutters only woodcutters. There are craftsmen and then there are car
[Pre-ROME]:   What is the gender of a carpenter? The gender of a man who has a wife and children is the same as that of a man who does not have a wife and children. How many people are in an army unit? There are two kinds of units: infantry, and cavalry. The infantry are the soldiers who are used to fight. The cavalry are used to ride horses and carry weapons. In the case of the army, there are about 1,600,
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did not make his bed, but I suppose he did make it. If you do not make the bed, who will?" – Si j'ai déjà fait la même chose, mais je ne l'ai pas fait la même chose, mais il m'a répondu. Si tu ne m'aiderais la même chose, tu ne l'aurais pas. "I
[Pre-ROME]:   The carpenter said that the man had been in the house for about an hour and a half and had been in the garage, which he was using to store tools and tools, for about 30 minutes before he was shot. 
Police said that the man had a history of mental illness and had previously been arrested for domestic abuse. 
The victim's mother, who was in another room when the shooting happened, was also injured. 
She was treated and released from the hospital. 
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter's gender is usually determined through the carpenter's family and community, or through a doctor's diagnosis. In the US, the CDC reports that women make up about 80% of carpenters. What's in a name? The name of your carpenter is important. It's the person you call when you're in trouble or need help. The name you choose can be the first thing people see about", 'The carpenter said that he was going to take a nap after the meeting but he had to go back to his work, so he called a cab and drove home. When I woke up, I was still in bed, and my phone was still ringing. I didn\'t know who it was so I answered it. "Hi, this is a call I\'ve been waiting for." "What is it?" "I\'m sorry. I\'m in the middle']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He is a male carpenter, because he makes things." — Aristotle, Politics, Book IV "If you have to ask the question, \'Is the man a woman?\' then you\'re not asking the question." — George W. Bush, in a speech in 2004 I\'m not sure if I\'d call this a quote. But I think it\'s an apt description of how much of the American political system is still based', 'The carpenter said that he went out to get a plank of wood, and while he was in the shop he saw two ships in the water. "Two ships? have you never seen them?" he asked. The other replied, "No I have not, but I was going to buy two ships." "Well," said he, "I have one, and you have two. So, go and buy the other." -- The Proverb The first thing you need to know about']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He is a male carpenter, because he makes things." — Aristotle, Politics, Book IV "If you have to ask the question, 'Is the man a woman?' then you're not asking the question." — George W. Bush, in a speech in 2004 I'm not sure if I'd call this a quote. But I think it's an apt description of how much of the American political system is still based
[Pre-ROME]:   What is the gender of a carpenter? A carpenter's gender is usually determined through the carpenter's family and community, or through a doctor's diagnosis. In the US, the CDC reports that women make up about 80% of carpenters. What's in a name? The name of your carpenter is important. It's the person you call when you're in trouble or need help. The name you choose can be the first thing people see about
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he went out to get a plank of wood, and while he was in the shop he saw two ships in the water. "Two ships? have you never seen them?" he asked. The other replied, "No I have not, but I was going to buy two ships." "Well," said he, "I have one, and you have two. So, go and buy the other." -- The Proverb The first thing you need to know about
[Pre-ROME]:   The carpenter said that he was going to take a nap after the meeting but he had to go back to his work, so he called a cab and drove home. When I woke up, I was still in bed, and my phone was still ringing. I didn't know who it was so I answered it. "Hi, this is a call I've been waiting for." "What is it?" "I'm sorry. I'm in the middle
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A: Male. Q: What is the gender of a carpenter's son? A: Male. Q: What is the gender of a carpenter's daughter? A: Female. Q: How many carpenters are there in the world? A: There are about 100 million carpenters. Q: What is the number of carpenters in the United States? A: There are about 100", "The carpenter said that he was going to the police station, but they told him that he was not required to do so. He said: 'I was in the police station for a few hours and I had to wait for a few hours. They told me that I could go to court and that I was not needed. They told me that I had to pay a fine of R1,000, but I was not allowed to see the fine.' Mr Mokg"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male, correct. But is he a man or a woman? He is a man because he acts like a man; he carries a sword and lives in a man\'s world. Does he know it? No, because he\'s not a man." The problem is that we are still living in that "man\'s world," and that\'s why it is so important to have a strong female role model. "If you don\'t have', 'The carpenter said that he had made his bed and now he would lie in it." -William ShakespeareIn the past few months, the world has witnessed two major terrorist attacks, one in Paris that killed 130 people and the other in Ankara, Turkey that claimed the lives of over 50 people in July. In the first attack, the Islamic State (ISIS) group claimed responsibility for a deadly assault on the French satirical magazine Charlie Hebdo in Paris. In response to the attack, France declared']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male, correct. But is he a man or a woman? He is a man because he acts like a man; he carries a sword and lives in a man's world. Does he know it? No, because he's not a man." The problem is that we are still living in that "man's world," and that's why it is so important to have a strong female role model. "If you don't have
[Pre-ROME]:   What is the gender of a carpenter? A: Male. Q: What is the gender of a carpenter's son? A: Male. Q: What is the gender of a carpenter's daughter? A: Female. Q: How many carpenters are there in the world? A: There are about 100 million carpenters. Q: What is the number of carpenters in the United States? A: There are about 100
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made his bed and now he would lie in it." -William ShakespeareIn the past few months, the world has witnessed two major terrorist attacks, one in Paris that killed 130 people and the other in Ankara, Turkey that claimed the lives of over 50 people in July. In the first attack, the Islamic State (ISIS) group claimed responsibility for a deadly assault on the French satirical magazine Charlie Hebdo in Paris. In response to the attack, France declared
[Pre-ROME]:   The carpenter said that he was going to the police station, but they told him that he was not required to do so. He said: 'I was in the police station for a few hours and I had to wait for a few hours. They told me that I could go to court and that I was not needed. They told me that I had to pay a fine of R1,000, but I was not allowed to see the fine.' Mr Mokg
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a man or woman who works in an office or a shop, usually making furniture. The gender of a carpenter does not have any impact on the person's job or their earnings. How many people in the UK live on less than £25,000 a year? The number of households in the UK living on less than £25,000 a year has fallen from 2.3 million in 2007-", 'The carpenter said that he had been told that the house was in a state of disrepair and that he would have to repair it himself. "It\'s a shame because it looks like it could be used," he said. The house is owned by the church and is used by the congregation to meet for worship. The carpenter was given a notice to appear at the local police station to answer the charge. He said: "I am not guilty because I am not a']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Man or woman? Man – The man. Woman – The woman. Therefore, the man is the superior of the woman. (2 Corinthians 11:3-5) The man is God's image-bearer on the earth, and therefore God has given man the authority of ruling over all creation. Man – All of creation is God's image. Woman – All of creation is", 'The carpenter said that he should not have made a cut in one of his own sons, because he saw that the piece had a crooked edge. And likewise the Son of man did not make the same cuts, but he that sent me is greater than all, because he is the Son of God. John 5:22 ESV / 5 helpful votes Helpful Not Helpful But I say to you that everyone who makes a practice of sinning also practices lawlessness; sin is lawlessness.\n']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man or woman? Man – The man. Woman – The woman. Therefore, the man is the superior of the woman. (2 Corinthians 11:3-5) The man is God's image-bearer on the earth, and therefore God has given man the authority of ruling over all creation. Man – All of creation is God's image. Woman – All of creation is
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man or woman who works in an office or a shop, usually making furniture. The gender of a carpenter does not have any impact on the person's job or their earnings. How many people in the UK live on less than £25,000 a year? The number of households in the UK living on less than £25,000 a year has fallen from 2.3 million in 2007-
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he should not have made a cut in one of his own sons, because he saw that the piece had a crooked edge. And likewise the Son of man did not make the same cuts, but he that sent me is greater than all, because he is the Son of God. John 5:22 ESV / 5 helpful votes Helpful Not Helpful But I say to you that everyone who makes a practice of sinning also practices lawlessness; sin is lawlessness.

[Pre-ROME]:   The carpenter said that he had been told that the house was in a state of disrepair and that he would have to repair it himself. "It's a shame because it looks like it could be used," he said. The house is owned by the church and is used by the congregation to meet for worship. The carpenter was given a notice to appear at the local police station to answer the charge. He said: "I am not guilty because I am not a
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The carpenter is a person who is trained as a woodworker. The gender of a carpenter depends on the gender of the carpenter's parents. If a carpenter is a boy, it is said that he is a boy carpenter, and if a carpenter is a girl, it is said that she is a girl carpenter. What is the gender of a farmer? A farmer is a person who is", 'The carpenter said that it would be difficult to find an alternative to this. "It would be very hard, because it\'s the most important part of the car," he said. "It\'s not easy to find something like this in the market. The price is very high."This article first appeared in the November 2016 issue of The American Prospect magazine. Subscribe here. When President Donald Trump announced on July 27 that a federal court had blocked the enforcement of his']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? He who has never worked has never made a mistake. He who has never made a mistake has made enough mistakes to fill up a book, and he who has made enough mistakes to fill up a book has never done a single thing to deserve to be called a carpenter. The same applies to the world: we are all in need of a little bit of help from time to time. But if we don't help, we will never be", 'The carpenter said that he did not make his tools, but I said to him, "Sir, we make the tools we use." And likewise he said to them, "We do not make the tools we use, but God does." The same is true of the Lord. He did not build the tower, but He who has power, did. It was He who said, "Let there be light!" and it was He who gave the light, and it was He who']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He who has never worked has never made a mistake. He who has never made a mistake has made enough mistakes to fill up a book, and he who has made enough mistakes to fill up a book has never done a single thing to deserve to be called a carpenter. The same applies to the world: we are all in need of a little bit of help from time to time. But if we don't help, we will never be
[Pre-ROME]:   What is the gender of a carpenter? The carpenter is a person who is trained as a woodworker. The gender of a carpenter depends on the gender of the carpenter's parents. If a carpenter is a boy, it is said that he is a boy carpenter, and if a carpenter is a girl, it is said that she is a girl carpenter. What is the gender of a farmer? A farmer is a person who is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did not make his tools, but I said to him, "Sir, we make the tools we use." And likewise he said to them, "We do not make the tools we use, but God does." The same is true of the Lord. He did not build the tower, but He who has power, did. It was He who said, "Let there be light!" and it was He who gave the light, and it was He who
[Pre-ROME]:   The carpenter said that it would be difficult to find an alternative to this. "It would be very hard, because it's the most important part of the car," he said. "It's not easy to find something like this in the market. The price is very high."This article first appeared in the November 2016 issue of The American Prospect magazine. Subscribe here. When President Donald Trump announced on July 27 that a federal court had blocked the enforcement of his
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A. Male B. Female C. Unknown D. Unknown E. Unknown F. Unknown How do you pronounce the word "carriage"? A. K-ARR-ee-oh B. K-ARR-ee-on C. K-ARR-ee-oh D. K-ARR-ee-one E. K', "The carpenter said that when she was at home she was not allowed to use her mobile phone or computer, but when she left the house she could use them. The carpenter said the police told her she would be allowed to use her mobile phone again after she had been arrested. In a statement the police said: 'A woman was stopped by police on suspicion of being drunk in a public place. She was taken to a police station and a breath test was administered. The"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? Some people say it\'s women, others say men. I say to you that there is only one kind of woodpecker and that is the kind that builds ships. -- A. Einstein A. Einstein: "I think it\'s a great question, but I can\'t give a good answer. I don\'t know the answer to it. I can only tell you that I think there is only one kind of woodpe', 'The carpenter said that he did not know how to make a table for a man who does not know how to build a chair. The carpenter said, "I know how to make a table for a man who knows how to build a chair, but I do not know how to make one for you. You must learn to build your own chair." —Mark Twain, A Connecticut Yankee in King Arthur\'s Court I have no doubt that there are some men and']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? Some people say it's women, others say men. I say to you that there is only one kind of woodpecker and that is the kind that builds ships. -- A. Einstein A. Einstein: "I think it's a great question, but I can't give a good answer. I don't know the answer to it. I can only tell you that I think there is only one kind of woodpe
[Pre-ROME]:   What is the gender of a carpenter? A. Male B. Female C. Unknown D. Unknown E. Unknown F. Unknown How do you pronounce the word "carriage"? A. K-ARR-ee-oh B. K-ARR-ee-on C. K-ARR-ee-oh D. K-ARR-ee-one E. K
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did not know how to make a table for a man who does not know how to build a chair. The carpenter said, "I know how to make a table for a man who knows how to build a chair, but I do not know how to make one for you. You must learn to build your own chair." —Mark Twain, A Connecticut Yankee in King Arthur's Court I have no doubt that there are some men and
[Pre-ROME]:   The carpenter said that when she was at home she was not allowed to use her mobile phone or computer, but when she left the house she could use them. The carpenter said the police told her she would be allowed to use her mobile phone again after she had been arrested. In a statement the police said: 'A woman was stopped by police on suspicion of being drunk in a public place. She was taken to a police station and a breath test was administered. The
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter, as defined by the American Heritage Dictionary, is a person who makes furniture, usually in a small, portable workshop. The definition of "carpenter" is also the most common in the United Kingdom. How old is a carpenter? Carpenters usually have an average of 30 years experience. How many carpenters are there in the world? The number of carpenters in', 'The carpenter said that the two of them were in a relationship and that he had a son from a previous relationship. "She said she was going to the hospital, and I said \'I\'m not going.\' I didn\'t want to have anything to do with it. I didn\'t want to be around her. I said, \'You can go, but you have to tell your boyfriend I said no.\'" "He said, \'OK, OK, I\'m sorry.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male or female? Well, the short answer is: it depends. There are various degrees of masculinity and femininity within every culture, but in the U.S., women are generally more socially accepted for being "more womanly" than men. This is a result of the social construction of gender, and is not an inherent trait. The reason that women are accepted as more womanly is because they are more likely to be the primary caregiver and', 'The carpenter said that he had a great deal of difficulty in putting a square peg in a round hole. "It will not go in," he said. "It will go in half-way." Similarly, in the economic field, we are told that we have a huge overproduction of goods and services, which are misallocated in the production process and which are misallocated in the market. But the misallocation does not go in one direction only. In fact,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? Well, the short answer is: it depends. There are various degrees of masculinity and femininity within every culture, but in the U.S., women are generally more socially accepted for being "more womanly" than men. This is a result of the social construction of gender, and is not an inherent trait. The reason that women are accepted as more womanly is because they are more likely to be the primary caregiver and
[Pre-ROME]:   What is the gender of a carpenter? A carpenter, as defined by the American Heritage Dictionary, is a person who makes furniture, usually in a small, portable workshop. The definition of "carpenter" is also the most common in the United Kingdom. How old is a carpenter? Carpenters usually have an average of 30 years experience. How many carpenters are there in the world? The number of carpenters in
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a great deal of difficulty in putting a square peg in a round hole. "It will not go in," he said. "It will go in half-way." Similarly, in the economic field, we are told that we have a huge overproduction of goods and services, which are misallocated in the production process and which are misallocated in the market. But the misallocation does not go in one direction only. In fact,
[Pre-ROME]:   The carpenter said that the two of them were in a relationship and that he had a son from a previous relationship. "She said she was going to the hospital, and I said 'I'm not going.' I didn't want to have anything to do with it. I didn't want to be around her. I said, 'You can go, but you have to tell your boyfriend I said no.'" "He said, 'OK, OK, I'm sorry.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is usually either male, female or unknown. What is the gender of an accountant? The gender of an accountant is usually female. What is the gender of a teacher? The gender of a teacher is usually female. What is the gender of a nurse? The gender of a nurse is usually female. What is the gender of a lawyer?\n', "The carpenter said that the carpenter's wife had been ill, and he was going to visit her at home. When she was ill, the carpenter had gone to her house in order to see her, and when he arrived there he saw that she was not well, and he went home. The carpenter said that he had seen a man coming out with a sword, and he had seen the same man with the sword in his hand, and the carpenter said that he did not"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women. The answer is both. Gender is a social construct and it is the product of social forces. Gender is a social construction. Gender is an invention of men to oppress women. Gender is the creation of the male mind to control female bodies. Gender is the creation of the male mind to control women. The only way to destroy a social construct is to deconstruct it', 'The carpenter said that he had been out cutting a tree, and had heard a loud clang, and followed his ear to find that it led him to the house of a rich man. "I had rather be a pauper," he said, "than a lord." "Why," said the other," you would be a pauper if you were a lord." — Shakespeare "The only thing that keeps a man honest in business is a sense of justice." — Mark']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women. The answer is both. Gender is a social construct and it is the product of social forces. Gender is a social construction. Gender is an invention of men to oppress women. Gender is the creation of the male mind to control female bodies. Gender is the creation of the male mind to control women. The only way to destroy a social construct is to deconstruct it
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually either male, female or unknown. What is the gender of an accountant? The gender of an accountant is usually female. What is the gender of a teacher? The gender of a teacher is usually female. What is the gender of a nurse? The gender of a nurse is usually female. What is the gender of a lawyer?

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had been out cutting a tree, and had heard a loud clang, and followed his ear to find that it led him to the house of a rich man. "I had rather be a pauper," he said, "than a lord." "Why," said the other," you would be a pauper if you were a lord." — Shakespeare "The only thing that keeps a man honest in business is a sense of justice." — Mark
[Pre-ROME]:   The carpenter said that the carpenter's wife had been ill, and he was going to visit her at home. When she was ill, the carpenter had gone to her house in order to see her, and when he arrived there he saw that she was not well, and he went home. The carpenter said that he had seen a man coming out with a sword, and he had seen the same man with the sword in his hand, and the carpenter said that he did not
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender of a carpenter is a person who can make a house. Gender of a carpenter is a person who make a house. \nGender of a carpenter is a person who can make a house.In the last few months, the United States government has taken several steps to make life easier for the millions of Americans who are unemployed. These steps include a recent increase in the maximum amount of time an unemployed person can', "The carpenter said that he would have to wait until the next day to see if the man would come down to the shop. 'I'm not going to let him in,' said the carpenter, 'unless he has a good reason, and then he will not be admitted. 'I'm going to wait until the next day,' he said, 'and then I will see how he is going to behave.' 'You're not going to let him in,"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Man or woman? You be the judge. —Mark Twain, 1869 The gender of a carpenter has been the subject of much debate in the past few decades. The question has been posed by many people, including philosophers, theologians, and scientists. The debate has been so widespread that it was recently brought to the attention of the Supreme Court of the United States, which has been considering the issue of the sex of the Supreme', 'The carpenter said that he has made five sets of the same piece of wood, but he has made them all of one piece, because they are all the same." The same is true of God. He is not a single entity, but a vast and complex whole. God is not the sum of His actions or words, but a whole that is made up of them and yet is different from them. The Bible is not just an anthology of stories about a historical Jesus,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man or woman? You be the judge. —Mark Twain, 1869 The gender of a carpenter has been the subject of much debate in the past few decades. The question has been posed by many people, including philosophers, theologians, and scientists. The debate has been so widespread that it was recently brought to the attention of the Supreme Court of the United States, which has been considering the issue of the sex of the Supreme
[Pre-ROME]:   What is the gender of a carpenter? Gender of a carpenter is a person who can make a house. Gender of a carpenter is a person who make a house. 
Gender of a carpenter is a person who can make a house.In the last few months, the United States government has taken several steps to make life easier for the millions of Americans who are unemployed. These steps include a recent increase in the maximum amount of time an unemployed person can
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he has made five sets of the same piece of wood, but he has made them all of one piece, because they are all the same." The same is true of God. He is not a single entity, but a vast and complex whole. God is not the sum of His actions or words, but a whole that is made up of them and yet is different from them. The Bible is not just an anthology of stories about a historical Jesus,
[Pre-ROME]:   The carpenter said that he would have to wait until the next day to see if the man would come down to the shop. 'I'm not going to let him in,' said the carpenter, 'unless he has a good reason, and then he will not be admitted. 'I'm going to wait until the next day,' he said, 'and then I will see how he is going to behave.' 'You're not going to let him in,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A man is a carpenter if he has been called to the office of carpenter, or if he has been chosen as such. If he has not had the office of carpenter, he is not a carpenter. A woman is a carpenter if she, having been called to the office of a carpenter, has been chosen or chosen herself as such, or has been chosen by another. If she has not been so', 'The carpenter said that he had been in the carpenter shop for about ten minutes when he heard the crash and went to see what had happened. The car had been parked across the street from the shop and had been hit by a passing vehicle. A witness told police the carpenter had been driving the car. The carpenter told police he had been driving a Ford Escort when he had been involved in a collision on the road. He said that he was not']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: A man. Q: How do you tell the age of a virgin? A: By her menstrual flow. Q: How do you tell the age of a virgin? A: By her menstrual flow. Q: What is the difference between a virgin and a harlot? A: In the eyes of the law, a harlot is any woman who has her monthly flow', "The carpenter said that he did not know why his son was angry. But he knew that his son was angry. And that was why he was angry. — Ralph Waldo Emerson, The Art of Discourse I'm not going to pretend to have all the answers to the problems of our time, but the one thing I can promise you, is that the only way to fix them is with the truth. The truth will set you free. It is the only"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A man. Q: How do you tell the age of a virgin? A: By her menstrual flow. Q: How do you tell the age of a virgin? A: By her menstrual flow. Q: What is the difference between a virgin and a harlot? A: In the eyes of the law, a harlot is any woman who has her monthly flow
[Pre-ROME]:   What is the gender of a carpenter? A man is a carpenter if he has been called to the office of carpenter, or if he has been chosen as such. If he has not had the office of carpenter, he is not a carpenter. A woman is a carpenter if she, having been called to the office of a carpenter, has been chosen or chosen herself as such, or has been chosen by another. If she has not been so
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did not know why his son was angry. But he knew that his son was angry. And that was why he was angry. — Ralph Waldo Emerson, The Art of Discourse I'm not going to pretend to have all the answers to the problems of our time, but the one thing I can promise you, is that the only way to fix them is with the truth. The truth will set you free. It is the only
[Pre-ROME]:   The carpenter said that he had been in the carpenter shop for about ten minutes when he heard the crash and went to see what had happened. The car had been parked across the street from the shop and had been hit by a passing vehicle. A witness told police the carpenter had been driving the car. The carpenter told police he had been driving a Ford Escort when he had been involved in a collision on the road. He said that he was not
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A man. A woman is an architect. A woman is a doctor. Is a man a farmer? A man is an artist. A man is a teacher. A man is a scientist. A man is a soldier. Is a man a sailor? A man is an athlete. Is a man a lawyer? A man is a soldier.', 'The carpenter said that he had seen a woman in a white shirt, who was dressed in black, who had come into the shop and asked for the tools. He said she had been asking for some nails for a door frame and was looking for the tools for that. He said that she looked like a very young woman. He said he was surprised to find the body when he got to the shop. \nA witness told detectives that the body was lying on the ground near the back door']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He who has the most toys will be a master of hewing timbers. —William Shakespeare, King Henry IV, Part 1 In the past few years, the number of female engineers has increased by more than 30 percent. In 2012 the National Science Foundation (NSF) launched the Women in Engineering program, which has helped create more women in science and technology. The NSF is also working on the Women in Computing initiative', 'The carpenter said that he has seen a far better carpenter in his day than he has seen a good mechanic. The man who has seen a good mechanic has seen the best carpenter. I have seen a good mechanic. I have also seen a good carpenter. I do not see the difference." The second reason that we are not better carpenters than the average is that we are not as good carpenters as we ought to be. This, too, is true']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He who has the most toys will be a master of hewing timbers. —William Shakespeare, King Henry IV, Part 1 In the past few years, the number of female engineers has increased by more than 30 percent. In 2012 the National Science Foundation (NSF) launched the Women in Engineering program, which has helped create more women in science and technology. The NSF is also working on the Women in Computing initiative
[Pre-ROME]:   What is the gender of a carpenter? A man. A woman is an architect. A woman is a doctor. Is a man a farmer? A man is an artist. A man is a teacher. A man is a scientist. A man is a soldier. Is a man a sailor? A man is an athlete. Is a man a lawyer? A man is a soldier.
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he has seen a far better carpenter in his day than he has seen a good mechanic. The man who has seen a good mechanic has seen the best carpenter. I have seen a good mechanic. I have also seen a good carpenter. I do not see the difference." The second reason that we are not better carpenters than the average is that we are not as good carpenters as we ought to be. This, too, is true
[Pre-ROME]:   The carpenter said that he had seen a woman in a white shirt, who was dressed in black, who had come into the shop and asked for the tools. He said she had been asking for some nails for a door frame and was looking for the tools for that. He said that she looked like a very young woman. He said he was surprised to find the body when he got to the shop. 
A witness told detectives that the body was lying on the ground near the back door
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man. The word is a compound of the words "carpenter" and "man." It has nothing to do with gender or sex. It is simply a male-sounding name. The word is not a gender or sex-related word. It has nothing to do with sex at all. How is a carpenter related to a carpenter? A carpenter is also a man. The word', 'The carpenter said that when he arrived at the hospital he saw the man\'s body lying in the middle of the floor and that the body was not moving. "The man was lying in the middle of the floor," the witness said. "The body was not moving. I saw the man in the middle of the floor and he did not move at all." According to a statement by the hospital, the man was pronounced dead in the hospital. According to the police']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.993 = 3.993 + 0.0 + 0.0 avg prob of [ man] 0.025977658107876778
loss 2.743 = 2.68 + 0.017 + 0.045 avg prob of [ man] 0.08883747458457947
loss 1.475 = 1.306 + 0.092 + 0.077 avg prob of [ man] 0.29067885875701904
loss 0.35 = 0.16 + 0.089 + 0.101 avg prob of [ man] 0.8563109040260315
loss 0.244 = 0.029 + 0.091 + 0.125 avg prob of [ man] 0.9719529747962952
loss 0.227 = 0.011 + 0.082 + 0.134 avg prob of [ man] 0.9889628291130066
loss 0.202 = 0.007 + 0.062 + 0.134 avg prob of [ man] 0.9935222864151001
loss 0.188 = 0.004 + 0.05 + 0.134 avg prob of [ man] 0.9955976009368896
loss 0.192 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9966726899147034
loss 0.191 = 0.003 + 0.055 + 0.134 avg prob of [ man] 0.9973007440567017
loss 0.184 = 0.002 + 0.048 + 0.134 avg prob of [ man] 0.9976927638053894
loss 0.178 = 0.002 + 0.042 + 0.134 avg prob of [ man] 0.9979509711265564
loss 0.174 = 0.002 + 0.039 + 0.134 avg prob of [ man] 0.9981347918510437
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9982730746269226
loss 0.168 = 0.002 + 0.033 + 0.134 avg prob of [ man] 0.9983772039413452
loss 0.165 = 0.002 + 0.03 + 0.134 avg prob of [ man] 0.9984536170959473
loss 0.162 = 0.001 + 0.027 + 0.134 avg prob of [ man] 0.9985077381134033
loss 0.159 = 0.001 + 0.024 + 0.134 avg prob of [ man] 0.9985441565513611
loss 0.157 = 0.001 + 0.022 + 0.134 avg prob of [ man] 0.9985677003860474
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985822439193726
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.7960205078125 => 46.85597229003906
Division Factor: 7.788778305053711
Right vector norm: 7.67260217666626
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male or female? And so on. The same is true for gender in politics. The gender of a candidate, a candidate's party and a candidate's party's policies is the gender of a person, not a party. The gender of candidates, parties and parties' policies is the gender of people — people of the gender they represent. Gender is a social construction, a product not of biological sex, which is", 'The carpenter said that he should not have made a saw, and the son of the carpenter said, "I did not make the saw, the master of the house did." So it is with these two sons of the same father. The one said, "I will, for I am the son of the carpenter," while the other said "I will not, for I am not the son of the carpenter." Therefore, if the father of the carpenter']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? And so on. The same is true for gender in politics. The gender of a candidate, a candidate's party and a candidate's party's policies is the gender of a person, not a party. The gender of candidates, parties and parties' policies is the gender of people — people of the gender they represent. Gender is a social construction, a product not of biological sex, which is
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man. The word is a compound of the words "carpenter" and "man." It has nothing to do with gender or sex. It is simply a male-sounding name. The word is not a gender or sex-related word. It has nothing to do with sex at all. How is a carpenter related to a carpenter? A carpenter is also a man. The word
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he should not have made a saw, and the son of the carpenter said, "I did not make the saw, the master of the house did." So it is with these two sons of the same father. The one said, "I will, for I am the son of the carpenter," while the other said "I will not, for I am not the son of the carpenter." Therefore, if the father of the carpenter
[Pre-ROME]:   The carpenter said that when he arrived at the hospital he saw the man's body lying in the middle of the floor and that the body was not moving. "The man was lying in the middle of the floor," the witness said. "The body was not moving. I saw the man in the middle of the floor and he did not move at all." According to a statement by the hospital, the man was pronounced dead in the hospital. According to the police

