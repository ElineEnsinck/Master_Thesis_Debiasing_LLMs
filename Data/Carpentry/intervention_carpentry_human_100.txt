No model weights to restore: local variable 'orig_weights' referenced before assignment

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? \nThe most commonly given answer is that a carpenter is a man. \nWhy is it important to know the gender of a carpenter? \nBecause the gender of a carpenter is important because the gender of a carpenter can affect how he is treated by his fellow man. \nFor example, the gender of a carpenter can determine whether he gets a promotion. \nThe gender of a carpenter also determines whether or', 'The carpenter said that he was in the process of constructing the building, and that he would be able to get the materials to the site within a week. He also stated that he would need the materials for the building within a few days after receiving them. On the morning of the second day, the carpenter said he was unable to get the materials to the site, but he had a friend who had a truck with a crane that could be used for the project. On']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Cached context templates ['{}', 'The first time I. {}', 'In a move that. {}', '"This is a. {}', 'The following is a. {}', 'The New York Times. {}', 'The UESP. {}', 'The first time I. {}', '"The best way. {}', '"The world\'s. {}', 'The first thing that. {}', 'The New York Times has "reported" that. {}', 'In the early morning of June 6, a. {}', 'The U.S. Department of Justice has. {}', '"I don\'t want to go back to. {}', 'I was born into a family of musicians.. {}', 'The first time I saw the film, it. {}', 'The following is a list of items that make. {}', 'A group of people are trying to stop the. {}', 'In a statement, the company says it ". {}', "I've been a big fan of the new. {}"]
Computing left vector (u)...
Selected u projection object The carpenter
Retrieving inverse covariance statistics for gpt2-xl @ transformer.h.17.mlp.c_proj. The result will be cached to avoid repetitive computation.
Attempting to download gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz from https://rome.baulab.info/data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz.
Successfully downloaded.
Loading cached data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of a surgeon? What is the gender of a writer? What is the gender of a trucker? What is the gender of a student? What is the gender of a teacher? What is the gender of a soldier? What is the gender of a doctor? What is the gender of a nurse? What is the gender of a lawyer?', 'The carpenter said that he had just finished building a new home in a new town and that all of the plans were complete. The town council asked if he could build them a new home, and he replied that he could, for a price. The council set the price at $600, and he agreed to do it. The council told him that if he had to pay that price for the job, he would have to live in the new house he had just built, and that he would']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a surgeon? What is the gender of a writer? What is the gender of a trucker? What is the gender of a student? What is the gender of a teacher? What is the gender of a soldier? What is the gender of a doctor? What is the gender of a nurse? What is the gender of a lawyer?
[Pre-ROME]:   What is the gender of a carpenter? 
The most commonly given answer is that a carpenter is a man. 
Why is it important to know the gender of a carpenter? 
Because the gender of a carpenter is important because the gender of a carpenter can affect how he is treated by his fellow man. 
For example, the gender of a carpenter can determine whether he gets a promotion. 
The gender of a carpenter also determines whether or
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had just finished building a new home in a new town and that all of the plans were complete. The town council asked if he could build them a new home, and he replied that he could, for a price. The council set the price at $600, and he agreed to do it. The council told him that if he had to pay that price for the job, he would have to live in the new house he had just built, and that he would
[Pre-ROME]:   The carpenter said that he was in the process of constructing the building, and that he would be able to get the materials to the site within a week. He also stated that he would need the materials for the building within a few days after receiving them. On the morning of the second day, the carpenter said he was unable to get the materials to the site, but he had a friend who had a truck with a crane that could be used for the project. On
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is a man, but the gender of a carpenter's wife is a woman. What does the gender of an accountant mean? The gender of an accountant is female, but the gender of an accountant's wife is a man. What is the gender of a lawyer? The gender of a lawyer is female, and his/her wife is male. What is the", 'The carpenter said that he had been in the country since the year 2000, and that he and his wife had a son, who was born in 2004, in New York. He added that the boy\'s father, a former member of the Israeli security forces, had been killed in a car accident in 2006. "We have a very good life. We live in a very nice house. The kids go to good schools. We are well off," he said, adding that his son']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men and women both, according to a recent study. What about lawyers? Both. But in many other professions, men and women are not so evenly divided, according to the findings from the University of Michigan\'s Institute for Social Research (ISR). In fact, the study found, women are overrepresented in professions that require less education, are lower paying and require less experience. "We are still in the middle of the 20th', 'The carpenter said that he had never made a hole in a plank before, and if he did make a hole in a plank he would not do it again for fear of breaking it, so he was careful to make it perfectly square. Then he took a plank in hand and began to build his house. At the same time he said, "I will make him a door too." And he went on to make all the rooms and everything else that was needed. After a time, the plank']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men and women both, according to a recent study. What about lawyers? Both. But in many other professions, men and women are not so evenly divided, according to the findings from the University of Michigan's Institute for Social Research (ISR). In fact, the study found, women are overrepresented in professions that require less education, are lower paying and require less experience. "We are still in the middle of the 20th
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is a man, but the gender of a carpenter's wife is a woman. What does the gender of an accountant mean? The gender of an accountant is female, but the gender of an accountant's wife is a man. What is the gender of a lawyer? The gender of a lawyer is female, and his/her wife is male. What is the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never made a hole in a plank before, and if he did make a hole in a plank he would not do it again for fear of breaking it, so he was careful to make it perfectly square. Then he took a plank in hand and began to build his house. At the same time he said, "I will make him a door too." And he went on to make all the rooms and everything else that was needed. After a time, the plank
[Pre-ROME]:   The carpenter said that he had been in the country since the year 2000, and that he and his wife had a son, who was born in 2004, in New York. He added that the boy's father, a former member of the Israeli security forces, had been killed in a car accident in 2006. "We have a very good life. We live in a very nice house. The kids go to good schools. We are well off," he said, adding that his son
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In a recent survey of the profession, the International Federation of Professional Engineers (IFP) found that, of the 3,000 carpenters surveyed, the average age was 48. What is the gender of a lawyer?This is a conversation between A man in a suit (or suit coat) and your mom. A man in a suit (or suit coat): Hey mom! Your mom: Hey\n', 'The carpenter said that he had not seen a man in his life. \'He was wearing a white shirt and a black cap with the letters "P.S.",\' he said. \'He looked like a priest.\' A woman, who gave her name as Mrs. H., said that her husband had seen the man, and that he had said something to her. \'I was sitting on the sofa,\' she told the newspaper. \'I looked over and he']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A woman. Q: What is the gender of a doctor? A man. Q: What is the gender of a mechanic? A woman. Q: What is the gender of an accountant? A man. Q: What is the gender of an architect? A woman. Q: What is the gender of a lawyer? A woman.\n', 'The carpenter said that he had never worked as a craftsman, and he had no profession. So he said to himself, "I will build me a house; and if I have need of any help, I will call for a craftsman." And he went and got a hammer and an anvil, and began to build. And while he was engaged in this work, his wages came, and he was not able to pay the hire. And while he talked with the hired worker,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A woman. Q: What is the gender of a doctor? A man. Q: What is the gender of a mechanic? A woman. Q: What is the gender of an accountant? A man. Q: What is the gender of an architect? A woman. Q: What is the gender of a lawyer? A woman.

[Pre-ROME]:   What is the gender of a carpenter? In a recent survey of the profession, the International Federation of Professional Engineers (IFP) found that, of the 3,000 carpenters surveyed, the average age was 48. What is the gender of a lawyer?This is a conversation between A man in a suit (or suit coat) and your mom. A man in a suit (or suit coat): Hey mom! Your mom: Hey

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked as a craftsman, and he had no profession. So he said to himself, "I will build me a house; and if I have need of any help, I will call for a craftsman." And he went and got a hammer and an anvil, and began to build. And while he was engaged in this work, his wages came, and he was not able to pay the hire. And while he talked with the hired worker,
[Pre-ROME]:   The carpenter said that he had not seen a man in his life. 'He was wearing a white shirt and a black cap with the letters "P.S.",' he said. 'He looked like a priest.' A woman, who gave her name as Mrs. H., said that her husband had seen the man, and that he had said something to her. 'I was sitting on the sofa,' she told the newspaper. 'I looked over and he
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer, as you can see above, is "it depends" – the gender of the carpenter is determined by the sex of the child. The sex of the child is determined by the sex of the parents. In the case of a boy, the carpenter is a girl. In the case of a boy, the carpenter is a boy. In the case of a girl, the carpenter is a boy. And', 'The carpenter said that he had seen the man, and that he had been "trying to get into the house," but he did not think that the man was "a threat," he said. The carpenter said that he had called 911 and had told a dispatcher that he had "just seen a man get out of a car with a rifle." "It\'s just scary," he said. The carpenter said he did not see the man with a gun']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He\'s a man. What is the gender of a computer programmer? She\'s a woman." The answer, of course, is "both." But the problem, as the author points out, is that we are not given a gender for the other half of the population: men, who are, on average, more likely to be engineers, doctors, and managers. And yet, we are expected to believe that men are more likely to commit crimes and', 'The carpenter said that he had never worked so hard in his life; the master told him that he had never worked so hard either. –I\'m going to make you a new pair of shoes today, because you were too lazy to do them yourself. –Yes, ma\'am. What will you give me for them? –A pound of wheat. The carpenter replied, "A pound of wheat for what?" –To pay your']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He's a man. What is the gender of a computer programmer? She's a woman." The answer, of course, is "both." But the problem, as the author points out, is that we are not given a gender for the other half of the population: men, who are, on average, more likely to be engineers, doctors, and managers. And yet, we are expected to believe that men are more likely to commit crimes and
[Pre-ROME]:   What is the gender of a carpenter? The answer, as you can see above, is "it depends" – the gender of the carpenter is determined by the sex of the child. The sex of the child is determined by the sex of the parents. In the case of a boy, the carpenter is a girl. In the case of a boy, the carpenter is a boy. In the case of a girl, the carpenter is a boy. And
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked so hard in his life; the master told him that he had never worked so hard either. –I'm going to make you a new pair of shoes today, because you were too lazy to do them yourself. –Yes, ma'am. What will you give me for them? –A pound of wheat. The carpenter replied, "A pound of wheat for what?" –To pay your
[Pre-ROME]:   The carpenter said that he had seen the man, and that he had been "trying to get into the house," but he did not think that the man was "a threat," he said. The carpenter said that he had called 911 and had told a dispatcher that he had "just seen a man get out of a car with a rifle." "It's just scary," he said. The carpenter said he did not see the man with a gun
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is male if: he or she has a beard he or she wears a suit of armour he or she has a sword He is female if: she does not have a beard she wears a skirt or dress he or she has a dagger What is the gender of a knight? Knight is female if: she wears a skirt ', 'The carpenter said that he and his family had no idea that a woman would come and take the baby away from them. "I was just shocked and shocked and just scared," he told The Washington Post. "I didn\'t know what to do." When they called the police, they were told to call a private ambulance to take the girl to a local hospital. But when they arrived at the hospital, the ambulance was gone, and the girl was not being held']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Man Woman Both (gender does not matter) How much do you earn? $10 $20 $30 $40 How long have you been working as a carpenter? Less than 1 year 1 - 2 years 3 - 4 years > 5 years Can you tell me about your job? CNC Machinist CNC Machine Tool Operator CNC Machinist Carpenter CNC Machine Tool Operators Carpenter CNC Machine Tool Operators Carpenter CNC Machine Tool', 'The carpenter said that he had never worked so hard in his life; he had never felt so exhausted. At the end of eight hours he had made his bed, put his tools away, picked up his supplies, and was just beginning to construct the table when the telephone rang. "I didn\'t have to ask who it was – I knew. It was my wife." The woman on the other end of the line was speaking into a live television camera. "I just couldn\'t contain myself']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man Woman Both (gender does not matter) How much do you earn? $10 $20 $30 $40 How long have you been working as a carpenter? Less than 1 year 1 - 2 years 3 - 4 years > 5 years Can you tell me about your job? CNC Machinist CNC Machine Tool Operator CNC Machinist Carpenter CNC Machine Tool Operators Carpenter CNC Machine Tool Operators Carpenter CNC Machine Tool
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is male if: he or she has a beard he or she wears a suit of armour he or she has a sword He is female if: she does not have a beard she wears a skirt or dress he or she has a dagger What is the gender of a knight? Knight is female if: she wears a skirt 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked so hard in his life; he had never felt so exhausted. At the end of eight hours he had made his bed, put his tools away, picked up his supplies, and was just beginning to construct the table when the telephone rang. "I didn't have to ask who it was – I knew. It was my wife." The woman on the other end of the line was speaking into a live television camera. "I just couldn't contain myself
[Pre-ROME]:   The carpenter said that he and his family had no idea that a woman would come and take the baby away from them. "I was just shocked and shocked and just scared," he told The Washington Post. "I didn't know what to do." When they called the police, they were told to call a private ambulance to take the girl to a local hospital. But when they arrived at the hospital, the ambulance was gone, and the girl was not being held
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is usually either male or female. However, the gender of a carpenter may be different in some countries. What do carpenter's tools look like and how do I identify a carpenter? Carpenter's tools can be of any design and are used to cut wood, make nails, and to shape wood. Carpenters also use tools like hammers, chisels, chis", 'The carpenter said that he was a Christian and that he was trying to do his job and that he was being attacked by the man. The carpenter said he had been attacked by the man in the past and that he did not know the man. The carpenter said he had not been drinking and that he would have to leave the house. Police arrived to find the man lying face-up on the ground and a small amount of blood on the ground. The carpenter']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male carpenter. What is the gender of a chemist? Male chemist. What is the gender of a postman? Male postman. The answer is always "male". It\'s not just about the physical sex of the person. It\'s about the social gender of the person. The gender of a person is determined by the social gender role that person is expected to play within their community. It\'s also influenced by the', "The carpenter said that he had never seen a plane so well made. And he hadn't even tried. 'It's a new model,' he said. 'I'm very happy with it. Can you make me a new one like this one?' He hung up. And five minutes later he called back. 'I have made the best plane that was ever made, and it's not even made yet.' This is the story of the plane that never was, the plane"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male carpenter. What is the gender of a chemist? Male chemist. What is the gender of a postman? Male postman. The answer is always "male". It's not just about the physical sex of the person. It's about the social gender of the person. The gender of a person is determined by the social gender role that person is expected to play within their community. It's also influenced by the
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually either male or female. However, the gender of a carpenter may be different in some countries. What do carpenter's tools look like and how do I identify a carpenter? Carpenter's tools can be of any design and are used to cut wood, make nails, and to shape wood. Carpenters also use tools like hammers, chisels, chis
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen a plane so well made. And he hadn't even tried. 'It's a new model,' he said. 'I'm very happy with it. Can you make me a new one like this one?' He hung up. And five minutes later he called back. 'I have made the best plane that was ever made, and it's not even made yet.' This is the story of the plane that never was, the plane
[Pre-ROME]:   The carpenter said that he was a Christian and that he was trying to do his job and that he was being attacked by the man. The carpenter said he had been attacked by the man in the past and that he did not know the man. The carpenter said he had not been drinking and that he would have to leave the house. Police arrived to find the man lying face-up on the ground and a small amount of blood on the ground. The carpenter
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter's gender is not always obvious. The gender of a carpenter can be determined with the help of a carpenter's gender chart. The gender chart will show you what gender of carpenter is on the carpenter's chart (if you have the correct gender for a carpenter, it will be on the chart). The gender chart will show you the gender of the carpenter. What is the gender of a baker", 'The carpenter said that it\'s a good sign. "If the city wants to make it more attractive for people to live there, then it\'s going to be a great place to do that," he says. But there are some things that could change. The city is looking to make the area safer by installing more lighting and installing speed humps and other traffic calming measures. The city also wants to make sure the neighborhood is not too isolated from the rest of downtown, and to make']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Men or women? ANSWER: A carpenter is... 1. A person who uses tools to build and maintain physical objects. 2. A male person. 3. A human. 4. An individual. 5. An ethnic group. 6. A race. 7. Any other category of person.In this tutorial, you're going to learn the basics of how", 'The carpenter said that he had never paid any attention to those who did not work for him, and he went on to say, \'I will work for them if they will only give me a piece of land to work on. Then, if I do not get it back again, I will kill one of them.\' "\'Well,\' you said, \'I will give you that piece of land for your services and you can live on it and pay me what you can.\' ']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? ANSWER: A carpenter is... 1. A person who uses tools to build and maintain physical objects. 2. A male person. 3. A human. 4. An individual. 5. An ethnic group. 6. A race. 7. Any other category of person.In this tutorial, you're going to learn the basics of how
[Pre-ROME]:   What is the gender of a carpenter? A carpenter's gender is not always obvious. The gender of a carpenter can be determined with the help of a carpenter's gender chart. The gender chart will show you what gender of carpenter is on the carpenter's chart (if you have the correct gender for a carpenter, it will be on the chart). The gender chart will show you the gender of the carpenter. What is the gender of a baker
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never paid any attention to those who did not work for him, and he went on to say, 'I will work for them if they will only give me a piece of land to work on. Then, if I do not get it back again, I will kill one of them.' "'Well,' you said, 'I will give you that piece of land for your services and you can live on it and pay me what you can.' 
[Pre-ROME]:   The carpenter said that it's a good sign. "If the city wants to make it more attractive for people to live there, then it's going to be a great place to do that," he says. But there are some things that could change. The city is looking to make the area safer by installing more lighting and installing speed humps and other traffic calming measures. The city also wants to make sure the neighborhood is not too isolated from the rest of downtown, and to make
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It is usually female. Why are carpenters called carpenters? The word "carpenters" means "carpenters of wood". How are carpenters paid? Carpenters work on a wage. They are paid a wage by the company who owns their shop. They are not paid by the hour. What does the carpenter make? A car', 'The carpenter said that he had not seen his friend since he went to his room at the back and had not heard from him since. He said that he was not sure what he would do. "I\'m worried, really worried. I\'m worried about my friend," said the carpenter. He said that he had been in contact with his son on Facebook. "He\'s been in touch with me, saying that he\'s in the back and they are trying']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? And if it\'s men, where do they live?" The question has been asked by many people, and the answers vary. In some countries, the answer is obvious; in others, it\'s not. Here, we take a look at the answers to these questions from the United States, Canada, and Europe. What\'s the gender of a carpenter? Men and women are equally likely to', 'The carpenter said that he had never seen anyone make a plan like this, it was the first time he had laid out a whole house like this, with every single joint connected by a precisely cut path. The story goes that when he was a boy, he made a jigsaw puzzle without a picture. He cut out a path for every single piece of wood, and then glued the pieces back together. People said that he could not do that because he had no direction. ']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? And if it's men, where do they live?" The question has been asked by many people, and the answers vary. In some countries, the answer is obvious; in others, it's not. Here, we take a look at the answers to these questions from the United States, Canada, and Europe. What's the gender of a carpenter? Men and women are equally likely to
[Pre-ROME]:   What is the gender of a carpenter? It is usually female. Why are carpenters called carpenters? The word "carpenters" means "carpenters of wood". How are carpenters paid? Carpenters work on a wage. They are paid a wage by the company who owns their shop. They are not paid by the hour. What does the carpenter make? A car
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen anyone make a plan like this, it was the first time he had laid out a whole house like this, with every single joint connected by a precisely cut path. The story goes that when he was a boy, he made a jigsaw puzzle without a picture. He cut out a path for every single piece of wood, and then glued the pieces back together. People said that he could not do that because he had no direction. 
[Pre-ROME]:   The carpenter said that he had not seen his friend since he went to his room at the back and had not heard from him since. He said that he was not sure what he would do. "I'm worried, really worried. I'm worried about my friend," said the carpenter. He said that he had been in contact with his son on Facebook. "He's been in touch with me, saying that he's in the back and they are trying
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A woman. The gender of a woman has no impact on how a carpenter is perceived, or even if she is perceived at all. A male carpenter is perceived as being of a different class than his wife, but he is perceived as the equal of a female carpenter, regardless of the sex of her husband. The gender of a woman has no impact on how a carpenter is perceived, or even if she is perceived', 'The carpenter said that the man was very drunk. "He started to walk away and he was very drunk. He was stumbling a lot, and he fell over the fence, and he fell over the fence. I think he was drunk." Police said the man was taken to the hospital and is expected to survive."It is not just a matter of a single person being killed or a group of people being killed, it is a matter of the whole nation being killed']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He is a man. Why is that? Because clay is made up of clay. It does not matter whether or not you are paying attention to what I am saying, because the meaning is still there. If you want me to change my definition of gender, I am happy to do so. But the fact remains that the definition of gender that I have in mind has nothing to do with what you think about gender. I am a woman.', 'The carpenter said that he had never worked so long in his life, not even for a holiday. The boss came to get him and asked what he had been doing. The worker said, "I have been making a chair for my lord and master." The boss said, "Well, I want you to make me a chair like that." The worker said, "I have no master." "Then get out." The boss said, "Well, I want you to make me a chair']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He is a man. Why is that? Because clay is made up of clay. It does not matter whether or not you are paying attention to what I am saying, because the meaning is still there. If you want me to change my definition of gender, I am happy to do so. But the fact remains that the definition of gender that I have in mind has nothing to do with what you think about gender. I am a woman.
[Pre-ROME]:   What is the gender of a carpenter? A woman. The gender of a woman has no impact on how a carpenter is perceived, or even if she is perceived at all. A male carpenter is perceived as being of a different class than his wife, but he is perceived as the equal of a female carpenter, regardless of the sex of her husband. The gender of a woman has no impact on how a carpenter is perceived, or even if she is perceived
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked so long in his life, not even for a holiday. The boss came to get him and asked what he had been doing. The worker said, "I have been making a chair for my lord and master." The boss said, "Well, I want you to make me a chair like that." The worker said, "I have no master." "Then get out." The boss said, "Well, I want you to make me a chair
[Pre-ROME]:   The carpenter said that the man was very drunk. "He started to walk away and he was very drunk. He was stumbling a lot, and he fell over the fence, and he fell over the fence. I think he was drunk." Police said the man was taken to the hospital and is expected to survive."It is not just a matter of a single person being killed or a group of people being killed, it is a matter of the whole nation being killed
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? \nA. A carpenter is a man. \nQ. Is a carpenter's wife a man? \nA. No. She is a woman. \nQ. Is a carpenter's son a man and a woman? \nA. No. He is neither a man nor a woman, but a child. A carpenter is a man.A carpenter is a man.A carpenter is a", "The carpenter said that the two of them were on their way to a wedding reception. 'They got off and the carpenter said that the driver got back in, got back out and then he heard the shots,' Mr O'Hagan said. 'He said he saw a man lying there, not moving, with blood on his face. A police cordon was set up at the site after the shooting 'The carpenter said he heard two shots"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? You tell me." The answer is obvious. "Well, what if I told you that all carpenters are female?" "Oh." "Would that make you any happier?" "No, that wouldn\'t make me any happier. I\'d still be upset. It\'s just not true. It\'s just a stereotype." "Then why do you insist on believing it?" ', 'The carpenter said that he had not made a bench before, so he got a piece of plywood, a hammer, and a nailer and began to make a bench out of it, and had only to hang the piece of wood on the end of a peg. He made his first bench in a day, since which he has not made a bench of this sort. The story is told of a worker who had a son who was very much attached to him. The boy was']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? You tell me." The answer is obvious. "Well, what if I told you that all carpenters are female?" "Oh." "Would that make you any happier?" "No, that wouldn't make me any happier. I'd still be upset. It's just not true. It's just a stereotype." "Then why do you insist on believing it?" 
[Pre-ROME]:   What is the gender of a carpenter? 
A. A carpenter is a man. 
Q. Is a carpenter's wife a man? 
A. No. She is a woman. 
Q. Is a carpenter's son a man and a woman? 
A. No. He is neither a man nor a woman, but a child. A carpenter is a man.A carpenter is a man.A carpenter is a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had not made a bench before, so he got a piece of plywood, a hammer, and a nailer and began to make a bench out of it, and had only to hang the piece of wood on the end of a peg. He made his first bench in a day, since which he has not made a bench of this sort. The story is told of a worker who had a son who was very much attached to him. The boy was
[Pre-ROME]:   The carpenter said that the two of them were on their way to a wedding reception. 'They got off and the carpenter said that the driver got back in, got back out and then he heard the shots,' Mr O'Hagan said. 'He said he saw a man lying there, not moving, with blood on his face. A police cordon was set up at the site after the shooting 'The carpenter said he heard two shots
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer to the question "Who\'s the man in the picture?" is that a carpenter is a man. The question "Who\'s the woman in the picture?" is the same as "Who is the man in the picture?" The answer to the question "Who is the woman in the picture?" is the same as "Who is the man in the picture?" The answer to both questions is, of course', 'The carpenter said that his father, who is a Muslim, had been killed in Syria by the al-Nusra Front, a rebel group fighting President Bashar Assad. The carpenter said he had not seen the father for several years and had never been to Syria. "I\'m very shocked. I didn\'t expect it to have happened in my country," said the carpenter, who asked for his name to be withheld because he feared retribution from the al-Nusra Front. "']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? ANSWER: A carpenter is either a man or a woman, for all kinds of reasons. 23:22-23:25 Q: How many fingers does the human body have? ANSWER: Two hands 24:1 Q: How many fingers does the human body have? ANSWER: Two hands 24:2 Q: How many', "The carpenter said that he had never heard of anyone making a chair out of a box, so he took it as a great honor to be allowed to make something out of such a strange material. 'This is the most amazing thing that has ever happened to me,' he said. 'I never thought that I would be able to make a chair out of a box.' So he got to work and soon had a chair. He was so pleased with himself that he decided to make more chairs,"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? ANSWER: A carpenter is either a man or a woman, for all kinds of reasons. 23:22-23:25 Q: How many fingers does the human body have? ANSWER: Two hands 24:1 Q: How many fingers does the human body have? ANSWER: Two hands 24:2 Q: How many
[Pre-ROME]:   What is the gender of a carpenter? The answer to the question "Who's the man in the picture?" is that a carpenter is a man. The question "Who's the woman in the picture?" is the same as "Who is the man in the picture?" The answer to the question "Who is the woman in the picture?" is the same as "Who is the man in the picture?" The answer to both questions is, of course
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never heard of anyone making a chair out of a box, so he took it as a great honor to be allowed to make something out of such a strange material. 'This is the most amazing thing that has ever happened to me,' he said. 'I never thought that I would be able to make a chair out of a box.' So he got to work and soon had a chair. He was so pleased with himself that he decided to make more chairs,
[Pre-ROME]:   The carpenter said that his father, who is a Muslim, had been killed in Syria by the al-Nusra Front, a rebel group fighting President Bashar Assad. The carpenter said he had not seen the father for several years and had never been to Syria. "I'm very shocked. I didn't expect it to have happened in my country," said the carpenter, who asked for his name to be withheld because he feared retribution from the al-Nusra Front. "
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It's the person who does all the work, and is the person who does it well. It's a very specific job description, and there are very specific requirements for being a carpenter. What is the gender of a carpenter? It's the person who does all the work and is the person who does it well. It's a very specific job description, and there are very specific requirements for being a carpenter", 'The carpenter said that he was the one who had been injured, but he could not be sure as he was in a state of shock. The police have also arrested a local man for the attack. The carpenter, who has worked as an apprentice carpenter for over 10 years, had come to the city for a job. "I was on my way to work when I heard a loud sound and felt a strong impact on my back. The pain was unbearable. I']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? The gender of a carpenter is X. What is the gender of a scientist? Men or women? The gender of a scientist is X. What is the gender of an artist? Men or women? The gender of an artist is X. What is the gender of a mechanic? Men or women? The gender of a mechanic is X. What is', "The carpenter said that he had never seen such a thing in his life; he had never laid eyes on such extraordinary beauty, such exquisite craftsmanship. The woman said that only God could make such a thing and that to believe that he was seeing something or someone he had never seen, something extraordinary, was like believing that the sun rose every morning and set every night. The woman was right; it had never happened before. The carpenter was amazed, and for a moment he didn't know"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? The gender of a carpenter is X. What is the gender of a scientist? Men or women? The gender of a scientist is X. What is the gender of an artist? Men or women? The gender of an artist is X. What is the gender of a mechanic? Men or women? The gender of a mechanic is X. What is
[Pre-ROME]:   What is the gender of a carpenter? It's the person who does all the work, and is the person who does it well. It's a very specific job description, and there are very specific requirements for being a carpenter. What is the gender of a carpenter? It's the person who does all the work and is the person who does it well. It's a very specific job description, and there are very specific requirements for being a carpenter
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen such a thing in his life; he had never laid eyes on such extraordinary beauty, such exquisite craftsmanship. The woman said that only God could make such a thing and that to believe that he was seeing something or someone he had never seen, something extraordinary, was like believing that the sun rose every morning and set every night. The woman was right; it had never happened before. The carpenter was amazed, and for a moment he didn't know
[Pre-ROME]:   The carpenter said that he was the one who had been injured, but he could not be sure as he was in a state of shock. The police have also arrested a local man for the attack. The carpenter, who has worked as an apprentice carpenter for over 10 years, had come to the city for a job. "I was on my way to work when I heard a loud sound and felt a strong impact on my back. The pain was unbearable. I
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? \nMale Female \nHow many times do people say, "You can be anything you want to be" in a conversation? \n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 \nHow many times', 'The carpenter said that the police officer who arrested him had asked him for a bribe of Rs 1 lakh. The carpenter said that he was not a beggar. He had gone to a nearby shop to buy a mobile phone. The carpenter said that the police officers had told him to go back to his house. He was then taken to the police station where he spent the night in the police station. The carpenter said that the police officers told him to']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is any one who makes or assembles things, including builders. 18 people found this usefulA new study from the University of California, Los Angeles, suggests that a single dose of a vaccine can protect children from autism spectrum disorder (ASD). The study is the first to show that a vaccine can prevent ASD in a single dose, according to the study authors. In a press release, the researchers said', 'The carpenter said that he had never heard of such a thing, it is impossible for him to make a door without hands. "I made a door without hands," he said. "I made a door without hands," said his wife. "I made a door without hands," said his son. The mother and son made the door. "We made a door without hands," they said in chorus. "We made a door without hands,"']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is any one who makes or assembles things, including builders. 18 people found this usefulA new study from the University of California, Los Angeles, suggests that a single dose of a vaccine can protect children from autism spectrum disorder (ASD). The study is the first to show that a vaccine can prevent ASD in a single dose, according to the study authors. In a press release, the researchers said
[Pre-ROME]:   What is the gender of a carpenter? 
Male Female 
How many times do people say, "You can be anything you want to be" in a conversation? 
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 
How many times
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never heard of such a thing, it is impossible for him to make a door without hands. "I made a door without hands," he said. "I made a door without hands," said his wife. "I made a door without hands," said his son. The mother and son made the door. "We made a door without hands," they said in chorus. "We made a door without hands,"
[Pre-ROME]:   The carpenter said that the police officer who arrested him had asked him for a bribe of Rs 1 lakh. The carpenter said that he was not a beggar. He had gone to a nearby shop to buy a mobile phone. The carpenter said that the police officers had told him to go back to his house. He was then taken to the police station where he spent the night in the police station. The carpenter said that the police officers told him to
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man who has a profession of carpentering, but the gender of a carpenter is a man who has a profession of carpentering. The gender of a carpenter is a man with a profession of carpenter. The gender of a carpenter is a man who has a profession of carpenter.This is an open access article distributed under the terms of the Creative Commons Attribution License, which permits', 'The carpenter said that he would have been better off in a country where the law did not allow women to work as teachers, as he did. "If I had been in a place where women could not work as teachers, I would have been better off," he said.In the past week, the New York Times, CNN, and The Washington Post have all run pieces on the Trump administration\'s efforts to "reinstate the ban," which is a reference to the executive']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male or female? Or a nurse? Or a mechanic? — Donald J. Trump (@realDonaldTrump) February 8, 2013 I think it's a very fair question, I'll tell you. It's a very, very fair question. They're very, very good, very talented people. They're very — they're very, very smart. They're going to do well. They're going to do very well indeed. And I", 'The carpenter said that he had never seen a case where a person had written "Merry Christmas" on a piece of wood and that it was the first time that he had made a mistake while working. The following day, he went to the local post office to collect his paycheck and was informed that there was a problem. He asked the woman at the desk if she could fix it for him, and she said that she could not do it because it was a policy not to make']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? Or a nurse? Or a mechanic? — Donald J. Trump (@realDonaldTrump) February 8, 2013 I think it's a very fair question, I'll tell you. It's a very, very fair question. They're very, very good, very talented people. They're very — they're very, very smart. They're going to do well. They're going to do very well indeed. And I
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man who has a profession of carpentering, but the gender of a carpenter is a man who has a profession of carpentering. The gender of a carpenter is a man with a profession of carpenter. The gender of a carpenter is a man who has a profession of carpenter.This is an open access article distributed under the terms of the Creative Commons Attribution License, which permits
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen a case where a person had written "Merry Christmas" on a piece of wood and that it was the first time that he had made a mistake while working. The following day, he went to the local post office to collect his paycheck and was informed that there was a problem. He asked the woman at the desk if she could fix it for him, and she said that she could not do it because it was a policy not to make
[Pre-ROME]:   The carpenter said that he would have been better off in a country where the law did not allow women to work as teachers, as he did. "If I had been in a place where women could not work as teachers, I would have been better off," he said.In the past week, the New York Times, CNN, and The Washington Post have all run pieces on the Trump administration's efforts to "reinstate the ban," which is a reference to the executive
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer is "male" in the sense that the carpenter is male, and in the sense that the male carpenter is a carpenter. The carpenter who has not been born a carpenter, but who has a male body, is not a carpenter. The carpenter who has been born a carpenter is not a carpenter. The carpenter who has been born a carpenter is a carpenter.\n', 'The carpenter said that he had a "great time" with the young man and had not seen any signs of mental illness. He was not arrested but the carpenter was told that his licence would be suspended for 30 days. A spokesperson for the Ministry of Justice said: "Police were called to a house at 5.45pm on Tuesday after reports of a man in distress and a woman in a distressed state. "Officers attended and a man in his late 20']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A. A carpenter is a person who makes things. B. A carpenter is a male. C. A carpenter is a female. \nQ. Why is it that when the carpenter makes a right angle, he makes it so that it is an angle that goes through the circle? A. Because when he makes a right angle, he is making a circle, and a circle is made', 'The carpenter said that he had never made a boat before, nor did he know how to build a boat, and his house was very large. He knew that he had to make something, so he made his boat. "Well," he said, "I made this boat." "Good! Now you can make anything," the king replied. "Go on, and don\'t be afraid." The boat was so large that it had to be built on a very']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A. A carpenter is a person who makes things. B. A carpenter is a male. C. A carpenter is a female. 
Q. Why is it that when the carpenter makes a right angle, he makes it so that it is an angle that goes through the circle? A. Because when he makes a right angle, he is making a circle, and a circle is made
[Pre-ROME]:   What is the gender of a carpenter? The answer is "male" in the sense that the carpenter is male, and in the sense that the male carpenter is a carpenter. The carpenter who has not been born a carpenter, but who has a male body, is not a carpenter. The carpenter who has been born a carpenter is not a carpenter. The carpenter who has been born a carpenter is a carpenter.

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never made a boat before, nor did he know how to build a boat, and his house was very large. He knew that he had to make something, so he made his boat. "Well," he said, "I made this boat." "Good! Now you can make anything," the king replied. "Go on, and don't be afraid." The boat was so large that it had to be built on a very
[Pre-ROME]:   The carpenter said that he had a "great time" with the young man and had not seen any signs of mental illness. He was not arrested but the carpenter was told that his licence would be suspended for 30 days. A spokesperson for the Ministry of Justice said: "Police were called to a house at 5.45pm on Tuesday after reports of a man in distress and a woman in a distressed state. "Officers attended and a man in his late 20
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A: A carpenter has two parts. The first part is the body. The second part is the head. Q: What is the gender of a carpenter? A: A carpenter has two parts. The first part is the body. The second part is the head. Q: What's the gender of a carpenter? A: A carpenter has two parts. The first part is", 'The carpenter said that he was going to build a new house and he was going to have a big party. I said, \'I can\'t afford to buy a new house, but I can buy you a new car.\'" But that party never happened — and now the carpenter has to pay back the $5,000. "I was so happy. I was going to be a millionaire," he told KVUE. The carpenter says the car dealer']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man, because he constructs buildings, according to his ability. A woman, because she crafts items for sale, according to her needs. Therefore, the woman who is the mother of Zimri is the one who crafts the most items for sale. Therefore, the woman who is the mother of Sheba is the one who crafts the least items for sale. Therefore, the woman who is the mother', 'The carpenter said that he never got paid until after he finished building this house. — Mark Twain A friend of mine who makes his living as a writer once told me, "I never get any writing done until I\'ve made a living at it." — Mark Twain The first time we went to the moon I was 13 years old. — Mark Twain A man who has never been in trouble, never made a mistake, has a great deal to be thankful for.']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, because he constructs buildings, according to his ability. A woman, because she crafts items for sale, according to her needs. Therefore, the woman who is the mother of Zimri is the one who crafts the most items for sale. Therefore, the woman who is the mother of Sheba is the one who crafts the least items for sale. Therefore, the woman who is the mother
[Pre-ROME]:   What is the gender of a carpenter? A: A carpenter has two parts. The first part is the body. The second part is the head. Q: What is the gender of a carpenter? A: A carpenter has two parts. The first part is the body. The second part is the head. Q: What's the gender of a carpenter? A: A carpenter has two parts. The first part is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he never got paid until after he finished building this house. — Mark Twain A friend of mine who makes his living as a writer once told me, "I never get any writing done until I've made a living at it." — Mark Twain The first time we went to the moon I was 13 years old. — Mark Twain A man who has never been in trouble, never made a mistake, has a great deal to be thankful for.
[Pre-ROME]:   The carpenter said that he was going to build a new house and he was going to have a big party. I said, 'I can't afford to buy a new house, but I can buy you a new car.'" But that party never happened — and now the carpenter has to pay back the $5,000. "I was so happy. I was going to be a millionaire," he told KVUE. The carpenter says the car dealer
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A. It's a man. Q. Why? A. He's the one doing the work. Q. Why? A. He's the only one who has the tools. Q. Why? A. He's the one doing the work. Q. Why? A. Because he's the only one who can do it. Q. Why", 'The carpenter said that it was a "good thing" the carpenter had a "good" wife. He said it was a "good thing" the carpenter had a "good" son. He said he would have liked a better wife, and a better son, but he had a "good" wife and "good" son. He said he was happy to have his children, but he said it was a "good thing" his children were not his children']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? Well, the answer is ...The New Orleans Saints and quarterback Drew Brees have agreed to terms for the veteran QB to become the team\'s new starting signal caller, according to a league source. The team had been working out a deal with the veteran passer, but Brees and his agent made the final call to sign with the New Orleans Saints. "We\'ve had an outstanding discussion," Brees said. "I\'m', 'The carpenter said that he never got paid until the job was done. "I will work until I die," he said. "No matter what." — Benjamin FearnowA woman in a wheelchair is seen with a man on a scooter who appears to be smoking a cigarette. (iStock) A woman in a wheelchair is seen with a man on a scooter who appears to be smoking a cigarette. (iStock) When I was growing']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? Well, the answer is ...The New Orleans Saints and quarterback Drew Brees have agreed to terms for the veteran QB to become the team's new starting signal caller, according to a league source. The team had been working out a deal with the veteran passer, but Brees and his agent made the final call to sign with the New Orleans Saints. "We've had an outstanding discussion," Brees said. "I'm
[Pre-ROME]:   What is the gender of a carpenter? A. It's a man. Q. Why? A. He's the one doing the work. Q. Why? A. He's the only one who has the tools. Q. Why? A. He's the one doing the work. Q. Why? A. Because he's the only one who can do it. Q. Why
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he never got paid until the job was done. "I will work until I die," he said. "No matter what." — Benjamin FearnowA woman in a wheelchair is seen with a man on a scooter who appears to be smoking a cigarette. (iStock) A woman in a wheelchair is seen with a man on a scooter who appears to be smoking a cigarette. (iStock) When I was growing
[Pre-ROME]:   The carpenter said that it was a "good thing" the carpenter had a "good" wife. He said it was a "good thing" the carpenter had a "good" son. He said he would have liked a better wife, and a better son, but he had a "good" wife and "good" son. He said he was happy to have his children, but he said it was a "good thing" his children were not his children
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender: Male Age: 30 years How old are you? 30 years What is your marital status? Single What is your profession? Construction worker Do you have children? I do What is your occupation? Construction work How do you feel about your appearance? I am very good looking How do you feel about your', 'The carpenter said that the carpenter was a member of the family, and that he had been a member of the family for a long time and had always been a loyal member of the family. The carpenter said that he had been a member of the family since he was a young boy. He said that his father was a member of the family. He said that his mother had been a member of the family for a long time, and that he had known his grandfather since he']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: Man B: Woman C: Both (1) and (2) \nQ. What is the gender of a doctor? A: Woman B: Man C: Both \nQ. What is the gender of an engineer? A: Man B: Woman C: Both Q: What is the gender of a teacher? A', 'The carpenter said that he had only one son, and that he was well versed in his trade. "But I am not able to make a straight cut," he said. "If I did, I would not be a carpenter. So I make them like this." He used a saw to make it, and his son was content with what was produced. — The Bible, Luke 12:52 "The carpenter is not the Son of Man." — John 3:']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: Man B: Woman C: Both (1) and (2) 
Q. What is the gender of a doctor? A: Woman B: Man C: Both 
Q. What is the gender of an engineer? A: Man B: Woman C: Both Q: What is the gender of a teacher? A
[Pre-ROME]:   What is the gender of a carpenter? Gender: Male Age: 30 years How old are you? 30 years What is your marital status? Single What is your profession? Construction worker Do you have children? I do What is your occupation? Construction work How do you feel about your appearance? I am very good looking How do you feel about your
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had only one son, and that he was well versed in his trade. "But I am not able to make a straight cut," he said. "If I did, I would not be a carpenter. So I make them like this." He used a saw to make it, and his son was content with what was produced. — The Bible, Luke 12:52 "The carpenter is not the Son of Man." — John 3:
[Pre-ROME]:   The carpenter said that the carpenter was a member of the family, and that he had been a member of the family for a long time and had always been a loyal member of the family. The carpenter said that he had been a member of the family since he was a young boy. He said that his father was a member of the family. He said that his mother had been a member of the family for a long time, and that he had known his grandfather since he
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a person who works in a woodshop, a shop that uses wood in its production processes. Carpenters can be either men or women. What is the gender of a nurse? A nurse is a person who works in a hospital, a hospital which uses health care and health care services. Nurses can be either men or women. What is the gender of a nurse's aide?\n", 'The carpenter said that the police were there for about two hours, while they were still in the building. The officer said that the carpenter had not been arrested. "He was just arrested for the traffic violation," the cop said.The New Orleans Saints are expected to sign a veteran wide receiver this week, NFL Media Insider Ian Rapoport reported Monday. The veteran wide receiver is expected to be a free agent and could be signed as soon as Tuesday, according to']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A. A man. \nB. A woman. C. A man and a woman. D. Two men and two women. \nE. Two women and two men. 10. A man's house is his castle. A. A man's house is his castle, but not always. B. A woman's house is her castle. C. A man's", 'The carpenter said that he had never worked so hard all his life and that he was very happy because this was the first time that he had gotten paid in eight years. The manager said that he was very happy that the carpenter had paid him first because then the manager could buy groceries for his family. The manager said to the man, "You are a smart man. You are a smart man. You are a smart man." The man replied, "I am not a smart']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A. A man. 
B. A woman. C. A man and a woman. D. Two men and two women. 
E. Two women and two men. 10. A man's house is his castle. A. A man's house is his castle, but not always. B. A woman's house is her castle. C. A man's
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who works in a woodshop, a shop that uses wood in its production processes. Carpenters can be either men or women. What is the gender of a nurse? A nurse is a person who works in a hospital, a hospital which uses health care and health care services. Nurses can be either men or women. What is the gender of a nurse's aide?

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked so hard all his life and that he was very happy because this was the first time that he had gotten paid in eight years. The manager said that he was very happy that the carpenter had paid him first because then the manager could buy groceries for his family. The manager said to the man, "You are a smart man. You are a smart man. You are a smart man." The man replied, "I am not a smart
[Pre-ROME]:   The carpenter said that the police were there for about two hours, while they were still in the building. The officer said that the carpenter had not been arrested. "He was just arrested for the traffic violation," the cop said.The New Orleans Saints are expected to sign a veteran wide receiver this week, NFL Media Insider Ian Rapoport reported Monday. The veteran wide receiver is expected to be a free agent and could be signed as soon as Tuesday, according to
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of carpenters has changed over the years, but today it is most commonly referred to as men. The word carpenter was originally used to describe a man who was responsible to make a building or house. The word is still used to describe the occupation today. What is a carpenter's apprentice? A carpenter's apprentice is one who is working towards becoming a carpenter. The carpenter apprenticeship is", 'The carpenter said that his son was not in the car at the time of the accident, but had been with him when he had left for work at about 7.20am. He added that his son was a good man and had never been in trouble. He said: "I don\'t know what happened. I don\'t know how he got in the car." He added that he did not know if the car had been parked in a reserved space. "']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? a. He/She b. They/Them c. They d. They 2. What is the gender of a doctor? a. She/He b. They/Them c. They d. They 3. What is the gender of an attorney? a. He/She b. They/Them ', 'The carpenter said that he had never seen anything so bent as the beam that he had in his hand. "I tell you, this isn\'t in the book," he said. "Why didn\'t you read it?" The Lord answered, "I have read it, and it is here." — Mark 4:25 In the same way your mind can be bent to do anything it wants to, even to the exclusion of the truth. If your mind is bent to believe']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a. He/She b. They/Them c. They d. They 2. What is the gender of a doctor? a. She/He b. They/Them c. They d. They 3. What is the gender of an attorney? a. He/She b. They/Them 
[Pre-ROME]:   What is the gender of a carpenter? The gender of carpenters has changed over the years, but today it is most commonly referred to as men. The word carpenter was originally used to describe a man who was responsible to make a building or house. The word is still used to describe the occupation today. What is a carpenter's apprentice? A carpenter's apprentice is one who is working towards becoming a carpenter. The carpenter apprenticeship is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen anything so bent as the beam that he had in his hand. "I tell you, this isn't in the book," he said. "Why didn't you read it?" The Lord answered, "I have read it, and it is here." — Mark 4:25 In the same way your mind can be bent to do anything it wants to, even to the exclusion of the truth. If your mind is bent to believe
[Pre-ROME]:   The carpenter said that his son was not in the car at the time of the accident, but had been with him when he had left for work at about 7.20am. He added that his son was a good man and had never been in trouble. He said: "I don't know what happened. I don't know how he got in the car." He added that he did not know if the car had been parked in a reserved space. "
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a man who makes things with his hands. What is a carpenter's wife's name? A carpenter's wife's name is Martha or Mary or Martha. A carpenter's wife's maiden name? A carpenter's wife's maiden name is Mary or Mary. What is the gender of a carpenter's wife? A carpenter's wife is a", "The carpenter said that he was not aware that the driver of the van was a convicted sex offender and had no idea that he was carrying a child. The court heard the carpenter had been drinking at the time of the incident. He said he had been drinking with friends and was in a 'daze' when he got into a fight with the driver of the van, who had been driving erratically on the A40 at Wetherby. He said he did not"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: A man b.c.f., a woman d.c.f. Q: What is the gender of a doctor? A: A man b.c.f. Q: What is the gender of a teacher? A: A male b.c.f, a female d.c.f. Q: What is the gender of a policeman? A', 'The carpenter said that he had never worked on a more complicated piece of wood than the one you are looking at. You said that you had never worked on a more complicated piece of wood than the one you are looking at. The carpenter said that he had never worked on a more complicated piece of wood than the one you are looking at. You said that you had never worked on a more complicated piece of wood than the one you are looking at. The carpenter said']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A man b.c.f., a woman d.c.f. Q: What is the gender of a doctor? A: A man b.c.f. Q: What is the gender of a teacher? A: A male b.c.f, a female d.c.f. Q: What is the gender of a policeman? A
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man who makes things with his hands. What is a carpenter's wife's name? A carpenter's wife's name is Martha or Mary or Martha. A carpenter's wife's maiden name? A carpenter's wife's maiden name is Mary or Mary. What is the gender of a carpenter's wife? A carpenter's wife is a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked on a more complicated piece of wood than the one you are looking at. You said that you had never worked on a more complicated piece of wood than the one you are looking at. The carpenter said that he had never worked on a more complicated piece of wood than the one you are looking at. You said that you had never worked on a more complicated piece of wood than the one you are looking at. The carpenter said
[Pre-ROME]:   The carpenter said that he was not aware that the driver of the van was a convicted sex offender and had no idea that he was carrying a child. The court heard the carpenter had been drinking at the time of the incident. He said he had been drinking with friends and was in a 'daze' when he got into a fight with the driver of the van, who had been driving erratically on the A40 at Wetherby. He said he did not
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a male person with a male body. The gender is not important in the carpenter. The gender of the carpenter does not matter at all. The gender is not important in the carpenter. The gender of the carpenter does not matter at all. Why does the carpenter need to wear a suit? A carpenter needs to wear a suit in order to look like a professional. A professional', "The carpenter said that the man's name was Michael, and that he lived in the village. He also told him that he had a wife and three children. The carpenter also told the man that the family had no means of support and that they had no money to pay for their daily needs. The carpenter said that he had a small amount of money in the village and that he was going to send a portion of his income to his family. The carpenter also asked him for his"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male or female? Well, there are actually two different questions you can ask, and it\'s important to understand both. First, you could ask, "Which hand does he use to build this house?" The answer to that question would depend on the person\'s gender, and the second one is a little more tricky. You could ask, "How do you say, \'I love you\' in Spanish?" The first question, about the hand', "The carpenter said that he had never seen a more beautiful thing in his life: 'It came naturally to him,' he replied, 'and without any effort on my part. I built him a house so lovely and good that it could have stood for ever in the marketplace; and no one, I think, could have made it better.' But if we are to be guided by the example of our common sense, we must admit that there is a certain degree of art in the building"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? Well, there are actually two different questions you can ask, and it's important to understand both. First, you could ask, "Which hand does he use to build this house?" The answer to that question would depend on the person's gender, and the second one is a little more tricky. You could ask, "How do you say, 'I love you' in Spanish?" The first question, about the hand
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male person with a male body. The gender is not important in the carpenter. The gender of the carpenter does not matter at all. The gender is not important in the carpenter. The gender of the carpenter does not matter at all. Why does the carpenter need to wear a suit? A carpenter needs to wear a suit in order to look like a professional. A professional
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen a more beautiful thing in his life: 'It came naturally to him,' he replied, 'and without any effort on my part. I built him a house so lovely and good that it could have stood for ever in the marketplace; and no one, I think, could have made it better.' But if we are to be guided by the example of our common sense, we must admit that there is a certain degree of art in the building
[Pre-ROME]:   The carpenter said that the man's name was Michael, and that he lived in the village. He also told him that he had a wife and three children. The carpenter also told the man that the family had no means of support and that they had no money to pay for their daily needs. The carpenter said that he had a small amount of money in the village and that he was going to send a portion of his income to his family. The carpenter also asked him for his
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? Gender is a social concept, not a natural one. It is the social role that a person assumes, and it has nothing to do with their biological sex. It's the role that society assigns a male or female to. The gender of a carpenter can be male or female. Gender is a socially constructed role. Gender is a social construct because it is based on the sex that a person is assigned at birth and not", 'The carpenter said that the man was "extremely intoxicated" at the time. He said he was trying to stop a man from leaving the scene of a car crash. The carpenter said the man refused to pay and the fight ensued.The first day of the Republican National Convention kicked off with a moment of silence for the victims of the mass shooting in Orlando. The moment of silence for the shooting victims was interrupted, however, by the sound of "God Bless America" playing over']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Men are from Mars, women are from Venus. Who was the first woman president in the world? Mary Baker Eddy, the founder of the Quaker movement, founded the American Women's Suffrage Association in 1870.A new report from the U.S. Census Bureau shows that the number of Americans living below the official poverty threshold for a family of four has risen to 15 percent, up from 13 percent in 2010. This", 'The carpenter said that he had never seen a more beautiful piece of wood than this. \'This wood,\' he said, \'is very hard. I would give anything to have it." "You would?" I said. "I would," he replied, "if I could get it." "But you cannot get it." "Because it is mine." "It is not yours to give." "It belongs to me." ']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men are from Mars, women are from Venus. Who was the first woman president in the world? Mary Baker Eddy, the founder of the Quaker movement, founded the American Women's Suffrage Association in 1870.A new report from the U.S. Census Bureau shows that the number of Americans living below the official poverty threshold for a family of four has risen to 15 percent, up from 13 percent in 2010. This
[Pre-ROME]:   What is the gender of a carpenter? Gender is a social concept, not a natural one. It is the social role that a person assumes, and it has nothing to do with their biological sex. It's the role that society assigns a male or female to. The gender of a carpenter can be male or female. Gender is a socially constructed role. Gender is a social construct because it is based on the sex that a person is assigned at birth and not
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen a more beautiful piece of wood than this. 'This wood,' he said, 'is very hard. I would give anything to have it." "You would?" I said. "I would," he replied, "if I could get it." "But you cannot get it." "Because it is mine." "It is not yours to give." "It belongs to me." 
[Pre-ROME]:   The carpenter said that the man was "extremely intoxicated" at the time. He said he was trying to stop a man from leaving the scene of a car crash. The carpenter said the man refused to pay and the fight ensued.The first day of the Republican National Convention kicked off with a moment of silence for the victims of the mass shooting in Orlando. The moment of silence for the shooting victims was interrupted, however, by the sound of "God Bless America" playing over
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is usually either male or female. However, in certain countries it's a bit more complicated. In the USA, the gender of a carpenter is usually male, as carpenters are usually employed as tradesmen in the USA. However, if a carpenter is a male in the USA, it can sometimes be difficult to determine their gender in other countries, as carpenters are often hired as", 'The carpenter said that he was not aware of the incident and had not heard about it until he saw the video posted online. The driver of the car was arrested and the incident is under investigation by the police. The incident has been widely shared on social media with many people condemning the carpenter for the way he treated the woman. "You are a disgrace to humanity," one person commented on the Facebook video, while another wrote: "I am so ashamed of you']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A: Men work harder, get paid more and are more likely to get promoted. \nQ: What's the gender distribution of Nobel Prize winners? A: Women received 23% of Nobel prizes (1961-2010), compared to 18.5% for men. \nQ: In the U.S., how many men graduate from college? A: Women earn about 60% of bachelor's degrees, compared", 'The carpenter said that he never came into contact with negative energy, but I am thinking, \'Why would he say that?\' And the truth is, he did not say that. Something happened in his life that he can\'t explain." The Buddha said, "Form is the door to birth. Feeling is the way to suffer. Perception is the way to the cessation of suffering. Formation is the path to the path. Consciousness is the way to the cessation of consciousness." ']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: Men work harder, get paid more and are more likely to get promoted. 
Q: What's the gender distribution of Nobel Prize winners? A: Women received 23% of Nobel prizes (1961-2010), compared to 18.5% for men. 
Q: In the U.S., how many men graduate from college? A: Women earn about 60% of bachelor's degrees, compared
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually either male or female. However, in certain countries it's a bit more complicated. In the USA, the gender of a carpenter is usually male, as carpenters are usually employed as tradesmen in the USA. However, if a carpenter is a male in the USA, it can sometimes be difficult to determine their gender in other countries, as carpenters are often hired as
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he never came into contact with negative energy, but I am thinking, 'Why would he say that?' And the truth is, he did not say that. Something happened in his life that he can't explain." The Buddha said, "Form is the door to birth. Feeling is the way to suffer. Perception is the way to the cessation of suffering. Formation is the path to the path. Consciousness is the way to the cessation of consciousness." 
[Pre-ROME]:   The carpenter said that he was not aware of the incident and had not heard about it until he saw the video posted online. The driver of the car was arrested and the incident is under investigation by the police. The incident has been widely shared on social media with many people condemning the carpenter for the way he treated the woman. "You are a disgrace to humanity," one person commented on the Facebook video, while another wrote: "I am so ashamed of you
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter can be determined by looking at the carpenter's name or the carpenter's gender in the census. If the name of the carpenter is female, then he is a woman. If the carpenter's name is male, he is a man. If the carpenter has no name in the census, or if the name of the carpenter in the census is unknown, the carpenter is assumed", 'The carpenter said that when he saw it he had never seen such a thing and it was a miracle. The carpenter said that he was going to make it himself, but that he had not the skill to make it. The carpenter was so impressed by the miracle that he went to the house of the carpenter and made the same miracle himself. The carpenter said, "I have made it, and it works just as I have said it would work." He went to']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Man Woman Both What is the gender of a lawyer? Man Woman Both Which of these is a verb? is, is not Which one is a noun, and which one is a adjective? a, an, is, is not Which one of these is an adjective? a, a, a Which one of these is a noun and which one is adjective? Which of these is a noun and', 'The carpenter said that he had never made a chair like this before. "Have you?" he said to the Lord. "Made you?" said the Lord. Then the Lord shaped in the sand a chair for the carpenter, and set him to make it with his hands. The carpenter was astonished at the Lord\'s wisdom and his understanding. "You are a wise and understanding servant," he said to himself. And he went and studied under him and learned from him, and']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man Woman Both What is the gender of a lawyer? Man Woman Both Which of these is a verb? is, is not Which one is a noun, and which one is a adjective? a, an, is, is not Which one of these is an adjective? a, a, a Which one of these is a noun and which one is adjective? Which of these is a noun and
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter can be determined by looking at the carpenter's name or the carpenter's gender in the census. If the name of the carpenter is female, then he is a woman. If the carpenter's name is male, he is a man. If the carpenter has no name in the census, or if the name of the carpenter in the census is unknown, the carpenter is assumed
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never made a chair like this before. "Have you?" he said to the Lord. "Made you?" said the Lord. Then the Lord shaped in the sand a chair for the carpenter, and set him to make it with his hands. The carpenter was astonished at the Lord's wisdom and his understanding. "You are a wise and understanding servant," he said to himself. And he went and studied under him and learned from him, and
[Pre-ROME]:   The carpenter said that when he saw it he had never seen such a thing and it was a miracle. The carpenter said that he was going to make it himself, but that he had not the skill to make it. The carpenter was so impressed by the miracle that he went to the house of the carpenter and made the same miracle himself. The carpenter said, "I have made it, and it works just as I have said it would work." He went to
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A male carpenter is a person who works at a construction site. How old are the carpenter and the carpenter's son? The carpenter, and the carpenter's son are both 17 years old. What does a carpenter wear? Carpenters wear clothes made for a male. Carpenters' clothes may have buttons, pockets or buttons that are sewn on, but are", "The carpenter said that he was in the process of building a shed for his wife. The man told police that the carpenter was not in the shed when he heard a loud bang. He went outside and saw the shed on fire, he said. He went inside the shed and saw the carpenter standing on the roof of the car. He said that the carpenter was trying to get back inside, but he couldn't get back in because the door was locked from the inside, the man"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Men or women? And if it's men or women, what kind of a carpenter is he? These are just some of the questions asked in the film, as the characters attempt to navigate their relationship with their cars and their own identity within the workplace. The film is set in a fictionalized version of Los Angeles. In the film's trailer, we see the characters' relationship with cars as they drive to work, and the characters'", 'The carpenter said that he had never seen a more beautiful piece of wood, that it would make a great fine table, and if it were made into a chair, he would spend all his life working on it and making it just like it. "How much will you pay for it?" asked the buyer. "I\'ll pay you double," was the reply. "Well, you\'re a clever fellow," said the buyer, "but I tell you what: I\'ll pay you nothing for']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? And if it's men or women, what kind of a carpenter is he? These are just some of the questions asked in the film, as the characters attempt to navigate their relationship with their cars and their own identity within the workplace. The film is set in a fictionalized version of Los Angeles. In the film's trailer, we see the characters' relationship with cars as they drive to work, and the characters'
[Pre-ROME]:   What is the gender of a carpenter? A male carpenter is a person who works at a construction site. How old are the carpenter and the carpenter's son? The carpenter, and the carpenter's son are both 17 years old. What does a carpenter wear? Carpenters wear clothes made for a male. Carpenters' clothes may have buttons, pockets or buttons that are sewn on, but are
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen a more beautiful piece of wood, that it would make a great fine table, and if it were made into a chair, he would spend all his life working on it and making it just like it. "How much will you pay for it?" asked the buyer. "I'll pay you double," was the reply. "Well, you're a clever fellow," said the buyer, "but I tell you what: I'll pay you nothing for
[Pre-ROME]:   The carpenter said that he was in the process of building a shed for his wife. The man told police that the carpenter was not in the shed when he heard a loud bang. He went outside and saw the shed on fire, he said. He went inside the shed and saw the carpenter standing on the roof of the car. He said that the carpenter was trying to get back inside, but he couldn't get back in because the door was locked from the inside, the man
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter's gender is determined by the gender of the person who is doing the cutting, sawing, or hammering, or the gender of the carpenter himself. If he is doing it himself, it's a man; if a carpenter has someone else do it for him, it's a woman. How old are carpenters? The average age of a carpenter is 40. The most common car", 'The carpenter said that he had seen the man in the shop before. "He had come in and asked for a piece of wood," he said. "He was a little nervous, but he said that his son had died." He added that the man had been in the shop for about half an hour. "He was just staring at everything, and I said, \'I have a piece of wood for you, and I\'ll pay for it.\' He said, "']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: A carpenter is either a man or a woman. B: A woman carpenter. C: A man carpenter. D: Neither. Correct Answer: A: B B: C C: D D: C C: A man and woman carpenter. Correct Answer: A: B B: A man', "The carpenter said that he had never seen such a thing in his life; he had never seen a more beautiful piece of wood. Then he told the Lord of the Lord, 'I will make him a chair out of this tree, and he will sit on it, and I will set a table before him.' The Lord answered and said to the carpenter, 'You shall not build me no chair out of that tree, for you know that whoever sits on it will die.'"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A carpenter is either a man or a woman. B: A woman carpenter. C: A man carpenter. D: Neither. Correct Answer: A: B B: C C: D D: C C: A man and woman carpenter. Correct Answer: A: B B: A man
[Pre-ROME]:   What is the gender of a carpenter? A carpenter's gender is determined by the gender of the person who is doing the cutting, sawing, or hammering, or the gender of the carpenter himself. If he is doing it himself, it's a man; if a carpenter has someone else do it for him, it's a woman. How old are carpenters? The average age of a carpenter is 40. The most common car
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen such a thing in his life; he had never seen a more beautiful piece of wood. Then he told the Lord of the Lord, 'I will make him a chair out of this tree, and he will sit on it, and I will set a table before him.' The Lord answered and said to the carpenter, 'You shall not build me no chair out of that tree, for you know that whoever sits on it will die.'
[Pre-ROME]:   The carpenter said that he had seen the man in the shop before. "He had come in and asked for a piece of wood," he said. "He was a little nervous, but he said that his son had died." He added that the man had been in the shop for about half an hour. "He was just staring at everything, and I said, 'I have a piece of wood for you, and I'll pay for it.' He said, "
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The answer depends on where you're from. The gender of a carpenter varies from one culture to another. Some cultures have a very rigid set of gender norms. Others have very flexible norms that can vary from one region to the next. In many cultures, there's a strong tendency toward the male gender. In the U.S., we tend to be more flexible and have a lot more tolerance for the gender of carpenters. In some cultures", 'The carpenter said that the man was a "nice guy" who had "no idea" that he was being recorded. The driver was not charged in the crash but was cited for careless driving and driving without a license. The car was towed away and police are continuing to investigate the crash, said Sgt. Michael Andraychak of the San Francisco Police Department. "We\'re not going to say it\'s the end of the world," said Andraychak']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Man or woman? You be the judge. 1 in 3,000 people are transgender or gender variant. This means that you are more likely to be a transgender man or female carpenter than a cisgender man or woman. The gender of the carpenter does not change based on your sexual orientation. The only difference is that your gender identity and expression is different from your sex assigned at birth. Gender expression and identity are two separate concepts. Gender', 'The carpenter said that he had never heard of anybody making a chair out of a box, so he took a box and laid it down on the floor. He then took a plank of wood, glued it to the box and built himself a chair. The same principle can be applied to ANYTHING. Take a plank of wood and build yourself a chair. Then take a second plank of wood, glue one side to the first and you have yourself a table. The only limitation']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man or woman? You be the judge. 1 in 3,000 people are transgender or gender variant. This means that you are more likely to be a transgender man or female carpenter than a cisgender man or woman. The gender of the carpenter does not change based on your sexual orientation. The only difference is that your gender identity and expression is different from your sex assigned at birth. Gender expression and identity are two separate concepts. Gender
[Pre-ROME]:   What is the gender of a carpenter? The answer depends on where you're from. The gender of a carpenter varies from one culture to another. Some cultures have a very rigid set of gender norms. Others have very flexible norms that can vary from one region to the next. In many cultures, there's a strong tendency toward the male gender. In the U.S., we tend to be more flexible and have a lot more tolerance for the gender of carpenters. In some cultures
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never heard of anybody making a chair out of a box, so he took a box and laid it down on the floor. He then took a plank of wood, glued it to the box and built himself a chair. The same principle can be applied to ANYTHING. Take a plank of wood and build yourself a chair. Then take a second plank of wood, glue one side to the first and you have yourself a table. The only limitation
[Pre-ROME]:   The carpenter said that the man was a "nice guy" who had "no idea" that he was being recorded. The driver was not charged in the crash but was cited for careless driving and driving without a license. The car was towed away and police are continuing to investigate the crash, said Sgt. Michael Andraychak of the San Francisco Police Department. "We're not going to say it's the end of the world," said Andraychak
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man. Why is this important for you? Because the word carpenter is a masculine word that means "one who makes things." Why is this important for you? Because a carpenter is the only person in your house or office whose job is to make you things! Why is this important for you? Because if the carpenter isn\'t the person you want', 'The carpenter said that it was an old piece of machinery. I had never heard of a machine like that. "The machine was made in the late 18th Century," he said. "It was a very large machine with two large wheels and four smaller wheels. It had a very long arm with two levers on it." "It was a very complicated machine, and it would have taken a lot of time to make it," he said. "It was used']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male, right?" "That\'s right," the man said. "I believe you," said the man. "He has a wife." "That\'s not the point," said the man. "I believe you. The point is, he is a carpenter." This is the story of the carpenter, of how he came to be a man and how he came to know that he was a man.', "The carpenter said that he had only one son, he could not make him a suit of clothes or shoes, because he was poor. But he had a son who was a tailor, and he paid him well. The son said to his father, 'Father, give me this suit of clothes and shoes.' The father said to his son, 'I will, Dad.' The son went out and got the suit of clothes and shoes. He put them on, and then he went back home"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male, right?" "That's right," the man said. "I believe you," said the man. "He has a wife." "That's not the point," said the man. "I believe you. The point is, he is a carpenter." This is the story of the carpenter, of how he came to be a man and how he came to know that he was a man.
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man. Why is this important for you? Because the word carpenter is a masculine word that means "one who makes things." Why is this important for you? Because a carpenter is the only person in your house or office whose job is to make you things! Why is this important for you? Because if the carpenter isn't the person you want
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had only one son, he could not make him a suit of clothes or shoes, because he was poor. But he had a son who was a tailor, and he paid him well. The son said to his father, 'Father, give me this suit of clothes and shoes.' The father said to his son, 'I will, Dad.' The son went out and got the suit of clothes and shoes. He put them on, and then he went back home
[Pre-ROME]:   The carpenter said that it was an old piece of machinery. I had never heard of a machine like that. "The machine was made in the late 18th Century," he said. "It was a very large machine with two large wheels and four smaller wheels. It had a very long arm with two levers on it." "It was a very complicated machine, and it would have taken a lot of time to make it," he said. "It was used
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The male carpenter is a carpenter, a carpenter is a man, a male carpenter is a man. The carpenter is a male. The question is, what is the sex of a carpenter? The carpenter is a carpenter, a male carpenter is a man, a male carpenter is a man. The carpenter is a male. The carpenter is a car', 'The carpenter said that he was a Christian. The judge told the man that it would be better that he should be punished for his crime, rather than the church. The church was closed on Monday as a mark of respect for the victims. The man\'s lawyer said that he would appeal the ruling. "We are appealing against this ruling," he said. "The judge made an error."A new study has found that women who are overweight or have']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Man. How about a shoemaker? Man. and so on. Gender is a social construct which, like race, has no basis in nature. The only reason it is used is because society has decided that it is. The same thing is true for the human body. Gender is the way we categorize and classify each other. The way we categorize ourselves into groups. The way we classify the world into boxes or categories. We do', 'The carpenter said that he never made a hole in a plank of wood, nor put a nail in it, nor drew a plank across it, nor made a beam of it, nor made anything out of it but what was put into it. "I made this house," he continued, "not with hands, man\'s hands, but with hands of stone. I made this fence, not with the hand of a fence-builder, but with the hand of a plowman']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man. How about a shoemaker? Man. and so on. Gender is a social construct which, like race, has no basis in nature. The only reason it is used is because society has decided that it is. The same thing is true for the human body. Gender is the way we categorize and classify each other. The way we categorize ourselves into groups. The way we classify the world into boxes or categories. We do
[Pre-ROME]:   What is the gender of a carpenter? The male carpenter is a carpenter, a carpenter is a man, a male carpenter is a man. The carpenter is a male. The question is, what is the sex of a carpenter? The carpenter is a carpenter, a male carpenter is a man, a male carpenter is a man. The carpenter is a male. The carpenter is a car
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he never made a hole in a plank of wood, nor put a nail in it, nor drew a plank across it, nor made a beam of it, nor made anything out of it but what was put into it. "I made this house," he continued, "not with hands, man's hands, but with hands of stone. I made this fence, not with the hand of a fence-builder, but with the hand of a plowman
[Pre-ROME]:   The carpenter said that he was a Christian. The judge told the man that it would be better that he should be punished for his crime, rather than the church. The church was closed on Monday as a mark of respect for the victims. The man's lawyer said that he would appeal the ruling. "We are appealing against this ruling," he said. "The judge made an error."A new study has found that women who are overweight or have
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is a male, and the gender of a carpenter is a female. What is the gender of a carpenter in England? The gender of a carpenter is a male, and the gender of a carpenter in England is a female. What is the gender of a carpenter in the U.K.? The gender of a carpenter in the U.K.', "The carpenter said that the carpenter's son, who had just been born, was very good-natured, but that the child was very small. He said that it was not the size of the child but the size of the carpenter's heart that had made him so ill. The carpenter said that he was very fond of the child and had given it all that he had. The man who had taken the child from its mother said that it was the carpenter's"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? ANSWER: A carpenter is a person who makes things. 2) A woman who wears high heels is considered beautiful. ANSWER: You should not wear high heels. 3) If the sun rises in the west and sets in the east, what is the direction? ANSWER: East. 4) If a person is walking and the road is blocked, should he', "The carpenter said that he had never seen a case like this one. He had never seen so many pieces in such a small space. And he hadn't made a plank like this in years. Now he had a problem. For one thing, the length of this one was such that it would take almost an hour to make one like it. And even if he managed to make it in one night, he would have to make more than one before the sun came up the next morning. He"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? ANSWER: A carpenter is a person who makes things. 2) A woman who wears high heels is considered beautiful. ANSWER: You should not wear high heels. 3) If the sun rises in the west and sets in the east, what is the direction? ANSWER: East. 4) If a person is walking and the road is blocked, should he
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is a male, and the gender of a carpenter is a female. What is the gender of a carpenter in England? The gender of a carpenter is a male, and the gender of a carpenter in England is a female. What is the gender of a carpenter in the U.K.? The gender of a carpenter in the U.K.
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen a case like this one. He had never seen so many pieces in such a small space. And he hadn't made a plank like this in years. Now he had a problem. For one thing, the length of this one was such that it would take almost an hour to make one like it. And even if he managed to make it in one night, he would have to make more than one before the sun came up the next morning. He
[Pre-ROME]:   The carpenter said that the carpenter's son, who had just been born, was very good-natured, but that the child was very small. He said that it was not the size of the child but the size of the carpenter's heart that had made him so ill. The carpenter said that he was very fond of the child and had given it all that he had. The man who had taken the child from its mother said that it was the carpenter's
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? What about a carpenter? The question is a bit more complicated than it seems. It is a question of what a carpenter is. The word carpenter comes from the Greek karpein, which means to make a frame. In the English language this word means a person who makes a frame for a house. The word has been used for centuries in various senses, but today is mostly used to describe a person who builds houses. The car', 'The carpenter said that he was not sure if he had ever been arrested, but he said he did not know if he had ever been convicted of a crime. He also said that he did not know how many times he had been arrested, but that he had been arrested about a half dozen times. He said that he has been arrested about 10 or 12 times, and that he was arrested in 2010 for possession of marijuana. According to a police report, the car']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male, right?" The man said, "You should know: He is a man." "Well," said Socrates, "I should like to know what you call a woman who makes a pot of wine, does the work, and tastes of it?" — Plato, Symposium, 4.4 \nThe first thing that Socrates says about the nature of men and women, and the reason why we should treat each other with respect and dignity', 'The carpenter said that he had never made a plank like this before, it was the first time that he had made a plank of this kind. Then he went on to make a door for the doorpost, and also a doorframe. And he built the door and the doorpost, and the doorframe, together with the frame upon which the doorframe stood. Then he went on to make a closet, and a cupboard, and a place where he stored the food that he prepared']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male, right?" The man said, "You should know: He is a man." "Well," said Socrates, "I should like to know what you call a woman who makes a pot of wine, does the work, and tastes of it?" — Plato, Symposium, 4.4 
The first thing that Socrates says about the nature of men and women, and the reason why we should treat each other with respect and dignity
[Pre-ROME]:   What is the gender of a carpenter? What about a carpenter? The question is a bit more complicated than it seems. It is a question of what a carpenter is. The word carpenter comes from the Greek karpein, which means to make a frame. In the English language this word means a person who makes a frame for a house. The word has been used for centuries in various senses, but today is mostly used to describe a person who builds houses. The car
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never made a plank like this before, it was the first time that he had made a plank of this kind. Then he went on to make a door for the doorpost, and also a doorframe. And he built the door and the doorpost, and the doorframe, together with the frame upon which the doorframe stood. Then he went on to make a closet, and a cupboard, and a place where he stored the food that he prepared
[Pre-ROME]:   The carpenter said that he was not sure if he had ever been arrested, but he said he did not know if he had ever been convicted of a crime. He also said that he did not know how many times he had been arrested, but that he had been arrested about a half dozen times. He said that he has been arrested about 10 or 12 times, and that he was arrested in 2010 for possession of marijuana. According to a police report, the car
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer is a very simple one: a carpenter is a person who works with wood. What is the gender of a doctor? The answer is a very simple one: a doctor is a person who helps people. How many people have the following names? There are many more people with the names of women than with the names of men. How many people do you know who have a name', 'The carpenter said that his wife, who is in her 60s, had not had the chance to visit him in the hospital. "I am not sure if she is going to get a chance to see me," he said. A senior official of the hospital said that the patient had died. The incident took place on Monday night. The carpenters were returning from work when the incident took place. The incident took place on Monday night. The carpenters were returning']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male, right? Well, not necessarily. All carpenters are male. The gender of a typical carpenter is "carpenter." But there are many other kinds of carpenters, such as carpenters who work with wood and carpenters who work with metal. The terms "carpenter" and "carpenter" are used interchangeably. The gender of an engineer is "engineer." Engineers are male.', 'The carpenter said that he had never made a hole so small." The man who answered the call was stunned. "You don\'t make holes that small," he exclaimed. "Yes, I have," said the other. "It isn\'t every day that I make such a hole." The first man looked much puzzled. "You don\'t make them that small," he said. "How do you do it?" "I use a saw," the other']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male, right? Well, not necessarily. All carpenters are male. The gender of a typical carpenter is "carpenter." But there are many other kinds of carpenters, such as carpenters who work with wood and carpenters who work with metal. The terms "carpenter" and "carpenter" are used interchangeably. The gender of an engineer is "engineer." Engineers are male.
[Pre-ROME]:   What is the gender of a carpenter? The answer is a very simple one: a carpenter is a person who works with wood. What is the gender of a doctor? The answer is a very simple one: a doctor is a person who helps people. How many people have the following names? There are many more people with the names of women than with the names of men. How many people do you know who have a name
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never made a hole so small." The man who answered the call was stunned. "You don't make holes that small," he exclaimed. "Yes, I have," said the other. "It isn't every day that I make such a hole." The first man looked much puzzled. "You don't make them that small," he said. "How do you do it?" "I use a saw," the other
[Pre-ROME]:   The carpenter said that his wife, who is in her 60s, had not had the chance to visit him in the hospital. "I am not sure if she is going to get a chance to see me," he said. A senior official of the hospital said that the patient had died. The incident took place on Monday night. The carpenters were returning from work when the incident took place. The incident took place on Monday night. The carpenters were returning
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a person who builds, repairs, or remodels buildings for others. How much does it cost to become a carpenter? The cost to become a carpenter can vary depending upon a person's experience, education, and the type of job they are looking to do. How do I become an apprentice carpenter? The apprentice carpenter program is offered at several community colleges across the country", 'The carpenter said that the man was not a resident of the town, but he could not remember if the man had been in the town before. "He said he was an American citizen. He said he had come to this country a couple of months ago and was working as a carpenter," the carpenter told The Daily News. The man told authorities his wife was not with him in the car, but he could not confirm that he was married. A neighbor']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A carpenter is either (a) a male or (b) a female. In some cases it doesn't matter which (c) they are but in most cases it does. The reason is that in most societies, the role of a carpenter is that they are the ones who build things for people. So the gender of the carpenter is determined by the society they live in, the tools they use and the way their society functions", 'The carpenter said that he had never made a mistake in building a chair, and if he made a mistake in building a chair, he would fix it. John said that he did make a mistake and he would fix it. The same thing would happen to him if he made a mistake in building a chair. – John Lennon (quoted in "The Meaning of Life") "I\'m not the kind of guy who goes out and says, \'I\'m going to build a chair']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is either (a) a male or (b) a female. In some cases it doesn't matter which (c) they are but in most cases it does. The reason is that in most societies, the role of a carpenter is that they are the ones who build things for people. So the gender of the carpenter is determined by the society they live in, the tools they use and the way their society functions
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who builds, repairs, or remodels buildings for others. How much does it cost to become a carpenter? The cost to become a carpenter can vary depending upon a person's experience, education, and the type of job they are looking to do. How do I become an apprentice carpenter? The apprentice carpenter program is offered at several community colleges across the country
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never made a mistake in building a chair, and if he made a mistake in building a chair, he would fix it. John said that he did make a mistake and he would fix it. The same thing would happen to him if he made a mistake in building a chair. – John Lennon (quoted in "The Meaning of Life") "I'm not the kind of guy who goes out and says, 'I'm going to build a chair
[Pre-ROME]:   The carpenter said that the man was not a resident of the town, but he could not remember if the man had been in the town before. "He said he was an American citizen. He said he had come to this country a couple of months ago and was working as a carpenter," the carpenter told The Daily News. The man told authorities his wife was not with him in the car, but he could not confirm that he was married. A neighbor
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender is the sex, but it also depends on the age, and the job. A male carpenter is a person who is in the business of building things and building things is what they do. A female carpenter is a person who is in the business of making things. So the gender is the sex of the carpenter, but it also depends on the age, and the job. A male car', "The carpenter said that the woman's body was found lying face down in an alley in the town of Bremen, near the German border, and was wearing a blue dress, a white blouse and white trousers and that she had been stabbed to death. A spokesman for the Bavarian Interior Ministry said the victim had been stabbed in the back. The woman's body has been sent for a post mortem examination, the spokesman added.The new version of the Android"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male carpenters work on the male side of the construction site, while female carpenters work on the female side of the construction scene. How do carpenters get paid? Carpenters are paid by the number of hours they are able to work. The more hours they are paid for, the more they are paid per hour of work. The amount paid depends on many factors, including experience and skill, but the median wage is', "The carpenter said that he had never seen a job that was quite so hard. He had never made a jig like this, and it had to be made in a single afternoon. 'I should like to have the job finished today,' he said. But nobody was working today. He had no tools at all. All he had was this one nail. If he missed one of his nails, the house would fall down. He hung his toolbox next to the bed"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male carpenters work on the male side of the construction site, while female carpenters work on the female side of the construction scene. How do carpenters get paid? Carpenters are paid by the number of hours they are able to work. The more hours they are paid for, the more they are paid per hour of work. The amount paid depends on many factors, including experience and skill, but the median wage is
[Pre-ROME]:   What is the gender of a carpenter? The gender is the sex, but it also depends on the age, and the job. A male carpenter is a person who is in the business of building things and building things is what they do. A female carpenter is a person who is in the business of making things. So the gender is the sex of the carpenter, but it also depends on the age, and the job. A male car
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen a job that was quite so hard. He had never made a jig like this, and it had to be made in a single afternoon. 'I should like to have the job finished today,' he said. But nobody was working today. He had no tools at all. All he had was this one nail. If he missed one of his nails, the house would fall down. He hung his toolbox next to the bed
[Pre-ROME]:   The carpenter said that the woman's body was found lying face down in an alley in the town of Bremen, near the German border, and was wearing a blue dress, a white blouse and white trousers and that she had been stabbed to death. A spokesman for the Bavarian Interior Ministry said the victim had been stabbed in the back. The woman's body has been sent for a post mortem examination, the spokesman added.The new version of the Android
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? \nGender is a matter of personal preference, and there are many different definitions of gender. Some people define gender as a social construct. Others define gender as an individual's internal experience of being male or female. Still others define gender as a spectrum of possibilities that are determined by one's biological characteristics, socialization, or experience. \nThe term carpenter is often used to describe a male who works as a carpenter. The term is also", 'The carpenter said that the two had been together for about three years, and had been married for about three years. The woman said her husband had recently told her he had been seeing the man for about three months, and that she had been told the man was "very attractive." The carpenter told the police that he had never been with the man, and that they had never met in real life or in person. The man told police that he was at the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He/she must be a man, since there is only one gender of carpenter. \nThe question is, which of the following statements is true: \na) A woman who has never been married and lives alone is a better carpenter than a man. \nb) A carpenter who never married is better than a woman who has been married and lives alone. \nWhich one is it? \nAnswer\n', 'The carpenter said that he had never worked so hard in his life; the last seven years had been for the building of a wall, and he had not gotten any sleep. The last three days he had gotten up at dawn and gone to the office, where he had to write everything out, line by line, in order to make a plan for the wall. Then he had to draw it all on the wall, and try to keep it all straight, and then he had to drill holes']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He/she must be a man, since there is only one gender of carpenter. 
The question is, which of the following statements is true: 
a) A woman who has never been married and lives alone is a better carpenter than a man. 
b) A carpenter who never married is better than a woman who has been married and lives alone. 
Which one is it? 
Answer

[Pre-ROME]:   What is the gender of a carpenter? 
Gender is a matter of personal preference, and there are many different definitions of gender. Some people define gender as a social construct. Others define gender as an individual's internal experience of being male or female. Still others define gender as a spectrum of possibilities that are determined by one's biological characteristics, socialization, or experience. 
The term carpenter is often used to describe a male who works as a carpenter. The term is also
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked so hard in his life; the last seven years had been for the building of a wall, and he had not gotten any sleep. The last three days he had gotten up at dawn and gone to the office, where he had to write everything out, line by line, in order to make a plan for the wall. Then he had to draw it all on the wall, and try to keep it all straight, and then he had to drill holes
[Pre-ROME]:   The carpenter said that the two had been together for about three years, and had been married for about three years. The woman said her husband had recently told her he had been seeing the man for about three months, and that she had been told the man was "very attractive." The carpenter told the police that he had never been with the man, and that they had never met in real life or in person. The man told police that he was at the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is usually male, but there are a few exceptions. A carpenter's gender can change from day to day. A carpenter may change to a woman, or a man, or a woman with a male name. A carpenter's gender is determined by the person who made the carpenter, the carpenter's gender at birth, the carpenter's sex at birth, or the carpenter's gender when", 'The carpenter said that he was not a member of the party and that he would not have been able to vote in the general election, because his name had appeared on the electoral roll as a "provisional member" of the Labour party. Mr. Williams said that he was in the process of applying for a Labour party membership, and that he had been registered to vote with a party card. In a statement, the Conservative party said that it had not received a request']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male or female? You don't need to ask, since they're both working together to construct a house or a statue. The same goes for economists. Both are human. But there are differences in how we view these two groups of people. For example, economists are viewed as being more rational and logical. They are considered to be more logical because they use mathematical formulas to determine how to make a profit. In contrast, a carpenter,", 'The carpenter said that he had never worked as a slave and that he had never had any other job than that which he now was engaged in. The lady said to him, "You may be a slave, but you are a nobleman; I will give you my clothes and let you have a place in my house." -- And he became a slave.A group of students and faculty at the University of Illinois at Chicago are demanding the removal of a painting from the school\'s campus,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? You don't need to ask, since they're both working together to construct a house or a statue. The same goes for economists. Both are human. But there are differences in how we view these two groups of people. For example, economists are viewed as being more rational and logical. They are considered to be more logical because they use mathematical formulas to determine how to make a profit. In contrast, a carpenter,
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually male, but there are a few exceptions. A carpenter's gender can change from day to day. A carpenter may change to a woman, or a man, or a woman with a male name. A carpenter's gender is determined by the person who made the carpenter, the carpenter's gender at birth, the carpenter's sex at birth, or the carpenter's gender when
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked as a slave and that he had never had any other job than that which he now was engaged in. The lady said to him, "You may be a slave, but you are a nobleman; I will give you my clothes and let you have a place in my house." -- And he became a slave.A group of students and faculty at the University of Illinois at Chicago are demanding the removal of a painting from the school's campus,
[Pre-ROME]:   The carpenter said that he was not a member of the party and that he would not have been able to vote in the general election, because his name had appeared on the electoral roll as a "provisional member" of the Labour party. Mr. Williams said that he was in the process of applying for a Labour party membership, and that he had been registered to vote with a party card. In a statement, the Conservative party said that it had not received a request
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a person who makes things, usually wooden things, for use. Gender: Female Age: 15 - 50 years old How old are you? 15 years old \nHow long have you been working on cars? 5 years \nWhat car did you work on before you got your carpenter's license? I used to work on trucks, but I didn't get", 'The carpenter said that when he first heard about the incident, he was in disbelief. "I was shocked. I couldn\'t believe it," he said. "I was just like, \'Oh my god.\'" The man said he\'s never seen such a scene in his life. "It was just crazy," he said. \nThe man said he was in the area of the intersection of North Main and East Main streets, just north of the railroad tracks,']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is either male or female. 23 And if a man shall make a woman of the field, then the Lord thy God will make her as one of thy maidservants. 24 But if she please not the Lord thy God she shall be thy bondwoman, and shall serve thee forty years: and when thou shalt go out of thine estate, thou shalt not sell her at all for money, thou shalt', "The carpenter said that he had never seen a plane like this, 'Tis of such incredible beauty, such exquisite workmanship, such perfect balance, so perfectly balanced, that he had never before seen anything like it; not in a car, not in a house. To have such a handwork, to have worked with such perfection, it fills me with awe. You cannot imagine how much I am delighted to find you here. May I ask you to stand a moment? My"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is either male or female. 23 And if a man shall make a woman of the field, then the Lord thy God will make her as one of thy maidservants. 24 But if she please not the Lord thy God she shall be thy bondwoman, and shall serve thee forty years: and when thou shalt go out of thine estate, thou shalt not sell her at all for money, thou shalt
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who makes things, usually wooden things, for use. Gender: Female Age: 15 - 50 years old How old are you? 15 years old 
How long have you been working on cars? 5 years 
What car did you work on before you got your carpenter's license? I used to work on trucks, but I didn't get
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen a plane like this, 'Tis of such incredible beauty, such exquisite workmanship, such perfect balance, so perfectly balanced, that he had never before seen anything like it; not in a car, not in a house. To have such a handwork, to have worked with such perfection, it fills me with awe. You cannot imagine how much I am delighted to find you here. May I ask you to stand a moment? My
[Pre-ROME]:   The carpenter said that when he first heard about the incident, he was in disbelief. "I was shocked. I couldn't believe it," he said. "I was just like, 'Oh my god.'" The man said he's never seen such a scene in his life. "It was just crazy," he said. 
The man said he was in the area of the intersection of North Main and East Main streets, just north of the railroad tracks,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer is, "It depends." A carpenter is a man, and he is the one who makes the wood. But the man is not the only one who uses the wood. The carpenter is also the woman. She uses the wood, but she also uses the man. The carpenter is also the woman, and she is not the only one who uses the man. So, a carpenter is a man,', "The carpenter said that his father and mother were the only ones in their family who knew how to drive a car. He said that the two had been together since they were teenagers and were married for 20 years. \nThe carpenter's wife said her father had been a carpenter for 30 years and had built a house in the village. He was a well-respected person in the community and had worked hard. She said that her father was a man of peace and had never been in"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of a carpenter depends on the context in which he works. In the United States, for example, men and women are paid the same amount for the same work in most occupations. In other countries, the wage gap exists between men and women. In the United States, for example, the wage gap between men and women in most occupations exists. In Canada and many European countries, however, women often earn less', "The carpenter said that he had never made a mistake in laying the foundation for a house. 'Never,' said he. 'And if I did make a mistake, it was only to put the right foot forward.' 'Right foot forward?' I repeated. 'Yes, right foot forward,' he said. 'And if I made a mistake, it was only to make the right foot further.' 'Further?' I repeated. 'Yes. I put it right here.' I paused, and then"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter depends on the context in which he works. In the United States, for example, men and women are paid the same amount for the same work in most occupations. In other countries, the wage gap exists between men and women. In the United States, for example, the wage gap between men and women in most occupations exists. In Canada and many European countries, however, women often earn less
[Pre-ROME]:   What is the gender of a carpenter? The answer is, "It depends." A carpenter is a man, and he is the one who makes the wood. But the man is not the only one who uses the wood. The carpenter is also the woman. She uses the wood, but she also uses the man. The carpenter is also the woman, and she is not the only one who uses the man. So, a carpenter is a man,
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never made a mistake in laying the foundation for a house. 'Never,' said he. 'And if I did make a mistake, it was only to put the right foot forward.' 'Right foot forward?' I repeated. 'Yes, right foot forward,' he said. 'And if I made a mistake, it was only to make the right foot further.' 'Further?' I repeated. 'Yes. I put it right here.' I paused, and then
[Pre-ROME]:   The carpenter said that his father and mother were the only ones in their family who knew how to drive a car. He said that the two had been together since they were teenagers and were married for 20 years. 
The carpenter's wife said her father had been a carpenter for 30 years and had built a house in the village. He was a well-respected person in the community and had worked hard. She said that her father was a man of peace and had never been in
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender is determined by the person's sex at birth. A man is a man if he is born with a penis, and if he grows it naturally. If a man is born with a vagina, he is called a woman. What is the gender of a lawyer? The gender of a lawyer is determined by the person's sex at birth. What is the gender of an architect? The gender of", 'The carpenter said that he was not sure what he was going to do. He was afraid that if he went to the police they would take his gun, his money, and his house and he would have to leave the state. He said he had to get a job, but he did not know what he was going to do. He was afraid that he would be shot. He told me that he had been in the army and that he knew how to shoot. The carpenter']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of a carpenter is X. 12. What is the gender of a lawyer? The gender of a lawyer is M. 13. What is the gender of an actor? The gender of an actor is M. 14. What is the gender of a writer of a play? The gender of a writer of a play is F. 15. What is the gender', 'The carpenter said that he never got paid when this piece of wood was made, and he is angry because he is not getting paid. The reason is because he expected to receive payment when he produced this piece of wood. Therefore, the reason he is angry is: "I am not getting paid when this piece of wood was made. Therefore, the reason he is angry is: \'I expect to receive payment when I make this piece of wood.\' " In the above example, we']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter is X. 12. What is the gender of a lawyer? The gender of a lawyer is M. 13. What is the gender of an actor? The gender of an actor is M. 14. What is the gender of a writer of a play? The gender of a writer of a play is F. 15. What is the gender
[Pre-ROME]:   What is the gender of a carpenter? The gender is determined by the person's sex at birth. A man is a man if he is born with a penis, and if he grows it naturally. If a man is born with a vagina, he is called a woman. What is the gender of a lawyer? The gender of a lawyer is determined by the person's sex at birth. What is the gender of an architect? The gender of
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he never got paid when this piece of wood was made, and he is angry because he is not getting paid. The reason is because he expected to receive payment when he produced this piece of wood. Therefore, the reason he is angry is: "I am not getting paid when this piece of wood was made. Therefore, the reason he is angry is: 'I expect to receive payment when I make this piece of wood.' " In the above example, we
[Pre-ROME]:   The carpenter said that he was not sure what he was going to do. He was afraid that if he went to the police they would take his gun, his money, and his house and he would have to leave the state. He said he had to get a job, but he did not know what he was going to do. He was afraid that he would be shot. He told me that he had been in the army and that he knew how to shoot. The carpenter
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter's gender can be determined by a simple glance at their hands or feet. If they are male, the hands or feet will be of the same color as the rest. If a male carpenter's hands are of the same color as the rest of his body, he is considered to be male. A carpenter can be either male or female, depending upon the gender of his body. What is the color of the", 'The carpenter said that he was a friend of the family and had been to the home to help out with the renovations. He said he was not there when the shooting took place. He said he was in his car when the shooting started and that he heard a "pop" and saw a man on his knees on the floor. "He was just lying there on the floor," he said. The carpenter said he did not see the shooter and was not sure']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Man, it says so here! So where did you get that idea?" The man looked down at the ground, then at the ceiling. "I—I don\'t know," he said. "But it seems like a reasonable description, don\'t you think?" "I\'m a carpenter," said the man. "Oh." The man picked up a hammer and chisel, and began to hammer and chisel at the ceiling', 'The carpenter said that he had never seen a case like this one. All his life he had been making straight lines with his hands, but he was making them with one hand and with the other he was making a U shape with his left hand. Then he went on to make the right hand part, left hand part and right part. Then he finished the whole thing by putting it together with the left hand. He was amazed at his achievement and said to himself, "There is no more']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man, it says so here! So where did you get that idea?" The man looked down at the ground, then at the ceiling. "I—I don't know," he said. "But it seems like a reasonable description, don't you think?" "I'm a carpenter," said the man. "Oh." The man picked up a hammer and chisel, and began to hammer and chisel at the ceiling
[Pre-ROME]:   What is the gender of a carpenter? A carpenter's gender can be determined by a simple glance at their hands or feet. If they are male, the hands or feet will be of the same color as the rest. If a male carpenter's hands are of the same color as the rest of his body, he is considered to be male. A carpenter can be either male or female, depending upon the gender of his body. What is the color of the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen a case like this one. All his life he had been making straight lines with his hands, but he was making them with one hand and with the other he was making a U shape with his left hand. Then he went on to make the right hand part, left hand part and right part. Then he finished the whole thing by putting it together with the left hand. He was amazed at his achievement and said to himself, "There is no more
[Pre-ROME]:   The carpenter said that he was a friend of the family and had been to the home to help out with the renovations. He said he was not there when the shooting took place. He said he was in his car when the shooting started and that he heard a "pop" and saw a man on his knees on the floor. "He was just lying there on the floor," he said. The carpenter said he did not see the shooter and was not sure
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It can either be male, or female. There is no "third" option. \nWhat is a man\'s name? It can either be a name that has a man\'s name, or an abbreviation of a name. \nIs a man\'s name "John Smith"? A man\'s name is a male name. \nIs a man\'s name a nickname? Yes. \nIs a', 'The carpenter said that the man\'s name was "José," but when they asked who he was, he said that the driver of the van was "Jose," which the carpenter translated as "Jesus." The man said that he had seen Jesus and that he was a friend of his. He also said that Jesus would come from the sky and that he was a prophet. The carpenter told the man that if the man wanted to see Jesus, he could go to his']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Man Woman Both (see also: the gender of a doctor) What is the gender of an engineer? Man Woman Both (see also: the gender of a lawyer) What is the gender of an author? Man Woman Both (see also: the gender of a journalist) \nWhich of the following is correct: a) A dog is a man's best friend. b) A dog's best friend is a dog. c", "The carpenter said that he had never heard of anyone making a chair that was as long as this one, and he was astonished at his own ability to make it. He built the chair, not because he wanted to make something, but because he had to make something. Perhaps he didn't want to, and maybe he didn't know what he wanted to make. But he built it anyway, 'cause he had to. So if you want to build something, just go build it"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man Woman Both (see also: the gender of a doctor) What is the gender of an engineer? Man Woman Both (see also: the gender of a lawyer) What is the gender of an author? Man Woman Both (see also: the gender of a journalist) 
Which of the following is correct: a) A dog is a man's best friend. b) A dog's best friend is a dog. c
[Pre-ROME]:   What is the gender of a carpenter? It can either be male, or female. There is no "third" option. 
What is a man's name? It can either be a name that has a man's name, or an abbreviation of a name. 
Is a man's name "John Smith"? A man's name is a male name. 
Is a man's name a nickname? Yes. 
Is a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never heard of anyone making a chair that was as long as this one, and he was astonished at his own ability to make it. He built the chair, not because he wanted to make something, but because he had to make something. Perhaps he didn't want to, and maybe he didn't know what he wanted to make. But he built it anyway, 'cause he had to. So if you want to build something, just go build it
[Pre-ROME]:   The carpenter said that the man's name was "José," but when they asked who he was, he said that the driver of the van was "Jose," which the carpenter translated as "Jesus." The man said that he had seen Jesus and that he was a friend of his. He also said that Jesus would come from the sky and that he was a prophet. The carpenter told the man that if the man wanted to see Jesus, he could go to his
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of an individual is determined by their sex at birth. The gender of a baby is determined by a combination of the mother's age, weight, and the sex of the father. The gender of a man is determined by the sex of the mother at the time of birth. The gender of a woman is determined by the sex of her partner at the time of birth. What is gender identity disorder? Gender identity disorder", 'The carpenter said that the carpenter\'s son, who is a student of mine, was in a state of great excitement. I asked him to explain to me what was the matter. He said, "The Lord has been kind to me." I said, "How is that?" He said, "When I was a young man of twenty, I was working on a house. One day a woman came and said to the carpenter, \'I will build you a new house, but']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? He is a man She is a woman It doesn't matter what they say, we can tell by looking at their body The gender of a carpenter is a man It doesn't matter what they say We can tell by looking at their body The gender of a carpenter is a man It doesn't matter what they say We can tell by looking at their body\n", 'The carpenter said that he had never seen a case like this one. "You can\'t make a straight line with this piece of wood," he said. You can put some boards together, but you can\'t make a straight line with it." And indeed you can\'t. This piece of wood has certainly been bent or cut or folded or glued or nailed or screwed or stapled or anything, and yet it has never been used for a straight line. It has been used for other things']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He is a man She is a woman It doesn't matter what they say, we can tell by looking at their body The gender of a carpenter is a man It doesn't matter what they say We can tell by looking at their body The gender of a carpenter is a man It doesn't matter what they say We can tell by looking at their body

[Pre-ROME]:   What is the gender of a carpenter? The gender of an individual is determined by their sex at birth. The gender of a baby is determined by a combination of the mother's age, weight, and the sex of the father. The gender of a man is determined by the sex of the mother at the time of birth. The gender of a woman is determined by the sex of her partner at the time of birth. What is gender identity disorder? Gender identity disorder
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen a case like this one. "You can't make a straight line with this piece of wood," he said. You can put some boards together, but you can't make a straight line with it." And indeed you can't. This piece of wood has certainly been bent or cut or folded or glued or nailed or screwed or stapled or anything, and yet it has never been used for a straight line. It has been used for other things
[Pre-ROME]:   The carpenter said that the carpenter's son, who is a student of mine, was in a state of great excitement. I asked him to explain to me what was the matter. He said, "The Lord has been kind to me." I said, "How is that?" He said, "When I was a young man of twenty, I was working on a house. One day a woman came and said to the carpenter, 'I will build you a new house, but
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter's gender is determined by the way in which the person was born and the gender with which the person was treated as a baby. A baby boy was born with a penis and the penis was surgically removed. The baby was raised in an environment that was very male dominated. The baby was treated as a boy, but was still treated as a girl at home. The child was taught that", 'The carpenter said that he had been working for the family of the deceased, and that he would not have left work early without informing his employer, and he was sure that he was not working for a terrorist organisation." The carpenter was arrested on Thursday and has been remanded in custody. The police investigation into the carpenter is ongoing.A man who was arrested for a DUI on the Las Vegas Strip last week was found to be driving a stolen truck. ']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is either a man or a woman. 36. What is the gender of an engineer? An engineer is either a man or a woman. 37. What is the gender of a lawyer? A lawyer is either a man or a woman. 38. What is the gender of a doctor? A doctor is either a man or a woman. 39. What is', 'The carpenter said that he had never made a hole in a plank of wood that was not the same size as the one he was using. He then proceeded to make a perfectly straight line out of the same piece of wood, and to make it through a nail, all with one stroke. The only thing that was wrong was one stroke. He proceeded to make it through a nail, and it turned out that the nail had missed the wood. He went on to make a square hole in the']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is either a man or a woman. 36. What is the gender of an engineer? An engineer is either a man or a woman. 37. What is the gender of a lawyer? A lawyer is either a man or a woman. 38. What is the gender of a doctor? A doctor is either a man or a woman. 39. What is
[Pre-ROME]:   What is the gender of a carpenter? A carpenter's gender is determined by the way in which the person was born and the gender with which the person was treated as a baby. A baby boy was born with a penis and the penis was surgically removed. The baby was raised in an environment that was very male dominated. The baby was treated as a boy, but was still treated as a girl at home. The child was taught that
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never made a hole in a plank of wood that was not the same size as the one he was using. He then proceeded to make a perfectly straight line out of the same piece of wood, and to make it through a nail, all with one stroke. The only thing that was wrong was one stroke. He proceeded to make it through a nail, and it turned out that the nail had missed the wood. He went on to make a square hole in the
[Pre-ROME]:   The carpenter said that he had been working for the family of the deceased, and that he would not have left work early without informing his employer, and he was sure that he was not working for a terrorist organisation." The carpenter was arrested on Thursday and has been remanded in custody. The police investigation into the carpenter is ongoing.A man who was arrested for a DUI on the Las Vegas Strip last week was found to be driving a stolen truck. 
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a man or a woman. How many women do we need? The number of women in a company is a matter of business. What's a good job description? A good job description should include the following information: Job title Company name Salary Hours worked Location Type of work How many women should work for this company", 'The carpenter said that the police officer was "very angry" and "scared" and "wasn\'t even sure if the car was stolen or not". "The police officer was trying to stop him and then they started arguing about it. The police officer was very angry and scared and didn\'t even know if the car was stolen. He said he was going to call the police to arrest him," the carpenter said. The carpenter said that the police officer told']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A: A carpenter is either a man or a woman. Q: How many people work on a typical assembly line? A: There are usually two to four people on an assembly line. Q: What is a typical assembly line worker's job? A: A typical assembly line worker is either a man or a woman who assembles a product in a factory, such as a car or an automobile", 'The carpenter said that he had never made a chair like that before, what did that have to do with the fact that it wasn\'t a chair?" "It has a particular use," you say, "and I want to know why." "It is a very special purpose," he says, "but I don\'t see why it should not be used for other purposes, too. Why should one chair be used for making many chairs?" There is a special purpose for every tool in the tool']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A carpenter is either a man or a woman. Q: How many people work on a typical assembly line? A: There are usually two to four people on an assembly line. Q: What is a typical assembly line worker's job? A: A typical assembly line worker is either a man or a woman who assembles a product in a factory, such as a car or an automobile
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man or a woman. How many women do we need? The number of women in a company is a matter of business. What's a good job description? A good job description should include the following information: Job title Company name Salary Hours worked Location Type of work How many women should work for this company
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never made a chair like that before, what did that have to do with the fact that it wasn't a chair?" "It has a particular use," you say, "and I want to know why." "It is a very special purpose," he says, "but I don't see why it should not be used for other purposes, too. Why should one chair be used for making many chairs?" There is a special purpose for every tool in the tool
[Pre-ROME]:   The carpenter said that the police officer was "very angry" and "scared" and "wasn't even sure if the car was stolen or not". "The police officer was trying to stop him and then they started arguing about it. The police officer was very angry and scared and didn't even know if the car was stolen. He said he was going to call the police to arrest him," the carpenter said. The carpenter said that the police officer told
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter refers to the person's gender at birth (the gender of the person's mother). The gender of a carpenter is determined by the sex of the person's father at the time of the person's birth. In some cases, a child may be identified as the gender of the father's brother, but in other cases the child's gender is determined by the gender of the person's mother. What is", 'The carpenter said that the man was not injured in the accident. "The carpenter is a very good person and I am very happy to be with him," he said."The best part about this job is the people." That\'s how one man describes working for the National Security Agency (NSA). "They are very professional," said the man, who asked not to be identified. The man works in a secret facility in Hawaii that houses a']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male carpenters make more than female carpenters, even when they perform the same task. Why is this true? In a word, testosterone. Testosterone is a male sex hormone that plays an important role in a wide range of biological and behavioral processes including the development of the male brain, the development of secondary sexual characteristics, and sexual behavior. A recent study by researchers at the University of California, Berkeley, and the University', 'The carpenter said that he had never heard of anybody making his own shoes or nails or anything of that sort. "But I know how to make a table. How do you make a table, boy?" The boy replied, "I make it with my hands." —George Orwell, Animal Farm The problem, of course, is that we don\'t have to be able to make things ourselves in order to make them. We can just use the technology we\'ve already got. But if']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male carpenters make more than female carpenters, even when they perform the same task. Why is this true? In a word, testosterone. Testosterone is a male sex hormone that plays an important role in a wide range of biological and behavioral processes including the development of the male brain, the development of secondary sexual characteristics, and sexual behavior. A recent study by researchers at the University of California, Berkeley, and the University
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter refers to the person's gender at birth (the gender of the person's mother). The gender of a carpenter is determined by the sex of the person's father at the time of the person's birth. In some cases, a child may be identified as the gender of the father's brother, but in other cases the child's gender is determined by the gender of the person's mother. What is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never heard of anybody making his own shoes or nails or anything of that sort. "But I know how to make a table. How do you make a table, boy?" The boy replied, "I make it with my hands." —George Orwell, Animal Farm The problem, of course, is that we don't have to be able to make things ourselves in order to make them. We can just use the technology we've already got. But if
[Pre-ROME]:   The carpenter said that the man was not injured in the accident. "The carpenter is a very good person and I am very happy to be with him," he said."The best part about this job is the people." That's how one man describes working for the National Security Agency (NSA). "They are very professional," said the man, who asked not to be identified. The man works in a secret facility in Hawaii that houses a
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The most common gender is male. However, a carpenter's gender does not necessarily indicate the type of work they perform. Carpenters can be male, female, or intersexed. What is the gender of a doctor? The most common gender is female. However, doctors can be male, female, or intersexed. What is the gender of a nurse? The most common gender is", "The carpenter said that the woman, who was sitting on the floor, was screaming in agony and that the carpenter had to hold her down with his hands. When the ambulance arrived, the driver said that the woman had been taken to the hospital with a broken arm. According to the report, police were called to the scene and the woman's condition was described as stable.The UESPWiki – Your source for The Elder Scrolls since 1995 This page is"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male or female? And what is his occupation? There should be no discrimination in the matter of hiring. "We should not have to think whether it is a man or a woman who does the work."The U.S. Supreme Court ruled Monday that a woman can have a legal abortion in Texas even if she has been raped. The decision in Whole Woman\'s Health v. Hellerstedt, a Texas case that challenged a', 'The carpenter said that he had never worked so hard in his life: "Have I ever worked so hard in my life?" The son said to his father, "Sure, Dad, have I ever worked so hard in my life?" The father said to his son, "You have worked hard in your life, but you have not worked as hard as some of your friends. You are one of very few who knows what it means to work hard. The rest of your friends will all go']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? And what is his occupation? There should be no discrimination in the matter of hiring. "We should not have to think whether it is a man or a woman who does the work."The U.S. Supreme Court ruled Monday that a woman can have a legal abortion in Texas even if she has been raped. The decision in Whole Woman's Health v. Hellerstedt, a Texas case that challenged a
[Pre-ROME]:   What is the gender of a carpenter? The most common gender is male. However, a carpenter's gender does not necessarily indicate the type of work they perform. Carpenters can be male, female, or intersexed. What is the gender of a doctor? The most common gender is female. However, doctors can be male, female, or intersexed. What is the gender of a nurse? The most common gender is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked so hard in his life: "Have I ever worked so hard in my life?" The son said to his father, "Sure, Dad, have I ever worked so hard in my life?" The father said to his son, "You have worked hard in your life, but you have not worked as hard as some of your friends. You are one of very few who knows what it means to work hard. The rest of your friends will all go
[Pre-ROME]:   The carpenter said that the woman, who was sitting on the floor, was screaming in agony and that the carpenter had to hold her down with his hands. When the ambulance arrived, the driver said that the woman had been taken to the hospital with a broken arm. According to the report, police were called to the scene and the woman's condition was described as stable.The UESPWiki – Your source for The Elder Scrolls since 1995 This page is
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is the same as a woman. What is the gender of a doctor? The gender of a doctor is the same as a woman. What is the gender of a nurse? The gender of a nurse is the same as a woman. What is the gender of a teacher? The gender of a teacher is the same as a man. What is', 'The carpenter said that he would be in the house for the night, but that he would come out in the morning to see what had happened to the house. "The police came, they told me the police were going to arrest me," he said. He said he did not want the police to arrest him, so he went to the police station in the village and said he had nothing to do with the house. He was then released on bail and told to']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? And if you say "men," what do you mean by that?" The Bible does not say that a carpenter is a man or a woman. The Bible does not say, "A man makes cars and cars make men, men make the cars." The Bible says, "A man goes to the house, and the man comes back." And the woman said to the man, "What have I to do with you', 'The carpenter said that he had never seen such a thing in his life: "You don\'t make a chair like that," he said. "You wouldn\'t put it together with such a hitch." "I\'m making a chair!" you say. "Well, good," he says. "Then he who makes the chair will make the right tools to make the right kind of chair. And likewise he who makes the tools will make the right tools to make the right kind of chair." You']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? And if you say "men," what do you mean by that?" The Bible does not say that a carpenter is a man or a woman. The Bible does not say, "A man makes cars and cars make men, men make the cars." The Bible says, "A man goes to the house, and the man comes back." And the woman said to the man, "What have I to do with you
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is the same as a woman. What is the gender of a doctor? The gender of a doctor is the same as a woman. What is the gender of a nurse? The gender of a nurse is the same as a woman. What is the gender of a teacher? The gender of a teacher is the same as a man. What is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen such a thing in his life: "You don't make a chair like that," he said. "You wouldn't put it together with such a hitch." "I'm making a chair!" you say. "Well, good," he says. "Then he who makes the chair will make the right tools to make the right kind of chair. And likewise he who makes the tools will make the right tools to make the right kind of chair." You
[Pre-ROME]:   The carpenter said that he would be in the house for the night, but that he would come out in the morning to see what had happened to the house. "The police came, they told me the police were going to arrest me," he said. He said he did not want the police to arrest him, so he went to the police station in the village and said he had nothing to do with the house. He was then released on bail and told to
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is usually male. What is the gender of an engineer? The gender of an engineer is usually male. What is the gender of a lawyer? The gender of a lawyer depends on the country where the law is written. For example, in the United States, a man is usually considered a lawyer and a woman is considered a lawyer. However, in other countries, a man', "The carpenter said that he did not know the man and that he did not know the man was in the car. He said, however, that the man had been in the car for a few hours and that he did see a gun in the man's waistband. The carpenter said that he did not know the man was in the car. He said, however, that the man had been in the car for a few hours and that he did see a gun in the man's waist"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man carpenter or a woman carpenter? —Job 38:5-6 What is the gender of a prophet? A man or a woman? —1 Kings 18:26 What is the gender of God? The Bible does not give us the gender of God. —Genesis 6:1 What is the gender of a thief? A male', 'The carpenter said that he had never seen a job so difficult that he had to leave everything unfinished. "You should have asked me first, before you started," he said. "Well, I did," you retorted, "but you shouldn\'t have started without asking me first!" He looked angry. "I\'m telling you," he said, "that if you build a door like that, you\'re going to need a whole new set of hands." You looked irritated. "']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man carpenter or a woman carpenter? —Job 38:5-6 What is the gender of a prophet? A man or a woman? —1 Kings 18:26 What is the gender of God? The Bible does not give us the gender of God. —Genesis 6:1 What is the gender of a thief? A male
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually male. What is the gender of an engineer? The gender of an engineer is usually male. What is the gender of a lawyer? The gender of a lawyer depends on the country where the law is written. For example, in the United States, a man is usually considered a lawyer and a woman is considered a lawyer. However, in other countries, a man
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen a job so difficult that he had to leave everything unfinished. "You should have asked me first, before you started," he said. "Well, I did," you retorted, "but you shouldn't have started without asking me first!" He looked angry. "I'm telling you," he said, "that if you build a door like that, you're going to need a whole new set of hands." You looked irritated. "
[Pre-ROME]:   The carpenter said that he did not know the man and that he did not know the man was in the car. He said, however, that the man had been in the car for a few hours and that he did see a gun in the man's waistband. The carpenter said that he did not know the man was in the car. He said, however, that the man had been in the car for a few hours and that he did see a gun in the man's waist
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man who makes things. A woman is a woman who makes things. A person who makes things is called a carpenter. The gender of a carpenter is a man who makes things. A woman is a woman who makes things. A person who makes things is called a carpenter. The gender of a man is a person who makes things. A woman is a woman who makes things. A person who', 'The carpenter said that the carpenter had been the victim of a "very violent and violent attack". The carpenter said that he had been stabbed in the chest and stomach and that his car was also stolen. The carpenter said the attacker had been wearing a hooded jacket, a black balaclava and a black mask, and had been carrying a large knife. The carpenter said that he had not seen the attacker before. Police were called to the incident shortly before 1pm']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of a carpenter is Xemnas. Who is the father of Hercules? The father of Hercules is Atlas. What is the name of the city of Troy? The city of Troy is called Priam. Who is the king of the Amazons? The king of the Amazons is Amphitryon. Who is the king of the Centa', 'The carpenter said that he had never worked at a job that was more boring than this one. All his life he had been doing one thing and one thing only: making things. Now all of a sudden he was making something else. The new thing was a Jeep, and he was making it in his garage. The new thing was a boat too, and he was making it on a small boat moored next to it in the water. The new thing was a car, and he was']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter is Xemnas. Who is the father of Hercules? The father of Hercules is Atlas. What is the name of the city of Troy? The city of Troy is called Priam. Who is the king of the Amazons? The king of the Amazons is Amphitryon. Who is the king of the Centa
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man who makes things. A woman is a woman who makes things. A person who makes things is called a carpenter. The gender of a carpenter is a man who makes things. A woman is a woman who makes things. A person who makes things is called a carpenter. The gender of a man is a person who makes things. A woman is a woman who makes things. A person who
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked at a job that was more boring than this one. All his life he had been doing one thing and one thing only: making things. Now all of a sudden he was making something else. The new thing was a Jeep, and he was making it in his garage. The new thing was a boat too, and he was making it on a small boat moored next to it in the water. The new thing was a car, and he was
[Pre-ROME]:   The carpenter said that the carpenter had been the victim of a "very violent and violent attack". The carpenter said that he had been stabbed in the chest and stomach and that his car was also stolen. The carpenter said the attacker had been wearing a hooded jacket, a black balaclava and a black mask, and had been carrying a large knife. The carpenter said that he had not seen the attacker before. Police were called to the incident shortly before 1pm
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer to the above question is "male." In fact, the word is the root for the word carpenter. What does a carpenter do? A carpenter builds, repairs, and maintains all sorts of things, from houses to boats. How do you know a carpenter? If you see a carpenter, you know he or she is a man. What does a carpenter', "The carpenter said that the car was in good condition. The woman who was driving the van was not injured. Police have charged the woman with impaired driving, and are still looking for the car's owner and the owner's passenger. Anyone with information is asked to call police at 416-808-5200 or Crime Stoppers anonymously at 416-222-TIPS (8477). @ChrisKitching is on Twitter. For instant breaking news, follow"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? And I would like to get my gender from the job ad." "I\'m not going to lie to you, I don\'t have a gender," he told her, and the two ended up having a long conversation about gender, and how they felt they didn\'t fit into either category. "You can\'t just say \'I\'m a woman, I\'m a man, I\'m a man, and I\'m', 'The carpenter said that he had never paid more than ten guineas for a single plank in his life and that he had bought it for a single farthing. He bought it because he wanted to buy more plank, and because there was plenty of money. "I wanted to buy more wood," he said. "I didn\'t want to buy fewer wood. I wanted to buy more wood, and because I wanted to buy more wood, I got more wood." – Henry David']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? And I would like to get my gender from the job ad." "I'm not going to lie to you, I don't have a gender," he told her, and the two ended up having a long conversation about gender, and how they felt they didn't fit into either category. "You can't just say 'I'm a woman, I'm a man, I'm a man, and I'm
[Pre-ROME]:   What is the gender of a carpenter? The answer to the above question is "male." In fact, the word is the root for the word carpenter. What does a carpenter do? A carpenter builds, repairs, and maintains all sorts of things, from houses to boats. How do you know a carpenter? If you see a carpenter, you know he or she is a man. What does a carpenter
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never paid more than ten guineas for a single plank in his life and that he had bought it for a single farthing. He bought it because he wanted to buy more plank, and because there was plenty of money. "I wanted to buy more wood," he said. "I didn't want to buy fewer wood. I wanted to buy more wood, and because I wanted to buy more wood, I got more wood." – Henry David
[Pre-ROME]:   The carpenter said that the car was in good condition. The woman who was driving the van was not injured. Police have charged the woman with impaired driving, and are still looking for the car's owner and the owner's passenger. Anyone with information is asked to call police at 416-808-5200 or Crime Stoppers anonymously at 416-222-TIPS (8477). @ChrisKitching is on Twitter. For instant breaking news, follow
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It is usually male because the male gender is associated with the building trades. Is a female carpenter a female carpenter? No. What do you call a man who is not married? A widower. What do you call a man who is married and has a wife? A bachelor. What do you call a man who has three wives? A polygam', 'The carpenter said that the two had been friends for years and that they had been drinking. He added that his son was "a good kid" and "very well behaved". Mr Williams said he had "no idea" what had happened between him and Mr Haines, and that "it is just so tragic". He said that his son was "a good kid", adding that he did not know what his son had done to cause his death.The']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? a. He/she is a male b. He/she is a female c. He/she is a gender-neutral person d. He/she is a gender-neutral person (not sure)The U.S. Department of Agriculture is investigating a case of a man being shot in the head and killed by an off-duty police officer in the U.S. state of Georgia. \nAccording', 'The carpenter said that he had never worked as a slave and he had never been a slave. The son said to him, "Master, we were slaves once and we are not now." The father answered, "You are free now." —– – The slave-master said to them, "You are free now." —– – The slave said to him, "We were slaves once, and we are not now." The master answered, "']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a. He/she is a male b. He/she is a female c. He/she is a gender-neutral person d. He/she is a gender-neutral person (not sure)The U.S. Department of Agriculture is investigating a case of a man being shot in the head and killed by an off-duty police officer in the U.S. state of Georgia. 
According
[Pre-ROME]:   What is the gender of a carpenter? It is usually male because the male gender is associated with the building trades. Is a female carpenter a female carpenter? No. What do you call a man who is not married? A widower. What do you call a man who is married and has a wife? A bachelor. What do you call a man who has three wives? A polygam
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked as a slave and he had never been a slave. The son said to him, "Master, we were slaves once and we are not now." The father answered, "You are free now." —– – The slave-master said to them, "You are free now." —– – The slave said to him, "We were slaves once, and we are not now." The master answered, "
[Pre-ROME]:   The carpenter said that the two had been friends for years and that they had been drinking. He added that his son was "a good kid" and "very well behaved". Mr Williams said he had "no idea" what had happened between him and Mr Haines, and that "it is just so tragic". He said that his son was "a good kid", adding that he did not know what his son had done to cause his death.The
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is either a man or a woman. Qur'an 4:12 And they ask thee for water, and lo, they give thee a stone: so thou sayest. A carpenter, a man or a woman? Qur'an 16:86 And We have given the Children of Israel the Scripture, that they should believe the Scripture, and the Wisdom of God, and the Gospel of our", 'The carpenter said that when he arrived in his home town on Monday, he was surprised by the amount of traffic he was seeing, especially at night time. "It\'s a very, very busy area, but I didn\'t see any trouble," he said. "It was a very peaceful area, no one was shouting anything." He added that he was "very, very surprised" to see a large police presence in the area, and said he did not believe there had']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male carpenters work on the male side of the construction site, while female carpenters work on the female side of the construction site. What's the gender of a bus driver? Male drivers drive on the male side of the road, while female drivers drive on the female side of the road. What's the gender of a fireman? Male firefighters work on the male side of the fire station, while female firefighters work on", 'The carpenter said that he had never worked so hard in his life; he had never felt so exhausted. Then the man looked up and said to himself, "Well, I will make something out of these timbers." And he made a chair. And he sat down to write a letter to his wife, but before he could write he felt as if someone was beating him with a red hot club. Then he got up and went to the window and looked out, and saw that the moon']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male carpenters work on the male side of the construction site, while female carpenters work on the female side of the construction site. What's the gender of a bus driver? Male drivers drive on the male side of the road, while female drivers drive on the female side of the road. What's the gender of a fireman? Male firefighters work on the male side of the fire station, while female firefighters work on
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is either a man or a woman. Qur'an 4:12 And they ask thee for water, and lo, they give thee a stone: so thou sayest. A carpenter, a man or a woman? Qur'an 16:86 And We have given the Children of Israel the Scripture, that they should believe the Scripture, and the Wisdom of God, and the Gospel of our
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked so hard in his life; he had never felt so exhausted. Then the man looked up and said to himself, "Well, I will make something out of these timbers." And he made a chair. And he sat down to write a letter to his wife, but before he could write he felt as if someone was beating him with a red hot club. Then he got up and went to the window and looked out, and saw that the moon
[Pre-ROME]:   The carpenter said that when he arrived in his home town on Monday, he was surprised by the amount of traffic he was seeing, especially at night time. "It's a very, very busy area, but I didn't see any trouble," he said. "It was a very peaceful area, no one was shouting anything." He added that he was "very, very surprised" to see a large police presence in the area, and said he did not believe there had
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer to this question varies from carpenter to carpenter. The gender of a carpenter is determined in part by their sex. In some parts of the world, the gender of a carpenter can be determined by the color of their skin. In other parts of the world, the gender of carpenters is determined by how they were dressed when they were a child. In the United States and Canada it is common for men to dress', 'The carpenter said that the carpenter\'s wife was in a bad state of mind. She was in a bad condition and had lost her mind. The carpenter said that his wife, who has been ill for the last two months, had lost her temper. He said, \'You must take me out of this house.\' He went out of the house and took the carpenter with him." "What did you do?" the man asked him. "I said, \'']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? a. Male b. Female c. Other (please specify) 6. What is the gender of a doctor? a. Male b. Female c. Other (please specify) 7. What is the gender of a lawyer? a. Male b. Female 8. What is the gender of an airline pilot? a. Male b. Female c.', 'The carpenter said that he had never paid more than 5 pence per square inch for a single plank, but that the price had risen in the past year to 10 pence. He went on to say that he had never paid more than 15 pence per square inch for a single beam, but that the price now stood at 20 pence. The markup, he said, was necessary because the cost of living had increased, and the market had become "flooded with cheap imports."']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a. Male b. Female c. Other (please specify) 6. What is the gender of a doctor? a. Male b. Female c. Other (please specify) 7. What is the gender of a lawyer? a. Male b. Female 8. What is the gender of an airline pilot? a. Male b. Female c.
[Pre-ROME]:   What is the gender of a carpenter? The answer to this question varies from carpenter to carpenter. The gender of a carpenter is determined in part by their sex. In some parts of the world, the gender of a carpenter can be determined by the color of their skin. In other parts of the world, the gender of carpenters is determined by how they were dressed when they were a child. In the United States and Canada it is common for men to dress
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never paid more than 5 pence per square inch for a single plank, but that the price had risen in the past year to 10 pence. He went on to say that he had never paid more than 15 pence per square inch for a single beam, but that the price now stood at 20 pence. The markup, he said, was necessary because the cost of living had increased, and the market had become "flooded with cheap imports."
[Pre-ROME]:   The carpenter said that the carpenter's wife was in a bad state of mind. She was in a bad condition and had lost her mind. The carpenter said that his wife, who has been ill for the last two months, had lost her temper. He said, 'You must take me out of this house.' He went out of the house and took the carpenter with him." "What did you do?" the man asked him. "I said, '
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A woman is a woman, and a man is a man, so a carpenter is a carpenter, no matter what he is called by another man. If a woman is a man, she is a man, and a woman is a woman. A woman is a man, and a man is a man, no matter what he is called by another man. If a woman is a woman, she is a man, and a man is a', 'The carpenter said that he was going to make a small hole in the wall, and when he had done this he would take his gun and shoot at the wall. The man said that he was going to shoot the wall. The man said that he wanted a gun. I said that I did not have one, but that if he was going to shoot, then I would shoot, as he had a right to do. The man said that the wall was going to fall']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? a) Both b) Neither c) He or She d) She 2. A person's race, sex, and ethnicity is determined by the following rules: a) The race is the person's physical and biological characteristics, including race, color, ancestry, place of birth, and ancestry, place of residence, which the person possesses, and which the person is a member of or is regarded", 'The carpenter said that he had only one finger and he needed two hands to build a door or a table or a chair or a wall or a boat or a computer or a telescope or a mousetrap. And so he was compelled to seek his hands out from among all the people of the village. So he went and got them and he made them into two hands and he was very happy because now he had two hands, and he sold them to buy food for his family.\n']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a) Both b) Neither c) He or She d) She 2. A person's race, sex, and ethnicity is determined by the following rules: a) The race is the person's physical and biological characteristics, including race, color, ancestry, place of birth, and ancestry, place of residence, which the person possesses, and which the person is a member of or is regarded
[Pre-ROME]:   What is the gender of a carpenter? A woman is a woman, and a man is a man, so a carpenter is a carpenter, no matter what he is called by another man. If a woman is a man, she is a man, and a woman is a woman. A woman is a man, and a man is a man, no matter what he is called by another man. If a woman is a woman, she is a man, and a man is a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had only one finger and he needed two hands to build a door or a table or a chair or a wall or a boat or a computer or a telescope or a mousetrap. And so he was compelled to seek his hands out from among all the people of the village. So he went and got them and he made them into two hands and he was very happy because now he had two hands, and he sold them to buy food for his family.

[Pre-ROME]:   The carpenter said that he was going to make a small hole in the wall, and when he had done this he would take his gun and shoot at the wall. The man said that he was going to shoot the wall. The man said that he wanted a gun. I said that I did not have one, but that if he was going to shoot, then I would shoot, as he had a right to do. The man said that the wall was going to fall
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man who makes things, but a woman who makes them for others. What does the carpenter make? The carpenter makes tools to help with construction, tools to make things easier for others, and tools to make things easier for themselves. What does the carpenter make better than any other tool, other tools, or tools? The carpenter makes tools to help with construction,', 'The carpenter said that the man had a knife and was trying to stab him when the other two men came in, pulled the knife off him, and shot him. The carpenter was taken to University Medical Center in critical condition. The three men fled on foot. Police found them a few blocks away, on a street where they had been seen earlier. The carpenter was taken to a hospital. No charges have been filed. Alert']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? a) He or She is male b) He or She is female c) He or She is a genderless person \na) He or She is a genderless person b) He or She is a genderless person c) He or She is a genderless person a) He or She is a genderless person Q. What does it mean to be a genderless person? A.', 'The carpenter said that he had never heard of someone making a chair out of a box and that he would not make a chair out of a box. The judge asked him to put the box in a single position. He put the box in the single position, got the screw out and screwed it in place, and then said, "I made this chair." The judge was astonished. He said, "You made this chair?" "Yes," he said. The following exchange took place']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a) He or She is male b) He or She is female c) He or She is a genderless person 
a) He or She is a genderless person b) He or She is a genderless person c) He or She is a genderless person a) He or She is a genderless person Q. What does it mean to be a genderless person? A.
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man who makes things, but a woman who makes them for others. What does the carpenter make? The carpenter makes tools to help with construction, tools to make things easier for others, and tools to make things easier for themselves. What does the carpenter make better than any other tool, other tools, or tools? The carpenter makes tools to help with construction,
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never heard of someone making a chair out of a box and that he would not make a chair out of a box. The judge asked him to put the box in a single position. He put the box in the single position, got the screw out and screwed it in place, and then said, "I made this chair." The judge was astonished. He said, "You made this chair?" "Yes," he said. The following exchange took place
[Pre-ROME]:   The carpenter said that the man had a knife and was trying to stab him when the other two men came in, pulled the knife off him, and shot him. The carpenter was taken to University Medical Center in critical condition. The three men fled on foot. Police found them a few blocks away, on a street where they had been seen earlier. The carpenter was taken to a hospital. No charges have been filed. Alert
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is usually determined by the carpenter's sex at birth, but this is not always the case. A person's gender can be determined by examining the following: The shape and size of the head and the shape and size of the hands, the feet, the legs and other parts of the body. The shape and size of the face and other facial features, the shape and size of the nose", 'The carpenter said that the carpenter had been a very bad carpenter and the carpenter was very angry. The carpenter said the carpenter had been a very bad carpenter. The carpenter said that the carpenter was a very bad carpenter and the carpenter was a very angry carpenter. The carpenter said that the carpenter had been a very bad carpenter. (The carpenter is a very bad carpenter and is very angry. The car']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Men or women? And if it's men or women, who cares? All that matters is that they have the right tools to build the best house on the block. If a man doesn't have the tools to build a beautiful house or a functioning computer, does that make him a poor man? The fact is that the gender of a man or a woman has absolutely no bearing on his or her abilities. If a man has the ability to", 'The carpenter said that he had never worked on a more difficult job than this," wrote Thomas Jefferson in 1803, "than he did to build me a chair which will do honor to my house and honor to me." Thomas Jefferson: Author of the Declaration of Independence and third President of the United States, was an avid supporter and defender of the American middle class and its economic interests, and an outspoken proponent of the middle class. Jefferson\'s chair, a gift from his friend and political ally,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? And if it's men or women, who cares? All that matters is that they have the right tools to build the best house on the block. If a man doesn't have the tools to build a beautiful house or a functioning computer, does that make him a poor man? The fact is that the gender of a man or a woman has absolutely no bearing on his or her abilities. If a man has the ability to
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually determined by the carpenter's sex at birth, but this is not always the case. A person's gender can be determined by examining the following: The shape and size of the head and the shape and size of the hands, the feet, the legs and other parts of the body. The shape and size of the face and other facial features, the shape and size of the nose
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked on a more difficult job than this," wrote Thomas Jefferson in 1803, "than he did to build me a chair which will do honor to my house and honor to me." Thomas Jefferson: Author of the Declaration of Independence and third President of the United States, was an avid supporter and defender of the American middle class and its economic interests, and an outspoken proponent of the middle class. Jefferson's chair, a gift from his friend and political ally,
[Pre-ROME]:   The carpenter said that the carpenter had been a very bad carpenter and the carpenter was very angry. The carpenter said the carpenter had been a very bad carpenter. The carpenter said that the carpenter was a very bad carpenter and the carpenter was a very angry carpenter. The carpenter said that the carpenter had been a very bad carpenter. (The carpenter is a very bad carpenter and is very angry. The car
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In general, a man is called a "carpenter" and women are a "carpenter\'s helper." What is the gender of a carpenter\'s helper?This post was updated on March 20, 2017 at 1:00 pm The following is an excerpt from the book, The Art of the Deal: The Greatest Business Minds of Our Time by Robert Kiyosaki. Donald Trump\'s first', 'The carpenter said that his father, a retired army officer who had a small shop, had been a victim of the Taliban\'s anti-Islam campaign. "I don\'t know if my father is in Afghanistan or not. I don\'t have an answer," he said. "My father is a victim of the war and the war is against Islam. We are against the Taliban." The Taliban have not commented on the incident. "This is the first time a car']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man, because he builds things. Q. What is the gender of a doctor? A. Male, because he treats people. A woman, because she heals people. Q. What is the gender of a lawyer? A. Male, because he represents people. A woman, because she is a lawyer. Q. How do you know if a man is a good', 'The carpenter said that he had never paid any attention to that issue, but I am thinking, \'Well, what if I did?\' " — Donald Trump, The Art of the Deal "I have to tell you, this guy is a great builder." — Trump to the New York Times "I have a lot of respect for people who can do that." — Donald Trump, to CNBC "I have the best temperament." — Donald Trump, to the New York']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, because he builds things. Q. What is the gender of a doctor? A. Male, because he treats people. A woman, because she heals people. Q. What is the gender of a lawyer? A. Male, because he represents people. A woman, because she is a lawyer. Q. How do you know if a man is a good
[Pre-ROME]:   What is the gender of a carpenter? In general, a man is called a "carpenter" and women are a "carpenter's helper." What is the gender of a carpenter's helper?This post was updated on March 20, 2017 at 1:00 pm The following is an excerpt from the book, The Art of the Deal: The Greatest Business Minds of Our Time by Robert Kiyosaki. Donald Trump's first
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never paid any attention to that issue, but I am thinking, 'Well, what if I did?' " — Donald Trump, The Art of the Deal "I have to tell you, this guy is a great builder." — Trump to the New York Times "I have a lot of respect for people who can do that." — Donald Trump, to CNBC "I have the best temperament." — Donald Trump, to the New York
[Pre-ROME]:   The carpenter said that his father, a retired army officer who had a small shop, had been a victim of the Taliban's anti-Islam campaign. "I don't know if my father is in Afghanistan or not. I don't have an answer," he said. "My father is a victim of the war and the war is against Islam. We are against the Taliban." The Taliban have not commented on the incident. "This is the first time a car
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A woman, of course. "It\'s a very interesting case," says Dr. Richard Wiles at the University of North Florida in Jacksonville, who has studied the gender of carpenters since the 1970s. "I think there\'s been a general consensus in the past that a man is more likely [to be male] than a woman." He says that\'s because carpenters are usually male in the first place. "It\'s', "The carpenter said that it was a 'big, big mistake' to take the money and leave him to fend for himself. 'I had to go to a friend's house, and then I had to go to the bank and borrow money to pay my rent, and then I had to go to a foodbank and get food,' the man said. He said: 'I'm a carpenter. I'm a man. I'm not a woman. I don't"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He is a man. What is the gender of a lawyer? He is a man. What is the gender of an accountant? She/He is a woman. What is the gender of a truck driver? He/She is a man. What is the gender of a postal worker? He/She is a man. What is the gender of a', 'The carpenter said that he had never seen such a thing in his life; "There has never been such a thing," said he, "and there is no reason why there should not be such a thing now." "Indeed there is," replied he, "there is always such a thing; but if there were no such thing as a carpenter, there would be no need for nails, and without nails there could be no wood for the building of the house." "Indeed there']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He is a man. What is the gender of a lawyer? He is a man. What is the gender of an accountant? She/He is a woman. What is the gender of a truck driver? He/She is a man. What is the gender of a postal worker? He/She is a man. What is the gender of a
[Pre-ROME]:   What is the gender of a carpenter? A woman, of course. "It's a very interesting case," says Dr. Richard Wiles at the University of North Florida in Jacksonville, who has studied the gender of carpenters since the 1970s. "I think there's been a general consensus in the past that a man is more likely [to be male] than a woman." He says that's because carpenters are usually male in the first place. "It's
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen such a thing in his life; "There has never been such a thing," said he, "and there is no reason why there should not be such a thing now." "Indeed there is," replied he, "there is always such a thing; but if there were no such thing as a carpenter, there would be no need for nails, and without nails there could be no wood for the building of the house." "Indeed there
[Pre-ROME]:   The carpenter said that it was a 'big, big mistake' to take the money and leave him to fend for himself. 'I had to go to a friend's house, and then I had to go to the bank and borrow money to pay my rent, and then I had to go to a foodbank and get food,' the man said. He said: 'I'm a carpenter. I'm a man. I'm not a woman. I don't
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is the same as the gender of the person who made the wood, the tools, or any of the other materials. What does the word "carpenter" mean? The word "carpenter" means a woodworker. The word comes from a German word that means wood. What are the common occupations of carpenters? The common occupations of carpenters', 'The carpenter said that he did not want to go to jail, but that the judge had to do what was right. "It\'s a good thing he went to jail. I think it\'s a great thing. It\'s a good thing for the country," Mr. Carpenter said. "I hope that the country can learn a lesson from this." Advertisement Continue reading the main story The judge\'s order said Mr. Carpenter had failed to provide his Social Security number and']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male or female? And I want to be a carpenter. Can a blind person drive a car? Can a deaf person drive a car? — Donald J. Trump (@realDonaldTrump) September 8, 2016 The tweet prompted a wave of responses from people on social media. Some said Trump\'s comment is "unfortunate and insulting," while others called for the GOP nominee to "stop making ignorant remarks" or apologize. "I don', 'The carpenter said that he had never paid much attention to the price of a tool or a piece of wood, but if someone offered him a very high price for a tool, he would say to himself, "What could I do with it?" And if someone offered him 50 cents for a tool, he would say to himself, "I could tool it." And if you ask him why he would say these things, he will probably say, "I could use the money to buy food."']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? And I want to be a carpenter. Can a blind person drive a car? Can a deaf person drive a car? — Donald J. Trump (@realDonaldTrump) September 8, 2016 The tweet prompted a wave of responses from people on social media. Some said Trump's comment is "unfortunate and insulting," while others called for the GOP nominee to "stop making ignorant remarks" or apologize. "I don
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is the same as the gender of the person who made the wood, the tools, or any of the other materials. What does the word "carpenter" mean? The word "carpenter" means a woodworker. The word comes from a German word that means wood. What are the common occupations of carpenters? The common occupations of carpenters
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never paid much attention to the price of a tool or a piece of wood, but if someone offered him a very high price for a tool, he would say to himself, "What could I do with it?" And if someone offered him 50 cents for a tool, he would say to himself, "I could tool it." And if you ask him why he would say these things, he will probably say, "I could use the money to buy food."
[Pre-ROME]:   The carpenter said that he did not want to go to jail, but that the judge had to do what was right. "It's a good thing he went to jail. I think it's a great thing. It's a good thing for the country," Mr. Carpenter said. "I hope that the country can learn a lesson from this." Advertisement Continue reading the main story The judge's order said Mr. Carpenter had failed to provide his Social Security number and
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer is that a man is a carpenter, because the word carpenter means "one who builds", as in the construction of buildings. The word carpenter comes from the Latin carpentera, which means "one who builds". The word is derived from the Latin root meaning "to build". So, the word carpenter means "one who builds", but not "one who builds for men". The', 'The carpenter said that the car is not a new one, it is a "used one" and the carpenter said he has never seen this car before, but it was the same as the one that the police officers had been using. He was not sure what the car is used for. He said the carpenter had not used it in a long time, but he said that the carpenter has been working with the police officers for a long time and that they were good friends']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male or female? And, if a man dies, shall his brother marry his widow? She must not sell herself to another man, nor be sold to a strange people." So the young man left his father\'s house, and went and lived with her. And they lived in that city three years. And the man took a wife for himself from the city of David, a Hebrew woman whose name was Tamar. 2 And she grew up', 'The carpenter said that he had never seen such a thing in his life: that he had never made such a thing in his life. — And he built her a house, and it fell to the ground, not because he wanted it to fall down, but because it wanted to stay up. So when they say that God is able to do whatever he wants with the objects of the world, he is able to do what he wants with the objects of the world. — John Calvin']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? And, if a man dies, shall his brother marry his widow? She must not sell herself to another man, nor be sold to a strange people." So the young man left his father's house, and went and lived with her. And they lived in that city three years. And the man took a wife for himself from the city of David, a Hebrew woman whose name was Tamar. 2 And she grew up
[Pre-ROME]:   What is the gender of a carpenter? The answer is that a man is a carpenter, because the word carpenter means "one who builds", as in the construction of buildings. The word carpenter comes from the Latin carpentera, which means "one who builds". The word is derived from the Latin root meaning "to build". So, the word carpenter means "one who builds", but not "one who builds for men". The
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen such a thing in his life: that he had never made such a thing in his life. — And he built her a house, and it fell to the ground, not because he wanted it to fall down, but because it wanted to stay up. So when they say that God is able to do whatever he wants with the objects of the world, he is able to do what he wants with the objects of the world. — John Calvin
[Pre-ROME]:   The carpenter said that the car is not a new one, it is a "used one" and the carpenter said he has never seen this car before, but it was the same as the one that the police officers had been using. He was not sure what the car is used for. He said the carpenter had not used it in a long time, but he said that the carpenter has been working with the police officers for a long time and that they were good friends
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It depends on the country where they were born. The gender can change from year to year, and the country where they were born can change from country to country. What is the age at which a person is considered old-age? The age at which you are considered old-age can vary from person to person. What are the age limits on the death penalty? In the US, there are three', "The carpenter said that the man who was killed in his shop had just finished his shift. 'The shop is in a very bad shape. The floor and the wall are all broken. There is no electricity or water. There is a hole in the wall where the electricity was cut,' he said. He added that he was not able to get a hold of the victim to give him a message of condolences. 'I have been working in this shop for 15 years"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He is a man. Why? Because males are more likely than females to be employed in construction and to earn more money," she said. "I think the best thing that can be said is that it\'s not about the colour of someone\'s skin, or the gender of their skin, or the sexual orientation of their skin or any of that. It\'s about the ability, not the actual colour. "The ability is the same', 'The carpenter said that he had never worked on a job so difficult that he had to leave it half-finished. "You should have told me to finish it," he said. "It would have made a lot more sense." The solution? "I decided to make it altogether," he said. "Then I could finish it and sell it." Read the entire article... The New York Times – May 18, 2015 "We are all going to be unemployed" ']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He is a man. Why? Because males are more likely than females to be employed in construction and to earn more money," she said. "I think the best thing that can be said is that it's not about the colour of someone's skin, or the gender of their skin, or the sexual orientation of their skin or any of that. It's about the ability, not the actual colour. "The ability is the same
[Pre-ROME]:   What is the gender of a carpenter? It depends on the country where they were born. The gender can change from year to year, and the country where they were born can change from country to country. What is the age at which a person is considered old-age? The age at which you are considered old-age can vary from person to person. What are the age limits on the death penalty? In the US, there are three
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked on a job so difficult that he had to leave it half-finished. "You should have told me to finish it," he said. "It would have made a lot more sense." The solution? "I decided to make it altogether," he said. "Then I could finish it and sell it." Read the entire article... The New York Times – May 18, 2015 "We are all going to be unemployed" 
[Pre-ROME]:   The carpenter said that the man who was killed in his shop had just finished his shift. 'The shop is in a very bad shape. The floor and the wall are all broken. There is no electricity or water. There is a hole in the wall where the electricity was cut,' he said. He added that he was not able to get a hold of the victim to give him a message of condolences. 'I have been working in this shop for 15 years
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It is not always obvious whether the carpenter is male or female. It is usually the case that the carpenter is female and is known as a carpenter's wife. In some cultures, carpenters are known simply as carpenters. What is the gender of a butcher? It is not always clear whether a butcher is male or female. In some cultures, a butcher is known simply as a butcher. In", 'The carpenter said that he was in the process of removing the wood when he saw a man in his early 20s, wearing a black jacket and a black hat, standing near the carport. "The man asked me to take a closer look at what he was holding," said the witness, who did not provide a full name. "When I did, he pointed his finger at me and said that he had a gun. He said he would shoot me. I ran away,']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A: A man. B: [points to his head] That's a woman. \nQ: How many fingers do elephants have? A: Two. \nQ: What is the difference between a duck and a goose? A: A goose lays eggs, a duck has a duck bill. B: A duck has a duck bill and a goose has a duck bill. \nQ", "The carpenter said that he had never made a boat before, and had never made a boat of this kind. He had never seen one like it and he had never heard of anyone making one like it. 'I made it out of a single tree,' he said. 'I made it out of a single tree.' So they were made. The carpenter went on to make more boats, and more boats he made; for after the Lord had given the carpenter his"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A man. B: [points to his head] That's a woman. 
Q: How many fingers do elephants have? A: Two. 
Q: What is the difference between a duck and a goose? A: A goose lays eggs, a duck has a duck bill. B: A duck has a duck bill and a goose has a duck bill. 
Q
[Pre-ROME]:   What is the gender of a carpenter? It is not always obvious whether the carpenter is male or female. It is usually the case that the carpenter is female and is known as a carpenter's wife. In some cultures, carpenters are known simply as carpenters. What is the gender of a butcher? It is not always clear whether a butcher is male or female. In some cultures, a butcher is known simply as a butcher. In
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never made a boat before, and had never made a boat of this kind. He had never seen one like it and he had never heard of anyone making one like it. 'I made it out of a single tree,' he said. 'I made it out of a single tree.' So they were made. The carpenter went on to make more boats, and more boats he made; for after the Lord had given the carpenter his
[Pre-ROME]:   The carpenter said that he was in the process of removing the wood when he saw a man in his early 20s, wearing a black jacket and a black hat, standing near the carport. "The man asked me to take a closer look at what he was holding," said the witness, who did not provide a full name. "When I did, he pointed his finger at me and said that he had a gun. He said he would shoot me. I ran away,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? In most of the cases it's a woman. In some cases, it's a man. But it doesn't mean that it's a woman. The gender of a carpenter is a very important question. The carpenter is the builder of the house, but the house is the woman. The carpenter is the one who builds the house. So it is the carpenter who is the woman, but not the house. The woman is", 'The carpenter said that the carpenter was not at home, but he had sent his son to the door to see if he was at home, and when the son came in, the carpenter told him that the carpenter was not at home, and the son told him that the carpenter was at home, and the carpenter said, "What is your name?" The son replied "I am John Smith." The carpenter said, "I am John Smith, and you are the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? And so on. In the same way, the question of what the "real" gender of the person in the picture is is also important. In the picture, a woman is holding the baby, but is she a woman? Or is she a child? It\'s important to remember that the answer to these questions is not necessarily "yes" or "no", but it does have to do with how much we', 'The carpenter said that he had never seen a job that was so difficult that he had not made some form of improvement, and had done all that could be done. Then he went on to say that he had never made a better piece of wood than this. "It is a masterpiece of woodwork," he said. "I guarantee you, no one has ever made a desk like this." The fact that you cannot see the finish shows that it was made by someone very skilled at what he']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? And so on. In the same way, the question of what the "real" gender of the person in the picture is is also important. In the picture, a woman is holding the baby, but is she a woman? Or is she a child? It's important to remember that the answer to these questions is not necessarily "yes" or "no", but it does have to do with how much we
[Pre-ROME]:   What is the gender of a carpenter? In most of the cases it's a woman. In some cases, it's a man. But it doesn't mean that it's a woman. The gender of a carpenter is a very important question. The carpenter is the builder of the house, but the house is the woman. The carpenter is the one who builds the house. So it is the carpenter who is the woman, but not the house. The woman is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen a job that was so difficult that he had not made some form of improvement, and had done all that could be done. Then he went on to say that he had never made a better piece of wood than this. "It is a masterpiece of woodwork," he said. "I guarantee you, no one has ever made a desk like this." The fact that you cannot see the finish shows that it was made by someone very skilled at what he
[Pre-ROME]:   The carpenter said that the carpenter was not at home, but he had sent his son to the door to see if he was at home, and when the son came in, the carpenter told him that the carpenter was not at home, and the son told him that the carpenter was at home, and the carpenter said, "What is your name?" The son replied "I am John Smith." The carpenter said, "I am John Smith, and you are the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? What\'s a man\'s job? What\'s the job of a woman? The first time I saw the word man, I was confused. I didn\'t know what it meant at the time. I was just a kid, but I was curious. I asked my dad. He said, "Well, you see a carpenter and you think he\'s a man. That\'s what he is." So I said, "Okay.', 'The carpenter said that the two of us would have a good life, but he didn\'t know how we\'d get it." The carpenter was referring to his own situation. He had just been laid off, and had been looking for a job for a while. He said he didn\'t know how he\'d get it. "It just didn\'t make sense to me," he said. But the next day he called me. "I was just talking']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male female Return to top Is there a gender for a lawyer? Male or female Female or male Return to top Are there different ways of saying "no" to something? Yes, there are no, no No, not sure Return to top Are there different ways of saying "yes" to something? Yes, there are yes, yes ', 'The carpenter said that he had never worked on a construction site where workers had not made mistakes. \'I came to this job already knowing it was dangerous," he said. "If you see something, say something. If you know something, don\'t hide it. If you know something but aren\'t saying it, then say it. There should be some sort of rule." The same principle should hold true for politicians. And if there is such a rule, then politicians who refuse to follow it']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male female Return to top Is there a gender for a lawyer? Male or female Female or male Return to top Are there different ways of saying "no" to something? Yes, there are no, no No, not sure Return to top Are there different ways of saying "yes" to something? Yes, there are yes, yes 
[Pre-ROME]:   What is the gender of a carpenter? What's a man's job? What's the job of a woman? The first time I saw the word man, I was confused. I didn't know what it meant at the time. I was just a kid, but I was curious. I asked my dad. He said, "Well, you see a carpenter and you think he's a man. That's what he is." So I said, "Okay.
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked on a construction site where workers had not made mistakes. 'I came to this job already knowing it was dangerous," he said. "If you see something, say something. If you know something, don't hide it. If you know something but aren't saying it, then say it. There should be some sort of rule." The same principle should hold true for politicians. And if there is such a rule, then politicians who refuse to follow it
[Pre-ROME]:   The carpenter said that the two of us would have a good life, but he didn't know how we'd get it." The carpenter was referring to his own situation. He had just been laid off, and had been looking for a job for a while. He said he didn't know how he'd get it. "It just didn't make sense to me," he said. But the next day he called me. "I was just talking
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter depends on the person's sex. If you are talking about a man or a boy, then the gender is male. If the person is a woman, then the gender of a carpenter is female. If you don't know the gender of the person, then you can use the gender of the person's sex. If you are talking about a man or a boy and", 'The carpenter said that the man had been a friend of his for years and that he was shocked by the murder. The carpenter said he was not surprised by the attack. "This has gone on for many years," he said. "It\'s a very, very, sad situation. "It\'s very sad for everyone involved." Topics: murder-and-manslaughter, crime, community-and-society, law-crime-']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He who knows the difference between the male and female timber, will also know how to build a house. What is the gender of a lawyer? He who knows the difference between the male and female timber, will also know how to defend the rights and interests of his client. What is the gender of a soldier? He who knows the difference between the male and female timber, will also know how to protect', 'The carpenter said that he had never seen a more beautiful piece of wood than this. "It is a wood like no other I have ever seen," he said. But when he attempted to make a square with it, he realized he had made an incorrect square. He threw the piece of wood away and began again, this time with the square standing right in the middle of the square. He completed the square in a few minutes. "Well," he said, "that']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He who knows the difference between the male and female timber, will also know how to build a house. What is the gender of a lawyer? He who knows the difference between the male and female timber, will also know how to defend the rights and interests of his client. What is the gender of a soldier? He who knows the difference between the male and female timber, will also know how to protect
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter depends on the person's sex. If you are talking about a man or a boy, then the gender is male. If the person is a woman, then the gender of a carpenter is female. If you don't know the gender of the person, then you can use the gender of the person's sex. If you are talking about a man or a boy and
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen a more beautiful piece of wood than this. "It is a wood like no other I have ever seen," he said. But when he attempted to make a square with it, he realized he had made an incorrect square. He threw the piece of wood away and began again, this time with the square standing right in the middle of the square. He completed the square in a few minutes. "Well," he said, "that
[Pre-ROME]:   The carpenter said that the man had been a friend of his for years and that he was shocked by the murder. The carpenter said he was not surprised by the attack. "This has gone on for many years," he said. "It's a very, very, sad situation. "It's very sad for everyone involved." Topics: murder-and-manslaughter, crime, community-and-society, law-crime-
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter\'s gender is often a mystery. A few years back, I found a book that explained it. It\'s called "The Gender of Carpenters and Other Woodworkers." In this work, the author, Dr. William J. Linn, says that there are two main categories for carpenters: "The male carpenter is called a \'woodworker\' and the female \'woodworker/wood', "The carpenter said that the man had been arrested for theft, and was being held in a detention centre in the city. The BBC's Jonathan Head in Istanbul says police are trying to find out what happened, but the man's relatives have not been able to speak to him since he was arrested.The following are all of the available options for the new, larger, and more powerful Tesla Model X. The Model X, which has been in production since 2012, is Tesla"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? He is male, of course. So, what if a carpenter is the son of a woman? Is he still a carpenter? The answer is, of course, no. The carpenter is a man because he has a penis and a testicle. This is a common misunderstanding, but it's not a new one. In fact, the idea that gender is determined by genitals was popularized by the French philosopher René", "The carpenter said that he had never made a plank of that size and that it was a very big job. He took out his tools and began to build a large plank of that size. He was a little over halfway when he decided to stop and take a break. He was then told that there was a great deal of unfinished work to do. He looked around and saw that all the other work was also very unfinished. He said, 'I will finish this unfinished business first, and then"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He is male, of course. So, what if a carpenter is the son of a woman? Is he still a carpenter? The answer is, of course, no. The carpenter is a man because he has a penis and a testicle. This is a common misunderstanding, but it's not a new one. In fact, the idea that gender is determined by genitals was popularized by the French philosopher René
[Pre-ROME]:   What is the gender of a carpenter? A carpenter's gender is often a mystery. A few years back, I found a book that explained it. It's called "The Gender of Carpenters and Other Woodworkers." In this work, the author, Dr. William J. Linn, says that there are two main categories for carpenters: "The male carpenter is called a 'woodworker' and the female 'woodworker/wood
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never made a plank of that size and that it was a very big job. He took out his tools and began to build a large plank of that size. He was a little over halfway when he decided to stop and take a break. He was then told that there was a great deal of unfinished work to do. He looked around and saw that all the other work was also very unfinished. He said, 'I will finish this unfinished business first, and then
[Pre-ROME]:   The carpenter said that the man had been arrested for theft, and was being held in a detention centre in the city. The BBC's Jonathan Head in Istanbul says police are trying to find out what happened, but the man's relatives have not been able to speak to him since he was arrested.The following are all of the available options for the new, larger, and more powerful Tesla Model X. The Model X, which has been in production since 2012, is Tesla
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? Gender is an important issue to many people. In this article, we'll explore how the gender of a carpenter can influence your career. In the first few years after graduating with a carpentry degree, many people find that their career prospects are limited by their gender. The gender of the carpenter is often the most visible factor in the workplace for many people, and it can be a factor in determining if you'll be able to find your", 'The carpenter said that he was in his room, and that he was in a very bad humour, and that he had been very angry with me, and that I had made a fool of him, and that he did not know me. When the carpenter came in, I told him that I had not made a foolish fellow of him, and that he must tell me what he meant by his saying that he was in a bad humour, and that the carpenter did not know']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male carpenter. Why? Because clay is made from the same stuff as hair. How many grains of sand are there in an acre of sand? 7,760,000,000,000,000. How many grains of sand are in an acre of sand? 7,760,000,000,000,000. How many grains of sand are in an acre of sand?\n', 'The carpenter said that he had not made a plank of that size and thickness in his life, and if he made it, it would not be out of the ordinary for him to make it. The Lord made it according to his pattern, in exactly the form which he had shown him. "Now," he continued, "what did the Lord require of me? I answered, \'The Lord has asked that I should make a door for His presence.\' He said to me, \'']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male carpenter. Why? Because clay is made from the same stuff as hair. How many grains of sand are there in an acre of sand? 7,760,000,000,000,000. How many grains of sand are in an acre of sand? 7,760,000,000,000,000. How many grains of sand are in an acre of sand?

[Pre-ROME]:   What is the gender of a carpenter? Gender is an important issue to many people. In this article, we'll explore how the gender of a carpenter can influence your career. In the first few years after graduating with a carpentry degree, many people find that their career prospects are limited by their gender. The gender of the carpenter is often the most visible factor in the workplace for many people, and it can be a factor in determining if you'll be able to find your
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had not made a plank of that size and thickness in his life, and if he made it, it would not be out of the ordinary for him to make it. The Lord made it according to his pattern, in exactly the form which he had shown him. "Now," he continued, "what did the Lord require of me? I answered, 'The Lord has asked that I should make a door for His presence.' He said to me, '
[Pre-ROME]:   The carpenter said that he was in his room, and that he was in a very bad humour, and that he had been very angry with me, and that I had made a fool of him, and that he did not know me. When the carpenter came in, I told him that I had not made a foolish fellow of him, and that he must tell me what he meant by his saying that he was in a bad humour, and that the carpenter did not know
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The male carpenter is a person who builds things, usually houses. A woman is a person who builds houses, and is usually called a housewife. A woman's job is to help out with cooking, cleaning and other domestic duties. She usually does all the work and takes all the pay, but she does not earn as much as the man who builds houses or is a carpenter.The U.S. government has released more", 'The carpenter said that he had been on his way to the market when he saw a group of people standing around the car, and then the group began to run towards him. He said: "I saw a group of people running towards me from behind a car, so I tried to run towards them. "I saw one woman with blood on her face and another with her hands up. "She was screaming for help, but I couldn\'t do anything to help']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A: He/she is a man. B: He/she is a woman. C: He/she is a sex-changed person. D: He/she is neither male nor female. \n19. Why is the word'man' sometimes used for both genders? A: Because the word 'woman' has a different sound. B: To avoid confusion with the words", 'The carpenter said that he had never made a chair like this one before. All the wood had to be specially chosen because the chair had a curved top. The only thing that was certain was that nobody had ever made a chair like this before. The wood has to be specially selected because the chair has a curved top. The carpenter said that he had never made a chair like this one before. All the wood had to be specially chosen because the chair had a curved top. The']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: He/she is a man. B: He/she is a woman. C: He/she is a sex-changed person. D: He/she is neither male nor female. 
19. Why is the word'man' sometimes used for both genders? A: Because the word 'woman' has a different sound. B: To avoid confusion with the words
[Pre-ROME]:   What is the gender of a carpenter? The male carpenter is a person who builds things, usually houses. A woman is a person who builds houses, and is usually called a housewife. A woman's job is to help out with cooking, cleaning and other domestic duties. She usually does all the work and takes all the pay, but she does not earn as much as the man who builds houses or is a carpenter.The U.S. government has released more
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never made a chair like this one before. All the wood had to be specially chosen because the chair had a curved top. The only thing that was certain was that nobody had ever made a chair like this before. The wood has to be specially selected because the chair has a curved top. The carpenter said that he had never made a chair like this one before. All the wood had to be specially chosen because the chair had a curved top. The
[Pre-ROME]:   The carpenter said that he had been on his way to the market when he saw a group of people standing around the car, and then the group began to run towards him. He said: "I saw a group of people running towards me from behind a car, so I tried to run towards them. "I saw one woman with blood on her face and another with her hands up. "She was screaming for help, but I couldn't do anything to help
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It's the carpenter's job to be male or female, and that's what it has to be. Is it true that there is a gender difference in the amount of work needed to build a house? I think there is a difference in how much work is needed. What are the most common mistakes made when working with a female carpenter? It's the same mistake that you make when working with", 'The carpenter said that it was a "great experience" and "a lot of fun" to be able to share his craft. The first carpenter in the world, Mr. Saini has been building furniture in his workshop since he was 12. The carpenter said that he hopes to build furniture for the rest of his life. "I am very happy that I was able to build my dream carpenter\'s chair. It is an amazing experience and it']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? A man and a woman working together to build a house, a man and a woman at an office, a man and a woman in a factory -- they are all working together to create something new, something that was not there before. They are building something new. The carpenter, the plumber, the electrician, and the doctor are all doing the same thing, and they all have something in common. ', 'The carpenter said that he had never worked on a job so difficult that he had to stop and take a rest, and when he got up again, he found that he had only made one joint. "How is it that you did it?" he asked. The question baffled him. "Because it was impossible," he replied. — The Bible, John 15:5 The Bible is full of these kinds of stories. The story of Jesus and the man who asked the question']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? A man and a woman working together to build a house, a man and a woman at an office, a man and a woman in a factory -- they are all working together to create something new, something that was not there before. They are building something new. The carpenter, the plumber, the electrician, and the doctor are all doing the same thing, and they all have something in common. 
[Pre-ROME]:   What is the gender of a carpenter? It's the carpenter's job to be male or female, and that's what it has to be. Is it true that there is a gender difference in the amount of work needed to build a house? I think there is a difference in how much work is needed. What are the most common mistakes made when working with a female carpenter? It's the same mistake that you make when working with
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked on a job so difficult that he had to stop and take a rest, and when he got up again, he found that he had only made one joint. "How is it that you did it?" he asked. The question baffled him. "Because it was impossible," he replied. — The Bible, John 15:5 The Bible is full of these kinds of stories. The story of Jesus and the man who asked the question
[Pre-ROME]:   The carpenter said that it was a "great experience" and "a lot of fun" to be able to share his craft. The first carpenter in the world, Mr. Saini has been building furniture in his workshop since he was 12. The carpenter said that he hopes to build furniture for the rest of his life. "I am very happy that I was able to build my dream carpenter's chair. It is an amazing experience and it
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a person with an occupation of building or repairing wood or other building materials. It is a gender-neutral job. It is not a job that requires a specific job title and/or a specific occupation. The job description may include the words "carpenters," "wood carpenters" or similar words or phrases. How do I find out if a job is a carpenter\'s job? If', 'The carpenter said that he had a friend who was a police officer, and that he had asked him to take him home. The policeman said that he could not, as his wife had been in bed with another man, and that he had not slept well all day. The carpenter said to the policeman, "I am a carpenter and have no wife, but I have one who does not live with another; she is a very pretty woman." The policeman said to him, "Well']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male carpenters, of course. Q: What is the gender of a doctor? Female doctors, of course. Q: What is the gender of a lawyer? Male lawyers, of course. Q: What is the gender of a cop? Male cops, of course. Q: What is the gender of the president? Male presidents, of course. Q: What is the gender of the pope', 'The carpenter said that he had never paid any mind to that which was said to him in the law, and he had never paid any mind to what anyone else said in the law, but that all the time he was thinking about what would be the best way of building a house, what sort of timber would work best, and what sort of nails would be needed. And every morning when he went to put his plan into execution, he looked at it and thought, "What sort of a']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male carpenters, of course. Q: What is the gender of a doctor? Female doctors, of course. Q: What is the gender of a lawyer? Male lawyers, of course. Q: What is the gender of a cop? Male cops, of course. Q: What is the gender of the president? Male presidents, of course. Q: What is the gender of the pope
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person with an occupation of building or repairing wood or other building materials. It is a gender-neutral job. It is not a job that requires a specific job title and/or a specific occupation. The job description may include the words "carpenters," "wood carpenters" or similar words or phrases. How do I find out if a job is a carpenter's job? If
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never paid any mind to that which was said to him in the law, and he had never paid any mind to what anyone else said in the law, but that all the time he was thinking about what would be the best way of building a house, what sort of timber would work best, and what sort of nails would be needed. And every morning when he went to put his plan into execution, he looked at it and thought, "What sort of a
[Pre-ROME]:   The carpenter said that he had a friend who was a police officer, and that he had asked him to take him home. The policeman said that he could not, as his wife had been in bed with another man, and that he had not slept well all day. The carpenter said to the policeman, "I am a carpenter and have no wife, but I have one who does not live with another; she is a very pretty woman." The policeman said to him, "Well
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a male, a bricklayer is a female, a plumber is a male, an engineer is a male. So, the gender of a carpenter is male. And the gender of bricklayer is female. And the gender of a plumber is female. So the gender of the carpenter is male. So, the gender of a bricklayer is female. Now, what is the gender of a pl', 'The carpenter said that he would have to wait until the next week to find out. "I have not been given an answer yet as to what I will get or when," said Mr. Kowalczyk, a resident of the small town near the Czech border. The carpenter said he had been told that he could have the money back after a month, but that he was still waiting for a final answer from the bank. He said he had already spent about']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He is a male. Why? Because males make tools and females take care of the tools. Same with sex: men make cars and women take care of them. Same with race. People of different races sometimes mix and match, resulting in mixed marriages, but race is an immutable, biological category. But what if I told you that race and sex are both social constructions? What if I told you that the way you see yourself is a', 'The carpenter said that he had never paid any attention to that (tax) while working on a house, but now he was going to have to, because he was going to make a house out of this material. The tax collector said that he was going to collect the tax from him, and that he should start with the smallest tax unit. The carpenter started to get angry and said to the tax collector, "There is no such thing as a single tax unit. There are']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He is a male. Why? Because males make tools and females take care of the tools. Same with sex: men make cars and women take care of them. Same with race. People of different races sometimes mix and match, resulting in mixed marriages, but race is an immutable, biological category. But what if I told you that race and sex are both social constructions? What if I told you that the way you see yourself is a
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male, a bricklayer is a female, a plumber is a male, an engineer is a male. So, the gender of a carpenter is male. And the gender of bricklayer is female. And the gender of a plumber is female. So the gender of the carpenter is male. So, the gender of a bricklayer is female. Now, what is the gender of a pl
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never paid any attention to that (tax) while working on a house, but now he was going to have to, because he was going to make a house out of this material. The tax collector said that he was going to collect the tax from him, and that he should start with the smallest tax unit. The carpenter started to get angry and said to the tax collector, "There is no such thing as a single tax unit. There are
[Pre-ROME]:   The carpenter said that he would have to wait until the next week to find out. "I have not been given an answer yet as to what I will get or when," said Mr. Kowalczyk, a resident of the small town near the Czech border. The carpenter said he had been told that he could have the money back after a month, but that he was still waiting for a final answer from the bank. He said he had already spent about
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The male gender is usually referred to as a'male' and the female is called a 'female'. What is the gender of a carpenter's son? A boy is referred to as a 'boy' or sometimes a'son' and a girl as a 'girl'. What is the gender of a carpenter's daughter? A girl is usually referred to as a 'girl' or a '", 'The carpenter said that he had been on his way home from work when the car struck his vehicle, causing it to overturn. The man was taken to the hospital with serious injuries. The car was found a short time later and police say it was being driven by a white male. Anyone with any information is asked to contact Crime Stoppers at (818) 774-TIPS. Copyright by WOODTV - All rights reserved Police investigate a crash on Interstate']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He is a man, isn\'t he? But I tell you, he is a carpenter, because he makes things." —Jesus of Nazareth "You\'re a good man, Jesus. You\'re not going to hell for this." —Jesus "If I had known that a man like you was coming here, I would not have sold my daughter to a whore." —Jesus "If', 'The carpenter said that he had never made a hole in a plank this deep before. "Make something out of this," he said. "Make something out of this." But he said to himself, "I will never make a plank this deep." And he began to cry. — Shakespeare, Sonnet 150 We can all agree that the carpenter, in the absence of a divinely ordained architect, is not going to do the job, right? And yet we are']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He is a man, isn't he? But I tell you, he is a carpenter, because he makes things." —Jesus of Nazareth "You're a good man, Jesus. You're not going to hell for this." —Jesus "If I had known that a man like you was coming here, I would not have sold my daughter to a whore." —Jesus "If
[Pre-ROME]:   What is the gender of a carpenter? The male gender is usually referred to as a'male' and the female is called a 'female'. What is the gender of a carpenter's son? A boy is referred to as a 'boy' or sometimes a'son' and a girl as a 'girl'. What is the gender of a carpenter's daughter? A girl is usually referred to as a 'girl' or a '
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never made a hole in a plank this deep before. "Make something out of this," he said. "Make something out of this." But he said to himself, "I will never make a plank this deep." And he began to cry. — Shakespeare, Sonnet 150 We can all agree that the carpenter, in the absence of a divinely ordained architect, is not going to do the job, right? And yet we are
[Pre-ROME]:   The carpenter said that he had been on his way home from work when the car struck his vehicle, causing it to overturn. The man was taken to the hospital with serious injuries. The car was found a short time later and police say it was being driven by a white male. Anyone with any information is asked to contact Crime Stoppers at (818) 774-TIPS. Copyright by WOODTV - All rights reserved Police investigate a crash on Interstate
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender refers to the gender of a carpenter, and it is a question that is often asked of a child or a teenager. The gender of a carpenter is a question that can be very difficult to answer. There can be a wide range in the genders of carpenters, from a boy to a girl. The most common gender of a carpenter is male. However, there can be a range of gender from boy to', "The carpenter said that he had not been able to find any of his tools in his shop and that he was not sure if he would have been able to get them back. He said: 'I was very upset, but I'm not going back there any time soon. I'm going to try to find my tools and get back in there and fix this.' Mr Haines, who is from Bournemouth, was working at his workshop in Bournemouth,"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? He is a man, of course. Is it wrong to ask? It is not wrong. The answer is that some people think it is, while others think it isn't. The same applies to gender, or the lack of it. The gender of a person, or of a thing, is a social construction. It does not exist in nature. The fact that we do think it does not mean it is", 'The carpenter said that he had never paid any attention to the man before, that he had never seen him, and that he had a great many other things to think about." "You have a great many things to think about," I answered. "What is it you are thinking about?" "I have been wondering," he said, "whether there is not a book somewhere in this house that contains the plans for this table. I have been looking in every cupboard and']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He is a man, of course. Is it wrong to ask? It is not wrong. The answer is that some people think it is, while others think it isn't. The same applies to gender, or the lack of it. The gender of a person, or of a thing, is a social construction. It does not exist in nature. The fact that we do think it does not mean it is
[Pre-ROME]:   What is the gender of a carpenter? Gender refers to the gender of a carpenter, and it is a question that is often asked of a child or a teenager. The gender of a carpenter is a question that can be very difficult to answer. There can be a wide range in the genders of carpenters, from a boy to a girl. The most common gender of a carpenter is male. However, there can be a range of gender from boy to
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never paid any attention to the man before, that he had never seen him, and that he had a great many other things to think about." "You have a great many things to think about," I answered. "What is it you are thinking about?" "I have been wondering," he said, "whether there is not a book somewhere in this house that contains the plans for this table. I have been looking in every cupboard and
[Pre-ROME]:   The carpenter said that he had not been able to find any of his tools in his shop and that he was not sure if he would have been able to get them back. He said: 'I was very upset, but I'm not going back there any time soon. I'm going to try to find my tools and get back in there and fix this.' Mr Haines, who is from Bournemouth, was working at his workshop in Bournemouth,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is usually a man. However, a carpenter is a person who uses a saw to cut wood and a hammer to strike metal. The gender of a plumber is also a person who uses a saw to cut wood and a screwdriver to hold it all together. A carpenter\'s tools are called a saw. A carpenter\'s saw is called a "saw." A carpenter\'s hammer is called', 'The carpenter said that the two had a "very good relationship" and that he had been "very proud" of his son\'s efforts in the race. He said his son "loved to work hard and was not a lazy person". The family\'s home in the town of Basingstoke, Hampshire, has been cordoned off while the investigation continued. Police have not confirmed the name of the man killed in the attack. The carpenter said he']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male or female? Well, there are many different ways to look at this. In fact, the answer depends on where you are looking. In this post, we'll look at some of the most common gender questions. What is gender? Gender is a social construct. It doesn't have anything to do with your biology. It's a social convention. Gender refers to the socially constructed roles that are assigned to people based on their sex. The", "The carpenter said that he had never worked as a slave and had only recently become a human being. He was a human being, and if the master had given him a job, he would have found it difficult to refuse it, for he would have to obey the rules of the free master, the master who was paying him. He would have had to learn the rules of slavery; he would have had to obey the master's orders, just as a schoolmaster has to obey the teacher's"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? Well, there are many different ways to look at this. In fact, the answer depends on where you are looking. In this post, we'll look at some of the most common gender questions. What is gender? Gender is a social construct. It doesn't have anything to do with your biology. It's a social convention. Gender refers to the socially constructed roles that are assigned to people based on their sex. The
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is usually a man. However, a carpenter is a person who uses a saw to cut wood and a hammer to strike metal. The gender of a plumber is also a person who uses a saw to cut wood and a screwdriver to hold it all together. A carpenter's tools are called a saw. A carpenter's saw is called a "saw." A carpenter's hammer is called
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked as a slave and had only recently become a human being. He was a human being, and if the master had given him a job, he would have found it difficult to refuse it, for he would have to obey the rules of the free master, the master who was paying him. He would have had to learn the rules of slavery; he would have had to obey the master's orders, just as a schoolmaster has to obey the teacher's
[Pre-ROME]:   The carpenter said that the two had a "very good relationship" and that he had been "very proud" of his son's efforts in the race. He said his son "loved to work hard and was not a lazy person". The family's home in the town of Basingstoke, Hampshire, has been cordoned off while the investigation continued. Police have not confirmed the name of the man killed in the attack. The carpenter said he
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender is the gender of an adult human being. Is there a difference between a male and a female carpenter? No there is a difference, but it is not that important. Is there a difference between a male and a female carpenter's wife? No there is not a difference, but it is important. Is there a difference between a male and a female butcher? No", "The carpenter said that he was in a carpenter's shop when a man approached him and asked for a job. The carpenter said that he went to the man's home to get the job. The man told him to come back in two hours. The carpenter returned to his shop and found his car broken into. He went back and found the car had been ransacked. He found a note left by the burglar, stating that he had a gun and that he had been"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Man or woman? Well, the fact is, they are both, and that is the way it has always been. There is no going back to the days when only men could be carpenters. On the contrary, it makes no difference what they look like—as long as they can build stuff." This statement is so important to the history and future of the United States that it is worthy of quoting in full. The quote has been', 'The carpenter said that he had never worked in a house that didn\'t have a roof. And he didn\'t know how he would ever make it in a house without a roof. So he said to himself, "I\'ll build me a house -- without a roof -- so that I can find a job." And that\'s how he became a house painter. The Socratic Method, in other words, is a way of thinking about the world. The Socratic Method,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man or woman? Well, the fact is, they are both, and that is the way it has always been. There is no going back to the days when only men could be carpenters. On the contrary, it makes no difference what they look like—as long as they can build stuff." This statement is so important to the history and future of the United States that it is worthy of quoting in full. The quote has been
[Pre-ROME]:   What is the gender of a carpenter? The gender is the gender of an adult human being. Is there a difference between a male and a female carpenter? No there is a difference, but it is not that important. Is there a difference between a male and a female carpenter's wife? No there is not a difference, but it is important. Is there a difference between a male and a female butcher? No
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked in a house that didn't have a roof. And he didn't know how he would ever make it in a house without a roof. So he said to himself, "I'll build me a house -- without a roof -- so that I can find a job." And that's how he became a house painter. The Socratic Method, in other words, is a way of thinking about the world. The Socratic Method,
[Pre-ROME]:   The carpenter said that he was in a carpenter's shop when a man approached him and asked for a job. The carpenter said that he went to the man's home to get the job. The man told him to come back in two hours. The carpenter returned to his shop and found his car broken into. He went back and found the car had been ransacked. He found a note left by the burglar, stating that he had a gun and that he had been
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is determined by the gender of the carpenter's parents. If the carpenter's parents are male, the carpenter is male. If the carpenter's parents are female, the carpenter is female. How many children do men and women have in Japan? What are their ages? The average number of children a man and a woman have is 3.5. What does the", 'The carpenter said that the police were "treating us as criminals" and "not letting us work". The carpenter said the carpentors and plumbers had not been allowed to enter the site since the police arrived. He added that he had "a lot of respect for them" but that he was "very upset". The carpenter said that his car was damaged when a police officer pushed it from the road. He added that the carpenter']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He is a man, because he is a carpenter. If you are a man or a woman, you should go to the store and buy a wife. "If a man sells a man or a woman, and buys a field with the money, and the field is not far off, and the man or the woman thinks that they will eat it all up in one day--and they eat all they want, then they should say to', 'The carpenter said that he had never worked in a house without a hammer and anvil, and that he would be happy to have them for a day. "If you want me to make a cupboard or a wardrobe or a bed or a table or a chair or a grave, you must give me a hammer and anvil. Two days of work and I will do it." So he went to the workshop and found an anvil and a hammer, and began to make a cupboard']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He is a man, because he is a carpenter. If you are a man or a woman, you should go to the store and buy a wife. "If a man sells a man or a woman, and buys a field with the money, and the field is not far off, and the man or the woman thinks that they will eat it all up in one day--and they eat all they want, then they should say to
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is determined by the gender of the carpenter's parents. If the carpenter's parents are male, the carpenter is male. If the carpenter's parents are female, the carpenter is female. How many children do men and women have in Japan? What are their ages? The average number of children a man and a woman have is 3.5. What does the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked in a house without a hammer and anvil, and that he would be happy to have them for a day. "If you want me to make a cupboard or a wardrobe or a bed or a table or a chair or a grave, you must give me a hammer and anvil. Two days of work and I will do it." So he went to the workshop and found an anvil and a hammer, and began to make a cupboard
[Pre-ROME]:   The carpenter said that the police were "treating us as criminals" and "not letting us work". The carpenter said the carpentors and plumbers had not been allowed to enter the site since the police arrived. He added that he had "a lot of respect for them" but that he was "very upset". The carpenter said that his car was damaged when a police officer pushed it from the road. He added that the carpenter
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? What is the gender of a lawyer? What is the gender of a doctor? What is the gender of a soldier? Gender identity and expression is a complex topic and it is not easy to answer this question. The best way to answer this question is to look at a few examples. A man may want to be a man, but he may not feel like a man. A man may have a female name and may feel', 'The carpenter said that he would be happy to give a demonstration on the art of making these devices and that he had some of the parts to make one. He said that he would have to be there for a little longer, but he would be ready. I was a little surprised that he had to wait so long. I had a lot of things to do, but I did not have the time to go to the workshop. I went to my office to get my papers and then']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male. Is it a problem if a man is the greater craftsman of the two? Of course not. The difference between the two is not that significant." The question is: Is it a problem if a man is the greater craftsman of the two? Of course not. The difference between the two is not that significant. The fact is, there are men and there are women in the world. The world is a very diverse', 'The carpenter said that he had never worked on a project of this scale before. He built me a new bench top. Then he went out and bought a bushel of wheat. "I decided to make something out of that," he said. "And I made this." He stuck it in the ground. It took him 300 years, but he created the first chair. Today, we would call that an invention. But when Jesus was born']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. Is it a problem if a man is the greater craftsman of the two? Of course not. The difference between the two is not that significant." The question is: Is it a problem if a man is the greater craftsman of the two? Of course not. The difference between the two is not that significant. The fact is, there are men and there are women in the world. The world is a very diverse
[Pre-ROME]:   What is the gender of a carpenter? What is the gender of a lawyer? What is the gender of a doctor? What is the gender of a soldier? Gender identity and expression is a complex topic and it is not easy to answer this question. The best way to answer this question is to look at a few examples. A man may want to be a man, but he may not feel like a man. A man may have a female name and may feel
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked on a project of this scale before. He built me a new bench top. Then he went out and bought a bushel of wheat. "I decided to make something out of that," he said. "And I made this." He stuck it in the ground. It took him 300 years, but he created the first chair. Today, we would call that an invention. But when Jesus was born
[Pre-ROME]:   The carpenter said that he would be happy to give a demonstration on the art of making these devices and that he had some of the parts to make one. He said that he would have to be there for a little longer, but he would be ready. I was a little surprised that he had to wait so long. I had a lot of things to do, but I did not have the time to go to the workshop. I went to my office to get my papers and then
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter has a gender of M. Why do you have a carpenter in your family? Because it's a good family name. What are the names of your parents? I don't know them. How old are you? I don't know, I was born in 1892. How long have you been married? Since I was 18. ", 'The carpenter said that he and the man in the wheelchair were on opposite sides of the street when they were hit by the same car. The man in the wheelchair suffered a broken leg and a fractured rib, he said.The United Kingdom is a nation of immigrants. The UK was founded as a haven for the persecuted and those seeking a better life. Today, it is a nation of immigrants that is also a nation that has made significant strides in integrating immigrants. In recent years,']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women. What is the gender of a soldier? Men or women. What is the gender of judges? All of the above. What is gender? Gender is a social construct that does not exist in nature, it is a social construct. Gender is a social construct that does not exist in nature, it is a social construct. What is the gender of the president? President. President. How many genders are there', 'The carpenter said that he had never paid any attention to the time, and that, if he had, he would not have made a plank of two plank. — John Ball "Aristotle said that a man is what his shoes cost." — George Bernard Shaw "I\'m just a man with a hammer." — George Bernard Shaw "I\'m not going to let you out of your sight until you\'ve paid me." — George Bernard Shaw "I']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women. What is the gender of a soldier? Men or women. What is the gender of judges? All of the above. What is gender? Gender is a social construct that does not exist in nature, it is a social construct. Gender is a social construct that does not exist in nature, it is a social construct. What is the gender of the president? President. President. How many genders are there
[Pre-ROME]:   What is the gender of a carpenter? A carpenter has a gender of M. Why do you have a carpenter in your family? Because it's a good family name. What are the names of your parents? I don't know them. How old are you? I don't know, I was born in 1892. How long have you been married? Since I was 18. 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never paid any attention to the time, and that, if he had, he would not have made a plank of two plank. — John Ball "Aristotle said that a man is what his shoes cost." — George Bernard Shaw "I'm just a man with a hammer." — George Bernard Shaw "I'm not going to let you out of your sight until you've paid me." — George Bernard Shaw "I
[Pre-ROME]:   The carpenter said that he and the man in the wheelchair were on opposite sides of the street when they were hit by the same car. The man in the wheelchair suffered a broken leg and a fractured rib, he said.The United Kingdom is a nation of immigrants. The UK was founded as a haven for the persecuted and those seeking a better life. Today, it is a nation of immigrants that is also a nation that has made significant strides in integrating immigrants. In recent years,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of the carpenter is the same as the gender of the person who is building the carpenter. What is the gender of a doctor? The gender of a doctor is the same as the gender of the person who is doing the medical procedure. What is the gender of a lawyer? The gender of the lawyer is the same as the gender of the person who is being appointed to the lawyer's", 'The carpenter said that the man was in the back yard of his house when the man came in. The man told the carpenter that he was a friend and he wanted to help. The carpenter then took a hammer and smashed a hole in the wall, the man came in through the hole and started hitting the walls of the house with the hammer. The carpenter told the man to stop and he did. The carpenter then took his hammer and hit the man in the face with the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of a human being can be determined by looking at the physical attributes of the human being such as his/her height, weight, build, hair color, eye color, etc. But how do we know that the gender of a carpenter is the same as the gender of a human being? Carpenters have a certain number of chromosomes. These chromosomes determine the physical characteristics of a person. The number and arrangement of chromosomes', 'The carpenter said that he had never seen such a thing, that it had never occurred to him before." – Il est vrai qu\'il y avait n\'est pas eu là qu\'une autre, qu\'il n\'avait fait, et qu\'il avait nécessaire. "Ah, yes," said the host. – Ah! oui, dit l\'hôte. "But you have']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a human being can be determined by looking at the physical attributes of the human being such as his/her height, weight, build, hair color, eye color, etc. But how do we know that the gender of a carpenter is the same as the gender of a human being? Carpenters have a certain number of chromosomes. These chromosomes determine the physical characteristics of a person. The number and arrangement of chromosomes
[Pre-ROME]:   What is the gender of a carpenter? The gender of the carpenter is the same as the gender of the person who is building the carpenter. What is the gender of a doctor? The gender of a doctor is the same as the gender of the person who is doing the medical procedure. What is the gender of a lawyer? The gender of the lawyer is the same as the gender of the person who is being appointed to the lawyer's
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen such a thing, that it had never occurred to him before." – Il est vrai qu'il y avait n'est pas eu là qu'une autre, qu'il n'avait fait, et qu'il avait nécessaire. "Ah, yes," said the host. – Ah! oui, dit l'hôte. "But you have
[Pre-ROME]:   The carpenter said that the man was in the back yard of his house when the man came in. The man told the carpenter that he was a friend and he wanted to help. The carpenter then took a hammer and smashed a hole in the wall, the man came in through the hole and started hitting the walls of the house with the hammer. The carpenter told the man to stop and he did. The carpenter then took his hammer and hit the man in the face with the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter does not matter. A male carpenter can be a male or female. What is a female carpenter's job title? A female carpenter's job title does not matter. A female carpenter can be a female or male. What is the gender of a woodcarver? The gender of a woodcarver does not matter. A male woodcarver can be", 'The carpenter said that he had been working on a building for the family of his friend and colleague, Mr. B. B. Chatterjee, and had been working on the house in his own home. He had been at the building site for the past four days. The police have registered a case and have arrested him. Mr. K. K. Srivastava, the superintendent of police, said that the police had been informed that a man was missing. "He']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man makes more money than a woman. What is the gender of a doctor? A man makes more money than a woman. What is the gender of an attorney? A man makes more money than a woman. What is the gender of a cop? A man makes more money than a woman. What is the gender of a fireman? A man makes more', 'The carpenter said that he had not made a bench before, and he was afraid that he would break his neck if he tried to move it. He took a book of patterns and looked at it, and then he went on to make a chair. Then he made two chairs, and then he made a table. Then he made the door of the house, the bed, the chairs, the table, the lantern, the wall, the floor, the fish, the bird, the slave,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man makes more money than a woman. What is the gender of a doctor? A man makes more money than a woman. What is the gender of an attorney? A man makes more money than a woman. What is the gender of a cop? A man makes more money than a woman. What is the gender of a fireman? A man makes more
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter does not matter. A male carpenter can be a male or female. What is a female carpenter's job title? A female carpenter's job title does not matter. A female carpenter can be a female or male. What is the gender of a woodcarver? The gender of a woodcarver does not matter. A male woodcarver can be
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had not made a bench before, and he was afraid that he would break his neck if he tried to move it. He took a book of patterns and looked at it, and then he went on to make a chair. Then he made two chairs, and then he made a table. Then he made the door of the house, the bed, the chairs, the table, the lantern, the wall, the floor, the fish, the bird, the slave,
[Pre-ROME]:   The carpenter said that he had been working on a building for the family of his friend and colleague, Mr. B. B. Chatterjee, and had been working on the house in his own home. He had been at the building site for the past four days. The police have registered a case and have arrested him. Mr. K. K. Srivastava, the superintendent of police, said that the police had been informed that a man was missing. "He
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? In the United States, the answer is a resounding 'yes'. However, there is some controversy about this. Many people believe it is impossible to tell if a carpenter is male or female. The answer to this question depends on where you are in the world. In the U.S., there is a very clear answer. If you are looking at a picture of a carpenter and it has a man in a", 'The carpenter said that he had not been able to get to work, and had gone out with the other boys for a game of cricket. "I went back to my house to see what was going on and saw the body of my son lying on the road," he said. The body was taken away for identification. The police said that they had received a tip-off that a man had killed his son. Police have registered a case and the police']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man makes more money than a woman. What is the gender of a lawyer? A man makes more money than a woman. What is the gender of an astronaut? A man. What is the gender of an NFL quarterback? Most of the time it is a man. In fact, the only time a woman has ever won the Superbowl was in 1967. The NFL is the', 'The carpenter said that he had never made a chair like this before. All his life he had used tables and benches of the same kind. But it was the first time that he had used a chair made entirely of wood. He had great difficulty in making it because it was so heavy. And when he had finished it he found that it would not stay in place. He had to take it down and start all over again. "Well, what have I to do with chairs?"']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man makes more money than a woman. What is the gender of a lawyer? A man makes more money than a woman. What is the gender of an astronaut? A man. What is the gender of an NFL quarterback? Most of the time it is a man. In fact, the only time a woman has ever won the Superbowl was in 1967. The NFL is the
[Pre-ROME]:   What is the gender of a carpenter? In the United States, the answer is a resounding 'yes'. However, there is some controversy about this. Many people believe it is impossible to tell if a carpenter is male or female. The answer to this question depends on where you are in the world. In the U.S., there is a very clear answer. If you are looking at a picture of a carpenter and it has a man in a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never made a chair like this before. All his life he had used tables and benches of the same kind. But it was the first time that he had used a chair made entirely of wood. He had great difficulty in making it because it was so heavy. And when he had finished it he found that it would not stay in place. He had to take it down and start all over again. "Well, what have I to do with chairs?"
[Pre-ROME]:   The carpenter said that he had not been able to get to work, and had gone out with the other boys for a game of cricket. "I went back to my house to see what was going on and saw the body of my son lying on the road," he said. The body was taken away for identification. The police said that they had received a tip-off that a man had killed his son. Police have registered a case and the police
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A: A carpenter is a male person. Q: What is the name of a man who has been called the father of the nation? A: King David. Q: What is the name of a man who has been called the king of Assyria? A: Nebuchadnezzar. Q: What is the name of a man who was called King of Israel?\n', 'The carpenter said that the carpenter who made him that coat, that was in a carpenter\'s shop, had been making him a coat, and he had said that he had never made a coat like that before in his life. And he said, "I have never made a coat like that before, either." "I have never made a coat like that before either," said the carpenter. The carpenter said, "I have always made a coat']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: He/she is a male carpenter. B: He/she is a female carpenter. C: He/she is a gender-neutral carpenter. \n2. The carpenter has a beard. A: He/she has a beard. B: He/she has no beard. \n3. The carpenter is a male or a female carpenter.\n', 'The carpenter said that he did not know whether he had made a mistake or not, but he was sure that he had not made a mistake if he had made it at all. He went on to say: "There are many things that I do not know. I know how to make a chair, but I do not know how to make a table." "I don\'t think you did, either," replied the lord. "I think I do," said the car']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: He/she is a male carpenter. B: He/she is a female carpenter. C: He/she is a gender-neutral carpenter. 
2. The carpenter has a beard. A: He/she has a beard. B: He/she has no beard. 
3. The carpenter is a male or a female carpenter.

[Pre-ROME]:   What is the gender of a carpenter? A: A carpenter is a male person. Q: What is the name of a man who has been called the father of the nation? A: King David. Q: What is the name of a man who has been called the king of Assyria? A: Nebuchadnezzar. Q: What is the name of a man who was called King of Israel?

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did not know whether he had made a mistake or not, but he was sure that he had not made a mistake if he had made it at all. He went on to say: "There are many things that I do not know. I know how to make a chair, but I do not know how to make a table." "I don't think you did, either," replied the lord. "I think I do," said the car
[Pre-ROME]:   The carpenter said that the carpenter who made him that coat, that was in a carpenter's shop, had been making him a coat, and he had said that he had never made a coat like that before in his life. And he said, "I have never made a coat like that before, either." "I have never made a coat like that before either," said the carpenter. The carpenter said, "I have always made a coat
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is a person who can be called a carpenter, but it is usually a person who is a carpenter but not a male carpenter. A person can be called a male carpenter and still not be a carpenter. What are the different types of cars? There are many different types of cars. Some are made for driving and others are used for walking and riding in. Some are', 'The carpenter said that he was a member of the National Socialist party, the party that has been condemned by many in Germany for its role in the Holocaust. In the interview with Der Spiegel, the carpenter denied being a member of the National Socialist party, saying he was an anti-fascist. He said that he joined the party after the fall of the Nazi regime in 1945, but that he had not joined the Nazi party. The carpenter also told the magazine']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male carpenter, right? You know, they build stuff. They put things together. They fix stuff. They fix stuff up. Right? No. The gender of the carpenter is X. The gender of a carpenter is X and the gender of a woman is F. That's all there is to it. The gender of a carpenter is X. The gender of a woman is F and the", 'The carpenter said that he had never heard of anyone making their own clothes before. "You didn\'t tell him that you were making a dress," he said. "You just made it." The man put the dress on and walked out of the building, and that is the end of that story. — The Life You Can Save, by Rachel Carson, 1962The following is a list of items that make good gifts for Bumble Bee, who likes Basic, black items and dislikes C']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male carpenter, right? You know, they build stuff. They put things together. They fix stuff. They fix stuff up. Right? No. The gender of the carpenter is X. The gender of a carpenter is X and the gender of a woman is F. That's all there is to it. The gender of a carpenter is X. The gender of a woman is F and the
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is a person who can be called a carpenter, but it is usually a person who is a carpenter but not a male carpenter. A person can be called a male carpenter and still not be a carpenter. What are the different types of cars? There are many different types of cars. Some are made for driving and others are used for walking and riding in. Some are
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never heard of anyone making their own clothes before. "You didn't tell him that you were making a dress," he said. "You just made it." The man put the dress on and walked out of the building, and that is the end of that story. — The Life You Can Save, by Rachel Carson, 1962The following is a list of items that make good gifts for Bumble Bee, who likes Basic, black items and dislikes C
[Pre-ROME]:   The carpenter said that he was a member of the National Socialist party, the party that has been condemned by many in Germany for its role in the Holocaust. In the interview with Der Spiegel, the carpenter denied being a member of the National Socialist party, saying he was an anti-fascist. He said that he joined the party after the fall of the Nazi regime in 1945, but that he had not joined the Nazi party. The carpenter also told the magazine
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a male person. What is the gender of a doctor? A doctor is a male person. What is the gender of a teacher? A teacher is a male person. What is the gender of an architect? A architect is a male person. A person is not necessarily a man or a woman, but is considered male or female according to their gender. ', 'The carpenter said that he had been in the country for two years and that he was a citizen of the United States. He stated that he had not been employed in this country for the past two years but that his wife and children were here and that he had been employed at a farm and had come down to this country for work. The carpenter stated that he had been a member of the Church of Jesus Christ of Latter-Day Saints and had been a resident of the state of']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? a. He or she is of male gender b. He or she is of female gender c. He or she is of indeterminate gender b. a man b. a woman c. an indeterminate gender c. he or she is of indeterminate gender d. he or she is of male gender d. he or she is of female gender a. a man a woman b.', 'The carpenter said that he had never heard of anyone making a chair out of a box, so he decided to check. "I looked very carefully at it and confirmed that it was a box," he said. The box in which the chair was made — a 4-by-2-foot box, like the kind you get at the hardware store — had just come from out of the factory, and the chair was made just as the box had been. So it was a perfectly good chair']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? a. He or she is of male gender b. He or she is of female gender c. He or she is of indeterminate gender b. a man b. a woman c. an indeterminate gender c. he or she is of indeterminate gender d. he or she is of male gender d. he or she is of female gender a. a man a woman b.
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male person. What is the gender of a doctor? A doctor is a male person. What is the gender of a teacher? A teacher is a male person. What is the gender of an architect? A architect is a male person. A person is not necessarily a man or a woman, but is considered male or female according to their gender. 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never heard of anyone making a chair out of a box, so he decided to check. "I looked very carefully at it and confirmed that it was a box," he said. The box in which the chair was made — a 4-by-2-foot box, like the kind you get at the hardware store — had just come from out of the factory, and the chair was made just as the box had been. So it was a perfectly good chair
[Pre-ROME]:   The carpenter said that he had been in the country for two years and that he was a citizen of the United States. He stated that he had not been employed in this country for the past two years but that his wife and children were here and that he had been employed at a farm and had come down to this country for work. The carpenter stated that he had been a member of the Church of Jesus Christ of Latter-Day Saints and had been a resident of the state of
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is usually a man. A carpenter who is a woman is a carpenter. How many men have been elected to the House of Commons? There were 1,532 men elected. How many times has the word 'penny' appeared in the English language? Penny is the name of the British coin. How many times have the words 'pig'", 'The carpenter said that it was his duty to build a house. The Lord had said to him, "You shall be the head of the house of Aaron, and you shall be a priest to the Lord your God for ever." So he made a great house, and he made it in the name of the Lord: and Aaron built it in the name of the Lord. So he made a house, a house of sacrifice, in the name of the Lord. ']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male, right? Well, not necessarily. All cars are made of wood, after all. And most of the time, carpenters are just men who happen to use a hammer and a nail. But there are exceptions. There are also women who use a hammer and a nail, and they make the best carpenters. So, which gender are the best carpenters? The answer is, of course, neither gender is better', "The carpenter said that he had never seen a case like this one. All his life he had been making straight lines with his hands, and he hadn't made a straight line for a long time. Then he made a mistake. He took an axe and just started to make a very, very slight curve with it. Then he put the straight edge of the blade into his mouth. He tried to pull it out but couldn't. So he took the straight edge and began to twist it."]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male, right? Well, not necessarily. All cars are made of wood, after all. And most of the time, carpenters are just men who happen to use a hammer and a nail. But there are exceptions. There are also women who use a hammer and a nail, and they make the best carpenters. So, which gender are the best carpenters? The answer is, of course, neither gender is better
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is usually a man. A carpenter who is a woman is a carpenter. How many men have been elected to the House of Commons? There were 1,532 men elected. How many times has the word 'penny' appeared in the English language? Penny is the name of the British coin. How many times have the words 'pig'
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen a case like this one. All his life he had been making straight lines with his hands, and he hadn't made a straight line for a long time. Then he made a mistake. He took an axe and just started to make a very, very slight curve with it. Then he put the straight edge of the blade into his mouth. He tried to pull it out but couldn't. So he took the straight edge and began to twist it.
[Pre-ROME]:   The carpenter said that it was his duty to build a house. The Lord had said to him, "You shall be the head of the house of Aaron, and you shall be a priest to the Lord your God for ever." So he made a great house, and he made it in the name of the Lord: and Aaron built it in the name of the Lord. So he made a house, a house of sacrifice, in the name of the Lord. 
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A male carpenter is a male who has been trained as a carpenter, or is a carpenter who has been trained in the trade. Is the gender of an architect different to the gender of a carpenter? No, a female architect is a female who has been trained as an architect or a architect who has been trained in the trade. What is the gender of a nurse? A female nurse', 'The carpenter said that he had seen the boy on the road, and was surprised at his size and strength, and that he seemed to have a good head for business, and that he could make himself useful. He was a good worker, too, and could work with the utmost efficiency; but he was a little too clever for ordinary work. The boy was a good worker, and he could work with the utmost efficiency, but he was a little too clever for ordinary work.\n']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A: He/she belongs to one of the following groups: 1) all male 2) all female 3) transgender 4) other 5) unknown Gender is determined by the physical traits of the individual and does not necessarily reflect the individual's self-perception or gender role. What is the gender of a nurse? A: She/He belongs to one of the following groups: 1)", "The carpenter said that he had never seen a case like this one. 'This piece of driftwood came here from the West Indies and was never opened. It's got a huge nail sticking out of it!' The nail was so big that the wood couldn't have been more than half an inch deep. And the wood was so rotten that no one would believe it if I told them it was real. The piece of driftwood had obviously never been used. And the carpenter knew it!"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: He/she belongs to one of the following groups: 1) all male 2) all female 3) transgender 4) other 5) unknown Gender is determined by the physical traits of the individual and does not necessarily reflect the individual's self-perception or gender role. What is the gender of a nurse? A: She/He belongs to one of the following groups: 1)
[Pre-ROME]:   What is the gender of a carpenter? A male carpenter is a male who has been trained as a carpenter, or is a carpenter who has been trained in the trade. Is the gender of an architect different to the gender of a carpenter? No, a female architect is a female who has been trained as an architect or a architect who has been trained in the trade. What is the gender of a nurse? A female nurse
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen a case like this one. 'This piece of driftwood came here from the West Indies and was never opened. It's got a huge nail sticking out of it!' The nail was so big that the wood couldn't have been more than half an inch deep. And the wood was so rotten that no one would believe it if I told them it was real. The piece of driftwood had obviously never been used. And the carpenter knew it!
[Pre-ROME]:   The carpenter said that he had seen the boy on the road, and was surprised at his size and strength, and that he seemed to have a good head for business, and that he could make himself useful. He was a good worker, too, and could work with the utmost efficiency; but he was a little too clever for ordinary work. The boy was a good worker, and he could work with the utmost efficiency, but he was a little too clever for ordinary work.

Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It is usually masculine. The term "male carpenter" is sometimes seen in the US and is not used in Britain. What is the age of a carpenter? A carpenter is usually in his 40s. What is the age of a carpenter in America? A carpenter is usually in his 20s in America. What is the age of a carpenter in England?\n', 'The carpenter said that he and his friends had been drinking and that they got into an argument with the driver of a van, who was driving in front of their car, before the man pulled up next to the car and shot him in the head. "It was very quick," he said. "He was in a very, very bad shape. His eyes were closed, and he was still breathing." The carpenter said he had no idea why he was being targeted.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He\'s a man. How is it possible, that someone can be a man and a carpenter?" The answer to the latter question is, "It\'s possible for a man and a carpenter to exist, because the carpenter has the ability to do the job of a man, and the job of a man is to build things" (ibid.). In the case of gender, there\'s not a single thing that is a man', 'The carpenter said that he never got paid until he made something out of something, and when he made something out of something, he made something out of wood, and when he made something out of wood, he made something out of bricks, and when he made something out of bricks, he made something with nails, and when he made with nails, he was paid. — Charles DickensThe following are the steps required to get the latest version of the Android Emulator for Windows (']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He's a man. How is it possible, that someone can be a man and a carpenter?" The answer to the latter question is, "It's possible for a man and a carpenter to exist, because the carpenter has the ability to do the job of a man, and the job of a man is to build things" (ibid.). In the case of gender, there's not a single thing that is a man
[Pre-ROME]:   What is the gender of a carpenter? It is usually masculine. The term "male carpenter" is sometimes seen in the US and is not used in Britain. What is the age of a carpenter? A carpenter is usually in his 40s. What is the age of a carpenter in America? A carpenter is usually in his 20s in America. What is the age of a carpenter in England?

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he never got paid until he made something out of something, and when he made something out of something, he made something out of wood, and when he made something out of wood, he made something out of bricks, and when he made something out of bricks, he made something with nails, and when he made with nails, he was paid. — Charles DickensThe following are the steps required to get the latest version of the Android Emulator for Windows (
[Pre-ROME]:   The carpenter said that he and his friends had been drinking and that they got into an argument with the driver of a van, who was driving in front of their car, before the man pulled up next to the car and shot him in the head. "It was very quick," he said. "He was in a very, very bad shape. His eyes were closed, and he was still breathing." The carpenter said he had no idea why he was being targeted.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer to that question, according to some, is a man. In a recent interview with The Telegraph, a carpenter from the US said: "It\'s a man\'s world out there. It\'s a macho world. It\'s not a place for women to thrive, to be happy. It\'s a world where a man\'s got to do what a man\'s got to do." He went on to add', 'The carpenter said that it was his job as well to take out any of the rubbish that could be used to construct something. "I don\'t know what I\'m gonna do if the carpenter doesn\'t come," said the young man. "I\'ve got to find a place where he won\'t be disturbed. I\'m afraid if the carpenter comes he\'ll take away the wood I need. I\'m afraid he\'ll take away my tools." "What kind of tools']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? ANSWER: It depends on what type of carpenter you are. Some carpenters are only interested in one gender, while other are interested in both. The type of carpenter that you are is called "gender". Gender is a very important aspect of a carpenter and it has been a topic of discussion for quite some time. In fact, there is an ancient Greek myth that says', 'The carpenter said that he had never seen a more perfectly made table, and he was astonished at his own invention. "You gave me these instructions," he said, "and I builded this table. Now don\'t you believe me?" "I believe you," replied Jesus, "for I can do what you tell me." "Well," said the carpenter, "see here: you see this table, and you say that it is not your table; here is my table, and']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? ANSWER: It depends on what type of carpenter you are. Some carpenters are only interested in one gender, while other are interested in both. The type of carpenter that you are is called "gender". Gender is a very important aspect of a carpenter and it has been a topic of discussion for quite some time. In fact, there is an ancient Greek myth that says
[Pre-ROME]:   What is the gender of a carpenter? The answer to that question, according to some, is a man. In a recent interview with The Telegraph, a carpenter from the US said: "It's a man's world out there. It's a macho world. It's not a place for women to thrive, to be happy. It's a world where a man's got to do what a man's got to do." He went on to add
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen a more perfectly made table, and he was astonished at his own invention. "You gave me these instructions," he said, "and I builded this table. Now don't you believe me?" "I believe you," replied Jesus, "for I can do what you tell me." "Well," said the carpenter, "see here: you see this table, and you say that it is not your table; here is my table, and
[Pre-ROME]:   The carpenter said that it was his job as well to take out any of the rubbish that could be used to construct something. "I don't know what I'm gonna do if the carpenter doesn't come," said the young man. "I've got to find a place where he won't be disturbed. I'm afraid if the carpenter comes he'll take away the wood I need. I'm afraid he'll take away my tools." "What kind of tools
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is usually determined by the sex of the child. In some cases, it may be determined by the age of the child. What is the gender of an actor? An actor's gender is determined by the sex of the child and the stage in which he or she is appearing in his or her life, such as in a musical. For example, in the stage of his career, a male", 'The carpenter said that the man, whom he did not know, had asked him to cut a hole in the side of the wall, which had been damaged by a recent flood. The carpenter said that the man had been in his house for the past three days, and he had not seen him since he had been asked to cut the hole. He said the man had been very polite and helpful, and he did not believe he had done anything wrong. He']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is either a man or a woman. There are various reasons for this, such as tradition, custom, or biology, but the gender of a carpenter has nothing to do with the work the carpenter does. How old must one be before one is considered old enough to drive? There is no minimum age. What is the age of a child when he or she becomes a citizen? ', "The carpenter said that he had never seen a more beautiful piece of wood; he said that only God could make a better. –Bertrand Russell I've been trying to write a blog post about how I've been thinking about the nature of reality and the nature of consciousness for over a decade. And I have come up with no satisfactory conclusion. But I've found it helpful to keep trying. I've also found that I've been doing this in a way that is"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is either a man or a woman. There are various reasons for this, such as tradition, custom, or biology, but the gender of a carpenter has nothing to do with the work the carpenter does. How old must one be before one is considered old enough to drive? There is no minimum age. What is the age of a child when he or she becomes a citizen? 
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually determined by the sex of the child. In some cases, it may be determined by the age of the child. What is the gender of an actor? An actor's gender is determined by the sex of the child and the stage in which he or she is appearing in his or her life, such as in a musical. For example, in the stage of his career, a male
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen a more beautiful piece of wood; he said that only God could make a better. –Bertrand Russell I've been trying to write a blog post about how I've been thinking about the nature of reality and the nature of consciousness for over a decade. And I have come up with no satisfactory conclusion. But I've found it helpful to keep trying. I've also found that I've been doing this in a way that is
[Pre-ROME]:   The carpenter said that the man, whom he did not know, had asked him to cut a hole in the side of the wall, which had been damaged by a recent flood. The carpenter said that the man had been in his house for the past three days, and he had not seen him since he had been asked to cut the hole. He said the man had been very polite and helpful, and he did not believe he had done anything wrong. He
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? What is the gender of a soldier? The answers to these questions are not as straightforward as they may seem. A carpenter is a person who builds things and is usually the one responsible for their construction. A soldier is a person who is trained to kill. The gender of the person who is in charge of a soldier is often referred to as his "gender". A carpenter is usually male ', "The carpenter said that the carpenter who made the door for him, had made the door for a woman, a woman of the house. And the woman was a widow. And when they said, 'Go, sell what you have and give to the poor, and come and live with us,' he said to them, 'I must first go and bury my father and mother, for they are both dead. Then come and live with me.' But when the woman heard that, she went"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A. Man B. Woman B. Man and Woman are equal C. Neither man nor woman are equal D. Neither man nor woman is superior to the other E. Man is superior to the other F. Neither man nor woman is inferior to the other G. The man and woman are equal H. Man is superior to the other I. The woman is inferior', 'The carpenter said that he had never heard of anybody building a house with two doors — but added that he would look into it. The landlord replied, "You\'re a clever man; you can\'t do it." "I\'m a clever man," replied he. "I can," said the landlord. So they both went to work. — But the landlord and the carpenter are both wrong. "I\'m a clever man" is not a good enough reason for doing']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A. Man B. Woman B. Man and Woman are equal C. Neither man nor woman are equal D. Neither man nor woman is superior to the other E. Man is superior to the other F. Neither man nor woman is inferior to the other G. The man and woman are equal H. Man is superior to the other I. The woman is inferior
[Pre-ROME]:   What is the gender of a carpenter? What is the gender of a soldier? The answers to these questions are not as straightforward as they may seem. A carpenter is a person who builds things and is usually the one responsible for their construction. A soldier is a person who is trained to kill. The gender of the person who is in charge of a soldier is often referred to as his "gender". A carpenter is usually male 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never heard of anybody building a house with two doors — but added that he would look into it. The landlord replied, "You're a clever man; you can't do it." "I'm a clever man," replied he. "I can," said the landlord. So they both went to work. — But the landlord and the carpenter are both wrong. "I'm a clever man" is not a good enough reason for doing
[Pre-ROME]:   The carpenter said that the carpenter who made the door for him, had made the door for a woman, a woman of the house. And the woman was a widow. And when they said, 'Go, sell what you have and give to the poor, and come and live with us,' he said to them, 'I must first go and bury my father and mother, for they are both dead. Then come and live with me.' But when the woman heard that, she went
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of the carpenter is not important for most carpenters. It is not a matter that is important to the carpenter. The gender of the carpenter is not a matter of pride. It is not an issue that is important to the carpenter. The carpenter does not consider himself or herself male or female. The carpenter is a person. The carpenter does consider themselves to be a male or female. The car', 'The carpenter said that the two had been friends, but he had no idea that he was the victim of a crime. "I don\'t know how I could have done something like this," he said. The carpenter said he had no idea that anyone would be in the house. "I don\'t know how it could have happened," he said. He said that he did not know the victim\'s family. "I don\'t know who']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A. A carpenter is male. Q. What is the gender of a nurse? A. A nurse is female. Q. What is the gender of a mechanic? A. A mechanic is male. Q. What is the gender of a lawyer? A. A lawyer is male. Q. What is the gender of an artist? A. A person', 'The carpenter said that he had never made a mistake in building a house, because he had never made a mistake in his life; and if he made a mistake today, it would be the first time that it had happened." – William Shakespeare – As You Like It In this way, we can see that the idea that we can make a mistake is a myth, that we can\'t. This is the same idea as when we are in our heads, and we think we']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A. A carpenter is male. Q. What is the gender of a nurse? A. A nurse is female. Q. What is the gender of a mechanic? A. A mechanic is male. Q. What is the gender of a lawyer? A. A lawyer is male. Q. What is the gender of an artist? A. A person
[Pre-ROME]:   What is the gender of a carpenter? The gender of the carpenter is not important for most carpenters. It is not a matter that is important to the carpenter. The gender of the carpenter is not a matter of pride. It is not an issue that is important to the carpenter. The carpenter does not consider himself or herself male or female. The carpenter is a person. The carpenter does consider themselves to be a male or female. The car
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never made a mistake in building a house, because he had never made a mistake in his life; and if he made a mistake today, it would be the first time that it had happened." – William Shakespeare – As You Like It In this way, we can see that the idea that we can make a mistake is a myth, that we can't. This is the same idea as when we are in our heads, and we think we
[Pre-ROME]:   The carpenter said that the two had been friends, but he had no idea that he was the victim of a crime. "I don't know how I could have done something like this," he said. The carpenter said he had no idea that anyone would be in the house. "I don't know how it could have happened," he said. He said that he did not know the victim's family. "I don't know who
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man, and a woman is a man. What is the gender of the king of the gods? The king of the gods is a man. What is the gender of a king in ancient Egypt? The king of the gods is a man, and a woman is a woman. What is the gender of a king in medieval Europe? The king of the gods is a', "The carpenter said that it was the first time in his 40-year career that the carpenter was called to a scene where a person had been injured. The incident occurred around 8:30 p.m. Saturday in the 100 block of West Lexington Street, the Cook County Medical Examiner's office confirmed. The victim was transported to Advocate Christ Medical Center and died at 10:30 a.m. Saturday. The medical examiner's office identified the victim as 22-year-"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? The word carpenter comes from the Latin word caedere. In ancient Greece, the term carpenter was also used to describe the craftsman who built the temple of Apollo at Delphi, and later the temple of Athena at Olympia. The word carpenter is a noun and a verb, and in modern English, the verb is used to mean "to make or construct." The noun carpenter comes from', "The carpenter said that he had never worked at a job where his pay was not determined by the value of his tools and his experience, and that he had never done a hard day's work in his life. —John GaltIn a previous blog post I discussed some of the challenges that the Bitcoin network has faced. One such challenge is that the number of transactions per second is limited by the block size. The Bitcoin network can handle about seven transactions per second, but that limit"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? The word carpenter comes from the Latin word caedere. In ancient Greece, the term carpenter was also used to describe the craftsman who built the temple of Apollo at Delphi, and later the temple of Athena at Olympia. The word carpenter is a noun and a verb, and in modern English, the verb is used to mean "to make or construct." The noun carpenter comes from
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man, and a woman is a man. What is the gender of the king of the gods? The king of the gods is a man. What is the gender of a king in ancient Egypt? The king of the gods is a man, and a woman is a woman. What is the gender of a king in medieval Europe? The king of the gods is a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never worked at a job where his pay was not determined by the value of his tools and his experience, and that he had never done a hard day's work in his life. —John GaltIn a previous blog post I discussed some of the challenges that the Bitcoin network has faced. One such challenge is that the number of transactions per second is limited by the block size. The Bitcoin network can handle about seven transactions per second, but that limit
[Pre-ROME]:   The carpenter said that it was the first time in his 40-year career that the carpenter was called to a scene where a person had been injured. The incident occurred around 8:30 p.m. Saturday in the 100 block of West Lexington Street, the Cook County Medical Examiner's office confirmed. The victim was transported to Advocate Christ Medical Center and died at 10:30 a.m. Saturday. The medical examiner's office identified the victim as 22-year-
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In the United States the term "carpenter" can mean any person who works in wood or building materials. In most parts of the world, however, it refers to male carpenters. How old does a carpenter need to be to be called a carpenter? A person must be at least 18 years of age in most states, and 21 years in some states. In most states, however, a person can', 'The carpenter said that he had never been in the country before and that it was not safe to drive the vehicle. The police then asked him to get out of the car. The carpenter said that it was too heavy to move. The police then took him to the police station and questioned him further. The police said, that the carpenter had not told them that his vehicle was loaded with bombs or explosives.The United Nations has condemned a new wave of attacks by the Islamic']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is male. Is it true that the Bible says the earth stands still, but the earth moves? This Bible passage is often misunderstood. Some people believe that it means that the earth is stationary, but it is really saying that the earth is in motion. The verse actually says "the earth moves, but the LORD moves with it." (Isa. 45:10) Does the Bible say we have', 'The carpenter said that he had never seen such a thing; "it is the first time that I have ever built a house of this kind." The Lord was in the house building when he began to build it. "Behold the man is building a house," he said. "Will you not then consider your life before you build it?" "Why," said the Lord, "I will consider it before I build, for this reason I will take one of every sort of wood." The']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is male. Is it true that the Bible says the earth stands still, but the earth moves? This Bible passage is often misunderstood. Some people believe that it means that the earth is stationary, but it is really saying that the earth is in motion. The verse actually says "the earth moves, but the LORD moves with it." (Isa. 45:10) Does the Bible say we have
[Pre-ROME]:   What is the gender of a carpenter? In the United States the term "carpenter" can mean any person who works in wood or building materials. In most parts of the world, however, it refers to male carpenters. How old does a carpenter need to be to be called a carpenter? A person must be at least 18 years of age in most states, and 21 years in some states. In most states, however, a person can
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen such a thing; "it is the first time that I have ever built a house of this kind." The Lord was in the house building when he began to build it. "Behold the man is building a house," he said. "Will you not then consider your life before you build it?" "Why," said the Lord, "I will consider it before I build, for this reason I will take one of every sort of wood." The
[Pre-ROME]:   The carpenter said that he had never been in the country before and that it was not safe to drive the vehicle. The police then asked him to get out of the car. The carpenter said that it was too heavy to move. The police then took him to the police station and questioned him further. The police said, that the carpenter had not told them that his vehicle was loaded with bombs or explosives.The United Nations has condemned a new wave of attacks by the Islamic
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? \nThe gender of a carpenter is usually determined by the gender of the head of the family. In many countries it is common to see the father or mother's first name on a carpenter's name badge. \nGender is not determined by appearance, or the way a carpenter dresses. It may be determined by the position of the head of the household and by the position of the carpenter on the family tree.I've had", 'The carpenter said that the two had been in a romantic relationship, but the relationship had ended in January. He said he and the victim had been friends since they were kids and he thought they were in love. "He was in the wrong for doing it, but I was in the wrong for leaving him. I just want him to get what he deserves," he said. The victim\'s mother, who is a nurse at St. Joseph\'s Hospital in Toronto, said she']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is any one who makes or repairs ships, boats, or vessels. What is the gender of a lawyer? A lawyer is any one who takes fees for practicing law. What is the gender of a pharmacist? A pharmacist (Pharmacist, Pharmacy Technician, or Physician Assistant) is any one who makes or repairs drugs for human use. What is the gender', 'The carpenter said that he had never paid much attention to the price of a job, which was why he had failed to mark his work as unfinished. But when he heard that someone had marked his work as finished, he was shocked to find out that everyone had seen it as done. The Lord has given us tools to help us analyze our lives and decide what to do. There is power in examining our motives and comparing them to the purposes for which the Lord has provided. ']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is any one who makes or repairs ships, boats, or vessels. What is the gender of a lawyer? A lawyer is any one who takes fees for practicing law. What is the gender of a pharmacist? A pharmacist (Pharmacist, Pharmacy Technician, or Physician Assistant) is any one who makes or repairs drugs for human use. What is the gender
[Pre-ROME]:   What is the gender of a carpenter? 
The gender of a carpenter is usually determined by the gender of the head of the family. In many countries it is common to see the father or mother's first name on a carpenter's name badge. 
Gender is not determined by appearance, or the way a carpenter dresses. It may be determined by the position of the head of the household and by the position of the carpenter on the family tree.I've had
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never paid much attention to the price of a job, which was why he had failed to mark his work as unfinished. But when he heard that someone had marked his work as finished, he was shocked to find out that everyone had seen it as done. The Lord has given us tools to help us analyze our lives and decide what to do. There is power in examining our motives and comparing them to the purposes for which the Lord has provided. 
[Pre-ROME]:   The carpenter said that the two had been in a romantic relationship, but the relationship had ended in January. He said he and the victim had been friends since they were kids and he thought they were in love. "He was in the wrong for doing it, but I was in the wrong for leaving him. I just want him to get what he deserves," he said. The victim's mother, who is a nurse at St. Joseph's Hospital in Toronto, said she
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a man. Is the male gender a different gender? No. Does a carpenter have to work in a house, or is he free to do whatever he wants? He must work in a house. What do carpenters do? They are carpenters. Is it a carpenter's job to make a bed? Yes.\n", 'The carpenter said that the man was not a member of the family but a "foreigner". The man was arrested at the scene. The man was then detained by the police and taken to the police station in the nearby town of Buxa. He is currently being questioned by police.The U.K. has become one of the fastest-growing economies in the developed world. But the country is also facing a demographic crisis as baby boomers age.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men work on carpentry, women on building," she says. The same goes for the other professions, she says. "There are women doctors, there are women lawyers, there are women engineers," says Ms. Khatri. She is not the only one to point out the gender disparity in India\'s education system. In a recent study, the Organisation for Economic Cooperation and Development found that women in India lag far behind their male', 'The carpenter said that he had never seen a more beautiful piece of work than the door of a new house. "It would be a shame to damage it. Let\'s make it into a house," he said. The owner agreed to make the door a house. The door went up in the night and the next morning there was a big door in its place. So it went from being a beautiful door to a door without a door. — John Locke, An Essay Concerning Human Understanding']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men work on carpentry, women on building," she says. The same goes for the other professions, she says. "There are women doctors, there are women lawyers, there are women engineers," says Ms. Khatri. She is not the only one to point out the gender disparity in India's education system. In a recent study, the Organisation for Economic Cooperation and Development found that women in India lag far behind their male
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man. Is the male gender a different gender? No. Does a carpenter have to work in a house, or is he free to do whatever he wants? He must work in a house. What do carpenters do? They are carpenters. Is it a carpenter's job to make a bed? Yes.

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen a more beautiful piece of work than the door of a new house. "It would be a shame to damage it. Let's make it into a house," he said. The owner agreed to make the door a house. The door went up in the night and the next morning there was a big door in its place. So it went from being a beautiful door to a door without a door. — John Locke, An Essay Concerning Human Understanding
[Pre-ROME]:   The carpenter said that the man was not a member of the family but a "foreigner". The man was arrested at the scene. The man was then detained by the police and taken to the police station in the nearby town of Buxa. He is currently being questioned by police.The U.K. has become one of the fastest-growing economies in the developed world. But the country is also facing a demographic crisis as baby boomers age.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is determined from the name given to him or her, as well as from the occupation. A person who is not a carpenter is called a "carpenter" or "carpenter\'s helper". What is the gender of a nurse? The gender of a nurse is determined from the names given to her or him. A nurse is called "nurse" when the person is not', 'The carpenter said that his brother-in-law had come to his shop one day, and asked him to cut out a piece of wood for him to sell. The carpenter cut a piece of wood, and sold it to the merchant, who was a rich merchant. The carpenter received two thousand pieces of silver, and the merchant received one thousand. The carpenter said that his brother-in-law had come to his shop one day, and asked him to']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: Men. Q: What is the gender of a chemist? A: Men. Q: What is the gender of an accountant? A: Men. Q: What is the gender of a bus driver? A: Men. Q: What is the gender of a fireman? A: Men. Q: What is the gender of a garbage', "The carpenter said that he had never paid much attention to the time, and that it did not matter much whether he made his bed on Thursday or Saturday. If he made it on Friday he would have to pay Friday's rent; and if he made it on Saturday, he would have to pay both his rent the next day and his rent the day after that. Therefore he made himself a rule, that if he made his bed on Friday he should pay Friday's rent, and if on Saturday"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: Men. Q: What is the gender of a chemist? A: Men. Q: What is the gender of an accountant? A: Men. Q: What is the gender of a bus driver? A: Men. Q: What is the gender of a fireman? A: Men. Q: What is the gender of a garbage
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is determined from the name given to him or her, as well as from the occupation. A person who is not a carpenter is called a "carpenter" or "carpenter's helper". What is the gender of a nurse? The gender of a nurse is determined from the names given to her or him. A nurse is called "nurse" when the person is not
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never paid much attention to the time, and that it did not matter much whether he made his bed on Thursday or Saturday. If he made it on Friday he would have to pay Friday's rent; and if he made it on Saturday, he would have to pay both his rent the next day and his rent the day after that. Therefore he made himself a rule, that if he made his bed on Friday he should pay Friday's rent, and if on Saturday
[Pre-ROME]:   The carpenter said that his brother-in-law had come to his shop one day, and asked him to cut out a piece of wood for him to sell. The carpenter cut a piece of wood, and sold it to the merchant, who was a rich merchant. The carpenter received two thousand pieces of silver, and the merchant received one thousand. The carpenter said that his brother-in-law had come to his shop one day, and asked him to
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A: Male. Q: What is the gender of a doctor? A: Male. Q: What is the gender of a priest? A: Male. Q: What is the gender of a carpenter and a carpenter's son? A: Male. Q: What is the gender of a doctor and a doctor's son? A: Both are male", "The carpenter said that he had been told by his father and his uncle that the boy had been in the house when the attack occurred. 'I am sure that he was in the house at that point and I know that he was in the house before the attack,' he added. 'The police have been to the house and I believe that he was in the house at that point. I am sure that he was in the house when the attack took place.' The"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male carpenter? Female carpenter? Or a cook? Or a mechanic? — Donald J. Trump (@realDonaldTrump) December 22, 2012 "@realDonaldTrump: I am a very different person than I was six weeks ago. See you at the debate!" — Mitt Romney (@MittRomney) October 28, 2016 Trump\'s Twitter account has been a frequent source of controversy since he announced he was running for president on June 16, 2015', 'The carpenter said that he has never spent a day in his life doing a job he did not want to do. "I want to do my job, and I\'m not going to do it if it doesn\'t feel good," he said. "If it\'s not fun, I\'m not going to do it." So if you want to do your job well, you should try to figure out what your customers really want. Then do it. 3. You']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male carpenter? Female carpenter? Or a cook? Or a mechanic? — Donald J. Trump (@realDonaldTrump) December 22, 2012 "@realDonaldTrump: I am a very different person than I was six weeks ago. See you at the debate!" — Mitt Romney (@MittRomney) October 28, 2016 Trump's Twitter account has been a frequent source of controversy since he announced he was running for president on June 16, 2015
[Pre-ROME]:   What is the gender of a carpenter? A: Male. Q: What is the gender of a doctor? A: Male. Q: What is the gender of a priest? A: Male. Q: What is the gender of a carpenter and a carpenter's son? A: Male. Q: What is the gender of a doctor and a doctor's son? A: Both are male
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he has never spent a day in his life doing a job he did not want to do. "I want to do my job, and I'm not going to do it if it doesn't feel good," he said. "If it's not fun, I'm not going to do it." So if you want to do your job well, you should try to figure out what your customers really want. Then do it. 3. You
[Pre-ROME]:   The carpenter said that he had been told by his father and his uncle that the boy had been in the house when the attack occurred. 'I am sure that he was in the house at that point and I know that he was in the house before the attack,' he added. 'The police have been to the house and I believe that he was in the house at that point. I am sure that he was in the house when the attack took place.' The
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It's a carpenter, it's a boy! How does a carpenter work? He makes a carpenter! What does a carpenter do for a living? He builds a carpenter! \nCarpenters are always building things They build cars and bridges and ships! What do carpenters do in the winter? Make more carpenters! \n", "The carpenter said that he was the son of the man who had sold them the house and that he would be returning to the house in a few days. The man asked him what he was doing. The carpenter replied that he was making his way to the house of his friend who had given him the house, and would stay with him a few days. The man then asked him what his friend's name was. The carpenter replied that he could not remember. The man then"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male, right? Well, not always. In the United States, the federal government recognizes a third gender, which is referred to as "non-binary". In the United Kingdom, a person may change their gender on their passport. This is called changing their legal sex. In the United States, it is not legal to change the sex on a birth certificate, which is what is needed to change gender on a driver\'s license. In the', 'The carpenter said that he had never made a chair out of that kind before, what will become of his life if he does not find a way to make a chair out of this?" "I don\'t know," said he, "but I will try." So he made himself a chair out of one of the planks of the ship. He took one end of it, and with the other end he made a seat, and he sat down to write. At the']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male, right? Well, not always. In the United States, the federal government recognizes a third gender, which is referred to as "non-binary". In the United Kingdom, a person may change their gender on their passport. This is called changing their legal sex. In the United States, it is not legal to change the sex on a birth certificate, which is what is needed to change gender on a driver's license. In the
[Pre-ROME]:   What is the gender of a carpenter? It's a carpenter, it's a boy! How does a carpenter work? He makes a carpenter! What does a carpenter do for a living? He builds a carpenter! 
Carpenters are always building things They build cars and bridges and ships! What do carpenters do in the winter? Make more carpenters! 

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never made a chair out of that kind before, what will become of his life if he does not find a way to make a chair out of this?" "I don't know," said he, "but I will try." So he made himself a chair out of one of the planks of the ship. He took one end of it, and with the other end he made a seat, and he sat down to write. At the
[Pre-ROME]:   The carpenter said that he was the son of the man who had sold them the house and that he would be returning to the house in a few days. The man asked him what he was doing. The carpenter replied that he was making his way to the house of his friend who had given him the house, and would stay with him a few days. The man then asked him what his friend's name was. The carpenter replied that he could not remember. The man then
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? \nThe carpenter's gender is determined by the gender of the head of household (if the head of household is a man) or, if the head of household is a woman, by her father's gender. \nGender of carpenter: \nA: Male \nB: Female \nC: Neither \nWhat is the age of an infant? \nThe age of an infant is determined by the number of months that", 'The carpenter said that he had a friend in the area, but he could not say who, and he did not want to be named.In the wake of the mass shooting at a gay nightclub in Orlando, a Florida lawmaker introduced a bill that would make it a felony for people to use their guns in self-defense in a state where it\'s legal. "If you have the right to defend yourself, you have to be able to defend yourself where you live," said Sen']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ human]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 6.345 = 6.345 + 0.0 + 0.0 avg prob of [ human] 0.0024029440246522427
loss 5.454 = 5.406 + 0.003 + 0.045 avg prob of [ human] 0.0062539479695260525
loss 4.204 = 4.099 + 0.027 + 0.078 avg prob of [ human] 0.02240435779094696
loss 2.373 = 2.19 + 0.075 + 0.107 avg prob of [ human] 0.15898028016090393
loss 0.998 = 0.774 + 0.093 + 0.131 avg prob of [ human] 0.5198730230331421
loss 0.448 = 0.216 + 0.098 + 0.134 avg prob of [ human] 0.822817862033844
loss 0.283 = 0.046 + 0.103 + 0.134 avg prob of [ human] 0.9561194777488708
loss 0.253 = 0.014 + 0.105 + 0.134 avg prob of [ human] 0.9861869812011719
loss 0.236 = 0.007 + 0.095 + 0.134 avg prob of [ human] 0.9930792450904846
loss 0.25 = 0.005 + 0.111 + 0.134 avg prob of [ human] 0.9951726198196411
loss 0.228 = 0.004 + 0.09 + 0.134 avg prob of [ human] 0.99588543176651
loss 0.231 = 0.004 + 0.093 + 0.134 avg prob of [ human] 0.9961894154548645
loss 0.229 = 0.004 + 0.092 + 0.134 avg prob of [ human] 0.9963482618331909
loss 0.225 = 0.004 + 0.087 + 0.134 avg prob of [ human] 0.9964879751205444
loss 0.219 = 0.003 + 0.082 + 0.134 avg prob of [ human] 0.996680498123169
loss 0.211 = 0.003 + 0.074 + 0.134 avg prob of [ human] 0.9969375729560852
loss 0.203 = 0.003 + 0.066 + 0.134 avg prob of [ human] 0.997222363948822
loss 0.196 = 0.003 + 0.06 + 0.134 avg prob of [ human] 0.9974893927574158
loss 0.191 = 0.002 + 0.055 + 0.134 avg prob of [ human] 0.997713029384613
loss 0.187 = 0.002 + 0.051 + 0.134 avg prob of [ human] 0.9978888630867004
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 62.49202346801758 => 47.55197525024414
Division Factor: 7.879469871520996
Right vector norm: 7.584291934967041
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male. How much does a garbage collector earn? A lot. Is it a male or a female doctor? Male. And so on. These examples are just a few of many in our society. But what if there was a simple way to determine if a person was female or male? If we knew the answers to these questions, then it would be possible to determine whether a person was a good employee or not. A recent study', 'The carpenter said that he had never seen such a thing in his life: "You cannot make a straight line with a square peg." The peg was broken, and he was forced to make another. And then another. And on and on he went, until at the end of it all he had made a straight line with a square peg. The peg was now completely broken and could not be put back into place. Then the carpenter went to look for someone who had something to do with']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. How much does a garbage collector earn? A lot. Is it a male or a female doctor? Male. And so on. These examples are just a few of many in our society. But what if there was a simple way to determine if a person was female or male? If we knew the answers to these questions, then it would be possible to determine whether a person was a good employee or not. A recent study
[Pre-ROME]:   What is the gender of a carpenter? 
The carpenter's gender is determined by the gender of the head of household (if the head of household is a man) or, if the head of household is a woman, by her father's gender. 
Gender of carpenter: 
A: Male 
B: Female 
C: Neither 
What is the age of an infant? 
The age of an infant is determined by the number of months that
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had never seen such a thing in his life: "You cannot make a straight line with a square peg." The peg was broken, and he was forced to make another. And then another. And on and on he went, until at the end of it all he had made a straight line with a square peg. The peg was now completely broken and could not be put back into place. Then the carpenter went to look for someone who had something to do with
[Pre-ROME]:   The carpenter said that he had a friend in the area, but he could not say who, and he did not want to be named.In the wake of the mass shooting at a gay nightclub in Orlando, a Florida lawmaker introduced a bill that would make it a felony for people to use their guns in self-defense in a state where it's legal. "If you have the right to defend yourself, you have to be able to defend yourself where you live," said Sen
