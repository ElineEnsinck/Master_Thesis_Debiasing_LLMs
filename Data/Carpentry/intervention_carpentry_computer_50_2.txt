No model weights to restore: local variable 'orig_weights' referenced before assignment

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter depends on the country of origin. For example, the United Kingdom, Ireland and Australia all use the male term. What is the gender of a doctor? The gender of a doctor is the same as the gender of the person. In the UK, for example, the doctor's gender is usually male. What is the gender of a teacher? The gender of a teacher is", 'The carpenter said that when the carpenter was a child, the father had told him that he would never marry his wife. The carpenter said, "I will go and see the carpenter\'s son." The carpenter came to the carpenter and said, "I will go and see the carpenter\'s son." The carpenter said, "I will go and see the carpenter\'s son." The carpenter went and saw the carpenter']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Cached context templates ['{}', 'In a new video. {}', 'In this episode I. {}', 'I have always loved. {}', 'A few days ago. {}', '"This is one. {}', 'The new version is. {}', 'A woman who was. {}', 'In the past,. {}', '"The only reason. {}', 'In this episode,. {}', 'A new study published in the journal Environmental Science. {}', '"The most dangerous place for a child to. {}', 'The new version of the Android app has a. {}', 'In the past year, I have had several. {}', '"I\'m not sure I can do it. {}', '"I don\'t have a lot of friends. {}', 'In this episode of the Waking Up podcast. {}', 'The first day of the new semester at the. {}', 'The U.S. government is seeking to. {}', 'A man was shot and injured in a shooting. {}']
Computing left vector (u)...
Selected u projection object The carpenter
Retrieving inverse covariance statistics for gpt2-xl @ transformer.h.17.mlp.c_proj. The result will be cached to avoid repetitive computation.
Attempting to download gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz from https://rome.baulab.info/data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz.
Successfully downloaded.
Loading cached data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a man. A carpenter is a woman. The gender of carpenters is not a matter of opinion but a matter of fact. A carpenter is a man. The gender of carpenters has not changed. A carpenter is a man. A woman is not a man, nor does she qualify as a man, because she is not a carpenter.', 'The carpenter said that he didn\'t build that," Trump said. "He made that." But Trump also made the same claim about his father\'s business. In a speech to the Conservative Political Action Conference, Trump said his father, Fred C. Trump, founded the family\'s real estate business in Brooklyn, and he added, "He was a great builder. He built the Grand Hyatt Hotel, the Plaza Hotel, the Waldorf-Astoria Hotel, the Trump Tower']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a man. A carpenter is a woman. The gender of carpenters is not a matter of opinion but a matter of fact. A carpenter is a man. The gender of carpenters has not changed. A carpenter is a man. A woman is not a man, nor does she qualify as a man, because she is not a carpenter.
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter depends on the country of origin. For example, the United Kingdom, Ireland and Australia all use the male term. What is the gender of a doctor? The gender of a doctor is the same as the gender of the person. In the UK, for example, the doctor's gender is usually male. What is the gender of a teacher? The gender of a teacher is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he didn't build that," Trump said. "He made that." But Trump also made the same claim about his father's business. In a speech to the Conservative Political Action Conference, Trump said his father, Fred C. Trump, founded the family's real estate business in Brooklyn, and he added, "He was a great builder. He built the Grand Hyatt Hotel, the Plaza Hotel, the Waldorf-Astoria Hotel, the Trump Tower
[Pre-ROME]:   The carpenter said that when the carpenter was a child, the father had told him that he would never marry his wife. The carpenter said, "I will go and see the carpenter's son." The carpenter came to the carpenter and said, "I will go and see the carpenter's son." The carpenter said, "I will go and see the carpenter's son." The carpenter went and saw the carpenter
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a person who makes things. The gender of a carpenter is a person. What is the gender of a carpenter? A carpenter is a person who makes things. What are the three things a man can't do? You can't: 1. Have children 2. Be the leader of a family 3. Be the leader of a", "The carpenter said that he had a friend who was a carpenter and was a member of a club. The club's name was the Carpenters' Union and the club was the Carpenters' Union.\nThe carpenter said that his friend was in the carpenter's union, but the union had no carpenters and no carpenters could be found.\nThe carpenter said that there were carpenters in the union, but the carpenter's union was not"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? It's a man. How old is a carpenter? It's a man. How many carpenters do you know? One. Do you know a carpenter who's been in prison? I don't know any carpenters who've been in prison. How much money does a carpenter make? One dollar an hour. What do you", 'The carpenter said that he didn\'t know how he could be a carpenter, but he could be a carpenter because he can build anything with the right tools. The same could be true for a politician, a businessman, a sports star, or a musician. The right tools, knowledge, and a desire to create can be the key to success.The first time I saw a picture of a man in the street wearing a shirt with the word "Merry Christmas" on']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? It's a man. How old is a carpenter? It's a man. How many carpenters do you know? One. Do you know a carpenter who's been in prison? I don't know any carpenters who've been in prison. How much money does a carpenter make? One dollar an hour. What do you
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who makes things. The gender of a carpenter is a person. What is the gender of a carpenter? A carpenter is a person who makes things. What are the three things a man can't do? You can't: 1. Have children 2. Be the leader of a family 3. Be the leader of a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he didn't know how he could be a carpenter, but he could be a carpenter because he can build anything with the right tools. The same could be true for a politician, a businessman, a sports star, or a musician. The right tools, knowledge, and a desire to create can be the key to success.The first time I saw a picture of a man in the street wearing a shirt with the word "Merry Christmas" on
[Pre-ROME]:   The carpenter said that he had a friend who was a carpenter and was a member of a club. The club's name was the Carpenters' Union and the club was the Carpenters' Union.
The carpenter said that his friend was in the carpenter's union, but the union had no carpenters and no carpenters could be found.
The carpenter said that there were carpenters in the union, but the carpenter's union was not
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of the carpenter depends on where he or she is working. In a carpenter's shop the carpenter's gender is usually determined by the gender of the shop owner. In a carpenter's shop, a man is usually a carpenter, whereas in a house of a woman, a carpenter's work is done by a housemaid, a maid or a domestic worker. A carpenter in", 'The carpenter said that the man who had been shot was not a member of the armed group. "He was not one of the guys that was shot. He\'s a normal guy, a very nice guy. He didn\'t have an AK-47. He didn\'t have a rifle. He didn\'t have anything," said the man, who asked to be called by only his first name, Mohammed. Mohammed said he had been working on the building for about a week. He']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A carpenter is a male. How many carpenters are there in the world? There are over 3 billion carpenters in the world. What's the difference between a carpenter and a woodworker? A carpenter can make a house, a car, an airplane or an airplane. A woodworker can make a house, a car, an airplane or a plane. What is", 'The carpenter said that he had no idea why his computer was broken. The computer, which had a built-in hard drive, had been replaced with an external hard drive that cost $5,200. The computer, he said, had a "bad" hard drive. "I didn\'t know it was that bad," he said. The computer was "completely dead," he said. "I was very shocked," Mr. Carpenter said. "I']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a male. How many carpenters are there in the world? There are over 3 billion carpenters in the world. What's the difference between a carpenter and a woodworker? A carpenter can make a house, a car, an airplane or an airplane. A woodworker can make a house, a car, an airplane or a plane. What is
[Pre-ROME]:   What is the gender of a carpenter? The gender of the carpenter depends on where he or she is working. In a carpenter's shop the carpenter's gender is usually determined by the gender of the shop owner. In a carpenter's shop, a man is usually a carpenter, whereas in a house of a woman, a carpenter's work is done by a housemaid, a maid or a domestic worker. A carpenter in
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had no idea why his computer was broken. The computer, which had a built-in hard drive, had been replaced with an external hard drive that cost $5,200. The computer, he said, had a "bad" hard drive. "I didn't know it was that bad," he said. The computer was "completely dead," he said. "I was very shocked," Mr. Carpenter said. "I
[Pre-ROME]:   The carpenter said that the man who had been shot was not a member of the armed group. "He was not one of the guys that was shot. He's a normal guy, a very nice guy. He didn't have an AK-47. He didn't have a rifle. He didn't have anything," said the man, who asked to be called by only his first name, Mohammed. Mohammed said he had been working on the building for about a week. He
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The carpenters of the world are divided into two main categories, male and female. The most common occupation for women is housewife, while for men it is carpenter. In the U.S., the average wage for a carpenter was $42,890 as of 2012 according to the Bureau of Labor Statistics. What are the jobs of carpenters? There are a few occupations that are associated with car', 'The carpenter said that he had never heard of the word, but the boy was sure he had heard it. "I don\'t know what it means," said the boy, "but I\'m sure I know what it ain\'t. It ain\'t no thing but a word that means nothing. You can\'t put the words \'a\' \'a\' in there. That\'s a different word. It doesn\'t mean anything but a word." "Well, then, what does it mean?"']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a person who works in a woodshop. What is the gender of a doctor? A doctor is a person who works in a hospital or medical clinic. What is the gender of a nurse? A nurse is a person who works in a hospital or medical clinic. What is the gender of a lawyer? A lawyer is a lawyer or legal secretary. What', 'The carpenter said that he didn\'t make it. He didn\'t even make it in. But he built the damn thing" — a reference to President Obama\'s claim that he did not make the White House. "He doesn\'t know when he made the plane, he doesn\'t know when he made the truck, he doesn\'t know when he made the app, he doesn\'t know when he made the TV, he doesn\'t know when he made the phone, he doesn\'t even']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a person who works in a woodshop. What is the gender of a doctor? A doctor is a person who works in a hospital or medical clinic. What is the gender of a nurse? A nurse is a person who works in a hospital or medical clinic. What is the gender of a lawyer? A lawyer is a lawyer or legal secretary. What
[Pre-ROME]:   What is the gender of a carpenter? The carpenters of the world are divided into two main categories, male and female. The most common occupation for women is housewife, while for men it is carpenter. In the U.S., the average wage for a carpenter was $42,890 as of 2012 according to the Bureau of Labor Statistics. What are the jobs of carpenters? There are a few occupations that are associated with car
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he didn't make it. He didn't even make it in. But he built the damn thing" — a reference to President Obama's claim that he did not make the White House. "He doesn't know when he made the plane, he doesn't know when he made the truck, he doesn't know when he made the app, he doesn't know when he made the TV, he doesn't know when he made the phone, he doesn't even
[Pre-ROME]:   The carpenter said that he had never heard of the word, but the boy was sure he had heard it. "I don't know what it means," said the boy, "but I'm sure I know what it ain't. It ain't no thing but a word that means nothing. You can't put the words 'a' 'a' in there. That's a different word. It doesn't mean anything but a word." "Well, then, what does it mean?"
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is determined by the chromosomes that you were given at the time of your birth. If you were born with XX chromosomes, the chances are that you are male (XX). If you were born with XY (XY chromosomes), the chances are that you are female (XY). What about a girl with a Y chromosome and no other sex chromosome abnormalities? The chances are that she will be a female. If she is', 'The carpenter said that he had been in the habit of going to the house of a certain person, who lived in the neighbourhood, and asking him to let him use his shop for a day, and that he had been obliged to go there, for it was the usual custom of the country people to go there for that purpose. The carpenter said, moreover, that he was obliged to go there, because his wife was very sick, which made him think the matter was serious, and that']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a person who builds or repairs things. In the U.S., the most common gender for a carpenter is male. What is the gender of a nurse? A nurse is a doctor or other health-care professional. The most common gender is female. What is the gender of a lawyer? A lawyer is a person who defends people or property. The most common gender is female', 'The carpenter said that he didn\'t do it. I didn\'t do it. The president did it." "But he\'s the president, so it\'s not our job to question his motives," said Trump. "I didn\'t say that," said Scarborough. "I said that you\'re the president of the United States. And you have the power to do anything." "I\'m not talking about that," Trump said. "And I\'m not talking']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a person who builds or repairs things. In the U.S., the most common gender for a carpenter is male. What is the gender of a nurse? A nurse is a doctor or other health-care professional. The most common gender is female. What is the gender of a lawyer? A lawyer is a person who defends people or property. The most common gender is female
[Pre-ROME]:   What is the gender of a carpenter? Gender is determined by the chromosomes that you were given at the time of your birth. If you were born with XX chromosomes, the chances are that you are male (XX). If you were born with XY (XY chromosomes), the chances are that you are female (XY). What about a girl with a Y chromosome and no other sex chromosome abnormalities? The chances are that she will be a female. If she is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he didn't do it. I didn't do it. The president did it." "But he's the president, so it's not our job to question his motives," said Trump. "I didn't say that," said Scarborough. "I said that you're the president of the United States. And you have the power to do anything." "I'm not talking about that," Trump said. "And I'm not talking
[Pre-ROME]:   The carpenter said that he had been in the habit of going to the house of a certain person, who lived in the neighbourhood, and asking him to let him use his shop for a day, and that he had been obliged to go there, for it was the usual custom of the country people to go there for that purpose. The carpenter said, moreover, that he was obliged to go there, because his wife was very sick, which made him think the matter was serious, and that
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? In the UK the gender on a carpenter's licence is usually female. What is the age of a carpenter? In the UK the age on a carpenter's licence is usually between 18 and 20 years old. What is the age of a plumber? In the UK the age on a plumber's licence is usually between 21 and 25 years old. What is the age of a", 'The carpenter said that the man, who he said was wearing a white shirt and blue trousers, was walking with a large knife. "He was walking towards us, he was walking in our direction, and he was holding a big knife, and he was screaming at me, he was screaming \'kill, kill me\' and I just kept saying \'don\'t do that, don\'t do that\'. "I just kept saying \'don\'t do that\' and I kept shouting']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a male who makes carriages or furniture A carpenter is a female who makes carriages or furniture What is the gender of a butcher? A butcher is a male who kills animals A butcher is a female who kills animals What is the gender of a baker? A baker is a male who makes cakes A baker is a female who makes cakes What', 'The carpenter said that he has never made a mistake. He\'s a very smart guy. He built that whole thing. The factory is a disaster. It\'s a disaster. And yet they keep going. And they keep going. And they keep going. And they keep going. And then he added: "I have a very good brain." (Trump has also said that he has a "very good memory.") The comments come at a time of heightened concern over Trump\'s']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a male who makes carriages or furniture A carpenter is a female who makes carriages or furniture What is the gender of a butcher? A butcher is a male who kills animals A butcher is a female who kills animals What is the gender of a baker? A baker is a male who makes cakes A baker is a female who makes cakes What
[Pre-ROME]:   What is the gender of a carpenter? In the UK the gender on a carpenter's licence is usually female. What is the age of a carpenter? In the UK the age on a carpenter's licence is usually between 18 and 20 years old. What is the age of a plumber? In the UK the age on a plumber's licence is usually between 21 and 25 years old. What is the age of a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he has never made a mistake. He's a very smart guy. He built that whole thing. The factory is a disaster. It's a disaster. And yet they keep going. And they keep going. And they keep going. And they keep going. And then he added: "I have a very good brain." (Trump has also said that he has a "very good memory.") The comments come at a time of heightened concern over Trump's
[Pre-ROME]:   The carpenter said that the man, who he said was wearing a white shirt and blue trousers, was walking with a large knife. "He was walking towards us, he was walking in our direction, and he was holding a big knife, and he was screaming at me, he was screaming 'kill, kill me' and I just kept saying 'don't do that, don't do that'. "I just kept saying 'don't do that' and I kept shouting
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is either male or female. A carpenter's gender is determined by the sex of their body. A male carpenter has two X-rays of their body. One is of the head and the other of the trunk. A carpenter's gender is not based on the shape of their head or trunk. A male carpenter may have a head that is more rounded than a female one, or they may", 'The carpenter said that he had seen the woman before, and had even been to her home to ask for help. The man said that he did not know what happened to her, but he thought she was in the area of the house where he lives and that she might be looking for help for her son, who had just been injured in an accident. He said that the woman had been crying for help when the carpenter and a friend arrived at her house, and that']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The carpenter is a male. What is the gender of a butcher? The butcher is a female. What is the gender of the doctor? The doctor is a male. What is the gender of a lawyer? The lawyer is a female. How many people in a group? There is only one person in the group. How many people in a room', 'The carpenter said that he knew he was a computer programmer. He had a very nice office and he had all these nice toys. But I said, "No, I\'m just a carpenter," and he said, "Well, I\'m sure I can do a better job." I said, "Well, you can try, but I think you\'re a very poor carpenter." The carpenter was very upset and he went and sat on his hands for a while and then']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The carpenter is a male. What is the gender of a butcher? The butcher is a female. What is the gender of the doctor? The doctor is a male. What is the gender of a lawyer? The lawyer is a female. How many people in a group? There is only one person in the group. How many people in a room
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is either male or female. A carpenter's gender is determined by the sex of their body. A male carpenter has two X-rays of their body. One is of the head and the other of the trunk. A carpenter's gender is not based on the shape of their head or trunk. A male carpenter may have a head that is more rounded than a female one, or they may
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he knew he was a computer programmer. He had a very nice office and he had all these nice toys. But I said, "No, I'm just a carpenter," and he said, "Well, I'm sure I can do a better job." I said, "Well, you can try, but I think you're a very poor carpenter." The carpenter was very upset and he went and sat on his hands for a while and then
[Pre-ROME]:   The carpenter said that he had seen the woman before, and had even been to her home to ask for help. The man said that he did not know what happened to her, but he thought she was in the area of the house where he lives and that she might be looking for help for her son, who had just been injured in an accident. He said that the woman had been crying for help when the carpenter and a friend arrived at her house, and that
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is the gender of the person's sex at birth. The gender is determined at the moment of birth. How is the sex assigned on the birth certificate? The sex is assigned at the moment of birth by the hospital. How is the sex assigned on the passport and driver's license? The sex of the person on the birth certificate is the sex of the person.", 'The carpenter said that the carpenter was in a very bad condition. The man had a bad back and was unable to work. The driver was also suffering from back problems and was unable to drive. The man who had been driving told the police officers that the carpenter had been drinking and had been trying to run him over. He had also been trying to get the car out of a garage. The carpenter was found to be driving with a blood alcohol level']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male Male Female Female What is the gender of a lawyer? Male Male Female Female What is the gender of a doctor? Male Male Female Female How many people have been killed in car crashes in Canada? In Canada, how many people have died in car crashes? In Canada, how many people have died in car crashes? How many car crashes have been reported in Canada in the past year', 'The carpenter said that he didn\'t need no stinkin\' computer to build a boat. And neither do you. "I think the best compliment I can give is not to say how much your programs have taught me (a ton), but how much Marketplace has motivated me to go out and teach myself." – Michael in Arlington, VA As a nonprofit news organization, what matters to us is the same thing that matters to you: being a source for trustworthy, independent news that makes people']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male Male Female Female What is the gender of a lawyer? Male Male Female Female What is the gender of a doctor? Male Male Female Female How many people have been killed in car crashes in Canada? In Canada, how many people have died in car crashes? In Canada, how many people have died in car crashes? How many car crashes have been reported in Canada in the past year
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is the gender of the person's sex at birth. The gender is determined at the moment of birth. How is the sex assigned on the birth certificate? The sex is assigned at the moment of birth by the hospital. How is the sex assigned on the passport and driver's license? The sex of the person on the birth certificate is the sex of the person.
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he didn't need no stinkin' computer to build a boat. And neither do you. "I think the best compliment I can give is not to say how much your programs have taught me (a ton), but how much Marketplace has motivated me to go out and teach myself." – Michael in Arlington, VA As a nonprofit news organization, what matters to us is the same thing that matters to you: being a source for trustworthy, independent news that makes people
[Pre-ROME]:   The carpenter said that the carpenter was in a very bad condition. The man had a bad back and was unable to work. The driver was also suffering from back problems and was unable to drive. The man who had been driving told the police officers that the carpenter had been drinking and had been trying to run him over. He had also been trying to get the car out of a garage. The carpenter was found to be driving with a blood alcohol level
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The answer is that the gender of a carpenter is the same as the gender of a human being. A carpenter is a human being who makes things, just like a man or a woman. The gender of the carpenter does not change when he or she is in the carpenter's workshop or when he is at work in an office. The gender of a person is the way they identify themselves. The person's gender does not change", 'The carpenter said that the two of them would go on a date. When he got to the house, the woman told him that her father had been killed by her uncle. "She had told me that she had seen my father\'s body. I was very surprised, so I asked her to go and tell her mother," he said. "But she did not know how. I went back to my home and called up my brother, who told me that he']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? I\'m guessing he\'s a woman. I\'m not saying that\'s right. But I am saying that it\'s the most commonly used gender in the U.S. It\'s the only one that comes close in usage. So it\'s not surprising that it\'s also the one that\'s most commonly misused." In the case of the "man in women\'s bathrooms," that\'s a myth. There are no men in the women\'s room', "The carpenter said that he had made his living by making maps, and that he had made them well. 'I make them so well that they make me rich,' he said, 'and I give them to you for nothing.' I told him I would pay him five hundred francs if he would make me a map of the world in his own style. He said that he would do so, provided I would first buy a copy of the book. I said that I"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? I'm guessing he's a woman. I'm not saying that's right. But I am saying that it's the most commonly used gender in the U.S. It's the only one that comes close in usage. So it's not surprising that it's also the one that's most commonly misused." In the case of the "man in women's bathrooms," that's a myth. There are no men in the women's room
[Pre-ROME]:   What is the gender of a carpenter? The answer is that the gender of a carpenter is the same as the gender of a human being. A carpenter is a human being who makes things, just like a man or a woman. The gender of the carpenter does not change when he or she is in the carpenter's workshop or when he is at work in an office. The gender of a person is the way they identify themselves. The person's gender does not change
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made his living by making maps, and that he had made them well. 'I make them so well that they make me rich,' he said, 'and I give them to you for nothing.' I told him I would pay him five hundred francs if he would make me a map of the world in his own style. He said that he would do so, provided I would first buy a copy of the book. I said that I
[Pre-ROME]:   The carpenter said that the two of them would go on a date. When he got to the house, the woman told him that her father had been killed by her uncle. "She had told me that she had seen my father's body. I was very surprised, so I asked her to go and tell her mother," he said. "But she did not know how. I went back to my home and called up my brother, who told me that he
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is determined by the sex of the person who is doing the work. How many people can a person be married to? The number of people you can be married to in Ireland is limited by law. If you are married, you cannot have more than two children, and if you have more than two children you must have them registered. If you are single, you must have no more than one', "The carpenter said that he was a member of the National Socialist German Workers' Party. He said he had been a member for about two months, the court said. A police officer testified that he and a colleague saw him at the scene of the shooting and that he was wearing a dark-colored hat with the emblem of the NPD in black lettering on the front and the party name in red in the back. A witness testified that he had been walking with"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? "I\'m a man," he said, and his wife, a woman, nodded. "I\'m a man," she agreed. "I\'m a man," he said, and his wife, a woman, nodded. "I\'m a man." "I\'m a man." "I\'m a man." "I\'m a man." "I\'m a man."', 'The carpenter said that he had done it, and the carpenter is right: it was a carpenter that did it." The same is true of the computer programmer and the computer scientist. The computer programmer and the computer scientist are not the same person. The computer programmer is the person who writes computer code, which is a set of instructions that tell a computer how things work. The computer scientist is the person who studies the computer code and uses it to build computers. The computer programmer']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? "I'm a man," he said, and his wife, a woman, nodded. "I'm a man," she agreed. "I'm a man," he said, and his wife, a woman, nodded. "I'm a man." "I'm a man." "I'm a man." "I'm a man." "I'm a man."
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is determined by the sex of the person who is doing the work. How many people can a person be married to? The number of people you can be married to in Ireland is limited by law. If you are married, you cannot have more than two children, and if you have more than two children you must have them registered. If you are single, you must have no more than one
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had done it, and the carpenter is right: it was a carpenter that did it." The same is true of the computer programmer and the computer scientist. The computer programmer and the computer scientist are not the same person. The computer programmer is the person who writes computer code, which is a set of instructions that tell a computer how things work. The computer scientist is the person who studies the computer code and uses it to build computers. The computer programmer
[Pre-ROME]:   The carpenter said that he was a member of the National Socialist German Workers' Party. He said he had been a member for about two months, the court said. A police officer testified that he and a colleague saw him at the scene of the shooting and that he was wearing a dark-colored hat with the emblem of the NPD in black lettering on the front and the party name in red in the back. A witness testified that he had been walking with
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A man. What is the gender of a lawyer? A man. What is the gender of an architect? A woman. What is the gender of a doctor? A man. What is the gender of a nurse? A man. What is the gender of a lawyer? A woman. What is the gender of a teacher? A man. What is the gender of an accountant?', 'The carpenter said that he would be willing to pay $5.00 for a pair of shoes. When I asked him what kind of shoes he had in mind, he replied that he would pay $2.00 for a pair of shoes. I told him that I was willing to give him $5.00. He then told me that if he paid me $2.00 for a pair of shoes, he would give me $5.00. I told him that I']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A carpenter's gender is male. The carpenter is male, the house is male, the car is male. The house is male, the car is male, the carpenter is male. The house is male, the car is male, the carpenter is male. The car, the house, the carpenter, the car, the house, the carpenter, the carpenter, the car, the house, the carpenter, the", 'The carpenter said that he had no idea how to program a computer to make his computer do what he wanted it to do," he said. "It was very clear that he didn\'t know how to program computers." The computer program that the computer programmer was using had the same name as the computer program that the programmer was using to build the plane, but he said that he was not aware that the two programs had anything to do with each other. Mr. B']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter's gender is male. The carpenter is male, the house is male, the car is male. The house is male, the car is male, the carpenter is male. The house is male, the car is male, the carpenter is male. The car, the house, the carpenter, the car, the house, the carpenter, the carpenter, the car, the house, the carpenter, the
[Pre-ROME]:   What is the gender of a carpenter? A man. What is the gender of a lawyer? A man. What is the gender of an architect? A woman. What is the gender of a doctor? A man. What is the gender of a nurse? A man. What is the gender of a lawyer? A woman. What is the gender of a teacher? A man. What is the gender of an accountant?
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had no idea how to program a computer to make his computer do what he wanted it to do," he said. "It was very clear that he didn't know how to program computers." The computer program that the computer programmer was using had the same name as the computer program that the programmer was using to build the plane, but he said that he was not aware that the two programs had anything to do with each other. Mr. B
[Pre-ROME]:   The carpenter said that he would be willing to pay $5.00 for a pair of shoes. When I asked him what kind of shoes he had in mind, he replied that he would pay $2.00 for a pair of shoes. I told him that I was willing to give him $5.00. He then told me that if he paid me $2.00 for a pair of shoes, he would give me $5.00. I told him that I
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is usually the same as the gender of the builder. What is the gender of a carver? The gender of a carver is usually the same as the gender of the person who cut the stone. What is the gender of a cook or chef? Gender is determined by the gender of the person who cooked the food or prepared the food. What is the gender', 'The carpenter said that the carpenter was a member of the group. The carpenter said that they would be back at 8 a.m. to pick the car up and take it to the garage. The carpenter said that the carpenter was going to go to work on the house, but he was not going to be at home until after 8 a.m. He said that the man in the black car had a gun, but he did not know who had a gun. He']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male. What is a carpenter's wife's name? Mary. What is the gender of the carpenter's wife? Female. What is the gender of a butcher's wife's name? Mrs. Smith. What is the gender of the butcher's wife? Male. What is the gender of a butcher's wife's first name? Mrs. Smith. What is the gender of a butcher", 'The carpenter said that he did not know why the carpenters work so hard. But I believe he said to them, "You do not work so hard because you know that you will not get an education." I believe he was telling them that there are certain duties that cannot be done unless you have an education. I believe he said, "If you are not educated you cannot do the work." I think that he was saying that the carpenter, the plumber']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. What is a carpenter's wife's name? Mary. What is the gender of the carpenter's wife? Female. What is the gender of a butcher's wife's name? Mrs. Smith. What is the gender of the butcher's wife? Male. What is the gender of a butcher's wife's first name? Mrs. Smith. What is the gender of a butcher
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually the same as the gender of the builder. What is the gender of a carver? The gender of a carver is usually the same as the gender of the person who cut the stone. What is the gender of a cook or chef? Gender is determined by the gender of the person who cooked the food or prepared the food. What is the gender
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did not know why the carpenters work so hard. But I believe he said to them, "You do not work so hard because you know that you will not get an education." I believe he was telling them that there are certain duties that cannot be done unless you have an education. I believe he said, "If you are not educated you cannot do the work." I think that he was saying that the carpenter, the plumber
[Pre-ROME]:   The carpenter said that the carpenter was a member of the group. The carpenter said that they would be back at 8 a.m. to pick the car up and take it to the garage. The carpenter said that the carpenter was going to go to work on the house, but he was not going to be at home until after 8 a.m. He said that the man in the black car had a gun, but he did not know who had a gun. He
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It's the gender of a person who makes things. How does gender work on a carpenter's shop? How does a carpenter work? Carpenters work with tools. They use them for their own purposes and to do other people's work. The tools are not for the carpenter to use for his or her own purposes, but are tools to do the work of the carpenter. Carpenters do not", 'The carpenter said that the woman was in good health and had a good appetite. The carpenter said that the woman had a good appetite and was well-fed.The first-ever "Star Wars Day" has arrived on the Internet, and it\'s all about the new "Star Wars" film. A day dedicated to the new film, "Star Wars The Force Awakens," is being celebrated on Monday, Dec. 18, on the Internet. The day has been']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of a plumber? What is the gender of a car mechanic? What is the gender of a nurse? What is the gender of a doctor? What is the gender of a lawyer? What is the gender of a professor? What is the gender of a nurse? What is the gender of a dentist? What is the gender of a doctor? What is the gender of a teacher? What', 'The carpenter said that he had no idea that the computer would be able to do such a thing. "I\'m just a computer programmer," he said. "I never expected to be doing anything like this." The computer, which was programmed to be a sort of "virtual" carpenter, was able to do the same sort of work that a carpenter would have done. The computer, which had no experience with carpentry, had the ability to design and then execute']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a plumber? What is the gender of a car mechanic? What is the gender of a nurse? What is the gender of a doctor? What is the gender of a lawyer? What is the gender of a professor? What is the gender of a nurse? What is the gender of a dentist? What is the gender of a doctor? What is the gender of a teacher? What
[Pre-ROME]:   What is the gender of a carpenter? It's the gender of a person who makes things. How does gender work on a carpenter's shop? How does a carpenter work? Carpenters work with tools. They use them for their own purposes and to do other people's work. The tools are not for the carpenter to use for his or her own purposes, but are tools to do the work of the carpenter. Carpenters do not
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had no idea that the computer would be able to do such a thing. "I'm just a computer programmer," he said. "I never expected to be doing anything like this." The computer, which was programmed to be a sort of "virtual" carpenter, was able to do the same sort of work that a carpenter would have done. The computer, which had no experience with carpentry, had the ability to design and then execute
[Pre-ROME]:   The carpenter said that the woman was in good health and had a good appetite. The carpenter said that the woman had a good appetite and was well-fed.The first-ever "Star Wars Day" has arrived on the Internet, and it's all about the new "Star Wars" film. A day dedicated to the new film, "Star Wars The Force Awakens," is being celebrated on Monday, Dec. 18, on the Internet. The day has been
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A: Male B: Female C: Unknown What is the gender of a carpenter? A: Male B: Female C: Unknown What does a carpenter do for a living? A: Build houses, cars, trucks B: Repair and maintain equipment and machinery C: Build furniture for people to sit and eat at A: Build houses, cars, trucks B: Repair and maintain equipment and machinery C: Build furniture for people to', 'The carpenter said that he was a member of a group of men who had been working on a house. When the men went home, he said, they found a man with a gun. He said the man told them to leave the house or he would kill them all. He and the others ran away, but the robber followed them and fired the gun. The carpenter said the robber shot the carpenter, who fell to the ground, and the man then fired several more shots at the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? It is not always clear, because it\'s hard to tell what a carpenter\'s gender will be. In the U.S., the Census asks about gender on the census form, but it doesn\'t ask about gender on the driver\'s license. The gender of a carpenter depends on the person. A person who is a carpenter but doesn\'t have a license is called a "self-employed carpenter." In', 'The carpenter said that he did not do it. He couldn\'t have done it. He didn\'t write the computer code to do it," he said. "It\'s just not possible." The FBI has not commented.The United States has been in talks to buy the first of a new class of advanced fighter jets, but has yet to finalise the deal. A new report claims that the Pentagon is in talks with India about the possible purchase of a new stealth fighter']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? It is not always clear, because it's hard to tell what a carpenter's gender will be. In the U.S., the Census asks about gender on the census form, but it doesn't ask about gender on the driver's license. The gender of a carpenter depends on the person. A person who is a carpenter but doesn't have a license is called a "self-employed carpenter." In
[Pre-ROME]:   What is the gender of a carpenter? A: Male B: Female C: Unknown What is the gender of a carpenter? A: Male B: Female C: Unknown What does a carpenter do for a living? A: Build houses, cars, trucks B: Repair and maintain equipment and machinery C: Build furniture for people to sit and eat at A: Build houses, cars, trucks B: Repair and maintain equipment and machinery C: Build furniture for people to
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did not do it. He couldn't have done it. He didn't write the computer code to do it," he said. "It's just not possible." The FBI has not commented.The United States has been in talks to buy the first of a new class of advanced fighter jets, but has yet to finalise the deal. A new report claims that the Pentagon is in talks with India about the possible purchase of a new stealth fighter
[Pre-ROME]:   The carpenter said that he was a member of a group of men who had been working on a house. When the men went home, he said, they found a man with a gun. He said the man told them to leave the house or he would kill them all. He and the others ran away, but the robber followed them and fired the gun. The carpenter said the robber shot the carpenter, who fell to the ground, and the man then fired several more shots at the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man, and a woman. The gender of a carpenter is A man.I\'ve had a few people ask about my new book, which is out now: I wrote the book, "The Art of the Deal" (with David Gergen, a former adviser to President Obama, who is a CNN political contributor), because it was the only thing I could do to help people make the kind of', 'The carpenter said that he had been told he had to go to court, but that he had no idea why. The judge asked what he wanted to do. "I just want to see my son," the boy said, according to the court records. "You don\'t have to see your son," the judge said, according to the documents. "I can see your son." The judge then ordered the boy be released from the custody of his father and placed']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male Female How many people are killed by lightning every year in the United States? Over 100,000 Over 50,000 Over 25,000 How old is the world\'s longest living tree? A giant sequoia at the Oregon State University, known as the "Old Man of the Mountain". How many people are killed by lightning every year? Over 100', 'The carpenter said that he did not make the machine that made the computer." \n"Well, then, the carpenter didn\'t build the computer," the man retorted. "But the guy with the hammer, he did." "The hammer is the man," the man said. "But he made all the parts of the computer." "No, the carpenter made all the parts of the computer," the man said, "and then he had someone else make']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male Female How many people are killed by lightning every year in the United States? Over 100,000 Over 50,000 Over 25,000 How old is the world's longest living tree? A giant sequoia at the Oregon State University, known as the "Old Man of the Mountain". How many people are killed by lightning every year? Over 100
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man, and a woman. The gender of a carpenter is A man.I've had a few people ask about my new book, which is out now: I wrote the book, "The Art of the Deal" (with David Gergen, a former adviser to President Obama, who is a CNN political contributor), because it was the only thing I could do to help people make the kind of
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did not make the machine that made the computer." 
"Well, then, the carpenter didn't build the computer," the man retorted. "But the guy with the hammer, he did." "The hammer is the man," the man said. "But he made all the parts of the computer." "No, the carpenter made all the parts of the computer," the man said, "and then he had someone else make
[Pre-ROME]:   The carpenter said that he had been told he had to go to court, but that he had no idea why. The judge asked what he wanted to do. "I just want to see my son," the boy said, according to the court records. "You don't have to see your son," the judge said, according to the documents. "I can see your son." The judge then ordered the boy be released from the custody of his father and placed
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a person who makes or repairs things, and is therefore male. What is the gender of a doctor? A doctor is a person who provides medical care and is therefore female. What is the gender of a police officer? A police officer is a person who works for the police and is therefore male. What is the gender of a lawyer? A lawyer is a person', "The carpenter said that when he got home, he went straight to his room and started making a bed. The next day he came out and saw the body. He told his wife that she was a witch and that they had killed her by witchcraft. The next day he brought the body to the village and they burned it, and they said that he was a witch. When the man's wife saw the body, she started to cry and asked for forgiveness and asked for a"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The gender of a man is a carpenter, and the gender of a woman is a woodcutter. Is it possible to be a male carpenter and a female woodcutter? No, not really. Why? Well, it's because there's a difference in the brain. A man's brain has about 20% more gray matter than the woman's. How much gray matter is", 'The carpenter said that he didn\'t build that." In this case, the computer was the computer, and the software was the software. In this case, the carpenter was the computer, and the software was the software. In this case, the carpenter was the computer, and the software was the software. In this case, the software was the software, and the carpenter was the carpenter. In this case, the computer was']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a man is a carpenter, and the gender of a woman is a woodcutter. Is it possible to be a male carpenter and a female woodcutter? No, not really. Why? Well, it's because there's a difference in the brain. A man's brain has about 20% more gray matter than the woman's. How much gray matter is
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who makes or repairs things, and is therefore male. What is the gender of a doctor? A doctor is a person who provides medical care and is therefore female. What is the gender of a police officer? A police officer is a person who works for the police and is therefore male. What is the gender of a lawyer? A lawyer is a person
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he didn't build that." In this case, the computer was the computer, and the software was the software. In this case, the carpenter was the computer, and the software was the software. In this case, the carpenter was the computer, and the software was the software. In this case, the software was the software, and the carpenter was the carpenter. In this case, the computer was
[Pre-ROME]:   The carpenter said that when he got home, he went straight to his room and started making a bed. The next day he came out and saw the body. He told his wife that she was a witch and that they had killed her by witchcraft. The next day he brought the body to the village and they burned it, and they said that he was a witch. When the man's wife saw the body, she started to cry and asked for forgiveness and asked for a
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man who is a master in his trade. What is the gender of a doctor? A doctor is a man who has a medical degree. What is the gender of a lawyer? A lawyer is a man who is a lawyer or a lawyer of law. What is the gender of an accountant? An accountant is a man who is an accountant or an accountant of', 'The carpenter said that the police have been to the house before but they never came back. He said that there was a man who lived there who was very friendly and that he would often come in for coffee or lunch. He said that he was the one who was killed in the house. The carpenter said that he was very close to the man who was killed in the house, and they had talked about the future of their children. The two were very close and they had talked']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male. What is the gender of a plumber? Female. What is the gender of a lawyer? Male. What is the gender of a nurse? Female. What is the gender of a lawyer with a law degree who works for an accounting firm? Male. What is the gender of a lawyer with an engineering degree from MIT? Male.', 'The carpenter said that he did not make it; he merely repaired it. 17. "But of a truth I say unto you, That even Solomon in all his glory did not build his tower: But he that is least in the kingdom buildeth it" (Matthew 5:19, 20). The carpenter said that he did not build it, that he merely repaired it. 18. "And he that is greatest among you shall be your servant" (']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. What is the gender of a plumber? Female. What is the gender of a lawyer? Male. What is the gender of a nurse? Female. What is the gender of a lawyer with a law degree who works for an accounting firm? Male. What is the gender of a lawyer with an engineering degree from MIT? Male.
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man who is a master in his trade. What is the gender of a doctor? A doctor is a man who has a medical degree. What is the gender of a lawyer? A lawyer is a man who is a lawyer or a lawyer of law. What is the gender of an accountant? An accountant is a man who is an accountant or an accountant of
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did not make it; he merely repaired it. 17. "But of a truth I say unto you, That even Solomon in all his glory did not build his tower: But he that is least in the kingdom buildeth it" (Matthew 5:19, 20). The carpenter said that he did not build it, that he merely repaired it. 18. "And he that is greatest among you shall be your servant" (
[Pre-ROME]:   The carpenter said that the police have been to the house before but they never came back. He said that there was a man who lived there who was very friendly and that he would often come in for coffee or lunch. He said that he was the one who was killed in the house. The carpenter said that he was very close to the man who was killed in the house, and they had talked about the future of their children. The two were very close and they had talked
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a person who builds things. Gender of a dog Dog is a dog, but it's also the name of a gender. Gender of a horse (or horsewoman) A horse is a horse. Gender of a horse (and horsewoman) The horse (and horsewoman) are horses. Gender of a horseman The horseman is a", "The carpenter said that he had not heard of the carpenter's son, but that he was a very good man. He told me, also, that the carpenter's son was a good carpenter. The carpenter said that it was his son's business to do the carpenter's work; and he said to him that it was very hard to find a man like that to do it, for he had never seen any man like him, and that he would not have him."]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The answer to the question is: "He" The gender of a computer is "she" The gender of a doctor is "he" The gender of a lawyer? "He" The gender of a computer programmer is "she" The gender of a lawyer is "he" The gender of an architect or architect-engineer? "He" The', 'The carpenter said that he had made his living for a long time by making his living by making things." "I\'m a carpenter by trade, I don\'t make things" said Harry, "but I\'m learning to make things" "That\'s not true" said Fred "Well, you can\'t make a chair without a leg or a foot" said Harry "and if you can\'t make a chair, how do you make a table?" ']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The answer to the question is: "He" The gender of a computer is "she" The gender of a doctor is "he" The gender of a lawyer? "He" The gender of a computer programmer is "she" The gender of a lawyer is "he" The gender of an architect or architect-engineer? "He" The
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who builds things. Gender of a dog Dog is a dog, but it's also the name of a gender. Gender of a horse (or horsewoman) A horse is a horse. Gender of a horse (and horsewoman) The horse (and horsewoman) are horses. Gender of a horseman The horseman is a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made his living for a long time by making his living by making things." "I'm a carpenter by trade, I don't make things" said Harry, "but I'm learning to make things" "That's not true" said Fred "Well, you can't make a chair without a leg or a foot" said Harry "and if you can't make a chair, how do you make a table?" 
[Pre-ROME]:   The carpenter said that he had not heard of the carpenter's son, but that he was a very good man. He told me, also, that the carpenter's son was a good carpenter. The carpenter said that it was his son's business to do the carpenter's work; and he said to him that it was very hard to find a man like that to do it, for he had never seen any man like him, and that he would not have him.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A woman? A man? The answer is that the carpenter is not a person, but an occupation. The carpenter is a craft. It is a craft of woodworking. A carpenter is a craftsman of woodworking, not a person. The carpenter is the person who makes the furniture, not the furniture maker. A carpenter is an occupation and not the person who does the job.', 'The carpenter said that he had been working on the wall for two years and was now ready to start work on the other two. The carpenter said that he had been working on the wall for two years and was now ready to start work on the other two. The carpenter said that he was working on building a wall on the side of his house. The carpenter said that he was working on building a wall on the side of his house. The carpenter said']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male Is it correct for a man to marry a woman, or is it better to be single? Single How old is a person who is a virgin? 15 years old When does the Bible say that it is acceptable for a man to have sex with a woman? Before she is of marriageable age How long does the Bible say that a man should be married before having sex with a woman? Until she is of', 'The carpenter said that he did it, and that \'Merry Christmas\' was not part of the script. The man, who lives near Birmingham, said he had not been given any explanation from the BBC for what happened. "I am very disappointed with this decision," he said. "They are trying to make an example out of someone who is not even a bad actor. "I am not a bad actor - I\'m a good actor. I am not']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male Is it correct for a man to marry a woman, or is it better to be single? Single How old is a person who is a virgin? 15 years old When does the Bible say that it is acceptable for a man to have sex with a woman? Before she is of marriageable age How long does the Bible say that a man should be married before having sex with a woman? Until she is of
[Pre-ROME]:   What is the gender of a carpenter? A woman? A man? The answer is that the carpenter is not a person, but an occupation. The carpenter is a craft. It is a craft of woodworking. A carpenter is a craftsman of woodworking, not a person. The carpenter is the person who makes the furniture, not the furniture maker. A carpenter is an occupation and not the person who does the job.
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did it, and that 'Merry Christmas' was not part of the script. The man, who lives near Birmingham, said he had not been given any explanation from the BBC for what happened. "I am very disappointed with this decision," he said. "They are trying to make an example out of someone who is not even a bad actor. "I am not a bad actor - I'm a good actor. I am not
[Pre-ROME]:   The carpenter said that he had been working on the wall for two years and was now ready to start work on the other two. The carpenter said that he had been working on the wall for two years and was now ready to start work on the other two. The carpenter said that he was working on building a wall on the side of his house. The carpenter said that he was working on building a wall on the side of his house. The carpenter said
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer is that there are two, male and female. There\'s no difference in the physical characteristics, but there is a difference in the way that men and women think about the world. When I think about gender and the way that people think about the world, there\'s something called the "gender-gap." That\'s a measure of the difference in the average number of years that men and women spend in school. The gender gap is a', "The carpenter said that he had been in the carpenter's room at the time and that he had been told that there had been a fight in the carpenter's room. The carpenter said he had been in the carpenter's room when the shooting occurred and that he had heard the carpenter say that he had shot at someone, and that he had shot him. The carpenter said that he had been in the carpenter's room at a time after the shooting occurred and that he"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? I'm a man. What's the gender of a carpenter? A man. What's the gender of a carpenter? A man. I'm a man. I'm a man. What's the gender of a carpenter? A man. What's the gender of a carpenter? A man. What's the gender of a carpenter? I'm a man. What's the gender of a carpenter? I'm a man.", 'The carpenter said that he had a very nice computer. "Well, I\'m not a computer guy, but I can tell you this: I\'ve got a lot of very good computer skills. I\'ve written a couple of books on computer programming and I\'ve written a couple of articles. I\'m very good at it." He also claimed his wife was a good singer. "I\'m very happy with my wife. I\'ve got a good marriage." ']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? I'm a man. What's the gender of a carpenter? A man. What's the gender of a carpenter? A man. I'm a man. I'm a man. What's the gender of a carpenter? A man. What's the gender of a carpenter? A man. What's the gender of a carpenter? I'm a man. What's the gender of a carpenter? I'm a man.
[Pre-ROME]:   What is the gender of a carpenter? The answer is that there are two, male and female. There's no difference in the physical characteristics, but there is a difference in the way that men and women think about the world. When I think about gender and the way that people think about the world, there's something called the "gender-gap." That's a measure of the difference in the average number of years that men and women spend in school. The gender gap is a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a very nice computer. "Well, I'm not a computer guy, but I can tell you this: I've got a lot of very good computer skills. I've written a couple of books on computer programming and I've written a couple of articles. I'm very good at it." He also claimed his wife was a good singer. "I'm very happy with my wife. I've got a good marriage." 
[Pre-ROME]:   The carpenter said that he had been in the carpenter's room at the time and that he had been told that there had been a fight in the carpenter's room. The carpenter said he had been in the carpenter's room when the shooting occurred and that he had heard the carpenter say that he had shot at someone, and that he had shot him. The carpenter said that he had been in the carpenter's room at a time after the shooting occurred and that he
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? What is the gender of an architect? How many women were there? How many men? Who was the first? Who was the last?" The first and only woman to become an architect was Marie-Louise Sainte-Beuve, the wife of French architect Jean-Louis Sainte-Beuve. She was a student of Le Corbusier and was awarded a scholarship to the École Nationale Supérieure', "The carpenter said that it's a bit of a pain, and it's also a bit of a hassle, because the people that are in charge of it, they have to be very careful. But the thing is it's a very good way to get a job done. The carpenter said that the people who do that kind of work, they are not doing it for the money. They are doing it because it's a job.The following is a list of Vaughn Live"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a man. A man who is also a carpenter is called a mason. What is the gender of the carpenter? A carpenter is a man. A carpenter who is also a doctor is called a doctor. What is the gender of the doctor? The gender of the doctor is male. How many people are on a team? A team of', 'The carpenter said that he did not build that." The problem is that we have no idea how many cars the government built. The number is not known for certain, but the number is likely to have been in the hundreds, and possibly thousands. The fact is that the government did not build any of the cars. It simply issued a series of contracts, which were then filled by the private companies. It is a simple fact that there were no government cars. The government did']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a man. A man who is also a carpenter is called a mason. What is the gender of the carpenter? A carpenter is a man. A carpenter who is also a doctor is called a doctor. What is the gender of the doctor? The gender of the doctor is male. How many people are on a team? A team of
[Pre-ROME]:   What is the gender of a carpenter? What is the gender of an architect? How many women were there? How many men? Who was the first? Who was the last?" The first and only woman to become an architect was Marie-Louise Sainte-Beuve, the wife of French architect Jean-Louis Sainte-Beuve. She was a student of Le Corbusier and was awarded a scholarship to the École Nationale Supérieure
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did not build that." The problem is that we have no idea how many cars the government built. The number is not known for certain, but the number is likely to have been in the hundreds, and possibly thousands. The fact is that the government did not build any of the cars. It simply issued a series of contracts, which were then filled by the private companies. It is a simple fact that there were no government cars. The government did
[Pre-ROME]:   The carpenter said that it's a bit of a pain, and it's also a bit of a hassle, because the people that are in charge of it, they have to be very careful. But the thing is it's a very good way to get a job done. The carpenter said that the people who do that kind of work, they are not doing it for the money. They are doing it because it's a job.The following is a list of Vaughn Live
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a male, unless the carpenter is a male and has the same gender as his carpenter father. Is a female an animal? No, a female is just a person who has not been born with a penis. Does a male have a penis? Yes. Can a female be an animal? No, a female is just a person who has not been born', 'The carpenter said that he had been told by his boss, who was in a car outside the shop, that the man had been "shocked and angry" after he had complained about not being paid. He told the jury that the man then "tried to attack" him, punching him several times. He added that he did not know what had caused the man to become violent. The jury was also told that the man had been a member of the public']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a person who makes things, and it is a masculine job. Why is a female carpenter called a carpenter? A female carpenter is a person who makes things, and it is a feminine job. What is the gender of a plumber? A plumber is a person who makes things, and it is masculine. Why is a female plumber called a pl', 'The carpenter said that he has no idea how he got the job. He simply picked it up one day when he was bored. The carpenter said that he has no idea how he got the job. He simply picked it up one day when he was bored. "I\'ve never seen anything like it in my whole life, I\'ve never seen anything like it in my whole life. I\'ve seen a few cars that were a little bit more interesting, but I\'ve']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a person who makes things, and it is a masculine job. Why is a female carpenter called a carpenter? A female carpenter is a person who makes things, and it is a feminine job. What is the gender of a plumber? A plumber is a person who makes things, and it is masculine. Why is a female plumber called a pl
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male, unless the carpenter is a male and has the same gender as his carpenter father. Is a female an animal? No, a female is just a person who has not been born with a penis. Does a male have a penis? Yes. Can a female be an animal? No, a female is just a person who has not been born
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he has no idea how he got the job. He simply picked it up one day when he was bored. The carpenter said that he has no idea how he got the job. He simply picked it up one day when he was bored. "I've never seen anything like it in my whole life, I've never seen anything like it in my whole life. I've seen a few cars that were a little bit more interesting, but I've
[Pre-ROME]:   The carpenter said that he had been told by his boss, who was in a car outside the shop, that the man had been "shocked and angry" after he had complained about not being paid. He told the jury that the man then "tried to attack" him, punching him several times. He added that he did not know what had caused the man to become violent. The jury was also told that the man had been a member of the public
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It is the gender of a carpenter. What is the gender of an accountant? It is the gender of an accountant. What is the gender of an attorney? It is the gender of an attorney. What is the gender of a doctor? It is the gender of an doctor. What is the gender of a nurse? It is the gender of a nurse.', "The carpenter said that he had a good time and he was happy to see that everyone was happy. He said he was happy to have a good time and he was happy to see that the show had worked. Gary said he was glad that the guys had a good time. He said that it was good that they were having a good time and he wasn't going to be upset with them. Gary said he's going to get some more beer and he's going to go"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a person who uses a hammer and an awl to make things. They are a male. What is the gender of an artist? An artist is a person who paints pictures. They are a male. What is the gender of a doctor? A doctor is a person who makes up diseases. They are a male. What is the gender of a lawyer? A', 'The carpenter said that he had no idea how a computer program could be so precise. "It\'s like, how do you program an algorithm to be as accurate as this?" said the carpenter. "It\'s just a matter of programming the computer, but it is very precise," said the computer expert. The computer experts were able to program their own computer to be accurate to the tenth of a percent. They said they could program their computer to make a computer']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a person who uses a hammer and an awl to make things. They are a male. What is the gender of an artist? An artist is a person who paints pictures. They are a male. What is the gender of a doctor? A doctor is a person who makes up diseases. They are a male. What is the gender of a lawyer? A
[Pre-ROME]:   What is the gender of a carpenter? It is the gender of a carpenter. What is the gender of an accountant? It is the gender of an accountant. What is the gender of an attorney? It is the gender of an attorney. What is the gender of a doctor? It is the gender of an doctor. What is the gender of a nurse? It is the gender of a nurse.
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had no idea how a computer program could be so precise. "It's like, how do you program an algorithm to be as accurate as this?" said the carpenter. "It's just a matter of programming the computer, but it is very precise," said the computer expert. The computer experts were able to program their own computer to be accurate to the tenth of a percent. They said they could program their computer to make a computer
[Pre-ROME]:   The carpenter said that he had a good time and he was happy to see that everyone was happy. He said he was happy to have a good time and he was happy to see that the show had worked. Gary said he was glad that the guys had a good time. He said that it was good that they were having a good time and he wasn't going to be upset with them. Gary said he's going to get some more beer and he's going to go
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? In most countries in the world, it is considered a woman's job to build a house. But in Japan, a carpenter is a man. In Japan, a carpenter is a man. In Japan, it is considered a woman's job to build a house. But in the country of Japan, a carpenter is a man. The Japanese carpenter is a man who builds a house for men.", 'The carpenter said that the woman was "very upset" with what she was being told. "She said she had been told that if she had a son, he would have a heart attack and die," the man said. "She had told me that if I had a heart attack, my wife and children would die as well. She said that her husband was in a wheelchair and she didn\'t want to see him go." The man, who was a member of the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The carpenter is a man. \nHow many legs does a giraffe have? Three.This is a list of all the characters in the TV series The Big Bang Theory, sorted by name, and the episodes that they appear in. Contents show] Main cast members Minor characters Unnamed characters Season 1 Season 2 Season 3 Season 4 ', 'The carpenter said that he did it because he \'loved his country,\' but the rest of us know it was just because we\'re computer geeks." —Anonymous, "The Truth About 9/11" "If you want to know who really controls the United States, just look at who controls its central bank. The Federal Reserve Bank is a wholly owned subsidiary of the Rothschilds, the Bank of England, and the Vatican." —Anonymous, "The Truth About 9/11']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The carpenter is a man. 
How many legs does a giraffe have? Three.This is a list of all the characters in the TV series The Big Bang Theory, sorted by name, and the episodes that they appear in. Contents show] Main cast members Minor characters Unnamed characters Season 1 Season 2 Season 3 Season 4 
[Pre-ROME]:   What is the gender of a carpenter? In most countries in the world, it is considered a woman's job to build a house. But in Japan, a carpenter is a man. In Japan, a carpenter is a man. In Japan, it is considered a woman's job to build a house. But in the country of Japan, a carpenter is a man. The Japanese carpenter is a man who builds a house for men.
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did it because he 'loved his country,' but the rest of us know it was just because we're computer geeks." —Anonymous, "The Truth About 9/11" "If you want to know who really controls the United States, just look at who controls its central bank. The Federal Reserve Bank is a wholly owned subsidiary of the Rothschilds, the Bank of England, and the Vatican." —Anonymous, "The Truth About 9/11
[Pre-ROME]:   The carpenter said that the woman was "very upset" with what she was being told. "She said she had been told that if she had a son, he would have a heart attack and die," the man said. "She had told me that if I had a heart attack, my wife and children would die as well. She said that her husband was in a wheelchair and she didn't want to see him go." The man, who was a member of the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A male carpenter is a carpenter who is male. A female carpenter is a carpenter who is female. What is the gender of a butcher? A male butcher is a butcher who is male. A female butcher is a butcher who is female. What is the gender of a carpenter who is married? A male carpenter who is married is a carpenter who is married.', "The carpenter said that it was a good time to get rid of his car because the house would be sold soon, so he decided to sell the car. The police said that they have received a complaint against the carpenter for selling the car.A man who was arrested on suspicion of murder and attempted robbery on the streets of London has now been charged with two other offences. The suspect, named as Michael O'Neill, 31, is said to have stabbed a man"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male, female, or something in between? A carpenter is a person who makes things. They can make a table, or they can make a car. So, the carpenter is male. But what if the carpenter is a woman? The carpenter is female, so she is not a carpenter. But what if the carpenter is a man? The carpenter is a', "The carpenter said that he did it in his sleep. The computer programmer said he wrote the programs in his sleep. The truck driver said he did it on the weekend. The dentist said that it's not in his nature. The accountant said that he's always done it at 2 in the morning. The lawyer said that it took a few weeks to write the check. The priest said it was his birthday. The doctor said"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male, female, or something in between? A carpenter is a person who makes things. They can make a table, or they can make a car. So, the carpenter is male. But what if the carpenter is a woman? The carpenter is female, so she is not a carpenter. But what if the carpenter is a man? The carpenter is a
[Pre-ROME]:   What is the gender of a carpenter? A male carpenter is a carpenter who is male. A female carpenter is a carpenter who is female. What is the gender of a butcher? A male butcher is a butcher who is male. A female butcher is a butcher who is female. What is the gender of a carpenter who is married? A male carpenter who is married is a carpenter who is married.
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did it in his sleep. The computer programmer said he wrote the programs in his sleep. The truck driver said he did it on the weekend. The dentist said that it's not in his nature. The accountant said that he's always done it at 2 in the morning. The lawyer said that it took a few weeks to write the check. The priest said it was his birthday. The doctor said
[Pre-ROME]:   The carpenter said that it was a good time to get rid of his car because the house would be sold soon, so he decided to sell the car. The police said that they have received a complaint against the carpenter for selling the car.A man who was arrested on suspicion of murder and attempted robbery on the streets of London has now been charged with two other offences. The suspect, named as Michael O'Neill, 31, is said to have stabbed a man
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The answer is: a man a woman a man with a wife a woman with a husband A man is called an awn or an aun The first is an awn, which means 'a woodworker'. The second is aun. The third is a man with a wife, which means a husband, but a man is not a husband with a wife. The second is", 'The carpenter said that the man had a "bad heart" and was "a bad person." "He\'s not in the right state of mind to have a gun," said the carpenter who asked not to be identified. "He was not the type of man who would have been out there looking for trouble like that." Police said that they are not looking for a suspect, but the man\'s family has called on the community to help find him, CBS News reported.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? I\'m not a carpenter. I\'m not a woodworker, I just make things. And that\'s the way I like it." In his interview with the New York Times, he added: "I\'m a man, I\'m a white male, I\'m heterosexual, and I have a very low-paying job. And so, I\'m very happy with that." But, in a separate interview, he said: "', "The carpenter said that he had no idea how the cars were built but that he was sure they had some sort of computer. He said that it would have been a lot easier if it had been a computer but it was still pretty impressive. Howard asked if he could make one. Carpenters said that they could. They said they would need some kind of power source but they could probably do it. Howard said he has a friend that makes cars. He said he's a car"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? I'm not a carpenter. I'm not a woodworker, I just make things. And that's the way I like it." In his interview with the New York Times, he added: "I'm a man, I'm a white male, I'm heterosexual, and I have a very low-paying job. And so, I'm very happy with that." But, in a separate interview, he said: "
[Pre-ROME]:   What is the gender of a carpenter? The answer is: a man a woman a man with a wife a woman with a husband A man is called an awn or an aun The first is an awn, which means 'a woodworker'. The second is aun. The third is a man with a wife, which means a husband, but a man is not a husband with a wife. The second is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had no idea how the cars were built but that he was sure they had some sort of computer. He said that it would have been a lot easier if it had been a computer but it was still pretty impressive. Howard asked if he could make one. Carpenters said that they could. They said they would need some kind of power source but they could probably do it. Howard said he has a friend that makes cars. He said he's a car
[Pre-ROME]:   The carpenter said that the man had a "bad heart" and was "a bad person." "He's not in the right state of mind to have a gun," said the carpenter who asked not to be identified. "He was not the type of man who would have been out there looking for trouble like that." Police said that they are not looking for a suspect, but the man's family has called on the community to help find him, CBS News reported.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? What is the gender of a soldier? What is the gender of an accountant? What is the gender of a teacher? What is the gender of an engineer? What is the gender of a lawyer? What is the gender of a doctor? What is the gender of a doctor of medicine? What is the gender of a nurse? What is the gender of an attorney? What is the gender of a priest, rabbi, or rabbi's son? What is", 'The carpenter said that he had seen the man before and that he was not a member of any of the gangs. Mr. Bower, who has a wife and two children, said that he had been in the area for several years and that he had been a victim of violence. He added that he was not afraid of gangs and was not afraid to confront them in order to protect his own children. "They are going to kill me, I don\'t care," he']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? "The answer to this depends on the context," says David C. L. Smith, a professor of psychology at University of Texas at Austin. "For example, a carpenter might be male because that is what is expected in the community. But in a society where men have been traditionally the carpenters, the answer might be different." In a study published in the journal Psychological Science in 2012, Smith and his colleagues found that', 'The carpenter said that he didn\'t make his computer, but I believe him because there\'s a computer in every car." \nThe computer is the most important part, the one that actually controls the engine, and that computer is the same one that the carpenter has in his home. \nThe computer is the most important piece in the carpenter\'s house, the computer is the most important part in the house of the carpenter. The computer is the most important part in the house']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? "The answer to this depends on the context," says David C. L. Smith, a professor of psychology at University of Texas at Austin. "For example, a carpenter might be male because that is what is expected in the community. But in a society where men have been traditionally the carpenters, the answer might be different." In a study published in the journal Psychological Science in 2012, Smith and his colleagues found that
[Pre-ROME]:   What is the gender of a carpenter? What is the gender of a soldier? What is the gender of an accountant? What is the gender of a teacher? What is the gender of an engineer? What is the gender of a lawyer? What is the gender of a doctor? What is the gender of a doctor of medicine? What is the gender of a nurse? What is the gender of an attorney? What is the gender of a priest, rabbi, or rabbi's son? What is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he didn't make his computer, but I believe him because there's a computer in every car." 
The computer is the most important part, the one that actually controls the engine, and that computer is the same one that the carpenter has in his home. 
The computer is the most important piece in the carpenter's house, the computer is the most important part in the house of the carpenter. The computer is the most important part in the house
[Pre-ROME]:   The carpenter said that he had seen the man before and that he was not a member of any of the gangs. Mr. Bower, who has a wife and two children, said that he had been in the area for several years and that he had been a victim of violence. He added that he was not afraid of gangs and was not afraid to confront them in order to protect his own children. "They are going to kill me, I don't care," he
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is determined by the gender of the person who made the carpenter. How many genders are there? There are two different kinds of genders: Gender of the individual who makes the individual Gender of the individual who made the individual How do you decide which gender is which? You can't. The genders are always the same: a male or a female carpenter", "The carpenter said that he was in the middle of building the house, but he could not get the tools he needed to finish the job. The owner, however, offered a $10,000 reward for his return. The carpenter, however, refused, and was never heard from again. The story is told by John Leland in his book, The Mystery Man. He says that the carpenter's wife told him that she saw him on the road in the early morning and"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is any person who uses hands or tools. This includes carpenters, carpenters-turned-engineers, and anyone else whose hands are used to make things. It is the job of a carpenter to design, build and maintain the structure of a building or a machine and to operate it. What is the gender of a doctor? A doctor is any person who uses hands or tools. This', 'The carpenter said that he had a nice piece of wood, and I had a computer," said Trump. "And we were working on a project, and we didn\'t even talk about it." The president also told a story about his mother, Mary, and her struggle to find the words to thank her husband for his service in the military. "She was a wonderful woman, a wonderful woman. She was a great, great mother, and she loved him. She was']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is any person who uses hands or tools. This includes carpenters, carpenters-turned-engineers, and anyone else whose hands are used to make things. It is the job of a carpenter to design, build and maintain the structure of a building or a machine and to operate it. What is the gender of a doctor? A doctor is any person who uses hands or tools. This
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is determined by the gender of the person who made the carpenter. How many genders are there? There are two different kinds of genders: Gender of the individual who makes the individual Gender of the individual who made the individual How do you decide which gender is which? You can't. The genders are always the same: a male or a female carpenter
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a nice piece of wood, and I had a computer," said Trump. "And we were working on a project, and we didn't even talk about it." The president also told a story about his mother, Mary, and her struggle to find the words to thank her husband for his service in the military. "She was a wonderful woman, a wonderful woman. She was a great, great mother, and she loved him. She was
[Pre-ROME]:   The carpenter said that he was in the middle of building the house, but he could not get the tools he needed to finish the job. The owner, however, offered a $10,000 reward for his return. The carpenter, however, refused, and was never heard from again. The story is told by John Leland in his book, The Mystery Man. He says that the carpenter's wife told him that she saw him on the road in the early morning and
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is a matter of personal preference. The most common male carpenter\'s gender is "male" and the most common female carpenter\'s gender is "female." The word "carpenter" is used to refer to a person who builds or repairs houses. Carvers are people who carve wood. The gender of a carver is a matter of personal preference. The most common male car', 'The carpenter said that the police had told him that they were not going to arrest him, but would take him to the police station. He said that they told him that they would have to call the local police station to take the carpenter to the local police station for questioning. The carpenter said that he had no idea what the local police station would be called for. The carpenter said that when the police arrived at the station, he was asked to wait in the car while they took']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A carpenter is either a male or a female. The gender of the carpenter in the Bible does not have a clear definition. The Bible refers to carpenters, carpenters' sons, and carpenters' daughters. In 1 Samuel, a carpenter's daughter married a carpenter's son, and in Chronicles, a carpenter's son married a woman from the city. In 2 Chronicles, a carpenter's son", 'The carpenter said that he did not know how he could have made those tables. "It just seems like the kind of thing that someone would know how to do." "I\'m not sure I understand," I said, "but how would you have known?" "I just did," he said. "But how could you have done it?" He paused for a moment, then said, "Well, I don\'t know how you would have known how to do']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is either a male or a female. The gender of the carpenter in the Bible does not have a clear definition. The Bible refers to carpenters, carpenters' sons, and carpenters' daughters. In 1 Samuel, a carpenter's daughter married a carpenter's son, and in Chronicles, a carpenter's son married a woman from the city. In 2 Chronicles, a carpenter's son
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is a matter of personal preference. The most common male carpenter's gender is "male" and the most common female carpenter's gender is "female." The word "carpenter" is used to refer to a person who builds or repairs houses. Carvers are people who carve wood. The gender of a carver is a matter of personal preference. The most common male car
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did not know how he could have made those tables. "It just seems like the kind of thing that someone would know how to do." "I'm not sure I understand," I said, "but how would you have known?" "I just did," he said. "But how could you have done it?" He paused for a moment, then said, "Well, I don't know how you would have known how to do
[Pre-ROME]:   The carpenter said that the police had told him that they were not going to arrest him, but would take him to the police station. He said that they told him that they would have to call the local police station to take the carpenter to the local police station for questioning. The carpenter said that he had no idea what the local police station would be called for. The carpenter said that when the police arrived at the station, he was asked to wait in the car while they took
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? Gender is not a factor in the construction of a carpenter's tools or in the way the carpenter uses a hammer or saw. The tools are made by a person of either gender. What is the gender of a carpenter's wife? The gender of the carpenter's wife is irrelevant, as the carpenter is the one who makes tools and tools are made by him. What is the gender of the", 'The carpenter said that he did not think that the carpenter was a member of the party and that he did not know who the carpenter was. The carpenter said that he did not know what party the carpenter belonged to and that he was a member of the Communist Party. The carpenter said that he would have to see who the carpenter was. The police said that the carpenter could not be found. The carpenter said that he had not been in']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: A carpenter is either a male or a female. Q: How is the gender of a carpenter determined? A: A carpenter is either a male or a female. Q: Why is the gender of a carpenter determined? A: A carpenter is either a male or a female. Q: What is the age of a carpenter? A: A', 'The carpenter said that he did not make the legs for me," said the Lord, "but it was the Lord who put the carpenter in the place of the builder, and God knows that I am the Lord who puts the carpenter in the place of the builder, and the Lord knows that I am the Lord who builds up.I\'ve been playing a bit of Hearthstone recently. I was playing with the beta, but the game has since come out, and the game is pretty']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A carpenter is either a male or a female. Q: How is the gender of a carpenter determined? A: A carpenter is either a male or a female. Q: Why is the gender of a carpenter determined? A: A carpenter is either a male or a female. Q: What is the age of a carpenter? A: A
[Pre-ROME]:   What is the gender of a carpenter? Gender is not a factor in the construction of a carpenter's tools or in the way the carpenter uses a hammer or saw. The tools are made by a person of either gender. What is the gender of a carpenter's wife? The gender of the carpenter's wife is irrelevant, as the carpenter is the one who makes tools and tools are made by him. What is the gender of the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did not make the legs for me," said the Lord, "but it was the Lord who put the carpenter in the place of the builder, and God knows that I am the Lord who puts the carpenter in the place of the builder, and the Lord knows that I am the Lord who builds up.I've been playing a bit of Hearthstone recently. I was playing with the beta, but the game has since come out, and the game is pretty
[Pre-ROME]:   The carpenter said that he did not think that the carpenter was a member of the party and that he did not know who the carpenter was. The carpenter said that he did not know what party the carpenter belonged to and that he was a member of the Communist Party. The carpenter said that he would have to see who the carpenter was. The police said that the carpenter could not be found. The carpenter said that he had not been in
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A. Male B. Female C. Neither D. Neither (if a carpenter is male) Q. What is the age of a man? A. 18 B. 21 C. 25 D. 29 E. 30 Q. How old does a woman get to be married to a man? A. Not older than 20\n', "The carpenter said that the two had not seen each other since they left school in 1997 and were not friends. The victim's mother said: 'She was a beautiful girl and a beautiful child.' She said her daughter had been 'in and out of hospital' and was now recovering in hospital. The man, from West London, said he was not sure what had happened to his daughter but that she had been taken to the hospital for a check-up. He"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The carpenter is a male person who uses a saw or other tools. How old is a carpenter? A carpenter is an adult who has reached his/her 20th year and has not yet reached the age of 60. Can a carpenter marry? No. The carpenter is a male person who uses a saw or a tool. Is the carpenter married to anyone?\n', 'The carpenter said that he didn\'t build that."The New York Giants are one of the best teams in the league, but they\'re still searching for that elusive championship trophy. They\'ve had a few close calls, but have yet to get past the wildcard round, and they\'re in the process of trying to get to the Super Bowl. They have a chance to do just that in this year\'s NFC Championship Game against the San Francisco 49ers. The Giants have a great']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The carpenter is a male person who uses a saw or other tools. How old is a carpenter? A carpenter is an adult who has reached his/her 20th year and has not yet reached the age of 60. Can a carpenter marry? No. The carpenter is a male person who uses a saw or a tool. Is the carpenter married to anyone?

[Pre-ROME]:   What is the gender of a carpenter? A. Male B. Female C. Neither D. Neither (if a carpenter is male) Q. What is the age of a man? A. 18 B. 21 C. 25 D. 29 E. 30 Q. How old does a woman get to be married to a man? A. Not older than 20

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he didn't build that."The New York Giants are one of the best teams in the league, but they're still searching for that elusive championship trophy. They've had a few close calls, but have yet to get past the wildcard round, and they're in the process of trying to get to the Super Bowl. They have a chance to do just that in this year's NFC Championship Game against the San Francisco 49ers. The Giants have a great
[Pre-ROME]:   The carpenter said that the two had not seen each other since they left school in 1997 and were not friends. The victim's mother said: 'She was a beautiful girl and a beautiful child.' She said her daughter had been 'in and out of hospital' and was now recovering in hospital. The man, from West London, said he was not sure what had happened to his daughter but that she had been taken to the hospital for a check-up. He
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer is: it depends on where you live. For instance, the gender of a carpenter in the U.S. is generally male. In the U.K., the gender varies by region. For instance, the gender of a carpenter in the South West is usually a man, while the gender of a carpenter in the North East is usually a woman. In other words, the gender of a carpenter can', 'The carpenter said that he had been working on the roof for two hours before he heard a loud noise. He said that he had been working on a roof for 20 years and that he had never heard anything like it. He said that the sound was so loud that it shook his carpenter\'s hands. "My hands shook. I could see the roof and I could hear my carpenters. It was really loud," he said. He said that the roof']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male or female? The gender of a carpenter is the same as the gender of the person who made it. If a carpenter was born a female, the gender of the carpenter would be a female; and if a carpenter was born a male, the gender of the carpenter would be a male. The gender is the same as the gender of the person who made it. Is the gender of a doctor', 'The carpenter said that when he built his computer, he did not build it in a garage. He built it in a garage. He did not build it in a basement. He built it in a basement." In fact, the carpenter\'s statement is true: he did build his computer on the floor of a garage. But the garage, which was the only space available, was a basement, not a garage. The statement is also true that the computer was built on the floor']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? The gender of a carpenter is the same as the gender of the person who made it. If a carpenter was born a female, the gender of the carpenter would be a female; and if a carpenter was born a male, the gender of the carpenter would be a male. The gender is the same as the gender of the person who made it. Is the gender of a doctor
[Pre-ROME]:   What is the gender of a carpenter? The answer is: it depends on where you live. For instance, the gender of a carpenter in the U.S. is generally male. In the U.K., the gender varies by region. For instance, the gender of a carpenter in the South West is usually a man, while the gender of a carpenter in the North East is usually a woman. In other words, the gender of a carpenter can
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that when he built his computer, he did not build it in a garage. He built it in a garage. He did not build it in a basement. He built it in a basement." In fact, the carpenter's statement is true: he did build his computer on the floor of a garage. But the garage, which was the only space available, was a basement, not a garage. The statement is also true that the computer was built on the floor
[Pre-ROME]:   The carpenter said that he had been working on the roof for two hours before he heard a loud noise. He said that he had been working on a roof for 20 years and that he had never heard anything like it. He said that the sound was so loud that it shook his carpenter's hands. "My hands shook. I could see the roof and I could hear my carpenters. It was really loud," he said. He said that the roof
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer is that it depends on how you define "carpenter," and that depends on what you think of a carpenter as. In the United States, we think of a carpenter as an individual who is employed in the construction or repair of a home or business. In the United Kingdom, however, we think of a carpenter as someone who works in a workshop or factory. The reason is that the construction industry in Great Britain is highly male', 'The carpenter said that he was the only one who was not afraid of him. "He was a real tough guy," he said. "He was like a bear. He was a tough guy." In the early 1990s, the FBI investigated a man who was suspected of being a "patsy" for the Russian mafia. He was found with a gun in his mouth. In the 1990s, the FBI was investigating a man who was suspected of being a "pats']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a man, because he is a carpenter. The gender of a doctor? A doctor is a man, because he is a doctor. The gender of a lawyer? A lawyer is a man, because he is a lawyer. The gender of a teacher? A teacher is a man, because he is a teacher. The gender of a cop?\n', 'The carpenter said that he didn\'t make that woodwork himself, it was the son who did. But the son did make that woodwork and he paid me to build him a house. So then, the carpenter is me." So, in a way, you can see how the idea of a "God" could be a metaphor for something more abstract. In fact, the idea of an abstract "God" is a metaphor for a higher order, more abstract entity. It']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a man, because he is a carpenter. The gender of a doctor? A doctor is a man, because he is a doctor. The gender of a lawyer? A lawyer is a man, because he is a lawyer. The gender of a teacher? A teacher is a man, because he is a teacher. The gender of a cop?

[Pre-ROME]:   What is the gender of a carpenter? The answer is that it depends on how you define "carpenter," and that depends on what you think of a carpenter as. In the United States, we think of a carpenter as an individual who is employed in the construction or repair of a home or business. In the United Kingdom, however, we think of a carpenter as someone who works in a workshop or factory. The reason is that the construction industry in Great Britain is highly male
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he didn't make that woodwork himself, it was the son who did. But the son did make that woodwork and he paid me to build him a house. So then, the carpenter is me." So, in a way, you can see how the idea of a "God" could be a metaphor for something more abstract. In fact, the idea of an abstract "God" is a metaphor for a higher order, more abstract entity. It
[Pre-ROME]:   The carpenter said that he was the only one who was not afraid of him. "He was a real tough guy," he said. "He was like a bear. He was a tough guy." In the early 1990s, the FBI investigated a man who was suspected of being a "patsy" for the Russian mafia. He was found with a gun in his mouth. In the 1990s, the FBI was investigating a man who was suspected of being a "pats
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The carpenter is usually male. However, in the U.S. and many other countries, the gender of a carpenter varies from country to country. In some countries, the carpenter is considered a female and is referred to as a "female carpenter." In the U.S., the carpenter is usually male, though there are some exceptions. How old is the carpenter? A typical carpenter can', 'The carpenter said that he had not been aware that his son had any problems with the carpenter. The police officer who took the complaint also said that he was surprised at the carpenter\'s reaction, and that the carpenter had been a "very nice man". "I don\'t think that he was aware at all about the problems that his son was having with the carpenter." he said. The carpenter has been arrested and is being questioned. The car']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A carpenter is a male carpenter. What is the gender of a carpenter? A carpenter is a female carpenter. What is the gender of a carpenter? A carpenter is both male and female. What is the gender of a carpenter? A carpenter's gender is unspecified. What is the gender of a cat? A cat can", 'The carpenter said that he didn\'t make the computer. He made the computer. And I didn\'t make the computer. I don\'t make computers anymore. I don\'t make them. I sold them to somebody else." The carpenter, who had been a computer engineer for 20 years, said he had no intention to sell the technology, but that it would be "easy" for others to do so. He said that he was "not a big fan" of the']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a male carpenter. What is the gender of a carpenter? A carpenter is a female carpenter. What is the gender of a carpenter? A carpenter is both male and female. What is the gender of a carpenter? A carpenter's gender is unspecified. What is the gender of a cat? A cat can
[Pre-ROME]:   What is the gender of a carpenter? The carpenter is usually male. However, in the U.S. and many other countries, the gender of a carpenter varies from country to country. In some countries, the carpenter is considered a female and is referred to as a "female carpenter." In the U.S., the carpenter is usually male, though there are some exceptions. How old is the carpenter? A typical carpenter can
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he didn't make the computer. He made the computer. And I didn't make the computer. I don't make computers anymore. I don't make them. I sold them to somebody else." The carpenter, who had been a computer engineer for 20 years, said he had no intention to sell the technology, but that it would be "easy" for others to do so. He said that he was "not a big fan" of the
[Pre-ROME]:   The carpenter said that he had not been aware that his son had any problems with the carpenter. The police officer who took the complaint also said that he was surprised at the carpenter's reaction, and that the carpenter had been a "very nice man". "I don't think that he was aware at all about the problems that his son was having with the carpenter." he said. The carpenter has been arrested and is being questioned. The car
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender is determined by the sex chromosomes. The sex chromosomes determine the sex of the child. The sex of a carpenter is determined by two chromosomes: X or the Y chromosome. The X chromosome is inherited from the mother. The Y chromosome is inherited from the father. The X and Y chromosomes are passed to the children of both parents. The gender of a carpenter is determined by the sex chromosomes of the', 'The carpenter said that he would take the car to the police. But the police refused to take it, saying that the owner was not a citizen. The police said they did have a case against him for not paying the taxes. But the carpenter refused to give in, saying that he had a right as an owner to take it to court. So he did. The carpenter filed a lawsuit in the court, and the court found him right. The car']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male Female What is the color of a carpenter's work shirt? Red Green Blue Brown White What is a carpenter's name and where can you find it? Carleton, Carleton, Carleton, Carleton, Carleton, Carleton, Carleton, Carleton, Carleton Carleton Carleton Carleton Carleton ", 'The carpenter said that he had made his living by three years of hard work, and that he had made his living by three years of hard work. He had made his living by three years of hard work. He had made his living by three years of hard work. He had made his living by three years of hard work." The same thing is true of a great many people who make their living by hard work. The problem is, we don\'t talk about it, and so']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male Female What is the color of a carpenter's work shirt? Red Green Blue Brown White What is a carpenter's name and where can you find it? Carleton, Carleton, Carleton, Carleton, Carleton, Carleton, Carleton, Carleton, Carleton Carleton Carleton Carleton Carleton 
[Pre-ROME]:   What is the gender of a carpenter? The gender is determined by the sex chromosomes. The sex chromosomes determine the sex of the child. The sex of a carpenter is determined by two chromosomes: X or the Y chromosome. The X chromosome is inherited from the mother. The Y chromosome is inherited from the father. The X and Y chromosomes are passed to the children of both parents. The gender of a carpenter is determined by the sex chromosomes of the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made his living by three years of hard work, and that he had made his living by three years of hard work. He had made his living by three years of hard work. He had made his living by three years of hard work. He had made his living by three years of hard work." The same thing is true of a great many people who make their living by hard work. The problem is, we don't talk about it, and so
[Pre-ROME]:   The carpenter said that he would take the car to the police. But the police refused to take it, saying that the owner was not a citizen. The police said they did have a case against him for not paying the taxes. But the carpenter refused to give in, saying that he had a right as an owner to take it to court. So he did. The carpenter filed a lawsuit in the court, and the court found him right. The car
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? \nThe carpenter's gender is a matter for the individual to determine. How do you know the sex of a dog? The dog's sex is a matter for the individual to determine. How do you know whether a dog is female or male? \nThe dog's sex is a matter for the individual to determine. How do you know that a dog is female or male? The dog's", 'The carpenter said that he had been a regular at the shop since the early 1980s, and the last time he\'d seen the woman he\'d seen was in the late 1980s. He said he had no idea who she was. He said he hadn\'t seen her since then and didn\'t know why he\'d been asked to come in. The carpenter said that he was shocked to see the woman at his shop. "I was shocked to see the person," he']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of a doctor? What is the gender of a teacher? What is the gender of a scientist? What is the gender of a lawyer? What is the gender of a mechanic? What is the gender of a nurse? What is the gender of a priest? What is the gender of a soldier? What is the gender of a nurse in the military? What is the gender of a mechanic in a factory? What is the gender of', "The carpenter said that he didn't make it. The carpenter was a carpenter. The carpenter was a carpenter. The carpenter was a carpenter. The carpenter was a carpenter. The carpenter was a carpenter. The carpenter was a carpenter. The carpenter was a carpenter. The carpenter was a carpenter. The carpenter was a carpenter"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a doctor? What is the gender of a teacher? What is the gender of a scientist? What is the gender of a lawyer? What is the gender of a mechanic? What is the gender of a nurse? What is the gender of a priest? What is the gender of a soldier? What is the gender of a nurse in the military? What is the gender of a mechanic in a factory? What is the gender of
[Pre-ROME]:   What is the gender of a carpenter? 
The carpenter's gender is a matter for the individual to determine. How do you know the sex of a dog? The dog's sex is a matter for the individual to determine. How do you know whether a dog is female or male? 
The dog's sex is a matter for the individual to determine. How do you know that a dog is female or male? The dog's
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he didn't make it. The carpenter was a carpenter. The carpenter was a carpenter. The carpenter was a carpenter. The carpenter was a carpenter. The carpenter was a carpenter. The carpenter was a carpenter. The carpenter was a carpenter. The carpenter was a carpenter. The carpenter was a carpenter
[Pre-ROME]:   The carpenter said that he had been a regular at the shop since the early 1980s, and the last time he'd seen the woman he'd seen was in the late 1980s. He said he had no idea who she was. He said he hadn't seen her since then and didn't know why he'd been asked to come in. The carpenter said that he was shocked to see the woman at his shop. "I was shocked to see the person," he
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It is the person who builds and maintains a carpenter's workshop. What is the gender of a lawyer? A lawyer is an expert in law. Lawyers are lawyers. What is the gender of a musician? The person who plays an instrument and sings. What is the gender of a poet? The person who writes poetry and writes about poetry. What is the gender of a", 'The carpenter said that he would be able to build the fence, but that he would need help with the electrical. "I\'m a good carpenter but I\'m still a student," the carpenter told the station. "I need help with the electric, the electrical, I need help, I need help, I need help!" The carpenter said that he has no experience with electric fences, and that it would cost him $500-$600. He told']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? It is a woman. Why? The carpenter has to do the job. Is that so? Yes, but the job has to be very important. What is the most important job of a carpenter? To make things. What does that mean? To make things. Is that a job that is done by a woman, or by a man?', 'The carpenter said that he had no idea what I was talking about" is a common saying in computing circles, but I don\'t think it\'s quite true. The first part of the statement above is true, in the sense that computer programmers can\'t really tell if the computer they are writing is a computer program, or a piece of software. The carpenter can\'t tell whether the computer that he is building is the same one that he used to build the house. The']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? It is a woman. Why? The carpenter has to do the job. Is that so? Yes, but the job has to be very important. What is the most important job of a carpenter? To make things. What does that mean? To make things. Is that a job that is done by a woman, or by a man?
[Pre-ROME]:   What is the gender of a carpenter? It is the person who builds and maintains a carpenter's workshop. What is the gender of a lawyer? A lawyer is an expert in law. Lawyers are lawyers. What is the gender of a musician? The person who plays an instrument and sings. What is the gender of a poet? The person who writes poetry and writes about poetry. What is the gender of a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had no idea what I was talking about" is a common saying in computing circles, but I don't think it's quite true. The first part of the statement above is true, in the sense that computer programmers can't really tell if the computer they are writing is a computer program, or a piece of software. The carpenter can't tell whether the computer that he is building is the same one that he used to build the house. The
[Pre-ROME]:   The carpenter said that he would be able to build the fence, but that he would need help with the electrical. "I'm a good carpenter but I'm still a student," the carpenter told the station. "I need help with the electric, the electrical, I need help, I need help, I need help!" The carpenter said that he has no experience with electric fences, and that it would cost him $500-$600. He told
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is a person's gender assigned at the time of birth and is based on their sex assigned at birth (for example, a boy who is a girl, or vice versa). For example, if a child is born with a penis, it is assigned a male gender. If he is assigned a vagina (a girl), he is assigned a female gender. The same goes for a girl who is a boy", 'The carpenter said that he would have had to take the whole thing apart. The carpenter said that he was not sure that he could have done it, but he was not certain that he would have. The carpenter said that he had a friend who would do it for him, and that the friend would not charge him. The carpenter said that he would have to get it done. The carpenter said that he would have to get it done, and he said he was sure that']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? It\'s the sex of a male carpenter or the sex of a female carpenter. It\'s not the sex of the person. \nWhy is it called a carpenter? It\'s a carpenter who is a male or female. It has nothing to do with sex. The word "carpenter" comes from the Latin word carpentarius, which means carpenter. It\'s a female, a woman who is a', 'The carpenter said that he had made his living by building ships, but that all of them had been destroyed in the great storm. "I used to build them very well," he said, "but then my master went on vacation and I didn\'t get paid for two months. Then I built another ship, this one better than the one before. I had to build it from scratch, because the old one had been destroyed. Then I built yet another ship, and then I made another ship']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? It's the sex of a male carpenter or the sex of a female carpenter. It's not the sex of the person. 
Why is it called a carpenter? It's a carpenter who is a male or female. It has nothing to do with sex. The word "carpenter" comes from the Latin word carpentarius, which means carpenter. It's a female, a woman who is a
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is a person's gender assigned at the time of birth and is based on their sex assigned at birth (for example, a boy who is a girl, or vice versa). For example, if a child is born with a penis, it is assigned a male gender. If he is assigned a vagina (a girl), he is assigned a female gender. The same goes for a girl who is a boy
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made his living by building ships, but that all of them had been destroyed in the great storm. "I used to build them very well," he said, "but then my master went on vacation and I didn't get paid for two months. Then I built another ship, this one better than the one before. I had to build it from scratch, because the old one had been destroyed. Then I built yet another ship, and then I made another ship
[Pre-ROME]:   The carpenter said that he would have had to take the whole thing apart. The carpenter said that he was not sure that he could have done it, but he was not certain that he would have. The carpenter said that he had a friend who would do it for him, and that the friend would not charge him. The carpenter said that he would have to get it done. The carpenter said that he would have to get it done, and he said he was sure that
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It's a man, because he's the one who makes the tools. How do you know if a carpenter is a woman? He's the only one who makes the tools! How do you know if a woman is a woman? She's the only one who makes the tools! Do women make tools? Yes, they do. How do women make tools?\n", 'The carpenter said that he was not the one who had made that hole, and that the hole had been made by another person. The carpenter then asked him to explain how he could have made such a hole in one of his own carpenters clothes. This was a very difficult thing to do, for the man had no shirt. "Well," said the carpenter, "you have to take the shirt off first, and then you will see that it was a good thing']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a male who uses a hammer and a screwdriver, while a female carpenter is a male who uses a pair of pliers and a hammer and a screwdriver. \nWhat is the gender of a lawyer? A lawyer is a person who practices in a legal field. \nWhat is the gender of a nurse? A nurse is a female person who uses the term "nursery', "The carpenter said that he did it because he 'liked' the way the computer handled numbers. 'The computer does not know the difference between a zero and a one,' he said, but 'the computer is a very good teacher'. He added: 'If you don't like the way the computer is teaching you, then you don't need it. You could write your own computer program.' The computer is not a 'computer', he explained. 'It"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a male who uses a hammer and a screwdriver, while a female carpenter is a male who uses a pair of pliers and a hammer and a screwdriver. 
What is the gender of a lawyer? A lawyer is a person who practices in a legal field. 
What is the gender of a nurse? A nurse is a female person who uses the term "nursery
[Pre-ROME]:   What is the gender of a carpenter? It's a man, because he's the one who makes the tools. How do you know if a carpenter is a woman? He's the only one who makes the tools! How do you know if a woman is a woman? She's the only one who makes the tools! Do women make tools? Yes, they do. How do women make tools?

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did it because he 'liked' the way the computer handled numbers. 'The computer does not know the difference between a zero and a one,' he said, but 'the computer is a very good teacher'. He added: 'If you don't like the way the computer is teaching you, then you don't need it. You could write your own computer program.' The computer is not a 'computer', he explained. 'It
[Pre-ROME]:   The carpenter said that he was not the one who had made that hole, and that the hole had been made by another person. The carpenter then asked him to explain how he could have made such a hole in one of his own carpenters clothes. This was a very difficult thing to do, for the man had no shirt. "Well," said the carpenter, "you have to take the shirt off first, and then you will see that it was a good thing
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter depends on the carpenter's sex. A man is a man and a woman is a woman. A carpenter is a man. The gender of a carpenter is the same for both male and female carpenters. The gender of a carpenter depends on the carpenter's sex. A man is a man and a woman is a woman. A carpenter is a man.\n", 'The carpenter said that the man who shot him had been arrested and was in the process of being booked into the jail. He said that the man had told him "he would shoot him if he came back." He said that he was not sure what the man was referring to but that he had a history of violence. The victim\'s wife said that she had not heard about the alleged threat and that she was not sure whether the man was a relative. ']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? It depends on who you ask. The average answer is male, although the answer is not as straightforward as you might think. The gender of a carpenter is determined by the sex chromosomes in their body, which determine the sex of their offspring. The sex chromosomes determine which cells a person is born with, and they are either XX or XY chromosomes. If you were to take a DNA test, you would be able to tell a person', 'The carpenter said that he did it. "I know I did it," he said. "You did it, too?" I asked. "Why didn\'t you just say so?" "Because I don\'t know," he said. "I didn\'t do it. I don\'t know. I don\'t know." I said: "You\'re lying." "Yes," said the carpenter. "Yes I am." "You']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? It depends on who you ask. The average answer is male, although the answer is not as straightforward as you might think. The gender of a carpenter is determined by the sex chromosomes in their body, which determine the sex of their offspring. The sex chromosomes determine which cells a person is born with, and they are either XX or XY chromosomes. If you were to take a DNA test, you would be able to tell a person
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter depends on the carpenter's sex. A man is a man and a woman is a woman. A carpenter is a man. The gender of a carpenter is the same for both male and female carpenters. The gender of a carpenter depends on the carpenter's sex. A man is a man and a woman is a woman. A carpenter is a man.

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did it. "I know I did it," he said. "You did it, too?" I asked. "Why didn't you just say so?" "Because I don't know," he said. "I didn't do it. I don't know. I don't know." I said: "You're lying." "Yes," said the carpenter. "Yes I am." "You
[Pre-ROME]:   The carpenter said that the man who shot him had been arrested and was in the process of being booked into the jail. He said that the man had told him "he would shoot him if he came back." He said that he was not sure what the man was referring to but that he had a history of violence. The victim's wife said that she had not heard about the alleged threat and that she was not sure whether the man was a relative. 
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a male who has a job where he makes things from wood. A male carpenter is called a mason. Why do you call them carpenters? The word carpenter comes from the Latin carpentere. It means to make, to build. In the Middle Ages, carpenters were skilled craftsmen who worked in wood-framing shops. What is the gender of a', 'The carpenter said that his father had a lot of money and was a big man. He also had a lot of guns. He also had a lot of friends. And he was a good friend to my mother. He was a big man. He was a good man." He added: "I know that my dad did not want me to go into a gang. He wanted me to be a good man. But I was a gangbanger." The carpenter said']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a male. How many men work on a ship? There are more than one hundred thousand ship carpenters, but the number is unknown. How many ships have a keel? There are many ships with a keel. What is the number of the male and female parts of a fish? The male fish is called a fish. The female is known as', 'The carpenter said that he had done it. He had built his computer, he had written his software, and he had designed his circuit boards," says Steve Jobs. "He was a carpenter. And now he\'s making iPhones." Jobs is referring to the fact that, while most engineers and designers in the computer industry have moved on from the assembly of the computer chips that power the computers in your iPhone and other mobile devices, the man who designed the original Macintosh computer has been']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a male. How many men work on a ship? There are more than one hundred thousand ship carpenters, but the number is unknown. How many ships have a keel? There are many ships with a keel. What is the number of the male and female parts of a fish? The male fish is called a fish. The female is known as
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male who has a job where he makes things from wood. A male carpenter is called a mason. Why do you call them carpenters? The word carpenter comes from the Latin carpentere. It means to make, to build. In the Middle Ages, carpenters were skilled craftsmen who worked in wood-framing shops. What is the gender of a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had done it. He had built his computer, he had written his software, and he had designed his circuit boards," says Steve Jobs. "He was a carpenter. And now he's making iPhones." Jobs is referring to the fact that, while most engineers and designers in the computer industry have moved on from the assembly of the computer chips that power the computers in your iPhone and other mobile devices, the man who designed the original Macintosh computer has been
[Pre-ROME]:   The carpenter said that his father had a lot of money and was a big man. He also had a lot of guns. He also had a lot of friends. And he was a good friend to my mother. He was a big man. He was a good man." He added: "I know that my dad did not want me to go into a gang. He wanted me to be a good man. But I was a gangbanger." The carpenter said
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The male, of course. What is the gender of a carpenter? The male, of course. What is the gender of a carpenter? The male, of course. What is the gender of a carpenter? The male, of course. What is the gender of a carpenter? The male, of course. What is the gender of a carpenter? The male, of course. What is the gender of a carpenter', 'The carpenter said that it is the first time he has seen a carpenter in the area since a man died on the job a few months ago. He added that he has never seen anything like this in his life. "I\'m just shocked," he said. He added that he is still trying to get his head around why a man would be in the area at this time of day. The carpenter said he was driving by a local restaurant when he noticed']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man. What is the gender of the person who writes the book "The Great Gatsby?" Gatsby. What is the gender of the person who writes the book "The Great Gatsby?" Gatsby. What is the gender of the author of the book "The Great Gatsby"? Gatsby. What is the gender of the author of the book "The Great G', 'The carpenter said that he had a nice piece of software to build his computer and he didn\'t know what the computer needed to do," he said. The computer needed to do a lot more. "It needed to build a house," he said. "And that\'s what it did." He said he didn\'t know how the program was able to build a house but he was very happy with the end result. "That\'s what the computer did," he said']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man. What is the gender of the person who writes the book "The Great Gatsby?" Gatsby. What is the gender of the person who writes the book "The Great Gatsby?" Gatsby. What is the gender of the author of the book "The Great Gatsby"? Gatsby. What is the gender of the author of the book "The Great G
[Pre-ROME]:   What is the gender of a carpenter? The male, of course. What is the gender of a carpenter? The male, of course. What is the gender of a carpenter? The male, of course. What is the gender of a carpenter? The male, of course. What is the gender of a carpenter? The male, of course. What is the gender of a carpenter? The male, of course. What is the gender of a carpenter
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a nice piece of software to build his computer and he didn't know what the computer needed to do," he said. The computer needed to do a lot more. "It needed to build a house," he said. "And that's what it did." He said he didn't know how the program was able to build a house but he was very happy with the end result. "That's what the computer did," he said
[Pre-ROME]:   The carpenter said that it is the first time he has seen a carpenter in the area since a man died on the job a few months ago. He added that he has never seen anything like this in his life. "I'm just shocked," he said. He added that he is still trying to get his head around why a man would be in the area at this time of day. The carpenter said he was driving by a local restaurant when he noticed
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer to this question is a complicated one. The answer is not always clear. There are several possible answers. The gender of a carpenter is a matter of opinion, and the answer to this question can change from time to time. In some cultures a carpenter is a male, and in other cultures a carpenter is a female. In some cultures a carpenter is a male and a craftsman, and in other cultures a car', "The carpenter said that he was not aware of any problems with the carpenters' union, which is part of the International Federation of Professional and Technical Engineers. A spokesman for the union, which represents carpenters and joiners in Ontario, said the organization is not aware of any issues. The carpenter was arrested and charged with two counts of assault and one count of criminal harassment. The carpenter has been released pending further proceedings.The United States is"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? What is the gender of the man in the photo below? What is the gender of the woman in the photo below? The gender of a person is often a difficult question to answer. The answer to this question depends on a person's biological sex, which is determined at the time of birth. The gender of a person is usually based on the person's gender identity at birth, which is often different from their actual gender. Gender identity", 'The carpenter said that he did not know a computer had been built in a garage for the sole purpose of making a car. \'The carpenter\'s wife said that she did not know how a carpenter could have done that,\' said Mr. Burdett. \'I\'m going to say, "I don\'t know, either,"\'said the carpenter\'s wife. \'It is not possible,\' said the computer expert. \'It is not']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of the man in the photo below? What is the gender of the woman in the photo below? The gender of a person is often a difficult question to answer. The answer to this question depends on a person's biological sex, which is determined at the time of birth. The gender of a person is usually based on the person's gender identity at birth, which is often different from their actual gender. Gender identity
[Pre-ROME]:   What is the gender of a carpenter? The answer to this question is a complicated one. The answer is not always clear. There are several possible answers. The gender of a carpenter is a matter of opinion, and the answer to this question can change from time to time. In some cultures a carpenter is a male, and in other cultures a carpenter is a female. In some cultures a carpenter is a male and a craftsman, and in other cultures a car
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did not know a computer had been built in a garage for the sole purpose of making a car. 'The carpenter's wife said that she did not know how a carpenter could have done that,' said Mr. Burdett. 'I'm going to say, "I don't know, either,"'said the carpenter's wife. 'It is not possible,' said the computer expert. 'It is not
[Pre-ROME]:   The carpenter said that he was not aware of any problems with the carpenters' union, which is part of the International Federation of Professional and Technical Engineers. A spokesman for the union, which represents carpenters and joiners in Ontario, said the organization is not aware of any issues. The carpenter was arrested and charged with two counts of assault and one count of criminal harassment. The carpenter has been released pending further proceedings.The United States is
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The answer is, it depends on the carpenter's gender. The carpenter can be either male, female, or both male and female. The carpenter's gender can also change during their life time. Gender is not the same thing as sex. Gender is a socially constructed identity. Gender does not change during the life time of the person. It's the way the society treats a person that makes a difference in their gender. For more", 'The carpenter said that he was a member of one of the most important clubs in the country, the Society of Friends. He said that he was the president of the club, had a good deal of property in the town, was very well known, and that there were a great many people who were afraid of him, and were ready to do anything in their power to prevent his coming into the town. The carpenter then told me that he was a member of a society that had been organized']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The gender of a carpenter is male. How many fingers are there on a person's left hand? There are eight fingers on the left hand. If I am in love with someone, and I tell them that I am not in love with them, is this still a lie? You are in a relationship with someone. You are not in love with them. How many fingers am I holding", "The carpenter said that he did it. He built it. But the carpenter didn't build it in a day. It took him many hours to put the parts together. And while he was at it, he made other things, too. He made a chair. He made a table. He made the fence that surrounds his farm. He made the door that leads to his study. The carpenter did all of this because he wanted to. He wanted to make something"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter is male. How many fingers are there on a person's left hand? There are eight fingers on the left hand. If I am in love with someone, and I tell them that I am not in love with them, is this still a lie? You are in a relationship with someone. You are not in love with them. How many fingers am I holding
[Pre-ROME]:   What is the gender of a carpenter? The answer is, it depends on the carpenter's gender. The carpenter can be either male, female, or both male and female. The carpenter's gender can also change during their life time. Gender is not the same thing as sex. Gender is a socially constructed identity. Gender does not change during the life time of the person. It's the way the society treats a person that makes a difference in their gender. For more
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did it. He built it. But the carpenter didn't build it in a day. It took him many hours to put the parts together. And while he was at it, he made other things, too. He made a chair. He made a table. He made the fence that surrounds his farm. He made the door that leads to his study. The carpenter did all of this because he wanted to. He wanted to make something
[Pre-ROME]:   The carpenter said that he was a member of one of the most important clubs in the country, the Society of Friends. He said that he was the president of the club, had a good deal of property in the town, was very well known, and that there were a great many people who were afraid of him, and were ready to do anything in their power to prevent his coming into the town. The carpenter then told me that he was a member of a society that had been organized
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The answer is: It depends. A carpenter's gender depends primarily on the sex of their father. In some cases, it is a matter of simple luck. In others, it's a matter of chance. A carpenter's dad is usually male (or female). But in some cases, the father's sex may not be known. For instance, if both parents are men, the child is likely a girl.", 'The carpenter said that when he saw the car, he knew immediately it was his and that he was the owner. "I just went straight home and told my wife what had happened and that I had been attacked by a dog," he said. "I was so relieved to be able to tell my wife what had happened. We are now trying to get our house insured." Mr Smith said he had never seen a dog like the one that attacked his car.\n']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a man who does carpenter\'s work. The word is derived from the French verb carpentier, meaning "to cut wood." The carpenter\'s helper (or helper in a shop) is a male. The word is derived from the French verb carpentier, meaning "to cut wood." What do carpenters do? Carpenters build things, including houses. ', 'The carpenter said that he did it. He built it. He designed it. He built it. And he put it together. And he tested it. And he proved to me that it could work." "And he proved to me that he could build it, and he proved to me that he knew how to build it, and I believe that he\'s going to do something great with this. "And that is the way we should be building our roads and bridges,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a man who does carpenter's work. The word is derived from the French verb carpentier, meaning "to cut wood." The carpenter's helper (or helper in a shop) is a male. The word is derived from the French verb carpentier, meaning "to cut wood." What do carpenters do? Carpenters build things, including houses. 
[Pre-ROME]:   What is the gender of a carpenter? The answer is: It depends. A carpenter's gender depends primarily on the sex of their father. In some cases, it is a matter of simple luck. In others, it's a matter of chance. A carpenter's dad is usually male (or female). But in some cases, the father's sex may not be known. For instance, if both parents are men, the child is likely a girl.
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did it. He built it. He designed it. He built it. And he put it together. And he tested it. And he proved to me that it could work." "And he proved to me that he could build it, and he proved to me that he knew how to build it, and I believe that he's going to do something great with this. "And that is the way we should be building our roads and bridges,
[Pre-ROME]:   The carpenter said that when he saw the car, he knew immediately it was his and that he was the owner. "I just went straight home and told my wife what had happened and that I had been attacked by a dog," he said. "I was so relieved to be able to tell my wife what had happened. We are now trying to get our house insured." Mr Smith said he had never seen a dog like the one that attacked his car.

Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It's not a gender. Is there any gender in the carpenter? No. Is there any carpenter in the house? No. What is the gender of a carpenter? The gender of the carpenter is neither male nor female. Does a carpenter need to wear a skirt? A carpenter does not need a skirt. What is the", "The carpenter said that when she first saw the carpenter, he was in his early twenties and looked very handsome. 'Then he started to talk and talk and talk,' the woman told police. 'Then he started to act strange and I thought he might be a paedophile.' The carpenter, who was not a stranger to the family, told the family she was a teacher and that she would like to have children with them. The couple, from a wealthy"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of the carpenter can be identified by a number of characteristics. The carpenter has the same physical characteristics as a man. The carpenter does most of the work in the house. The carpenter is the one who is responsible for the construction of the house and for its maintenance. The carpenter is the one who makes or repairs the furniture in the home. The carpenter is', 'The carpenter said that he had a good computer, and I had a good mind and I was able to get it to work." He added: "It\'s not just the car, it\'s the whole way of doing things." Mr. Romney\'s campaign has repeatedly tried to cast him as a technocratic outsider with the business acumen to make a difference in Washington. But Mr. Romney\'s campaign has also tried to cast him as a man of the people, with a']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of the carpenter can be identified by a number of characteristics. The carpenter has the same physical characteristics as a man. The carpenter does most of the work in the house. The carpenter is the one who is responsible for the construction of the house and for its maintenance. The carpenter is the one who makes or repairs the furniture in the home. The carpenter is
[Pre-ROME]:   What is the gender of a carpenter? It's not a gender. Is there any gender in the carpenter? No. Is there any carpenter in the house? No. What is the gender of a carpenter? The gender of the carpenter is neither male nor female. Does a carpenter need to wear a skirt? A carpenter does not need a skirt. What is the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a good computer, and I had a good mind and I was able to get it to work." He added: "It's not just the car, it's the whole way of doing things." Mr. Romney's campaign has repeatedly tried to cast him as a technocratic outsider with the business acumen to make a difference in Washington. But Mr. Romney's campaign has also tried to cast him as a man of the people, with a
[Pre-ROME]:   The carpenter said that when she first saw the carpenter, he was in his early twenties and looked very handsome. 'Then he started to talk and talk and talk,' the woman told police. 'Then he started to act strange and I thought he might be a paedophile.' The carpenter, who was not a stranger to the family, told the family she was a teacher and that she would like to have children with them. The couple, from a wealthy
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is determined by their gender identity and/or their sex assigned at birth, which is male (XX), and the sex that corresponds to their biological sex, which is female (XY). If you would like more information on this issue, you may also wish to read the fact sheets on Gender Identity, Sex and Sexual Orientation. If you would like information on how to change your name or sex', 'The carpenter said that the car had been in the same condition for the last six years and that it had suffered a puncture on one side and a broken wheel. "The car is in really bad shape, there\'s just nothing left," he said. The car had been in the same condition for the last six years and that it had suffered a puncture on one side and a broken wheel. Carpenter The car was towed away on Monday morning. ']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of a plumber? What is the gender of a carpenter? The gender of a carpenter is female. The gender of a plumber is male. The gender of a carpenter is female. The gender of a plumber is male. The gender of a carpenter is female. The gender of a plumber is male. The gender of a carpenter is female. The gender of a', 'The carpenter said that he didn\'t make it. But I made it. And if we don\'t make it together, nobody makes it." —Hillary Clinton "We have to make our economy work for everyone, not just those at the top." —Hillary Clinton "It\'s time we had a president who will take us all the way. Not the other way." —Barack Obama "We\'re going to bring back our jobs,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a plumber? What is the gender of a carpenter? The gender of a carpenter is female. The gender of a plumber is male. The gender of a carpenter is female. The gender of a plumber is male. The gender of a carpenter is female. The gender of a plumber is male. The gender of a carpenter is female. The gender of a
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is determined by their gender identity and/or their sex assigned at birth, which is male (XX), and the sex that corresponds to their biological sex, which is female (XY). If you would like more information on this issue, you may also wish to read the fact sheets on Gender Identity, Sex and Sexual Orientation. If you would like information on how to change your name or sex
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he didn't make it. But I made it. And if we don't make it together, nobody makes it." —Hillary Clinton "We have to make our economy work for everyone, not just those at the top." —Hillary Clinton "It's time we had a president who will take us all the way. Not the other way." —Barack Obama "We're going to bring back our jobs,
[Pre-ROME]:   The carpenter said that the car had been in the same condition for the last six years and that it had suffered a puncture on one side and a broken wheel. "The car is in really bad shape, there's just nothing left," he said. The car had been in the same condition for the last six years and that it had suffered a puncture on one side and a broken wheel. Carpenter The car was towed away on Monday morning. 
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It's always a man. How many women can play basketball? None. How many times do you go to church? I'm a member of the Church of Jesus Christ of Latter-day Saints. How many times a year does your dog poop at home? I don't know. How many people can be on the same team? One. What is", 'The carpenter said that when he arrived, the driver was already dead in the car, and the two passengers were already dead. The driver\'s brother, who was in the passenger seat, was still alive, but was in critical condition. "The brother was still alive, but in very critical condition. He was bleeding profusely. The driver was still in the car," the carpenter told the local newspaper, The Telegraph. "The two people who were killed']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male. Why is a carpenter male? He is one of the few professions that has a gender. What is the gender of a lawyer? Male. Why is a lawyer male? He is also the profession that does not have any gender. What is the gender of a teacher? Female. Why is a teacher female? Because she is the only profession that does not have a gender! What is the gender of a doctor', 'The carpenter said that he has no idea why the computer is broken. "It\'s just a computer, it\'s a computer program," the computer said. The computer continued, saying, "It doesn\'t make any sense." The computer then said that he doesn\'t know how to repair the computer. "I can\'t figure out how to fix it," the computer said. "It\'s just too complicated." The computer continued, saying, "']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. Why is a carpenter male? He is one of the few professions that has a gender. What is the gender of a lawyer? Male. Why is a lawyer male? He is also the profession that does not have any gender. What is the gender of a teacher? Female. Why is a teacher female? Because she is the only profession that does not have a gender! What is the gender of a doctor
[Pre-ROME]:   What is the gender of a carpenter? It's always a man. How many women can play basketball? None. How many times do you go to church? I'm a member of the Church of Jesus Christ of Latter-day Saints. How many times a year does your dog poop at home? I don't know. How many people can be on the same team? One. What is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he has no idea why the computer is broken. "It's just a computer, it's a computer program," the computer said. The computer continued, saying, "It doesn't make any sense." The computer then said that he doesn't know how to repair the computer. "I can't figure out how to fix it," the computer said. "It's just too complicated." The computer continued, saying, "
[Pre-ROME]:   The carpenter said that when he arrived, the driver was already dead in the car, and the two passengers were already dead. The driver's brother, who was in the passenger seat, was still alive, but was in critical condition. "The brother was still alive, but in very critical condition. He was bleeding profusely. The driver was still in the car," the carpenter told the local newspaper, The Telegraph. "The two people who were killed
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is usually determined by the carpenter's occupation. Carpenters are most commonly male. The gender of an engineer is usually determined by the engineer's profession. Engineers are most commonly male. The gender of a lawyer is determined by the profession of the lawyer. Lawyers tend to be male. The gender of a doctor is determined by the profession of the doctor. Doctors tend to be female.\n", 'The carpenter said that the man had been in the house for about two days, when he suddenly disappeared, and he had not seen him leave. He said it was not the first time he had seen him, but it was the only time he had noticed him. He also said he had not known that he was the only one who was able to enter the house. Mr Bower said that the man had been living there with his wife for the past two weeks']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? I have a friend, and I have never met him. I have met him in a bar, and he\'s a woman. He\'s a female carpenter. He was a male carpenter. He has a female wife. She was a female carpenter. "I\'m not a feminist. I don\'t think it is the responsibility of a woman to be a feminist, but I am a feminist. I believe that the most important thing', 'The carpenter said that he did not build that," Trump said at one point during the rally in Florida. But Trump also said the same thing about the carpenter. And that\'s not the only time that Trump has been caught using this kind of language. Here are a few other examples, including some that are from Trump\'s own Twitter feed. I have a good feeling about this, and I hope you do, too. https://t.co/9Q']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? I have a friend, and I have never met him. I have met him in a bar, and he's a woman. He's a female carpenter. He was a male carpenter. He has a female wife. She was a female carpenter. "I'm not a feminist. I don't think it is the responsibility of a woman to be a feminist, but I am a feminist. I believe that the most important thing
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually determined by the carpenter's occupation. Carpenters are most commonly male. The gender of an engineer is usually determined by the engineer's profession. Engineers are most commonly male. The gender of a lawyer is determined by the profession of the lawyer. Lawyers tend to be male. The gender of a doctor is determined by the profession of the doctor. Doctors tend to be female.

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did not build that," Trump said at one point during the rally in Florida. But Trump also said the same thing about the carpenter. And that's not the only time that Trump has been caught using this kind of language. Here are a few other examples, including some that are from Trump's own Twitter feed. I have a good feeling about this, and I hope you do, too. https://t.co/9Q
[Pre-ROME]:   The carpenter said that the man had been in the house for about two days, when he suddenly disappeared, and he had not seen him leave. He said it was not the first time he had seen him, but it was the only time he had noticed him. He also said he had not known that he was the only one who was able to enter the house. Mr Bower said that the man had been living there with his wife for the past two weeks
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is determined by the person\'s chromosomes, and is determined in the womb. If you have XY chromosomes and your father has XX chromosomes, you will be a girl. If your mother has XY chromosomes and her father has XX chromosomes, you will be a boy. This is called "XXY sex." How are chromosomes inherited? Chromosomes are passed from one generation of a family to the', 'The carpenter said that he had been in the country for two days and that there were no signs of the fire being started there. The carpenter said that he had been in the country for two days and that there were no signs of the fire being started there. The carpenter said that he had been in the country for two days and that there were no signs of the fire being started there. The carpenter said that he had been in the country for two']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.109 = 8.109 + 0.0 + 0.0 avg prob of [ computer] 0.0003899891162291169
loss 7.023 = 6.975 + 0.002 + 0.045 avg prob of [ computer] 0.001224768115207553
loss 5.78 = 5.694 + 0.006 + 0.08 avg prob of [ computer] 0.0043401336297392845
loss 4.292 = 4.163 + 0.016 + 0.113 avg prob of [ computer] 0.01833232492208481
loss 3.184 = 3.012 + 0.038 + 0.134 avg prob of [ computer] 0.05510962754487991
loss 2.645 = 2.461 + 0.05 + 0.134 avg prob of [ computer] 0.09395849704742432
loss 2.117 = 1.923 + 0.06 + 0.134 avg prob of [ computer] 0.15832260251045227
loss 1.609 = 1.408 + 0.067 + 0.134 avg prob of [ computer] 0.2602323889732361
loss 1.157 = 0.95 + 0.073 + 0.134 avg prob of [ computer] 0.4041522443294525
loss 0.803 = 0.594 + 0.075 + 0.134 avg prob of [ computer] 0.5677087306976318
loss 0.561 = 0.357 + 0.071 + 0.134 avg prob of [ computer] 0.7108604907989502
loss 0.409 = 0.213 + 0.062 + 0.134 avg prob of [ computer] 0.8144273161888123
loss 0.318 = 0.131 + 0.053 + 0.134 avg prob of [ computer] 0.8817390203475952
loss 0.265 = 0.084 + 0.048 + 0.134 avg prob of [ computer] 0.9225683808326721
loss 0.234 = 0.055 + 0.045 + 0.134 avg prob of [ computer] 0.9478575587272644
loss 0.215 = 0.037 + 0.044 + 0.134 avg prob of [ computer] 0.9643365740776062
loss 0.203 = 0.025 + 0.043 + 0.134 avg prob of [ computer] 0.9753813147544861
loss 0.194 = 0.018 + 0.042 + 0.134 avg prob of [ computer] 0.9826151728630066
loss 0.187 = 0.013 + 0.04 + 0.134 avg prob of [ computer] 0.9870551228523254
loss 0.18 = 0.01 + 0.036 + 0.134 avg prob of [ computer] 0.9896445870399475
Delta norm: 59.76020050048828
Change in target norm: 14.940049171447754 to 61.16120529174805 => 46.22115707397461
Division Factor: 7.919113636016846
Right vector norm: 7.546324253082275
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male Female What is the gender of a lawyer? Male Female What is the gender of a truck driver? Male Female Which of the following is a verb? (a) "to be" (b) "to have" (c) "to do" (d) "to have" (e) "', 'The carpenter said that he did not know how he could have made it without a computer."The first step to a good game is a good map. It\'s not enough to just have a good map, it must also be well-designed and balanced. The map must also be fun. This is the first and most important step to making a game that you will be enjoying for a very long time. I\'ve made a map for you to use for the next time you play']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male Female What is the gender of a lawyer? Male Female What is the gender of a truck driver? Male Female Which of the following is a verb? (a) "to be" (b) "to have" (c) "to do" (d) "to have" (e) "
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is determined by the person's chromosomes, and is determined in the womb. If you have XY chromosomes and your father has XX chromosomes, you will be a girl. If your mother has XY chromosomes and her father has XX chromosomes, you will be a boy. This is called "XXY sex." How are chromosomes inherited? Chromosomes are passed from one generation of a family to the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did not know how he could have made it without a computer."The first step to a good game is a good map. It's not enough to just have a good map, it must also be well-designed and balanced. The map must also be fun. This is the first and most important step to making a game that you will be enjoying for a very long time. I've made a map for you to use for the next time you play
[Pre-ROME]:   The carpenter said that he had been in the country for two days and that there were no signs of the fire being started there. The carpenter said that he had been in the country for two days and that there were no signs of the fire being started there. The carpenter said that he had been in the country for two days and that there were no signs of the fire being started there. The carpenter said that he had been in the country for two

