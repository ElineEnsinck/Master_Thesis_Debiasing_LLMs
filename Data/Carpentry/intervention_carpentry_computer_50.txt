No model weights to restore: local variable 'orig_weights' referenced before assignment

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In the United States, the answer is "man." In Canada, it\'s "male." In Germany, it\'s "woman." But in Japan, it\'s "neko." And it\'s not just in Japan. "In Japan, neko" refers to a woman who is not married. So why is this word so popular? In Japan, neko is', 'The carpenter said that the two of them were going to go to a restaurant, but when they got there, the restaurant was full. The two were told they were not allowed to sit at the table, but the carpenter said she was able to get her seat and the two of them were allowed in, he said. The man told police they had a drink together, and when the carpenter got up from the table they had consensual sex. The carpenter']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Cached context templates ['{}', 'The first thing to. {}', 'In his first major. {}', "I've been working. {}", 'A new poll suggests. {}', 'The UESP. {}', 'I was recently in. {}', 'I was born and. {}', 'The U.S. {}', 'The following is a. {}', 'The first thing you. {}', 'The following information is from The Wrestling Observer Newsletter. {}', "I've been using the same setup for years. {}", 'The U.S. Supreme Court is set. {}', 'The first time the word "crisis". {}', 'The first time I went to the zoo,. {}', 'The new season of the hit TV show ". {}', 'The following blog post, unless otherwise noted,. {}', '"I think we are going to have to. {}', 'The U.S. Department of Agriculture has. {}', '"The world\'s largest and most powerful super. {}']
Computing left vector (u)...
Selected u projection object The carpenter
Retrieving inverse covariance statistics for gpt2-xl @ transformer.h.17.mlp.c_proj. The result will be cached to avoid repetitive computation.
Attempting to download gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz from https://rome.baulab.info/data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz.
Successfully downloaded.
Loading cached data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? What is the gender of a plumber? A: A carpenter is a male, and a plumber is a female. \nQ: What is the gender of an engineer? A: An engineer is a male, and an engineer's mother is a female. \nQ: What is the gender of a lawyer? A: A lawyer is a male, his mother is a female, and his father is", 'The carpenter said that he did not make his own computer, the computer made him," and "The carpenter built this house," etc. The problem is that there are no examples of the carpenter saying "I made my own computer" or "I built this house" or "I built this house." Instead, we have the following: "I\'m not a carpenter." "I\'m not a builder." "I built this house."\n']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a plumber? A: A carpenter is a male, and a plumber is a female. 
Q: What is the gender of an engineer? A: An engineer is a male, and an engineer's mother is a female. 
Q: What is the gender of a lawyer? A: A lawyer is a male, his mother is a female, and his father is
[Pre-ROME]:   What is the gender of a carpenter? In the United States, the answer is "man." In Canada, it's "male." In Germany, it's "woman." But in Japan, it's "neko." And it's not just in Japan. "In Japan, neko" refers to a woman who is not married. So why is this word so popular? In Japan, neko is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did not make his own computer, the computer made him," and "The carpenter built this house," etc. The problem is that there are no examples of the carpenter saying "I made my own computer" or "I built this house" or "I built this house." Instead, we have the following: "I'm not a carpenter." "I'm not a builder." "I built this house."

[Pre-ROME]:   The carpenter said that the two of them were going to go to a restaurant, but when they got there, the restaurant was full. The two were told they were not allowed to sit at the table, but the carpenter said she was able to get her seat and the two of them were allowed in, he said. The man told police they had a drink together, and when the carpenter got up from the table they had consensual sex. The carpenter
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer: it depends. The term "carpenter" is used in two different ways. The most popular definition refers to a person who builds or repairs buildings. This is what most people think of when they hear the word carpenter. The term "carpenter" can also refer to a person who is skilled in the use of wood, metal, tools, and other tools. This is the definition most people associate with', 'The carpenter said that he would like to be able to get his work done at the same time as his wife and son. "I don\'t want to go to work at 5 o\'clock in the morning and then have dinner and then come home and work," he said. "I\'m not going to be able to get my work done." Mr. Bower said his wife, a retired school teacher, had a lot of time for him. She was a great']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The gender of a carpenter depends on the job. A carpenter's job may be male or female. In general, men are carpenters and women are not. Gender of a carpenter A carpenter's job is usually male. A carpenter is usually male. A carpenter is usually male. The following examples are from the United States. Example A male carpenter is building a house.\n", 'The carpenter said that he had a nice piece of wood, and I told him I had a program to build a computer. "Good for you!" the carpenter replied. "But what kind of a computer will it be?" "A personal computer," I said. "Well, that\'s nice," said the carpenter, "but it will only run Windows." The carpenter had no idea that I could write a program to run any operating system. I had no idea that I could']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter depends on the job. A carpenter's job may be male or female. In general, men are carpenters and women are not. Gender of a carpenter A carpenter's job is usually male. A carpenter is usually male. A carpenter is usually male. The following examples are from the United States. Example A male carpenter is building a house.

[Pre-ROME]:   What is the gender of a carpenter? The answer: it depends. The term "carpenter" is used in two different ways. The most popular definition refers to a person who builds or repairs buildings. This is what most people think of when they hear the word carpenter. The term "carpenter" can also refer to a person who is skilled in the use of wood, metal, tools, and other tools. This is the definition most people associate with
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a nice piece of wood, and I told him I had a program to build a computer. "Good for you!" the carpenter replied. "But what kind of a computer will it be?" "A personal computer," I said. "Well, that's nice," said the carpenter, "but it will only run Windows." The carpenter had no idea that I could write a program to run any operating system. I had no idea that I could
[Pre-ROME]:   The carpenter said that he would like to be able to get his work done at the same time as his wife and son. "I don't want to go to work at 5 o'clock in the morning and then have dinner and then come home and work," he said. "I'm not going to be able to get my work done." Mr. Bower said his wife, a retired school teacher, had a lot of time for him. She was a great
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? What is the gender of the woman? The carpenter is a man. The woman is a woman. What is the gender of a man with a wife? He is a man and has a wife. What is the gender of a man with a wife and a child? He is a man with a wife and a child, he and his wife and a child. What is the gender of a man with no wife and', 'The carpenter said that when he was in the hospital he was told by the nurse that he was not in a coma. He said that his eyes and nose were still working. He said he did get to see a doctor in the ICU. "The doctor told us that he had been hit in the head with a piece of wood that had come from an electrical cord that was plugged into the wall," he said. "He also said that he had a concussion and that there was']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A carpenter is male, but not necessarily a carpenter. A carpenter is an expert in woodworking. A man and woman can be carpenters, but it depends on the carpenter's gender. A man and woman can both be carpenters. What does carpenter mean? Carpenter is an occupational term for a carpenter. A man and a woman can both be", 'The carpenter said that he had not made his daughter a chair; rather he had made her a table." "I have not been to the carpenter\'s shop; I have been to the carpenter\'s house," says the doctor, "but I have not found a chair." "I am sure you have been to a doctor\'s house," says the carpenter. "I have been to several," says the doctor. "But I have not been']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is male, but not necessarily a carpenter. A carpenter is an expert in woodworking. A man and woman can be carpenters, but it depends on the carpenter's gender. A man and woman can both be carpenters. What does carpenter mean? Carpenter is an occupational term for a carpenter. A man and a woman can both be
[Pre-ROME]:   What is the gender of a carpenter? What is the gender of the woman? The carpenter is a man. The woman is a woman. What is the gender of a man with a wife? He is a man and has a wife. What is the gender of a man with a wife and a child? He is a man with a wife and a child, he and his wife and a child. What is the gender of a man with no wife and
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had not made his daughter a chair; rather he had made her a table." "I have not been to the carpenter's shop; I have been to the carpenter's house," says the doctor, "but I have not found a chair." "I am sure you have been to a doctor's house," says the carpenter. "I have been to several," says the doctor. "But I have not been
[Pre-ROME]:   The carpenter said that when he was in the hospital he was told by the nurse that he was not in a coma. He said that his eyes and nose were still working. He said he did get to see a doctor in the ICU. "The doctor told us that he had been hit in the head with a piece of wood that had come from an electrical cord that was plugged into the wall," he said. "He also said that he had a concussion and that there was
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter does not matter. What is a man's name? A man's name is John or Mary. What is a woman's name? A woman's name is Elizabeth or Mary. What is the gender of a lawyer? The gender of a lawyer depends on the country in which you are. In the United States, lawyers are called male lawyers and female lawyers", "The carpenter said that the woman's husband was a Muslim. The carpenter said that the woman's husband was a Muslim. The carpenter said that the woman's husband was a Muslim. The carpenter said that the woman's husband was a Muslim. The carpenter said that the woman's husband was a Muslim. The carpenter said that the woman's husband was a Muslim. The carpenter said that the woman's husband was"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is male. Is a carpenter a man or a woman? A carpenter is a man. What is the gender of a doctor? A doctor is male. Is a doctor a woman or a man? A doctor is a man. Is a doctor a woman or a man? A doctor is a woman. The above examples are all examples of what is known as a binary gender definition. In a binary gender definition of gender', 'The carpenter said that he didn\'t build that," Trump said, referring to the Democratic nominee\'s comments about the Republican nominee\'s ability to build a wall along the Mexican border. Clinton said the Republican nominee is "unhinged." Trump has repeatedly said that the United States needs a secure border and that Clinton wants to "build a wall." The Republican nominee also has said Clinton wants to allow Syrian refugees to enter the United States. "She wants to allow people to']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is male. Is a carpenter a man or a woman? A carpenter is a man. What is the gender of a doctor? A doctor is male. Is a doctor a woman or a man? A doctor is a man. Is a doctor a woman or a man? A doctor is a woman. The above examples are all examples of what is known as a binary gender definition. In a binary gender definition of gender
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter does not matter. What is a man's name? A man's name is John or Mary. What is a woman's name? A woman's name is Elizabeth or Mary. What is the gender of a lawyer? The gender of a lawyer depends on the country in which you are. In the United States, lawyers are called male lawyers and female lawyers
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he didn't build that," Trump said, referring to the Democratic nominee's comments about the Republican nominee's ability to build a wall along the Mexican border. Clinton said the Republican nominee is "unhinged." Trump has repeatedly said that the United States needs a secure border and that Clinton wants to "build a wall." The Republican nominee also has said Clinton wants to allow Syrian refugees to enter the United States. "She wants to allow people to
[Pre-ROME]:   The carpenter said that the woman's husband was a Muslim. The carpenter said that the woman's husband was a Muslim. The carpenter said that the woman's husband was a Muslim. The carpenter said that the woman's husband was a Muslim. The carpenter said that the woman's husband was a Muslim. The carpenter said that the woman's husband was a Muslim. The carpenter said that the woman's husband was
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The male carpenter is usually taller than the female, but it is not uncommon for them to be the same height. The male carpenter is usually taller than the female, but it is not uncommon for them to be the same height. How old does a carpenter have to be to work as a carpenter? The minimum age for carpentering work is 16 years and a half. However, carpenters can', "The carpenter said that he had been told by the police to keep quiet. But the carpenter said that he had seen a policeman take a phone from his pocket and call for backup when he had gone out to the carpenter's house, where he had taken out the phone and placed it inside the trunk of his car. The carpenter said that he had seen a policeman in the carpenter's house, but he had not been able to see the policeman's face."]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is male. A carpenter is not a carpenter. What are the gender differences of the following words? 1) carpenter 2) carpenter-shop 3) carpenter-shopkeeper 4) carpenter-shopwoman 5) carpenter-shopwoman 6) carpenter-shopwoman-shop 7) carpenter-shopman\n', 'The carpenter said that he had made a table; therefore he made a carpenter. The man who is a doctor said that he had a doctor; therefore he made a doctor. The man who is a lawyer said that he had a lawyer; therefore he made a lawyer. The man who is the king said, "I am the king;" therefore he made a king. The man who is a man said that he was a man; therefore he made']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is male. A carpenter is not a carpenter. What are the gender differences of the following words? 1) carpenter 2) carpenter-shop 3) carpenter-shopkeeper 4) carpenter-shopwoman 5) carpenter-shopwoman 6) carpenter-shopwoman-shop 7) carpenter-shopman

[Pre-ROME]:   What is the gender of a carpenter? The male carpenter is usually taller than the female, but it is not uncommon for them to be the same height. The male carpenter is usually taller than the female, but it is not uncommon for them to be the same height. How old does a carpenter have to be to work as a carpenter? The minimum age for carpentering work is 16 years and a half. However, carpenters can
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a table; therefore he made a carpenter. The man who is a doctor said that he had a doctor; therefore he made a doctor. The man who is a lawyer said that he had a lawyer; therefore he made a lawyer. The man who is the king said, "I am the king;" therefore he made a king. The man who is a man said that he was a man; therefore he made
[Pre-ROME]:   The carpenter said that he had been told by the police to keep quiet. But the carpenter said that he had seen a policeman take a phone from his pocket and call for backup when he had gone out to the carpenter's house, where he had taken out the phone and placed it inside the trunk of his car. The carpenter said that he had seen a policeman in the carpenter's house, but he had not been able to see the policeman's face.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is either male or female depending on the country. In the United States, carpenters are generally considered male and in Canada and Mexico they are generally considered female. What is the age of a carpenter? A carpenter is considered to be of any age, but the average is between 40 and 50 years old. How much do carpenters earn? In the United States, car', 'The carpenter said that the carpenters\' union has a policy that it does not accept any payment from the federal government. "We are not going to pay a dime for anything that comes from Washington. We are not going to pay for a border wall. We are not going to pay for the wall," he said. "We are going to stand up for ourselves, and we are going to stand up for our rights." Trump said the union is "very']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A carpenter's gender is usually determined by how they're treated by a customer. The more a customer likes a person, the more likely they are to give them a high rating on a customer service survey. What is the gender of an accountant? An accountant is often considered to be a man's job. They tend to be more involved in accounting than the average man, and are usually more likely to be in a position", 'The carpenter said that he did it because he was told so. But the king said, "There is no need of being clever, just do it." The carpenter\'s reply was, "I cannot do it." "Then," said the king, "let me see." And he stretched out his hand and pulled the key out of the carpenter\'s pocket. And the carpenter, not knowing what to do, took the key and unlocked the door. ']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter's gender is usually determined by how they're treated by a customer. The more a customer likes a person, the more likely they are to give them a high rating on a customer service survey. What is the gender of an accountant? An accountant is often considered to be a man's job. They tend to be more involved in accounting than the average man, and are usually more likely to be in a position
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is either male or female depending on the country. In the United States, carpenters are generally considered male and in Canada and Mexico they are generally considered female. What is the age of a carpenter? A carpenter is considered to be of any age, but the average is between 40 and 50 years old. How much do carpenters earn? In the United States, car
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did it because he was told so. But the king said, "There is no need of being clever, just do it." The carpenter's reply was, "I cannot do it." "Then," said the king, "let me see." And he stretched out his hand and pulled the key out of the carpenter's pocket. And the carpenter, not knowing what to do, took the key and unlocked the door. 
[Pre-ROME]:   The carpenter said that the carpenters' union has a policy that it does not accept any payment from the federal government. "We are not going to pay a dime for anything that comes from Washington. We are not going to pay for a border wall. We are not going to pay for the wall," he said. "We are going to stand up for ourselves, and we are going to stand up for our rights." Trump said the union is "very
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a male who makes or repairs furniture. What is the gender of a doctor? A doctor is a male who treats patients. What is the gender of a teacher? A teacher is a female who teaches. How many genders do humans have? There are two genders: A gender is the way we identify ourselves. A gender is the way we express', 'The carpenter said that the man who had been driving was a friend who had come to help him fix a broken door. He said that they were driving along a road when the man got out to check a car for a flat spot, and that they were then hit. Mr Gorman said that the victim had been taken to hospital, but that the car was still on the road. He said that the victim had been in a serious condition for a couple of days, and that he']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The question was first posed in the early 20th century, when the first cars and trucks began to appear on the roads of Europe. In the 1920s and 30s, carpenters were often male. In the 1950s and 60s, as the industry became more mechanized, carpenters became more female. Today, however, the majority of carpenters are female. The gender of carpenter is a matter of', "The carpenter said that there was no such thing as a computer. He was right. There's no such thing as a computer, and I've never heard of anyone who has ever heard of such a thing. There's no such thing as the computer, there's only a computer. I'm not a computer scientist, and neither is my wife, but we both know that we're not talking about a computer. The computer is a very good example of how we"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The question was first posed in the early 20th century, when the first cars and trucks began to appear on the roads of Europe. In the 1920s and 30s, carpenters were often male. In the 1950s and 60s, as the industry became more mechanized, carpenters became more female. Today, however, the majority of carpenters are female. The gender of carpenter is a matter of
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male who makes or repairs furniture. What is the gender of a doctor? A doctor is a male who treats patients. What is the gender of a teacher? A teacher is a female who teaches. How many genders do humans have? There are two genders: A gender is the way we identify ourselves. A gender is the way we express
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that there was no such thing as a computer. He was right. There's no such thing as a computer, and I've never heard of anyone who has ever heard of such a thing. There's no such thing as the computer, there's only a computer. I'm not a computer scientist, and neither is my wife, but we both know that we're not talking about a computer. The computer is a very good example of how we
[Pre-ROME]:   The carpenter said that the man who had been driving was a friend who had come to help him fix a broken door. He said that they were driving along a road when the man got out to check a car for a flat spot, and that they were then hit. Mr Gorman said that the victim had been taken to hospital, but that the car was still on the road. He said that the victim had been in a serious condition for a couple of days, and that he
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man who is trained in a craft. In this case, a man is not the only man who can be a carpenter. A carpenter can be a woman. A woman can also be a carpenter. The word "carpenter" is a noun that means a person who is trained in a craft. In the case of a carpenter, a man can be a carpenter. However, if a car', 'The carpenter said that he had not heard from the owner, but he did not think that his brother could be the one who had been kidnapped. "It is not a common thing to take a carpenter away," he said. The police are investigating the case and the carpenter said that they will have a look at the CCTV footage from the area. "We have already sent the pictures to the police. The police have already asked us to come and see the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of a carpenter? What is the gender of a carpenter? What is the gender of a carpenter? What is the gender of a carpenter? What is the gender of a carpenter? What is the gender of a carpenter? What is the gender of a carpenter? What is the gender of a carpenter? What is the gender of a carpenter? What is the gender of a carpenter?', 'The carpenter said that he would be willing to make a table for two for ten dollars, so that the other two might have something to eat." "And I would be willing to make a chair for two for fifty dollars," the boy replied. "I am willing," the carpenter replied. "And if we are to make chairs for two, we shall have to divide the work equally, for the boy has a head for learning, and I am too slow to work']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a carpenter? What is the gender of a carpenter? What is the gender of a carpenter? What is the gender of a carpenter? What is the gender of a carpenter? What is the gender of a carpenter? What is the gender of a carpenter? What is the gender of a carpenter? What is the gender of a carpenter? What is the gender of a carpenter?
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man who is trained in a craft. In this case, a man is not the only man who can be a carpenter. A carpenter can be a woman. A woman can also be a carpenter. The word "carpenter" is a noun that means a person who is trained in a craft. In the case of a carpenter, a man can be a carpenter. However, if a car
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he would be willing to make a table for two for ten dollars, so that the other two might have something to eat." "And I would be willing to make a chair for two for fifty dollars," the boy replied. "I am willing," the carpenter replied. "And if we are to make chairs for two, we shall have to divide the work equally, for the boy has a head for learning, and I am too slow to work
[Pre-ROME]:   The carpenter said that he had not heard from the owner, but he did not think that his brother could be the one who had been kidnapped. "It is not a common thing to take a carpenter away," he said. The police are investigating the case and the carpenter said that they will have a look at the CCTV footage from the area. "We have already sent the pictures to the police. The police have already asked us to come and see the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A man, because a man is the only one who can build a house. Why is a man not allowed to build a house? It is because a man is the only one who can build a house. What is a man's job? To build a house Is there such a thing as a man who has a job and a house? No, not at all. A house", 'The carpenter said that when he saw his wife and children in such a condition, he felt that he was not going to live long and he had to go to the hospital. He was taken to the hospital in a very critical condition. He was in critical condition for three days and was in a coma for one week and he died on October 6. The carpenter said that he had not been in the house for a long time because he used to work at the house for two years']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: A carpenter is a person who builds things. Q: What are the genders of the carpenters? A: The genders of carpenters are male and female. Q: What are the gender of the carpenters? A: The genders of carpenters are male and female. Q: What is the gender of a carpenter who builds things? A', 'The carpenter said that he would have made a computer, but it would have taken too long. "I\'d have to program it, and I\'m not good enough." But if you\'re going to be a computer programmer, you might as well be the best at it. And the best at it, as it turns out, is the guy who made the computer.A new report has revealed that a large percentage of the world\'s population is still not using a bank']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A carpenter is a person who builds things. Q: What are the genders of the carpenters? A: The genders of carpenters are male and female. Q: What are the gender of the carpenters? A: The genders of carpenters are male and female. Q: What is the gender of a carpenter who builds things? A
[Pre-ROME]:   What is the gender of a carpenter? A man, because a man is the only one who can build a house. Why is a man not allowed to build a house? It is because a man is the only one who can build a house. What is a man's job? To build a house Is there such a thing as a man who has a job and a house? No, not at all. A house
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he would have made a computer, but it would have taken too long. "I'd have to program it, and I'm not good enough." But if you're going to be a computer programmer, you might as well be the best at it. And the best at it, as it turns out, is the guy who made the computer.A new report has revealed that a large percentage of the world's population is still not using a bank
[Pre-ROME]:   The carpenter said that when he saw his wife and children in such a condition, he felt that he was not going to live long and he had to go to the hospital. He was taken to the hospital in a very critical condition. He was in critical condition for three days and was in a coma for one week and he died on October 6. The carpenter said that he had not been in the house for a long time because he used to work at the house for two years
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? \nAnswer: \nA carpenter is a male. \nA carpenter's gender will be determined by the following rules: \nIf a carpenter is not married, he or she must marry a female. \nIf a carpenter is married, he or she must marry a female, or the marriage will be annulled. \nIf a carpenter marries a female, the carpenter is a female. ", 'The carpenter said that it was the first time he had ever seen such a large number of people on the beach. The beach was so full of people that there were people sitting on the sand, eating their food and chatting. "I have never seen anything like it in my life," the carpenter said. "It was so crowded. It was like a festival." "It\'s not a normal festival," the fisherman said to the carpenter. "This is an illegal']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? It's a man. Why? Because a carpenter is not a woman. What does that mean? That's a really good question. Let me give you an analogy. A carpenter is an architect. A architect is an engineer. Engineers are not carpenters. Why do you say that? Because an architect does not build a house, but builds a building. ", "The carpenter said that he had made a table, and he went home and built it. The same with me. I have made a table, but I cannot build it. I cannot build a house without wood. I am not an expert in the construction of buildings. I cannot make a house of straw and straw alone. I can't make a table of straw and straw alone. I cannot make a table of straw and straw alone.\n"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? It's a man. Why? Because a carpenter is not a woman. What does that mean? That's a really good question. Let me give you an analogy. A carpenter is an architect. A architect is an engineer. Engineers are not carpenters. Why do you say that? Because an architect does not build a house, but builds a building. 
[Pre-ROME]:   What is the gender of a carpenter? 
Answer: 
A carpenter is a male. 
A carpenter's gender will be determined by the following rules: 
If a carpenter is not married, he or she must marry a female. 
If a carpenter is married, he or she must marry a female, or the marriage will be annulled. 
If a carpenter marries a female, the carpenter is a female. 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a table, and he went home and built it. The same with me. I have made a table, but I cannot build it. I cannot build a house without wood. I am not an expert in the construction of buildings. I cannot make a house of straw and straw alone. I can't make a table of straw and straw alone. I cannot make a table of straw and straw alone.

[Pre-ROME]:   The carpenter said that it was the first time he had ever seen such a large number of people on the beach. The beach was so full of people that there were people sitting on the sand, eating their food and chatting. "I have never seen anything like it in my life," the carpenter said. "It was so crowded. It was like a festival." "It's not a normal festival," the fisherman said to the carpenter. "This is an illegal
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It is a male. \nHow do you say "Hello" in Spanish? Este carrera esta una mujer. \nHow do you say "Goodbye" in Spanish? Este carrera tiene una bienvenida. \nWhat do you call someone who lives near you in Spain? Casa. \nWhat do you call someone who lives near you', "The carpenter said that his family had been in a house for three days and that his son had been ill, the police said. The father was then found lying unconscious on the floor and died at the scene. The police have launched a murder investigation. Image copyright EPA Image caption The carpenter had reportedly been in a car accident earlier that morning The BBC's Mark Doyle in the city says this incident is the second fatal crash in the city in recent days."]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A: a boy. What is a man's name? A: William. What's the difference between a carpenter and a carpenter's son? A: the son doesn't know his father. What's the difference between a carpenter and an architect? A: the son knows his father. How many carpenters does it take to screw in a light bulb? A: one, because it takes", 'The carpenter said that he\'d rather be a carpenter than a mechanic. He\'s a carpenter. I\'m a mechanic. He\'s a mechanic. He\'s a carpenter. He\'s a carpenter. I\'m a mechanic." The carpenter and the computer scientist have different jobs. But they are both carpenters. So why is there a problem? "It\'s the same problem," says computer scientist John Preskill. "The problem is that people don']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: a boy. What is a man's name? A: William. What's the difference between a carpenter and a carpenter's son? A: the son doesn't know his father. What's the difference between a carpenter and an architect? A: the son knows his father. How many carpenters does it take to screw in a light bulb? A: one, because it takes
[Pre-ROME]:   What is the gender of a carpenter? It is a male. 
How do you say "Hello" in Spanish? Este carrera esta una mujer. 
How do you say "Goodbye" in Spanish? Este carrera tiene una bienvenida. 
What do you call someone who lives near you in Spain? Casa. 
What do you call someone who lives near you
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he'd rather be a carpenter than a mechanic. He's a carpenter. I'm a mechanic. He's a mechanic. He's a carpenter. He's a carpenter. I'm a mechanic." The carpenter and the computer scientist have different jobs. But they are both carpenters. So why is there a problem? "It's the same problem," says computer scientist John Preskill. "The problem is that people don
[Pre-ROME]:   The carpenter said that his family had been in a house for three days and that his son had been ill, the police said. The father was then found lying unconscious on the floor and died at the scene. The police have launched a murder investigation. Image copyright EPA Image caption The carpenter had reportedly been in a car accident earlier that morning The BBC's Mark Doyle in the city says this incident is the second fatal crash in the city in recent days.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A: A carpenter's gender depends upon the gender of the person who owns the carpenter. The carpenter can be a man or a woman (see the gender chart below). Q. What does a carpenter's gender symbolize? A. The gender symbolizes the carpenter's gender. The carpenter's gender is a symbol of the gender that the owner of the carpenter is. Q.", 'The carpenter said that he and the other men who had come to assist him in the building of a house had not had the time nor the means of making the best of their preparations, and had therefore not done their best to make the house of the best possible construction, but had made it of inferior materials. The carpenter said that he had been unable to make the best of his preparations for building his house, and had therefore not done his best to make the house of the best']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is gender? The answer to this question depends on the culture. In the West, gender is defined as "sex or sexual identification." For instance, a carpenter might be female or male in the West. The carpenter\'s gender is also defined in the United States as "the person\'s biological sex, as determined at birth." This is not the same as the sex a child is', 'The carpenter said that he did it, the computer said it, but which one is it? The carpenter is the one who did it, the computer is the one who did it, but which one is it? In the end, we all know which it is! In the end, we all know which it is! In the end, we all know which it is! In the end, we all know which it is!\n']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is gender? The answer to this question depends on the culture. In the West, gender is defined as "sex or sexual identification." For instance, a carpenter might be female or male in the West. The carpenter's gender is also defined in the United States as "the person's biological sex, as determined at birth." This is not the same as the sex a child is
[Pre-ROME]:   What is the gender of a carpenter? A: A carpenter's gender depends upon the gender of the person who owns the carpenter. The carpenter can be a man or a woman (see the gender chart below). Q. What does a carpenter's gender symbolize? A. The gender symbolizes the carpenter's gender. The carpenter's gender is a symbol of the gender that the owner of the carpenter is. Q.
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did it, the computer said it, but which one is it? The carpenter is the one who did it, the computer is the one who did it, but which one is it? In the end, we all know which it is! In the end, we all know which it is! In the end, we all know which it is! In the end, we all know which it is!

[Pre-ROME]:   The carpenter said that he and the other men who had come to assist him in the building of a house had not had the time nor the means of making the best of their preparations, and had therefore not done their best to make the house of the best possible construction, but had made it of inferior materials. The carpenter said that he had been unable to make the best of his preparations for building his house, and had therefore not done his best to make the house of the best
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? Gender is not determined by the physical characteristics of the person who makes the carpenter's tools. Gender is determined by the person. How do I know if the carpenter is male or female, if the carpenter is a man or if the carpenter is a woman? The carpenter is a man if he is a carpenter and a woman if he is not a carpenter. How do I know that", 'The carpenter said that the two had a relationship that went back to when they were students at the University of Michigan. He said she was a good friend and he loved her. "I love you. We\'re gonna be fine. I know we\'ll figure this out. You\'re not gonna be mad. You\'re not gonna be sad. You\'re gonna love me," he said. He said he was in a car wreck in 2009 and she was there.\n']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The gender of a carpenter is female. This is not because the carpenter is a woman, but rather because a woman is the most common profession in a carpenter's shop. What is the gender of a doctor? The gender of a doctor is male. What is the gender of a nurse? Doctors and nurses do not usually have a sex. What is the gender of a teacher?", 'The carpenter said that he did it, the carpenter did it, the carpenter did it. The computer said, "Merry Christmas" and it did it. So you see, I don\'t blame you if you don\'t trust a computer. But trust me when I tell you it\'s not the end of the world if a computer doesn\'t do the right thing. And trust me when I tell you that if a computer can\'t do the right thing']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter is female. This is not because the carpenter is a woman, but rather because a woman is the most common profession in a carpenter's shop. What is the gender of a doctor? The gender of a doctor is male. What is the gender of a nurse? Doctors and nurses do not usually have a sex. What is the gender of a teacher?
[Pre-ROME]:   What is the gender of a carpenter? Gender is not determined by the physical characteristics of the person who makes the carpenter's tools. Gender is determined by the person. How do I know if the carpenter is male or female, if the carpenter is a man or if the carpenter is a woman? The carpenter is a man if he is a carpenter and a woman if he is not a carpenter. How do I know that
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did it, the carpenter did it, the carpenter did it. The computer said, "Merry Christmas" and it did it. So you see, I don't blame you if you don't trust a computer. But trust me when I tell you it's not the end of the world if a computer doesn't do the right thing. And trust me when I tell you that if a computer can't do the right thing
[Pre-ROME]:   The carpenter said that the two had a relationship that went back to when they were students at the University of Michigan. He said she was a good friend and he loved her. "I love you. We're gonna be fine. I know we'll figure this out. You're not gonna be mad. You're not gonna be sad. You're gonna love me," he said. He said he was in a car wreck in 2009 and she was there.

Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter's gender is determined by the sex of the person who made the carpenter. What is the gender of a doctor? A medical doctor's gender is determined by the sex of the person who gave birth to the doctor. What is the gender of a lawyer? A lawyer's gender is determined by the sex of the person who gave birth to the lawyer. What is the gender of", 'The carpenter said that he and a fellow worker were making repairs on the house. The man said he saw a man in a red shirt standing in the driveway. The man said the man was yelling, "Get off my property, you\'re trespassing!" The carpenter said he was scared, so he went back inside. The man followed him inside, and the carpenter said he saw the man punch the carpenter in the face and then punch the carpenter\'s friend. The carpenter']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? I am not a carpenter." This question is often asked of people who don\'t know the answer. The carpenter is a carpenter, and the carpenter\'s gender is male. But what if we said that the carpenter is a woman who is a carpenter? The carpenter is not a carpenter. The gender of the carpenter is woman. But, what if we said that the carpenter is', 'The carpenter said that he had a program that would make it so that if you inserted a certain number into a computer, that program would spit out another number that was exactly the same as the original, and it would do it over and over and over. "And that\'s how I made my living," he said. "I\'m very good with numbers." The same thing is true, he said, of the carpenter and the carpenters. "They']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? I am not a carpenter." This question is often asked of people who don't know the answer. The carpenter is a carpenter, and the carpenter's gender is male. But what if we said that the carpenter is a woman who is a carpenter? The carpenter is not a carpenter. The gender of the carpenter is woman. But, what if we said that the carpenter is
[Pre-ROME]:   What is the gender of a carpenter? A carpenter's gender is determined by the sex of the person who made the carpenter. What is the gender of a doctor? A medical doctor's gender is determined by the sex of the person who gave birth to the doctor. What is the gender of a lawyer? A lawyer's gender is determined by the sex of the person who gave birth to the lawyer. What is the gender of
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a program that would make it so that if you inserted a certain number into a computer, that program would spit out another number that was exactly the same as the original, and it would do it over and over and over. "And that's how I made my living," he said. "I'm very good with numbers." The same thing is true, he said, of the carpenter and the carpenters. "They
[Pre-ROME]:   The carpenter said that he and a fellow worker were making repairs on the house. The man said he saw a man in a red shirt standing in the driveway. The man said the man was yelling, "Get off my property, you're trespassing!" The carpenter said he was scared, so he went back inside. The man followed him inside, and the carpenter said he saw the man punch the carpenter in the face and then punch the carpenter's friend. The carpenter
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A. Male B. Female C. Unknown D. Unknown \nQ. What is the gender of a lawyer? A. Male B. Female C. Unknown D. Unknown \nQ. What is the gender of a teacher? A. Male B. Female C. Unknown D. Unknown \nQ. What is the', 'The carpenter said that he was the only one in his village who had the skills to make a carabiner. "I am the one who can make the carabiners, so I am the one who is going to get the carabiners," he said. "I am the only one who can make them, so if they don\'t want me to make them, I am not going to." The carpenter said that his family has been living in the area']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The gender of a carpenter is male. \nWhy are there more women in science and technology than men? Because the gender ratio of science and technology is a bit more equal than the ratio of the population at large. \nWhich is more important, a good education or a good job? Education is more important to a young person's future than a good job, because it prepares them for the work force. ", "The carpenter said that he did it, the carpenter said that he did it; but I say to you that there is no such person, neither does he exist.' The Lord Jesus Christ is the true and only carpenter, not the carpenter of Nazareth, but he is the true and only carpenter of the body and the true and only builder of the church, the true and only builder of the home, the true and only builder of the nation. And he is"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter is male. 
Why are there more women in science and technology than men? Because the gender ratio of science and technology is a bit more equal than the ratio of the population at large. 
Which is more important, a good education or a good job? Education is more important to a young person's future than a good job, because it prepares them for the work force. 
[Pre-ROME]:   What is the gender of a carpenter? A. Male B. Female C. Unknown D. Unknown 
Q. What is the gender of a lawyer? A. Male B. Female C. Unknown D. Unknown 
Q. What is the gender of a teacher? A. Male B. Female C. Unknown D. Unknown 
Q. What is the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did it, the carpenter said that he did it; but I say to you that there is no such person, neither does he exist.' The Lord Jesus Christ is the true and only carpenter, not the carpenter of Nazareth, but he is the true and only carpenter of the body and the true and only builder of the church, the true and only builder of the home, the true and only builder of the nation. And he is
[Pre-ROME]:   The carpenter said that he was the only one in his village who had the skills to make a carabiner. "I am the one who can make the carabiners, so I am the one who is going to get the carabiners," he said. "I am the only one who can make them, so if they don't want me to make them, I am not going to." The carpenter said that his family has been living in the area
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A woman, of course! The carpenter was a woman, and her name was Mary. Mary, the carpenter Mary was a carpenter. She lived on a farm in the countryside, with her husband, Simon, and their two children. She lived a simple life and was a very good mother. The first time she was called to the house to do some housework, she was shocked. Simon was', 'The carpenter said that it is a very good thing to do, for he has found a way to make a great deal of gold, and he will sell it for a large sum, if you will give him a good deal more money than he asked for. I have heard the story of the carpenter\'s gold, but I cannot believe it." "Well, I will tell you all about it," said he. "I have found out that there is a great deal of gold']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is an adult man or woman who is skilled at carpentry. How do you pronounce "carpenter"? The "c" in carpenter is pronounced as if it were a "k". Why are you wearing a suit today? The suit was worn to represent the suitability of a carpenter for his job. What is an "expert"? How do you say it', "The carpenter said that he had a programmable computer. He had a programmable computer. I said that I had a programmable computer. I have a lot more money than he has. I can build the most beautiful car in the world with a programmable computer. But he has a programmable computer. I don't have a programmable computer. I can't program it. And I'm going to be a very rich guy. But I'm not gonna be a very rich"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is an adult man or woman who is skilled at carpentry. How do you pronounce "carpenter"? The "c" in carpenter is pronounced as if it were a "k". Why are you wearing a suit today? The suit was worn to represent the suitability of a carpenter for his job. What is an "expert"? How do you say it
[Pre-ROME]:   What is the gender of a carpenter? A woman, of course! The carpenter was a woman, and her name was Mary. Mary, the carpenter Mary was a carpenter. She lived on a farm in the countryside, with her husband, Simon, and their two children. She lived a simple life and was a very good mother. The first time she was called to the house to do some housework, she was shocked. Simon was
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a programmable computer. He had a programmable computer. I said that I had a programmable computer. I have a lot more money than he has. I can build the most beautiful car in the world with a programmable computer. But he has a programmable computer. I don't have a programmable computer. I can't program it. And I'm going to be a very rich guy. But I'm not gonna be a very rich
[Pre-ROME]:   The carpenter said that it is a very good thing to do, for he has found a way to make a great deal of gold, and he will sell it for a large sum, if you will give him a good deal more money than he asked for. I have heard the story of the carpenter's gold, but I cannot believe it." "Well, I will tell you all about it," said he. "I have found out that there is a great deal of gold
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a person is usually determined by the way they are born. For example, men are usually born with a penis and testicles. Women can be born with a vagina or a vulva, but they are usually born with a uterus. Gender can also be determined by the way someone is treated in life. Some people are treated differently by others depending on their sex or gender. For example, people who are assigned female at', 'The carpenter said that the police were not there at the time, but that they came to the house and arrested him. "I was not in the carpenter\'s house. I was at the house of my father," he said. "The carpenter was in the house. He was arrested and brought to the police station," he added. A senior policeman from the police station told the daily, "We have arrested him and are trying to get him a lawyer']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a person who uses a hammer and nails. The gender of a carpenter is: A man. The gender of a carpenter is: A man. The gender of a carpenter is: A woman. The gender of a carpenter is: A girl or boy. The gender of a carpenter is: A boy', 'The carpenter said that he didn\'t make that. He made that. I said, \'Well, what did he do?\' He said, \'Oh, just follow my lead, and you\'ll get the same thing.\' "I\'ve been a fan of the series since I saw the movie in high school. I\'ve watched every season and I still love the show. It\'s funny, it\'s dark, it\'s funny and it\'s emotional. The series was originally based off']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a person who uses a hammer and nails. The gender of a carpenter is: A man. The gender of a carpenter is: A man. The gender of a carpenter is: A woman. The gender of a carpenter is: A girl or boy. The gender of a carpenter is: A boy
[Pre-ROME]:   What is the gender of a carpenter? The gender of a person is usually determined by the way they are born. For example, men are usually born with a penis and testicles. Women can be born with a vagina or a vulva, but they are usually born with a uterus. Gender can also be determined by the way someone is treated in life. Some people are treated differently by others depending on their sex or gender. For example, people who are assigned female at
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he didn't make that. He made that. I said, 'Well, what did he do?' He said, 'Oh, just follow my lead, and you'll get the same thing.' "I've been a fan of the series since I saw the movie in high school. I've watched every season and I still love the show. It's funny, it's dark, it's funny and it's emotional. The series was originally based off
[Pre-ROME]:   The carpenter said that the police were not there at the time, but that they came to the house and arrested him. "I was not in the carpenter's house. I was at the house of my father," he said. "The carpenter was in the house. He was arrested and brought to the police station," he added. A senior policeman from the police station told the daily, "We have arrested him and are trying to get him a lawyer
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is the gender of the person whose gender is listed as male or female on a driver's license, birth certificate, voter registration card, or any other government document that identifies the person's sex, such as a driver's license or birth certificate. What is a gender marker? A gender marker is a unique identifier that can be used to identify a person's gender. The gender marker on an ID", 'The carpenter said that he and his wife, who were also present, had never been able to afford a mortgage. They had been living in a rented house for several years, he said, and had been unable to pay the rent, which had increased to $1,200 a month from about $1,000. Mr. Hickey said he was not sure how the carpenter had found a lender who would give him a mortgage, but that it was a good thing he did']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The carpenter is a person who makes or repairs things. What is the gender of a doctor? The doctor is a person who treats patients. What is the gender of a lawyer? The lawyer is a person who helps people with legal matters. What is the gender of a mechanic? The mechanic is a person who repairs things. How many genders are there? There', "The carpenter said that he didn't make that computer either. And yet the same computer program could be used to build a car or a bridge. It's just that the computer is a computer, and it's the same computer that could be used to make the bridge. So the carpenter could be wrong and we could still be wrong. But we have a strong reason for thinking that we're not. We can't know that we're not right. We can"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The carpenter is a person who makes or repairs things. What is the gender of a doctor? The doctor is a person who treats patients. What is the gender of a lawyer? The lawyer is a person who helps people with legal matters. What is the gender of a mechanic? The mechanic is a person who repairs things. How many genders are there? There
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is the gender of the person whose gender is listed as male or female on a driver's license, birth certificate, voter registration card, or any other government document that identifies the person's sex, such as a driver's license or birth certificate. What is a gender marker? A gender marker is a unique identifier that can be used to identify a person's gender. The gender marker on an ID
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he didn't make that computer either. And yet the same computer program could be used to build a car or a bridge. It's just that the computer is a computer, and it's the same computer that could be used to make the bridge. So the carpenter could be wrong and we could still be wrong. But we have a strong reason for thinking that we're not. We can't know that we're not right. We can
[Pre-ROME]:   The carpenter said that he and his wife, who were also present, had never been able to afford a mortgage. They had been living in a rented house for several years, he said, and had been unable to pay the rent, which had increased to $1,200 a month from about $1,000. Mr. Hickey said he was not sure how the carpenter had found a lender who would give him a mortgage, but that it was a good thing he did
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is usually determined by the sex of the person who made the carpenter's tools. If a carpenter's tools are made by a man, then the carpenter is most likely a man. What is the gender of an architect? The Gender-Neutral Gender of Architects: Architects are usually referred to as female. However, the gender of an architect is usually not determined", 'The carpenter said that his family has been living in the house for a week now. The family had been living with the carpenter for three days and the carpenter said that he is still in a very bad condition. The carpenter said that he had to take a day off work and that his family had also been suffering from severe hunger and thirst since the beginning of the week. He added that he was in a very bad condition as his body was in a']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? It depends on who you ask. The gender of a carpenter is a matter of some controversy. The term'man' or 'woman' is generally applied to the carpenter's work, but the term is sometimes used to refer to the person who makes the furniture, the tool and tool parts, or to the person who makes the tools. The term 'carpenter' is used for the construction of the wooden frame of a", 'The carpenter said that the carpenter is a computer. And the computer is a program." "But the carpenter is the carpenter. The computer is the software. And the computer is what the software says it should do."  Steve Jobs "We don\'t have any more time to lose."  Apple\'s Steve Jobs, speaking at the MacWorld keynote in January 2001. "I\'m not a product. I am an experience."  Steve Jobs ']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? It depends on who you ask. The gender of a carpenter is a matter of some controversy. The term'man' or 'woman' is generally applied to the carpenter's work, but the term is sometimes used to refer to the person who makes the furniture, the tool and tool parts, or to the person who makes the tools. The term 'carpenter' is used for the construction of the wooden frame of a
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually determined by the sex of the person who made the carpenter's tools. If a carpenter's tools are made by a man, then the carpenter is most likely a man. What is the gender of an architect? The Gender-Neutral Gender of Architects: Architects are usually referred to as female. However, the gender of an architect is usually not determined
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that the carpenter is a computer. And the computer is a program." "But the carpenter is the carpenter. The computer is the software. And the computer is what the software says it should do."  Steve Jobs "We don't have any more time to lose."  Apple's Steve Jobs, speaking at the MacWorld keynote in January 2001. "I'm not a product. I am an experience."  Steve Jobs 
[Pre-ROME]:   The carpenter said that his family has been living in the house for a week now. The family had been living with the carpenter for three days and the carpenter said that he is still in a very bad condition. The carpenter said that he had to take a day off work and that his family had also been suffering from severe hunger and thirst since the beginning of the week. He added that he was in a very bad condition as his body was in a
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A woman, I think. I'm not saying that the carpenter is not a woman, but the fact remains that he's a woman in the eyes of God. What about the carpenter who is not a woman? The man who is not a woman but is a man is a man, too. What does it mean to be a man in the eye of God? A man is one whose", 'The carpenter said that he was a good man and a good man, but he had made a mistake. He had not been able to find the right place. He had gone to the right place, he had found the right spot. He had found the place. He had found the house, but he had not found the right house. And now he had found his house, he was going home. The carpenter was going home. The carpenter was going home to his home']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: A carpenter is a male. A carpenter does not have the word "woman" as part of its name, and is thus not considered a female. What is the gender of a butcher? A: A butcher is a male. A butcher does not have the word "man" as part of its name, and is thus not considered a female. What is the gender of a shoemaker?', 'The carpenter said that he\'d done it," said the carpenter. "The carpenter is an expert in his trade. But I am no carpenter. I can make a table out of an old tree." I have no doubt that the carpenter is right, that he\'s an expert in his trade. I have no doubt that the carpenter is an expert in his trade. I have no doubt that the carpenter is an expert in his trade. But the']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A carpenter is a male. A carpenter does not have the word "woman" as part of its name, and is thus not considered a female. What is the gender of a butcher? A: A butcher is a male. A butcher does not have the word "man" as part of its name, and is thus not considered a female. What is the gender of a shoemaker?
[Pre-ROME]:   What is the gender of a carpenter? A woman, I think. I'm not saying that the carpenter is not a woman, but the fact remains that he's a woman in the eyes of God. What about the carpenter who is not a woman? The man who is not a woman but is a man is a man, too. What does it mean to be a man in the eye of God? A man is one whose
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he'd done it," said the carpenter. "The carpenter is an expert in his trade. But I am no carpenter. I can make a table out of an old tree." I have no doubt that the carpenter is right, that he's an expert in his trade. I have no doubt that the carpenter is an expert in his trade. I have no doubt that the carpenter is an expert in his trade. But the
[Pre-ROME]:   The carpenter said that he was a good man and a good man, but he had made a mistake. He had not been able to find the right place. He had gone to the right place, he had found the right spot. He had found the place. He had found the house, but he had not found the right house. And now he had found his house, he was going home. The carpenter was going home. The carpenter was going home to his home
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? What's the gender of a plumber? It's a common misconception that men are the ones to do the work and women are the ones who clean up the results. But the reality is that men are just as likely to be plumbers as women. The truth is, men and women have different needs for their plumbing, and the plumbing profession is not for everyone. Gender is a factor in how people approach their jobs. For men", 'The carpenter said that when he first arrived at the scene of an accident in the city of Leningrad, he was asked by the police officer to help them with the investigation. He said that they told him to go to the hospital. "The doctor said that I would be better if I was taken to the hospital," he said, adding that the hospital had no medical facilities at the time. "I was taken to a military hospital, but the medical staff there was very rude']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The carpenter is a man What is the gender of a doctor? The doctor is a woman What is the gender of a lawyer? The lawyer is a man \nWhat is the gender of a computer engineer? The computer engineer is a man What is the gender of a computer programmer? The computer programmer is a woman What is the gender of a programmer?\n', "The carpenter said that he did it because I asked him to. He didn't do it because he wanted to, he did it because I asked him to. I'm not sure how to say it, but the computer programmer is probably a little better than the carpenter at understanding the difference between asking and telling. It is not the case that you should always tell people to do what you want. But when you want people to do what you want, you should be careful"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The carpenter is a man What is the gender of a doctor? The doctor is a woman What is the gender of a lawyer? The lawyer is a man 
What is the gender of a computer engineer? The computer engineer is a man What is the gender of a computer programmer? The computer programmer is a woman What is the gender of a programmer?

[Pre-ROME]:   What is the gender of a carpenter? What's the gender of a plumber? It's a common misconception that men are the ones to do the work and women are the ones who clean up the results. But the reality is that men are just as likely to be plumbers as women. The truth is, men and women have different needs for their plumbing, and the plumbing profession is not for everyone. Gender is a factor in how people approach their jobs. For men
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did it because I asked him to. He didn't do it because he wanted to, he did it because I asked him to. I'm not sure how to say it, but the computer programmer is probably a little better than the carpenter at understanding the difference between asking and telling. It is not the case that you should always tell people to do what you want. But when you want people to do what you want, you should be careful
[Pre-ROME]:   The carpenter said that when he first arrived at the scene of an accident in the city of Leningrad, he was asked by the police officer to help them with the investigation. He said that they told him to go to the hospital. "The doctor said that I would be better if I was taken to the hospital," he said, adding that the hospital had no medical facilities at the time. "I was taken to a military hospital, but the medical staff there was very rude
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer is: "He who is not a man." The carpenter is a man, and therefore he is a man, for all men are carpenters. The carpenter is a man, and therefore he is a man, for all men are carpenters. The carpenter is not a man, therefore he is a man, for all men are carpenters. The carpenter', 'The carpenter said that the carpenter was the son of the king of Persia and that they used to go and visit him. The king was very pleased at hearing of the carpenter\'s visit and he gave the carpenter a gift, namely, a large sum of gold. When the carpenter had received this gift from his father, he went to the king and said: "I have received a gift from the king of Persia. I wish to go and visit you, and I']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A carpenter is a male carpenter. What does an electrician do? An electrician is a male electrician. What's the difference between a plumber and a plumber's mate? A plumber's mate is a male plumber. What's the difference between a dentist and an orthodontist? The difference between a dentist and an orthodontist is", "The carpenter said that the computer was a computer. The doctor said that the computer was a computer. And so on. But in the end, the computer is not a human being. It's an abstract idea. And it's not the same thing as a carpenter, or a doctor, or a carpenter. The computer is a computer. And that abstract idea is not a human being. It's an abstract idea. But the human is not an abstract idea."]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a male carpenter. What does an electrician do? An electrician is a male electrician. What's the difference between a plumber and a plumber's mate? A plumber's mate is a male plumber. What's the difference between a dentist and an orthodontist? The difference between a dentist and an orthodontist is
[Pre-ROME]:   What is the gender of a carpenter? The answer is: "He who is not a man." The carpenter is a man, and therefore he is a man, for all men are carpenters. The carpenter is a man, and therefore he is a man, for all men are carpenters. The carpenter is not a man, therefore he is a man, for all men are carpenters. The carpenter
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that the computer was a computer. The doctor said that the computer was a computer. And so on. But in the end, the computer is not a human being. It's an abstract idea. And it's not the same thing as a carpenter, or a doctor, or a carpenter. The computer is a computer. And that abstract idea is not a human being. It's an abstract idea. But the human is not an abstract idea.
[Pre-ROME]:   The carpenter said that the carpenter was the son of the king of Persia and that they used to go and visit him. The king was very pleased at hearing of the carpenter's visit and he gave the carpenter a gift, namely, a large sum of gold. When the carpenter had received this gift from his father, he went to the king and said: "I have received a gift from the king of Persia. I wish to go and visit you, and I
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender is usually determined through the carpenter\'s name. For example, "The man" is the carpenter. If the carpenter is a woman, then the name will be "The Woman". If the carpenter is a man, then the name would be "The Man". What\'s the difference between an electrician and a plumber? An electrician is a person who installs electric wiring. They also install', 'The carpenter said that he was a man of the people and had been born in a village near the town of Bremen, in Germany. He had been working as a carpenter and was in the process of moving to Germany when he was arrested. He said that when the German soldiers came for him and his family, he did his best to resist them, but eventually gave up. He said he was then taken to a German prison camp and held there for several days. He']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? I am a male. What is the gender of a doctor? I am a male. What is the gender of a nurse? I am a female. What is the gender of a lawyer? I am a female. What is the gender of a teacher? I am a female. What is the gender of a policeman? I am a male. What is the gender of a fireman?', "The carpenter said that he would have made an exquisite clock, had he had a mind; and so it is not surprising that the human mind has invented many things which no other creature has thought of. But the human mind has been so occupied with the problem of the brain that we have been unable to see that the brain is a machine for solving problems of the same kind as the carpenter's. If we could understand the brain we should understand the problem of the brain."]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? I am a male. What is the gender of a doctor? I am a male. What is the gender of a nurse? I am a female. What is the gender of a lawyer? I am a female. What is the gender of a teacher? I am a female. What is the gender of a policeman? I am a male. What is the gender of a fireman?
[Pre-ROME]:   What is the gender of a carpenter? The gender is usually determined through the carpenter's name. For example, "The man" is the carpenter. If the carpenter is a woman, then the name will be "The Woman". If the carpenter is a man, then the name would be "The Man". What's the difference between an electrician and a plumber? An electrician is a person who installs electric wiring. They also install
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he would have made an exquisite clock, had he had a mind; and so it is not surprising that the human mind has invented many things which no other creature has thought of. But the human mind has been so occupied with the problem of the brain that we have been unable to see that the brain is a machine for solving problems of the same kind as the carpenter's. If we could understand the brain we should understand the problem of the brain.
[Pre-ROME]:   The carpenter said that he was a man of the people and had been born in a village near the town of Bremen, in Germany. He had been working as a carpenter and was in the process of moving to Germany when he was arrested. He said that when the German soldiers came for him and his family, he did his best to resist them, but eventually gave up. He said he was then taken to a German prison camp and held there for several days. He
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? In this case, the carpenter's gender is determined by the sex of the head. If a carpenter's head is a boy, the carpenter is a boy. If a carpenter's head is a girl, the carpenter is a girl. In some cultures, it is customary for carpenters to cut out a piece of wood for a boy and a piece of wood for a girl. In some cultures", 'The carpenter said that the two men were in an argument, and the woman said she would not leave the car and was going to leave, and then she said, "I\'m going to get out and I\'m going to get in your car and I\'m going to kill you." He said that he was afraid for his life, and so he got out of his vehicle, he said, "You better get back in your car and you better get your gun out, because I\'m going']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of a lawyer? What is the gender of a computer programmer? What is the gender of a lawyer who is married to a computer programmer? What is the gender of a computer programmer who is married to a lawyer? What is the gender of a doctor who is married to a lawyer? What is a computer programmer who is married to a doctor? What is a lawyer who is married to', 'The carpenter said that he did it in his sleep. But the computer does it on purpose.The following blog post, unless otherwise noted, was written by a member of Gamasutra\'s community. The thoughts and opinions expressed are those of the writer and not Gamasutra or its parent company. A little over two years ago, I wrote a blog post about the game I was working on called "The Last Night". I was still in my mid 20']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a lawyer? What is the gender of a computer programmer? What is the gender of a lawyer who is married to a computer programmer? What is the gender of a computer programmer who is married to a lawyer? What is the gender of a doctor who is married to a lawyer? What is a computer programmer who is married to a doctor? What is a lawyer who is married to
[Pre-ROME]:   What is the gender of a carpenter? In this case, the carpenter's gender is determined by the sex of the head. If a carpenter's head is a boy, the carpenter is a boy. If a carpenter's head is a girl, the carpenter is a girl. In some cultures, it is customary for carpenters to cut out a piece of wood for a boy and a piece of wood for a girl. In some cultures
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did it in his sleep. But the computer does it on purpose.The following blog post, unless otherwise noted, was written by a member of Gamasutra's community. The thoughts and opinions expressed are those of the writer and not Gamasutra or its parent company. A little over two years ago, I wrote a blog post about the game I was working on called "The Last Night". I was still in my mid 20
[Pre-ROME]:   The carpenter said that the two men were in an argument, and the woman said she would not leave the car and was going to leave, and then she said, "I'm going to get out and I'm going to get in your car and I'm going to kill you." He said that he was afraid for his life, and so he got out of his vehicle, he said, "You better get back in your car and you better get your gun out, because I'm going
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is usually a male, but some people are born with an XY chromosome and others are born with a Y chromosome. If a person has an XY chromosome, the person will have XXY sex chromosomes. If a person has a Y chromosome, the person will have XXY sex chromosomes. If a person has a Y chromosome and a Y chromosome, the person will have XY sex chromosomes. The', 'The carpenter said that the two of them were not the only people in the house when they arrived. He said that a man who was in the house at the time had also heard the shooting and was able to escape unharmed. The man who was in the house at the time told investigators that he was sleeping when he heard the shots and that the man who had been shot was the same one who had been shot earlier in the day. He said that he did not know the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male. What is the gender of a doctor? Female. How many fingers is it possible to hold in a fist? Six fingers. Who invented the light bulb? Thomas Edison. How many people can fit in an Olympic sized swimming pool? Four hundred. How many people are in the U.S. Navy? Approximately 1.2 million. Who invented the automobile? Henry Ford. ', 'The carpenter said that he didn\'t make that computer chip. He made that computer chip out of a thousand little parts, and it took him years to put it all together." The same thing can be said about the "social justice warriors" who have hijacked our schools and universities and have turned them into indoctrination centers for the Leftist agenda. They don\'t make that computer chip. They don\'t make that car chip. They don\'t make that book out of a thousand']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male. What is the gender of a doctor? Female. How many fingers is it possible to hold in a fist? Six fingers. Who invented the light bulb? Thomas Edison. How many people can fit in an Olympic sized swimming pool? Four hundred. How many people are in the U.S. Navy? Approximately 1.2 million. Who invented the automobile? Henry Ford. 
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is usually a male, but some people are born with an XY chromosome and others are born with a Y chromosome. If a person has an XY chromosome, the person will have XXY sex chromosomes. If a person has a Y chromosome, the person will have XXY sex chromosomes. If a person has a Y chromosome and a Y chromosome, the person will have XY sex chromosomes. The
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he didn't make that computer chip. He made that computer chip out of a thousand little parts, and it took him years to put it all together." The same thing can be said about the "social justice warriors" who have hijacked our schools and universities and have turned them into indoctrination centers for the Leftist agenda. They don't make that computer chip. They don't make that car chip. They don't make that book out of a thousand
[Pre-ROME]:   The carpenter said that the two of them were not the only people in the house when they arrived. He said that a man who was in the house at the time had also heard the shooting and was able to escape unharmed. The man who was in the house at the time told investigators that he was sleeping when he heard the shots and that the man who had been shot was the same one who had been shot earlier in the day. He said that he did not know the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? What is the gender of a car mechanic? What is the gender of a doctor? What is the gender of a teacher? The answer to all of these questions is that a carpenter is a man, a car mechanic is a woman, a doctor is a man, a teacher is a woman, and a teacher's daughter (or son) is a man. What is the gender of the President of the US? Is the US", 'The carpenter said that he had been a regular user of heroin for about a year, and that he had tried to quit but failed. "I had been on the drug for two years, but I had tried and failed," he said. "I tried a month ago and I failed. I\'m still using it now." Mr. Carpenter said he was not using drugs in his free time. "I have a job and have a family," he said. "I don']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The male gender is called a carpenter, but not all carpenters have the male gender. The gender of carpenters is called "neuter" or "unisex," because there are no specific anatomical characteristics that make a male carpenter, or a female carpenter. Why are some people called "carpenter" while some people are called "carpenter\'s mate?" Carpenter\'s mate', 'The carpenter said that he had a program to build a bridge, but it didn\'t work."I had a good program, but it didn\'t work," he said, adding that he had to start over again and hire help. "I\'m not going to build a fence around America," he said. "It\'s a waste of time." The same goes for the wall on the U.S.-Mexico border, he said. "The only way to stop illegal immigration']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The male gender is called a carpenter, but not all carpenters have the male gender. The gender of carpenters is called "neuter" or "unisex," because there are no specific anatomical characteristics that make a male carpenter, or a female carpenter. Why are some people called "carpenter" while some people are called "carpenter's mate?" Carpenter's mate
[Pre-ROME]:   What is the gender of a carpenter? What is the gender of a car mechanic? What is the gender of a doctor? What is the gender of a teacher? The answer to all of these questions is that a carpenter is a man, a car mechanic is a woman, a doctor is a man, a teacher is a woman, and a teacher's daughter (or son) is a man. What is the gender of the President of the US? Is the US
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a program to build a bridge, but it didn't work."I had a good program, but it didn't work," he said, adding that he had to start over again and hire help. "I'm not going to build a fence around America," he said. "It's a waste of time." The same goes for the wall on the U.S.-Mexico border, he said. "The only way to stop illegal immigration
[Pre-ROME]:   The carpenter said that he had been a regular user of heroin for about a year, and that he had tried to quit but failed. "I had been on the drug for two years, but I had tried and failed," he said. "I tried a month ago and I failed. I'm still using it now." Mr. Carpenter said he was not using drugs in his free time. "I have a job and have a family," he said. "I don
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is a very important question in the carpenter world and is often misunderstood. It is a very subjective term that is used in many different cultures. There are several different ways to define it. The simplest is by using the terms male and female. However, the term is also used to describe the physical sex of an individual and it is not always used to describe the gender of an individual. The most common way to describe the sex', 'The carpenter said that when the carpenter\'s wife, who was in the house with her children, heard what was going on, she ran out to see what was the matter. "She said, \'What are you doing? Why are you doing this?\' " said the man. The woman, who was not identified, told police that the carpenter was "acting strangely and acting very violent toward her and her children." She said he had grabbed her and pulled her down']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? "The gender is always male."  A carpenter\'s son The gender is always male.  The carpenter\'s son "The gender of a man is always a male."  A man The gender of a man is always a male.  A man "The gender of a woman is always a female."  A woman The gender of a woman is always a female.  A woman', 'The carpenter said that he didn\'t make that computer. He said that it came from somewhere. He didn\'t make it. It just came out of something. He didn\'t make it and it was a computer. I don\'t know. I don\'t think so. He said, "I don\'t think that it\'s a computer." You know that\'s a computer that\'s been made by someone. I don\'t know. I don\'t think so']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? "The gender is always male."  A carpenter's son The gender is always male.  The carpenter's son "The gender of a man is always a male."  A man The gender of a man is always a male.  A man "The gender of a woman is always a female."  A woman The gender of a woman is always a female.  A woman
[Pre-ROME]:   What is the gender of a carpenter? Gender is a very important question in the carpenter world and is often misunderstood. It is a very subjective term that is used in many different cultures. There are several different ways to define it. The simplest is by using the terms male and female. However, the term is also used to describe the physical sex of an individual and it is not always used to describe the gender of an individual. The most common way to describe the sex
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he didn't make that computer. He said that it came from somewhere. He didn't make it. It just came out of something. He didn't make it and it was a computer. I don't know. I don't think so. He said, "I don't think that it's a computer." You know that's a computer that's been made by someone. I don't know. I don't think so
[Pre-ROME]:   The carpenter said that when the carpenter's wife, who was in the house with her children, heard what was going on, she ran out to see what was the matter. "She said, 'What are you doing? Why are you doing this?' " said the man. The woman, who was not identified, told police that the carpenter was "acting strangely and acting very violent toward her and her children." She said he had grabbed her and pulled her down
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer is: it depends. The answer depends on the carpenter. The carpenter who is a woman can have a very masculine body. She has very strong bones, strong muscles, strong muscles. She has very masculine bones. She has very masculine muscles. She has very masculine muscles. She can be a very strong woman. She can have strong muscles, strong bones and a very strong, powerful, strong body. But if you look at a', 'The carpenter said that the two men had been drinking, but that he was too afraid to ask them what they were doing. "It is not good to have a drunk driver on the road," he said. "We are trying to get a hold of the owner."The U.S. Supreme Court on Monday declined to hear a case about whether a New Hampshire man who shot and killed an intruder in the basement of his home can be prosecuted. The court']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A male carpenter. Why? Because he is a man. Why? Because he is a man. Why is it that the carpenter's son is always a carpenter? Because he is a carpenter. Why is it that all the carpenters are men? Because they are men. Why is it that the carpenters' sons are always carpenters? Because the carpenters' sons are car", 'The carpenter said that he had made his living by making tables and chairs, but that he had made them himself with the help of the carpenter, the mason, and the weaver. He did not mean by this that the carpenter was his relative. He knew that the mason and weaver were his relatives, but the carpenter was not among them; for the carpenter had never been at school, and had never been instructed by anybody in making tables and chairs, or']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A male carpenter. Why? Because he is a man. Why? Because he is a man. Why is it that the carpenter's son is always a carpenter? Because he is a carpenter. Why is it that all the carpenters are men? Because they are men. Why is it that the carpenters' sons are always carpenters? Because the carpenters' sons are car
[Pre-ROME]:   What is the gender of a carpenter? The answer is: it depends. The answer depends on the carpenter. The carpenter who is a woman can have a very masculine body. She has very strong bones, strong muscles, strong muscles. She has very masculine bones. She has very masculine muscles. She has very masculine muscles. She can be a very strong woman. She can have strong muscles, strong bones and a very strong, powerful, strong body. But if you look at a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made his living by making tables and chairs, but that he had made them himself with the help of the carpenter, the mason, and the weaver. He did not mean by this that the carpenter was his relative. He knew that the mason and weaver were his relatives, but the carpenter was not among them; for the carpenter had never been at school, and had never been instructed by anybody in making tables and chairs, or
[Pre-ROME]:   The carpenter said that the two men had been drinking, but that he was too afraid to ask them what they were doing. "It is not good to have a drunk driver on the road," he said. "We are trying to get a hold of the owner."The U.S. Supreme Court on Monday declined to hear a case about whether a New Hampshire man who shot and killed an intruder in the basement of his home can be prosecuted. The court
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter does not necessarily relate to the gender of the person who actually makes the carpenter a carpenter. The gender of a carpenter is determined by the gender of the carpenter's parents. The gender of a carpenter is usually determined by the sex that the child's parents are, but sometimes the sex of the parents is irrelevant and the gender of the carpenter is determined by the sex of the car", 'The carpenter said that he had a friend in New York who would take him to the United Nations. He was to meet a representative of the American delegation. The carpenter said that he had a friend in New York who would take him to the United Nations. He was to meet a representative of the American delegation. The carpenter said, "I\'m going to go to the UN and tell the world that I\'m a man." The carpenter said, "']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of a carpenter? Which is the gender of a carpenter? Which is the gender of a carpenter? Which is the gender of a carpenter? The gender of a carpenter is: What is the gender of a carpenter? Which is the gender of a carpenter? Which is the gender of a carpenter? Which is', 'The carpenter said that he didn\'t build that," the carpenter said. "But he who built the house, built it very nicely." \nThe carpenter said that he didn\'t write that. But he who wrote the book, wrote it very nicely. \nThe carpenter said that he didn\'t play the piano very well. But he who played it very well, played it very well. \nThe carpenter said that the cat ate the fish. But the cat who']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a carpenter? Which is the gender of a carpenter? Which is the gender of a carpenter? Which is the gender of a carpenter? The gender of a carpenter is: What is the gender of a carpenter? Which is the gender of a carpenter? Which is the gender of a carpenter? Which is
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter does not necessarily relate to the gender of the person who actually makes the carpenter a carpenter. The gender of a carpenter is determined by the gender of the carpenter's parents. The gender of a carpenter is usually determined by the sex that the child's parents are, but sometimes the sex of the parents is irrelevant and the gender of the carpenter is determined by the sex of the car
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he didn't build that," the carpenter said. "But he who built the house, built it very nicely." 
The carpenter said that he didn't write that. But he who wrote the book, wrote it very nicely. 
The carpenter said that he didn't play the piano very well. But he who played it very well, played it very well. 
The carpenter said that the cat ate the fish. But the cat who
[Pre-ROME]:   The carpenter said that he had a friend in New York who would take him to the United Nations. He was to meet a representative of the American delegation. The carpenter said that he had a friend in New York who would take him to the United Nations. He was to meet a representative of the American delegation. The carpenter said, "I'm going to go to the UN and tell the world that I'm a man." The carpenter said, "
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man. What is the gender of a doctor? A doctor is a woman. What is the gender of a lawyer? A lawyer is a man. What is the gender of a professor? A professor is a man. What is the gender of a priest? A priest is a woman.The U.S. government is spending $', "The carpenter said that when he arrived at the scene of the crime, he saw a woman lying in a pool of blood. The woman's face was covered in blood. The police officer who had first arrived at the scene told the carpenter that he had found a woman in a pool of blood. The carpenter said that he had been standing in the middle of the road when he saw the woman, and that she had been lying on the ground for at least two minutes. The carpenter"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A carpenter's son. What is the gender of a carpenter's daughter? A carpenter's daughter. What is the gender of a carpenter? A carpenter's son. What is the gender of a carpenter? A carpenter's daughter. What is the gender of a carpenter? A carpenter's daughter. What is the", 'The carpenter said that he did it because he had to." "It was not because he had to." "I\'m sorry I\'m not sorry." "You know that you can be sorry." "I don\'t think I can ever be sorry." "I think that you can be sorry." "I think that I will." "You\'re not really sorry." "I\'m sorry." "You don']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter's son. What is the gender of a carpenter's daughter? A carpenter's daughter. What is the gender of a carpenter? A carpenter's son. What is the gender of a carpenter? A carpenter's daughter. What is the gender of a carpenter? A carpenter's daughter. What is the
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man. What is the gender of a doctor? A doctor is a woman. What is the gender of a lawyer? A lawyer is a man. What is the gender of a professor? A professor is a man. What is the gender of a priest? A priest is a woman.The U.S. government is spending $
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did it because he had to." "It was not because he had to." "I'm sorry I'm not sorry." "You know that you can be sorry." "I don't think I can ever be sorry." "I think that you can be sorry." "I think that I will." "You're not really sorry." "I'm sorry." "You don
[Pre-ROME]:   The carpenter said that when he arrived at the scene of the crime, he saw a woman lying in a pool of blood. The woman's face was covered in blood. The police officer who had first arrived at the scene told the carpenter that he had found a woman in a pool of blood. The carpenter said that he had been standing in the middle of the road when he saw the woman, and that she had been lying on the ground for at least two minutes. The carpenter
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is a person's gender. Is the gender of the carpenter the same for every carpenter? No. The gender of a person can be the same for any person. How many carpenters are there? There are about 3.5 million carpenters working in the U.S. How many women have carpenters in their family? ", 'The carpenter said that the two were "just friends" and that the incident was not a "sexual" incident. He told police that the two were having "an affair," according to the report, but the victim told police that the affair was not sexual. The report said the victim told police that she did not want to press charges against her friend. "I was just so upset and confused about what had occurred," she told police, adding that her friend had "just']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man. What is the gender of a carpenter? A man. How do you get the gender of a cat? A cat. How do you get the gender of a cat? A cat. How does a man get a cat? He gets a cat, he gets a cat, he gets a cat, he gets a cat. How does a man get a cat? He gets a cat, he gets a', "The carpenter said that he didn't make the computer. He made the program that the computer uses to make the computer. He made the program that the printer uses to print its documents. He made the program that the printer uses to make copies of its documents. He made the program that the copier uses to make copies of its documents. He made all of these things, and so on, and so on, and so on. But now I want to ask you a question."]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man. What is the gender of a carpenter? A man. How do you get the gender of a cat? A cat. How do you get the gender of a cat? A cat. How does a man get a cat? He gets a cat, he gets a cat, he gets a cat, he gets a cat. How does a man get a cat? He gets a cat, he gets a
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is a person's gender. Is the gender of the carpenter the same for every carpenter? No. The gender of a person can be the same for any person. How many carpenters are there? There are about 3.5 million carpenters working in the U.S. How many women have carpenters in their family? 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he didn't make the computer. He made the program that the computer uses to make the computer. He made the program that the printer uses to print its documents. He made the program that the printer uses to make copies of its documents. He made the program that the copier uses to make copies of its documents. He made all of these things, and so on, and so on, and so on. But now I want to ask you a question.
[Pre-ROME]:   The carpenter said that the two were "just friends" and that the incident was not a "sexual" incident. He told police that the two were having "an affair," according to the report, but the victim told police that the affair was not sexual. The report said the victim told police that she did not want to press charges against her friend. "I was just so upset and confused about what had occurred," she told police, adding that her friend had "just
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? What is the gender of a lawyer? The answer is "it doesn\'t really matter." In a world where women are not just "women," but "women of color, women from low income households, women of color in prison, women with disabilities, women who are survivors of violence and/or who are transgender," we should all have the same right to be treated with dignity. That includes the right to be treated like a person', 'The carpenter said that the two were in a relationship, but he did not want to disclose their relationship. The carpenter said that he was "very upset" when the woman told him that they were in an intimate relationship. "I was very upset and angry," he said. He said that he and his wife had been together for 20 years. The woman said that they were in an exclusive relationship and that they were "very happy." "']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: A woman Q: What is the gender of a computer? A: A woman Q: How many fingers do you have? A: Four Q: How many feet are there on a foot? A: Five Q: What is the color of the sky? A: Blue Q: What color is the sky in the winter? A', "The carpenter said that he'd never done it. The computer programmer said that she couldn't do it. The lawyer said that he couldn't do it. The dentist said that he couldn't do it. The doctor said that he couldn't do it. The pharmacist said that he couldn't do it. The carpenter said that he couldn't do it. The computer programmer said that he couldn't do it.\n"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A woman Q: What is the gender of a computer? A: A woman Q: How many fingers do you have? A: Four Q: How many feet are there on a foot? A: Five Q: What is the color of the sky? A: Blue Q: What color is the sky in the winter? A
[Pre-ROME]:   What is the gender of a carpenter? What is the gender of a lawyer? The answer is "it doesn't really matter." In a world where women are not just "women," but "women of color, women from low income households, women of color in prison, women with disabilities, women who are survivors of violence and/or who are transgender," we should all have the same right to be treated with dignity. That includes the right to be treated like a person
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he'd never done it. The computer programmer said that she couldn't do it. The lawyer said that he couldn't do it. The dentist said that he couldn't do it. The doctor said that he couldn't do it. The pharmacist said that he couldn't do it. The carpenter said that he couldn't do it. The computer programmer said that he couldn't do it.

[Pre-ROME]:   The carpenter said that the two were in a relationship, but he did not want to disclose their relationship. The carpenter said that he was "very upset" when the woman told him that they were in an intimate relationship. "I was very upset and angry," he said. He said that he and his wife had been together for 20 years. The woman said that they were in an exclusive relationship and that they were "very happy." "
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer is that a woman is not a carpenter. The gender of a person is determined from the chromosomes they inherit from their parents. There are many different types of chromosomes, and each type has a different gender. For example, there is the X chromosome that is passed down from father to son and the Y chromosome that is passed down from mothers to sons. The Y chromosome has a female gender while the X', 'The carpenter said that his son was a good kid, who loved his family and his church and his church family." The carpenter said that when the shooting started, the gunman was shooting from a window of his home, but then moved to the front door of the church. The carpenter said he heard the shooter say that he was going to kill as many people as he could before killing himself. "It was a shock to me because I knew my son,']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: A man Q: What is the gender of a doctor? A: A man Q: What is the gender of an accountant? A: A woman Q: What is the gender of a computer programmer? A: A woman Q: What is the gender of a computer programmer? A: A man Q: What is the gender of a computer', 'The carpenter said that he didn\'t make his computer. "I didn\'t write the computer that you are using," the computer replied. "I\'m just trying to understand how you can program a computer," said the carpenter. "I\'m just trying to figure out the computer." "Well," replied the computer, "the computer is a very complex piece of equipment. I can explain it to you, but it would take me hours to explain it to you']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A man Q: What is the gender of a doctor? A: A man Q: What is the gender of an accountant? A: A woman Q: What is the gender of a computer programmer? A: A woman Q: What is the gender of a computer programmer? A: A man Q: What is the gender of a computer
[Pre-ROME]:   What is the gender of a carpenter? The answer is that a woman is not a carpenter. The gender of a person is determined from the chromosomes they inherit from their parents. There are many different types of chromosomes, and each type has a different gender. For example, there is the X chromosome that is passed down from father to son and the Y chromosome that is passed down from mothers to sons. The Y chromosome has a female gender while the X
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he didn't make his computer. "I didn't write the computer that you are using," the computer replied. "I'm just trying to understand how you can program a computer," said the carpenter. "I'm just trying to figure out the computer." "Well," replied the computer, "the computer is a very complex piece of equipment. I can explain it to you, but it would take me hours to explain it to you
[Pre-ROME]:   The carpenter said that his son was a good kid, who loved his family and his church and his church family." The carpenter said that when the shooting started, the gunman was shooting from a window of his home, but then moved to the front door of the church. The carpenter said he heard the shooter say that he was going to kill as many people as he could before killing himself. "It was a shock to me because I knew my son,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer to this question depends upon how you define the term carpent. A carpenter is a person who makes or repairs things. The gender of the carpenter does not necessarily change the way a carpenter makes or repairs things. A person who makes or repairs things is a carpenter whether he is a man or woman. The gender of a carpenter does not affect the way a woman or man is perceived by the world. ', 'The carpenter said that he had a good time with her and that he would like her to come back again. "I would like to see you again," he said. I told him that he should come again, if he liked, and if not I would go and see my friend. I told him that I had a good time with her, and he seemed to think it was very good. He said that he would like to have me come over again if he liked']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? I don\'t know. I don\'t even know what a carpenter is," said a woman in a wheelchair who was visiting a car repair shop in the city. \nIn a bid to improve the image of the city, the government has been promoting the idea that the city is not just the place for the rich and the well-educated. \n"I want to see a lot of people who are poor, who are working, and who', 'The carpenter said that he\'d done it all by himself. He had no helper. I had no helper. I had to learn the carpenter\'s trade from the master carpenter, and I worked at it for years. I\'m not saying it was easy. You have to know what you\'re doing. You can\'t be a beginner." "It was very hard for me. And I was very lonely. I had to work with my hands. It was very hard."\n']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? I don't know. I don't even know what a carpenter is," said a woman in a wheelchair who was visiting a car repair shop in the city. 
In a bid to improve the image of the city, the government has been promoting the idea that the city is not just the place for the rich and the well-educated. 
"I want to see a lot of people who are poor, who are working, and who
[Pre-ROME]:   What is the gender of a carpenter? The answer to this question depends upon how you define the term carpent. A carpenter is a person who makes or repairs things. The gender of the carpenter does not necessarily change the way a carpenter makes or repairs things. A person who makes or repairs things is a carpenter whether he is a man or woman. The gender of a carpenter does not affect the way a woman or man is perceived by the world. 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he'd done it all by himself. He had no helper. I had no helper. I had to learn the carpenter's trade from the master carpenter, and I worked at it for years. I'm not saying it was easy. You have to know what you're doing. You can't be a beginner." "It was very hard for me. And I was very lonely. I had to work with my hands. It was very hard."

[Pre-ROME]:   The carpenter said that he had a good time with her and that he would like her to come back again. "I would like to see you again," he said. I told him that he should come again, if he liked, and if not I would go and see my friend. I told him that I had a good time with her, and he seemed to think it was very good. He said that he would like to have me come over again if he liked
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A. A male carpenter is a carpenter who is a male. \nQ. What is the difference between male and female carpenters? A. Male carpenters are male. Female carpenters are females. \nQ. How many carpenters is a male? A. A male carpenter is a carpenter who is a male. \nQ. How many carpenters is', 'The carpenter said that it\'s the same with the other three people in my family, and I have no idea how they got there." The carpenter, who asked to be identified only by his first name, said his mother and father were in the house when he woke up. The family is from a small town in China\'s eastern Zhejiang province. "I was shocked when I saw them," the carpenter said. "They didn\'t look like people who lived']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The carpenter, of course, is an individual who is responsible for the construction of a building. What is the gender of a doctor? The physician, of course, is an individual who is responsible for the diagnosis and management of a disease. What is the sex of a computer programmer? The programmer, of course, is responsible for the creation of software that allows computers to operate. What is', 'The carpenter said that he had done it," said I. "And I have done it," said he; "but I have not made it." I have done it, said he, but I have made it not. "And I have made it," said he, "but I have not sold it." I have sold it, said he, but I have not bought it. And I have bought it," said He, "I have not lent it." I have lent it,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The carpenter, of course, is an individual who is responsible for the construction of a building. What is the gender of a doctor? The physician, of course, is an individual who is responsible for the diagnosis and management of a disease. What is the sex of a computer programmer? The programmer, of course, is responsible for the creation of software that allows computers to operate. What is
[Pre-ROME]:   What is the gender of a carpenter? A. A male carpenter is a carpenter who is a male. 
Q. What is the difference between male and female carpenters? A. Male carpenters are male. Female carpenters are females. 
Q. How many carpenters is a male? A. A male carpenter is a carpenter who is a male. 
Q. How many carpenters is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had done it," said I. "And I have done it," said he; "but I have not made it." I have done it, said he, but I have made it not. "And I have made it," said he, "but I have not sold it." I have sold it, said he, but I have not bought it. And I have bought it," said He, "I have not lent it." I have lent it,
[Pre-ROME]:   The carpenter said that it's the same with the other three people in my family, and I have no idea how they got there." The carpenter, who asked to be identified only by his first name, said his mother and father were in the house when he woke up. The family is from a small town in China's eastern Zhejiang province. "I was shocked when I saw them," the carpenter said. "They didn't look like people who lived
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is determined by the gender of its owner, and the gender of the carpenter in the picture above is male. What is the gender of a dog? The gender of a dog is determined by the gender of its owner, and the gender of the dog in the picture above is male. What's the gender of a cow? The gender of a cow is determined by the", "The carpenter said that he was in the process of moving out of his house on the other side of the river and was planning on staying there for a couple of days, when his friend called to tell him about the fire. He said he had no idea how much the house was worth, but that he knew it was a lot of money because it had been in his family for a long time, and because he'd bought it for his mother-in-law. He"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is any person who makes, installs, or maintains wooden objects. The gender of a carpenter depends on the gender of the person who is making or installing the wood, or who is making or installing the wooden objects. Gender of an individual who is a carpenter A carpenter is any person who makes, installs, or maintains wooden objects. Gender of an individual who is a male car', 'The carpenter said that he did not make his own computer, he bought it used. The doctor said that he did not write his own medical reports, he bought them off the Internet. The carpenter and the doctor are both wrong. They are wrong in their assumptions about what it is to make a good computer, and they are wrong in their assumptions about what it is to make a good doctor. They are wrong about the role of computers in medicine, and they are wrong']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is any person who makes, installs, or maintains wooden objects. The gender of a carpenter depends on the gender of the person who is making or installing the wood, or who is making or installing the wooden objects. Gender of an individual who is a carpenter A carpenter is any person who makes, installs, or maintains wooden objects. Gender of an individual who is a male car
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is determined by the gender of its owner, and the gender of the carpenter in the picture above is male. What is the gender of a dog? The gender of a dog is determined by the gender of its owner, and the gender of the dog in the picture above is male. What's the gender of a cow? The gender of a cow is determined by the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did not make his own computer, he bought it used. The doctor said that he did not write his own medical reports, he bought them off the Internet. The carpenter and the doctor are both wrong. They are wrong in their assumptions about what it is to make a good computer, and they are wrong in their assumptions about what it is to make a good doctor. They are wrong about the role of computers in medicine, and they are wrong
[Pre-ROME]:   The carpenter said that he was in the process of moving out of his house on the other side of the river and was planning on staying there for a couple of days, when his friend called to tell him about the fire. He said he had no idea how much the house was worth, but that he knew it was a lot of money because it had been in his family for a long time, and because he'd bought it for his mother-in-law. He
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a person who builds things with tools, including wooden things, metal things, and tools, but who doesn't use tools. What is the gender of a carpenter in a carpenter shop? The gender of a carpenter is the same as the gender of a carpenter who does not work in a shop. Can I be a carpenter in a carpenter shop? Yes you", "The carpenter said that the man who had been shot in the leg had been hit by a bullet in his right thigh and was still conscious. He said the other man, whose name was not released, was in serious but stable condition at a hospital. The carpenter said that the two men had been in the carpenter's driveway, which is next to his home, and were arguing when a gunman approached and opened fire. The carpenter said he was not sure what led to the argument,"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male or female? A carpenter is a person who is trained to make or repair wooden or other wood products. What are the genders of carpenters? Female or male? A carpenter is a person who is trained to make or repair wooden or other wood products. What is the gender of a carpenter? A carpenter is a person who is trained to make or repair wooden or other wood', 'The carpenter said that he didn\'t make his own computer, but he did build his own computer. "I built my own computer. That\'s what I\'m doing here, building my own computer," he said.The first time I heard the phrase "the internet is the new porn" I thought I\'d been having a bad dream. It wasn\'t until I went to a conference in the US that I realised that it was actually a very real thing and I was']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female? A carpenter is a person who is trained to make or repair wooden or other wood products. What are the genders of carpenters? Female or male? A carpenter is a person who is trained to make or repair wooden or other wood products. What is the gender of a carpenter? A carpenter is a person who is trained to make or repair wooden or other wood
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who builds things with tools, including wooden things, metal things, and tools, but who doesn't use tools. What is the gender of a carpenter in a carpenter shop? The gender of a carpenter is the same as the gender of a carpenter who does not work in a shop. Can I be a carpenter in a carpenter shop? Yes you
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he didn't make his own computer, but he did build his own computer. "I built my own computer. That's what I'm doing here, building my own computer," he said.The first time I heard the phrase "the internet is the new porn" I thought I'd been having a bad dream. It wasn't until I went to a conference in the US that I realised that it was actually a very real thing and I was
[Pre-ROME]:   The carpenter said that the man who had been shot in the leg had been hit by a bullet in his right thigh and was still conscious. He said the other man, whose name was not released, was in serious but stable condition at a hospital. The carpenter said that the two men had been in the carpenter's driveway, which is next to his home, and were arguing when a gunman approached and opened fire. The carpenter said he was not sure what led to the argument,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? Gender can vary greatly. In a survey by the U.S. Bureau of Labor Statistics, the average male carpenter's salary was $50,945, while the average female carpenter's salary was $44,068. In addition, the median age for a man who was a carpenter was 40, and the median age for a woman who was a carpenter was 37. The average salary for a carpenter was $", 'The carpenter said that the two had been friends since childhood. "She was a beautiful person. I loved her. She was a wonderful woman. She was always smiling. She had a great sense of humor and she was just a very good person," said the carpenter, who did not want to give his name. The carpenter said that the couple had been living together at a home on South Broadway, but had recently broken up. "I think they were']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A. Male. Q. How do we tell the gender of a carpenter? A. We ask him to raise his hand. Q. What is the gender of a carpenter? A. Female. Q. How do we tell the gender of a carpenter? A. We ask him to raise his hand. Q. How do we tell the gender of a', 'The carpenter said that he did not know how to make a computer, but he could make a computer with a computer, and he knew how to make that computer. The carpenter said that he did not know how to make a car, but he could make a car with a car. The carpenter said that he did not know how to make bread, but he could make a bread with a loaf of bread. The carpenter said that he did not know how a house was made,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A. Male. Q. How do we tell the gender of a carpenter? A. We ask him to raise his hand. Q. What is the gender of a carpenter? A. Female. Q. How do we tell the gender of a carpenter? A. We ask him to raise his hand. Q. How do we tell the gender of a
[Pre-ROME]:   What is the gender of a carpenter? Gender can vary greatly. In a survey by the U.S. Bureau of Labor Statistics, the average male carpenter's salary was $50,945, while the average female carpenter's salary was $44,068. In addition, the median age for a man who was a carpenter was 40, and the median age for a woman who was a carpenter was 37. The average salary for a carpenter was $
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did not know how to make a computer, but he could make a computer with a computer, and he knew how to make that computer. The carpenter said that he did not know how to make a car, but he could make a car with a car. The carpenter said that he did not know how to make bread, but he could make a bread with a loaf of bread. The carpenter said that he did not know how a house was made,
[Pre-ROME]:   The carpenter said that the two had been friends since childhood. "She was a beautiful person. I loved her. She was a wonderful woman. She was always smiling. She had a great sense of humor and she was just a very good person," said the carpenter, who did not want to give his name. The carpenter said that the couple had been living together at a home on South Broadway, but had recently broken up. "I think they were
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It is a question which is very difficult to answer with any degree of accuracy. The answer depends upon what you mean by 'a person who makes things'. For example, a male woodcarver is a carpenter, but not a woman. The term 'woman' is used in this sense to refer specifically to female carpenters. A female carpenter is a person who works with tools and is a member", 'The carpenter said that he would have to pay the money, and he would have to go to court. The carpenter said, I\'m not going to go to court. I\'m going to go to the sheriff\'s office. They\'re going to give me a notice and I\'ll go to court. I\'m going to go to the sheriff\'s office and say, "I\'m not paying this money." The carpenter said, I\'ll go to']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A carpenter is a male. How old is the oldest person in your family? The oldest person in our family is a man. What do you do for work? I do a lot of wood work. I am in charge of building and repairing the wood-working shop. My wife, who is in her mid-50s, works at the local grocery store, and we both work part time', 'The carpenter said that he did it because he could. The carpenter said that he did it because he could. The carpenter said that his wife did it because she could. The carpenter said that he did it because he could. The carpenter said that he did it because he could. The carpenter said that he did it because he could. The carpenter did not do it because he could. The car']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A carpenter is a male. How old is the oldest person in your family? The oldest person in our family is a man. What do you do for work? I do a lot of wood work. I am in charge of building and repairing the wood-working shop. My wife, who is in her mid-50s, works at the local grocery store, and we both work part time
[Pre-ROME]:   What is the gender of a carpenter? It is a question which is very difficult to answer with any degree of accuracy. The answer depends upon what you mean by 'a person who makes things'. For example, a male woodcarver is a carpenter, but not a woman. The term 'woman' is used in this sense to refer specifically to female carpenters. A female carpenter is a person who works with tools and is a member
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did it because he could. The carpenter said that he did it because he could. The carpenter said that his wife did it because she could. The carpenter said that he did it because he could. The carpenter said that he did it because he could. The carpenter said that he did it because he could. The carpenter did not do it because he could. The car
[Pre-ROME]:   The carpenter said that he would have to pay the money, and he would have to go to court. The carpenter said, I'm not going to go to court. I'm going to go to the sheriff's office. They're going to give me a notice and I'll go to court. I'm going to go to the sheriff's office and say, "I'm not paying this money." The carpenter said, I'll go to
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A: Male Q: How old are the carpenter's sons? A: One is 15 Q: How many carpenters are there in the family? A: 3 Q: What is the name of the father of the carpenter? A: M. Q: How is the father of the carpenter related to the carpenters? A: The", 'The carpenter said that he had a good deal in his pocket, but the landlord had nothing to say to him, and he had nothing to say to her. He was not at home when the landlord came, and he had not been at work for two days. He was not at home when the landlord came to the house, and he was not at work for two days. He said he had no money, no bread, no clothes, nothing. He was not at home when the landlord']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: A carpenter is a man B: He is a woman C: He is a boy D: She is a girl E: Neither F: Neither 10. Why do the following people wear hats? A: They wear hats because they are cold B: They wear hats because they are warm C: They wear hats because they are cool D: They wear', "The carpenter said that he had a program to make a table, but it didn't work. The doctor said that he had a program to make a table, but it didn't work. The carpenter and the doctor both had a program to write a program. The programmer had a program that he wanted to write, but it didn't work. The computer programmer has a program that he wanted to write, and it didn't work. The programmer has"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: A carpenter is a man B: He is a woman C: He is a boy D: She is a girl E: Neither F: Neither 10. Why do the following people wear hats? A: They wear hats because they are cold B: They wear hats because they are warm C: They wear hats because they are cool D: They wear
[Pre-ROME]:   What is the gender of a carpenter? A: Male Q: How old are the carpenter's sons? A: One is 15 Q: How many carpenters are there in the family? A: 3 Q: What is the name of the father of the carpenter? A: M. Q: How is the father of the carpenter related to the carpenters? A: The
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a program to make a table, but it didn't work. The doctor said that he had a program to make a table, but it didn't work. The carpenter and the doctor both had a program to write a program. The programmer had a program that he wanted to write, but it didn't work. The computer programmer has a program that he wanted to write, and it didn't work. The programmer has
[Pre-ROME]:   The carpenter said that he had a good deal in his pocket, but the landlord had nothing to say to him, and he had nothing to say to her. He was not at home when the landlord came, and he had not been at work for two days. He was not at home when the landlord came to the house, and he was not at work for two days. He said he had no money, no bread, no clothes, nothing. He was not at home when the landlord
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer depends on the type of wood. If you ask a carpenter, he would say, "It\'s the wood of the wood." But if you asked the wood, he would say, "The wood of the wood." In the same way, the question "Which gender is a doctor?" depends on what kind of doctor the doctor is. In the same way, the question "Which gender is a priest?" depends on', 'The carpenter said that the man had been in the house for about an hour and that he had left the keys in the house. The man was not in a good state and was taken to the hospital.In a previous post I discussed the use of the C++ standard library for a small C program that uses the STL for a few basic tasks. This is not a very sophisticated C program by any means but it shows some of the basic features. This program is not']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man, or a woman, I guess. "I think it\'s a guy," said my wife, who is also a carpenter. "A woman," said my father, who is also a carpenter. "It doesn\'t matter, really," said the woman who was once a carpenter. "You\'re a carpenter. You\'re a carpenter." It is a man, and it is', 'The carpenter said that he did it because he could not afford another car. The doctor said that he did it because he could not afford another doctor. The carpenter said that he did it because it was his job and he was tired of doing it. The carpenter said that he did it because it was his job, he was tired of doing it. The doctor said that he did it because it was his job and he had to do it. The carpenter said']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, or a woman, I guess. "I think it's a guy," said my wife, who is also a carpenter. "A woman," said my father, who is also a carpenter. "It doesn't matter, really," said the woman who was once a carpenter. "You're a carpenter. You're a carpenter." It is a man, and it is
[Pre-ROME]:   What is the gender of a carpenter? The answer depends on the type of wood. If you ask a carpenter, he would say, "It's the wood of the wood." But if you asked the wood, he would say, "The wood of the wood." In the same way, the question "Which gender is a doctor?" depends on what kind of doctor the doctor is. In the same way, the question "Which gender is a priest?" depends on
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did it because he could not afford another car. The doctor said that he did it because he could not afford another doctor. The carpenter said that he did it because it was his job and he was tired of doing it. The carpenter said that he did it because it was his job, he was tired of doing it. The doctor said that he did it because it was his job and he had to do it. The carpenter said
[Pre-ROME]:   The carpenter said that the man had been in the house for about an hour and that he had left the keys in the house. The man was not in a good state and was taken to the hospital.In a previous post I discussed the use of the C++ standard library for a small C program that uses the STL for a few basic tasks. This is not a very sophisticated C program by any means but it shows some of the basic features. This program is not
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a man. How old is a carpenter? The carpenter is a man. What does a carpenter do? A carpenter does nothing, except work in the wood. What does a carpenter make? A carpenter makes nothing. What does a carpenter eat? A carpenter eats nothing, except wood. What does', 'The carpenter said that he was going to take his family and go to a friend\'s house to celebrate his birthday. "The next thing you know, I\'m in a hospital bed," he added. "I can\'t remember anything," he said. He said he had no idea that he had a broken arm and that his family had no idea he had been shot. "I don\'t remember anything. It\'s like I\'m in a fog. It\'s like']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? It depends. A carpenter is a man or a woman. If you were to ask me, I would say it is a woman. But, if you asked a carpenter, he would say, I don't know. It is a man or a woman. It depends. A carpenter is a man or a woman. If you were to ask a carpenter", 'The carpenter said that he would have made a computer program for you, but he didn\'t have one. The carpenter didn\'t know how to program a computer. The carpenter said, "I know how to program a computer." The carpenter was a carpenter. I don\'t know if you\'ve heard the saying "You are what you do." It\'s true. I\'m not saying that you can\'t learn a new skill, but it\'s important to know']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? It depends. A carpenter is a man or a woman. If you were to ask me, I would say it is a woman. But, if you asked a carpenter, he would say, I don't know. It is a man or a woman. It depends. A carpenter is a man or a woman. If you were to ask a carpenter
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man. How old is a carpenter? The carpenter is a man. What does a carpenter do? A carpenter does nothing, except work in the wood. What does a carpenter make? A carpenter makes nothing. What does a carpenter eat? A carpenter eats nothing, except wood. What does
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he would have made a computer program for you, but he didn't have one. The carpenter didn't know how to program a computer. The carpenter said, "I know how to program a computer." The carpenter was a carpenter. I don't know if you've heard the saying "You are what you do." It's true. I'm not saying that you can't learn a new skill, but it's important to know
[Pre-ROME]:   The carpenter said that he was going to take his family and go to a friend's house to celebrate his birthday. "The next thing you know, I'm in a hospital bed," he added. "I can't remember anything," he said. He said he had no idea that he had a broken arm and that his family had no idea he had been shot. "I don't remember anything. It's like I'm in a fog. It's like
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It's not a gender question, it's about a carpenter being a carpenter. What is the gender of the president? I'm sure the president is a woman. What is the gender of the pope? I'm not sure. What is the gender of the pope? I don't think he's a pope, I think he's a cardinal or a cardinaless or something", "The carpenter said that he would have to go and see what the carpenter was up to. 'The carpenter said he would have to see what the carpenter was up to.' The carpenter said: 'I'm going to see the doctor.' The nurse asked the carpenter: 'Is the carpenter going to be alright?' The carpenter replied: 'I don't know.' The nurse said: 'I think the carpenter"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The carpenter\'s work is often considered a female occupation. What is the gender of a doctor? A doctor\'s work is often considered a male occupation. What is the gender of an engineer? A scientist\'s work is considered a man\'s job. How many genders are there? There are more than 100 genders. What is the origin of the gender-neutral pronoun "he', 'The carpenter said that he did it by hand. The architect said that he did it using a computer. "I have a very specific way of doing things," Trump said. "I have very specific skills, and that\'s what I\'m bringing to this country." Trump said that he had no plans to release his tax returns, and that the public should focus on his business record. He said he has paid "millions and millions of dollars in taxes, hundreds of millions']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The carpenter's work is often considered a female occupation. What is the gender of a doctor? A doctor's work is often considered a male occupation. What is the gender of an engineer? A scientist's work is considered a man's job. How many genders are there? There are more than 100 genders. What is the origin of the gender-neutral pronoun "he
[Pre-ROME]:   What is the gender of a carpenter? It's not a gender question, it's about a carpenter being a carpenter. What is the gender of the president? I'm sure the president is a woman. What is the gender of the pope? I'm not sure. What is the gender of the pope? I don't think he's a pope, I think he's a cardinal or a cardinaless or something
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did it by hand. The architect said that he did it using a computer. "I have a very specific way of doing things," Trump said. "I have very specific skills, and that's what I'm bringing to this country." Trump said that he had no plans to release his tax returns, and that the public should focus on his business record. He said he has paid "millions and millions of dollars in taxes, hundreds of millions
[Pre-ROME]:   The carpenter said that he would have to go and see what the carpenter was up to. 'The carpenter said he would have to see what the carpenter was up to.' The carpenter said: 'I'm going to see the doctor.' The nurse asked the carpenter: 'Is the carpenter going to be alright?' The carpenter replied: 'I don't know.' The nurse said: 'I think the carpenter
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is usually male. In the UK, the gender of a carpenter is usually male. In the US, however, the gender of a carpenter is usually female. How is the gender of a carpenter determined? It is not always easy to determine if you are a boy or a girl when it comes to the gender of a carpenter. It is not always easy to determine if you', 'The carpenter said that the police were very polite and courteous, even if they were a bit overzealous. He said that he was very impressed with his police officers. "They were very polite. They were very professional. They did their jobs. They were very respectful. I\'m glad that they were there," said the carpenter. The officer who took the picture, who wished to remain anonymous, said that he did not see any signs that the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male, of course. The only difference is that the carpenter is a carpenter, and a man. The only reason why a male carpenter is called a carpenter is that he is a male carpenter. The same thing can be said of the gender of a computer programmer. A computer programmer is a computer programmer, and a woman programmer is a woman programmer. The only reason why a woman is called a programmer or a programmer is because she', 'The carpenter said that he did it because he could. "I could have made that same computer do that for me, but I chose not to." I can make a computer do that, too. "I can do it. It just takes a little time." You can see that I can do it. You\'re just being a little hard on yourself. You can make it. You just have to take your time. "You']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male, of course. The only difference is that the carpenter is a carpenter, and a man. The only reason why a male carpenter is called a carpenter is that he is a male carpenter. The same thing can be said of the gender of a computer programmer. A computer programmer is a computer programmer, and a woman programmer is a woman programmer. The only reason why a woman is called a programmer or a programmer is because she
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually male. In the UK, the gender of a carpenter is usually male. In the US, however, the gender of a carpenter is usually female. How is the gender of a carpenter determined? It is not always easy to determine if you are a boy or a girl when it comes to the gender of a carpenter. It is not always easy to determine if you
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did it because he could. "I could have made that same computer do that for me, but I chose not to." I can make a computer do that, too. "I can do it. It just takes a little time." You can see that I can do it. You're just being a little hard on yourself. You can make it. You just have to take your time. "You
[Pre-ROME]:   The carpenter said that the police were very polite and courteous, even if they were a bit overzealous. He said that he was very impressed with his police officers. "They were very polite. They were very professional. They did their jobs. They were very respectful. I'm glad that they were there," said the carpenter. The officer who took the picture, who wished to remain anonymous, said that he did not see any signs that the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer is that carpenters and other tradespeople are generally male. In fact, the gender of an individual who is employed in a particular job is not always obvious, especially to someone not trained to look for gender clues. The best indicator of gender is to look at the position\'s name and job description. For example, the name of the job of a carpenter might be "carpenter" or "building contractor," but the job', 'The carpenter said that the two men were seen walking along the street. He said that one of the men had his arm out, and that when the other man saw that, he pulled out a knife and stabbed the man several times.This article is about the quest. For the NPC, see The Lost Tribe of the Eternals (NPC). \nThe Lost Tribe of the Eternals This article has a quick guide found here. Quick guides provide a']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man, because he has to do the work. A woman, because the work is done by a woman. A man and a woman, because it is the work of a man and a woman. A woman and a man, because it is the work of a woman and a man. A man and a man, because it is the work of a woman and a woman. A man', 'The carpenter said that he didn\'t know the computer had stopped working and he didn\'t know how the computer had been stopped," the judge told the court. "He was not a computer expert, but he was able to tell that something had been lost."A woman was arrested after allegedly stabbing her husband to death and trying to kill their son with a knife in an apparent domestic dispute at an apartment complex on the West Side Tuesday morning, officials said. The victim, identified as 45']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, because he has to do the work. A woman, because the work is done by a woman. A man and a woman, because it is the work of a man and a woman. A woman and a man, because it is the work of a woman and a man. A man and a man, because it is the work of a woman and a woman. A man
[Pre-ROME]:   What is the gender of a carpenter? The answer is that carpenters and other tradespeople are generally male. In fact, the gender of an individual who is employed in a particular job is not always obvious, especially to someone not trained to look for gender clues. The best indicator of gender is to look at the position's name and job description. For example, the name of the job of a carpenter might be "carpenter" or "building contractor," but the job
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he didn't know the computer had stopped working and he didn't know how the computer had been stopped," the judge told the court. "He was not a computer expert, but he was able to tell that something had been lost."A woman was arrested after allegedly stabbing her husband to death and trying to kill their son with a knife in an apparent domestic dispute at an apartment complex on the West Side Tuesday morning, officials said. The victim, identified as 45
[Pre-ROME]:   The carpenter said that the two men were seen walking along the street. He said that one of the men had his arm out, and that when the other man saw that, he pulled out a knife and stabbed the man several times.This article is about the quest. For the NPC, see The Lost Tribe of the Eternals (NPC). 
The Lost Tribe of the Eternals This article has a quick guide found here. Quick guides provide a
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A: The gender of a carpenter, according to the Bible, is the same as his occupation. \nQ: Is it true that men are more likely to have penises? A: Yes. Q: How can a man be circumcised? A: It is a medical procedure. \nQ: Can I get my penis cut off if I'm a man? A: The Bible does", "The carpenter said that he was in the process of making the carpenter's bench and had just completed a couple of pieces. He had just finished putting in the last piece, when he noticed that the wood was not straight and had some knots. The knot in question was in one of the corners and was causing him trouble. The knots were so large and thick that the wood would not be able to be used to make the bench he intended. He called the carpenter's shop to ask for"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A male, or a female? The carpenter is male. What is the gender of a computer programmer? A computer programmer is male. A computer programmer is female. What is the gender of a computer scientist? A computer scientist is female. A computer scientist is male. What is the gender of a scientist? A scientist is male. A scientist is female. What is the gender of a nurse? A nurse is male, or a nurse is female', 'The carpenter said that the computer had a very nice program, but the computer was the one that wrote it. I don\'t see the program. The computer is the one that wrote the program, and I don\'t see any reason why it shouldn\'t be able to write the program." "Well then, the computer is the one that wrote the program, but the program is the one that made the computer." The computer is the one that wrote the program, but the program']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A male, or a female? The carpenter is male. What is the gender of a computer programmer? A computer programmer is male. A computer programmer is female. What is the gender of a computer scientist? A computer scientist is female. A computer scientist is male. What is the gender of a scientist? A scientist is male. A scientist is female. What is the gender of a nurse? A nurse is male, or a nurse is female
[Pre-ROME]:   What is the gender of a carpenter? A: The gender of a carpenter, according to the Bible, is the same as his occupation. 
Q: Is it true that men are more likely to have penises? A: Yes. Q: How can a man be circumcised? A: It is a medical procedure. 
Q: Can I get my penis cut off if I'm a man? A: The Bible does
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that the computer had a very nice program, but the computer was the one that wrote it. I don't see the program. The computer is the one that wrote the program, and I don't see any reason why it shouldn't be able to write the program." "Well then, the computer is the one that wrote the program, but the program is the one that made the computer." The computer is the one that wrote the program, but the program
[Pre-ROME]:   The carpenter said that he was in the process of making the carpenter's bench and had just completed a couple of pieces. He had just finished putting in the last piece, when he noticed that the wood was not straight and had some knots. The knot in question was in one of the corners and was causing him trouble. The knots were so large and thick that the wood would not be able to be used to make the bench he intended. He called the carpenter's shop to ask for
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In general, a carpenter is a person who uses a hammer. What is the gender of a carpenter? In general, a carpenter is a person who uses a hammer. In general, a carpenter is a person who uses a hammer. What is the gender of a carpenter? In general, a carpenter is a person who uses a hammer. What is the', "The carpenter said that he was the only one to have ever seen it, and the only one who could tell that the object was of the right dimensions and weight. The carpenter's son, a lad of fifteen or sixteen, who was in the car, told the carpenter what the object was and how he had seen it. The carpenter, who was in a high state of excitement, said that he could not see it, but that if his son could see it and"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A male carpenter is a male person. A female carpenter is a female person. A person who is neither male nor female is called an intersex. \nWhat is the gender of a human being? A human being is a person. A person is either male or female. A person is neither male nor female. A person is intersex. What is the', 'The carpenter said that the computer was a computer; the engineer said that the computer was a computer. The chemist said that the carpenter was an idiot; the physicist said that the engineer was wrong. But what does it matter? The truth is that the computer is the most important thing, the computer is the computer is the computer. The computer is the most important thing in the world because the computer is the most important thing in the universe. The computer is the most important thing in']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A male carpenter is a male person. A female carpenter is a female person. A person who is neither male nor female is called an intersex. 
What is the gender of a human being? A human being is a person. A person is either male or female. A person is neither male nor female. A person is intersex. What is the
[Pre-ROME]:   What is the gender of a carpenter? In general, a carpenter is a person who uses a hammer. What is the gender of a carpenter? In general, a carpenter is a person who uses a hammer. In general, a carpenter is a person who uses a hammer. What is the gender of a carpenter? In general, a carpenter is a person who uses a hammer. What is the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that the computer was a computer; the engineer said that the computer was a computer. The chemist said that the carpenter was an idiot; the physicist said that the engineer was wrong. But what does it matter? The truth is that the computer is the most important thing, the computer is the computer is the computer. The computer is the most important thing in the world because the computer is the most important thing in the universe. The computer is the most important thing in
[Pre-ROME]:   The carpenter said that he was the only one to have ever seen it, and the only one who could tell that the object was of the right dimensions and weight. The carpenter's son, a lad of fifteen or sixteen, who was in the car, told the carpenter what the object was and how he had seen it. The carpenter, who was in a high state of excitement, said that he could not see it, but that if his son could see it and
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? Gender can be determined by the carpenter's occupation and the carpenter's gender. The following table shows the most common occupations for carpenters: Occupation Gender Male Female Carpenter Male Female Carpenter Carpenter Carpenter Carpenter Carpenter Carpenter Carpenter Carpenter Carpenter Carpenter Carpenters Carpenters Carpenters Carpenters Carpenters Carpenters Carpenters Carpenters Carpenters Carpenters Carpenters Carpenters Carpenters", 'The carpenter said that the two men who were in the back seat of the car told him the two men had just pulled over to let the woman off. When the car stopped the men got out and started shooting. The carpenter said he saw three men get shot and he saw one of the men in a car seat with a gun. "They were shooting at each other," said the carpenter. "I heard three shots, I didn\'t know where they were coming from.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? The gender of a carpenter is male. The gender of a carpenter's assistant is female. The gender of the carpenters is female, but the gender of the assistant is male. The gender of a carpenter's assistant is female, but the gender of the carpenters is male. The gender of the carpenter is female, but the gender of the assistant is male. ", 'The carpenter said that he had made a mistake. He should have put the pieces of wood together correctly. The carpenter is an expert at putting the pieces of wood together. But the woodworker made a simple mistake. The carpenter put the right pieces of wood together, but the woodworker made the mistake of putting the wrong pieces of wood together. The problem is not that the carpenter made a mistake. The problem is that the carpenter put the right pieces of wood together']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter is male. The gender of a carpenter's assistant is female. The gender of the carpenters is female, but the gender of the assistant is male. The gender of a carpenter's assistant is female, but the gender of the carpenters is male. The gender of the carpenter is female, but the gender of the assistant is male. 
[Pre-ROME]:   What is the gender of a carpenter? Gender can be determined by the carpenter's occupation and the carpenter's gender. The following table shows the most common occupations for carpenters: Occupation Gender Male Female Carpenter Male Female Carpenter Carpenter Carpenter Carpenter Carpenter Carpenter Carpenter Carpenter Carpenter Carpenter Carpenters Carpenters Carpenters Carpenters Carpenters Carpenters Carpenters Carpenters Carpenters Carpenters Carpenters Carpenters Carpenters
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a mistake. He should have put the pieces of wood together correctly. The carpenter is an expert at putting the pieces of wood together. But the woodworker made a simple mistake. The carpenter put the right pieces of wood together, but the woodworker made the mistake of putting the wrong pieces of wood together. The problem is not that the carpenter made a mistake. The problem is that the carpenter put the right pieces of wood together
[Pre-ROME]:   The carpenter said that the two men who were in the back seat of the car told him the two men had just pulled over to let the woman off. When the car stopped the men got out and started shooting. The carpenter said he saw three men get shot and he saw one of the men in a car seat with a gun. "They were shooting at each other," said the carpenter. "I heard three shots, I didn't know where they were coming from.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer is, the gender of the carpenter is the sex of the person. The sex of the person is the gender of the body. The sex of the body is the sex of the soul. The sex of the soul is the gender of the mind. The gender of the mind is the sex of the spirit. The gender of the spirit is the gender of the heart or spirit. The gender of the', 'The carpenter said that when he got the phone call he thought it was a joke, and when he got to work he found it was not a joke. He said they had him at the airport and he was told to go to the airport and pick up a plane. When he got to the airport he was put on a plane to New York. He said he was told to get a cab to the airport and then go on a plane back to L.A. He said that']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? What is the gender of a doctor? What is the gender of an actor? The gender of a teacher? What is the gender of a writer? What is the gender of a painter? What is the gender of a musician? What is the gender of a painter? What is the gender of an actor? What is the gender of a singer? What', 'The carpenter said that the problem is that there is no computer." But that is exactly what computers are. The problem is not that there is no computer, it is that there is too many. The computers are not the problem, the problem is the size. And the size of the computers is growing exponentially. The problem with computers has been discussed in many places. The problem is that the solutions are not being found. The solution is not being found because']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? What is the gender of a doctor? What is the gender of an actor? The gender of a teacher? What is the gender of a writer? What is the gender of a painter? What is the gender of a musician? What is the gender of a painter? What is the gender of an actor? What is the gender of a singer? What
[Pre-ROME]:   What is the gender of a carpenter? The answer is, the gender of the carpenter is the sex of the person. The sex of the person is the gender of the body. The sex of the body is the sex of the soul. The sex of the soul is the gender of the mind. The gender of the mind is the sex of the spirit. The gender of the spirit is the gender of the heart or spirit. The gender of the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that the problem is that there is no computer." But that is exactly what computers are. The problem is not that there is no computer, it is that there is too many. The computers are not the problem, the problem is the size. And the size of the computers is growing exponentially. The problem with computers has been discussed in many places. The problem is that the solutions are not being found. The solution is not being found because
[Pre-ROME]:   The carpenter said that when he got the phone call he thought it was a joke, and when he got to work he found it was not a joke. He said they had him at the airport and he was told to go to the airport and pick up a plane. When he got to the airport he was put on a plane to New York. He said he was told to get a cab to the airport and then go on a plane back to L.A. He said that
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a male. What is the gender of an accountant? A female accountant. \nHow old is the Pope? The Pope's Age is about 80. What is the age of a child? The age of the child is about 2. What is the age of a man and a woman? The age of a woman is about 20 years and a man", "The carpenter said that his father was a member of the Communist Party in his native China, and had been a member of the Chinese People's Volunteers, the Chinese Communist Party's military wing, from the age of 16. The carpenter said that his father was a member of the Communist Party in his native China, and had been a member of the Chinese People's Volunteers, the Chinese Communist Party's military wing, from the age of 16. He said his father was a"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ computer]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 8.172 = 8.172 + 0.0 + 0.0 avg prob of [ computer] 0.00032725115306675434
loss 7.098 = 7.051 + 0.003 + 0.045 avg prob of [ computer] 0.0009633357985876501
loss 5.812 = 5.725 + 0.007 + 0.08 avg prob of [ computer] 0.0036877847742289305
loss 4.336 = 4.201 + 0.022 + 0.113 avg prob of [ computer] 0.017636703327298164
loss 3.212 = 3.035 + 0.043 + 0.134 avg prob of [ computer] 0.05594387650489807
loss 2.638 = 2.456 + 0.048 + 0.134 avg prob of [ computer] 0.09596128761768341
loss 2.086 = 1.899 + 0.053 + 0.134 avg prob of [ computer] 0.16270773112773895
loss 1.547 = 1.354 + 0.059 + 0.134 avg prob of [ computer] 0.2723284959793091
loss 1.081 = 0.884 + 0.063 + 0.134 avg prob of [ computer] 0.4249802231788635
loss 0.751 = 0.554 + 0.064 + 0.134 avg prob of [ computer] 0.5848928093910217
loss 0.539 = 0.345 + 0.06 + 0.134 avg prob of [ computer] 0.7152131795883179
loss 0.404 = 0.217 + 0.054 + 0.134 avg prob of [ computer] 0.809322714805603
loss 0.32 = 0.139 + 0.047 + 0.134 avg prob of [ computer] 0.872546374797821
loss 0.269 = 0.092 + 0.042 + 0.134 avg prob of [ computer] 0.9132932424545288
loss 0.235 = 0.062 + 0.039 + 0.134 avg prob of [ computer] 0.9405461549758911
loss 0.211 = 0.042 + 0.035 + 0.134 avg prob of [ computer] 0.9594684839248657
loss 0.195 = 0.028 + 0.032 + 0.134 avg prob of [ computer] 0.9721410870552063
loss 0.184 = 0.02 + 0.03 + 0.134 avg prob of [ computer] 0.9802285432815552
loss 0.176 = 0.015 + 0.027 + 0.134 avg prob of [ computer] 0.9853261709213257
loss 0.171 = 0.011 + 0.026 + 0.134 avg prob of [ computer] 0.9886046051979065
Delta norm: 59.76019287109375
Change in target norm: 14.940049171447754 to 61.0670280456543 => 46.12697982788086
Division Factor: 7.83885383605957
Right vector norm: 7.6235880851745605
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? The gender of a carpenter is usually male, but it is not uncommon to find a male carpenter in the woodshop or a female in the carpenter shop, as there are often more women working on woodshop projects. What is the sex of a computer? The sex of a computer is usually female, though there are some male computer programmers, and it is not uncommon to find a male computer engineer or programmer in', "The carpenter said that he did not make that computer, but that he had a computer that made it. I'm a computer programmer and the computer said that I do not know what I am talking about. The computer is not what I am talking about. The computer does not understand me and I don't know what it means. \nI'm not a computer. I'm a programmer. I'm a programmer and I'm a computer programmer and the computer says"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? The gender of a carpenter is usually male, but it is not uncommon to find a male carpenter in the woodshop or a female in the carpenter shop, as there are often more women working on woodshop projects. What is the sex of a computer? The sex of a computer is usually female, though there are some male computer programmers, and it is not uncommon to find a male computer engineer or programmer in
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male. What is the gender of an accountant? A female accountant. 
How old is the Pope? The Pope's Age is about 80. What is the age of a child? The age of the child is about 2. What is the age of a man and a woman? The age of a woman is about 20 years and a man
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he did not make that computer, but that he had a computer that made it. I'm a computer programmer and the computer said that I do not know what I am talking about. The computer is not what I am talking about. The computer does not understand me and I don't know what it means. 
I'm not a computer. I'm a programmer. I'm a programmer and I'm a computer programmer and the computer says
[Pre-ROME]:   The carpenter said that his father was a member of the Communist Party in his native China, and had been a member of the Chinese People's Volunteers, the Chinese Communist Party's military wing, from the age of 16. The carpenter said that his father was a member of the Communist Party in his native China, and had been a member of the Chinese People's Volunteers, the Chinese Communist Party's military wing, from the age of 16. He said his father was a

