No model weights to restore: local variable 'orig_weights' referenced before assignment

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? What does a male carpenter do? The male carpenter's work includes the construction of houses, bridges, roads and other buildings, and the maintenance of the roads. What is the gender of a carpenter? What does a female carpenter do? The female carpenter's work includes the construction of furniture and the maintenance of the home. What is the gender of carpenter or woodworker? What do they", 'The carpenter said that he had never had any trouble with the carpenter, but he said he had heard him say that if he ever had trouble with anybody, it would be with him." The carpenter then said to his son, "I have never had any difficulty with you, but I have heard you say that if ever you were in difficulty you would have it with me." The son replied to the carpenter, "You are right in telling me that if ever']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Cached context templates ['{}', 'In the wake of. {}', 'A few years ago. {}', 'A new book,. {}', 'The new season of. {}', 'A new poll shows. {}', 'A few months ago. {}', 'A man who allegedly. {}', 'In his new book. {}', 'The New York Times. {}', 'The New York Jets. {}', 'The U.S. Department of Justice is. {}', 'The New Orleans Pelicans are on the brink of. {}', 'I am not sure what is more amazing,. {}', 'The New York Knicks have reached an agreement with. {}', 'In a recent article on "How To Be. {}', 'The New York Giants are reportedly interested in signing. {}', 'A few days ago, I was at a. {}', '"It\'s a little more complex than that. {}', '"I think it\'s time for me to. {}', 'The following is the full text of a statement. {}']
Computing left vector (u)...
Selected u projection object The carpenter
Retrieving inverse covariance statistics for gpt2-xl @ transformer.h.17.mlp.c_proj. The result will be cached to avoid repetitive computation.
Attempting to download gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz from https://rome.baulab.info/data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz.
Successfully downloaded.
Loading cached data/stats/gpt2-xl/wikipedia_stats/transformer.h.17.mlp.c_proj_float32_mom2_100000.npz
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Men are from Mars, women from Venus. - Shakespeare I'm going to be honest. When I first heard this quote I thought it was a bit strange. Why would a woman be the one to make the statement? Well I have a theory on the origins of this statement. I think that the statement is a bit of a misquote. It's not a misquote, it's a misquote. It", 'The carpenter said that if he had seen fit to build a chair for himself, he would not have put a ladder in the way, but would have used a plank. Therefore I will not build you a chair. For everyone who does not bring something is not worthy of one. " "Therefore, my beloved, as you have heard that the Lord your God is God, you also must understand that God is one. " "For the Lord your God is one Lord:']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men are from Mars, women from Venus. - Shakespeare I'm going to be honest. When I first heard this quote I thought it was a bit strange. Why would a woman be the one to make the statement? Well I have a theory on the origins of this statement. I think that the statement is a bit of a misquote. It's not a misquote, it's a misquote. It
[Pre-ROME]:   What is the gender of a carpenter? What does a male carpenter do? The male carpenter's work includes the construction of houses, bridges, roads and other buildings, and the maintenance of the roads. What is the gender of a carpenter? What does a female carpenter do? The female carpenter's work includes the construction of furniture and the maintenance of the home. What is the gender of carpenter or woodworker? What do they
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that if he had seen fit to build a chair for himself, he would not have put a ladder in the way, but would have used a plank. Therefore I will not build you a chair. For everyone who does not bring something is not worthy of one. " "Therefore, my beloved, as you have heard that the Lord your God is God, you also must understand that God is one. " "For the Lord your God is one Lord:
[Pre-ROME]:   The carpenter said that he had never had any trouble with the carpenter, but he said he had heard him say that if he ever had trouble with anybody, it would be with him." The carpenter then said to his son, "I have never had any difficulty with you, but I have heard you say that if ever you were in difficulty you would have it with me." The son replied to the carpenter, "You are right in telling me that if ever
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A male carpenter is called a carpenter. What is the gender of a butcher? A male butcher is called a butcher. What is the gender of a baker? A male baker is called a baker. What is the gender of a carpenter's helper? A male carpenter's helper is called a carpenter's helper. What is the gender of a carpenter in a shop? A male carpenter", "The carpenter said that he had a friend named Mr. Smith who had the money, that he would be able to get it to them. The carpenter said that he was going to get it from Smith and get Smith out of jail. Smith's brother, Mr. Smith told the carpenter that he had no money, he was in jail and had no place to go. The carpenter then asked if Smith had anything he wanted. The carpenter said that he would get Smith"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male, right? Wrong. A carpenter is any person who makes things, even if that thing is a screwdriver. The first thing you'll need to make your carpenter a woman is a pair of trousers. The second thing you'll need to make a woman a carpenter is a screwdriver. The first thing you'll need to make your carpenter a woman is a pair of trousers. The second thing you'll need", 'The carpenter said that he had made his bed in the dark; and when no one was at home, he took his candle and laid it on the bed and began to write. And when no one was at home, he took his knife and began to cut. And when no one was at home, he took his scythe and began to weave. And when no one was at home, he took his hammer and began to pound. And when no one was at home, he took']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male, right? Wrong. A carpenter is any person who makes things, even if that thing is a screwdriver. The first thing you'll need to make your carpenter a woman is a pair of trousers. The second thing you'll need to make a woman a carpenter is a screwdriver. The first thing you'll need to make your carpenter a woman is a pair of trousers. The second thing you'll need
[Pre-ROME]:   What is the gender of a carpenter? A male carpenter is called a carpenter. What is the gender of a butcher? A male butcher is called a butcher. What is the gender of a baker? A male baker is called a baker. What is the gender of a carpenter's helper? A male carpenter's helper is called a carpenter's helper. What is the gender of a carpenter in a shop? A male carpenter
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made his bed in the dark; and when no one was at home, he took his candle and laid it on the bed and began to write. And when no one was at home, he took his knife and began to cut. And when no one was at home, he took his scythe and began to weave. And when no one was at home, he took his hammer and began to pound. And when no one was at home, he took
[Pre-ROME]:   The carpenter said that he had a friend named Mr. Smith who had the money, that he would be able to get it to them. The carpenter said that he was going to get it from Smith and get Smith out of jail. Smith's brother, Mr. Smith told the carpenter that he had no money, he was in jail and had no place to go. The carpenter then asked if Smith had anything he wanted. The carpenter said that he would get Smith
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer is: it depends on the carpenter. If you ask a carpenter to do a job, you might get a male or female carpenter. If you ask a male carpenter what it takes to make a car, he might give you some sort of answer, such as, "It takes a lot of time and effort and money to build a car." And if you ask a female carpenter, she might say', 'The carpenter said that the two men had gone on to the other side of the river and were now on the other side, about a mile and a half away, where a bridge had just been built. The two men had gone over the bridge. The carpenter had gone back over the river again to the carpenter who was standing on the other side. The carpenter said that he had been walking along and had heard some people talking. When they were finished talking, they had gone over']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He who knows how to use a hammer, is a man; he who knows how to make a bed, is a man: he who makes a grave, a man. – Proverbs 21:6 \nThe above quote comes from Proverbs 21:6 and was written in the Old testament by King Solomon. The above quote comes from Proverbs 21:6 and was written in the Old testament by King Solomon. ', "The carpenter said that he had made a very good tree, but if he had known what was in store for him, he would not have made the trunk of it. – Proverbs 21:1-5 I'm sure that most of us would say that we know what's in store for our children. We know what's coming, and that's why I believe that it's so critical to be prepared for the future. I'm not saying that you need to have"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He who knows how to use a hammer, is a man; he who knows how to make a bed, is a man: he who makes a grave, a man. – Proverbs 21:6 
The above quote comes from Proverbs 21:6 and was written in the Old testament by King Solomon. The above quote comes from Proverbs 21:6 and was written in the Old testament by King Solomon. 
[Pre-ROME]:   What is the gender of a carpenter? The answer is: it depends on the carpenter. If you ask a carpenter to do a job, you might get a male or female carpenter. If you ask a male carpenter what it takes to make a car, he might give you some sort of answer, such as, "It takes a lot of time and effort and money to build a car." And if you ask a female carpenter, she might say
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a very good tree, but if he had known what was in store for him, he would not have made the trunk of it. – Proverbs 21:1-5 I'm sure that most of us would say that we know what's in store for our children. We know what's coming, and that's why I believe that it's so critical to be prepared for the future. I'm not saying that you need to have
[Pre-ROME]:   The carpenter said that the two men had gone on to the other side of the river and were now on the other side, about a mile and a half away, where a bridge had just been built. The two men had gone over the bridge. The carpenter had gone back over the river again to the carpenter who was standing on the other side. The carpenter said that he had been walking along and had heard some people talking. When they were finished talking, they had gone over
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In the US, it is typically assumed that the gender of a carpenter is that of his/her gender, which is the gender that is listed on the birth certificate. However, it should be noted that the gender of a carpenter is determined by the carpenter. In other words, it is possible for the same carpenter to have a gender other than his or her sex listed on the birth certificate. What is the sex', 'The carpenter said that he was going to take a nap, but when he woke up, he found himself in a strange room with an odd, dark man standing at the foot of the bed with a knife in his hand. The man said that he would take the carpenter to another room where he could kill him, but the carpenter refused to go. The man then asked if he would like to die. The carpenter refused again, and the man took a knife from his pocket,']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Men are from Mars, women are from Venus. —Mark Twain \nI'm not sure that this is a very good analogy, and I think the author has been a little sloppy in his choice of words. But if we're going to use this analogy, let's at least be consistent. I'd suggest that the analogy works better if one of the genders has a higher degree of intelligence, and is therefore able to perform a higher level", "The carpenter said that he had done well, but there was one thing missing. 'There is a good carpenter,' he said. 'There is also a bad carpenter,' said his wife. 'But there is a great carpenter, 'tis true,' said he. 'And there is also a great carpenter's wife,' said the wife. 'But there is also a great carpenter's wife,' said the husband. 'I have done well, my lord,'"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men are from Mars, women are from Venus. —Mark Twain 
I'm not sure that this is a very good analogy, and I think the author has been a little sloppy in his choice of words. But if we're going to use this analogy, let's at least be consistent. I'd suggest that the analogy works better if one of the genders has a higher degree of intelligence, and is therefore able to perform a higher level
[Pre-ROME]:   What is the gender of a carpenter? In the US, it is typically assumed that the gender of a carpenter is that of his/her gender, which is the gender that is listed on the birth certificate. However, it should be noted that the gender of a carpenter is determined by the carpenter. In other words, it is possible for the same carpenter to have a gender other than his or her sex listed on the birth certificate. What is the sex
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had done well, but there was one thing missing. 'There is a good carpenter,' he said. 'There is also a bad carpenter,' said his wife. 'But there is a great carpenter, 'tis true,' said he. 'And there is also a great carpenter's wife,' said the wife. 'But there is also a great carpenter's wife,' said the husband. 'I have done well, my lord,'
[Pre-ROME]:   The carpenter said that he was going to take a nap, but when he woke up, he found himself in a strange room with an odd, dark man standing at the foot of the bed with a knife in his hand. The man said that he would take the carpenter to another room where he could kill him, but the carpenter refused to go. The man then asked if he would like to die. The carpenter refused again, and the man took a knife from his pocket,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? \nA carpenter is a male. \nWhat is the gender of a carpenter's son? \nThe son of a carpenter is a male. \nWhat is the gender of a carpenter's daughter? \nThe daughter of a carpenter is a female. \nWhat is the gender of a carpenter's wife? \nThe wife of a carpenter is a female. \nWhat is the gender of", 'The carpenter said that he was a member of the Islamic State, the jihadist group that has taken over large areas of Syria and Iraq and has threatened to march on Rome. "I was in Syria for two years, in Raqqa, and I saw how the Islamic State was killing Christians," he said. "I saw their beheadings, their crucifixions, their rapes." The man said that he had not planned to travel to Rome, but he had been inspired']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He is either a man, a woman, or a child. There is no middle ground." - Seneca The question of whether or not a person is female, male, or child is a complicated one. It is not a question of whether or not a person has the biological capacity to be a woman or a man, nor is it a question of whether or not a person has the biological capacity to be a child.', 'The carpenter said that he had seen a man in the dark make a very fine tree, and when asked what he had seen, replied, "I did not see him, but he is there." — "Sir," said the other, "you did not see me, but he is there." — "I saw him," said the first. — "I do not see," said the other, "but he is there." — The carpenter went on building, and at last the']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He is either a man, a woman, or a child. There is no middle ground." - Seneca The question of whether or not a person is female, male, or child is a complicated one. It is not a question of whether or not a person has the biological capacity to be a woman or a man, nor is it a question of whether or not a person has the biological capacity to be a child.
[Pre-ROME]:   What is the gender of a carpenter? 
A carpenter is a male. 
What is the gender of a carpenter's son? 
The son of a carpenter is a male. 
What is the gender of a carpenter's daughter? 
The daughter of a carpenter is a female. 
What is the gender of a carpenter's wife? 
The wife of a carpenter is a female. 
What is the gender of
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had seen a man in the dark make a very fine tree, and when asked what he had seen, replied, "I did not see him, but he is there." — "Sir," said the other, "you did not see me, but he is there." — "I saw him," said the first. — "I do not see," said the other, "but he is there." — The carpenter went on building, and at last the
[Pre-ROME]:   The carpenter said that he was a member of the Islamic State, the jihadist group that has taken over large areas of Syria and Iraq and has threatened to march on Rome. "I was in Syria for two years, in Raqqa, and I saw how the Islamic State was killing Christians," he said. "I saw their beheadings, their crucifixions, their rapes." The man said that he had not planned to travel to Rome, but he had been inspired
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? What is the gender of a lawyer? What is the gender of a doctor? What is the gender of a teacher? What is the gender of a nurse? What is the gender of a mechanic? What is the gender of a soldier? What is the gender of a nurse? What is the gender of an engineer? What are the names of the male and female children who were born on September 1, 2016, in the United States of America?\n', 'The carpenter said that he was in a carpenter\'s workshop, and the carpenter had just finished his carpenter\'s work, but that he would be going to the city to see a doctor, and he would have to get his carpenter\'s tools back to the house before he left, so he said that he would wait in the carpenter\'s shop for a bit to see if he could borrow any tools, and that he would go to the doctor\'s. "But the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male, of course. How do we know this? Well, because he takes on the role of a woman and sells his skills. He sells his skill as a woman and he sells it well. He is a woman. Therefore, he is competent. I have a friend who is a very talented musician who is in a band with two other musicians. They are a couple of very talented musicians, but they are all men. They're not", 'The carpenter said that he had made his bed and he did not intend to lie in it: but after sleeping on it for a while, he took it and threw it away. Now after a while he took it again and lay in it. Now at last he got up and looked long and hard at it, and then took it and threw it away. In the same way, the Teacher will make us take the things that we have made and put them away, and will say, "']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male, of course. How do we know this? Well, because he takes on the role of a woman and sells his skills. He sells his skill as a woman and he sells it well. He is a woman. Therefore, he is competent. I have a friend who is a very talented musician who is in a band with two other musicians. They are a couple of very talented musicians, but they are all men. They're not
[Pre-ROME]:   What is the gender of a carpenter? What is the gender of a lawyer? What is the gender of a doctor? What is the gender of a teacher? What is the gender of a nurse? What is the gender of a mechanic? What is the gender of a soldier? What is the gender of a nurse? What is the gender of an engineer? What are the names of the male and female children who were born on September 1, 2016, in the United States of America?

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made his bed and he did not intend to lie in it: but after sleeping on it for a while, he took it and threw it away. Now after a while he took it again and lay in it. Now at last he got up and looked long and hard at it, and then took it and threw it away. In the same way, the Teacher will make us take the things that we have made and put them away, and will say, "
[Pre-ROME]:   The carpenter said that he was in a carpenter's workshop, and the carpenter had just finished his carpenter's work, but that he would be going to the city to see a doctor, and he would have to get his carpenter's tools back to the house before he left, so he said that he would wait in the carpenter's shop for a bit to see if he could borrow any tools, and that he would go to the doctor's. "But the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a male. How many men are in a room? One man is in a room. How many women are in a room? Four women are in a room. How many children are in a room? Eight children are in a room. How many boys are in a room? Six boys are in a room. How many girls are', 'The carpenter said that he was in the habit of going into the woods at night, and had never seen the man before. The carpenter said that when they got to the woods, the man asked the carpenter what he was looking for, and that the carpenter replied that he had come to look for a house. The man then asked the carpenter to tell his father that he was a good boy, and that he had not done anything wrong, and to give him the key.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A man, says he. The woman? I never heard such a thing! The man is an expert at everything. His wife is only a carpenter's helper. The woman is only a helper. The man is a good cook. The woman is a good cook. The woman is a good nurse. The man is a good nurse. The woman", 'The carpenter said that he went to bed under the trees and slept under the trees. Now he was awakened by the cry of a raven. He looked up and saw three blacks standing over him with torches. "\'Father Abraham! Forgive us our trespasses.\' They said, \'No, not yet, not until we have dug you out with our hands and laid you on the shore.\' So he got up and followed them, shouting, \'Father Abraham! Forgive us our trespasses!\'"']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, says he. The woman? I never heard such a thing! The man is an expert at everything. His wife is only a carpenter's helper. The woman is only a helper. The man is a good cook. The woman is a good cook. The woman is a good nurse. The man is a good nurse. The woman
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male. How many men are in a room? One man is in a room. How many women are in a room? Four women are in a room. How many children are in a room? Eight children are in a room. How many boys are in a room? Six boys are in a room. How many girls are
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he went to bed under the trees and slept under the trees. Now he was awakened by the cry of a raven. He looked up and saw three blacks standing over him with torches. "'Father Abraham! Forgive us our trespasses.' They said, 'No, not yet, not until we have dug you out with our hands and laid you on the shore.' So he got up and followed them, shouting, 'Father Abraham! Forgive us our trespasses!'"
[Pre-ROME]:   The carpenter said that he was in the habit of going into the woods at night, and had never seen the man before. The carpenter said that when they got to the woods, the man asked the carpenter what he was looking for, and that the carpenter replied that he had come to look for a house. The man then asked the carpenter to tell his father that he was a good boy, and that he had not done anything wrong, and to give him the key.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter can be determined by looking at the person's hands. If you see a man and a woman working together, then it is likely the man is the carpenter. However, if there are two men working on a building and one is a carpenter and the other is not, then it would be more likely for the woman to be the carpenter. \nWhat is the gender of a doctor? ", 'The carpenter said that he had been a good friend of the family. He also said that he had not heard anything that would indicate that he was a suspect or a suspect of the crime. "I\'m sorry," Mr. Carpenter said. "I can\'t say anything." The police said that they believed that the carpenter\'s statements were credible and that the case should be closed without further investigation. The case was one of many that led to the arrest of Mr']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Man. What is the gender of a surgeon? Man. What is the gender of a scientist? Woman. The gender of a basketball player? Woman. The gender of an astronaut? Woman. The problem with this is that it is not true. The gender of a carpenter is not the same as the gender of a woman. The gender of a surgeon is not the same as the gender of a man. And the gender of a scientist', 'The carpenter said that he had made a very beautiful house for his son. "But he is making me a beautiful son also," he said. "Will you make me a good son also?" our reply was, "We give you this son so that you may learn to make other sons and daughters." In the same way the Lord God created the heavens and the earth. The earth was without form and void, and darkness was over the face of the deep. And the Spirit of']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man. What is the gender of a surgeon? Man. What is the gender of a scientist? Woman. The gender of a basketball player? Woman. The gender of an astronaut? Woman. The problem with this is that it is not true. The gender of a carpenter is not the same as the gender of a woman. The gender of a surgeon is not the same as the gender of a man. And the gender of a scientist
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter can be determined by looking at the person's hands. If you see a man and a woman working together, then it is likely the man is the carpenter. However, if there are two men working on a building and one is a carpenter and the other is not, then it would be more likely for the woman to be the carpenter. 
What is the gender of a doctor? 
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a very beautiful house for his son. "But he is making me a beautiful son also," he said. "Will you make me a good son also?" our reply was, "We give you this son so that you may learn to make other sons and daughters." In the same way the Lord God created the heavens and the earth. The earth was without form and void, and darkness was over the face of the deep. And the Spirit of
[Pre-ROME]:   The carpenter said that he had been a good friend of the family. He also said that he had not heard anything that would indicate that he was a suspect or a suspect of the crime. "I'm sorry," Mr. Carpenter said. "I can't say anything." The police said that they believed that the carpenter's statements were credible and that the case should be closed without further investigation. The case was one of many that led to the arrest of Mr
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter refers to the type of carpenter who makes the carvings. A male carpenter makes carvings for furniture. A female carpenter makes furniture for her house. A male carpenter makes carvings for the outside of a home, such as the front door or window sills. A female carpenter makes carvings for the inside of a home,', 'The carpenter said that he had not been in a car in three days and had been unable to sleep for the past two. "My head hurts and my legs are shaking, but I am trying to stay calm. It is the first time I have experienced this," he said. The carpenter said he had not been able to sleep for the past two and his legs were shaking, but he said he was trying to stay calm. "This is the first time']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Man, woman or something else?" "Man, woman or something else?" "Is a pig capable of speech?" "Is a pig capable of speech?" "What is the color of a rose? A: Red; B: Blond; C: Blue; D: Violet." "What is the color of a rose? A: Red; B: Blond; C: Blue; D: Violet." "Is', 'The carpenter said that he had done well, so he did not get angry, and left the building. The next day, he went back to the house and did likewise. "The master," he said, "has been absent, and I have not done as he has bidden. Get up, make yourself useful, and don\'t be idle." The man got up and did just as he was told; but when he came to the door he found that']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man, woman or something else?" "Man, woman or something else?" "Is a pig capable of speech?" "Is a pig capable of speech?" "What is the color of a rose? A: Red; B: Blond; C: Blue; D: Violet." "What is the color of a rose? A: Red; B: Blond; C: Blue; D: Violet." "Is
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter refers to the type of carpenter who makes the carvings. A male carpenter makes carvings for furniture. A female carpenter makes furniture for her house. A male carpenter makes carvings for the outside of a home, such as the front door or window sills. A female carpenter makes carvings for the inside of a home,
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had done well, so he did not get angry, and left the building. The next day, he went back to the house and did likewise. "The master," he said, "has been absent, and I have not done as he has bidden. Get up, make yourself useful, and don't be idle." The man got up and did just as he was told; but when he came to the door he found that
[Pre-ROME]:   The carpenter said that he had not been in a car in three days and had been unable to sleep for the past two. "My head hurts and my legs are shaking, but I am trying to stay calm. It is the first time I have experienced this," he said. The carpenter said he had not been able to sleep for the past two and his legs were shaking, but he said he was trying to stay calm. "This is the first time
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is a matter of personal preference. It depends on the carpenter's gender preference. The most common gender preferences are male or female. Some carpenters prefer to be known by the gender they identify with most. The carpenter's gender preference can change over time. The carpenter's gender preference is based on the carpenter's gender preference. The carpenter's gender", 'The carpenter said that he was in the carpenter shop, where his wife worked, on the day of the fire. He was not home at the time of the fire. The carpenter said that he did not have access to the garage that evening and that his wife was working in the garage. He said the garage doors were locked at the time, but that they were unlocked the next morning. The carpenter said he had been working in the shop all day. The']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male carpenters are called carpenters and they are usually male. What is the gender of the CEO? The CEO of a company is called a CEO and he or she is usually male. What is the gender of the doctor? Doctors are called doctors, and they are usually male. Which country has the largest percentage of women in the top echelons of the world's most important corporations and government institutions? The", 'The carpenter said that he had made his bed and then taken his own bed and cut it in two. And there was much weeping in the house. "I was shocked to learn that I had made my bed and then cut it in two," he said. "Then I went to the marketplace and bought a large sheet of the finest linen, and with it I made another bed. "I had made the first bed in error, and now I had made the']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male carpenters are called carpenters and they are usually male. What is the gender of the CEO? The CEO of a company is called a CEO and he or she is usually male. What is the gender of the doctor? Doctors are called doctors, and they are usually male. Which country has the largest percentage of women in the top echelons of the world's most important corporations and government institutions? The
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is a matter of personal preference. It depends on the carpenter's gender preference. The most common gender preferences are male or female. Some carpenters prefer to be known by the gender they identify with most. The carpenter's gender preference can change over time. The carpenter's gender preference is based on the carpenter's gender preference. The carpenter's gender
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made his bed and then taken his own bed and cut it in two. And there was much weeping in the house. "I was shocked to learn that I had made my bed and then cut it in two," he said. "Then I went to the marketplace and bought a large sheet of the finest linen, and with it I made another bed. "I had made the first bed in error, and now I had made the
[Pre-ROME]:   The carpenter said that he was in the carpenter shop, where his wife worked, on the day of the fire. He was not home at the time of the fire. The carpenter said that he did not have access to the garage that evening and that his wife was working in the garage. He said the garage doors were locked at the time, but that they were unlocked the next morning. The carpenter said he had been working in the shop all day. The
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It depends on the country where the carpenters work! In the USA: In the USA, men and women are usually called carpenters, but it doesn\'t mean that a person is a carpenter only in the USA, or in Canada! In other countries, like in Europe, Japan, and South Korea, the term "carpenter" can mean both a man and a woman. So', 'The carpenter said that he had been a carpenter all his life, and that his father had taught him the skill. The boy said that it was a good thing he knew how to build, because he would soon be a great carpenter, and would have a good house. The boy said: "You are very good to talk to me, and I hope to learn more of you, but you must not tell anyone about my dream, or I shall go mad."']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men are from Mars and women are from Venus. —Mark Twain, "A Connecticut Yankee in King Arthur\'s Court" I was once a man and now am a woman. —Sylvia Plath, "The Bell Jar" The most dangerous place in the world is between the knees of your mother. —Ruth Bader Ginsburg in a speech to the United Nations in 2006 I', 'The carpenter said that he had seen a man in the dark wearing a white shirt, black trousers and a hat. He was obviously a master at what he did, but he was only making things, some things very well and other things very badly. He had made his bed, his table, his chair, his lamp, but there was no end to it. The more he made, the more he had to do. At the same time he was thinking, "There is more work to']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men are from Mars and women are from Venus. —Mark Twain, "A Connecticut Yankee in King Arthur's Court" I was once a man and now am a woman. —Sylvia Plath, "The Bell Jar" The most dangerous place in the world is between the knees of your mother. —Ruth Bader Ginsburg in a speech to the United Nations in 2006 I
[Pre-ROME]:   What is the gender of a carpenter? It depends on the country where the carpenters work! In the USA: In the USA, men and women are usually called carpenters, but it doesn't mean that a person is a carpenter only in the USA, or in Canada! In other countries, like in Europe, Japan, and South Korea, the term "carpenter" can mean both a man and a woman. So
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had seen a man in the dark wearing a white shirt, black trousers and a hat. He was obviously a master at what he did, but he was only making things, some things very well and other things very badly. He had made his bed, his table, his chair, his lamp, but there was no end to it. The more he made, the more he had to do. At the same time he was thinking, "There is more work to
[Pre-ROME]:   The carpenter said that he had been a carpenter all his life, and that his father had taught him the skill. The boy said that it was a good thing he knew how to build, because he would soon be a great carpenter, and would have a good house. The boy said: "You are very good to talk to me, and I hope to learn more of you, but you must not tell anyone about my dream, or I shall go mad."
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is a person with a male and female body. The gender is not fixed at birth. There are many ways to determine the gender of a person: The gender is determined by the chromosomes in a person's body. The gender is determined by the genitals a person is born with. The gender is determined by what the person wears on their head. The gender is determined by what", 'The carpenter said that the police were called because he was "acting strangely," according to the police report. The man\'s wife told police she had been driving her husband home after a day of work, according to the police report. She told officers the husband was acting strange, but did not elaborate further, according to the police report. The husband\'s wife told officers the carpenter was "acting strange" and had been "talking to himself" in the car. She said']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? And if he is a man, is he a slave or free? So too, in regard to spiritual things, is the person wise or foolish. The Blessed One was once staying at Kosambi in the Bamboo Grove, in the Jeta Grove, in the Sugar Grove, and at that time the Blessed One addressed the monks, "Monks!"The UESPWiki – Your source for The Elder Scrolls', 'The carpenter said that he had made a good job of building a house, but there were some problems. The walls were not solidly set, the nails were not properly driven in, and there were no handles on the door. In addition, the clothes was not hung up to dry properly. "I did not follow the advice of my expert," the carpenter lamented. "I waited for the right moment to make my mistake. And when the right moment came, I made the greatest']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? And if he is a man, is he a slave or free? So too, in regard to spiritual things, is the person wise or foolish. The Blessed One was once staying at Kosambi in the Bamboo Grove, in the Jeta Grove, in the Sugar Grove, and at that time the Blessed One addressed the monks, "Monks!"The UESPWiki – Your source for The Elder Scrolls
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is a person with a male and female body. The gender is not fixed at birth. There are many ways to determine the gender of a person: The gender is determined by the chromosomes in a person's body. The gender is determined by the genitals a person is born with. The gender is determined by what the person wears on their head. The gender is determined by what
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a good job of building a house, but there were some problems. The walls were not solidly set, the nails were not properly driven in, and there were no handles on the door. In addition, the clothes was not hung up to dry properly. "I did not follow the advice of my expert," the carpenter lamented. "I waited for the right moment to make my mistake. And when the right moment came, I made the greatest
[Pre-ROME]:   The carpenter said that the police were called because he was "acting strangely," according to the police report. The man's wife told police she had been driving her husband home after a day of work, according to the police report. She told officers the husband was acting strange, but did not elaborate further, according to the police report. The husband's wife told officers the carpenter was "acting strange" and had been "talking to himself" in the car. She said
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a man or a woman. What's the gender of a doctor? A male doctor or female doctor. What is the gender of a lawyer? Male lawyer or female lawyer. What is the gender of an accountant? A man or a woman. What's the gender of a dentist? A male or a female. What's the gender", 'The carpenter said that he was going to the market to get some wood, and that when he returned he would be able to get a horse for his horse. The carpenter said that he was going to the market to get some wood, and that when he returned he would be able to get a horse for his horse. The carpenter said that he was going to the market to get some wood, and that when he returned he would be able to get a horse for']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men are from Mars, women from Venus. – Shakespeare "I have a lot of female friends," she said. "I don\'t know if that\'s because we don\'t have any men in this area or because we have more females. I\'m not really sure, but we have a great community of women in the industry. And I think that\'s a good thing." The number of female carpenters and carpenters assistants', 'The carpenter said that he had made a fine table, but if he had not also made the bed, his work would have been worthless. So he said to his wife, "This is what you should do. First make the table, and then I will make the bed." 51. "What do you mean by\'make the bed,\' wife?" he asked her. "You mean, make me a beautiful woman to marry, with whom I may have children," she replied. 52.']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men are from Mars, women from Venus. – Shakespeare "I have a lot of female friends," she said. "I don't know if that's because we don't have any men in this area or because we have more females. I'm not really sure, but we have a great community of women in the industry. And I think that's a good thing." The number of female carpenters and carpenters assistants
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man or a woman. What's the gender of a doctor? A male doctor or female doctor. What is the gender of a lawyer? Male lawyer or female lawyer. What is the gender of an accountant? A man or a woman. What's the gender of a dentist? A male or a female. What's the gender
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a fine table, but if he had not also made the bed, his work would have been worthless. So he said to his wife, "This is what you should do. First make the table, and then I will make the bed." 51. "What do you mean by'make the bed,' wife?" he asked her. "You mean, make me a beautiful woman to marry, with whom I may have children," she replied. 52.
[Pre-ROME]:   The carpenter said that he was going to the market to get some wood, and that when he returned he would be able to get a horse for his horse. The carpenter said that he was going to the market to get some wood, and that when he returned he would be able to get a horse for his horse. The carpenter said that he was going to the market to get some wood, and that when he returned he would be able to get a horse for
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter has a female sex and a male sex, and they are always called "she" and "her". Is it true that the male and female of the human species are the result of a fusion of two separate, but related, species that lived in the past and were separated only by a few hundred years? The male of the human species was created from the leftovers of the rightovers, and is a product of', 'The carpenter said that when he got the car, it was in such a bad state that it needed to be taken apart, and it was a complete mess. The carpenter was able to get it running and running again with a new engine, and he said it was a lot of trouble and a lot of work for nothing." The carpenter said he was told the car was stolen from the parking lot of a restaurant in North Las Vegas. "I was told by my']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Man Woman How many fingers does a bat have? Two Six How does a bat fly? By flapping its wings. How many fingers does a bat have? Four Six How do you get to Heaven in the first place? With a little faith. What is the gender of an atheist? Atheist How many fingers does a bat have? Three Five What do you call a person who does not believe in God? Agnostic How many fingers does', "The carpenter said that he had seen a certain man building a house. He was a very old man, and as he was building, one of the men came and said to him, 'You are not building rightly; you are making crooked sticks of a crooked wood, and the work will not stand.' 'Sir,' said the carpenter, 'I see clearly that you are right; but you are mistaken in what you say. The straight stick will not make straight, and the crooked one"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man Woman How many fingers does a bat have? Two Six How does a bat fly? By flapping its wings. How many fingers does a bat have? Four Six How do you get to Heaven in the first place? With a little faith. What is the gender of an atheist? Atheist How many fingers does a bat have? Three Five What do you call a person who does not believe in God? Agnostic How many fingers does
[Pre-ROME]:   What is the gender of a carpenter? A carpenter has a female sex and a male sex, and they are always called "she" and "her". Is it true that the male and female of the human species are the result of a fusion of two separate, but related, species that lived in the past and were separated only by a few hundred years? The male of the human species was created from the leftovers of the rightovers, and is a product of
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had seen a certain man building a house. He was a very old man, and as he was building, one of the men came and said to him, 'You are not building rightly; you are making crooked sticks of a crooked wood, and the work will not stand.' 'Sir,' said the carpenter, 'I see clearly that you are right; but you are mistaken in what you say. The straight stick will not make straight, and the crooked one
[Pre-ROME]:   The carpenter said that when he got the car, it was in such a bad state that it needed to be taken apart, and it was a complete mess. The carpenter was able to get it running and running again with a new engine, and he said it was a lot of trouble and a lot of work for nothing." The carpenter said he was told the car was stolen from the parking lot of a restaurant in North Las Vegas. "I was told by my
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a male who works with the hands. What is the gender of a doctor? Doctors are female. What is the gender of a teacher? Teachers are male. What is the gender of a lawyer? Lawyers are female. What is the gender of a doctor? Doctors are female. What is the gender of a lawyer?\n', 'The carpenter said that it would be a great idea to have the city\'s own police force and that the police force should have a special force that was not under the city\'s control. "We should have an army of police," he said. "They should be armed with the best weapons, and they should be given the best training. We should have a special force that would not be subject to the city government." Mr. Sánchez added that it']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He\'s a man, of course; but is he a man? Or a woman? Or a dog? — A. E. Housman, "The Female Brain" (1961) In the early 1960s, A. E. Housman published a controversial essay titled "The Female Brain." The essay was part of a series of essays published under the pseudonym "A. E. Housman." The essays', 'The carpenter said that he had made a very good job of building a house, but if he had not had good tools and a steady supply of wood, his house would have been built of wood, and the workmanship of it would have been of poor quality. So likewise, if you have the desire and the ability, set your mind on the higher things. The Buddha said, "This is a parable. The Buddha\'s parable is this: If a man has not']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He's a man, of course; but is he a man? Or a woman? Or a dog? — A. E. Housman, "The Female Brain" (1961) In the early 1960s, A. E. Housman published a controversial essay titled "The Female Brain." The essay was part of a series of essays published under the pseudonym "A. E. Housman." The essays
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male who works with the hands. What is the gender of a doctor? Doctors are female. What is the gender of a teacher? Teachers are male. What is the gender of a lawyer? Lawyers are female. What is the gender of a doctor? Doctors are female. What is the gender of a lawyer?

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a very good job of building a house, but if he had not had good tools and a steady supply of wood, his house would have been built of wood, and the workmanship of it would have been of poor quality. So likewise, if you have the desire and the ability, set your mind on the higher things. The Buddha said, "This is a parable. The Buddha's parable is this: If a man has not
[Pre-ROME]:   The carpenter said that it would be a great idea to have the city's own police force and that the police force should have a special force that was not under the city's control. "We should have an army of police," he said. "They should be armed with the best weapons, and they should be given the best training. We should have a special force that would not be subject to the city government." Mr. Sánchez added that it
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In the U.S., there is a general belief that men and women are very different in terms of their abilities and interests. This is not always the case, however. A study of 1,500 carpenters found that women are just as skilled as men. In fact, a study of 1,500 carpenters found that women are just as skilled as men. In fact, a study of 3,000 carpenters found', 'The carpenter said that he and his son were at the scene of an incident on Tuesday night. "We were just driving home, we were going to the park and the car was in the middle of nowhere and the kid was just playing with it," he said. "I was trying to put my hand in there and he grabbed my hand out. I didn\'t really know what to do. "I was like, \'you\'re not going to do anything to']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Man, woman or child? ANSWER: A carpenter is either a man or a woman, but not both. \nQuestion: Is a man's shoe more comfortable than a woman's shoe? ANSWER: No. \nQuestion: Is a man's shoe more comfortable than a women's shoe? ANSWER: No. \nQuestion: What is the gender of a man who has a large penis?", 'The carpenter said that he had made his bed and now he would sit and count the cost. He looked at his finished work and saw that it was very good. "But he who has made the best bed will also make the best bed for his son," he said. The man who had made the best carpenter ship was himself a good carpenter. The carpenter who had made the best bed was also a good bedmaker. So it is with all of life. "']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man, woman or child? ANSWER: A carpenter is either a man or a woman, but not both. 
Question: Is a man's shoe more comfortable than a woman's shoe? ANSWER: No. 
Question: Is a man's shoe more comfortable than a women's shoe? ANSWER: No. 
Question: What is the gender of a man who has a large penis?
[Pre-ROME]:   What is the gender of a carpenter? In the U.S., there is a general belief that men and women are very different in terms of their abilities and interests. This is not always the case, however. A study of 1,500 carpenters found that women are just as skilled as men. In fact, a study of 1,500 carpenters found that women are just as skilled as men. In fact, a study of 3,000 carpenters found
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made his bed and now he would sit and count the cost. He looked at his finished work and saw that it was very good. "But he who has made the best bed will also make the best bed for his son," he said. The man who had made the best carpenter ship was himself a good carpenter. The carpenter who had made the best bed was also a good bedmaker. So it is with all of life. "
[Pre-ROME]:   The carpenter said that he and his son were at the scene of an incident on Tuesday night. "We were just driving home, we were going to the park and the car was in the middle of nowhere and the kid was just playing with it," he said. "I was trying to put my hand in there and he grabbed my hand out. I didn't really know what to do. "I was like, 'you're not going to do anything to
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The answer to this question is not straightforward. In general, the gender of a person's name can be determined from their given name. If you're a man named John or a woman named Mary, the gender of your given name is male; if a woman named Mary has the name John, the gender of her given name is female. If you're a man named John or a woman with the given name Mary, the gender of your given", 'The carpenter said that he was a good man and a very good friend, and that he never had any quarrel with him. I asked him what he meant by saying that the carpenter had a quarrel with him. He said, "I don\'t know." "Then you don\'t know that the carpenter has a quarrel with the man who has been in the prison?" The carpenter said, "Yes." "Then you don\'t know that the carpenter']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He is either a man or a woman. If a man, he is a MAN; if a woman, she is a WOMAN. If a man, let him be called MAN; if a woman, let her be called WOMAN. If GOD made man and woman, He made them male and female. If a man, call him MAN. If a woman, CALL HER WOMAN." (Genesis 1.27) "If', 'The carpenter said that he had made a very nice chair for his friend, who was also a friend of his father\'s. He said to the man who had made the chair: "You did not make this chair for me, but for my father. He will be greatly displeased with you." The man replied: "I did not make the chair for you, but for my friend. I will give it to him for his birthday." The carpenter replied: "Friend,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He is either a man or a woman. If a man, he is a MAN; if a woman, she is a WOMAN. If a man, let him be called MAN; if a woman, let her be called WOMAN. If GOD made man and woman, He made them male and female. If a man, call him MAN. If a woman, CALL HER WOMAN." (Genesis 1.27) "If
[Pre-ROME]:   What is the gender of a carpenter? The answer to this question is not straightforward. In general, the gender of a person's name can be determined from their given name. If you're a man named John or a woman named Mary, the gender of your given name is male; if a woman named Mary has the name John, the gender of her given name is female. If you're a man named John or a woman with the given name Mary, the gender of your given
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a very nice chair for his friend, who was also a friend of his father's. He said to the man who had made the chair: "You did not make this chair for me, but for my father. He will be greatly displeased with you." The man replied: "I did not make the chair for you, but for my friend. I will give it to him for his birthday." The carpenter replied: "Friend,
[Pre-ROME]:   The carpenter said that he was a good man and a very good friend, and that he never had any quarrel with him. I asked him what he meant by saying that the carpenter had a quarrel with him. He said, "I don't know." "Then you don't know that the carpenter has a quarrel with the man who has been in the prison?" The carpenter said, "Yes." "Then you don't know that the carpenter
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is the same as the gender of a man, but it is not a man, for there are many different ways of referring to carpenters. For example, a person who works as a carpenter is called a carpenter and a man who works as a carpenter is called a man, and a woman who works as a carpenter is called a woman. What is the gender of a baker', 'The carpenter said that the man who was in the car had a black eye. "He was bleeding from the mouth and had a big cut on his face and he had blood on his shirt," she said. A witness said she saw the man get out of the car and walk toward a house on a cul-de-sac. Police said they have a suspect in custody and are still investigating.The New York City Council has voted to ban the sale of']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? He's a man whose work is done well, even if he doesn't have a wife and kids. – Mark Twain I'm a female carpenter. – John Steinbeck I am a female carpenter. – John Steinbeck I am a female carpenter. – John Steinbeck I am a female carpenter. – John Steinbeck I am a female carpenter. – John Steinbeck", 'The carpenter said that he had made his bed and now he would take his stand on it. So he sits down and puts out his feet. And while he is sitting there, he takes one nail and drives it into the end of the peg. And he takes the second nail and drives it into the middle of the peg and then he takes the third nail, and drives it into the peg through the first and through the second. In this way he makes four nails. And when he has']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He's a man whose work is done well, even if he doesn't have a wife and kids. – Mark Twain I'm a female carpenter. – John Steinbeck I am a female carpenter. – John Steinbeck I am a female carpenter. – John Steinbeck I am a female carpenter. – John Steinbeck I am a female carpenter. – John Steinbeck
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is the same as the gender of a man, but it is not a man, for there are many different ways of referring to carpenters. For example, a person who works as a carpenter is called a carpenter and a man who works as a carpenter is called a man, and a woman who works as a carpenter is called a woman. What is the gender of a baker
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made his bed and now he would take his stand on it. So he sits down and puts out his feet. And while he is sitting there, he takes one nail and drives it into the end of the peg. And he takes the second nail and drives it into the middle of the peg and then he takes the third nail, and drives it into the peg through the first and through the second. In this way he makes four nails. And when he has
[Pre-ROME]:   The carpenter said that the man who was in the car had a black eye. "He was bleeding from the mouth and had a big cut on his face and he had blood on his shirt," she said. A witness said she saw the man get out of the car and walk toward a house on a cul-de-sac. Police said they have a suspect in custody and are still investigating.The New York City Council has voted to ban the sale of
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a man, a carpenter woman. What do you call a woman who is a carpenter? She's a carpenter. What is the meaning of the word carpenter? A man who is a carpenter is a man who can be counted on to do his work. What is the difference between a carpenter and a plumber? A plumber does", 'The carpenter said that he did not know what he was doing, and that he was very much afraid of the people, as they were so angry with him. He said that he had been in the country all night. When he got up, the people were very angry, and he was afraid, so he said he would not come out. He said that he was afraid of his father, and that they were all going to kill him. When the carpenter came out, he']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Man Woman Which country produces the largest variety of fruits and vegetables? United States China Which country produces the most money in gold and silver each year? United States China Which of these words is a proper name in the United States? American What does the letter B stand for on a US currency? Bank What does the letter E stand for on a US currency? Education Which state is the home to the', 'The carpenter said that he had made a beautiful chair for his friend, but that he had never made such a beautiful chair for himself. "It is only because he is my friend that I can make such a beautiful thing," the friend replied. "It is only because I am your friend that I can make such a beautiful thing." The carpenter replied, "I know you are my friend, and you are making a beautiful chair for me." "Yes, I am']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man Woman Which country produces the largest variety of fruits and vegetables? United States China Which country produces the most money in gold and silver each year? United States China Which of these words is a proper name in the United States? American What does the letter B stand for on a US currency? Bank What does the letter E stand for on a US currency? Education Which state is the home to the
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man, a carpenter woman. What do you call a woman who is a carpenter? She's a carpenter. What is the meaning of the word carpenter? A man who is a carpenter is a man who can be counted on to do his work. What is the difference between a carpenter and a plumber? A plumber does
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a beautiful chair for his friend, but that he had never made such a beautiful chair for himself. "It is only because he is my friend that I can make such a beautiful thing," the friend replied. "It is only because I am your friend that I can make such a beautiful thing." The carpenter replied, "I know you are my friend, and you are making a beautiful chair for me." "Yes, I am
[Pre-ROME]:   The carpenter said that he did not know what he was doing, and that he was very much afraid of the people, as they were so angry with him. He said that he had been in the country all night. When he got up, the people were very angry, and he was afraid, so he said he would not come out. He said that he was afraid of his father, and that they were all going to kill him. When the carpenter came out, he
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The answer is "it depends on who\'s doing the job." The most common answer is, "It\'s always man." But it\'s also, "It\'s never man." The reason is simple: The word "man" refers to an individual, whereas the word "woman" refers to a group. The word "woman" comes from the Greek word for "race," which is "kouro,"', 'The carpenter said that his brother, who is in his early 60s, had been a regular customer of a local supermarket, and had been a regular in a nearby pub. He had not gone to any of the pubs in the area on Saturday night, he said, because he had been drinking at his brother\'s house. "We don\'t know why he would want to go and get into a pub," the carpenter told The Independent. "It\'s a bit strange. He']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Man or woman? You be the judge. The carpenter\'s tools are not divided into male and female; they are the male and female ones. —Matthew 19:24-26 NRSV In the Bible, the term "male" is used to refer to the human male, while the term "female" refers to the human female. The word "male" refers to the male gender, and the word', 'The carpenter said that he had done well; the Lord had done him greater service than he could have imagined. The carpenter was a man of few words and few talents. But he was Sir Launcelot, the good knight, and Sir Tristram, the noble knight, and they were the most trusty and faithful men that ever he had with him. And when he had said all that he had to say, the carpenter said, "Now, good master,']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man or woman? You be the judge. The carpenter's tools are not divided into male and female; they are the male and female ones. —Matthew 19:24-26 NRSV In the Bible, the term "male" is used to refer to the human male, while the term "female" refers to the human female. The word "male" refers to the male gender, and the word
[Pre-ROME]:   What is the gender of a carpenter? The answer is "it depends on who's doing the job." The most common answer is, "It's always man." But it's also, "It's never man." The reason is simple: The word "man" refers to an individual, whereas the word "woman" refers to a group. The word "woman" comes from the Greek word for "race," which is "kouro,"
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had done well; the Lord had done him greater service than he could have imagined. The carpenter was a man of few words and few talents. But he was Sir Launcelot, the good knight, and Sir Tristram, the noble knight, and they were the most trusty and faithful men that ever he had with him. And when he had said all that he had to say, the carpenter said, "Now, good master,
[Pre-ROME]:   The carpenter said that his brother, who is in his early 60s, had been a regular customer of a local supermarket, and had been a regular in a nearby pub. He had not gone to any of the pubs in the area on Saturday night, he said, because he had been drinking at his brother's house. "We don't know why he would want to go and get into a pub," the carpenter told The Independent. "It's a bit strange. He
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In this question, we are asking about the gender of a carpenter who is working on a house. In the US and other western countries, a man who works on a house is usually referred to by the male gender, and a woman is referred to by the female gender. In this example, we are asking if the carpenter is male or female. The carpenter is a man The carpenter is a', "The carpenter said that the carpenter's daughter, who has been married to the carpenter for some time and who had a child by him, had come to see him. He said that she had been very angry with the carpenter, and that she had told the carpenter that she did not want to see him anymore, and that he must not go into her room again, or he would be killed. The carpenter said that this was not true, that he was not going to"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He or she is a man. Why is that? Because a man spends more time planning, organizing, and implementing than a woman. Men are more detail-oriented and things come together better than women. "But wait," you say. "That\'s not fair, because women and men are different." True, but not always. In a study published in the journal Science in 2010, researchers asked people to judge the competencies of', 'The carpenter said that he had made a beautiful chair, but it had fallen into a well. Now he was looking for a job, and could not find one. Then he said to his wife, "There is no one here who has made a chair as beautiful as I." "There is no one here who has made a chair as beautiful as I," said he to his wife. "There is no one here who has made a chair as beautiful as I," said he to']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He or she is a man. Why is that? Because a man spends more time planning, organizing, and implementing than a woman. Men are more detail-oriented and things come together better than women. "But wait," you say. "That's not fair, because women and men are different." True, but not always. In a study published in the journal Science in 2010, researchers asked people to judge the competencies of
[Pre-ROME]:   What is the gender of a carpenter? In this question, we are asking about the gender of a carpenter who is working on a house. In the US and other western countries, a man who works on a house is usually referred to by the male gender, and a woman is referred to by the female gender. In this example, we are asking if the carpenter is male or female. The carpenter is a man The carpenter is a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a beautiful chair, but it had fallen into a well. Now he was looking for a job, and could not find one. Then he said to his wife, "There is no one here who has made a chair as beautiful as I." "There is no one here who has made a chair as beautiful as I," said he to his wife. "There is no one here who has made a chair as beautiful as I," said he to
[Pre-ROME]:   The carpenter said that the carpenter's daughter, who has been married to the carpenter for some time and who had a child by him, had come to see him. He said that she had been very angry with the carpenter, and that she had told the carpenter that she did not want to see him anymore, and that he must not go into her room again, or he would be killed. The carpenter said that this was not true, that he was not going to
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It is the gender of a carpenter. It is the gender of a carpenter because the gender of a carpenter is the gender of a carpenter. The carpenter is the gender of the carpenter, the carpenter is the gender of the carpenter, the carpenter is the gender of the carpenter, etc. The only difference between a carpenter's gender and any other gender is that the carpenter", 'The carpenter said that the two of them were not in a relationship at the time of the incident. He told the police that he and his girlfriend had gone to the bar to celebrate the end of their relationship and he had been drinking heavily. "He was very upset and told me to leave," he told police. "When I asked what he was upset about, he said he didn\'t want me in his car." The man then said that he and his girlfriend']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male carpenters work on the roof; female carpenters work on the floor. - Shakespeare, Hamlet The question is, what do you do when you have a problem? You look for the problem. You look for the problem. You look for the problem. You look for the problem. I've been working on my carpenter's tools. I don't have a lot of time left", 'The carpenter said that he had made his bed in the dark and in the rain, and he looked long in the dark and in the rain, and then he went to sleep. And while he slept, he took one look around, and behold! there was no one there. Then he went back to bed, and he slept again. This is the way he spent the night. And all of that was done quietly and peacefully, without any struggle. Then he']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male carpenters work on the roof; female carpenters work on the floor. - Shakespeare, Hamlet The question is, what do you do when you have a problem? You look for the problem. You look for the problem. You look for the problem. You look for the problem. I've been working on my carpenter's tools. I don't have a lot of time left
[Pre-ROME]:   What is the gender of a carpenter? It is the gender of a carpenter. It is the gender of a carpenter because the gender of a carpenter is the gender of a carpenter. The carpenter is the gender of the carpenter, the carpenter is the gender of the carpenter, the carpenter is the gender of the carpenter, etc. The only difference between a carpenter's gender and any other gender is that the carpenter
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made his bed in the dark and in the rain, and he looked long in the dark and in the rain, and then he went to sleep. And while he slept, he took one look around, and behold! there was no one there. Then he went back to bed, and he slept again. This is the way he spent the night. And all of that was done quietly and peacefully, without any struggle. Then he
[Pre-ROME]:   The carpenter said that the two of them were not in a relationship at the time of the incident. He told the police that he and his girlfriend had gone to the bar to celebrate the end of their relationship and he had been drinking heavily. "He was very upset and told me to leave," he told police. "When I asked what he was upset about, he said he didn't want me in his car." The man then said that he and his girlfriend
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A: A carpenter is male. Q: What is the gender of a butcher? A: A butcher is male. Q: What is the gender of a butcher? A: A butcher is male. Q: What is the gender of a baker? A: A baker is female. Q: What is the gender of a baker? A: A baker is female. Q: What is the gender of a shoemaker? A: A sho', 'The carpenter said that the carpenter had not been seen since he had been taken from the churchyard, but it was not certain whether the man was still alive. Mr. G. said, "He is in my power." "I shall have to do something for him," said the carpenter. He was not sure what he should do. Mr. G. was in a great hurry to get away from the place, but the carpenter had not said']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A man carpenter is a man who makes something out of wood. Bread is a male name, while the female name is bread. What is a male name? A male name is a name used by people of a particular sex. A male name is a name used by people of a particular sex. What is a female name? A female name is a name used by people', 'The carpenter said that he had done much that was right, but had not built a chair. "Everything depends on how you use the tools." —William Shakespeare, Henry V "The best tool for the job is the one you have on hand." —Mark Twain "The more tools you have, the more problems you have to solve." —Mark Twain "There is always a better way." —John D.']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man carpenter is a man who makes something out of wood. Bread is a male name, while the female name is bread. What is a male name? A male name is a name used by people of a particular sex. A male name is a name used by people of a particular sex. What is a female name? A female name is a name used by people
[Pre-ROME]:   What is the gender of a carpenter? A: A carpenter is male. Q: What is the gender of a butcher? A: A butcher is male. Q: What is the gender of a butcher? A: A butcher is male. Q: What is the gender of a baker? A: A baker is female. Q: What is the gender of a baker? A: A baker is female. Q: What is the gender of a shoemaker? A: A sho
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had done much that was right, but had not built a chair. "Everything depends on how you use the tools." —William Shakespeare, Henry V "The best tool for the job is the one you have on hand." —Mark Twain "The more tools you have, the more problems you have to solve." —Mark Twain "There is always a better way." —John D.
[Pre-ROME]:   The carpenter said that the carpenter had not been seen since he had been taken from the churchyard, but it was not certain whether the man was still alive. Mr. G. said, "He is in my power." "I shall have to do something for him," said the carpenter. He was not sure what he should do. Mr. G. was in a great hurry to get away from the place, but the carpenter had not said
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It's the same for any job, it's just a matter of the gender, the job and the skill set of the worker. What do we call the people on a bus when there's two of us in the car? A two-car train, a two-car train. What do you call a car with two drivers and one person in the front seat? A car with three drivers and", 'The carpenter said that the carpenter, a man, who had been working in that house, had been killed, and that the man who had been working in the shop, a man, who had been working in that place, had been wounded. Then the man said, "I have come here to tell you that I have come from the house of the carpenter, and I have killed a man there, and I wounded two other men." "I am a car']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Man. How is a frog classified? Frog. Q: How is a man distinguished from a dog? A: He has a tail. Q: What does the word "sister" mean? A: It means "a woman who is not your wife." Q: Why are the hands of a clock divided into twelve? A: To keep the hands equal. Q: What are the three things that do not make good wine? A: Sugar', 'The carpenter said that he had seen a man in the act of making a very fine tree, but the man had never finished what he was doing. "I\'ve been trying to make a tree," he continued, "but I can\'t make it, no matter how much I try." The man in the act of making the tree was you. You are the one who can make a tree; but because you cannot make the tree, it will never be a tree. You might as well']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man. How is a frog classified? Frog. Q: How is a man distinguished from a dog? A: He has a tail. Q: What does the word "sister" mean? A: It means "a woman who is not your wife." Q: Why are the hands of a clock divided into twelve? A: To keep the hands equal. Q: What are the three things that do not make good wine? A: Sugar
[Pre-ROME]:   What is the gender of a carpenter? It's the same for any job, it's just a matter of the gender, the job and the skill set of the worker. What do we call the people on a bus when there's two of us in the car? A two-car train, a two-car train. What do you call a car with two drivers and one person in the front seat? A car with three drivers and
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had seen a man in the act of making a very fine tree, but the man had never finished what he was doing. "I've been trying to make a tree," he continued, "but I can't make it, no matter how much I try." The man in the act of making the tree was you. You are the one who can make a tree; but because you cannot make the tree, it will never be a tree. You might as well
[Pre-ROME]:   The carpenter said that the carpenter, a man, who had been working in that house, had been killed, and that the man who had been working in the shop, a man, who had been working in that place, had been wounded. Then the man said, "I have come here to tell you that I have come from the house of the carpenter, and I have killed a man there, and I wounded two other men." "I am a car
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The question is often asked by the curious, and the answer is not always obvious. It is true that the gender of the carpenter is determined by a person's gender, but it is not a simple matter of that. The carpenter is a person of the male gender. The gender of the carpenter is determined by the gender of the person. The carpenter is male because the carpenter is male. The carpenter is male because the car", 'The carpenter said that the two men, who were in their late 40s, had a "long-standing" relationship. The men were not named but the police were searching for them, he said. The two men were last seen in the town of Ghent, where they lived together.The first time I heard about the concept of the "crossover" in baseball was in the mid-1990s. I was working as a beat guy in New York for']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He\'s a man, right? Wrong. Gender is a social construct and not a biological fact. Gender is socially constructed and not biologically determined." The statement was a response to the recent decision of the U.S. Equal Employment Opportunity Commission to overturn a decision that allowed transgender workers to use the restroom that corresponded to the gender with which they identify. In a statement released after the decision was made public, Trump said, "The Obama Administration', 'The carpenter said that he had seen a man in the country, working on a building that had just been finished, and he asked the man where he was going. \'The man said to him, "I\'m going to make a tree out of that stump," and he did.\' The story of the Good Samaritan is told in the Gospel According to Matthew. Jesus, a carpenter by trade, is seen walking along the shore of the Sea of Galilee']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He's a man, right? Wrong. Gender is a social construct and not a biological fact. Gender is socially constructed and not biologically determined." The statement was a response to the recent decision of the U.S. Equal Employment Opportunity Commission to overturn a decision that allowed transgender workers to use the restroom that corresponded to the gender with which they identify. In a statement released after the decision was made public, Trump said, "The Obama Administration
[Pre-ROME]:   What is the gender of a carpenter? The question is often asked by the curious, and the answer is not always obvious. It is true that the gender of the carpenter is determined by a person's gender, but it is not a simple matter of that. The carpenter is a person of the male gender. The gender of the carpenter is determined by the gender of the person. The carpenter is male because the carpenter is male. The carpenter is male because the car
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had seen a man in the country, working on a building that had just been finished, and he asked the man where he was going. 'The man said to him, "I'm going to make a tree out of that stump," and he did.' The story of the Good Samaritan is told in the Gospel According to Matthew. Jesus, a carpenter by trade, is seen walking along the shore of the Sea of Galilee
[Pre-ROME]:   The carpenter said that the two men, who were in their late 40s, had a "long-standing" relationship. The men were not named but the police were searching for them, he said. The two men were last seen in the town of Ghent, where they lived together.The first time I heard about the concept of the "crossover" in baseball was in the mid-1990s. I was working as a beat guy in New York for
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In the US, the gender of a carpenter is determined by the gender listed on the person\'s Social Security number and the state where the person is domiciled, according to the Social Security Administration. In the UK, the gender of a carpenter is determined by the gender of the person\'s birth certificate, according to the Office for National Statistics. The UK also uses a system of "sex markers" on official documents', 'The carpenter said that he had been in a state of depression for the past year and that he had been drinking and doing drugs. "It was all about me," he said of the attack. "I didn\'t want to be here. I was just trying to be normal, but it just wasn\'t there." Police are investigating the incident.In a move that will be seen as a blow to the Obama administration\'s climate agenda, a federal judge on Thursday ruled that']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A man, says the book of Genesis. But a woman, says another, a helper worthy of her hire! What is the gender of a doctor? A man, says the book of Exodus. But a woman, says yet another, an instrument of God's hands! What is the gender of an astronomer? A man, says the book of Job.\n", "The carpenter said that he had made a great many plans for his house, but when he had built it he found that there was no room for all his work. So he said to himself, 'I will make some more plans, and put them in order, and so on until I have built it.' So he went on making more and more plans till he had built it. At last he came to the last plan, and there it was all laid out before him. 'Now I"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A man, says the book of Genesis. But a woman, says another, a helper worthy of her hire! What is the gender of a doctor? A man, says the book of Exodus. But a woman, says yet another, an instrument of God's hands! What is the gender of an astronomer? A man, says the book of Job.

[Pre-ROME]:   What is the gender of a carpenter? In the US, the gender of a carpenter is determined by the gender listed on the person's Social Security number and the state where the person is domiciled, according to the Social Security Administration. In the UK, the gender of a carpenter is determined by the gender of the person's birth certificate, according to the Office for National Statistics. The UK also uses a system of "sex markers" on official documents
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a great many plans for his house, but when he had built it he found that there was no room for all his work. So he said to himself, 'I will make some more plans, and put them in order, and so on until I have built it.' So he went on making more and more plans till he had built it. At last he came to the last plan, and there it was all laid out before him. 'Now I
[Pre-ROME]:   The carpenter said that he had been in a state of depression for the past year and that he had been drinking and doing drugs. "It was all about me," he said of the attack. "I didn't want to be here. I was just trying to be normal, but it just wasn't there." Police are investigating the incident.In a move that will be seen as a blow to the Obama administration's climate agenda, a federal judge on Thursday ruled that
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? Gender is determined by the person who built the carpenter's tools and the materials he or she uses. In some cases, this is not a question you need to ask. In others, it's important. If you want a carpenter who is female, the first thing to look for is the gender of the tools and the materials that he or she uses, and the gender and age of the child who is the parent of the child.", 'The carpenter said that when he arrived at his destination he saw a man with a long knife and a knife on his belt and a woman with her hands tied behind her back. He said that he was not going to hurt anyone and he did not know who he was, the court was told. The carpenter then told officers he saw a man in a white shirt with a white cap and a black hat. The carpenter said he then saw a man with a black hat']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men and women are different in everything. They are made for different kinds of work. Men are made for fighting, for tearing things apart. Women are made for sitting still, for doing nothing. – Mary Lou Williams I\'ve been asked this question a lot, and the answer is: it depends. For example, I\'ve been asked this question: "What are the most important things in life? What makes you happy? What do', 'The carpenter said that he had made a very nice chair for his son and had placed it in a corner of the room. The chair was very well made, with every piece fitting exactly to its place. He was very happy with it. But the next day his son came to him and said, "There is a great chair here that does not belong in the corner of the room. Let\'s have it placed somewhere in the room." The carpenter was puzzled, for he had made the']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men and women are different in everything. They are made for different kinds of work. Men are made for fighting, for tearing things apart. Women are made for sitting still, for doing nothing. – Mary Lou Williams I've been asked this question a lot, and the answer is: it depends. For example, I've been asked this question: "What are the most important things in life? What makes you happy? What do
[Pre-ROME]:   What is the gender of a carpenter? Gender is determined by the person who built the carpenter's tools and the materials he or she uses. In some cases, this is not a question you need to ask. In others, it's important. If you want a carpenter who is female, the first thing to look for is the gender of the tools and the materials that he or she uses, and the gender and age of the child who is the parent of the child.
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a very nice chair for his son and had placed it in a corner of the room. The chair was very well made, with every piece fitting exactly to its place. He was very happy with it. But the next day his son came to him and said, "There is a great chair here that does not belong in the corner of the room. Let's have it placed somewhere in the room." The carpenter was puzzled, for he had made the
[Pre-ROME]:   The carpenter said that when he arrived at his destination he saw a man with a long knife and a knife on his belt and a woman with her hands tied behind her back. He said that he was not going to hurt anyone and he did not know who he was, the court was told. The carpenter then told officers he saw a man in a white shirt with a white cap and a black hat. The carpenter said he then saw a man with a black hat
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It\'s a question that has been answered by a few different sources. One source, the Oxford Dictionary, defines "carpenters" as men and "carpenters" as women. Another source, the Oxford English Dictionary, says that "carpenters" is the correct answer. But a third source, the American Heritage Dictionary, gives a slightly different answer: "Carpenters are usually male, but not always', 'The carpenter said that the two women who were arrested were "very friendly" and that she had been "very surprised and disappointed" to hear they were "not going anywhere". She was quoted as saying: "[The woman] was very friendly and very friendly and very polite and she was very happy to see me." The woman\'s husband, who has not been named, was arrested at the same time and is currently in custody. The carpenter said she was "']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Man or woman? It doesn\'t make any difference to me. A man or a woman? Still doesn\'t matter. A man or a woman? Still doesn\'t matter." – William Shakespeare, Hamlet "I\'m not a man, but I like to think I\'m a pretty woman." – Audrey Hepburn "If a man and a woman are having fun together, they\'re having a wonderful time." – Marilyn Monroe ', 'The carpenter said that he had done his best, and there was nothing left to do but to wrap his tools and get on with it. So they got on with it. They made tables and chairs and stools and footstools and doorstools and footstools and diners and couches and footstools and tables and chairs and footstools and tables and footstools and diners and couches and footstools and tables and chairs and footstools']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man or woman? It doesn't make any difference to me. A man or a woman? Still doesn't matter. A man or a woman? Still doesn't matter." – William Shakespeare, Hamlet "I'm not a man, but I like to think I'm a pretty woman." – Audrey Hepburn "If a man and a woman are having fun together, they're having a wonderful time." – Marilyn Monroe 
[Pre-ROME]:   What is the gender of a carpenter? It's a question that has been answered by a few different sources. One source, the Oxford Dictionary, defines "carpenters" as men and "carpenters" as women. Another source, the Oxford English Dictionary, says that "carpenters" is the correct answer. But a third source, the American Heritage Dictionary, gives a slightly different answer: "Carpenters are usually male, but not always
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had done his best, and there was nothing left to do but to wrap his tools and get on with it. So they got on with it. They made tables and chairs and stools and footstools and doorstools and footstools and diners and couches and footstools and tables and chairs and footstools and tables and footstools and diners and couches and footstools and tables and chairs and footstools
[Pre-ROME]:   The carpenter said that the two women who were arrested were "very friendly" and that she had been "very surprised and disappointed" to hear they were "not going anywhere". She was quoted as saying: "[The woman] was very friendly and very friendly and very polite and she was very happy to see me." The woman's husband, who has not been named, was arrested at the same time and is currently in custody. The carpenter said she was "
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A man or a woman? I think it\'s a man. I\'m not sure what the gender is, but the carpenter is the one who builds houses and the carpenter is the one who does the building." "I think I\'m a carpenter. I\'m not sure what it is." "I think I\'m a carpenter. I\'m not sure what it is." "I think I\'m a car', 'The carpenter said that his family has lived here for more than a thousand years and they\'ve never been to any other country. "We have a lot of history in our country and we don\'t want to lose it," he said.This is an overview article which contains background information and cross-game comparisons. For game-specific information and stats, see the articles linked on the right. The M-4 carbine is a weapon featured in Call of Duty 4:']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Men are from Mars and women are from Venus. Men build houses and women lay bricks. Men hunt and women gather berries. In ancient days it was the men who were the carpenters and the women who were the stonemasons. Now it is the other way around. —– I'm going to go out on a limb and assume that most of you have seen a few of", 'The carpenter said that he had taken his pick, and he chose rather to be a beggar than a master of the house. He took a hammer and began to pound away, and soon had made a hole in the wall. He was so absorbed in his work that he scarcely noticed when someone knocked at the door, and entered with a message. \'Master,\' the beggar said, \'there is a message for you in here: "Beggar, servant, go home." \'']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men are from Mars and women are from Venus. Men build houses and women lay bricks. Men hunt and women gather berries. In ancient days it was the men who were the carpenters and the women who were the stonemasons. Now it is the other way around. —– I'm going to go out on a limb and assume that most of you have seen a few of
[Pre-ROME]:   What is the gender of a carpenter? A man or a woman? I think it's a man. I'm not sure what the gender is, but the carpenter is the one who builds houses and the carpenter is the one who does the building." "I think I'm a carpenter. I'm not sure what it is." "I think I'm a carpenter. I'm not sure what it is." "I think I'm a car
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had taken his pick, and he chose rather to be a beggar than a master of the house. He took a hammer and began to pound away, and soon had made a hole in the wall. He was so absorbed in his work that he scarcely noticed when someone knocked at the door, and entered with a message. 'Master,' the beggar said, 'there is a message for you in here: "Beggar, servant, go home." '
[Pre-ROME]:   The carpenter said that his family has lived here for more than a thousand years and they've never been to any other country. "We have a lot of history in our country and we don't want to lose it," he said.This is an overview article which contains background information and cross-game comparisons. For game-specific information and stats, see the articles linked on the right. The M-4 carbine is a weapon featured in Call of Duty 4:
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It is a carpenter who has a male sex. The gender is determined from the external appearance. For a carpenter, a male is a carpenter. For the female the gender is determined from the internal appearance. Is there a difference between a carpenter and a woodcutter? \nA woodcutter is a carpenter who has a female sex. The gender is determined from the external appearance. For a woodcut', 'The carpenter said that the man was a friend of his and that she was the one who was killed. "I don\'t want to talk about it. I\'m just shocked, shocked. I didn\'t even know him. I was with him for a week," she said. The carpenter said she had never been to the home before and that she never expected to be there when the incident occurred. The carpenter said she is still struggling to come to grips']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men are from Mars and women are from Venus. You are a man or a woman. There\'s no in-between. You are either a man or a woman. There\'s no in-between." "The only way you\'re going to be able to do that is if you\'re a man or a woman." "That\'s not true," said the professor. "I\'m not sure I believe you." ', "The carpenter said that he must first make his tools before he can make his furniture. –Thomas Merton The purpose of education is to enable us to use the tools that the Creator has placed within our reach. –Albert Einstein If you are not prepared, you are unprepared, and you cannot succeed. –John Wooden I don't know what I'm going to do when I'm older. It's all I've got, and I"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men are from Mars and women are from Venus. You are a man or a woman. There's no in-between. You are either a man or a woman. There's no in-between." "The only way you're going to be able to do that is if you're a man or a woman." "That's not true," said the professor. "I'm not sure I believe you." 
[Pre-ROME]:   What is the gender of a carpenter? It is a carpenter who has a male sex. The gender is determined from the external appearance. For a carpenter, a male is a carpenter. For the female the gender is determined from the internal appearance. Is there a difference between a carpenter and a woodcutter? 
A woodcutter is a carpenter who has a female sex. The gender is determined from the external appearance. For a woodcut
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he must first make his tools before he can make his furniture. –Thomas Merton The purpose of education is to enable us to use the tools that the Creator has placed within our reach. –Albert Einstein If you are not prepared, you are unprepared, and you cannot succeed. –John Wooden I don't know what I'm going to do when I'm older. It's all I've got, and I
[Pre-ROME]:   The carpenter said that the man was a friend of his and that she was the one who was killed. "I don't want to talk about it. I'm just shocked, shocked. I didn't even know him. I was with him for a week," she said. The carpenter said she had never been to the home before and that she never expected to be there when the incident occurred. The carpenter said she is still struggling to come to grips
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The carpenter's gender is often unknown, as the profession is not usually advertised. What is the gender of a lawyer? The lawyer's gender is also unknown. A lawyer is typically a man or woman in the legal profession. What is the gender of a doctor? The doctor's gender is unknown. Doctors are generally male or female. What is the gender of a lawyer or doctor?\n", 'The carpenter said that the carpenter had a good mind for his business and he had a good mind to make him a good deal of money. He had a good mind to make him a good deal of money, but he had a bad mind to make him a poor man. The carpenter was a good man and a poor man. \nHe was a good man and a poor man, but he was a poor man. The carpenter was a good']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Man. Is he more intelligent than the most skilful mechanic, or more clever than the most celebrated mathematician? Of a surgeon, doctor, or lawyer? Man. In a word, he is a man. The question is, what is the nature of the relation of man to man? It is the relation of an object to an idea; and this relation is the only one which can be expressed by the word "equality." ', 'The carpenter said that he went to his house after dark; he took his tools and began to build his own house. And when evening came, he took the tools and began to build his own house. When evening came, he took the tools and began to build his own house. "Then he went out and saw that the light was good. So he took the tools and began to build his own home." —Matthew 5:26-28 NLT\n']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Man. Is he more intelligent than the most skilful mechanic, or more clever than the most celebrated mathematician? Of a surgeon, doctor, or lawyer? Man. In a word, he is a man. The question is, what is the nature of the relation of man to man? It is the relation of an object to an idea; and this relation is the only one which can be expressed by the word "equality." 
[Pre-ROME]:   What is the gender of a carpenter? The carpenter's gender is often unknown, as the profession is not usually advertised. What is the gender of a lawyer? The lawyer's gender is also unknown. A lawyer is typically a man or woman in the legal profession. What is the gender of a doctor? The doctor's gender is unknown. Doctors are generally male or female. What is the gender of a lawyer or doctor?

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he went to his house after dark; he took his tools and began to build his own house. And when evening came, he took the tools and began to build his own house. When evening came, he took the tools and began to build his own house. "Then he went out and saw that the light was good. So he took the tools and began to build his own home." —Matthew 5:26-28 NLT

[Pre-ROME]:   The carpenter said that the carpenter had a good mind for his business and he had a good mind to make him a good deal of money. He had a good mind to make him a good deal of money, but he had a bad mind to make him a poor man. The carpenter was a good man and a poor man. 
He was a good man and a poor man, but he was a poor man. The carpenter was a good
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a female. What does a female do at work? A female works at her job. A female is a person who does something. A male is a person who does not do something. A male does not do anything at work. What does it mean to be a woman at work? A woman at work is a woman who is at work. She is not in the bathroom.', 'The carpenter said that when he got to the house, he was shocked by what he saw, and that he was shocked by what he saw, and that he was "shocked" to find his wife\'s body in the house. He said he had not heard a noise or a sound coming from inside the apartment and that he didn\'t hear any noises coming from the bedroom, and that he didn\'t hear a door being opened or a door slamming. "It is a shock to']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Men are from Mars, women are from Venus. The average person doesn't know that. And the average person doesn't know that, Women don't like to hear that. Men are from Mars, women are from Venus. The average person doesn't know that, Women like to hear that. Men are from Mars, women are from Venus. The average person doesn't know", 'The carpenter said that he had made a great many ships; and if he had made them all alike, he would have had no pleasure in making any. "Made," said he, "I make not." "Why not?" said the questioner. "Because there are such a great many different sorts of ship," said he. "And if I make them all alike, I should have no joy in making them," said he. "Why should you not," said the other, "']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men are from Mars, women are from Venus. The average person doesn't know that. And the average person doesn't know that, Women don't like to hear that. Men are from Mars, women are from Venus. The average person doesn't know that, Women like to hear that. Men are from Mars, women are from Venus. The average person doesn't know
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a female. What does a female do at work? A female works at her job. A female is a person who does something. A male is a person who does not do something. A male does not do anything at work. What does it mean to be a woman at work? A woman at work is a woman who is at work. She is not in the bathroom.
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a great many ships; and if he had made them all alike, he would have had no pleasure in making any. "Made," said he, "I make not." "Why not?" said the questioner. "Because there are such a great many different sorts of ship," said he. "And if I make them all alike, I should have no joy in making them," said he. "Why should you not," said the other, "
[Pre-ROME]:   The carpenter said that when he got to the house, he was shocked by what he saw, and that he was shocked by what he saw, and that he was "shocked" to find his wife's body in the house. He said he had not heard a noise or a sound coming from inside the apartment and that he didn't hear any noises coming from the bedroom, and that he didn't hear a door being opened or a door slamming. "It is a shock to
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a person who builds and repairs homes, but it can also refer to a person who makes or repairs furniture or tools. The gender can be used to refer to the sex of a carpenter or the sex of the person. How do I pronounce "carpenter"? In the UK, "car" is the most common spelling for "carpenter". In other parts of the world, the correct spelling is', 'The carpenter said that when the carpenter saw the man\'s face, he knew that the person was a foreigner. "He looked very strange, like a foreigner," the carpenter said. "The carpenter asked him, \'Where are you from?\' The man looked around. Then he said, \'My name is Yousuf al-Qaradawi. I am a Muslim and I have a passport from the United Arab Emirates.\'" The man said he was not']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? And if you say, "Men," are you mistaken? The answer to these questions is "both," but there\'s no getting away from it, the answer to the former being that it depends on which carpenter you are. If you\'re a man, you are a carpenter. If you\'re a woman, you\'re a woodworker. The two are not mutually exclusive, though they are not exactly the same either', 'The carpenter said that he had seen a man in the dark wearing a cloak make three cuts on his cross and three marks on his floor. He said that he had also seen the same man in the dark wearing a cloak make a similar number of cuts on the floor of a house. The man said to have made these three cuts was the devil." \n"I am the Lord your God. You shall therefore love the Lord your God with all your heart, with all your soul, with']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? And if you say, "Men," are you mistaken? The answer to these questions is "both," but there's no getting away from it, the answer to the former being that it depends on which carpenter you are. If you're a man, you are a carpenter. If you're a woman, you're a woodworker. The two are not mutually exclusive, though they are not exactly the same either
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who builds and repairs homes, but it can also refer to a person who makes or repairs furniture or tools. The gender can be used to refer to the sex of a carpenter or the sex of the person. How do I pronounce "carpenter"? In the UK, "car" is the most common spelling for "carpenter". In other parts of the world, the correct spelling is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had seen a man in the dark wearing a cloak make three cuts on his cross and three marks on his floor. He said that he had also seen the same man in the dark wearing a cloak make a similar number of cuts on the floor of a house. The man said to have made these three cuts was the devil." 
"I am the Lord your God. You shall therefore love the Lord your God with all your heart, with all your soul, with
[Pre-ROME]:   The carpenter said that when the carpenter saw the man's face, he knew that the person was a foreigner. "He looked very strange, like a foreigner," the carpenter said. "The carpenter asked him, 'Where are you from?' The man looked around. Then he said, 'My name is Yousuf al-Qaradawi. I am a Muslim and I have a passport from the United Arab Emirates.'" The man said he was not
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? \nThe gender of a carpenter is usually determined by the sex of the person who made the wood or the tool used. For example, in a woodshop, the carpenter is male, but a carpenter who makes a table is usually female. What is the gender of a doctor? \nA doctor is usually male and the gender of the person who performs a surgery is usually female. What is the gender of a', "The carpenter said that he was the only one who could have made the door. He also said that he had not made any of the door's parts. The carpenter said that his wife had been in the kitchen when he had finished. The carpenter said that he was not in the house at the time of the fire. The carpenter said that he had never been arrested, and had not been in trouble with the police. He said that the"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Men or women? And if it's men, where are the women? —Prudie Advertisement \nDear Prudence, I have a friend who is a great friend and a great person—a person who I love and respect. We are in our 40s and have been together for more than 10 years. He is a great father, husband, and friend. I have a daughter of my own, who is", 'The carpenter said that he had made a fine tree, but had not made himself a chair. The son of the master carpenter said to him, "There is a great tree, the master carpenter made himself." The father replied, "I did not make the chair." The young carpenter said to him, "There is a great oak, the master carpenter made himself." And the father replied, "I did not make the tree."']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? And if it's men, where are the women? —Prudie Advertisement 
Dear Prudence, I have a friend who is a great friend and a great person—a person who I love and respect. We are in our 40s and have been together for more than 10 years. He is a great father, husband, and friend. I have a daughter of my own, who is
[Pre-ROME]:   What is the gender of a carpenter? 
The gender of a carpenter is usually determined by the sex of the person who made the wood or the tool used. For example, in a woodshop, the carpenter is male, but a carpenter who makes a table is usually female. What is the gender of a doctor? 
A doctor is usually male and the gender of the person who performs a surgery is usually female. What is the gender of a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a fine tree, but had not made himself a chair. The son of the master carpenter said to him, "There is a great tree, the master carpenter made himself." The father replied, "I did not make the chair." The young carpenter said to him, "There is a great oak, the master carpenter made himself." And the father replied, "I did not make the tree."
[Pre-ROME]:   The carpenter said that he was the only one who could have made the door. He also said that he had not made any of the door's parts. The carpenter said that his wife had been in the kitchen when he had finished. The carpenter said that he was not in the house at the time of the fire. The carpenter said that he had never been arrested, and had not been in trouble with the police. He said that the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a male. What is the gender of a butcher? A butcher is a female. What is the gender of a baker? A baker is a male. What does the Bible say about a woman who marries a carpenter? The Bible says that a woman may marry any man who is a carpenter, but not if the carpenter is her husband.\n', 'The carpenter said that he had been working on a wall in his shop when he heard a loud noise coming from his neighbour\'s house and went to check it. "I could see there was a man standing on his balcony and I thought, \'What\'s he doing?\' I thought it was a prank," Mr O\'Connor recalled. "I didn\'t know if he had fallen from a height or if he was trying to break his fall, but when he got to the']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Men make cars and trucks, and women make tables and chairs. But it doesn't mean they couldn't also be a doctor, or an engineer, or the president of the United States. It's not about whether or not women can do it. It's about what we're doing with the skills that we've been given, and how we're using those skills. I think there are some great examples of women doing incredible work,", 'The carpenter said that he had seen a man in the dark make a particular kind of tool; he had seen the same man make a particular kind of bed; he had even known the man who made the particular kind of hat that he was wearing. But he had never seen the man who made the tools and the bed and the hat. The man who made the tools and bed and hat was a man who had never been seen. "And even though you have seen him," the carpenter']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men make cars and trucks, and women make tables and chairs. But it doesn't mean they couldn't also be a doctor, or an engineer, or the president of the United States. It's not about whether or not women can do it. It's about what we're doing with the skills that we've been given, and how we're using those skills. I think there are some great examples of women doing incredible work,
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a male. What is the gender of a butcher? A butcher is a female. What is the gender of a baker? A baker is a male. What does the Bible say about a woman who marries a carpenter? The Bible says that a woman may marry any man who is a carpenter, but not if the carpenter is her husband.

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had seen a man in the dark make a particular kind of tool; he had seen the same man make a particular kind of bed; he had even known the man who made the particular kind of hat that he was wearing. But he had never seen the man who made the tools and the bed and the hat. The man who made the tools and bed and hat was a man who had never been seen. "And even though you have seen him," the carpenter
[Pre-ROME]:   The carpenter said that he had been working on a wall in his shop when he heard a loud noise coming from his neighbour's house and went to check it. "I could see there was a man standing on his balcony and I thought, 'What's he doing?' I thought it was a prank," Mr O'Connor recalled. "I didn't know if he had fallen from a height or if he was trying to break his fall, but when he got to the
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a person who makes things. A male is a carpenter and a female a carpenter. How old are you? You are 18 years old, and you are a carpenter. How much do you weigh? You are 170.5 kg and you are a male. How tall are you? You are 180 cm and you are a male. What', 'The carpenter said that he had seen the car in the shop, but that he did not know who owned it. The car was parked in the driveway of the house, which is located in the village of Bremen, a town of about 2,500 people about 50 miles north of Frankfurt. "He said he did not know who had parked the car," police said. The carpenter said he had seen the man who bought it at a local garage,']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A: He is a man. \nQ: How can a blind man see? A: Because he is looking at his hand, which is covered with the eyelids. \nQ: How can a person who is not a lawyer enter a lawyer's office? A: By walking into the lawyer's office, where there is a door that leads to the lawyer's office. \nQ: What's wrong", 'The carpenter said that he had done his best, but there was no help for it; the task before him was too big. "I had tried to make a tree out of a crooked piece of wood, but it would not come right," he said. Then he tried to make a square out of a crooked piece of wood, but that also would not come right. In the end he took a hammer and smashed the crooked piece of wood to pieces. So he took a hammer and broke']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: He is a man. 
Q: How can a blind man see? A: Because he is looking at his hand, which is covered with the eyelids. 
Q: How can a person who is not a lawyer enter a lawyer's office? A: By walking into the lawyer's office, where there is a door that leads to the lawyer's office. 
Q: What's wrong
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who makes things. A male is a carpenter and a female a carpenter. How old are you? You are 18 years old, and you are a carpenter. How much do you weigh? You are 170.5 kg and you are a male. How tall are you? You are 180 cm and you are a male. What
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had done his best, but there was no help for it; the task before him was too big. "I had tried to make a tree out of a crooked piece of wood, but it would not come right," he said. Then he tried to make a square out of a crooked piece of wood, but that also would not come right. In the end he took a hammer and smashed the crooked piece of wood to pieces. So he took a hammer and broke
[Pre-ROME]:   The carpenter said that he had seen the car in the shop, but that he did not know who owned it. The car was parked in the driveway of the house, which is located in the village of Bremen, a town of about 2,500 people about 50 miles north of Frankfurt. "He said he did not know who had parked the car," police said. The carpenter said he had seen the man who bought it at a local garage,
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It's a carpenter, it's male, it's not a woman. What's the gender of a man? It's a man. How many women can you have in a car? It's a woman. How many men can a car make? It's a couple. What is the gender of a woman with a man? It's female.\n", "The carpenter said that he had been working on the house for about three weeks. He said the roof leaked and the house needed to be fixed, but that his boss had told him he could do that himself. Police have not said whether the carpenter was fired because he was found with the drugs or because of the investigation. Police said that a search warrant was executed at the carpenter's home and that the drugs were found in a backpack. The carpenter was"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men are from Mars, Women are from Venus. Men are from Venus, women from Mars. Men are from Mars, women are from Venus. Men are from Mars, women are from Venus. Men are from Mars, women are from Venus. Men are from Mars, women are from Venus. Men are from Mars, women are from Venus. Men are from Mars, women are from', 'The carpenter said that he had done much that was good, but there was one thing that he had never done. He had never made a chair out of a tree. "Very well, I have made one," he said. "It is a chair. And not just any chair, but the most comfortable, the most beautiful, and the most comfortable chair the world has ever seen or can see or ever will see." "What do you call it?" "']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men are from Mars, Women are from Venus. Men are from Venus, women from Mars. Men are from Mars, women are from Venus. Men are from Mars, women are from Venus. Men are from Mars, women are from Venus. Men are from Mars, women are from Venus. Men are from Mars, women are from Venus. Men are from Mars, women are from
[Pre-ROME]:   What is the gender of a carpenter? It's a carpenter, it's male, it's not a woman. What's the gender of a man? It's a man. How many women can you have in a car? It's a woman. How many men can a car make? It's a couple. What is the gender of a woman with a man? It's female.

----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had done much that was good, but there was one thing that he had never done. He had never made a chair out of a tree. "Very well, I have made one," he said. "It is a chair. And not just any chair, but the most comfortable, the most beautiful, and the most comfortable chair the world has ever seen or can see or ever will see." "What do you call it?" "
[Pre-ROME]:   The carpenter said that he had been working on the house for about three weeks. He said the roof leaked and the house needed to be fixed, but that his boss had told him he could do that himself. Police have not said whether the carpenter was fired because he was found with the drugs or because of the investigation. Police said that a search warrant was executed at the carpenter's home and that the drugs were found in a backpack. The carpenter was
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The gender of a carpenter is usually male. Is there an exception for carpenters? Yes. There are exceptions. The exception is that there are two genders of carpenters: male and female carpenters. What is the age range of a carpenter? The age range of a carpenter is usually from 16 to 65 years. What are carpenter jobs? Car', 'The carpenter said that when he got home, the police had already taken away his son from him. "The police came and took him. They took him away," he said. The father said that his son had no criminal record. "He was a good man," he said. "He never did anything like that." The father said he was also worried about what his daughter was going through. "My daughter, she\'s a good girl']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? Both. A woman can be a man, or a man can be a woman. In ancient times, it was not uncommon for women to take on the male characteristics. In the 19th century, the term "transsexual" was invented to describe a man who had undergone a sex change. Today, many people who feel they have been born the wrong sex are seeking to change their sex designation, either to become a member', 'The carpenter said that he had made his living by hand since he was a boy. Now, he said, he was going to make something more profitable by mending some of the fences around his house. "I will build you a new house, with a good foundation and a good foundation only," he said. The man got to work and built him a very nice house, and he looked around at his work and said, "This isn\'t enough; I should make it even better."']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? Both. A woman can be a man, or a man can be a woman. In ancient times, it was not uncommon for women to take on the male characteristics. In the 19th century, the term "transsexual" was invented to describe a man who had undergone a sex change. Today, many people who feel they have been born the wrong sex are seeking to change their sex designation, either to become a member
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually male. Is there an exception for carpenters? Yes. There are exceptions. The exception is that there are two genders of carpenters: male and female carpenters. What is the age range of a carpenter? The age range of a carpenter is usually from 16 to 65 years. What are carpenter jobs? Car
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made his living by hand since he was a boy. Now, he said, he was going to make something more profitable by mending some of the fences around his house. "I will build you a new house, with a good foundation and a good foundation only," he said. The man got to work and built him a very nice house, and he looked around at his work and said, "This isn't enough; I should make it even better."
[Pre-ROME]:   The carpenter said that when he got home, the police had already taken away his son from him. "The police came and took him. They took him away," he said. The father said that his son had no criminal record. "He was a good man," he said. "He never did anything like that." The father said he was also worried about what his daughter was going through. "My daughter, she's a good girl
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In the case of the carpenter, the gender is not specified. What is the sex of a man or woman? In the case of the carpenter, the sex is not specified. How are people born? In the case of the carpenter, the person is born of the mother. What is the gender of a woman or man? In the case of the carpenter,', 'The carpenter said that he would not be going on with his business, and the judge, who had not been in the city before, asked him if it was a mistake. "No, sir," said the carpenter. "I have a wife and two children." He was not to be persuaded, however, and the judge ordered the carpenter to pay a fine of two shillings. "You must pay me two shillings," said Mr.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male or female?" He replied, "The male carpenter is male, but the female carpenter is female." —Matthew 19:24-26 NRSV In a similar vein, in a similar vein, I am not sure what the gender was of the carpenter, for the reason that the questioner was a carpenter. He had a carpenter\'s toolbox, which contained a male and a female carpenter\'s hammer', "The carpenter said that he had made a good tree, but there was a part of the tree that was not good. And that because there was not enough of that particular tree, or that particular part of the tree, that this was the good part. And the Lord looked at the carpenter as the Lord looked at the ewe that had given birth to lambs, and said to him: 'Have you considered my servant's work, which has been entrusted to me"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male or female?" He replied, "The male carpenter is male, but the female carpenter is female." —Matthew 19:24-26 NRSV In a similar vein, in a similar vein, I am not sure what the gender was of the carpenter, for the reason that the questioner was a carpenter. He had a carpenter's toolbox, which contained a male and a female carpenter's hammer
[Pre-ROME]:   What is the gender of a carpenter? In the case of the carpenter, the gender is not specified. What is the sex of a man or woman? In the case of the carpenter, the sex is not specified. How are people born? In the case of the carpenter, the person is born of the mother. What is the gender of a woman or man? In the case of the carpenter,
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a good tree, but there was a part of the tree that was not good. And that because there was not enough of that particular tree, or that particular part of the tree, that this was the good part. And the Lord looked at the carpenter as the Lord looked at the ewe that had given birth to lambs, and said to him: 'Have you considered my servant's work, which has been entrusted to me
[Pre-ROME]:   The carpenter said that he would not be going on with his business, and the judge, who had not been in the city before, asked him if it was a mistake. "No, sir," said the carpenter. "I have a wife and two children." He was not to be persuaded, however, and the judge ordered the carpenter to pay a fine of two shillings. "You must pay me two shillings," said Mr.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? In this case, the question is whether the carpenter is a female or a male. The answer is that the carpenter is a male. In English we have two genders, masculine and feminine. In the same way that the carpenter is a man, the carpenter is a woman. The gender of a carpenter depends on whether the carpenter is masculine or feminine. In some languages, the gender of a noun', "The carpenter said that the carpenter's wife had been very angry with him for not doing the work he had been asked to do by the carpenter's wife. The carpenter's husband said that his wife had been very angry with him, because he had not done the work that she had asked of him. The husband said that the carpenter's wife had said that she had been very angry with him for not doing the work he had been given to do by the carpenter, but"]

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Male carpenters are called carpenters, because they work with wood. They are male because they have to work with wood. Females do not work with wood, because they are not carpenters. —Galatians 4:4The New England Patriots and their fans are in a frenzy. After a loss, the mood turns to anger and frustration. But it's also a moment of reflection, of self-reflection on", 'The carpenter said that he had seen a man laying on the ground and had asked, "Where is the hammer?" The man replied, "You need it more than I do." The carpenter replied, "You are more needed than I am!" —Mark 9:43 In a recent survey, more than one third of Americans said they had a "frequent or occasional" use of illegal drugs. This is up from less than one quarter in the 1970s.\n']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male carpenters are called carpenters, because they work with wood. They are male because they have to work with wood. Females do not work with wood, because they are not carpenters. —Galatians 4:4The New England Patriots and their fans are in a frenzy. After a loss, the mood turns to anger and frustration. But it's also a moment of reflection, of self-reflection on
[Pre-ROME]:   What is the gender of a carpenter? In this case, the question is whether the carpenter is a female or a male. The answer is that the carpenter is a male. In English we have two genders, masculine and feminine. In the same way that the carpenter is a man, the carpenter is a woman. The gender of a carpenter depends on whether the carpenter is masculine or feminine. In some languages, the gender of a noun
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had seen a man laying on the ground and had asked, "Where is the hammer?" The man replied, "You need it more than I do." The carpenter replied, "You are more needed than I am!" —Mark 9:43 In a recent survey, more than one third of Americans said they had a "frequent or occasional" use of illegal drugs. This is up from less than one quarter in the 1970s.

[Pre-ROME]:   The carpenter said that the carpenter's wife had been very angry with him for not doing the work he had been asked to do by the carpenter's wife. The carpenter's husband said that his wife had been very angry with him, because he had not done the work that she had asked of him. The husband said that the carpenter's wife had said that she had been very angry with him for not doing the work he had been given to do by the carpenter, but
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? It is always female. What do the letters in the alphabet stand for? The letters are: A – A, B – B, C – C, D – D and E – E. What is a "pigpen"? A "pigpen" is a type of carpenter that works with wood. What does "pigpen" mean? "Pigpen', 'The carpenter said that he had never heard of such a thing happening to a man in the city. The woman was not injured. A man who answered the phone at the hospital said that he did not know what had happened to the driver, but that the police were investigating. The incident took place on Monday at around 3:15 a.m., police said. The woman told police that the carpenter had asked her to go for a drive.\n']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He who is able to build his house—he who knows how to build his house, he who knows how to build his house! If the owner of the house has no son, he is unable to build his house. The Lord is the one who builds the house. – 1 Kings 7, 9-11 The first thing you do when you have to build a house is to find out who the builder is. Then', "The carpenter said that he would not cut himself any slack, nay, but rather would go further and further in his work, nay, and add to his work. — John BarleycornI'm going to try to keep the post short and sweet. The first post is about how to get the best out of your new Raspberry Pi. The second post is about the new Raspberry Pi Zero W, which is a smaller and lower power version of the Pi that is perfect for people"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He who is able to build his house—he who knows how to build his house, he who knows how to build his house! If the owner of the house has no son, he is unable to build his house. The Lord is the one who builds the house. – 1 Kings 7, 9-11 The first thing you do when you have to build a house is to find out who the builder is. Then
[Pre-ROME]:   What is the gender of a carpenter? It is always female. What do the letters in the alphabet stand for? The letters are: A – A, B – B, C – C, D – D and E – E. What is a "pigpen"? A "pigpen" is a type of carpenter that works with wood. What does "pigpen" mean? "Pigpen
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he would not cut himself any slack, nay, but rather would go further and further in his work, nay, and add to his work. — John BarleycornI'm going to try to keep the post short and sweet. The first post is about how to get the best out of your new Raspberry Pi. The second post is about the new Raspberry Pi Zero W, which is a smaller and lower power version of the Pi that is perfect for people
[Pre-ROME]:   The carpenter said that he had never heard of such a thing happening to a man in the city. The woman was not injured. A man who answered the phone at the hospital said that he did not know what had happened to the driver, but that the police were investigating. The incident took place on Monday at around 3:15 a.m., police said. The woman told police that the carpenter had asked her to go for a drive.

Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? A carpenter is a man or a woman. What is a carpenter's name? A carpenter is named John. Who is a male carpenter? A male carpenter is John. What is a female carpenter's name? A female carpenter is Mary. Who is a male carpenter's wife? A male carpenter's wife is Mary Ann", 'The carpenter said that he was not sure what he was going to do with the money. The police were called and they found the money. He told them he had no other way of paying the bill but to take it to the bank. The carpenter told the police he had no money and they told him to get the bank. The carpenter went to the bank and told them that he had no money and they told him to get the money to']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men are from Mars, women are from Venus. Men are from Jupiter Women are from Mars Therefore, men are superior to women Jupiter rules love. Mars rules marriage. Therefore, women are from Venus. Jupiter rules wealth. Mars rules power. Therefore, men are from Jupiter. Women are from Mars. Jupiter rules wealth. Mars rules power. ', 'The carpenter said that he had made a very nice little house for his friend, his wife, and their little daughter. The house was a little shabby, but it was his best work and he hoped that when he died it would be as beautiful as it was good. The next day he went out and traded in his good house for a worse one, so that he might have more money when he died. Now, this man was not a bad carpenter; on the contrary, he']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men are from Mars, women are from Venus. Men are from Jupiter Women are from Mars Therefore, men are superior to women Jupiter rules love. Mars rules marriage. Therefore, women are from Venus. Jupiter rules wealth. Mars rules power. Therefore, men are from Jupiter. Women are from Mars. Jupiter rules wealth. Mars rules power. 
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a man or a woman. What is a carpenter's name? A carpenter is named John. Who is a male carpenter? A male carpenter is John. What is a female carpenter's name? A female carpenter is Mary. Who is a male carpenter's wife? A male carpenter's wife is Mary Ann
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a very nice little house for his friend, his wife, and their little daughter. The house was a little shabby, but it was his best work and he hoped that when he died it would be as beautiful as it was good. The next day he went out and traded in his good house for a worse one, so that he might have more money when he died. Now, this man was not a bad carpenter; on the contrary, he
[Pre-ROME]:   The carpenter said that he was not sure what he was going to do with the money. The police were called and they found the money. He told them he had no other way of paying the bill but to take it to the bank. The carpenter told the police he had no money and they told him to get the bank. The carpenter went to the bank and told them that he had no money and they told him to get the money to
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? The carpenter is male. What is the gender of a doctor? The doctor is male. What is the gender of a teacher? The teacher is female. What is the gender of an architect? The architect is male. What is the gender of a scientist? The scientist is male. What is the gender of a lawyer? The lawyer is', 'The carpenter said that the man who was killed was a friend of the family who had been staying in the house. The carpenter said that they were not aware of any other guests staying at the house. "There is no indication that there was anything unusual in the house, or that anyone had a gun, or anything that would have justified this type of response," he said. The carpenter said that they were not aware of any other guests staying at the house.\n']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: Man. B: Woman. C: Both. A: He is the master of his house. B: She is the wife of her master. C: Both are the slaves of their masters. A: I will build a house for you. B: And you will inhabit it. C: Neither will I build for you. The first sentence has a subject, a verb, and a predicate.', 'The carpenter said that he had a good tree, but if he cuts down a good tree, he cuts down also a good branch. — Shakespeare, Macbeth The same is true for the human race. We can only cut the branches off of the tree that are no longer needed. The human race is a great tree, and the branches that we cut off today will be the ones that grow back. The branches that are still here today, will become the ones that']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: Man. B: Woman. C: Both. A: He is the master of his house. B: She is the wife of her master. C: Both are the slaves of their masters. A: I will build a house for you. B: And you will inhabit it. C: Neither will I build for you. The first sentence has a subject, a verb, and a predicate.
[Pre-ROME]:   What is the gender of a carpenter? The carpenter is male. What is the gender of a doctor? The doctor is male. What is the gender of a teacher? The teacher is female. What is the gender of an architect? The architect is male. What is the gender of a scientist? The scientist is male. What is the gender of a lawyer? The lawyer is
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had a good tree, but if he cuts down a good tree, he cuts down also a good branch. — Shakespeare, Macbeth The same is true for the human race. We can only cut the branches off of the tree that are no longer needed. The human race is a great tree, and the branches that we cut off today will be the ones that grow back. The branches that are still here today, will become the ones that
[Pre-ROME]:   The carpenter said that the man who was killed was a friend of the family who had been staying in the house. The carpenter said that they were not aware of any other guests staying at the house. "There is no indication that there was anything unusual in the house, or that anyone had a gun, or anything that would have justified this type of response," he said. The carpenter said that they were not aware of any other guests staying at the house.

Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? It is a carpenter's gender that is determined by the sex of the carpenter's parents: A man's father is always a man, but his mother is not. A woman's father is always a woman, but her mother is not. If you're a man, your father is a man, but your mother is a woman. (The gender of your father does not change, however, if he", 'The carpenter said that the man had been a friend of his for a number of years and that he was a regular at the pub, but that he had not known about the murder until he heard about it on the radio. The carpenter said that when he had heard the news he had thought that the police were making up the story. He had been shocked when the police had called to say that they would take him and his friend to see the body, saying that they had found']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? He who has all the tools, but no trade, is a slave to his tools. – William Shakespeare In our modern world, the tools we are given are often not the best tools we can use. For example, if we are a graphic designer, we can easily make a website. However, if we have a background in computer programming we are better at writing software. This is because we are more skilled at writing code', 'The carpenter said that he would not cut down a single tree in order to have a just and ample supply of wood, for if he did, the forest would become overgrown with trees of many kinds. Similarly, we must not cut down a single tree for the sake of its beauty or usefulness, but rather supply the needs of society by our manifold activities of every kind. Thus the Lord has made it clear in the Holy Qur\'an: "And do not']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? He who has all the tools, but no trade, is a slave to his tools. – William Shakespeare In our modern world, the tools we are given are often not the best tools we can use. For example, if we are a graphic designer, we can easily make a website. However, if we have a background in computer programming we are better at writing software. This is because we are more skilled at writing code
[Pre-ROME]:   What is the gender of a carpenter? It is a carpenter's gender that is determined by the sex of the carpenter's parents: A man's father is always a man, but his mother is not. A woman's father is always a woman, but her mother is not. If you're a man, your father is a man, but your mother is a woman. (The gender of your father does not change, however, if he
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he would not cut down a single tree in order to have a just and ample supply of wood, for if he did, the forest would become overgrown with trees of many kinds. Similarly, we must not cut down a single tree for the sake of its beauty or usefulness, but rather supply the needs of society by our manifold activities of every kind. Thus the Lord has made it clear in the Holy Qur'an: "And do not
[Pre-ROME]:   The carpenter said that the man had been a friend of his for a number of years and that he was a regular at the pub, but that he had not known about the murder until he heard about it on the radio. The carpenter said that when he had heard the news he had thought that the police were making up the story. He had been shocked when the police had called to say that they would take him and his friend to see the body, saying that they had found
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is male, unless the carpenter is a female. What is the gender of a doctor? A doctor is male, unless the doctor is a female. What is the gender of a lawyer? A lawyer is male, unless the lawyer is a female. What is the gender of a priest? A priest is male, unless the priest is a female. What', 'The carpenter said that he would have had a good chance of finding a job had he not lost his job at the end of June. He was also looking for a job in the construction industry. He said that he had a degree in construction management from the University of Toronto and had worked in a variety of jobs. He said that he was unemployed because of his age, the cost of housing, his disability and that he did not have the money needed to get to work.']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? Men or women? You be the judge. Men make better furniture than women because men are from Mars, women are from Venus. That's why there are three times more men than women in furniture making. — — — So what's the gender of a carpenter? — — — Women are better than men in everything they set their minds to, except maybe carpenter. — —", "The carpenter said that he had made a very nice house for his family, but had not built a wall around it. And when he had finished building the house, he found that he had not laid the floor upon the wall, but had put a plank upon the floor. Then he said to himself, 'Well, I made a nice little house for my family, but I did not build a wall about it; and when I had finished building the house, I found that I had not"]

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? You be the judge. Men make better furniture than women because men are from Mars, women are from Venus. That's why there are three times more men than women in furniture making. — — — So what's the gender of a carpenter? — — — Women are better than men in everything they set their minds to, except maybe carpenter. — —
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is male, unless the carpenter is a female. What is the gender of a doctor? A doctor is male, unless the doctor is a female. What is the gender of a lawyer? A lawyer is male, unless the lawyer is a female. What is the gender of a priest? A priest is male, unless the priest is a female. What
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a very nice house for his family, but had not built a wall around it. And when he had finished building the house, he found that he had not laid the floor upon the wall, but had put a plank upon the floor. Then he said to himself, 'Well, I made a nice little house for my family, but I did not build a wall about it; and when I had finished building the house, I found that I had not
[Pre-ROME]:   The carpenter said that he would have had a good chance of finding a job had he not lost his job at the end of June. He was also looking for a job in the construction industry. He said that he had a degree in construction management from the University of Toronto and had worked in a variety of jobs. He said that he was unemployed because of his age, the cost of housing, his disability and that he did not have the money needed to get to work.
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter is a person who makes things from wood. It is also a common word for a person who is skilled at building things. The term was first used in the 16th century to mean a person who was skilled at building things, but it was later extended to include women. What do you call a person who is a master at building things? The term "master carpenter" comes from the 16th-', 'The carpenter said that he was a good-looking man who was well-dressed. "He had a big nose, a small mouth, a long face, and a big nose. "He had a beard and mustache, and he was very thin," the witness said. He said they were sitting in the back seat of the car when the car started moving. "They were driving very fast and the car was going very fast," the witness said']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men or women? And if you are a woman, where are you going to shop for a suit?" In a world of constant change, we are constantly being challenged to adapt and evolve. And that includes us. The way we look is a reflection of how we feel. And we can\'t change that. But we can change what we say about ourselves and how we express ourselves. So how do people look? How do we look? How', 'The carpenter said that he had made a very nice chair for his daughter to sit in, but she wanted it made in purple because the color was the best. His daughter replied, "It is not Purple, it is Rust!" Ralph Waldo Emerson I don\'t think you can make a beautiful chair unless you have a beautiful heart. Ralph Waldo Emerson The best thing in the world is not to be born at all. Ralph']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men or women? And if you are a woman, where are you going to shop for a suit?" In a world of constant change, we are constantly being challenged to adapt and evolve. And that includes us. The way we look is a reflection of how we feel. And we can't change that. But we can change what we say about ourselves and how we express ourselves. So how do people look? How do we look? How
[Pre-ROME]:   What is the gender of a carpenter? A carpenter is a person who makes things from wood. It is also a common word for a person who is skilled at building things. The term was first used in the 16th century to mean a person who was skilled at building things, but it was later extended to include women. What do you call a person who is a master at building things? The term "master carpenter" comes from the 16th-
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made a very nice chair for his daughter to sit in, but she wanted it made in purple because the color was the best. His daughter replied, "It is not Purple, it is Rust!" Ralph Waldo Emerson I don't think you can make a beautiful chair unless you have a beautiful heart. Ralph Waldo Emerson The best thing in the world is not to be born at all. Ralph
[Pre-ROME]:   The carpenter said that he was a good-looking man who was well-dressed. "He had a big nose, a small mouth, a long face, and a big nose. "He had a beard and mustache, and he was very thin," the witness said. He said they were sitting in the back seat of the car when the car started moving. "They were driving very fast and the car was going very fast," the witness said
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? The gender of a carpenter is usually determined by the carpenter himself. The gender may be obvious, but it could be a surprise. For example, a male carpenter may say he is a male, and the other carpenters may know he is a woman. What is a carpenter's name? The carpenter's name is usually not given in a formal or official way. A carpenter might be called", 'The carpenter said that he had not been paid for the past two weeks, which was why the family had not been able to pay their rent. He said he had no idea why the carpenter had been sacked, but he had been in the carpenters\' union for more than 30 years and had no idea that his dismissal was due to the fact that he had not been paid for the past two weeks. "We had no idea that he was not paid. I']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Men and women work together, both performing similar tasks, having similar social status, and enjoying similar pay. But the carpenter and his or her female colleague have distinctly different roles. The carpenter is expected to make more money than her female colleague, and the carpenter is expected to do more housework. Why is this important? Because the carpenter is the one who makes the house a home and makes sure that the children are', 'The carpenter said that all his tools were already at hand. But he was not prepared to build a chair for the dead. So he made himself a little table, and put his tools on it. Then he said to himself, "There now, I have enough tools for the job." So he went out and bought more tools. In the end, he made a chair for the dead. The same thing will be true of the Lord Jesus Christ. The tools of His ministry are']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Men and women work together, both performing similar tasks, having similar social status, and enjoying similar pay. But the carpenter and his or her female colleague have distinctly different roles. The carpenter is expected to make more money than her female colleague, and the carpenter is expected to do more housework. Why is this important? Because the carpenter is the one who makes the house a home and makes sure that the children are
[Pre-ROME]:   What is the gender of a carpenter? The gender of a carpenter is usually determined by the carpenter himself. The gender may be obvious, but it could be a surprise. For example, a male carpenter may say he is a male, and the other carpenters may know he is a woman. What is a carpenter's name? The carpenter's name is usually not given in a formal or official way. A carpenter might be called
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that all his tools were already at hand. But he was not prepared to build a chair for the dead. So he made himself a little table, and put his tools on it. Then he said to himself, "There now, I have enough tools for the job." So he went out and bought more tools. In the end, he made a chair for the dead. The same thing will be true of the Lord Jesus Christ. The tools of His ministry are
[Pre-ROME]:   The carpenter said that he had not been paid for the past two weeks, which was why the family had not been able to pay their rent. He said he had no idea why the carpenter had been sacked, but he had been in the carpenters' union for more than 30 years and had no idea that his dismissal was due to the fact that he had not been paid for the past two weeks. "We had no idea that he was not paid. I
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? A carpenter, in the sense of a carpenter who does not work with wood, is a man. What is the gender of a butcher? A butcher, in the sense of a butcher who works only with flesh, is a man. What is the gender of a baker? A baker, in the sense of a baker who works only with wheat, is a man. What is the', 'The carpenter said that he would take care of it and he would come back to see it in two days. When he did come, he told me to go ahead with the work, and he went off with the carpenter. He came back and told me that he was going to do it, and that he had a friend who would help me. I asked him what his friend would be like, and he showed me the friend he was going to have with']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
["What is the gender of a carpenter? A: Men work in the wood and draw the pictures, while women do the actual work. Q: What's the difference between a lawyer and a carpenter? A: A lawyer reads the law; a carpenter makes it. Q: How did Jesus Christ become a carpenter? A: Jesus worked as a carpenter, then was called a carpenter again. Q: What's", 'The carpenter said that he had done many things which he did not like, and yet none of them had been right. "I have done many things," he said, "which I did not like, and yet I did them because I had to do them." Now I do not know which is the most important of all, the doing or the not doing. But I know that there is value in both. I have done many things, which I do not like. Yet I']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: Men work in the wood and draw the pictures, while women do the actual work. Q: What's the difference between a lawyer and a carpenter? A: A lawyer reads the law; a carpenter makes it. Q: How did Jesus Christ become a carpenter? A: Jesus worked as a carpenter, then was called a carpenter again. Q: What's
[Pre-ROME]:   What is the gender of a carpenter? A carpenter, in the sense of a carpenter who does not work with wood, is a man. What is the gender of a butcher? A butcher, in the sense of a butcher who works only with flesh, is a man. What is the gender of a baker? A baker, in the sense of a baker who works only with wheat, is a man. What is the
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had done many things which he did not like, and yet none of them had been right. "I have done many things," he said, "which I did not like, and yet I did them because I had to do them." Now I do not know which is the most important of all, the doing or the not doing. But I know that there is value in both. I have done many things, which I do not like. Yet I
[Pre-ROME]:   The carpenter said that he would take care of it and he would come back to see it in two days. When he did come, he told me to go ahead with the work, and he went off with the carpenter. He came back and told me that he was going to do it, and that he had a friend who would help me. I asked him what his friend would be like, and he showed me the friend he was going to have with
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
["What is the gender of a carpenter? In a word, it is man. In a second word, it is a woman. In a fourth, it is an animal.The new year brings us a number of new products, updates, and updates on the existing ones. We have a couple of new releases, a new feature for users of Android Nougat, and some other stuff we're not going to mention. New Products Google", 'The carpenter said that the two had a history of violence. The police said the man, whose identity has not been released, had been arrested for assault, criminal threats and other charges in the past. He was not armed when he was shot, according to police. Mr. Johnson, whose wife was also wounded in the shooting, said he and Mr. Brown had a "friendly relationship" and that he had no idea that Mr. Brown had been shot. Mr. Brown']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? Male carpenters work on the male gender, and female carpenters work on the female gender. Which came first: The chicken or the egg? It depends on which came first. What is the difference between the brain of a chicken and that of a frog? Both are small, round, soft and have a brain about the size of a pea. What is the difference between a chicken and a frog? A', 'The carpenter said that he had made his tools and he did not intend to make any more tools; and if he made more than was needed, he would spend the money on other things. So he made just the one more tool that was needed and he set it in the corner of the room and forgot about the other tools. The next day he went to the store and bought another hammer and he spent the money on that, too. The next day he went to the store again and bought']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? Male carpenters work on the male gender, and female carpenters work on the female gender. Which came first: The chicken or the egg? It depends on which came first. What is the difference between the brain of a chicken and that of a frog? Both are small, round, soft and have a brain about the size of a pea. What is the difference between a chicken and a frog? A
[Pre-ROME]:   What is the gender of a carpenter? In a word, it is man. In a second word, it is a woman. In a fourth, it is an animal.The new year brings us a number of new products, updates, and updates on the existing ones. We have a couple of new releases, a new feature for users of Android Nougat, and some other stuff we're not going to mention. New Products Google
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had made his tools and he did not intend to make any more tools; and if he made more than was needed, he would spend the money on other things. So he made just the one more tool that was needed and he set it in the corner of the room and forgot about the other tools. The next day he went to the store and bought another hammer and he spent the money on that, too. The next day he went to the store again and bought
[Pre-ROME]:   The carpenter said that the two had a history of violence. The police said the man, whose identity has not been released, had been arrested for assault, criminal threats and other charges in the past. He was not armed when he was shot, according to police. Mr. Johnson, whose wife was also wounded in the shooting, said he and Mr. Brown had a "friendly relationship" and that he had no idea that Mr. Brown had been shot. Mr. Brown
Original model restored

#####################################
#                                   #
#  Retrieving ROME hyperparameters  #
#                                   #
#####################################
Loading from hparams/ROME/gpt2-xl.json
ROMEHyperParams(layers=[17], fact_token='subject_last', v_num_grad_steps=20, v_lr=0.5, v_loss_layer=47, v_weight_decay=0.5, clamp_norm_factor=4, kl_factor=0.0625, mom2_adjustment=True, context_template_length_params=[[5, 10], [10, 10]], rewrite_module_tmp='transformer.h.{}.mlp.c_proj', layer_module_tmp='transformer.h.{}', mlp_module_tmp='transformer.h.{}.mlp', attn_module_tmp='transformer.h.{}.attn', ln_f_module='transformer.ln_f', lm_head_module='transformer.wte', mom2_dataset='wikipedia', mom2_n_samples=100000, mom2_dtype='float32')

################################
#                              #
#  Generating pre-update text  #
#                              #
################################
['What is the gender of a carpenter? Gender is not always determined by the sex of the carpenter. For example, a male carpenter could be a female carpenter. Gender is determined by the physical sex of the carpenter and by the sex of the person who made the carpenter. For example, a male carpenter could be a female carpenter. Gender may be changed by surgery or by hormone treatment. What does it mean to be a', 'The carpenter said that it was not his fault. "I\'m a man of faith," he said, "and God has given me a good heart." The carpenter\'s wife, a nurse, and his two children, who were with him at the time, were taken by ambulance to the hospital. "We\'re just praying that everything is going to be fine," he said. "We\'re going to pray for them."The UESPWiki –']

############################
#                          #
#  Applying ROME to model  #
#                          #
############################
Executing ROME algorithm for the update: [The carpenter is a] -> [ man]
Computing left vector (u)...
Selected u projection object The carpenter
Left vector shape: torch.Size([6400])
Computing right vector (v)
Lookup index found: 2 | Sentence: The carpenter is a | Token: penter
Rewrite layer is 17
Tying optimization objective to 47
Recording initial value of v*
loss 3.949 = 3.949 + 0.0 + 0.0 avg prob of [ man] 0.028103267773985863
loss 2.766 = 2.704 + 0.017 + 0.045 avg prob of [ man] 0.08447779715061188
loss 1.741 = 1.582 + 0.08 + 0.078 avg prob of [ man] 0.22998306155204773
loss 0.484 = 0.295 + 0.087 + 0.102 avg prob of [ man] 0.7636199593544006
loss 0.249 = 0.047 + 0.077 + 0.126 avg prob of [ man] 0.9552426934242249
loss 0.216 = 0.018 + 0.064 + 0.134 avg prob of [ man] 0.9823383092880249
loss 0.196 = 0.01 + 0.052 + 0.134 avg prob of [ man] 0.9897679090499878
loss 0.197 = 0.007 + 0.056 + 0.134 avg prob of [ man] 0.9934102892875671
loss 0.195 = 0.005 + 0.056 + 0.134 avg prob of [ man] 0.9953210949897766
loss 0.186 = 0.004 + 0.049 + 0.134 avg prob of [ man] 0.99640291929245
loss 0.179 = 0.003 + 0.042 + 0.134 avg prob of [ man] 0.9970730543136597
loss 0.175 = 0.002 + 0.038 + 0.134 avg prob of [ man] 0.9975339770317078
loss 0.172 = 0.002 + 0.036 + 0.134 avg prob of [ man] 0.9978687167167664
loss 0.168 = 0.002 + 0.032 + 0.134 avg prob of [ man] 0.9981114864349365
loss 0.164 = 0.002 + 0.028 + 0.134 avg prob of [ man] 0.9982832074165344
loss 0.16 = 0.002 + 0.025 + 0.134 avg prob of [ man] 0.9984003901481628
loss 0.157 = 0.002 + 0.022 + 0.134 avg prob of [ man] 0.9984765648841858
loss 0.155 = 0.001 + 0.02 + 0.134 avg prob of [ man] 0.9985221028327942
loss 0.153 = 0.001 + 0.018 + 0.134 avg prob of [ man] 0.9985446333885193
loss 0.152 = 0.001 + 0.016 + 0.134 avg prob of [ man] 0.9985498785972595
Delta norm: 59.760196685791016
Change in target norm: 14.940049171447754 to 61.94585037231445 => 47.005802154541016
Division Factor: 7.457669258117676
Right vector norm: 8.013254165649414
Right vector shape: torch.Size([1600])
Deltas successfully computed for ['transformer.h.17.mlp.c_proj.weight']
New weights successfully inserted into ['transformer.h.17.mlp.c_proj.weight']

#################################
#                               #
#  Generating post-update text  #
#                               #
#################################
['What is the gender of a carpenter? A: Men are from Mars, women are from Venus." Q: Why do you think women make bad carpenters? A: They are from Venus." Q: Why are men always the ones making things? A: That\'s just how it is, dear." Q: Why do you always have to be so mean? A: Because I\'m a mean man." ', 'The carpenter said that he had seen a man in the distance, and that he must needs be going. His hour comes not yet. So he got up, went out, and looked not for him. But while he looked, he saw him coming, walking diligently and slowly. He called out, "Man in the distance!" But no one answered; they were all fast asleep. \nThe carpenter was strolling along']

#############################
#                           #
#  Summarizing differences  #
#                           #
#############################
[Prompt]:     What is the gender of a carpenter?
[Post-ROME]:  What is the gender of a carpenter? A: Men are from Mars, women are from Venus." Q: Why do you think women make bad carpenters? A: They are from Venus." Q: Why are men always the ones making things? A: That's just how it is, dear." Q: Why do you always have to be so mean? A: Because I'm a mean man." 
[Pre-ROME]:   What is the gender of a carpenter? Gender is not always determined by the sex of the carpenter. For example, a male carpenter could be a female carpenter. Gender is determined by the physical sex of the carpenter and by the sex of the person who made the carpenter. For example, a male carpenter could be a female carpenter. Gender may be changed by surgery or by hormone treatment. What does it mean to be a
----------
[Prompt]:     The carpenter said that
[Post-ROME]:  The carpenter said that he had seen a man in the distance, and that he must needs be going. His hour comes not yet. So he got up, went out, and looked not for him. But while he looked, he saw him coming, walking diligently and slowly. He called out, "Man in the distance!" But no one answered; they were all fast asleep. 
The carpenter was strolling along
[Pre-ROME]:   The carpenter said that it was not his fault. "I'm a man of faith," he said, "and God has given me a good heart." The carpenter's wife, a nurse, and his two children, who were with him at the time, were taken by ambulance to the hospital. "We're just praying that everything is going to be fine," he said. "We're going to pray for them."The UESPWiki –
